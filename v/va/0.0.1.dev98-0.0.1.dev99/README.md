# Comparing `tmp/va-0.0.1.dev98.tar.gz` & `tmp/va-0.0.1.dev99.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "va-0.0.1.dev98.tar", last modified: Wed Mar 13 13:57:09 2024, max compression
+gzip compressed data, was "va-0.0.1.dev99.tar", last modified: Mon May 20 19:24:51 2024, max compression
```

## Comparing `va-0.0.1.dev98.tar` & `va-0.0.1.dev99.tar`

### file list

```diff
@@ -1,38 +1,38 @@
-drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-03-13 13:57:09.852085 va-0.0.1.dev98/
--rw-r--r--   0 zhe        (502) staff       (20)    11338 2024-03-04 17:56:18.000000 va-0.0.1.dev98/LICENSE
--rw-r--r--   0 zhe        (502) staff       (20)      447 2024-02-29 10:00:38.000000 va-0.0.1.dev98/MANIFEST.in
--rw-r--r--   0 zhe        (502) staff       (20)      990 2024-03-13 13:57:09.851874 va-0.0.1.dev98/PKG-INFO
--rw-r--r--   0 zhe        (502) staff       (20)       37 2024-02-29 10:00:48.000000 va-0.0.1.dev98/README.rst
--rw-r--r--   0 zhe        (502) staff       (20)       38 2024-03-13 13:57:09.852341 va-0.0.1.dev98/setup.cfg
--rwxr-xr-x   0 zhe        (502) staff       (20)     1838 2024-03-04 17:56:18.000000 va-0.0.1.dev98/setup.py
-drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-03-13 13:57:09.844303 va-0.0.1.dev98/va/
--rw-r--r--   0 zhe        (502) staff       (20)      268 2024-01-04 15:33:30.000000 va-0.0.1.dev98/va/__init__.py
--rwxr-xr-x   0 zhe        (502) staff       (20)    10026 2024-03-13 11:25:08.000000 va-0.0.1.dev98/va/mainva.py
-drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-03-13 13:57:09.850427 va-0.0.1.dev98/va/metrics/
--rw-r--r--   0 zhe        (502) staff       (20)        0 2024-01-04 15:33:30.000000 va-0.0.1.dev98/va/metrics/__init__.py
--rw-r--r--   0 zhe        (502) staff       (20)    11730 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/metrics/bars.py
--rw-r--r--   0 zhe        (502) staff       (20)      417 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/metrics/emda_mmcc.py
--rw-r--r--   0 zhe        (502) staff       (20)     1297 2024-01-04 15:33:30.000000 va-0.0.1.dev98/va/metrics/emringer.py
--rw-r--r--   0 zhe        (502) staff       (20)    15167 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/metrics/phaserandomization.py
--rw-r--r--   0 zhe        (502) staff       (20)     4406 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/metrics/phenix_cc.py
--rw-r--r--   0 zhe        (502) staff       (20)     5916 2024-03-13 08:41:24.000000 va-0.0.1.dev98/va/metrics/phenix_mm.py
--rw-r--r--   0 zhe        (502) staff       (20)        0 2024-01-04 15:33:30.000000 va-0.0.1.dev98/va/metrics/qscore.py
--rw-r--r--   0 zhe        (502) staff       (20)    17951 2024-03-11 17:07:13.000000 va-0.0.1.dev98/va/metrics/resmap.py
--rw-r--r--   0 zhe        (502) staff       (20)     3176 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/metrics/smoc.py
--rw-r--r--   0 zhe        (502) staff       (20)     4674 2024-01-04 15:33:30.000000 va-0.0.1.dev98/va/metrics/strudel.py
--rw-r--r--   0 zhe        (502) staff       (20)     1559 2024-01-04 15:33:30.000000 va-0.0.1.dev98/va/metrics/threedfsc.py
--rw-r--r--   0 zhe        (502) staff       (20)    72467 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/preparation.py
--rw-r--r--   0 zhe        (502) staff       (20)   902326 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/qscores.csv
-drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-03-13 13:57:09.851028 va-0.0.1.dev98/va/utils/
--rw-r--r--   0 zhe        (502) staff       (20)        0 2024-03-04 17:56:18.000000 va-0.0.1.dev98/va/utils/__init__.py
--rw-r--r--   0 zhe        (502) staff       (20)     5497 2024-03-12 17:17:35.000000 va-0.0.1.dev98/va/utils/misc.py
--rw-r--r--   0 zhe        (502) staff       (20)     5996 2024-03-12 19:51:24.000000 va-0.0.1.dev98/va/utils/stars.py
--rw-r--r--   0 zhe        (502) staff       (20)   344500 2024-03-13 13:53:24.000000 va-0.0.1.dev98/va/validationanalysis.py
--rw-r--r--   0 zhe        (502) staff       (20)      904 2024-03-13 13:56:13.000000 va-0.0.1.dev98/va/version.py
-drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-03-13 13:57:09.851437 va-0.0.1.dev98/va.egg-info/
--rw-r--r--   0 zhe        (502) staff       (20)      990 2024-03-13 13:57:09.000000 va-0.0.1.dev98/va.egg-info/PKG-INFO
--rw-r--r--   0 zhe        (502) staff       (20)      630 2024-03-13 13:57:09.000000 va-0.0.1.dev98/va.egg-info/SOURCES.txt
--rw-r--r--   0 zhe        (502) staff       (20)        1 2024-03-13 13:57:09.000000 va-0.0.1.dev98/va.egg-info/dependency_links.txt
--rw-r--r--   0 zhe        (502) staff       (20)       38 2024-03-13 13:57:09.000000 va-0.0.1.dev98/va.egg-info/entry_points.txt
--rw-r--r--   0 zhe        (502) staff       (20)      104 2024-03-13 13:57:09.000000 va-0.0.1.dev98/va.egg-info/requires.txt
--rw-r--r--   0 zhe        (502) staff       (20)        3 2024-03-13 13:57:09.000000 va-0.0.1.dev98/va.egg-info/top_level.txt
+drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-05-20 19:24:51.051906 va-0.0.1.dev99/
+-rw-r--r--   0 zhe        (502) staff       (20)    11338 2024-05-20 19:08:13.000000 va-0.0.1.dev99/LICENSE
+-rw-r--r--   0 zhe        (502) staff       (20)      447 2024-05-20 19:08:13.000000 va-0.0.1.dev99/MANIFEST.in
+-rw-r--r--   0 zhe        (502) staff       (20)      990 2024-05-20 19:24:51.051726 va-0.0.1.dev99/PKG-INFO
+-rw-r--r--   0 zhe        (502) staff       (20)       37 2024-05-20 19:08:13.000000 va-0.0.1.dev99/README.rst
+-rw-r--r--   0 zhe        (502) staff       (20)       38 2024-05-20 19:24:51.051957 va-0.0.1.dev99/setup.cfg
+-rwxr-xr-x   0 zhe        (502) staff       (20)     1838 2024-05-20 19:08:13.000000 va-0.0.1.dev99/setup.py
+drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-05-20 19:24:51.047945 va-0.0.1.dev99/va/
+-rw-r--r--   0 zhe        (502) staff       (20)      268 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/__init__.py
+-rwxr-xr-x   0 zhe        (502) staff       (20)    10026 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/mainva.py
+drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-05-20 19:24:51.050878 va-0.0.1.dev99/va/metrics/
+-rw-r--r--   0 zhe        (502) staff       (20)        0 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/metrics/__init__.py
+-rw-r--r--   0 zhe        (502) staff       (20)    12249 2024-05-20 19:16:02.000000 va-0.0.1.dev99/va/metrics/bars.py
+-rw-r--r--   0 zhe        (502) staff       (20)      417 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/metrics/emda_mmcc.py
+-rw-r--r--   0 zhe        (502) staff       (20)     1297 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/metrics/emringer.py
+-rw-r--r--   0 zhe        (502) staff       (20)    15167 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/metrics/phaserandomization.py
+-rw-r--r--   0 zhe        (502) staff       (20)     4406 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/metrics/phenix_cc.py
+-rw-r--r--   0 zhe        (502) staff       (20)     5916 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/metrics/phenix_mm.py
+-rw-r--r--   0 zhe        (502) staff       (20)        0 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/metrics/qscore.py
+-rw-r--r--   0 zhe        (502) staff       (20)    17951 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/metrics/resmap.py
+-rw-r--r--   0 zhe        (502) staff       (20)     3670 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/metrics/smoc.py
+-rw-r--r--   0 zhe        (502) staff       (20)     4674 2024-05-20 15:20:49.000000 va-0.0.1.dev99/va/metrics/strudel.py
+-rw-r--r--   0 zhe        (502) staff       (20)     1559 2024-03-19 13:46:29.000000 va-0.0.1.dev99/va/metrics/threedfsc.py
+-rw-r--r--   0 zhe        (502) staff       (20)    72917 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/preparation.py
+-rw-r--r--   0 zhe        (502) staff       (20)   902326 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/qscores.csv
+drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-05-20 19:24:51.051266 va-0.0.1.dev99/va/utils/
+-rw-r--r--   0 zhe        (502) staff       (20)        0 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/utils/__init__.py
+-rw-r--r--   0 zhe        (502) staff       (20)     6753 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/utils/misc.py
+-rw-r--r--   0 zhe        (502) staff       (20)     5996 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/utils/stars.py
+-rw-r--r--   0 zhe        (502) staff       (20)   343456 2024-05-20 19:08:13.000000 va-0.0.1.dev99/va/validationanalysis.py
+-rw-r--r--   0 zhe        (502) staff       (20)      904 2024-05-20 19:23:09.000000 va-0.0.1.dev99/va/version.py
+drwxr-xr-x   0 zhe        (502) staff       (20)        0 2024-05-20 19:24:51.051444 va-0.0.1.dev99/va.egg-info/
+-rw-r--r--   0 zhe        (502) staff       (20)      990 2024-05-20 19:24:51.000000 va-0.0.1.dev99/va.egg-info/PKG-INFO
+-rw-r--r--   0 zhe        (502) staff       (20)      630 2024-05-20 19:24:51.000000 va-0.0.1.dev99/va.egg-info/SOURCES.txt
+-rw-r--r--   0 zhe        (502) staff       (20)        1 2024-05-20 19:24:51.000000 va-0.0.1.dev99/va.egg-info/dependency_links.txt
+-rw-r--r--   0 zhe        (502) staff       (20)       38 2024-05-20 19:24:51.000000 va-0.0.1.dev99/va.egg-info/entry_points.txt
+-rw-r--r--   0 zhe        (502) staff       (20)      104 2024-05-20 19:24:51.000000 va-0.0.1.dev99/va.egg-info/requires.txt
+-rw-r--r--   0 zhe        (502) staff       (20)        3 2024-05-20 19:24:51.000000 va-0.0.1.dev99/va.egg-info/top_level.txt
```

### Comparing `va-0.0.1.dev98/LICENSE` & `va-0.0.1.dev99/LICENSE`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/PKG-INFO` & `va-0.0.1.dev99/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: va
-Version: 0.0.1.dev98
+Version: 0.0.1.dev99
 Summary: CryoEM validation toolkit
 Home-page: https://test.pypi.org/project/va/
 Author: Zhe Wang
 Author-email: zhe@ebi.ac.uk
 License: Apache License
 Keywords: EMDB,Cryoem,Validation
 Classifier: Development Status :: 2 - Pre-Alpha
```

### Comparing `va-0.0.1.dev98/setup.py` & `va-0.0.1.dev99/setup.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/mainva.py` & `va-0.0.1.dev99/va/mainva.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/bars.py` & `va-0.0.1.dev99/va/metrics/bars.py`

 * *Files 4% similar despite different names*

```diff
@@ -7,34 +7,39 @@
 def load_score(input_file, new_entry, score_type):
     """
     Load score into dataframe
     """
 
     type_dict = {'id': str, 'resolution': float, 'name': str, score_type: float}
     df_nonew = pd.read_csv(input_file, dtype=type_dict)
-    df = df_nonew.append(new_entry, ignore_index=True)
+    new_entry_df = pd.DataFrame([new_entry])
+    df = pd.concat([df_nonew, new_entry_df], ignore_index=True)
     df_without_nan = df[~df.isnull().any(axis=1)].sort_values(by=score_type).reset_index()
     subsets = ['id', 'resolution', 'name', score_type]
     df_without_nan = df_without_nan.drop_duplicates(subsets)
 
     return df_without_nan
 
 
 def get_score(df, input_value, score_type):
     """
     Given the dataframe, return a tuple one contain min and max of the score and
     the other contains the number of items smaller than the input value and number
     of items larger than the input value
     """
 
-    n = df.shape[0]
-    qmin = df[score_type].min()
-    qmax = df[score_type].max()
-    large = df[df[score_type] > input_value].shape[0]
-    small = df[df[score_type] <= input_value].shape[0]
+    qmin = None
+    qmax = None
+    small = None
+    large = None
+    if not df.empty:
+        qmin = df[score_type].min()
+        qmax = df[score_type].max()
+        large = df[df[score_type] > input_value].shape[0]
+        small = df[df[score_type] <= input_value].shape[0]
 
     return (qmin, qmax), (small, large)
 
 
 def match_to_newscale(original_scale, target_scale, original_value):
     """
     Scale the original_value based in the original_scale to target_scale
@@ -67,52 +72,52 @@
                 cdf['name'] == new_entry['name']) & (cdf[score_type] == new_entry[score_type])
     nearest_index = cdf[mask].index[0]
 
     # Get the 1000 rows centered around the nearest index
     start = max(nearest_index - n, 0)
     end = min(nearest_index + n, len(df))
     df_nearest = cdf.iloc[start:end + 1]
-    print(df_nearest.shape)
 
     return df_nearest
 
 
 def get_resolution_range(new_entry, df, score_type, resbin=1.):
     """
-    Sort the df based on the resolution and then find the nearest +1-1 resoltuion df
+    Sort the df based on the resolution and then find the nearest +1-1 resolution df
     """
 
-    # Find the index of the nearest row to the target value
-    cdf = df.sort_values(by='resolution').reset_index()
-    # nearest_index = (cdf['qscore'] - new_entry['qscore']).abs().idxmin()
-    # nearest_index = cdf[cdf['id'] == new_entry['id']].index.to_list()[0]
-    # As the new entry added into the df, use all the 4 columns to identify the row index
-    mask = (cdf['id'] == new_entry['id']) & (cdf['resolution'] == new_entry['resolution']) & (
-                cdf['name'] == new_entry['name']) & (cdf[score_type] == new_entry[score_type])
-    nearest_index = cdf[mask].index
+    if new_entry['resolution']:
+        # Find the index of the nearest row to the target value
+        cdf = df.sort_values(by='resolution').reset_index()
+        # nearest_index = (cdf['qscore'] - new_entry['qscore']).abs().idxmin()
+        # nearest_index = cdf[cdf['id'] == new_entry['id']].index.to_list()[0]
+        # As the new entry added into the df, use all the 4 columns to identify the row index
+        mask = (cdf['id'] == new_entry['id']) & (cdf['resolution'] == new_entry['resolution']) & (
+                    cdf['name'] == new_entry['name']) & (cdf[score_type] == new_entry[score_type])
+        nearest_index = cdf[mask].index
+
+        # Get the 1000 rows centered around the nearest index
+        start = float(new_entry['resolution']) - resbin if float(new_entry['resolution']) >= resbin else 0.
+        end = float(new_entry['resolution']) + resbin
+        df_resbin = cdf[(cdf['resolution'] >= start) & (cdf['resolution'] <= end)]
 
-    # Get the 1000 rows centered around the nearest index
-    start = float(new_entry['resolution']) - resbin if float(new_entry['resolution']) >= resbin else 0.
-    end = float(new_entry['resolution']) + resbin
-    df_resbin = cdf[(cdf['resolution'] >= start) & (cdf['resolution'] <= end)]
-    print('shape')
-    print(df_resbin.shape)
-
-    return df_resbin
+        return df_resbin
+    else:
+        return None
 
 
 def plot_bar_mat(a, b, qmin, qmax, qscore, work_dir, plot_name, score_type):
     """
     This function here using matplotlib to produce the Q-score bar image
     """
 
-    a *= 1.5
-    b *= 1.5
-    a /= 200
-    b /= 200
+    a = a*1.5 if a else None
+    b = b*1.5 if b else None
+    a = a/200 if a else None
+    b = b/200 if b else None
     # Create a color scale from 0 to 1
     color_scale = np.linspace(0, 1, 199)
 
     # Create a figure and axis
     fig, ax = plt.subplots(figsize=(8, 2), dpi=300)
     plt.rcParams['font.family'] = 'Times New Roman'
 
@@ -254,18 +259,30 @@
     plt.close()
 
 
 def bar(new_entry_dict, score_type, work_dir, score_dir, plot_name):
     input_file = '{}/qscores.csv'.format(score_dir)
     print(input_file)
     # new_entry_dict = {'id': '8117', 'resolution': 2.95, 'name': '5irx.cif', 'qscore': 0.521}
-    df = load_score(input_file, new_entry_dict, score_type)
-    (qmin, qmax), original_value = get_score(df, new_entry_dict[score_type], score_type)
-    target_value = int(match_to_newscale((0, sum(original_value)), (0, 199), original_value[0]))
+    qmin = None
+    qmax = None
+    if score_type and new_entry_dict[score_type]:
+        df = load_score(input_file, new_entry_dict, score_type)
+        (qmin, qmax), original_value = get_score(df, new_entry_dict[score_type], score_type)
+        target_value = int(match_to_newscale((0, sum(original_value)), (0, 199), original_value[0]))
+        to_whole = round(target_value/200., 3)
+    else:
+        to_whole = None
 
     #df1000 = get_nearest_onethousand(new_entry_dict, df, 500, score_type)
-    df1000 = get_resolution_range(new_entry_dict, df, score_type)
-    (sqmin, sqmax), ovalue = get_score(df1000, new_entry_dict[score_type], score_type)
-    target_value_two = int(match_to_newscale((0, sum(ovalue)), (0, 199), ovalue[0]))
-    plot_bar_mat(target_value, target_value_two, qmin, qmax, new_entry_dict[score_type], work_dir, plot_name, score_type)
+    if new_entry_dict['resolution']:
+        df1000 = get_resolution_range(new_entry_dict, df, score_type)
+        (sqmin, sqmax), ovalue = get_score(df1000, new_entry_dict[score_type], score_type)
+        target_value_two = int(match_to_newscale((0, sum(ovalue)), (0, 199), ovalue[0]))
+        to_two = round(target_value_two/200., 3)
+    else:
+        to_two = None
+
+    if to_whole and to_two:
+        plot_bar_mat(to_whole, to_two, qmin, qmax, new_entry_dict[score_type], work_dir, plot_name, score_type)
 
-    return (round(target_value/200., 3), round(target_value_two/200., 3))
+    return to_whole, to_two
```

### Comparing `va-0.0.1.dev98/va/metrics/emringer.py` & `va-0.0.1.dev99/va/metrics/emringer.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/phaserandomization.py` & `va-0.0.1.dev99/va/metrics/phaserandomization.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/phenix_cc.py` & `va-0.0.1.dev99/va/metrics/phenix_cc.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/phenix_mm.py` & `va-0.0.1.dev99/va/metrics/phenix_mm.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/resmap.py` & `va-0.0.1.dev99/va/metrics/resmap.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/strudel.py` & `va-0.0.1.dev99/va/metrics/strudel.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/metrics/threedfsc.py` & `va-0.0.1.dev99/va/metrics/threedfsc.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/preparation.py` & `va-0.0.1.dev99/va/preparation.py`

 * *Files 1% similar despite different names*

```diff
@@ -974,28 +974,41 @@
             print('Map does not exist or corrupted.')
             sys.stderr.write('Error: {} \n'.format(sys.exc_info()[1]))
             print('------------------------------------')
             exit()
 
     def remove_lines_after_match(self, input_file, output_file, match_text):
         try:
-            with open(input_file, 'r') as input_file:
-                with open(output_file, 'w') as output_file:
-                    found_match = False
-
-                    for line in input_file:
-                        if match_text in line:
-                            found_match = True
+            with open(input_file, 'r') as infile:
+                found_second_match = False
+                match_count = 0
+                content_before_second_match = []
+
+                for line in infile:
+                    if line.startswith(match_text):
+                        match_count += 1
+                        if match_count >= 2:
+                            found_second_match = True
+                            break
+                    content_before_second_match.append(line)
+
+            if found_second_match:
+                with open(output_file, 'w') as outfile:
+                    outfile.writelines(content_before_second_match)
+                return True
+            else:
+                print('Second match not found in the file.')
+                return False
 
-                        if not found_match:
-                            output_file.write(line)
         except FileNotFoundError:
-            print('Input file not found.')
+            print(f'Error: Input file "{input_file}" not found.')
+            return False
         except Exception as e:
             print(f'An error occurred: {str(e)}')
+            return False
 
     def hasdisorder_atom(self, structure):
 
         ress = structure.get_residues()
         disorder_flag = False
         for res in ress:
             if res.is_disordered() == 1:
@@ -1014,19 +1027,19 @@
 
         p = MMCIFParser()
         io = MMCIFIO()
         orgfilename = curmodelname
         # structure = p.get_structure(pid, curmodelname)
 
         # multiple data block
-        cur_model = open(curmodelname)
-        match_text = 'data_comp_'
-        if match_text in cur_model.read():
-            out_moderate_cif = curmodelname + '_moderated.cif'
-            self.remove_lines_after_match(curmodelname, out_moderate_cif, match_text)
+        # cur_model = open(curmodelname)
+        match_text = 'data_'
+        out_moderate_cif = curmodelname + '_moderated.cif'
+        match = self.remove_lines_after_match(curmodelname, out_moderate_cif, match_text)
+        if match:
             structure = p.get_structure(pid, out_moderate_cif)
             curmodelname = out_moderate_cif
         else:
             structure = p.get_structure(pid, curmodelname)
 
         if len(structure.get_list()) > 1:
             orgmodel = curmodelname + '_org.cif'
```

### Comparing `va-0.0.1.dev98/va/qscores.csv` & `va-0.0.1.dev99/va/qscores.csv`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/utils/misc.py` & `va-0.0.1.dev99/va/utils/misc.py`

 * *Files 20% similar despite different names*

```diff
@@ -180,7 +180,44 @@
     """
 
     numlist = [-1 if i < 0 else i for i in numlist]
     rgbs = [[122, int(num * 255), int(num * 255)] if num >= 0 else [255, 0, 255] for num in numlist]
     resultlist = ['#%02X%02X%02X' % (rgb[0], rgb[1], rgb[2]) for rgb in rgbs]
 
     return resultlist
+
+
+def check_same_keys(dict1, dict2):
+    """
+    check if two dictionaries have the same keys at all levels
+    dict1: A dictionary
+    dict2: A dictionary
+    return True if all keys are same, else False
+    """
+
+    # Base case: if one of the inputs is not a dictionary, return False
+    if not isinstance(dict1, dict) or not isinstance(dict2, dict):
+        return False
+
+    # Get the keys of both dictionaries
+    keys1 = set(dict1.keys())
+    keys2 = set(dict2.keys())
+
+    # Check if the keys are different
+    if keys1 != keys2:
+        return False
+
+    # Recursively compare keys in nested dictionaries
+    for key in keys1:
+        if isinstance(dict1[key], dict) and isinstance(dict2[key], dict):
+            # If both values are dictionaries, recursively compare their keys
+            if not check_same_keys(dict1[key], dict2[key]):
+                return False
+        else:
+            # If one of the values is not a dictionary, don't compare the values
+            if not isinstance(dict1[key], dict) and not isinstance(dict2[key], dict):
+                continue
+            else:
+                return False  # If one value is a dictionary and the other is not, return False
+
+    # If all comparisons pass, return True
+    return True
```

### Comparing `va-0.0.1.dev98/va/utils/stars.py` & `va-0.0.1.dev99/va/utils/stars.py`

 * *Files identical despite different names*

### Comparing `va-0.0.1.dev98/va/validationanalysis.py` & `va-0.0.1.dev99/va/validationanalysis.py`

 * *Files 0% similar despite different names*

```diff
@@ -5849,15684 +5849,15618 @@
 00016d80: 696d 6572 2829 0a20 2020 2020 2020 2065  imer().        e
 00016d90: 7272 6c69 7374 203d 205b 5d0a 2020 2020  rrlist = [].    
 00016da0: 2020 2020 616c 6c6d 6173 6b64 6963 7420      allmaskdict 
 00016db0: 3d20 6469 6374 2829 0a0a 2020 2020 2020  = dict()..      
 00016dc0: 2020 7265 6164 6d61 736b 732c 2065 7272    readmasks, err
 00016dd0: 6672 6f6d 6c6f 6164 203d 2073 656c 662e  fromload = self.
 00016de0: 7265 6164 6d61 736b 7328 290a 2020 2020  readmasks().    
-00016df0: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
-00016e00: 6e64 2865 7272 6672 6f6d 6c6f 6164 290a  nd(errfromload).
-00016e10: 0a20 2020 2020 2020 2066 6f72 2028 6b65  .        for (ke
-00016e20: 792c 206d 6170 2920 696e 2069 7465 7269  y, map) in iteri
-00016e30: 7465 6d73 2872 6561 646d 6173 6b73 293a  tems(readmasks):
-00016e40: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00016e50: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-00016e60: 6173 656e 616d 6528 6d61 702e 6675 6c6c  asename(map.full
-00016e70: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-00016e80: 2020 6d61 705f 7a73 697a 6520 3d20 6d61    map_zsize = ma
-00016e90: 702e 6865 6164 6572 2e6e 7a0a 2020 2020  p.header.nz.    
-00016ea0: 2020 2020 2020 2020 6d61 705f 7973 697a          map_ysiz
-00016eb0: 6520 3d20 6d61 702e 6865 6164 6572 2e6e  e = map.header.n
-00016ec0: 790a 2020 2020 2020 2020 2020 2020 6d61  y.            ma
-00016ed0: 705f 7873 697a 6520 3d20 6d61 702e 6865  p_xsize = map.he
-00016ee0: 6164 6572 2e6e 780a 2020 2020 2020 2020  ader.nx.        
-00016ef0: 2020 2020 786d 6964 203d 2069 6e74 2866      xmid = int(f
-00016f00: 6c6f 6174 286d 6170 5f78 7369 7a65 2920  loat(map_xsize) 
-00016f10: 2f20 3229 0a20 2020 2020 2020 2020 2020  / 2).           
-00016f20: 2079 6d69 6420 3d20 696e 7428 666c 6f61   ymid = int(floa
-00016f30: 7428 6d61 705f 7973 697a 6529 202f 2032  t(map_ysize) / 2
-00016f40: 290a 2020 2020 2020 2020 2020 2020 7a6d  ).            zm
-00016f50: 6964 203d 2069 6e74 2866 6c6f 6174 286d  id = int(float(m
-00016f60: 6170 5f7a 7369 7a65 2920 2f20 3229 0a0a  ap_zsize) / 2)..
-00016f70: 2020 2020 2020 2020 2020 2020 2320 7863              # xc
-00016f80: 656e 7472 616c 203d 206d 6170 2e66 756c  entral = map.ful
-00016f90: 6c4d 6170 5b3a 2c20 3a2c 2078 6d69 645d  lMap[:, :, xmid]
-00016fa0: 0a20 2020 2020 2020 2020 2020 2078 6365  .            xce
-00016fb0: 6e74 7261 6c20 3d20 6d61 702e 6461 7461  ntral = map.data
-00016fc0: 5b3a 2c20 3a2c 2078 6d69 645d 0a20 2020  [:, :, xmid].   
-00016fd0: 2020 2020 2020 2020 2078 6465 6e6f 6d20           xdenom 
-00016fe0: 3d20 2878 6365 6e74 7261 6c2e 6d61 7828  = (xcentral.max(
-00016ff0: 2920 2d20 7863 656e 7472 616c 2e6d 696e  ) - xcentral.min
-00017000: 2829 2920 6966 2078 6365 6e74 7261 6c2e  ()) if xcentral.
-00017010: 6d61 7828 2920 213d 2078 6365 6e74 7261  max() != xcentra
-00017020: 6c2e 6d69 6e28 2920 656c 7365 2031 0a20  l.min() else 1. 
-00017030: 2020 2020 2020 2020 2020 2078 7265 7363             xresc
-00017040: 616c 6564 203d 2028 2828 7863 656e 7472  aled = (((xcentr
-00017050: 616c 202d 2078 6365 6e74 7261 6c2e 6d69  al - xcentral.mi
-00017060: 6e28 2929 202a 2032 3535 2e30 2920 2f20  n()) * 255.0) / 
-00017070: 7864 656e 6f6d 292e 6173 7479 7065 2827  xdenom).astype('
-00017080: 7569 6e74 3827 290a 2020 2020 2020 2020  uint8').        
-00017090: 2020 2020 7866 6c69 7070 6564 203d 206e      xflipped = n
-000170a0: 702e 666c 6970 7564 2878 7265 7363 616c  p.flipud(xrescal
-000170b0: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
-000170c0: 7869 6d67 203d 2049 6d61 6765 2e66 726f  ximg = Image.fro
-000170d0: 6d61 7272 6179 2878 666c 6970 7065 6429  marray(xflipped)
-000170e0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-000170f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017100: 2020 7869 6d67 2e73 6176 6528 7365 6c66    ximg.save(self
-00017110: 2e77 6f72 6b64 6972 202b 206d 6170 6e61  .workdir + mapna
-00017120: 6d65 202b 2027 5f78 6d61 736b 6365 6e74  me + '_xmaskcent
-00017130: 7261 6c5f 736c 6963 652e 6a70 6567 2729  ral_slice.jpeg')
-00017140: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00017150: 6570 7420 494f 4572 726f 7220 6173 2069  ept IOError as i
-00017160: 6f65 7272 3a0a 2020 2020 2020 2020 2020  oerr:.          
-00017170: 2020 2020 2020 7865 7272 203d 2027 5361        xerr = 'Sa
-00017180: 7669 6e67 206f 7269 6769 6e61 6c20 7820  ving original x 
-00017190: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-000171a0: 206d 6173 6b20 6572 723a 7b7d 272e 666f   mask err:{}'.fo
-000171b0: 726d 6174 2869 6f65 7272 290a 2020 2020  rmat(ioerr).    
-000171c0: 2020 2020 2020 2020 2020 2020 6572 726c              errl
-000171d0: 6973 742e 6170 7065 6e64 2878 6572 7229  ist.append(xerr)
-000171e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000171f0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-00017200: 6528 7865 7272 202b 2027 5c6e 2729 0a0a  e(xerr + '\n')..
-00017210: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-00017220: 682c 2068 6569 6768 7420 3d20 7869 6d67  h, height = ximg
-00017230: 2e73 697a 650a 2020 2020 2020 2020 2020  .size.          
-00017240: 2020 7873 6361 6c65 6e61 6d65 203d 2073    xscalename = s
-00017250: 656c 662e 776f 726b 6469 7220 2b20 6d61  elf.workdir + ma
-00017260: 706e 616d 6520 2b20 275f 7363 616c 6564  pname + '_scaled
-00017270: 5f78 6d61 736b 6365 6e74 7261 6c5f 736c  _xmaskcentral_sl
-00017280: 6963 652e 6a70 6567 270a 0a20 2020 2020  ice.jpeg'..     
-00017290: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000172a0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-000172b0: 6964 7468 203e 2033 3030 2061 6e64 2068  idth > 300 and h
-000172c0: 6569 6768 7420 3e20 3330 303a 0a20 2020  eight > 300:.   
-000172d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172e0: 2069 6620 7769 6474 6820 3e3d 2068 6569   if width >= hei
-000172f0: 6768 743a 0a20 2020 2020 2020 2020 2020  ght:.           
-00017300: 2020 2020 2020 2020 2020 2020 206c 6172               lar
-00017310: 6765 7273 6361 6c65 7220 3d20 3330 302e  gerscaler = 300.
-00017320: 202f 2077 6964 7468 0a20 2020 2020 2020   / width.       
-00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017340: 206e 6577 6865 6967 6874 203d 2069 6e74   newheight = int
-00017350: 2863 6569 6c28 6c61 7267 6572 7363 616c  (ceil(largerscal
-00017360: 6572 202a 2068 6569 6768 7429 290a 2020  er * height)).  
-00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017380: 2020 2020 2020 696d 7820 3d20 496d 6167        imx = Imag
-00017390: 652e 6672 6f6d 6172 7261 7928 7866 6c69  e.fromarray(xfli
-000173a0: 7070 6564 292e 7265 7369 7a65 2828 3330  pped).resize((30
-000173b0: 302c 206e 6577 6865 6967 6874 292c 2049  0, newheight), I
-000173c0: 6d61 6765 2e41 4e54 4941 4c49 4153 290a  mage.ANTIALIAS).
-000173d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173e0: 2020 2020 2020 2020 696d 782e 7361 7665          imx.save
-000173f0: 2878 7363 616c 656e 616d 6529 0a20 2020  (xscalename).   
-00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017410: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00017420: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017430: 6172 6765 7273 6361 6c65 7220 3d20 3330  argerscaler = 30
-00017440: 302e 202f 2068 6569 6768 740a 2020 2020  0. / height.    
-00017450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017460: 2020 2020 6e65 7777 6964 7468 203d 2069      newwidth = i
-00017470: 6e74 2863 6569 6c28 6c61 7267 6572 7363  nt(ceil(largersc
-00017480: 616c 6572 202a 2077 6964 7468 2929 0a20  aler * width)). 
-00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174a0: 2020 2020 2020 2069 6d78 203d 2049 6d61         imx = Ima
-000174b0: 6765 2e66 726f 6d61 7272 6179 2878 666c  ge.fromarray(xfl
-000174c0: 6970 7065 6429 2e72 6573 697a 6528 286e  ipped).resize((n
-000174d0: 6577 7769 6474 682c 2033 3030 292c 2049  ewwidth, 300), I
-000174e0: 6d61 6765 2e41 4e54 4941 4c49 4153 290a  mage.ANTIALIAS).
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 2020 2020 2020 2020 696d 782e 7361 7665          imx.save
-00017510: 2878 7363 616c 656e 616d 6529 0a20 2020  (xscalename).   
+00016df0: 2020 2020 6966 2065 7272 6672 6f6d 6c6f      if errfromlo
+00016e00: 6164 3a0a 2020 2020 2020 2020 2020 2020  ad:.            
+00016e10: 6572 726c 6973 742e 6170 7065 6e64 2865  errlist.append(e
+00016e20: 7272 6672 6f6d 6c6f 6164 290a 0a20 2020  rrfromload)..   
+00016e30: 2020 2020 2066 6f72 2028 6b65 792c 206d       for (key, m
+00016e40: 6170 2920 696e 2069 7465 7269 7465 6d73  ap) in iteritems
+00016e50: 2872 6561 646d 6173 6b73 293a 0a20 2020  (readmasks):.   
+00016e60: 2020 2020 2020 2020 206d 6170 6e61 6d65           mapname
+00016e70: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00016e80: 616d 6528 6d61 702e 6675 6c6c 6e61 6d65  ame(map.fullname
+00016e90: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00016ea0: 705f 7a73 697a 6520 3d20 6d61 702e 6865  p_zsize = map.he
+00016eb0: 6164 6572 2e6e 7a0a 2020 2020 2020 2020  ader.nz.        
+00016ec0: 2020 2020 6d61 705f 7973 697a 6520 3d20      map_ysize = 
+00016ed0: 6d61 702e 6865 6164 6572 2e6e 790a 2020  map.header.ny.  
+00016ee0: 2020 2020 2020 2020 2020 6d61 705f 7873            map_xs
+00016ef0: 697a 6520 3d20 6d61 702e 6865 6164 6572  ize = map.header
+00016f00: 2e6e 780a 2020 2020 2020 2020 2020 2020  .nx.            
+00016f10: 786d 6964 203d 2069 6e74 2866 6c6f 6174  xmid = int(float
+00016f20: 286d 6170 5f78 7369 7a65 2920 2f20 3229  (map_xsize) / 2)
+00016f30: 0a20 2020 2020 2020 2020 2020 2079 6d69  .            ymi
+00016f40: 6420 3d20 696e 7428 666c 6f61 7428 6d61  d = int(float(ma
+00016f50: 705f 7973 697a 6529 202f 2032 290a 2020  p_ysize) / 2).  
+00016f60: 2020 2020 2020 2020 2020 7a6d 6964 203d            zmid =
+00016f70: 2069 6e74 2866 6c6f 6174 286d 6170 5f7a   int(float(map_z
+00016f80: 7369 7a65 2920 2f20 3229 0a0a 2020 2020  size) / 2)..    
+00016f90: 2020 2020 2020 2020 2320 7863 656e 7472          # xcentr
+00016fa0: 616c 203d 206d 6170 2e66 756c 6c4d 6170  al = map.fullMap
+00016fb0: 5b3a 2c20 3a2c 2078 6d69 645d 0a20 2020  [:, :, xmid].   
+00016fc0: 2020 2020 2020 2020 2078 6365 6e74 7261           xcentra
+00016fd0: 6c20 3d20 6d61 702e 6461 7461 5b3a 2c20  l = map.data[:, 
+00016fe0: 3a2c 2078 6d69 645d 0a20 2020 2020 2020  :, xmid].       
+00016ff0: 2020 2020 2078 6465 6e6f 6d20 3d20 2878       xdenom = (x
+00017000: 6365 6e74 7261 6c2e 6d61 7828 2920 2d20  central.max() - 
+00017010: 7863 656e 7472 616c 2e6d 696e 2829 2920  xcentral.min()) 
+00017020: 6966 2078 6365 6e74 7261 6c2e 6d61 7828  if xcentral.max(
+00017030: 2920 213d 2078 6365 6e74 7261 6c2e 6d69  ) != xcentral.mi
+00017040: 6e28 2920 656c 7365 2031 0a20 2020 2020  n() else 1.     
+00017050: 2020 2020 2020 2078 7265 7363 616c 6564         xrescaled
+00017060: 203d 2028 2828 7863 656e 7472 616c 202d   = (((xcentral -
+00017070: 2078 6365 6e74 7261 6c2e 6d69 6e28 2929   xcentral.min())
+00017080: 202a 2032 3535 2e30 2920 2f20 7864 656e   * 255.0) / xden
+00017090: 6f6d 292e 6173 7479 7065 2827 7569 6e74  om).astype('uint
+000170a0: 3827 290a 2020 2020 2020 2020 2020 2020  8').            
+000170b0: 7866 6c69 7070 6564 203d 206e 702e 666c  xflipped = np.fl
+000170c0: 6970 7564 2878 7265 7363 616c 6564 290a  ipud(xrescaled).
+000170d0: 2020 2020 2020 2020 2020 2020 7869 6d67              ximg
+000170e0: 203d 2049 6d61 6765 2e66 726f 6d61 7272   = Image.fromarr
+000170f0: 6179 2878 666c 6970 7065 6429 0a20 2020  ay(xflipped).   
+00017100: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00017110: 2020 2020 2020 2020 2020 2020 2020 7869                xi
+00017120: 6d67 2e73 6176 6528 7365 6c66 2e77 6f72  mg.save(self.wor
+00017130: 6b64 6972 202b 206d 6170 6e61 6d65 202b  kdir + mapname +
+00017140: 2027 5f78 6d61 736b 6365 6e74 7261 6c5f   '_xmaskcentral_
+00017150: 736c 6963 652e 6a70 6567 2729 0a20 2020  slice.jpeg').   
+00017160: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00017170: 494f 4572 726f 7220 6173 2069 6f65 7272  IOError as ioerr
+00017180: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017190: 2020 7865 7272 203d 2027 5361 7669 6e67    xerr = 'Saving
+000171a0: 206f 7269 6769 6e61 6c20 7820 6365 6e74   original x cent
+000171b0: 7261 6c20 736c 6963 6520 6f66 206d 6173  ral slice of mas
+000171c0: 6b20 6572 723a 7b7d 272e 666f 726d 6174  k err:{}'.format
+000171d0: 2869 6f65 7272 290a 2020 2020 2020 2020  (ioerr).        
+000171e0: 2020 2020 2020 2020 6572 726c 6973 742e          errlist.
+000171f0: 6170 7065 6e64 2878 6572 7229 0a20 2020  append(xerr).   
+00017200: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00017210: 2e73 7464 6572 722e 7772 6974 6528 7865  .stderr.write(xe
+00017220: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
+00017230: 2020 2020 2020 2020 7769 6474 682c 2068          width, h
+00017240: 6569 6768 7420 3d20 7869 6d67 2e73 697a  eight = ximg.siz
+00017250: 650a 2020 2020 2020 2020 2020 2020 7873  e.            xs
+00017260: 6361 6c65 6e61 6d65 203d 2073 656c 662e  calename = self.
+00017270: 776f 726b 6469 7220 2b20 6d61 706e 616d  workdir + mapnam
+00017280: 6520 2b20 275f 7363 616c 6564 5f78 6d61  e + '_scaled_xma
+00017290: 736b 6365 6e74 7261 6c5f 736c 6963 652e  skcentral_slice.
+000172a0: 6a70 6567 270a 0a20 2020 2020 2020 2020  jpeg'..         
+000172b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+000172c0: 2020 2020 2020 2020 6966 2077 6964 7468          if width
+000172d0: 203e 2033 3030 2061 6e64 2068 6569 6768   > 300 and heigh
+000172e0: 7420 3e20 3330 303a 0a20 2020 2020 2020  t > 300:.       
+000172f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017300: 7769 6474 6820 3e3d 2068 6569 6768 743a  width >= height:
+00017310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017320: 2020 2020 2020 2020 206c 6172 6765 7273           largers
+00017330: 6361 6c65 7220 3d20 3330 302e 202f 2077  caler = 300. / w
+00017340: 6964 7468 0a20 2020 2020 2020 2020 2020  idth.           
+00017350: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00017360: 6865 6967 6874 203d 2069 6e74 2863 6569  height = int(cei
+00017370: 6c28 6c61 7267 6572 7363 616c 6572 202a  l(largerscaler *
+00017380: 2068 6569 6768 7429 290a 2020 2020 2020   height)).      
+00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173a0: 2020 696d 7820 3d20 496d 6167 652e 6672    imx = Image.fr
+000173b0: 6f6d 6172 7261 7928 7866 6c69 7070 6564  omarray(xflipped
+000173c0: 292e 7265 7369 7a65 2828 3330 302c 206e  ).resize((300, n
+000173d0: 6577 6865 6967 6874 292c 2049 6d61 6765  ewheight), Image
+000173e0: 2e52 6573 616d 706c 696e 672e 4c41 4e43  .Resampling.LANC
+000173f0: 5a4f 5329 0a20 2020 2020 2020 2020 2020  ZOS).           
+00017400: 2020 2020 2020 2020 2020 2020 2069 6d78               imx
+00017410: 2e73 6176 6528 7873 6361 6c65 6e61 6d65  .save(xscalename
+00017420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017430: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017450: 2020 2020 6c61 7267 6572 7363 616c 6572      largerscaler
+00017460: 203d 2033 3030 2e20 2f20 6865 6967 6874   = 300. / height
+00017470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017480: 2020 2020 2020 2020 206e 6577 7769 6474           newwidt
+00017490: 6820 3d20 696e 7428 6365 696c 286c 6172  h = int(ceil(lar
+000174a0: 6765 7273 6361 6c65 7220 2a20 7769 6474  gerscaler * widt
+000174b0: 6829 290a 2020 2020 2020 2020 2020 2020  h)).            
+000174c0: 2020 2020 2020 2020 2020 2020 696d 7820              imx 
+000174d0: 3d20 496d 6167 652e 6672 6f6d 6172 7261  = Image.fromarra
+000174e0: 7928 7866 6c69 7070 6564 292e 7265 7369  y(xflipped).resi
+000174f0: 7a65 2828 6e65 7777 6964 7468 2c20 3330  ze((newwidth, 30
+00017500: 3029 2c20 496d 6167 652e 5265 7361 6d70  0), Image.Resamp
+00017510: 6c69 6e67 2e4c 414e 435a 4f53 290a 2020  ling.LANCZOS).  
 00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017530: 2023 2069 6d78 203d 2049 6d61 6765 2e66   # imx = Image.f
-00017540: 726f 6d61 7272 6179 2878 666c 6970 7065  romarray(xflippe
-00017550: 6429 2e72 6573 697a 6528 2833 3030 2c33  d).resize((300,3
-00017560: 3030 2929 0a20 2020 2020 2020 2020 2020  00)).           
-00017570: 2020 2020 2020 2020 2023 2069 6d78 2e73           # imx.s
-00017580: 6176 6528 7873 6361 6c65 6e61 6d65 290a  ave(xscalename).
-00017590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000175b0: 2020 2020 2020 2020 2020 6966 2077 6964            if wid
-000175c0: 7468 203e 3d20 6865 6967 6874 3a0a 2020  th >= height:.  
-000175d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175e0: 2020 2020 2020 7363 616c 6572 203d 2033        scaler = 3
-000175f0: 3030 2e20 2f20 7769 6474 680a 2020 2020  00. / width.    
+00017530: 2020 2020 2020 696d 782e 7361 7665 2878        imx.save(x
+00017540: 7363 616c 656e 616d 6529 0a20 2020 2020  scalename).     
+00017550: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00017560: 2069 6d78 203d 2049 6d61 6765 2e66 726f   imx = Image.fro
+00017570: 6d61 7272 6179 2878 666c 6970 7065 6429  marray(xflipped)
+00017580: 2e72 6573 697a 6528 2833 3030 2c33 3030  .resize((300,300
+00017590: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000175a0: 2020 2020 2020 2023 2069 6d78 2e73 6176         # imx.sav
+000175b0: 6528 7873 6361 6c65 6e61 6d65 290a 2020  e(xscalename).  
+000175c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000175d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000175e0: 2020 2020 2020 2020 6966 2077 6964 7468          if width
+000175f0: 203e 3d20 6865 6967 6874 3a0a 2020 2020   >= height:.    
 00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017610: 2020 2020 6e65 7768 6569 6768 7420 3d20      newheight = 
-00017620: 696e 7428 6365 696c 2873 6361 6c65 7220  int(ceil(scaler 
-00017630: 2a20 6865 6967 6874 2929 0a20 2020 2020  * height)).     
-00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017650: 2020 2069 6d78 203d 2049 6d61 6765 2e66     imx = Image.f
-00017660: 726f 6d61 7272 6179 2878 666c 6970 7065  romarray(xflippe
-00017670: 6429 2e72 6573 697a 6528 2833 3030 2c20  d).resize((300, 
-00017680: 6e65 7768 6569 6768 7429 2c20 496d 6167  newheight), Imag
-00017690: 652e 414e 5449 414c 4941 5329 0a20 2020  e.ANTIALIAS).   
-000176a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176b0: 2020 2020 2069 6d78 2e73 6176 6528 7873       imx.save(xs
-000176c0: 6361 6c65 6e61 6d65 290a 2020 2020 2020  calename).      
-000176d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000176e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000176f0: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-00017700: 6572 203d 2033 3030 2e20 2f20 6865 6967  er = 300. / heig
-00017710: 6874 0a20 2020 2020 2020 2020 2020 2020  ht.             
-00017720: 2020 2020 2020 2020 2020 206e 6577 7769             newwi
-00017730: 6474 6820 3d20 696e 7428 6365 696c 2873  dth = int(ceil(s
-00017740: 6361 6c65 7220 2a20 7769 6474 6829 290a  caler * width)).
+00017610: 2020 2020 7363 616c 6572 203d 2033 3030      scaler = 300
+00017620: 2e20 2f20 7769 6474 680a 2020 2020 2020  . / width.      
+00017630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017640: 2020 6e65 7768 6569 6768 7420 3d20 696e    newheight = in
+00017650: 7428 6365 696c 2873 6361 6c65 7220 2a20  t(ceil(scaler * 
+00017660: 6865 6967 6874 2929 0a20 2020 2020 2020  height)).       
+00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017680: 2069 6d78 203d 2049 6d61 6765 2e66 726f   imx = Image.fro
+00017690: 6d61 7272 6179 2878 666c 6970 7065 6429  marray(xflipped)
+000176a0: 2e72 6573 697a 6528 2833 3030 2c20 6e65  .resize((300, ne
+000176b0: 7768 6569 6768 7429 2c20 496d 6167 652e  wheight), Image.
+000176c0: 5265 7361 6d70 6c69 6e67 2e4c 414e 435a  Resampling.LANCZ
+000176d0: 4f53 290a 2020 2020 2020 2020 2020 2020  OS).            
+000176e0: 2020 2020 2020 2020 2020 2020 696d 782e              imx.
+000176f0: 7361 7665 2878 7363 616c 656e 616d 6529  save(xscalename)
+00017700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017710: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00017720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017730: 2020 2073 6361 6c65 7220 3d20 3330 302e     scaler = 300.
+00017740: 202f 2068 6569 6768 740a 2020 2020 2020   / height.      
 00017750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017760: 2020 2020 2020 2020 696d 7820 3d20 496d          imx = Im
-00017770: 6167 652e 6672 6f6d 6172 7261 7928 7866  age.fromarray(xf
-00017780: 6c69 7070 6564 292e 7265 7369 7a65 2828  lipped).resize((
-00017790: 6e65 7777 6964 7468 2c20 3330 3029 2c20  newwidth, 300), 
-000177a0: 496d 6167 652e 414e 5449 414c 4941 5329  Image.ANTIALIAS)
-000177b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000177c0: 2020 2020 2020 2020 2069 6d78 2e73 6176           imx.sav
-000177d0: 6528 7873 6361 6c65 6e61 6d65 290a 2020  e(xscalename).  
-000177e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000177f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017800: 2020 7865 7272 203d 2027 5361 7669 6e67    xerr = 'Saving
-00017810: 2073 6361 6c65 6420 7820 6365 6e74 7261   scaled x centra
-00017820: 6c20 736c 6963 6520 6f66 206d 6173 6b20  l slice of mask 
-00017830: 6572 723a 7b7d 272e 666f 726d 6174 2873  err:{}'.format(s
-00017840: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
-00017850: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00017860: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-00017870: 2878 6572 7229 0a20 2020 2020 2020 2020  (xerr).         
-00017880: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-00017890: 722e 7772 6974 6528 7865 7272 202b 2027  r.write(xerr + '
-000178a0: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
-000178b0: 2020 2320 7963 656e 7472 616c 203d 206d    # ycentral = m
-000178c0: 6170 2e66 756c 6c4d 6170 5b3a 2c20 796d  ap.fullMap[:, ym
-000178d0: 6964 2c20 3a5d 0a20 2020 2020 2020 2020  id, :].         
-000178e0: 2020 2079 6365 6e74 7261 6c20 3d20 6d61     ycentral = ma
-000178f0: 702e 6461 7461 5b3a 2c20 796d 6964 2c20  p.data[:, ymid, 
-00017900: 3a5d 0a20 2020 2020 2020 2020 2020 2079  :].            y
-00017910: 6465 6e6f 6d20 3d20 2879 6365 6e74 7261  denom = (ycentra
-00017920: 6c2e 6d61 7828 2920 2d20 7963 656e 7472  l.max() - ycentr
-00017930: 616c 2e6d 696e 2829 2920 6966 2079 6365  al.min()) if yce
-00017940: 6e74 7261 6c2e 6d61 7828 2920 213d 2079  ntral.max() != y
-00017950: 6365 6e74 7261 6c2e 6d69 6e28 2920 656c  central.min() el
-00017960: 7365 2031 0a20 2020 2020 2020 2020 2020  se 1.           
-00017970: 2079 7265 7363 616c 6564 203d 2028 2828   yrescaled = (((
-00017980: 7963 656e 7472 616c 202d 2079 6365 6e74  ycentral - ycent
-00017990: 7261 6c2e 6d69 6e28 2929 202a 2032 3535  ral.min()) * 255
-000179a0: 2e30 2920 2f20 7964 656e 6f6d 292e 6173  .0) / ydenom).as
-000179b0: 7479 7065 2827 7569 6e74 3827 290a 2020  type('uint8').  
-000179c0: 2020 2020 2020 2020 2020 7972 6f74 6174            yrotat
-000179d0: 6520 3d20 6e70 2e72 6f74 3930 2879 7265  e = np.rot90(yre
-000179e0: 7363 616c 6564 290a 2020 2020 2020 2020  scaled).        
-000179f0: 2020 2020 7969 6d67 203d 2049 6d61 6765      yimg = Image
-00017a00: 2e66 726f 6d61 7272 6179 2879 726f 7461  .fromarray(yrota
-00017a10: 7465 290a 2020 2020 2020 2020 2020 2020  te).            
-00017a20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00017a30: 2020 2020 2079 696d 672e 7361 7665 2873       yimg.save(s
-00017a40: 656c 662e 776f 726b 6469 7220 2b20 6d61  elf.workdir + ma
-00017a50: 706e 616d 6520 2b20 275f 796d 6173 6b63  pname + '_ymaskc
-00017a60: 656e 7472 616c 5f73 6c69 6365 2e6a 7065  entral_slice.jpe
-00017a70: 6727 290a 2020 2020 2020 2020 2020 2020  g').            
-00017a80: 6578 6365 7074 2049 4f45 7272 6f72 2061  except IOError a
-00017a90: 7320 696f 6572 723a 0a20 2020 2020 2020  s ioerr:.       
-00017aa0: 2020 2020 2020 2020 2079 6572 7220 3d20           yerr = 
-00017ab0: 2753 6176 696e 6720 6f72 6967 696e 616c  'Saving original
-00017ac0: 2079 2063 656e 7472 616c 2073 6c69 6365   y central slice
-00017ad0: 206f 6620 6d61 736b 2065 7272 3a7b 7d27   of mask err:{}'
-00017ae0: 2e66 6f72 6d61 7428 696f 6572 7229 0a20  .format(ioerr). 
-00017af0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00017b00: 7272 6c69 7374 2e61 7070 656e 6428 7965  rrlist.append(ye
-00017b10: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
-00017b20: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00017b30: 7269 7465 2879 6572 7220 2b20 275c 6e27  rite(yerr + '\n'
-00017b40: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00017b50: 6964 7468 2c20 6865 6967 6874 203d 2079  idth, height = y
-00017b60: 696d 672e 7369 7a65 0a20 2020 2020 2020  img.size.       
-00017b70: 2020 2020 2079 7363 616c 656e 616d 6520       yscalename 
-00017b80: 3d20 7365 6c66 2e77 6f72 6b64 6972 202b  = self.workdir +
-00017b90: 206d 6170 6e61 6d65 202b 2027 5f73 6361   mapname + '_sca
-00017ba0: 6c65 645f 796d 6173 6b63 656e 7472 616c  led_ymaskcentral
-00017bb0: 5f73 6c69 6365 2e6a 7065 6727 0a20 2020  _slice.jpeg'.   
-00017bc0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00017bd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00017be0: 2077 6964 7468 203e 2033 3030 2061 6e64   width > 300 and
-00017bf0: 2068 6569 6768 7420 3e20 3330 303a 0a20   height > 300:. 
-00017c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c10: 2020 2069 6620 7769 6474 6820 3e3d 2068     if width >= h
-00017c20: 6569 6768 743a 0a20 2020 2020 2020 2020  eight:.         
-00017c30: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017c40: 6172 6765 7273 6361 6c65 7220 3d20 3330  argerscaler = 30
-00017c50: 302e 202f 2077 6964 7468 0a20 2020 2020  0. / width.     
-00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2020 206e 6577 6865 6967 6874 203d 2069     newheight = i
-00017c80: 6e74 2863 6569 6c28 6c61 7267 6572 7363  nt(ceil(largersc
-00017c90: 616c 6572 202a 2068 6569 6768 7429 290a  aler * height)).
+00017760: 2020 6e65 7777 6964 7468 203d 2069 6e74    newwidth = int
+00017770: 2863 6569 6c28 7363 616c 6572 202a 2077  (ceil(scaler * w
+00017780: 6964 7468 2929 0a20 2020 2020 2020 2020  idth)).         
+00017790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000177a0: 6d78 203d 2049 6d61 6765 2e66 726f 6d61  mx = Image.froma
+000177b0: 7272 6179 2878 666c 6970 7065 6429 2e72  rray(xflipped).r
+000177c0: 6573 697a 6528 286e 6577 7769 6474 682c  esize((newwidth,
+000177d0: 2033 3030 292c 2049 6d61 6765 2e52 6573   300), Image.Res
+000177e0: 616d 706c 696e 672e 4c41 4e43 5a4f 5329  ampling.LANCZOS)
+000177f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017800: 2020 2020 2020 2020 2069 6d78 2e73 6176           imx.sav
+00017810: 6528 7873 6361 6c65 6e61 6d65 290a 2020  e(xscalename).  
+00017820: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00017830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017840: 2020 7865 7272 203d 2027 5361 7669 6e67    xerr = 'Saving
+00017850: 2073 6361 6c65 6420 7820 6365 6e74 7261   scaled x centra
+00017860: 6c20 736c 6963 6520 6f66 206d 6173 6b20  l slice of mask 
+00017870: 6572 723a 7b7d 272e 666f 726d 6174 2873  err:{}'.format(s
+00017880: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+00017890: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000178a0: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
+000178b0: 2878 6572 7229 0a20 2020 2020 2020 2020  (xerr).         
+000178c0: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
+000178d0: 722e 7772 6974 6528 7865 7272 202b 2027  r.write(xerr + '
+000178e0: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
+000178f0: 2020 2320 7963 656e 7472 616c 203d 206d    # ycentral = m
+00017900: 6170 2e66 756c 6c4d 6170 5b3a 2c20 796d  ap.fullMap[:, ym
+00017910: 6964 2c20 3a5d 0a20 2020 2020 2020 2020  id, :].         
+00017920: 2020 2079 6365 6e74 7261 6c20 3d20 6d61     ycentral = ma
+00017930: 702e 6461 7461 5b3a 2c20 796d 6964 2c20  p.data[:, ymid, 
+00017940: 3a5d 0a20 2020 2020 2020 2020 2020 2079  :].            y
+00017950: 6465 6e6f 6d20 3d20 2879 6365 6e74 7261  denom = (ycentra
+00017960: 6c2e 6d61 7828 2920 2d20 7963 656e 7472  l.max() - ycentr
+00017970: 616c 2e6d 696e 2829 2920 6966 2079 6365  al.min()) if yce
+00017980: 6e74 7261 6c2e 6d61 7828 2920 213d 2079  ntral.max() != y
+00017990: 6365 6e74 7261 6c2e 6d69 6e28 2920 656c  central.min() el
+000179a0: 7365 2031 0a20 2020 2020 2020 2020 2020  se 1.           
+000179b0: 2079 7265 7363 616c 6564 203d 2028 2828   yrescaled = (((
+000179c0: 7963 656e 7472 616c 202d 2079 6365 6e74  ycentral - ycent
+000179d0: 7261 6c2e 6d69 6e28 2929 202a 2032 3535  ral.min()) * 255
+000179e0: 2e30 2920 2f20 7964 656e 6f6d 292e 6173  .0) / ydenom).as
+000179f0: 7479 7065 2827 7569 6e74 3827 290a 2020  type('uint8').  
+00017a00: 2020 2020 2020 2020 2020 7972 6f74 6174            yrotat
+00017a10: 6520 3d20 6e70 2e72 6f74 3930 2879 7265  e = np.rot90(yre
+00017a20: 7363 616c 6564 290a 2020 2020 2020 2020  scaled).        
+00017a30: 2020 2020 7969 6d67 203d 2049 6d61 6765      yimg = Image
+00017a40: 2e66 726f 6d61 7272 6179 2879 726f 7461  .fromarray(yrota
+00017a50: 7465 290a 2020 2020 2020 2020 2020 2020  te).            
+00017a60: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00017a70: 2020 2020 2079 696d 672e 7361 7665 2873       yimg.save(s
+00017a80: 656c 662e 776f 726b 6469 7220 2b20 6d61  elf.workdir + ma
+00017a90: 706e 616d 6520 2b20 275f 796d 6173 6b63  pname + '_ymaskc
+00017aa0: 656e 7472 616c 5f73 6c69 6365 2e6a 7065  entral_slice.jpe
+00017ab0: 6727 290a 2020 2020 2020 2020 2020 2020  g').            
+00017ac0: 6578 6365 7074 2049 4f45 7272 6f72 2061  except IOError a
+00017ad0: 7320 696f 6572 723a 0a20 2020 2020 2020  s ioerr:.       
+00017ae0: 2020 2020 2020 2020 2079 6572 7220 3d20           yerr = 
+00017af0: 2753 6176 696e 6720 6f72 6967 696e 616c  'Saving original
+00017b00: 2079 2063 656e 7472 616c 2073 6c69 6365   y central slice
+00017b10: 206f 6620 6d61 736b 2065 7272 3a7b 7d27   of mask err:{}'
+00017b20: 2e66 6f72 6d61 7428 696f 6572 7229 0a20  .format(ioerr). 
+00017b30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00017b40: 7272 6c69 7374 2e61 7070 656e 6428 7965  rrlist.append(ye
+00017b50: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
+00017b60: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
+00017b70: 7269 7465 2879 6572 7220 2b20 275c 6e27  rite(yerr + '\n'
+00017b80: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
+00017b90: 6964 7468 2c20 6865 6967 6874 203d 2079  idth, height = y
+00017ba0: 696d 672e 7369 7a65 0a20 2020 2020 2020  img.size.       
+00017bb0: 2020 2020 2079 7363 616c 656e 616d 6520       yscalename 
+00017bc0: 3d20 7365 6c66 2e77 6f72 6b64 6972 202b  = self.workdir +
+00017bd0: 206d 6170 6e61 6d65 202b 2027 5f73 6361   mapname + '_sca
+00017be0: 6c65 645f 796d 6173 6b63 656e 7472 616c  led_ymaskcentral
+00017bf0: 5f73 6c69 6365 2e6a 7065 6727 0a20 2020  _slice.jpeg'.   
+00017c00: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00017c10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00017c20: 2077 6964 7468 203e 2033 3030 2061 6e64   width > 300 and
+00017c30: 2068 6569 6768 7420 3e20 3330 303a 0a20   height > 300:. 
+00017c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017c50: 2020 2069 6620 7769 6474 6820 3e3d 2068     if width >= h
+00017c60: 6569 6768 743a 0a20 2020 2020 2020 2020  eight:.         
+00017c70: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00017c80: 6172 6765 7273 6361 6c65 7220 3d20 3330  argerscaler = 30
+00017c90: 302e 202f 2077 6964 7468 0a20 2020 2020  0. / width.     
 00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cb0: 2020 2020 2020 2020 696d 7920 3d20 496d          imy = Im
-00017cc0: 6167 652e 6672 6f6d 6172 7261 7928 7972  age.fromarray(yr
-00017cd0: 6f74 6174 6529 2e72 6573 697a 6528 2833  otate).resize((3
-00017ce0: 3030 2c20 6e65 7768 6569 6768 7429 2c20  00, newheight), 
-00017cf0: 496d 6167 652e 414e 5449 414c 4941 5329  Image.ANTIALIAS)
-00017d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017d10: 2020 2020 2020 2020 2069 6d79 2e73 6176           imy.sav
-00017d20: 6528 7973 6361 6c65 6e61 6d65 290a 2020  e(yscalename).  
-00017d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017cb0: 2020 206e 6577 6865 6967 6874 203d 2069     newheight = i
+00017cc0: 6e74 2863 6569 6c28 6c61 7267 6572 7363  nt(ceil(largersc
+00017cd0: 616c 6572 202a 2068 6569 6768 7429 290a  aler * height)).
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cf0: 2020 2020 2020 2020 696d 7920 3d20 496d          imy = Im
+00017d00: 6167 652e 6672 6f6d 6172 7261 7928 7972  age.fromarray(yr
+00017d10: 6f74 6174 6529 2e72 6573 697a 6528 2833  otate).resize((3
+00017d20: 3030 2c20 6e65 7768 6569 6768 7429 2c20  00, newheight), 
+00017d30: 496d 6167 652e 5265 7361 6d70 6c69 6e67  Image.Resampling
+00017d40: 2e4c 414e 435a 4f53 290a 2020 2020 2020  .LANCZOS).      
 00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d60: 6c61 7267 6572 7363 616c 6572 203d 2033  largerscaler = 3
-00017d70: 3030 2e20 2f20 6865 6967 6874 0a20 2020  00. / height.   
-00017d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d90: 2020 2020 206e 6577 7769 6474 6820 3d20       newwidth = 
-00017da0: 696e 7428 6365 696c 286c 6172 6765 7273  int(ceil(largers
-00017db0: 6361 6c65 7220 2a20 7769 6474 6829 290a  caler * width)).
-00017dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dd0: 2020 2020 2020 2020 696d 7920 3d20 496d          imy = Im
-00017de0: 6167 652e 6672 6f6d 6172 7261 7928 7972  age.fromarray(yr
-00017df0: 6f74 6174 6529 2e72 6573 697a 6528 286e  otate).resize((n
-00017e00: 6577 7769 6474 682c 2033 3030 292c 2049  ewwidth, 300), I
-00017e10: 6d61 6765 2e41 4e54 4941 4c49 4153 290a  mage.ANTIALIAS).
-00017e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e30: 2020 2020 2020 2020 696d 792e 7361 7665          imy.save
-00017e40: 2879 7363 616c 656e 616d 6529 0a20 2020  (yscalename).   
-00017e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e60: 2023 2069 6d79 203d 2049 6d61 6765 2e66   # imy = Image.f
-00017e70: 726f 6d61 7272 6179 2879 726f 7461 7465  romarray(yrotate
-00017e80: 292e 7265 7369 7a65 2828 3330 302c 2033  ).resize((300, 3
-00017e90: 3030 2929 0a20 2020 2020 2020 2020 2020  00)).           
-00017ea0: 2020 2020 2020 2020 2023 2069 6d79 2e73           # imy.s
-00017eb0: 6176 6528 7973 6361 6c65 6e61 6d65 290a  ave(yscalename).
-00017ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ed0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00017ee0: 2020 2020 2020 2020 2020 6966 2077 6964            if wid
-00017ef0: 7468 203e 3d20 6865 6967 6874 3a0a 2020  th >= height:.  
-00017f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f10: 2020 2020 2020 7363 616c 6572 203d 2033        scaler = 3
-00017f20: 3030 2e20 2f20 7769 6474 680a 2020 2020  00. / width.    
-00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f40: 2020 2020 6e65 7768 6569 6768 7420 3d20      newheight = 
-00017f50: 696e 7428 6365 696c 2873 6361 6c65 7220  int(ceil(scaler 
-00017f60: 2a20 6865 6967 6874 2929 0a20 2020 2020  * height)).     
-00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f80: 2020 2069 6d79 203d 2049 6d61 6765 2e66     imy = Image.f
-00017f90: 726f 6d61 7272 6179 2879 726f 7461 7465  romarray(yrotate
-00017fa0: 292e 7265 7369 7a65 2828 3330 302c 206e  ).resize((300, n
-00017fb0: 6577 6865 6967 6874 292c 2049 6d61 6765  ewheight), Image
-00017fc0: 2e41 4e54 4941 4c49 4153 290a 2020 2020  .ANTIALIAS).    
-00017fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fe0: 2020 2020 696d 792e 7361 7665 2879 7363      imy.save(ysc
-00017ff0: 616c 656e 616d 6529 0a20 2020 2020 2020  alename).       
-00018000: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00018010: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018020: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00018030: 7220 3d20 3330 302e 202f 2068 6569 6768  r = 300. / heigh
-00018040: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00018050: 2020 2020 2020 2020 2020 6e65 7777 6964            newwid
-00018060: 7468 203d 2069 6e74 2863 6569 6c28 7363  th = int(ceil(sc
-00018070: 616c 6572 202a 2077 6964 7468 2929 0a20  aler * width)). 
-00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018090: 2020 2020 2020 2069 6d79 203d 2049 6d61         imy = Ima
-000180a0: 6765 2e66 726f 6d61 7272 6179 2879 726f  ge.fromarray(yro
-000180b0: 7461 7465 292e 7265 7369 7a65 2828 6e65  tate).resize((ne
-000180c0: 7777 6964 7468 2c20 3330 3029 2c20 496d  wwidth, 300), Im
-000180d0: 6167 652e 414e 5449 414c 4941 5329 0a20  age.ANTIALIAS). 
+00017d60: 2020 696d 792e 7361 7665 2879 7363 616c    imy.save(yscal
+00017d70: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
+00017d80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00017d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017da0: 2020 2020 2020 2020 206c 6172 6765 7273           largers
+00017db0: 6361 6c65 7220 3d20 3330 302e 202f 2068  caler = 300. / h
+00017dc0: 6569 6768 740a 2020 2020 2020 2020 2020  eight.          
+00017dd0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00017de0: 7777 6964 7468 203d 2069 6e74 2863 6569  wwidth = int(cei
+00017df0: 6c28 6c61 7267 6572 7363 616c 6572 202a  l(largerscaler *
+00017e00: 2077 6964 7468 2929 0a20 2020 2020 2020   width)).       
+00017e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e20: 2069 6d79 203d 2049 6d61 6765 2e66 726f   imy = Image.fro
+00017e30: 6d61 7272 6179 2879 726f 7461 7465 292e  marray(yrotate).
+00017e40: 7265 7369 7a65 2828 6e65 7777 6964 7468  resize((newwidth
+00017e50: 2c20 3330 3029 2c20 496d 6167 652e 5265  , 300), Image.Re
+00017e60: 7361 6d70 6c69 6e67 2e4c 414e 435a 4f53  sampling.LANCZOS
+00017e70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017e80: 2020 2020 2020 2020 2020 696d 792e 7361            imy.sa
+00017e90: 7665 2879 7363 616c 656e 616d 6529 0a20  ve(yscalename). 
+00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017eb0: 2020 2023 2069 6d79 203d 2049 6d61 6765     # imy = Image
+00017ec0: 2e66 726f 6d61 7272 6179 2879 726f 7461  .fromarray(yrota
+00017ed0: 7465 292e 7265 7369 7a65 2828 3330 302c  te).resize((300,
+00017ee0: 2033 3030 2929 0a20 2020 2020 2020 2020   300)).         
+00017ef0: 2020 2020 2020 2020 2020 2023 2069 6d79             # imy
+00017f00: 2e73 6176 6528 7973 6361 6c65 6e61 6d65  .save(yscalename
+00017f10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017f20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017f30: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00017f40: 6964 7468 203e 3d20 6865 6967 6874 3a0a  idth >= height:.
+00017f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f60: 2020 2020 2020 2020 7363 616c 6572 203d          scaler =
+00017f70: 2033 3030 2e20 2f20 7769 6474 680a 2020   300. / width.  
+00017f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f90: 2020 2020 2020 6e65 7768 6569 6768 7420        newheight 
+00017fa0: 3d20 696e 7428 6365 696c 2873 6361 6c65  = int(ceil(scale
+00017fb0: 7220 2a20 6865 6967 6874 2929 0a20 2020  r * height)).   
+00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fd0: 2020 2020 2069 6d79 203d 2049 6d61 6765       imy = Image
+00017fe0: 2e66 726f 6d61 7272 6179 2879 726f 7461  .fromarray(yrota
+00017ff0: 7465 292e 7265 7369 7a65 2828 3330 302c  te).resize((300,
+00018000: 206e 6577 6865 6967 6874 292c 2049 6d61   newheight), Ima
+00018010: 6765 2e52 6573 616d 706c 696e 672e 4c41  ge.Resampling.LA
+00018020: 4e43 5a4f 5329 0a20 2020 2020 2020 2020  NCZOS).         
+00018030: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018040: 6d79 2e73 6176 6528 7973 6361 6c65 6e61  my.save(yscalena
+00018050: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00018060: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018080: 2020 2020 2020 7363 616c 6572 203d 2033        scaler = 3
+00018090: 3030 2e20 2f20 6865 6967 6874 0a20 2020  00. / height.   
+000180a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180b0: 2020 2020 206e 6577 7769 6474 6820 3d20       newwidth = 
+000180c0: 696e 7428 6365 696c 2873 6361 6c65 7220  int(ceil(scaler 
+000180d0: 2a20 7769 6474 6829 290a 2020 2020 2020  * width)).      
 000180e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180f0: 2020 2020 2020 2069 6d79 2e73 6176 6528         imy.save(
-00018100: 7973 6361 6c65 6e61 6d65 290a 2020 2020  yscalename).    
-00018110: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00018120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018130: 7965 7272 203d 2027 5361 7669 6e67 2073  yerr = 'Saving s
-00018140: 6361 6c65 6420 7920 6365 6e74 7261 6c20  caled y central 
-00018150: 736c 6963 6520 6f66 206d 6173 6b20 6572  slice of mask er
-00018160: 723a 7b7d 272e 666f 726d 6174 2873 7973  r:{}'.format(sys
-00018170: 2e65 7863 5f69 6e66 6f28 295b 315d 290a  .exc_info()[1]).
-00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018190: 6572 726c 6973 742e 6170 7065 6e64 2879  errlist.append(y
-000181a0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-000181b0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-000181c0: 7772 6974 6528 7965 7272 202b 2027 5c6e  write(yerr + '\n
-000181d0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-000181e0: 2320 7a63 656e 7472 616c 203d 206d 6170  # zcentral = map
-000181f0: 2e66 756c 6c4d 6170 5b7a 6d69 642c 203a  .fullMap[zmid, :
-00018200: 2c20 3a5d 0a20 2020 2020 2020 2020 2020  , :].           
-00018210: 207a 6365 6e74 7261 6c20 3d20 6d61 702e   zcentral = map.
-00018220: 6461 7461 5b7a 6d69 642c 203a 2c20 3a5d  data[zmid, :, :]
-00018230: 0a20 2020 2020 2020 2020 2020 207a 6465  .            zde
-00018240: 6e6f 6d20 3d20 287a 6365 6e74 7261 6c2e  nom = (zcentral.
-00018250: 6d61 7828 2920 2d20 7a63 656e 7472 616c  max() - zcentral
-00018260: 2e6d 696e 2829 2920 6966 207a 6365 6e74  .min()) if zcent
-00018270: 7261 6c2e 6d61 7828 2920 213d 207a 6365  ral.max() != zce
-00018280: 6e74 7261 6c2e 6d69 6e28 2920 656c 7365  ntral.min() else
-00018290: 2031 0a20 2020 2020 2020 2020 2020 207a   1.            z
-000182a0: 7265 7363 616c 6564 203d 2028 2828 7a63  rescaled = (((zc
-000182b0: 656e 7472 616c 202d 207a 6365 6e74 7261  entral - zcentra
-000182c0: 6c2e 6d69 6e28 2929 202a 2032 3535 2e30  l.min()) * 255.0
-000182d0: 2920 2f20 7a64 656e 6f6d 292e 6173 7479  ) / zdenom).asty
-000182e0: 7065 2827 7569 6e74 3827 290a 2020 2020  pe('uint8').    
-000182f0: 2020 2020 2020 2020 7a66 6c69 7070 6564          zflipped
-00018300: 203d 206e 702e 666c 6970 7564 287a 7265   = np.flipud(zre
-00018310: 7363 616c 6564 290a 2020 2020 2020 2020  scaled).        
-00018320: 2020 2020 7a69 6d67 203d 2049 6d61 6765      zimg = Image
-00018330: 2e66 726f 6d61 7272 6179 287a 666c 6970  .fromarray(zflip
-00018340: 7065 6429 0a20 2020 2020 2020 2020 2020  ped).           
-00018350: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00018360: 2020 2020 2020 7a69 6d67 2e73 6176 6528        zimg.save(
-00018370: 7365 6c66 2e77 6f72 6b64 6972 202b 206d  self.workdir + m
-00018380: 6170 6e61 6d65 202b 2027 5f7a 6d61 736b  apname + '_zmask
-00018390: 6365 6e74 7261 6c5f 736c 6963 652e 6a70  central_slice.jp
-000183a0: 6567 2729 0a20 2020 2020 2020 2020 2020  eg').           
-000183b0: 2065 7863 6570 7420 494f 4572 726f 7220   except IOError 
-000183c0: 6173 2069 6f65 7272 3a0a 2020 2020 2020  as ioerr:.      
-000183d0: 2020 2020 2020 2020 2020 7a65 7272 203d            zerr =
-000183e0: 2027 5361 7669 6e67 206f 7269 6769 6e61   'Saving origina
-000183f0: 6c20 7a20 6365 6e74 7261 6c20 736c 6963  l z central slic
-00018400: 6520 6f66 206d 6173 6b20 6572 723a 7b7d  e of mask err:{}
-00018410: 272e 666f 726d 6174 2869 6f65 7272 290a  '.format(ioerr).
-00018420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018430: 6572 726c 6973 742e 6170 7065 6e64 287a  errlist.append(z
-00018440: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-00018450: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-00018460: 7772 6974 6528 7a65 7272 202b 2027 5c6e  write(zerr + '\n
-00018470: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-00018480: 7769 6474 682c 2068 6569 6768 7420 3d20  width, height = 
-00018490: 7a69 6d67 2e73 697a 650a 2020 2020 2020  zimg.size.      
-000184a0: 2020 2020 2020 7a73 6361 6c65 6e61 6d65        zscalename
-000184b0: 203d 2073 656c 662e 776f 726b 6469 7220   = self.workdir 
-000184c0: 2b20 6d61 706e 616d 6520 2b20 275f 7363  + mapname + '_sc
-000184d0: 616c 6564 5f7a 6d61 736b 6365 6e74 7261  aled_zmaskcentra
-000184e0: 6c5f 736c 6963 652e 6a70 6567 270a 2020  l_slice.jpeg'.  
-000184f0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00018500: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00018510: 6620 7769 6474 6820 3e20 3330 3020 616e  f width > 300 an
-00018520: 6420 6865 6967 6874 203e 2033 3030 3a0a  d height > 300:.
-00018530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018540: 2020 2020 6966 2077 6964 7468 203e 3d20      if width >= 
-00018550: 6865 6967 6874 3a0a 2020 2020 2020 2020  height:.        
-00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018570: 6c61 7267 6572 7363 616c 6572 203d 2033  largerscaler = 3
-00018580: 3030 2e20 2f20 7769 6474 680a 2020 2020  00. / width.    
-00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185a0: 2020 2020 6e65 7768 6569 6768 7420 3d20      newheight = 
-000185b0: 696e 7428 6365 696c 286c 6172 6765 7273  int(ceil(largers
-000185c0: 6361 6c65 7220 2a20 6865 6967 6874 2929  caler * height))
-000185d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000185e0: 2020 2020 2020 2020 2069 6d7a 203d 2049           imz = I
-000185f0: 6d61 6765 2e66 726f 6d61 7272 6179 287a  mage.fromarray(z
-00018600: 666c 6970 7065 6429 2e72 6573 697a 6528  flipped).resize(
-00018610: 2833 3030 2c20 6e65 7768 6569 6768 7429  (300, newheight)
-00018620: 2c20 496d 6167 652e 414e 5449 414c 4941  , Image.ANTIALIA
-00018630: 5329 0a20 2020 2020 2020 2020 2020 2020  S).             
-00018640: 2020 2020 2020 2020 2020 2069 6d7a 2e73             imz.s
-00018650: 6176 6528 7a73 6361 6c65 6e61 6d65 290a  ave(zscalename).
-00018660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018670: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018690: 2020 6c61 7267 6572 7363 616c 6572 203d    largerscaler =
-000186a0: 2033 3030 2e20 2f20 6865 6967 6874 0a20   300. / height. 
-000186b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186c0: 2020 2020 2020 206e 6577 7769 6474 6820         newwidth 
-000186d0: 3d20 696e 7428 6365 696c 286c 6172 6765  = int(ceil(large
-000186e0: 7273 6361 6c65 7220 2a20 7769 6474 6829  rscaler * width)
-000186f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018700: 2020 2020 2020 2020 2020 696d 7a20 3d20            imz = 
-00018710: 496d 6167 652e 6672 6f6d 6172 7261 7928  Image.fromarray(
-00018720: 7a66 6c69 7070 6564 292e 7265 7369 7a65  zflipped).resize
-00018730: 2828 6e65 7777 6964 7468 2c20 3330 3029  ((newwidth, 300)
-00018740: 2c20 496d 6167 652e 414e 5449 414c 4941  , Image.ANTIALIA
-00018750: 5329 0a20 2020 2020 2020 2020 2020 2020  S).             
-00018760: 2020 2020 2020 2020 2020 2069 6d7a 2e73             imz.s
-00018770: 6176 6528 7a73 6361 6c65 6e61 6d65 290a  ave(zscalename).
-00018780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018790: 2020 2020 2320 696d 7a20 3d20 496d 6167      # imz = Imag
-000187a0: 652e 6672 6f6d 6172 7261 7928 7a66 6c69  e.fromarray(zfli
-000187b0: 7070 6564 292e 7265 7369 7a65 2828 3330  pped).resize((30
-000187c0: 302c 2033 3030 2929 0a20 2020 2020 2020  0, 300)).       
-000187d0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-000187e0: 6d7a 2e73 6176 6528 7a73 6361 6c65 6e61  mz.save(zscalena
-000187f0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00018800: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018810: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018820: 2077 6964 7468 203e 3d20 6865 6967 6874   width >= height
-00018830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018840: 2020 2020 2020 2020 2020 7363 616c 6572            scaler
-00018850: 203d 2033 3030 2e20 2f20 7769 6474 680a   = 300. / width.
-00018860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018870: 2020 2020 2020 2020 6e65 7768 6569 6768          newheigh
-00018880: 7420 3d20 696e 7428 6365 696c 2873 6361  t = int(ceil(sca
-00018890: 6c65 7220 2a20 6865 6967 6874 2929 0a20  ler * height)). 
-000188a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188b0: 2020 2020 2020 2069 6d7a 203d 2049 6d61         imz = Ima
-000188c0: 6765 2e66 726f 6d61 7272 6179 287a 666c  ge.fromarray(zfl
-000188d0: 6970 7065 6429 2e72 6573 697a 6528 2833  ipped).resize((3
-000188e0: 3030 2c20 6e65 7768 6569 6768 7429 2c20  00, newheight), 
-000188f0: 496d 6167 652e 414e 5449 414c 4941 5329  Image.ANTIALIAS)
-00018900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018910: 2020 2020 2020 2020 2069 6d7a 2e73 6176           imz.sav
-00018920: 6528 7a73 6361 6c65 6e61 6d65 290a 2020  e(zscalename).  
-00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018940: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018960: 7363 616c 6572 203d 2033 3030 2e20 2f20  scaler = 300. / 
-00018970: 6865 6967 6874 0a20 2020 2020 2020 2020  height.         
-00018980: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00018990: 6577 7769 6474 6820 3d20 696e 7428 6365  ewwidth = int(ce
-000189a0: 696c 2873 6361 6c65 7220 2a20 7769 6474  il(scaler * widt
-000189b0: 6829 290a 2020 2020 2020 2020 2020 2020  h)).            
-000189c0: 2020 2020 2020 2020 2020 2020 696d 7a20              imz 
-000189d0: 3d20 496d 6167 652e 6672 6f6d 6172 7261  = Image.fromarra
-000189e0: 7928 7a66 6c69 7070 6564 292e 7265 7369  y(zflipped).resi
-000189f0: 7a65 2828 6e65 7777 6964 7468 2c20 3330  ze((newwidth, 30
-00018a00: 3029 2c20 496d 6167 652e 414e 5449 414c  0), Image.ANTIAL
-00018a10: 4941 5329 0a20 2020 2020 2020 2020 2020  IAS).           
-00018a20: 2020 2020 2020 2020 2020 2020 2069 6d7a               imz
-00018a30: 2e73 6176 6528 7a73 6361 6c65 6e61 6d65  .save(zscalename
-00018a40: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-00018a50: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00018a60: 2020 2020 2020 7a65 7272 203d 2027 5361        zerr = 'Sa
-00018a70: 7669 6e67 206f 7269 6769 6e61 6c20 7a20  ving original z 
-00018a80: 7363 616c 6564 2063 656e 7472 616c 2073  scaled central s
-00018a90: 6c69 6365 206f 6620 6d61 736b 2065 7272  lice of mask err
-00018aa0: 3a7b 7d27 2e66 6f72 6d61 7428 7379 732e  :{}'.format(sys.
-00018ab0: 6578 635f 696e 666f 2829 5b31 5d29 0a20  exc_info()[1]). 
-00018ac0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00018ad0: 7272 6c69 7374 2e61 7070 656e 6428 7a65  rrlist.append(ze
-00018ae0: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
-00018af0: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00018b00: 7269 7465 287a 6572 7220 2b20 275c 6e27  rite(zerr + '\n'
-00018b10: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
-00018b20: 736c 6963 656a 736f 6e20 3d20 6469 6374  slicejson = dict
-00018b30: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-00018b40: 736c 6963 656a 736f 6e5b 2778 275d 203d  slicejson['x'] =
-00018b50: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-00018b60: 6528 7873 6361 6c65 6e61 6d65 2920 6966  e(xscalename) if
-00018b70: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-00018b80: 7873 6361 6c65 6e61 6d65 2920 656c 7365  xscalename) else
-00018b90: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00018ba0: 2020 6373 6c69 6365 6a73 6f6e 5b27 7927    cslicejson['y'
-00018bb0: 5d20 3d20 6f73 2e70 6174 682e 6261 7365  ] = os.path.base
-00018bc0: 6e61 6d65 2879 7363 616c 656e 616d 6529  name(yscalename)
-00018bd0: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
-00018be0: 6c65 2879 7363 616c 656e 616d 6529 2065  le(yscalename) e
-00018bf0: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-00018c00: 2020 2020 2063 736c 6963 656a 736f 6e5b       cslicejson[
-00018c10: 277a 275d 203d 206f 732e 7061 7468 2e62  'z'] = os.path.b
-00018c20: 6173 656e 616d 6528 7a73 6361 6c65 6e61  asename(zscalena
-00018c30: 6d65 2920 6966 206f 732e 7061 7468 2e69  me) if os.path.i
-00018c40: 7366 696c 6528 7a73 6361 6c65 6e61 6d65  sfile(zscalename
-00018c50: 2920 656c 7365 204e 6f6e 650a 0a20 2020  ) else None..   
-00018c60: 2020 2020 2020 2020 2061 6c6c 6d61 736b           allmask
-00018c70: 6469 6374 5b6d 6170 6e61 6d65 5d20 3d20  dict[mapname] = 
-00018c80: 6373 6c69 6365 6a73 6f6e 0a0a 2020 2020  cslicejson..    
-00018c90: 2020 2020 6966 2065 7272 6c69 7374 3a0a      if errlist:.
-00018ca0: 2020 2020 2020 2020 2020 2020 616c 6c6d              allm
-00018cb0: 6173 6b64 6963 745b 2765 7272 275d 203d  askdict['err'] =
-00018cc0: 207b 276d 6173 6b5f 6365 6e74 7261 6c5f   {'mask_central_
-00018cd0: 736c 6963 655f 6572 7227 3a20 6572 726c  slice_err': errl
-00018ce0: 6973 747d 0a20 2020 2020 2020 2066 696e  ist}.        fin
-00018cf0: 616c 6469 6374 203d 207b 276d 6173 6b5f  aldict = {'mask_
-00018d00: 6365 6e74 7261 6c5f 736c 6963 6527 3a20  central_slice': 
-00018d10: 616c 6c6d 6173 6b64 6963 747d 0a0a 2020  allmaskdict}..  
-00018d20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00018d30: 2020 2020 2020 2077 6974 6820 636f 6465         with code
-00018d40: 6373 2e6f 7065 6e28 7365 6c66 2e77 6f72  cs.open(self.wor
-00018d50: 6b64 6972 202b 2073 656c 662e 6d61 706e  kdir + self.mapn
-00018d60: 616d 6520 2b20 275f 6d61 736b 6365 6e74  ame + '_maskcent
-00018d70: 7261 6c73 6c69 6365 2e6a 736f 6e27 2c20  ralslice.json', 
-00018d80: 2777 272c 0a20 2020 2020 2020 2020 2020  'w',.           
-00018d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018da0: 2020 656e 636f 6469 6e67 3d27 7574 662d    encoding='utf-
-00018db0: 3827 2920 6173 2066 3a0a 2020 2020 2020  8') as f:.      
-00018dc0: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
-00018dd0: 756d 7028 6669 6e61 6c64 6963 742c 2066  ump(finaldict, f
-00018de0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00018df0: 2049 4f45 7272 6f72 2061 7320 696f 6572   IOError as ioer
-00018e00: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
-00018e10: 7269 6e74 2827 5361 7669 6e67 206d 6173  rint('Saving mas
-00018e20: 6b73 2063 656e 7472 616c 2073 6c69 6365  ks central slice
-00018e30: 7320 746f 206a 736f 6e20 6572 723a 207b  s to json err: {
-00018e40: 7d27 2e66 6f72 6d61 7428 696f 6572 7229  }'.format(ioerr)
-00018e50: 290a 0a20 2020 2020 2020 2065 6e64 203d  )..        end =
-00018e60: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-00018e70: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
-00018e80: 7072 696e 7428 274d 616b 7343 656e 7472  print('MaksCentr
-00018e90: 616c 536c 6963 6520 7469 6d65 3a20 2573  alSlice time: %s
-00018ea0: 2720 2520 2865 6e64 202d 2073 7461 7274  ' % (end - start
-00018eb0: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-00018ec0: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
-00018ed0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00018ee0: 2d2d 2d2d 2d2d 2729 0a0a 2020 2020 2020  ------')..      
-00018ef0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00018f00: 2020 2064 6566 2063 6865 636b 7674 7028     def checkvtp(
-00018f10: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00018f20: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-00018f30: 4368 6563 6b20 6966 2074 6865 7265 2069  Check if there i
-00018f40: 7320 6120 7674 7020 6669 6c65 2065 7869  s a vtp file exi
-00018f50: 7374 206f 7220 6e6f 740a 0a20 2020 2020  st or not..     
-00018f60: 2020 203a 7265 7475 726e 3a0a 2020 2020     :return:.    
-00018f70: 2020 2020 2222 220a 0a0a 2020 2020 2020      """...      
-00018f80: 2020 7674 7072 6567 203d 2073 656c 662e    vtpreg = self.
-00018f90: 776f 726b 6469 7220 2b20 272a 2e76 7470  workdir + '*.vtp
-00018fa0: 270a 2020 2020 2020 2020 676c 6f62 7265  '.        globre
-00018fb0: 7375 6c74 203d 2067 6c6f 622e 676c 6f62  sult = glob.glob
-00018fc0: 2876 7470 7265 6729 0a20 2020 2020 2020  (vtpreg).       
-00018fd0: 2076 7470 6e61 6d65 203d 2027 7b7d 7b7d   vtpname = '{}{}
-00018fe0: 5f7b 7d2e 7674 7027 2e66 6f72 6d61 7428  _{}.vtp'.format(
-00018ff0: 7365 6c66 2e77 6f72 6b64 6972 2c20 7365  self.workdir, se
-00019000: 6c66 2e6d 6170 6e61 6d65 2c20 7365 6c66  lf.mapname, self
-00019010: 2e63 6c29 0a20 2020 2020 2020 2069 6620  .cl).        if 
-00019020: 7674 706e 616d 6520 696e 2067 6c6f 6272  vtpname in globr
-00019030: 6573 756c 743a 0a20 2020 2020 2020 2020  esult:.         
-00019040: 2020 2076 7470 6675 6c6c 6e61 6d65 203d     vtpfullname =
-00019050: 2076 7470 6e61 6d65 0a20 2020 2020 2020   vtpname.       
-00019060: 2020 2020 2070 7269 6e74 2827 2573 2065       print('%s e
-00019070: 7869 7374 2061 6c72 6561 6479 2e27 2025  xist already.' %
-00019080: 2076 7470 6e61 6d65 290a 2020 2020 2020   vtpname).      
-00019090: 2020 2020 2020 7265 7475 726e 2076 7470        return vtp
-000190a0: 6675 6c6c 6e61 6d65 0a20 2020 2020 2020  fullname.       
-000190b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000190c0: 2020 2069 6620 676c 6f62 7265 7375 6c74     if globresult
-000190d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000190e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000190f0: 696e 7428 2776 7470 2066 696c 653a 2025  int('vtp file: %
-00019100: 7320 6578 6973 742c 2070 6c65 6173 6520  s exist, please 
-00019110: 6368 6563 6b2e 2720 2520 676c 6f62 7265  check.' % globre
-00019120: 7375 6c74 290a 2020 2020 2020 2020 2020  sult).          
-00019130: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00019140: 2020 2064 6566 2067 656e 7674 7028 7365     def genvtp(se
-00019150: 6c66 2c20 6675 6c6c 6d61 7070 6174 6829  lf, fullmappath)
-00019160: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
-00019170: 2020 2020 2020 2020 2020 2047 656e 6572             Gener
-00019180: 6174 6520 7674 7020 6669 6c65 2066 6f72  ate vtp file for
-00019190: 206e 6f6e 2d73 6572 7665 7220 696e 7075   non-server inpu
-000191a0: 740a 0a20 2020 2020 2020 203a 7061 7261  t..        :para
-000191b0: 6d20 6675 6c6c 6d61 7070 6174 683a 0a20  m fullmappath:. 
-000191c0: 2020 2020 2020 203a 7265 7475 726e 3a0a         :return:.
-000191d0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-000191e0: 2020 2020 206d 6573 686d 616b 6572 203d       meshmaker =
-000191f0: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-00019200: 6620 4d45 5348 4d41 4b45 5250 4154 4820  f MESHMAKERPATH 
-00019210: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00019220: 2020 2020 2020 2020 206d 6573 686d 616b           meshmak
-00019230: 6572 203d 2054 7275 650a 2020 2020 2020  er = True.      
-00019240: 2020 2020 2020 6d65 7368 6d61 6b65 7270        meshmakerp
-00019250: 6174 6820 3d20 4d45 5348 4d41 4b45 5250  ath = MESHMAKERP
-00019260: 4154 480a 2020 2020 2020 2020 656c 7365  ATH.        else
-00019270: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00019280: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00019290: 2020 2061 7373 6572 7420 6669 6e64 5f65     assert find_e
-000192a0: 7865 6375 7461 626c 6528 276d 6573 686d  xecutable('meshm
-000192b0: 616b 6572 2729 2069 7320 6e6f 7420 4e6f  aker') is not No
-000192c0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-000192d0: 2020 206d 6573 686d 616b 6572 7061 7468     meshmakerpath
-000192e0: 203d 2066 696e 645f 6578 6563 7574 6162   = find_executab
-000192f0: 6c65 2827 6d65 7368 6d61 6b65 7227 290a  le('meshmaker').
-00019300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019310: 6d65 7368 6d61 6b65 7220 3d20 5472 7565  meshmaker = True
-00019320: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00019330: 6570 7420 4173 7365 7274 696f 6e45 7272  ept AssertionErr
-00019340: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00019350: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00019360: 7269 7465 2827 6d65 7368 6d61 6b65 7220  rite('meshmaker 
-00019370: 6578 6563 7574 6162 6c65 2069 7320 6e6f  executable is no
-00019380: 7420 7468 6572 652e 5c6e 2729 0a0a 2020  t there.\n')..  
-00019390: 2020 2020 2020 6966 206d 6573 686d 616b        if meshmak
-000193a0: 6572 2061 6e64 2073 656c 662e 636c 2069  er and self.cl i
-000193b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000193c0: 2020 2020 2020 2020 6f75 7476 7470 6e61          outvtpna
-000193d0: 6d65 203d 2027 7b7d 7b7d 5f7b 7d27 2e66  me = '{}{}_{}'.f
-000193e0: 6f72 6d61 7428 7365 6c66 2e77 6f72 6b64  ormat(self.workd
-000193f0: 6972 2c20 7365 6c66 2e6d 6170 6e61 6d65  ir, self.mapname
-00019400: 2c20 7365 6c66 2e63 6c29 0a20 2020 2020  , self.cl).     
-00019410: 2020 2020 2020 2063 6d64 203d 206d 6573         cmd = mes
-00019420: 686d 616b 6572 7061 7468 202b 2027 2027  hmakerpath + ' '
-00019430: 202b 2066 756c 6c6d 6170 7061 7468 202b   + fullmappath +
-00019440: 2027 202d 6320 2720 2b20 7374 7228 7365   ' -c ' + str(se
-00019450: 6c66 2e63 6c29 202b 2027 202d 6f20 2720  lf.cl) + ' -o ' 
-00019460: 2b20 6f75 7476 7470 6e61 6d65 202b 2027  + outvtpname + '
-00019470: 202d 4420 2d76 270a 2020 2020 2020 2020   -D -v'.        
-00019480: 2020 2020 7072 6f63 6573 7320 3d20 7375      process = su
-00019490: 6270 726f 6365 7373 2e50 6f70 656e 2863  bprocess.Popen(c
-000194a0: 6d64 2c20 7368 656c 6c3d 5472 7565 2c20  md, shell=True, 
-000194b0: 6578 6563 7574 6162 6c65 3d27 2f62 696e  executable='/bin
-000194c0: 2f62 6173 6827 290a 2020 2020 2020 2020  /bash').        
-000194d0: 2020 2020 636f 6465 203d 2070 726f 6365      code = proce
-000194e0: 7373 2e77 6169 7428 290a 2020 2020 2020  ss.wait().      
-000194f0: 2020 2020 2020 6966 2063 6f64 6520 3d3d        if code ==
-00019500: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00019510: 2020 2020 7265 7375 6c74 203d 206f 7574      result = out
-00019520: 7674 706e 616d 6520 2b20 272e 7674 7027  vtpname + '.vtp'
-00019530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019540: 2070 7269 6e74 2827 5072 6f64 7563 6520   print('Produce 
-00019550: 6669 6c65 3a20 2573 2073 7563 6365 7373  file: %s success
-00019560: 6675 6c6c 7927 2025 2072 6573 756c 7429  fully' % result)
-00019570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019580: 2072 6574 7572 6e20 7265 7375 6c74 0a20   return result. 
-00019590: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000195a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000195b0: 2070 7269 6e74 2827 4d65 7368 6d61 6b65   print('Meshmake
-000195c0: 7220 6469 6420 6e6f 7420 7072 6f64 7563  r did not produc
-000195d0: 6520 7468 6520 7674 7020 6669 6c65 2063  e the vtp file c
-000195e0: 6865 636b 2074 6865 2069 6e70 7574 732e  heck the inputs.
-000195f0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00019600: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-00019610: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00019620: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00019630: 4469 6420 6e6f 7420 6669 6e64 2070 726f  Did not find pro
-00019640: 7065 7220 6d65 7368 6d61 6b65 7220 6f72  per meshmaker or
-00019650: 2074 6865 206e 6f20 636f 6e74 6f75 7220   the no contour 
-00019660: 6c65 7665 6c20 6176 6169 6c61 626c 6520  level available 
-00019670: 2e27 290a 0a20 2020 2040 7374 6174 6963  .')..    @static
-00019680: 6d65 7468 6f64 0a20 2020 2064 6566 2077  method.    def w
-00019690: 7269 7465 5f69 6d61 6765 2869 6d61 6765  rite_image(image
-000196a0: 4669 6c65 2c20 7265 6e57 696e 293a 0a20  File, renWin):. 
-000196b0: 2020 2020 2020 2023 2057 7269 7465 2074         # Write t
-000196c0: 6865 2063 7572 7265 6e74 2076 6965 7720  he current view 
-000196d0: 6f66 2074 6865 2072 656e 6465 7265 7220  of the renderer 
-000196e0: 746f 2061 6e20 696d 6167 650a 2020 2020  to an image.    
-000196f0: 2020 2020 6966 2069 6d61 6765 4669 6c65      if imageFile
-00019700: 3a0a 2020 2020 2020 2020 2020 2020 7772  :.            wr
-00019710: 6974 6572 203d 2076 746b 2e76 746b 424d  iter = vtk.vtkBM
-00019720: 5057 7269 7465 7228 290a 2020 2020 2020  PWriter().      
-00019730: 2020 2020 2020 7769 6e64 6f77 746f 5f69        windowto_i
-00019740: 6d61 6765 5f66 696c 7465 7220 3d20 7674  mage_filter = vt
-00019750: 6b2e 7674 6b57 696e 646f 7754 6f49 6d61  k.vtkWindowToIma
-00019760: 6765 4669 6c74 6572 2829 0a20 2020 2020  geFilter().     
-00019770: 2020 2020 2020 2077 696e 646f 7774 6f5f         windowto_
-00019780: 696d 6167 655f 6669 6c74 6572 2e53 6574  image_filter.Set
-00019790: 496e 7075 7428 7265 6e57 696e 290a 2020  Input(renWin).  
-000197a0: 2020 2020 2020 2020 2020 2320 696d 6167            # imag
-000197b0: 6520 7175 616c 6974 790a 2020 2020 2020  e quality.      
-000197c0: 2020 2020 2020 7769 6e64 6f77 746f 5f69        windowto_i
-000197d0: 6d61 6765 5f66 696c 7465 722e 5365 7449  mage_filter.SetI
-000197e0: 6e70 7574 4275 6666 6572 5479 7065 546f  nputBufferTypeTo
-000197f0: 5247 4228 290a 0a20 2020 2020 2020 2020  RGB()..         
-00019800: 2020 2077 7269 7465 722e 5365 7446 696c     writer.SetFil
-00019810: 654e 616d 6528 696d 6167 6546 696c 6529  eName(imageFile)
-00019820: 0a20 2020 2020 2020 2020 2020 2077 7269  .            wri
-00019830: 7465 722e 5365 7449 6e70 7574 436f 6e6e  ter.SetInputConn
-00019840: 6563 7469 6f6e 2877 696e 646f 7774 6f5f  ection(windowto_
-00019850: 696d 6167 655f 6669 6c74 6572 2e47 6574  image_filter.Get
-00019860: 4f75 7470 7574 506f 7274 2829 290a 2020  OutputPort()).  
-00019870: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-00019880: 2e57 7269 7465 2829 0a20 2020 2020 2020  .Write().       
-00019890: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000198a0: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
-000198b0: 4572 726f 7228 274e 6565 6420 6120 6669  Error('Need a fi
-000198c0: 6c65 6e61 6d65 2e27 290a 0a20 2020 2023  lename.')..    #
-000198d0: 2052 6177 6d61 7020 7375 7266 6163 6520   Rawmap surface 
-000198e0: 7669 6577 2077 6865 6e20 7477 6f20 6861  view when two ha
-000198f0: 6c66 206d 6170 7320 6172 6520 6769 7665  lf maps are give
-00019900: 6e0a 2020 2020 6465 6620 7261 776d 6170  n.    def rawmap
-00019910: 636c 2873 656c 6629 3a0a 2020 2020 2020  cl(self):.      
-00019920: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
-00019930: 2020 2043 616c 6375 6c61 7465 2061 2063     Calculate a c
-00019940: 6f72 7265 7370 6f6e 6469 6e67 2027 7265  orresponding 're
-00019950: 636f 6d6d 656e 6465 6420 636f 6e74 6f75  commended contou
-00019960: 7220 6c65 7665 6c27 2062 6173 6564 206f  r level' based o
-00019970: 6e20 7468 6520 7265 636f 6d6d 656e 6465  n the recommende
-00019980: 6420 636f 6e74 6f75 7220 6c65 7665 6c0a  d contour level.
-00019990: 2020 2020 2020 2020 2020 2020 2868 6176              (hav
-000199a0: 6520 7472 6965 6420 6d61 7463 6869 6e67  e tried matching
-000199b0: 2074 6865 2076 616c 7565 2073 6361 6c65   the value scale
-000199c0: 2077 6869 6368 2067 6574 2077 6f72 7365   which get worse
-000199d0: 2072 6573 756c 7420 7468 616e 2074 6869   result than thi
-000199e0: 7320 6f6e 6529 0a0a 2020 2020 2020 2020  s one)..        
-000199f0: 3a72 6574 7572 6e3a 2041 2066 6c6f 6174  :return: A float
-00019a00: 2077 6869 6368 2067 6976 6520 7468 6520   which give the 
-00019a10: 636f 6e74 6f75 7220 6c65 7665 6c0a 2020  contour level.  
-00019a20: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00019a30: 2020 2023 206e 756d 766f 7820 3d20 6c65     # numvox = le
-00019a40: 6e28 7365 6c66 2e6d 6170 2e66 756c 6c4d  n(self.map.fullM
-00019a50: 6170 5b73 656c 662e 6d61 702e 6675 6c6c  ap[self.map.full
-00019a60: 4d61 7020 3e3d 2073 656c 662e 636c 5d29  Map >= self.cl])
-00019a70: 0a20 2020 2020 2020 206e 756d 766f 7820  .        numvox 
-00019a80: 3d20 6c65 6e28 7365 6c66 2e6d 6170 2e64  = len(self.map.d
-00019a90: 6174 615b 7365 6c66 2e6d 6170 2e64 6174  ata[self.map.dat
-00019aa0: 6120 3e3d 2073 656c 662e 636c 5d29 0a20  a >= self.cl]). 
-00019ab0: 2020 2020 2020 2072 6177 6d61 7020 3d20         rawmap = 
-00019ac0: 7365 6c66 2e72 6177 6d61 700a 2020 2020  self.rawmap.    
-00019ad0: 2020 2020 2320 7261 7764 6174 6120 3d20      # rawdata = 
-00019ae0: 7261 776d 6170 2e66 756c 6c4d 6170 2e66  rawmap.fullMap.f
-00019af0: 6c61 7474 656e 2829 0a20 2020 2020 2020  latten().       
-00019b00: 2072 6177 6461 7461 203d 2072 6177 6d61   rawdata = rawma
-00019b10: 702e 6461 7461 2e66 6c61 7474 656e 2829  p.data.flatten()
-00019b20: 0a20 2020 2020 2020 2066 6c61 7472 6177  .        flatraw
-00019b30: 203d 2073 6f72 7465 6428 7261 7764 6174   = sorted(rawdat
-00019b40: 6129 5b3a 3a2d 315d 0a20 2020 2020 2020  a)[::-1].       
-00019b50: 2072 6177 636c 203d 2066 6c61 7472 6177   rawcl = flatraw
-00019b60: 5b6e 756d 766f 785d 0a0a 2020 2020 2020  [numvox]..      
-00019b70: 2020 7265 7475 726e 2072 6177 636c 0a0a    return rawcl..
-00019b80: 0a20 2020 2064 6566 2066 696e 6472 6177  .    def findraw
-00019b90: 6d61 7028 7365 6c66 293a 0a0a 2020 2020  map(self):..    
-00019ba0: 2020 2020 6966 2073 656c 662e 656d 6469      if self.emdi
-00019bb0: 643a 0a20 2020 2020 2020 2020 2020 2072  d:.            r
-00019bc0: 6177 6d61 706e 616d 6520 3d20 277b 7d65  awmapname = '{}e
-00019bd0: 6d64 5f7b 7d5f 7261 776d 6170 2e6d 6170  md_{}_rawmap.map
-00019be0: 272e 666f 726d 6174 2873 656c 662e 776f  '.format(self.wo
-00019bf0: 726b 6469 722c 2073 656c 662e 656d 6469  rkdir, self.emdi
-00019c00: 6429 0a20 2020 2020 2020 2065 6c73 653a  d).        else:
-00019c10: 0a20 2020 2020 2020 2020 2020 206f 6464  .            odd
-00019c20: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-00019c30: 6173 656e 616d 6528 7365 6c66 2e68 6d6f  asename(self.hmo
-00019c40: 6464 2e66 756c 6c6e 616d 6529 0a20 2020  dd.fullname).   
-00019c50: 2020 2020 2020 2020 2065 7665 6e6e 616d           evennam
-00019c60: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00019c70: 6e61 6d65 2873 656c 662e 686d 6576 656e  name(self.hmeven
-00019c80: 2e66 756c 6c6e 616d 6529 0a20 2020 2020  .fullname).     
-00019c90: 2020 2020 2020 2072 6177 6d61 706e 616d         rawmapnam
-00019ca0: 6520 3d20 277b 7d7b 7d5f 7b7d 5f72 6177  e = '{}{}_{}_raw
-00019cb0: 6d61 702e 6d61 7027 2e66 6f72 6d61 7428  map.map'.format(
-00019cc0: 7365 6c66 2e77 6f72 6b64 6972 2c20 6f64  self.workdir, od
-00019cd0: 646e 616d 652c 2065 7665 6e6e 616d 6529  dname, evenname)
-00019ce0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00019cf0: 662e 686d 6f64 6420 6973 206e 6f74 204e  f.hmodd is not N
-00019d00: 6f6e 6520 616e 6420 7365 6c66 2e68 6d65  one and self.hme
-00019d10: 7665 6e20 6973 206e 6f74 204e 6f6e 653a  ven is not None:
-00019d20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019d30: 6f73 2e70 6174 682e 6973 6669 6c65 2872  os.path.isfile(r
-00019d40: 6177 6d61 706e 616d 6529 3a0a 2020 2020  awmapname):.    
-00019d50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00019d60: 726e 2072 6177 6d61 706e 616d 650a 2020  rn rawmapname.  
-00019d70: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00019d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019d90: 2070 7269 6e74 2827 4261 7365 206f 6e20   print('Base on 
-00019da0: 7468 6520 6861 6c66 206d 6170 732c 2072  the half maps, r
-00019db0: 6177 6d61 7020 6973 206e 6f74 2070 726f  awmap is not pro
-00019dc0: 6475 6365 6421 2127 290a 2020 2020 2020  duced!!').      
-00019dd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019de0: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-00019df0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019e00: 7265 7475 726e 204e 6f6e 650a 0a0a 2020  return None...  
-00019e10: 2020 6465 6620 7261 776d 6170 7375 7266    def rawmapsurf
-00019e20: 6163 655f 6368 696d 6572 6128 7365 6c66  ace_chimera(self
-00019e30: 2c20 6368 696d 6572 6161 7070 293a 0a20  , chimeraapp):. 
-00019e40: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00019e50: 2020 2020 2020 2020 4765 6e65 7261 7465          Generate
-00019e60: 2072 6177 6d61 7020 7375 7266 6163 6573   rawmap surfaces
-00019e70: 2069 6620 7477 6f20 6861 6c66 206d 6170   if two half map
-00019e80: 7320 616e 6420 7261 776d 6170 2061 6e64  s and rawmap and
-00019e90: 2072 6177 6d61 7020 636f 6e74 6f75 7220   rawmap contour 
-00019ea0: 6172 6520 7468 6572 650a 0a20 2020 2020  are there..     
-00019eb0: 2020 203a 7061 7261 6d20 6368 696d 6572     :param chimer
-00019ec0: 6161 7070 3a20 6269 6e61 7279 2076 616c  aapp: binary val
-00019ed0: 7565 2074 6f20 6368 6563 6b20 6966 2043  ue to check if C
-00019ee0: 6869 6d65 7261 5820 6973 2074 6865 7265  himeraX is there
-00019ef0: 2070 726f 7065 726c 790a 2020 2020 2020   properly.      
-00019f00: 2020 3a72 6574 7572 6e3a 204e 6f6e 650a    :return: None.
-00019f10: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00019f20: 2020 2020 2023 2072 6177 6d61 7072 6520       # rawmapre 
-00019f30: 3d20 272a 5f72 6177 6d61 702e 6d61 7027  = '*_rawmap.map'
-00019f40: 0a20 2020 2020 2020 2023 2072 6177 6d61  .        # rawma
-00019f50: 706e 616d 6520 3d20 676c 6f62 2e67 6c6f  pname = glob.glo
-00019f60: 6228 7365 6c66 2e77 6f72 6b64 6972 202b  b(self.workdir +
-00019f70: 2072 6177 6d61 7072 6529 0a20 2020 2020   rawmapre).     
-00019f80: 2020 2069 6620 7365 6c66 2e68 6d6f 6464     if self.hmodd
-00019f90: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00019fa0: 2073 656c 662e 686d 6576 656e 2069 7320   self.hmeven is 
-00019fb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00019fc0: 2020 2020 2020 7261 776d 6170 6e61 6d65        rawmapname
-00019fd0: 203d 2073 656c 662e 6669 6e64 7261 776d   = self.findrawm
-00019fe0: 6170 2829 0a20 2020 2020 2020 2065 6c73  ap().        els
-00019ff0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001a000: 6177 6d61 706e 616d 6520 3d20 4e6f 6e65  awmapname = None
-0001a010: 0a0a 2020 2020 2020 2020 6269 6e64 6973  ..        bindis
-0001a020: 706c 6179 203d 206f 732e 6765 7465 6e76  play = os.getenv
-0001a030: 2827 4449 5350 4c41 5927 290a 0a20 2020  ('DISPLAY')..   
-0001a040: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001a050: 2020 2020 2020 7261 776d 6170 636c 203d        rawmapcl =
-0001a060: 2073 656c 662e 7261 776d 6170 636c 2829   self.rawmapcl()
-0001a070: 0a20 2020 2020 2020 2065 7863 6570 743a  .        except:
-0001a080: 0a20 2020 2020 2020 2020 2020 2072 6177  .            raw
-0001a090: 6d61 7063 6c20 3d20 4e6f 6e65 0a20 2020  mapcl = None.   
-0001a0a0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0001a0b0: 5072 6f62 6c65 6d20 7769 7468 2072 6177  Problem with raw
-0001a0c0: 206d 6170 2063 6f6e 746f 7572 206c 6576   map contour lev
-0001a0d0: 656c 2063 616c 6375 6c61 7469 6f6e 2729  el calculation')
-0001a0e0: 0a0a 2020 2020 2020 2020 6966 2028 7365  ..        if (se
-0001a0f0: 6c66 2e68 6d6f 6464 2069 7320 6e6f 7420  lf.hmodd is not 
-0001a100: 4e6f 6e65 2061 6e64 2073 656c 662e 686d  None and self.hm
-0001a110: 6576 656e 2069 7320 6e6f 7420 4e6f 6e65  even is not None
-0001a120: 2920 616e 6420 7261 776d 6170 6e61 6d65  ) and rawmapname
-0001a130: 2061 6e64 2072 6177 6d61 7063 6c20 6973   and rawmapcl is
-0001a140: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
-0001a150: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-0001a160: 7469 6d65 6974 2e64 6566 6175 6c74 5f74  timeit.default_t
-0001a170: 696d 6572 2829 0a20 2020 2020 2020 2020  imer().         
-0001a180: 2020 2065 7272 6c69 7374 203d 205b 5d0a     errlist = [].
-0001a190: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-0001a1a0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-0001a1b0: 6173 656e 616d 6528 7261 776d 6170 6e61  asename(rawmapna
-0001a1c0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0001a1d0: 6c6f 6343 4849 4d45 5241 203d 2063 6869  locCHIMERA = chi
-0001a1e0: 6d65 7261 6170 700a 2020 2020 2020 2020  meraapp.        
-0001a1f0: 2020 2020 2320 7261 776d 6170 2073 7572      # rawmap sur
-0001a200: 6661 6365 2076 6965 7720 616c 6f6e 650a  face view alone.
-0001a210: 2020 2020 2020 2020 2020 2020 7261 776d              rawm
-0001a220: 6170 6368 696d 6572 6163 6d64 203d 2072  apchimeracmd = r
-0001a230: 6177 6d61 706e 616d 6520 2b20 275f 6368  awmapname + '_ch
-0001a240: 696d 6572 612e 6378 6327 0a20 2020 2020  imera.cxc'.     
-0001a250: 2020 2020 2020 2061 7373 656d 626c 6520         assemble 
-0001a260: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0001a270: 2020 2020 7769 7468 206f 7065 6e28 7261      with open(ra
-0001a280: 776d 6170 6368 696d 6572 6163 6d64 2c20  wmapchimeracmd, 
-0001a290: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
-0001a2a0: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
-0001a2b0: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-0001a2c0: 2020 2020 2020 2020 2320 4368 696d 6572          # Chimer
-0001a2d0: 6120 7665 7273 696f 6e0a 2020 2020 2020  a version.      
-0001a2e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001a2f0: 276f 7065 6e20 6363 7034 3a27 202b 2073  'open ccp4:' + s
-0001a300: 7472 286d 6170 6e61 6d65 2920 2b20 275c  tr(mapname) + '\
-0001a310: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-0001a320: 2020 2020 2020 2023 2022 766f 6c75 6d65         # "volume
-0001a330: 2023 3020 7374 796c 6520 7375 7266 6163   #0 style surfac
-0001a340: 6520 6578 7061 6e64 5369 6e67 6c65 506c  e expandSinglePl
-0001a350: 616e 6520 5472 7565 2022 202b 2027 5c6e  ane True " + '\n
-0001a360: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001a370: 2020 2020 2020 2320 2276 6f6c 756d 6520        # "volume 
-0001a380: 2330 2063 6f6c 6f72 2023 4238 3836 3042  #0 color #B8860B
-0001a390: 2073 7465 7020 3120 2220 2b20 636f 6e74   step 1 " + cont
-0001a3a0: 6f75 7220 2b20 275c 6e27 0a20 2020 2020  our + '\n'.     
-0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a3c0: 2022 7365 7420 7072 6f6a 6563 7469 6f6e   "set projection
-0001a3d0: 206f 7274 686f 6772 6170 6869 6322 202b   orthographic" +
-0001a3e0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001a3f0: 2020 2020 2020 2020 2020 2320 2273 7572            # "sur
-0001a400: 6674 7261 6e73 7020 3530 2220 2b20 275c  ftransp 50" + '\
-0001a410: 6e27 2020 2320 6d61 6b65 2074 6865 2073  n'  # make the s
-0001a420: 7572 6661 6365 2061 206c 6974 746c 6520  urface a little 
-0001a430: 6269 7420 7365 652d 7468 726f 7567 680a  bit see-through.
-0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a450: 2020 2020 2320 2262 6163 6b67 726f 756e      # "backgroun
-0001a460: 6420 736f 6c69 6420 6c69 6768 7420 6772  d solid light gr
-0001a470: 6179 2220 2b20 275c 6e27 0a20 2020 2020  ay" + '\n'.     
-0001a480: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a490: 2022 636f 7079 2066 696c 6520 2220 2b20   "copy file " + 
-0001a4a0: 7374 7228 7365 6c66 2e6d 6170 6e61 6d65  str(self.mapname
-0001a4b0: 2920 2b20 225f 7a73 7572 6661 6365 2e6a  ) + "_zsurface.j
-0001a4c0: 7065 6722 202b 2022 2073 7570 6572 7361  peg" + " supersa
-0001a4d0: 6d70 6c65 2033 2077 6964 7468 2031 3230  mple 3 width 120
-0001a4e0: 3020 6865 6967 6874 2031 3230 3022 202b  0 height 1200" +
-0001a4f0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001a500: 2020 2020 2020 2020 2020 2320 2274 7572            # "tur
-0001a510: 6e20 7820 2d39 3022 202b 2027 5c6e 270a  n x -90" + '\n'.
-0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a530: 2020 2020 2320 2263 656e 7465 7222 202b      # "center" +
-0001a540: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001a550: 2020 2020 2020 2020 2020 2320 2263 6f70            # "cop
-0001a560: 7920 6669 6c65 2022 202b 2073 7472 2873  y file " + str(s
-0001a570: 656c 662e 6d61 706e 616d 6529 202b 2022  elf.mapname) + "
-0001a580: 5f78 7375 7266 6163 652e 6a70 6567 2220  _xsurface.jpeg" 
-0001a590: 2b20 2220 7375 7065 7273 616d 706c 6520  + " supersample 
-0001a5a0: 3320 7769 6474 6820 3132 3030 2068 6569  3 width 1200 hei
-0001a5b0: 6768 7420 3132 3030 2220 2b20 275c 6e27  ght 1200" + '\n'
-0001a5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a5d0: 2020 2020 2023 2022 7475 726e 207a 202d       # "turn z -
-0001a5e0: 3930 2220 2b20 275c 6e27 0a20 2020 2020  90" + '\n'.     
-0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a600: 2022 6365 6e74 6572 2220 2b20 275c 6e27   "center" + '\n'
-0001a610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a620: 2020 2020 2023 2022 636f 7079 2066 696c       # "copy fil
-0001a630: 6520 2220 2b20 7374 7228 7365 6c66 2e6d  e " + str(self.m
-0001a640: 6170 6e61 6d65 2920 2b20 225f 7973 7572  apname) + "_ysur
-0001a650: 6661 6365 2e6a 7065 6722 202b 2022 2073  face.jpeg" + " s
-0001a660: 7570 6572 7361 6d70 6c65 2033 2077 6964  upersample 3 wid
-0001a670: 7468 2031 3230 3020 6865 6967 6874 2031  th 1200 height 1
-0001a680: 3230 3022 202b 2027 5c6e 270a 2020 2020  200" + '\n'.    
-0001a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6a0: 2320 2263 6c6f 7365 2061 6c6c 2220 2b20  # "close all" + 
-0001a6b0: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
-0001a6c0: 2020 2020 2020 2020 2023 2022 7374 6f70           # "stop
-0001a6d0: 220a 0a20 2020 2020 2020 2020 2020 2020  "..             
-0001a6e0: 2020 2020 2020 2023 2043 6869 6d65 7261         # Chimera
-0001a6f0: 5820 7665 7273 696f 6e0a 2020 2020 2020  X version.      
-0001a700: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-0001a710: 7065 6e20 2220 2b20 7374 7228 7261 776d  pen " + str(rawm
-0001a720: 6170 6e61 6d65 2920 2b20 2220 666f 726d  apname) + " form
-0001a730: 6174 2063 6370 3422 202b 2027 5c6e 270a  at ccp4" + '\n'.
+000180f0: 2020 696d 7920 3d20 496d 6167 652e 6672    imy = Image.fr
+00018100: 6f6d 6172 7261 7928 7972 6f74 6174 6529  omarray(yrotate)
+00018110: 2e72 6573 697a 6528 286e 6577 7769 6474  .resize((newwidt
+00018120: 682c 2033 3030 292c 2049 6d61 6765 2e52  h, 300), Image.R
+00018130: 6573 616d 706c 696e 672e 4c41 4e43 5a4f  esampling.LANCZO
+00018140: 5329 0a20 2020 2020 2020 2020 2020 2020  S).             
+00018150: 2020 2020 2020 2020 2020 2069 6d79 2e73             imy.s
+00018160: 6176 6528 7973 6361 6c65 6e61 6d65 290a  ave(yscalename).
+00018170: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00018180: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00018190: 2020 2020 7965 7272 203d 2027 5361 7669      yerr = 'Savi
+000181a0: 6e67 2073 6361 6c65 6420 7920 6365 6e74  ng scaled y cent
+000181b0: 7261 6c20 736c 6963 6520 6f66 206d 6173  ral slice of mas
+000181c0: 6b20 6572 723a 7b7d 272e 666f 726d 6174  k err:{}'.format
+000181d0: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
+000181e0: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+000181f0: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
+00018200: 6e64 2879 6572 7229 0a20 2020 2020 2020  nd(yerr).       
+00018210: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+00018220: 6572 722e 7772 6974 6528 7965 7272 202b  err.write(yerr +
+00018230: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+00018240: 2020 2020 2320 7a63 656e 7472 616c 203d      # zcentral =
+00018250: 206d 6170 2e66 756c 6c4d 6170 5b7a 6d69   map.fullMap[zmi
+00018260: 642c 203a 2c20 3a5d 0a20 2020 2020 2020  d, :, :].       
+00018270: 2020 2020 207a 6365 6e74 7261 6c20 3d20       zcentral = 
+00018280: 6d61 702e 6461 7461 5b7a 6d69 642c 203a  map.data[zmid, :
+00018290: 2c20 3a5d 0a20 2020 2020 2020 2020 2020  , :].           
+000182a0: 207a 6465 6e6f 6d20 3d20 287a 6365 6e74   zdenom = (zcent
+000182b0: 7261 6c2e 6d61 7828 2920 2d20 7a63 656e  ral.max() - zcen
+000182c0: 7472 616c 2e6d 696e 2829 2920 6966 207a  tral.min()) if z
+000182d0: 6365 6e74 7261 6c2e 6d61 7828 2920 213d  central.max() !=
+000182e0: 207a 6365 6e74 7261 6c2e 6d69 6e28 2920   zcentral.min() 
+000182f0: 656c 7365 2031 0a20 2020 2020 2020 2020  else 1.         
+00018300: 2020 207a 7265 7363 616c 6564 203d 2028     zrescaled = (
+00018310: 2828 7a63 656e 7472 616c 202d 207a 6365  ((zcentral - zce
+00018320: 6e74 7261 6c2e 6d69 6e28 2929 202a 2032  ntral.min()) * 2
+00018330: 3535 2e30 2920 2f20 7a64 656e 6f6d 292e  55.0) / zdenom).
+00018340: 6173 7479 7065 2827 7569 6e74 3827 290a  astype('uint8').
+00018350: 2020 2020 2020 2020 2020 2020 7a66 6c69              zfli
+00018360: 7070 6564 203d 206e 702e 666c 6970 7564  pped = np.flipud
+00018370: 287a 7265 7363 616c 6564 290a 2020 2020  (zrescaled).    
+00018380: 2020 2020 2020 2020 7a69 6d67 203d 2049          zimg = I
+00018390: 6d61 6765 2e66 726f 6d61 7272 6179 287a  mage.fromarray(z
+000183a0: 666c 6970 7065 6429 0a20 2020 2020 2020  flipped).       
+000183b0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000183c0: 2020 2020 2020 2020 2020 7a69 6d67 2e73            zimg.s
+000183d0: 6176 6528 7365 6c66 2e77 6f72 6b64 6972  ave(self.workdir
+000183e0: 202b 206d 6170 6e61 6d65 202b 2027 5f7a   + mapname + '_z
+000183f0: 6d61 736b 6365 6e74 7261 6c5f 736c 6963  maskcentral_slic
+00018400: 652e 6a70 6567 2729 0a20 2020 2020 2020  e.jpeg').       
+00018410: 2020 2020 2065 7863 6570 7420 494f 4572       except IOEr
+00018420: 726f 7220 6173 2069 6f65 7272 3a0a 2020  ror as ioerr:.  
+00018430: 2020 2020 2020 2020 2020 2020 2020 7a65                ze
+00018440: 7272 203d 2027 5361 7669 6e67 206f 7269  rr = 'Saving ori
+00018450: 6769 6e61 6c20 7a20 6365 6e74 7261 6c20  ginal z central 
+00018460: 736c 6963 6520 6f66 206d 6173 6b20 6572  slice of mask er
+00018470: 723a 7b7d 272e 666f 726d 6174 2869 6f65  r:{}'.format(ioe
+00018480: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
+00018490: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
+000184a0: 6e64 287a 6572 7229 0a20 2020 2020 2020  nd(zerr).       
+000184b0: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+000184c0: 6572 722e 7772 6974 6528 7a65 7272 202b  err.write(zerr +
+000184d0: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+000184e0: 2020 2020 7769 6474 682c 2068 6569 6768      width, heigh
+000184f0: 7420 3d20 7a69 6d67 2e73 697a 650a 2020  t = zimg.size.  
+00018500: 2020 2020 2020 2020 2020 7a73 6361 6c65            zscale
+00018510: 6e61 6d65 203d 2073 656c 662e 776f 726b  name = self.work
+00018520: 6469 7220 2b20 6d61 706e 616d 6520 2b20  dir + mapname + 
+00018530: 275f 7363 616c 6564 5f7a 6d61 736b 6365  '_scaled_zmaskce
+00018540: 6e74 7261 6c5f 736c 6963 652e 6a70 6567  ntral_slice.jpeg
+00018550: 270a 2020 2020 2020 2020 2020 2020 7472  '.            tr
+00018560: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00018570: 2020 2069 6620 7769 6474 6820 3e20 3330     if width > 30
+00018580: 3020 616e 6420 6865 6967 6874 203e 2033  0 and height > 3
+00018590: 3030 3a0a 2020 2020 2020 2020 2020 2020  00:.            
+000185a0: 2020 2020 2020 2020 6966 2077 6964 7468          if width
+000185b0: 203e 3d20 6865 6967 6874 3a0a 2020 2020   >= height:.    
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185d0: 2020 2020 6c61 7267 6572 7363 616c 6572      largerscaler
+000185e0: 203d 2033 3030 2e20 2f20 7769 6474 680a   = 300. / width.
+000185f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018600: 2020 2020 2020 2020 6e65 7768 6569 6768          newheigh
+00018610: 7420 3d20 696e 7428 6365 696c 286c 6172  t = int(ceil(lar
+00018620: 6765 7273 6361 6c65 7220 2a20 6865 6967  gerscaler * heig
+00018630: 6874 2929 0a20 2020 2020 2020 2020 2020  ht)).           
+00018640: 2020 2020 2020 2020 2020 2020 2069 6d7a               imz
+00018650: 203d 2049 6d61 6765 2e66 726f 6d61 7272   = Image.fromarr
+00018660: 6179 287a 666c 6970 7065 6429 2e72 6573  ay(zflipped).res
+00018670: 697a 6528 2833 3030 2c20 6e65 7768 6569  ize((300, newhei
+00018680: 6768 7429 2c20 496d 6167 652e 5265 7361  ght), Image.Resa
+00018690: 6d70 6c69 6e67 2e4c 414e 435a 4f53 290a  mpling.LANCZOS).
+000186a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186b0: 2020 2020 2020 2020 696d 7a2e 7361 7665          imz.save
+000186c0: 287a 7363 616c 656e 616d 6529 0a20 2020  (zscalename).   
+000186d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000186f0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00018700: 6172 6765 7273 6361 6c65 7220 3d20 3330  argerscaler = 30
+00018710: 302e 202f 2068 6569 6768 740a 2020 2020  0. / height.    
+00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018730: 2020 2020 6e65 7777 6964 7468 203d 2069      newwidth = i
+00018740: 6e74 2863 6569 6c28 6c61 7267 6572 7363  nt(ceil(largersc
+00018750: 616c 6572 202a 2077 6964 7468 2929 0a20  aler * width)). 
+00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018770: 2020 2020 2020 2069 6d7a 203d 2049 6d61         imz = Ima
+00018780: 6765 2e66 726f 6d61 7272 6179 287a 666c  ge.fromarray(zfl
+00018790: 6970 7065 6429 2e72 6573 697a 6528 286e  ipped).resize((n
+000187a0: 6577 7769 6474 682c 2033 3030 292c 2049  ewwidth, 300), I
+000187b0: 6d61 6765 2e52 6573 616d 706c 696e 672e  mage.Resampling.
+000187c0: 4c41 4e43 5a4f 5329 0a20 2020 2020 2020  LANCZOS).       
+000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187e0: 2069 6d7a 2e73 6176 6528 7a73 6361 6c65   imz.save(zscale
+000187f0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
+00018800: 2020 2020 2020 2020 2020 2320 696d 7a20            # imz 
+00018810: 3d20 496d 6167 652e 6672 6f6d 6172 7261  = Image.fromarra
+00018820: 7928 7a66 6c69 7070 6564 292e 7265 7369  y(zflipped).resi
+00018830: 7a65 2828 3330 302c 2033 3030 2929 0a20  ze((300, 300)). 
+00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018850: 2020 2023 2069 6d7a 2e73 6176 6528 7a73     # imz.save(zs
+00018860: 6361 6c65 6e61 6d65 290a 2020 2020 2020  calename).      
+00018870: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018890: 2020 2020 6966 2077 6964 7468 203e 3d20      if width >= 
+000188a0: 6865 6967 6874 3a0a 2020 2020 2020 2020  height:.        
+000188b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188c0: 7363 616c 6572 203d 2033 3030 2e20 2f20  scaler = 300. / 
+000188d0: 7769 6474 680a 2020 2020 2020 2020 2020  width.          
+000188e0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000188f0: 7768 6569 6768 7420 3d20 696e 7428 6365  wheight = int(ce
+00018900: 696c 2873 6361 6c65 7220 2a20 6865 6967  il(scaler * heig
+00018910: 6874 2929 0a20 2020 2020 2020 2020 2020  ht)).           
+00018920: 2020 2020 2020 2020 2020 2020 2069 6d7a               imz
+00018930: 203d 2049 6d61 6765 2e66 726f 6d61 7272   = Image.fromarr
+00018940: 6179 287a 666c 6970 7065 6429 2e72 6573  ay(zflipped).res
+00018950: 697a 6528 2833 3030 2c20 6e65 7768 6569  ize((300, newhei
+00018960: 6768 7429 2c20 496d 6167 652e 5265 7361  ght), Image.Resa
+00018970: 6d70 6c69 6e67 2e4c 414e 435a 4f53 290a  mpling.LANCZOS).
+00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018990: 2020 2020 2020 2020 696d 7a2e 7361 7665          imz.save
+000189a0: 287a 7363 616c 656e 616d 6529 0a20 2020  (zscalename).   
+000189b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000189d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000189e0: 6361 6c65 7220 3d20 3330 302e 202f 2068  caler = 300. / h
+000189f0: 6569 6768 740a 2020 2020 2020 2020 2020  eight.          
+00018a00: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00018a10: 7777 6964 7468 203d 2069 6e74 2863 6569  wwidth = int(cei
+00018a20: 6c28 7363 616c 6572 202a 2077 6964 7468  l(scaler * width
+00018a30: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00018a40: 2020 2020 2020 2020 2020 2069 6d7a 203d             imz =
+00018a50: 2049 6d61 6765 2e66 726f 6d61 7272 6179   Image.fromarray
+00018a60: 287a 666c 6970 7065 6429 2e72 6573 697a  (zflipped).resiz
+00018a70: 6528 286e 6577 7769 6474 682c 2033 3030  e((newwidth, 300
+00018a80: 292c 2049 6d61 6765 2e52 6573 616d 706c  ), Image.Resampl
+00018a90: 696e 672e 4c41 4e43 5a4f 5329 0a20 2020  ing.LANCZOS).   
+00018aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ab0: 2020 2020 2069 6d7a 2e73 6176 6528 7a73       imz.save(zs
+00018ac0: 6361 6c65 6e61 6d65 290a 2020 2020 2020  calename).      
+00018ad0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00018ae0: 2020 2020 2020 2020 2020 2020 2020 7a65                ze
+00018af0: 7272 203d 2027 5361 7669 6e67 206f 7269  rr = 'Saving ori
+00018b00: 6769 6e61 6c20 7a20 7363 616c 6564 2063  ginal z scaled c
+00018b10: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00018b20: 6d61 736b 2065 7272 3a7b 7d27 2e66 6f72  mask err:{}'.for
+00018b30: 6d61 7428 7379 732e 6578 635f 696e 666f  mat(sys.exc_info
+00018b40: 2829 5b31 5d29 0a20 2020 2020 2020 2020  ()[1]).         
+00018b50: 2020 2020 2020 2065 7272 6c69 7374 2e61         errlist.a
+00018b60: 7070 656e 6428 7a65 7272 290a 2020 2020  ppend(zerr).    
+00018b70: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00018b80: 7374 6465 7272 2e77 7269 7465 287a 6572  stderr.write(zer
+00018b90: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
+00018ba0: 2020 2020 2020 2063 736c 6963 656a 736f         cslicejso
+00018bb0: 6e20 3d20 6469 6374 2829 0a20 2020 2020  n = dict().     
+00018bc0: 2020 2020 2020 2063 736c 6963 656a 736f         cslicejso
+00018bd0: 6e5b 2778 275d 203d 206f 732e 7061 7468  n['x'] = os.path
+00018be0: 2e62 6173 656e 616d 6528 7873 6361 6c65  .basename(xscale
+00018bf0: 6e61 6d65 2920 6966 206f 732e 7061 7468  name) if os.path
+00018c00: 2e69 7366 696c 6528 7873 6361 6c65 6e61  .isfile(xscalena
+00018c10: 6d65 2920 656c 7365 204e 6f6e 650a 2020  me) else None.  
+00018c20: 2020 2020 2020 2020 2020 6373 6c69 6365            cslice
+00018c30: 6a73 6f6e 5b27 7927 5d20 3d20 6f73 2e70  json['y'] = os.p
+00018c40: 6174 682e 6261 7365 6e61 6d65 2879 7363  ath.basename(ysc
+00018c50: 616c 656e 616d 6529 2069 6620 6f73 2e70  alename) if os.p
+00018c60: 6174 682e 6973 6669 6c65 2879 7363 616c  ath.isfile(yscal
+00018c70: 656e 616d 6529 2065 6c73 6520 4e6f 6e65  ename) else None
+00018c80: 0a20 2020 2020 2020 2020 2020 2063 736c  .            csl
+00018c90: 6963 656a 736f 6e5b 277a 275d 203d 206f  icejson['z'] = o
+00018ca0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00018cb0: 7a73 6361 6c65 6e61 6d65 2920 6966 206f  zscalename) if o
+00018cc0: 732e 7061 7468 2e69 7366 696c 6528 7a73  s.path.isfile(zs
+00018cd0: 6361 6c65 6e61 6d65 2920 656c 7365 204e  calename) else N
+00018ce0: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
+00018cf0: 2061 6c6c 6d61 736b 6469 6374 5b6d 6170   allmaskdict[map
+00018d00: 6e61 6d65 5d20 3d20 6373 6c69 6365 6a73  name] = cslicejs
+00018d10: 6f6e 0a0a 2020 2020 2020 2020 6966 2065  on..        if e
+00018d20: 7272 6c69 7374 3a0a 2020 2020 2020 2020  rrlist:.        
+00018d30: 2020 2020 616c 6c6d 6173 6b64 6963 745b      allmaskdict[
+00018d40: 2765 7272 275d 203d 207b 276d 6173 6b5f  'err'] = {'mask_
+00018d50: 6365 6e74 7261 6c5f 736c 6963 655f 6572  central_slice_er
+00018d60: 7227 3a20 6572 726c 6973 747d 0a20 2020  r': errlist}.   
+00018d70: 2020 2020 2066 696e 616c 6469 6374 203d       finaldict =
+00018d80: 207b 276d 6173 6b5f 6365 6e74 7261 6c5f   {'mask_central_
+00018d90: 736c 6963 6527 3a20 616c 6c6d 6173 6b64  slice': allmaskd
+00018da0: 6963 747d 0a0a 2020 2020 2020 2020 7472  ict}..        tr
+00018db0: 793a 0a20 2020 2020 2020 2020 2020 2077  y:.            w
+00018dc0: 6974 6820 636f 6465 6373 2e6f 7065 6e28  ith codecs.open(
+00018dd0: 7365 6c66 2e77 6f72 6b64 6972 202b 2073  self.workdir + s
+00018de0: 656c 662e 6d61 706e 616d 6520 2b20 275f  elf.mapname + '_
+00018df0: 6d61 736b 6365 6e74 7261 6c73 6c69 6365  maskcentralslice
+00018e00: 2e6a 736f 6e27 2c20 2777 272c 0a20 2020  .json', 'w',.   
+00018e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e20: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
+00018e30: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
+00018e40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018e50: 2020 6a73 6f6e 2e64 756d 7028 6669 6e61    json.dump(fina
+00018e60: 6c64 6963 742c 2066 290a 2020 2020 2020  ldict, f).      
+00018e70: 2020 6578 6365 7074 2049 4f45 7272 6f72    except IOError
+00018e80: 2061 7320 696f 6572 723a 0a20 2020 2020   as ioerr:.     
+00018e90: 2020 2020 2020 2070 7269 6e74 2827 5361         print('Sa
+00018ea0: 7669 6e67 206d 6173 6b73 2063 656e 7472  ving masks centr
+00018eb0: 616c 2073 6c69 6365 7320 746f 206a 736f  al slices to jso
+00018ec0: 6e20 6572 723a 207b 7d27 2e66 6f72 6d61  n err: {}'.forma
+00018ed0: 7428 696f 6572 7229 290a 0a20 2020 2020  t(ioerr))..     
+00018ee0: 2020 2065 6e64 203d 2074 696d 6569 742e     end = timeit.
+00018ef0: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
+00018f00: 2020 2020 2020 2020 7072 696e 7428 274d          print('M
+00018f10: 616b 7343 656e 7472 616c 536c 6963 6520  aksCentralSlice 
+00018f20: 7469 6d65 3a20 2573 2720 2520 2865 6e64  time: %s' % (end
+00018f30: 202d 2073 7461 7274 2929 0a20 2020 2020   - start)).     
+00018f40: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
+00018f50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018f60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
+00018f70: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00018f80: 204e 6f6e 650a 0a20 2020 2064 6566 2063   None..    def c
+00018f90: 6865 636b 7674 7028 7365 6c66 293a 0a20  heckvtp(self):. 
+00018fa0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00018fb0: 2020 2020 2020 2020 4368 6563 6b20 6966          Check if
+00018fc0: 2074 6865 7265 2069 7320 6120 7674 7020   there is a vtp 
+00018fd0: 6669 6c65 2065 7869 7374 206f 7220 6e6f  file exist or no
+00018fe0: 740a 0a20 2020 2020 2020 203a 7265 7475  t..        :retu
+00018ff0: 726e 3a0a 2020 2020 2020 2020 2222 220a  rn:.        """.
+00019000: 0a0a 2020 2020 2020 2020 7674 7072 6567  ..        vtpreg
+00019010: 203d 2073 656c 662e 776f 726b 6469 7220   = self.workdir 
+00019020: 2b20 272a 2e76 7470 270a 2020 2020 2020  + '*.vtp'.      
+00019030: 2020 676c 6f62 7265 7375 6c74 203d 2067    globresult = g
+00019040: 6c6f 622e 676c 6f62 2876 7470 7265 6729  lob.glob(vtpreg)
+00019050: 0a20 2020 2020 2020 2076 7470 6e61 6d65  .        vtpname
+00019060: 203d 2027 7b7d 7b7d 5f7b 7d2e 7674 7027   = '{}{}_{}.vtp'
+00019070: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
+00019080: 6b64 6972 2c20 7365 6c66 2e6d 6170 6e61  kdir, self.mapna
+00019090: 6d65 2c20 7365 6c66 2e63 6c29 0a20 2020  me, self.cl).   
+000190a0: 2020 2020 2069 6620 7674 706e 616d 6520       if vtpname 
+000190b0: 696e 2067 6c6f 6272 6573 756c 743a 0a20  in globresult:. 
+000190c0: 2020 2020 2020 2020 2020 2076 7470 6675             vtpfu
+000190d0: 6c6c 6e61 6d65 203d 2076 7470 6e61 6d65  llname = vtpname
+000190e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000190f0: 6e74 2827 2573 2065 7869 7374 2061 6c72  nt('%s exist alr
+00019100: 6561 6479 2e27 2025 2076 7470 6e61 6d65  eady.' % vtpname
+00019110: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00019120: 7475 726e 2076 7470 6675 6c6c 6e61 6d65  turn vtpfullname
+00019130: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00019140: 2020 2020 2020 2020 2020 2069 6620 676c             if gl
+00019150: 6f62 7265 7375 6c74 2069 7320 6e6f 7420  obresult is not 
+00019160: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00019170: 2020 2020 2020 7072 696e 7428 2776 7470        print('vtp
+00019180: 2066 696c 653a 2025 7320 6578 6973 742c   file: %s exist,
+00019190: 2070 6c65 6173 6520 6368 6563 6b2e 2720   please check.' 
+000191a0: 2520 676c 6f62 7265 7375 6c74 290a 2020  % globresult).  
+000191b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000191c0: 204e 6f6e 650a 0a20 2020 2064 6566 2067   None..    def g
+000191d0: 656e 7674 7028 7365 6c66 2c20 6675 6c6c  envtp(self, full
+000191e0: 6d61 7070 6174 6829 3a0a 2020 2020 2020  mappath):.      
+000191f0: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
+00019200: 2020 2047 656e 6572 6174 6520 7674 7020     Generate vtp 
+00019210: 6669 6c65 2066 6f72 206e 6f6e 2d73 6572  file for non-ser
+00019220: 7665 7220 696e 7075 740a 0a20 2020 2020  ver input..     
+00019230: 2020 203a 7061 7261 6d20 6675 6c6c 6d61     :param fullma
+00019240: 7070 6174 683a 0a20 2020 2020 2020 203a  ppath:.        :
+00019250: 7265 7475 726e 3a0a 2020 2020 2020 2020  return:.        
+00019260: 2222 220a 0a20 2020 2020 2020 206d 6573  """..        mes
+00019270: 686d 616b 6572 203d 2046 616c 7365 0a20  hmaker = False. 
+00019280: 2020 2020 2020 2069 6620 4d45 5348 4d41         if MESHMA
+00019290: 4b45 5250 4154 4820 6973 206e 6f74 204e  KERPATH is not N
+000192a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000192b0: 206d 6573 686d 616b 6572 203d 2054 7275   meshmaker = Tru
+000192c0: 650a 2020 2020 2020 2020 2020 2020 6d65  e.            me
+000192d0: 7368 6d61 6b65 7270 6174 6820 3d20 4d45  shmakerpath = ME
+000192e0: 5348 4d41 4b45 5250 4154 480a 2020 2020  SHMAKERPATH.    
+000192f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019300: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00019310: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00019320: 7420 6669 6e64 5f65 7865 6375 7461 626c  t find_executabl
+00019330: 6528 276d 6573 686d 616b 6572 2729 2069  e('meshmaker') i
+00019340: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+00019350: 2020 2020 2020 2020 2020 206d 6573 686d             meshm
+00019360: 616b 6572 7061 7468 203d 2066 696e 645f  akerpath = find_
+00019370: 6578 6563 7574 6162 6c65 2827 6d65 7368  executable('mesh
+00019380: 6d61 6b65 7227 290a 2020 2020 2020 2020  maker').        
+00019390: 2020 2020 2020 2020 6d65 7368 6d61 6b65          meshmake
+000193a0: 7220 3d20 5472 7565 0a20 2020 2020 2020  r = True.       
+000193b0: 2020 2020 2065 7863 6570 7420 4173 7365       except Asse
+000193c0: 7274 696f 6e45 7272 6f72 3a0a 2020 2020  rtionError:.    
+000193d0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+000193e0: 7374 6465 7272 2e77 7269 7465 2827 6d65  stderr.write('me
+000193f0: 7368 6d61 6b65 7220 6578 6563 7574 6162  shmaker executab
+00019400: 6c65 2069 7320 6e6f 7420 7468 6572 652e  le is not there.
+00019410: 5c6e 2729 0a0a 2020 2020 2020 2020 6966  \n')..        if
+00019420: 206d 6573 686d 616b 6572 2061 6e64 2073   meshmaker and s
+00019430: 656c 662e 636c 2069 7320 6e6f 7420 4e6f  elf.cl is not No
+00019440: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00019450: 6f75 7476 7470 6e61 6d65 203d 2027 7b7d  outvtpname = '{}
+00019460: 7b7d 5f7b 7d27 2e66 6f72 6d61 7428 7365  {}_{}'.format(se
+00019470: 6c66 2e77 6f72 6b64 6972 2c20 7365 6c66  lf.workdir, self
+00019480: 2e6d 6170 6e61 6d65 2c20 7365 6c66 2e63  .mapname, self.c
+00019490: 6c29 0a20 2020 2020 2020 2020 2020 2063  l).            c
+000194a0: 6d64 203d 206d 6573 686d 616b 6572 7061  md = meshmakerpa
+000194b0: 7468 202b 2027 2027 202b 2066 756c 6c6d  th + ' ' + fullm
+000194c0: 6170 7061 7468 202b 2027 202d 6320 2720  appath + ' -c ' 
+000194d0: 2b20 7374 7228 7365 6c66 2e63 6c29 202b  + str(self.cl) +
+000194e0: 2027 202d 6f20 2720 2b20 6f75 7476 7470   ' -o ' + outvtp
+000194f0: 6e61 6d65 202b 2027 202d 4420 2d76 270a  name + ' -D -v'.
+00019500: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00019510: 6573 7320 3d20 7375 6270 726f 6365 7373  ess = subprocess
+00019520: 2e50 6f70 656e 2863 6d64 2c20 7368 656c  .Popen(cmd, shel
+00019530: 6c3d 5472 7565 2c20 6578 6563 7574 6162  l=True, executab
+00019540: 6c65 3d27 2f62 696e 2f62 6173 6827 290a  le='/bin/bash').
+00019550: 2020 2020 2020 2020 2020 2020 636f 6465              code
+00019560: 203d 2070 726f 6365 7373 2e77 6169 7428   = process.wait(
+00019570: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00019580: 2063 6f64 6520 3d3d 2030 3a0a 2020 2020   code == 0:.    
+00019590: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+000195a0: 6c74 203d 206f 7574 7674 706e 616d 6520  lt = outvtpname 
+000195b0: 2b20 272e 7674 7027 0a20 2020 2020 2020  + '.vtp'.       
+000195c0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000195d0: 5072 6f64 7563 6520 6669 6c65 3a20 2573  Produce file: %s
+000195e0: 2073 7563 6365 7373 6675 6c6c 7927 2025   successfully' %
+000195f0: 2072 6573 756c 7429 0a20 2020 2020 2020   result).       
+00019600: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00019610: 7265 7375 6c74 0a20 2020 2020 2020 2020  result.         
+00019620: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00019630: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00019640: 4d65 7368 6d61 6b65 7220 6469 6420 6e6f  Meshmaker did no
+00019650: 7420 7072 6f64 7563 6520 7468 6520 7674  t produce the vt
+00019660: 7020 6669 6c65 2063 6865 636b 2074 6865  p file check the
+00019670: 2069 6e70 7574 732e 2729 0a20 2020 2020   inputs.').     
+00019680: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00019690: 6e20 4e6f 6e65 0a20 2020 2020 2020 2065  n None.        e
+000196a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000196b0: 2070 7269 6e74 2827 4469 6420 6e6f 7420   print('Did not 
+000196c0: 6669 6e64 2070 726f 7065 7220 6d65 7368  find proper mesh
+000196d0: 6d61 6b65 7220 6f72 2074 6865 206e 6f20  maker or the no 
+000196e0: 636f 6e74 6f75 7220 6c65 7665 6c20 6176  contour level av
+000196f0: 6169 6c61 626c 6520 2e27 290a 0a20 2020  ailable .')..   
+00019700: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+00019710: 2020 2064 6566 2077 7269 7465 5f69 6d61     def write_ima
+00019720: 6765 2869 6d61 6765 4669 6c65 2c20 7265  ge(imageFile, re
+00019730: 6e57 696e 293a 0a20 2020 2020 2020 2023  nWin):.        #
+00019740: 2057 7269 7465 2074 6865 2063 7572 7265   Write the curre
+00019750: 6e74 2076 6965 7720 6f66 2074 6865 2072  nt view of the r
+00019760: 656e 6465 7265 7220 746f 2061 6e20 696d  enderer to an im
+00019770: 6167 650a 2020 2020 2020 2020 6966 2069  age.        if i
+00019780: 6d61 6765 4669 6c65 3a0a 2020 2020 2020  mageFile:.      
+00019790: 2020 2020 2020 7772 6974 6572 203d 2076        writer = v
+000197a0: 746b 2e76 746b 424d 5057 7269 7465 7228  tk.vtkBMPWriter(
+000197b0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+000197c0: 6e64 6f77 746f 5f69 6d61 6765 5f66 696c  ndowto_image_fil
+000197d0: 7465 7220 3d20 7674 6b2e 7674 6b57 696e  ter = vtk.vtkWin
+000197e0: 646f 7754 6f49 6d61 6765 4669 6c74 6572  dowToImageFilter
+000197f0: 2829 0a20 2020 2020 2020 2020 2020 2077  ().            w
+00019800: 696e 646f 7774 6f5f 696d 6167 655f 6669  indowto_image_fi
+00019810: 6c74 6572 2e53 6574 496e 7075 7428 7265  lter.SetInput(re
+00019820: 6e57 696e 290a 2020 2020 2020 2020 2020  nWin).          
+00019830: 2020 2320 696d 6167 6520 7175 616c 6974    # image qualit
+00019840: 790a 2020 2020 2020 2020 2020 2020 7769  y.            wi
+00019850: 6e64 6f77 746f 5f69 6d61 6765 5f66 696c  ndowto_image_fil
+00019860: 7465 722e 5365 7449 6e70 7574 4275 6666  ter.SetInputBuff
+00019870: 6572 5479 7065 546f 5247 4228 290a 0a20  erTypeToRGB().. 
+00019880: 2020 2020 2020 2020 2020 2077 7269 7465             write
+00019890: 722e 5365 7446 696c 654e 616d 6528 696d  r.SetFileName(im
+000198a0: 6167 6546 696c 6529 0a20 2020 2020 2020  ageFile).       
+000198b0: 2020 2020 2077 7269 7465 722e 5365 7449       writer.SetI
+000198c0: 6e70 7574 436f 6e6e 6563 7469 6f6e 2877  nputConnection(w
+000198d0: 696e 646f 7774 6f5f 696d 6167 655f 6669  indowto_image_fi
+000198e0: 6c74 6572 2e47 6574 4f75 7470 7574 506f  lter.GetOutputPo
+000198f0: 7274 2829 290a 2020 2020 2020 2020 2020  rt()).          
+00019900: 2020 7772 6974 6572 2e57 7269 7465 2829    writer.Write()
+00019910: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00019920: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00019930: 2052 756e 7469 6d65 4572 726f 7228 274e   RuntimeError('N
+00019940: 6565 6420 6120 6669 6c65 6e61 6d65 2e27  eed a filename.'
+00019950: 290a 0a20 2020 2023 2052 6177 6d61 7020  )..    # Rawmap 
+00019960: 7375 7266 6163 6520 7669 6577 2077 6865  surface view whe
+00019970: 6e20 7477 6f20 6861 6c66 206d 6170 7320  n two half maps 
+00019980: 6172 6520 6769 7665 6e0a 2020 2020 6465  are given.    de
+00019990: 6620 7261 776d 6170 636c 2873 656c 6629  f rawmapcl(self)
+000199a0: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
+000199b0: 2020 2020 2020 2020 2020 2043 616c 6375             Calcu
+000199c0: 6c61 7465 2061 2063 6f72 7265 7370 6f6e  late a correspon
+000199d0: 6469 6e67 2027 7265 636f 6d6d 656e 6465  ding 'recommende
+000199e0: 6420 636f 6e74 6f75 7220 6c65 7665 6c27  d contour level'
+000199f0: 2062 6173 6564 206f 6e20 7468 6520 7265   based on the re
+00019a00: 636f 6d6d 656e 6465 6420 636f 6e74 6f75  commended contou
+00019a10: 7220 6c65 7665 6c0a 2020 2020 2020 2020  r level.        
+00019a20: 2020 2020 2868 6176 6520 7472 6965 6420      (have tried 
+00019a30: 6d61 7463 6869 6e67 2074 6865 2076 616c  matching the val
+00019a40: 7565 2073 6361 6c65 2077 6869 6368 2067  ue scale which g
+00019a50: 6574 2077 6f72 7365 2072 6573 756c 7420  et worse result 
+00019a60: 7468 616e 2074 6869 7320 6f6e 6529 0a0a  than this one)..
+00019a70: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00019a80: 2041 2066 6c6f 6174 2077 6869 6368 2067   A float which g
+00019a90: 6976 6520 7468 6520 636f 6e74 6f75 7220  ive the contour 
+00019aa0: 6c65 7665 6c0a 2020 2020 2020 2020 2222  level.        ""
+00019ab0: 220a 0a20 2020 2020 2020 2023 206e 756d  "..        # num
+00019ac0: 766f 7820 3d20 6c65 6e28 7365 6c66 2e6d  vox = len(self.m
+00019ad0: 6170 2e66 756c 6c4d 6170 5b73 656c 662e  ap.fullMap[self.
+00019ae0: 6d61 702e 6675 6c6c 4d61 7020 3e3d 2073  map.fullMap >= s
+00019af0: 656c 662e 636c 5d29 0a20 2020 2020 2020  elf.cl]).       
+00019b00: 206e 756d 766f 7820 3d20 6c65 6e28 7365   numvox = len(se
+00019b10: 6c66 2e6d 6170 2e64 6174 615b 7365 6c66  lf.map.data[self
+00019b20: 2e6d 6170 2e64 6174 6120 3e3d 2073 656c  .map.data >= sel
+00019b30: 662e 636c 5d29 0a20 2020 2020 2020 2072  f.cl]).        r
+00019b40: 6177 6d61 7020 3d20 7365 6c66 2e72 6177  awmap = self.raw
+00019b50: 6d61 700a 2020 2020 2020 2020 2320 7261  map.        # ra
+00019b60: 7764 6174 6120 3d20 7261 776d 6170 2e66  wdata = rawmap.f
+00019b70: 756c 6c4d 6170 2e66 6c61 7474 656e 2829  ullMap.flatten()
+00019b80: 0a20 2020 2020 2020 2072 6177 6461 7461  .        rawdata
+00019b90: 203d 2072 6177 6d61 702e 6461 7461 2e66   = rawmap.data.f
+00019ba0: 6c61 7474 656e 2829 0a20 2020 2020 2020  latten().       
+00019bb0: 2066 6c61 7472 6177 203d 2073 6f72 7465   flatraw = sorte
+00019bc0: 6428 7261 7764 6174 6129 5b3a 3a2d 315d  d(rawdata)[::-1]
+00019bd0: 0a20 2020 2020 2020 2072 6177 636c 203d  .        rawcl =
+00019be0: 2066 6c61 7472 6177 5b6e 756d 766f 785d   flatraw[numvox]
+00019bf0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00019c00: 2072 6177 636c 0a0a 0a20 2020 2064 6566   rawcl...    def
+00019c10: 2066 696e 6472 6177 6d61 7028 7365 6c66   findrawmap(self
+00019c20: 293a 0a0a 2020 2020 2020 2020 6966 2073  ):..        if s
+00019c30: 656c 662e 656d 6469 643a 0a20 2020 2020  elf.emdid:.     
+00019c40: 2020 2020 2020 2072 6177 6d61 706e 616d         rawmapnam
+00019c50: 6520 3d20 277b 7d65 6d64 5f7b 7d5f 7261  e = '{}emd_{}_ra
+00019c60: 776d 6170 2e6d 6170 272e 666f 726d 6174  wmap.map'.format
+00019c70: 2873 656c 662e 776f 726b 6469 722c 2073  (self.workdir, s
+00019c80: 656c 662e 656d 6469 6429 0a20 2020 2020  elf.emdid).     
+00019c90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00019ca0: 2020 2020 206f 6464 6e61 6d65 203d 206f       oddname = o
+00019cb0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00019cc0: 7365 6c66 2e68 6d6f 6464 2e66 756c 6c6e  self.hmodd.fulln
+00019cd0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00019ce0: 2065 7665 6e6e 616d 6520 3d20 6f73 2e70   evenname = os.p
+00019cf0: 6174 682e 6261 7365 6e61 6d65 2873 656c  ath.basename(sel
+00019d00: 662e 686d 6576 656e 2e66 756c 6c6e 616d  f.hmeven.fullnam
+00019d10: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+00019d20: 6177 6d61 706e 616d 6520 3d20 277b 7d7b  awmapname = '{}{
+00019d30: 7d5f 7b7d 5f72 6177 6d61 702e 6d61 7027  }_{}_rawmap.map'
+00019d40: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
+00019d50: 6b64 6972 2c20 6f64 646e 616d 652c 2065  kdir, oddname, e
+00019d60: 7665 6e6e 616d 6529 0a0a 2020 2020 2020  venname)..      
+00019d70: 2020 6966 2073 656c 662e 686d 6f64 6420    if self.hmodd 
+00019d80: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00019d90: 7365 6c66 2e68 6d65 7665 6e20 6973 206e  self.hmeven is n
+00019da0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00019db0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00019dc0: 6973 6669 6c65 2872 6177 6d61 706e 616d  isfile(rawmapnam
+00019dd0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00019de0: 2020 2020 7265 7475 726e 2072 6177 6d61      return rawma
+00019df0: 706e 616d 650a 2020 2020 2020 2020 2020  pname.          
+00019e00: 2020 656c 7365 3a0a 0a20 2020 2020 2020    else:..       
+00019e10: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+00019e20: 4261 7365 206f 6e20 7468 6520 6861 6c66  Base on the half
+00019e30: 206d 6170 732c 2072 6177 6d61 7020 6973   maps, rawmap is
+00019e40: 206e 6f74 2070 726f 6475 6365 6421 2127   not produced!!'
+00019e50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019e60: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+00019e70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00019e80: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00019e90: 6f6e 650a 0a0a 2020 2020 6465 6620 7261  one...    def ra
+00019ea0: 776d 6170 7375 7266 6163 655f 6368 696d  wmapsurface_chim
+00019eb0: 6572 6128 7365 6c66 2c20 6368 696d 6572  era(self, chimer
+00019ec0: 6161 7070 293a 0a20 2020 2020 2020 2022  aapp):.        "
+00019ed0: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
+00019ee0: 4765 6e65 7261 7465 2072 6177 6d61 7020  Generate rawmap 
+00019ef0: 7375 7266 6163 6573 2069 6620 7477 6f20  surfaces if two 
+00019f00: 6861 6c66 206d 6170 7320 616e 6420 7261  half maps and ra
+00019f10: 776d 6170 2061 6e64 2072 6177 6d61 7020  wmap and rawmap 
+00019f20: 636f 6e74 6f75 7220 6172 6520 7468 6572  contour are ther
+00019f30: 650a 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00019f40: 6d20 6368 696d 6572 6161 7070 3a20 6269  m chimeraapp: bi
+00019f50: 6e61 7279 2076 616c 7565 2074 6f20 6368  nary value to ch
+00019f60: 6563 6b20 6966 2043 6869 6d65 7261 5820  eck if ChimeraX 
+00019f70: 6973 2074 6865 7265 2070 726f 7065 726c  is there properl
+00019f80: 790a 2020 2020 2020 2020 3a72 6574 7572  y.        :retur
+00019f90: 6e3a 204e 6f6e 650a 2020 2020 2020 2020  n: None.        
+00019fa0: 2222 220a 0a20 2020 2020 2020 2023 2072  """..        # r
+00019fb0: 6177 6d61 7072 6520 3d20 272a 5f72 6177  awmapre = '*_raw
+00019fc0: 6d61 702e 6d61 7027 0a20 2020 2020 2020  map.map'.       
+00019fd0: 2023 2072 6177 6d61 706e 616d 6520 3d20   # rawmapname = 
+00019fe0: 676c 6f62 2e67 6c6f 6228 7365 6c66 2e77  glob.glob(self.w
+00019ff0: 6f72 6b64 6972 202b 2072 6177 6d61 7072  orkdir + rawmapr
+0001a000: 6529 0a20 2020 2020 2020 2069 6620 7365  e).        if se
+0001a010: 6c66 2e68 6d6f 6464 2069 7320 6e6f 7420  lf.hmodd is not 
+0001a020: 4e6f 6e65 2061 6e64 2073 656c 662e 686d  None and self.hm
+0001a030: 6576 656e 2069 7320 6e6f 7420 4e6f 6e65  even is not None
+0001a040: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001a050: 776d 6170 6e61 6d65 203d 2073 656c 662e  wmapname = self.
+0001a060: 6669 6e64 7261 776d 6170 2829 0a20 2020  findrawmap().   
+0001a070: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001a080: 2020 2020 2020 2072 6177 6d61 706e 616d         rawmapnam
+0001a090: 6520 3d20 4e6f 6e65 0a0a 2020 2020 2020  e = None..      
+0001a0a0: 2020 6269 6e64 6973 706c 6179 203d 206f    bindisplay = o
+0001a0b0: 732e 6765 7465 6e76 2827 4449 5350 4c41  s.getenv('DISPLA
+0001a0c0: 5927 290a 0a20 2020 2020 2020 2074 7279  Y')..        try
+0001a0d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001a0e0: 776d 6170 636c 203d 2073 656c 662e 7261  wmapcl = self.ra
+0001a0f0: 776d 6170 636c 2829 0a20 2020 2020 2020  wmapcl().       
+0001a100: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+0001a110: 2020 2020 2072 6177 6d61 7063 6c20 3d20       rawmapcl = 
+0001a120: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0001a130: 2070 7269 6e74 2827 5072 6f62 6c65 6d20   print('Problem 
+0001a140: 7769 7468 2072 6177 206d 6170 2063 6f6e  with raw map con
+0001a150: 746f 7572 206c 6576 656c 2063 616c 6375  tour level calcu
+0001a160: 6c61 7469 6f6e 2729 0a0a 2020 2020 2020  lation')..      
+0001a170: 2020 6966 2028 7365 6c66 2e68 6d6f 6464    if (self.hmodd
+0001a180: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0001a190: 2073 656c 662e 686d 6576 656e 2069 7320   self.hmeven is 
+0001a1a0: 6e6f 7420 4e6f 6e65 2920 616e 6420 7261  not None) and ra
+0001a1b0: 776d 6170 6e61 6d65 2061 6e64 2072 6177  wmapname and raw
+0001a1c0: 6d61 7063 6c20 6973 206e 6f74 204e 6f6e  mapcl is not Non
+0001a1d0: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+0001a1e0: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+0001a1f0: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+0001a200: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+0001a210: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
+0001a220: 2020 2020 206d 6170 6e61 6d65 203d 206f       mapname = o
+0001a230: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001a240: 7261 776d 6170 6e61 6d65 290a 2020 2020  rawmapname).    
+0001a250: 2020 2020 2020 2020 6c6f 6343 4849 4d45          locCHIME
+0001a260: 5241 203d 2063 6869 6d65 7261 6170 700a  RA = chimeraapp.
+0001a270: 2020 2020 2020 2020 2020 2020 2320 7261              # ra
+0001a280: 776d 6170 2073 7572 6661 6365 2076 6965  wmap surface vie
+0001a290: 7720 616c 6f6e 650a 2020 2020 2020 2020  w alone.        
+0001a2a0: 2020 2020 7261 776d 6170 6368 696d 6572      rawmapchimer
+0001a2b0: 6163 6d64 203d 2072 6177 6d61 706e 616d  acmd = rawmapnam
+0001a2c0: 6520 2b20 275f 6368 696d 6572 612e 6378  e + '_chimera.cx
+0001a2d0: 6327 0a20 2020 2020 2020 2020 2020 2061  c'.            a
+0001a2e0: 7373 656d 626c 6520 3d20 4661 6c73 650a  ssemble = False.
+0001a2f0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0001a300: 206f 7065 6e28 7261 776d 6170 6368 696d   open(rawmapchim
+0001a310: 6572 6163 6d64 2c20 2777 2729 2061 7320  eracmd, 'w') as 
+0001a320: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0001a330: 2020 2066 2e77 7269 7465 280a 2020 2020     f.write(.    
+0001a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a350: 2320 4368 696d 6572 6120 7665 7273 696f  # Chimera versio
+0001a360: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0001a370: 2020 2020 2020 2320 276f 7065 6e20 6363        # 'open cc
+0001a380: 7034 3a27 202b 2073 7472 286d 6170 6e61  p4:' + str(mapna
+0001a390: 6d65 2920 2b20 275c 6e27 0a20 2020 2020  me) + '\n'.     
+0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001a3b0: 2022 766f 6c75 6d65 2023 3020 7374 796c   "volume #0 styl
+0001a3c0: 6520 7375 7266 6163 6520 6578 7061 6e64  e surface expand
+0001a3d0: 5369 6e67 6c65 506c 616e 6520 5472 7565  SinglePlane True
+0001a3e0: 2022 202b 2027 5c6e 270a 2020 2020 2020   " + '\n'.      
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001a400: 2276 6f6c 756d 6520 2330 2063 6f6c 6f72  "volume #0 color
+0001a410: 2023 4238 3836 3042 2073 7465 7020 3120   #B8860B step 1 
+0001a420: 2220 2b20 636f 6e74 6f75 7220 2b20 275c  " + contour + '\
+0001a430: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001a440: 2020 2020 2020 2023 2022 7365 7420 7072         # "set pr
+0001a450: 6f6a 6563 7469 6f6e 206f 7274 686f 6772  ojection orthogr
+0001a460: 6170 6869 6322 202b 2027 5c6e 270a 2020  aphic" + '\n'.  
+0001a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a480: 2020 2320 2273 7572 6674 7261 6e73 7020    # "surftransp 
+0001a490: 3530 2220 2b20 275c 6e27 2020 2320 6d61  50" + '\n'  # ma
+0001a4a0: 6b65 2074 6865 2073 7572 6661 6365 2061  ke the surface a
+0001a4b0: 206c 6974 746c 6520 6269 7420 7365 652d   little bit see-
+0001a4c0: 7468 726f 7567 680a 2020 2020 2020 2020  through.        
+0001a4d0: 2020 2020 2020 2020 2020 2020 2320 2262              # "b
+0001a4e0: 6163 6b67 726f 756e 6420 736f 6c69 6420  ackground solid 
+0001a4f0: 6c69 6768 7420 6772 6179 2220 2b20 275c  light gray" + '\
+0001a500: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001a510: 2020 2020 2020 2023 2022 636f 7079 2066         # "copy f
+0001a520: 696c 6520 2220 2b20 7374 7228 7365 6c66  ile " + str(self
+0001a530: 2e6d 6170 6e61 6d65 2920 2b20 225f 7a73  .mapname) + "_zs
+0001a540: 7572 6661 6365 2e6a 7065 6722 202b 2022  urface.jpeg" + "
+0001a550: 2073 7570 6572 7361 6d70 6c65 2033 2077   supersample 3 w
+0001a560: 6964 7468 2031 3230 3020 6865 6967 6874  idth 1200 height
+0001a570: 2031 3230 3022 202b 2027 5c6e 270a 2020   1200" + '\n'.  
+0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a590: 2020 2320 2274 7572 6e20 7820 2d39 3022    # "turn x -90"
+0001a5a0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0001a5b0: 2020 2020 2020 2020 2020 2020 2320 2263              # "c
+0001a5c0: 656e 7465 7222 202b 2027 5c6e 270a 2020  enter" + '\n'.  
+0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5e0: 2020 2320 2263 6f70 7920 6669 6c65 2022    # "copy file "
+0001a5f0: 202b 2073 7472 2873 656c 662e 6d61 706e   + str(self.mapn
+0001a600: 616d 6529 202b 2022 5f78 7375 7266 6163  ame) + "_xsurfac
+0001a610: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
+0001a620: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
+0001a630: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
+0001a640: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001a650: 2020 2020 2020 2020 2020 2020 2023 2022               # "
+0001a660: 7475 726e 207a 202d 3930 2220 2b20 275c  turn z -90" + '\
+0001a670: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001a680: 2020 2020 2020 2023 2022 6365 6e74 6572         # "center
+0001a690: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001a6a0: 2020 2020 2020 2020 2020 2020 2023 2022               # "
+0001a6b0: 636f 7079 2066 696c 6520 2220 2b20 7374  copy file " + st
+0001a6c0: 7228 7365 6c66 2e6d 6170 6e61 6d65 2920  r(self.mapname) 
+0001a6d0: 2b20 225f 7973 7572 6661 6365 2e6a 7065  + "_ysurface.jpe
+0001a6e0: 6722 202b 2022 2073 7570 6572 7361 6d70  g" + " supersamp
+0001a6f0: 6c65 2033 2077 6964 7468 2031 3230 3020  le 3 width 1200 
+0001a700: 6865 6967 6874 2031 3230 3022 202b 2027  height 1200" + '
+0001a710: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001a720: 2020 2020 2020 2020 2320 2263 6c6f 7365          # "close
+0001a730: 2061 6c6c 2220 2b20 225c 6e22 0a20 2020   all" + "\n".   
 0001a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a750: 2020 2020 2276 6f6c 756d 6520 2331 2073      "volume #1 s
-0001a760: 7479 6c65 2073 7572 6661 6365 2065 7870  tyle surface exp
-0001a770: 616e 6453 696e 676c 6550 6c61 6e65 2054  andSinglePlane T
-0001a780: 7275 6522 202b 2027 5c6e 270a 2020 2020  rue" + '\n'.    
-0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7a0: 2320 2276 6f6c 756d 6520 2331 2063 6f6c  # "volume #1 col
-0001a7b0: 6f72 2023 4238 3836 3042 2073 7465 7020  or #B8860B step 
-0001a7c0: 3120 6c65 7665 6c20 2220 2b20 7374 7228  1 level " + str(
-0001a7d0: 7365 6c66 2e63 6c29 202b 2027 5c6e 270a  self.cl) + '\n'.
-0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7f0: 2020 2020 2276 6f6c 756d 6520 2331 2073      "volume #1 s
-0001a800: 7465 7020 3120 6c65 7665 6c20 2220 2b20  tep 1 level " + 
-0001a810: 7374 7228 7261 776d 6170 636c 2920 2b20  str(rawmapcl) + 
-0001a820: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001a830: 2020 2020 2020 2020 2022 7365 7420 6267           "set bg
-0001a840: 436f 6c6f 7220 7768 6974 6522 202b 2027  Color white" + '
-0001a850: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001a860: 2020 2020 2020 2020 226c 6967 6874 696e          "lightin
-0001a870: 6720 6675 6c6c 205c 6e22 0a20 2020 2020  g full \n".     
-0001a880: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001a890: 7669 6577 2063 6f66 7220 5472 7565 205c  view cofr True \
-0001a8a0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-0001a8b0: 2020 2020 2020 2022 7361 7665 2022 202b         "save " +
-0001a8c0: 2073 7472 286d 6170 6e61 6d65 2920 2b20   str(mapname) + 
-0001a8d0: 225f 7a73 7572 6661 6365 2e6a 7065 6722  "_zsurface.jpeg"
-0001a8e0: 202b 2022 2073 7570 6572 7361 6d70 6c65   + " supersample
-0001a8f0: 2033 2077 6964 7468 2031 3230 3020 6865   3 width 1200 he
-0001a900: 6967 6874 2031 3230 3022 202b 2027 5c6e  ight 1200" + '\n
-0001a910: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001a920: 2020 2020 2020 2274 7572 6e20 7820 2d39        "turn x -9
-0001a930: 3022 202b 2027 5c6e 270a 2020 2020 2020  0" + '\n'.      
-0001a940: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-0001a950: 7572 6e20 7920 2d39 3022 202b 2027 5c6e  urn y -90" + '\n
-0001a960: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001a970: 2020 2020 2020 2276 6965 7720 636f 6672        "view cofr
-0001a980: 2054 7275 6522 202b 2027 5c6e 270a 2020   True" + '\n'.  
-0001a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9a0: 2020 2273 6176 6520 2220 2b20 7374 7228    "save " + str(
-0001a9b0: 6d61 706e 616d 6529 202b 2022 5f78 7375  mapname) + "_xsu
-0001a9c0: 7266 6163 652e 6a70 6567 2220 2b20 2220  rface.jpeg" + " 
-0001a9d0: 7375 7065 7273 616d 706c 6520 3320 7769  supersample 3 wi
-0001a9e0: 6474 6820 3132 3030 2068 6569 6768 7420  dth 1200 height 
-0001a9f0: 3132 3030 2220 2b20 275c 6e27 0a20 2020  1200" + '\n'.   
-0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa10: 2022 7669 6577 206f 7269 656e 7422 202b   "view orient" +
-0001aa20: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001aa30: 2020 2020 2020 2020 2020 2274 7572 6e20            "turn 
-0001aa40: 7820 3930 2220 2b20 275c 6e27 0a20 2020  x 90" + '\n'.   
-0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa60: 2022 7475 726e 207a 2039 3022 202b 2027   "turn z 90" + '
-0001aa70: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001aa80: 2020 2020 2020 2020 2276 6965 7720 636f          "view co
-0001aa90: 6672 2054 7275 6522 202b 2027 5c6e 270a  fr True" + '\n'.
-0001aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aab0: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
-0001aac0: 7228 6d61 706e 616d 6529 202b 2022 5f79  r(mapname) + "_y
-0001aad0: 7375 7266 6163 652e 6a70 6567 2220 2b20  surface.jpeg" + 
-0001aae0: 2220 7375 7065 7273 616d 706c 6520 3320  " supersample 3 
-0001aaf0: 7769 6474 6820 3132 3030 2068 6569 6768  width 1200 heigh
-0001ab00: 7420 3132 3030 2220 2b20 275c 6e27 0a20  t 1200" + '\n'. 
-0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab20: 2020 2022 636c 6f73 6520 616c 6c22 202b     "close all" +
-0001ab30: 2022 5c6e 220a 2020 2020 2020 2020 2020   "\n".          
-0001ab40: 2020 2020 2020 2020 2020 2265 7869 7422            "exit"
-0001ab50: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001ab60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001ab70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001ab80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001ab90: 7420 6269 6e64 6973 706c 6179 3a0a 2020  t bindisplay:.  
-0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abb0: 2020 7375 6270 726f 6365 7373 2e63 6865    subprocess.che
-0001abc0: 636b 5f63 616c 6c28 6c6f 6343 4849 4d45  ck_call(locCHIME
-0001abd0: 5241 202b 2022 202d 2d6f 6666 7363 7265  RA + " --offscre
-0001abe0: 656e 202d 2d6e 6f67 7569 2022 202b 2072  en --nogui " + r
-0001abf0: 6177 6d61 7063 6869 6d65 7261 636d 642c  awmapchimeracmd,
-0001ac00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac20: 2020 2020 2020 2020 2020 2020 2063 7764               cwd
-0001ac30: 3d73 656c 662e 776f 726b 6469 722c 2073  =self.workdir, s
-0001ac40: 6865 6c6c 3d54 7275 6529 0a20 2020 2020  hell=True).     
-0001ac50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001ac60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ac70: 2020 2020 2073 7562 7072 6f63 6573 732e       subprocess.
-0001ac80: 6368 6563 6b5f 6361 6c6c 286c 6f63 4348  check_call(locCH
-0001ac90: 494d 4552 4120 2b20 2220 2220 2b20 7261  IMERA + " " + ra
-0001aca0: 776d 6170 6368 696d 6572 6163 6d64 2c20  wmapchimeracmd, 
-0001acb0: 6377 643d 7365 6c66 2e77 6f72 6b64 6972  cwd=self.workdir
-0001acc0: 2c20 7368 656c 6c3d 5472 7565 290a 0a20  , shell=True).. 
-0001acd0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0001ace0: 7420 7375 6270 726f 6365 7373 2e43 616c  t subprocess.Cal
-0001acf0: 6c65 6450 726f 6365 7373 4572 726f 7220  ledProcessError 
-0001ad00: 6173 2073 7562 6572 723a 0a20 2020 2020  as suberr:.     
-0001ad10: 2020 2020 2020 2020 2020 2065 7272 203d             err =
-0001ad20: 2027 5261 7720 6d61 7020 7375 7266 6163   'Raw map surfac
-0001ad30: 6520 7669 6577 2062 7920 4368 696d 6572  e view by Chimer
-0001ad40: 6158 2065 7272 6f72 3a20 7b7d 272e 666f  aX error: {}'.fo
-0001ad50: 726d 6174 2873 7562 6572 7229 0a20 2020  rmat(suberr).   
-0001ad60: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0001ad70: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
-0001ad80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ad90: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-0001ada0: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
-0001adb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0001adc0: 2827 5261 7720 6d61 7020 7375 7266 6163  ('Raw map surfac
-0001add0: 6520 7669 6577 7320 7765 7265 2067 656e  e views were gen
-0001ade0: 6572 6174 6564 2062 7920 4368 696d 6572  erated by Chimer
-0001adf0: 6158 206d 6574 686f 6427 290a 2020 2020  aX method').    
-0001ae00: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001ae10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001ae20: 662e 7363 616c 655f 7375 7266 6163 6576  f.scale_surfacev
-0001ae30: 6965 7728 290a 2020 2020 2020 2020 2020  iew().          
-0001ae40: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-0001ae50: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
-0001ae60: 2753 6361 6c69 6e67 2074 6865 2073 7572  'Scaling the sur
-0001ae70: 6661 6365 2076 6965 7773 2065 7272 3a20  face views err: 
-0001ae80: 7b7d 272e 666f 726d 6174 2873 7973 2e65  {}'.format(sys.e
-0001ae90: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0001aeb0: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
-0001aec0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001aed0: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-0001aee0: 7465 2865 7272 202b 2027 5c6e 2729 0a0a  te(err + '\n')..
-0001aef0: 2020 2020 2020 2020 2020 2020 7261 7773              raws
-0001af00: 7572 6661 6365 7669 6577 6a73 6f6e 203d  urfaceviewjson =
-0001af10: 2064 6963 7428 290a 0a20 2020 2020 2020   dict()..       
-0001af20: 2020 2020 206f 7574 6d61 7078 696d 6167       outmapximag
-0001af30: 6520 3d20 7374 7228 6d61 706e 616d 6529  e = str(mapname)
-0001af40: 202b 2027 5f78 7375 7266 6163 652e 6a70   + '_xsurface.jp
-0001af50: 6567 270a 2020 2020 2020 2020 2020 2020  eg'.            
-0001af60: 6d61 7078 6c69 7374 203d 206f 7574 6d61  mapxlist = outma
-0001af70: 7078 696d 6167 652e 7370 6c69 7428 275f  pximage.split('_
-0001af80: 2729 0a20 2020 2020 2020 2020 2020 206d  ').            m
-0001af90: 6170 7873 6361 6c65 696d 6167 6520 3d20  apxscaleimage = 
-0001afa0: 275f 272e 6a6f 696e 286d 6170 786c 6973  '_'.join(mapxlis
-0001afb0: 745b 3a2d 315d 2920 2b20 275f 7363 616c  t[:-1]) + '_scal
-0001afc0: 6564 5f27 202b 206d 6170 786c 6973 745b  ed_' + mapxlist[
-0001afd0: 2d31 5d0a 2020 2020 2020 2020 2020 2020  -1].            
-0001afe0: 7261 7773 7572 6661 6365 7669 6577 6a73  rawsurfaceviewjs
-0001aff0: 6f6e 5b27 7827 5d20 3d20 6f73 2e70 6174  on['x'] = os.pat
-0001b000: 682e 6261 7365 6e61 6d65 286d 6170 7873  h.basename(mapxs
-0001b010: 6361 6c65 696d 6167 6529 2069 6620 6f73  caleimage) if os
-0001b020: 2e70 6174 682e 6973 6669 6c65 280a 2020  .path.isfile(.  
-0001b030: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001b040: 6c66 2e77 6f72 6b64 6972 202b 206d 6170  lf.workdir + map
-0001b050: 7873 6361 6c65 696d 6167 6529 2065 6c73  xscaleimage) els
-0001b060: 6520 4e6f 6e65 0a0a 2020 2020 2020 2020  e None..        
-0001b070: 2020 2020 6f75 746d 6170 7969 6d61 6765      outmapyimage
-0001b080: 203d 2073 7472 286d 6170 6e61 6d65 2920   = str(mapname) 
-0001b090: 2b20 275f 7973 7572 6661 6365 2e6a 7065  + '_ysurface.jpe
-0001b0a0: 6727 0a20 2020 2020 2020 2020 2020 206d  g'.            m
-0001b0b0: 6170 796c 6973 7420 3d20 6f75 746d 6170  apylist = outmap
-0001b0c0: 7969 6d61 6765 2e73 706c 6974 2827 5f27  yimage.split('_'
-0001b0d0: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-0001b0e0: 7079 7363 616c 6569 6d61 6765 203d 2027  pyscaleimage = '
-0001b0f0: 5f27 2e6a 6f69 6e28 6d61 7079 6c69 7374  _'.join(mapylist
-0001b100: 5b3a 2d31 5d29 202b 2027 5f73 6361 6c65  [:-1]) + '_scale
-0001b110: 645f 2720 2b20 6d61 7079 6c69 7374 5b2d  d_' + mapylist[-
-0001b120: 315d 0a20 2020 2020 2020 2020 2020 2072  1].            r
-0001b130: 6177 7375 7266 6163 6576 6965 776a 736f  awsurfaceviewjso
-0001b140: 6e5b 2779 275d 203d 206f 732e 7061 7468  n['y'] = os.path
-0001b150: 2e62 6173 656e 616d 6528 6d61 7079 7363  .basename(mapysc
-0001b160: 616c 6569 6d61 6765 2920 6966 206f 732e  aleimage) if os.
-0001b170: 7061 7468 2e69 7366 696c 6528 0a20 2020  path.isfile(.   
-0001b180: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001b190: 662e 776f 726b 6469 7220 2b20 6d61 7079  f.workdir + mapy
-0001b1a0: 7363 616c 6569 6d61 6765 2920 656c 7365  scaleimage) else
-0001b1b0: 204e 6f6e 650a 0a20 2020 2020 2020 2020   None..         
-0001b1c0: 2020 206f 7574 6d61 707a 696d 6167 6520     outmapzimage 
-0001b1d0: 3d20 7374 7228 6d61 706e 616d 6529 202b  = str(mapname) +
-0001b1e0: 2027 5f7a 7375 7266 6163 652e 6a70 6567   '_zsurface.jpeg
-0001b1f0: 270a 2020 2020 2020 2020 2020 2020 6d61  '.            ma
-0001b200: 707a 6c69 7374 203d 206f 7574 6d61 707a  pzlist = outmapz
-0001b210: 696d 6167 652e 7370 6c69 7428 275f 2729  image.split('_')
-0001b220: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-0001b230: 7a73 6361 6c65 696d 6167 6520 3d20 275f  zscaleimage = '_
-0001b240: 272e 6a6f 696e 286d 6170 7a6c 6973 745b  '.join(mapzlist[
-0001b250: 3a2d 315d 2920 2b20 275f 7363 616c 6564  :-1]) + '_scaled
-0001b260: 5f27 202b 206d 6170 7a6c 6973 745b 2d31  _' + mapzlist[-1
-0001b270: 5d0a 2020 2020 2020 2020 2020 2020 7261  ].            ra
-0001b280: 7773 7572 6661 6365 7669 6577 6a73 6f6e  wsurfaceviewjson
-0001b290: 5b27 7a27 5d20 3d20 6f73 2e70 6174 682e  ['z'] = os.path.
-0001b2a0: 6261 7365 6e61 6d65 286d 6170 7a73 6361  basename(mapzsca
-0001b2b0: 6c65 696d 6167 6529 2069 6620 6f73 2e70  leimage) if os.p
-0001b2c0: 6174 682e 6973 6669 6c65 280a 2020 2020  ath.isfile(.    
-0001b2d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001b2e0: 2e77 6f72 6b64 6972 202b 206d 6170 7a73  .workdir + mapzs
-0001b2f0: 6361 6c65 696d 6167 6529 2065 6c73 6520  caleimage) else 
-0001b300: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0001b310: 2069 6620 6572 726c 6973 743a 0a20 2020   if errlist:.   
-0001b320: 2020 2020 2020 2020 2020 2020 2072 6177               raw
-0001b330: 7375 7266 6163 6576 6965 776a 736f 6e5b  surfaceviewjson[
-0001b340: 2765 7272 275d 203d 207b 2772 6177 6d61  'err'] = {'rawma
-0001b350: 705f 7375 7266 6163 655f 6572 7227 3a20  p_surface_err': 
-0001b360: 6572 726c 6973 747d 0a0a 2020 2020 2020  errlist}..      
-0001b370: 2020 2020 2020 6669 6e61 6c64 6963 7420        finaldict 
-0001b380: 3d20 7b27 7261 776d 6170 5f6d 6170 5f73  = {'rawmap_map_s
-0001b390: 7572 6661 6365 273a 2072 6177 7375 7266  urface': rawsurf
-0001b3a0: 6163 6576 6965 776a 736f 6e7d 0a20 2020  aceviewjson}.   
-0001b3b0: 2020 2020 2020 2020 2072 6177 636c 6469           rawcldi
-0001b3c0: 6374 203d 207b 2772 6177 6d61 705f 636f  ct = {'rawmap_co
-0001b3d0: 6e74 6f75 725f 6c65 7665 6c27 3a20 7b27  ntour_level': {'
-0001b3e0: 636c 273a 2027 7b3a 302e 3266 7d27 2e66  cl': '{:0.2f}'.f
-0001b3f0: 6f72 6d61 7428 7261 776d 6170 636c 297d  ormat(rawmapcl)}
-0001b400: 7d0a 0a20 2020 2020 2020 2020 2020 2074  }..            t
-0001b410: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001b420: 2020 2020 7769 7468 2063 6f64 6563 732e      with codecs.
-0001b430: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
-0001b440: 7220 2b20 6d61 706e 616d 6520 2b20 275f  r + mapname + '_
-0001b450: 7261 776d 6170 7375 7266 6163 6576 6965  rawmapsurfacevie
-0001b460: 772e 6a73 6f6e 272c 2027 7727 2c0a 2020  w.json', 'w',.  
-0001b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b480: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001b490: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
-0001b4a0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0001b4b0: 2020 2020 2020 2020 2020 206a 736f 6e2e             json.
-0001b4c0: 6475 6d70 2866 696e 616c 6469 6374 2c20  dump(finaldict, 
-0001b4d0: 6629 0a20 2020 2020 2020 2020 2020 2065  f).            e
-0001b4e0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-0001b4f0: 2020 2020 2020 2065 7272 203d 2027 5361         err = 'Sa
-0001b500: 7669 6e67 206d 6170 2073 7572 6661 6365  ving map surface
-0001b510: 2076 6965 7720 6a73 6f6e 2065 7272 6f72   view json error
-0001b520: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 7379  : {}.'.format(sy
-0001b530: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
-0001b540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b550: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-0001b560: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
-0001b570: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0001b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b590: 7769 7468 2063 6f64 6563 732e 6f70 656e  with codecs.open
-0001b5a0: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
-0001b5b0: 6d61 706e 616d 6520 2b20 275f 7261 776d  mapname + '_rawm
-0001b5c0: 6170 636c 2e6a 736f 6e27 2c20 2777 272c  apcl.json', 'w',
-0001b5d0: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
-0001b5e0: 2729 2061 7320 6666 3a0a 2020 2020 2020  ') as ff:.      
-0001b5f0: 2020 2020 2020 2020 2020 2020 2020 6a73                js
-0001b600: 6f6e 2e64 756d 7028 7261 7763 6c64 6963  on.dump(rawcldic
-0001b610: 742c 2066 6629 0a20 2020 2020 2020 2020  t, ff).         
-0001b620: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-0001b630: 2020 2020 2020 2020 2020 2065 7272 203d             err =
-0001b640: 2027 5361 7669 6e67 2072 6177 6d61 7020   'Saving rawmap 
-0001b650: 636f 6e74 6f75 7220 6c65 7665 6c20 6a73  contour level js
-0001b660: 6f6e 2065 7272 6f72 3a20 7b7d 2e27 2e66  on error: {}.'.f
-0001b670: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
-0001b680: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
-0001b690: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
-0001b6a0: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
-0001b6b0: 275c 6e27 290a 0a20 2020 2020 2020 2020  '\n')..         
-0001b6c0: 2020 2065 6e64 203d 2074 696d 6569 742e     end = timeit.
-0001b6d0: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
-0001b6e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001b6f0: 7428 2752 6177 206d 6170 2073 7572 6661  t('Raw map surfa
-0001b700: 6365 2076 6965 7720 7469 6d65 3a20 2573  ce view time: %s
-0001b710: 2720 2520 2865 6e64 202d 2073 7461 7274  ' % (end - start
-0001b720: 2929 0a20 2020 2020 2020 2020 2020 2070  )).            p
-0001b730: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
-0001b740: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001b750: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020  ----------')..  
-0001b760: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001b770: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
-0001b780: 6f20 7261 7720 6d61 7020 6f72 2068 616c  o raw map or hal
-0001b790: 6620 6d61 7073 206f 7220 7261 7720 6d61  f maps or raw ma
-0001b7a0: 7020 636f 6e74 6f75 7220 6c65 7665 6c20  p contour level 
-0001b7b0: 666f 7220 7261 7720 6d61 7020 7375 7266  for raw map surf
-0001b7c0: 6163 6573 2e27 290a 0a0a 2020 2020 2320  aces.')...    # 
-0001b7d0: 5375 7266 6163 6520 4368 696d 6572 6120  Surface Chimera 
-0001b7e0: 7761 790a 2020 2020 6465 6620 7375 7266  way.    def surf
-0001b7f0: 6163 6576 6965 775f 6368 696d 6572 6128  aceview_chimera(
-0001b800: 7365 6c66 2c20 6368 696d 6572 6161 7070  self, chimeraapp
-0001b810: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001b820: 2020 2020 2020 2020 2020 2047 656e 6572             Gener
-0001b830: 6174 6520 7375 7266 6163 6520 7669 6577  ate surface view
-0001b840: 2062 7920 7573 696e 6720 6865 6164 6c65   by using headle
-0001b850: 7373 2043 6869 6d65 7261 2061 6e64 2070  ss Chimera and p
-0001b860: 7963 6869 6d65 7261 0a0a 2020 2020 2020  ychimera..      
-0001b870: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
-0001b880: 706f 7274 206d 6d61 700a 0a20 2020 2020  port mmap..     
-0001b890: 2020 2073 7461 7274 203d 2074 696d 6569     start = timei
-0001b8a0: 742e 6465 6661 756c 745f 7469 6d65 7228  t.default_timer(
-0001b8b0: 290a 2020 2020 2020 2020 6572 726c 6973  ).        errlis
-0001b8c0: 7420 3d20 5b5d 0a20 2020 2020 2020 206d  t = [].        m
-0001b8d0: 6d65 7272 6c69 7374 203d 205b 5d0a 2020  merrlist = [].  
-0001b8e0: 2020 2020 2020 6269 6e64 6973 706c 6179        bindisplay
-0001b8f0: 203d 206f 732e 6765 7465 6e76 2827 4449   = os.getenv('DI
-0001b900: 5350 4c41 5927 290a 0a20 2020 2020 2020  SPLAY')..       
-0001b910: 206d 6170 6e61 6d65 203d 2073 656c 662e   mapname = self.
-0001b920: 776f 726b 6469 7220 2b20 7365 6c66 2e6d  workdir + self.m
-0001b930: 6170 6e61 6d65 0a20 2020 2020 2020 2069  apname.        i
-0001b940: 6620 6e6f 7420 6f73 2e70 6174 682e 6973  f not os.path.is
-0001b950: 6669 6c65 286d 6170 6e61 6d65 2920 616e  file(mapname) an
-0001b960: 6420 6f73 2e70 6174 682e 6973 6669 6c65  d os.path.isfile
-0001b970: 2873 656c 662e 6d61 706e 616d 6529 3a0a  (self.mapname):.
-0001b980: 2020 2020 2020 2020 2020 2020 6d61 706e              mapn
-0001b990: 616d 6520 3d20 7365 6c66 2e6d 6170 6e61  ame = self.mapna
-0001b9a0: 6d65 0a0a 2020 2020 2020 2020 6c6f 6343  me..        locC
-0001b9b0: 4849 4d45 5241 203d 2063 6869 6d65 7261  HIMERA = chimera
-0001b9c0: 6170 700a 2020 2020 2020 2020 636f 6e74  app.        cont
-0001b9d0: 6f75 7220 3d20 226c 6576 656c 2022 202b  our = "level " +
-0001b9e0: 2073 7472 2873 656c 662e 636c 2920 6966   str(self.cl) if
-0001b9f0: 2073 656c 662e 636c 2069 7320 6e6f 7420   self.cl is not 
-0001ba00: 4e6f 6e65 2065 6c73 6520 2727 0a20 2020  None else ''.   
-0001ba10: 2020 2020 2023 206d 6170 2073 7572 6661       # map surfa
-0001ba20: 6365 2076 6965 7720 616c 6f6e 650a 2020  ce view alone.  
-0001ba30: 2020 2020 2020 6d61 7063 6869 6d65 7261        mapchimera
-0001ba40: 636d 6420 3d20 7365 6c66 2e6d 6170 6e61  cmd = self.mapna
-0001ba50: 6d65 202b 2027 5f63 6869 6d65 7261 2e63  me + '_chimera.c
-0001ba60: 7863 270a 2020 2020 2020 2020 6173 7365  xc'.        asse
-0001ba70: 6d62 6c65 203d 2046 616c 7365 0a20 2020  mble = False.   
-0001ba80: 2020 2020 2077 6974 6820 6f70 656e 2873       with open(s
-0001ba90: 656c 662e 776f 726b 6469 7220 2b20 6d61  elf.workdir + ma
-0001baa0: 7063 6869 6d65 7261 636d 642c 2027 7727  pchimeracmd, 'w'
-0001bab0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-0001bac0: 2020 2020 662e 7772 6974 6528 0a20 2020      f.write(.   
-0001bad0: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-0001bae0: 6869 6d65 7261 2076 6572 7369 6f6e 0a20  himera version. 
-0001baf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001bb00: 2027 6f70 656e 2063 6370 343a 2720 2b20   'open ccp4:' + 
-0001bb10: 7374 7228 6d61 706e 616d 6529 202b 2027  str(mapname) + '
-0001bb20: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001bb30: 2020 2020 2320 2276 6f6c 756d 6520 2330      # "volume #0
-0001bb40: 2073 7479 6c65 2073 7572 6661 6365 2065   style surface e
-0001bb50: 7870 616e 6453 696e 676c 6550 6c61 6e65  xpandSinglePlane
-0001bb60: 2054 7275 6520 2220 2b20 275c 6e27 0a20   True " + '\n'. 
-0001bb70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001bb80: 2022 766f 6c75 6d65 2023 3020 636f 6c6f   "volume #0 colo
-0001bb90: 7220 2342 3838 3630 4220 7374 6570 2031  r #B8860B step 1
-0001bba0: 2022 202b 2063 6f6e 746f 7572 202b 2027   " + contour + '
-0001bbb0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001bbc0: 2020 2020 2320 2273 6574 2070 726f 6a65      # "set proje
-0001bbd0: 6374 696f 6e20 6f72 7468 6f67 7261 7068  ction orthograph
-0001bbe0: 6963 2220 2b20 275c 6e27 0a20 2020 2020  ic" + '\n'.     
-0001bbf0: 2020 2020 2020 2020 2020 2023 2022 7375             # "su
-0001bc00: 7266 7472 616e 7370 2035 3022 202b 2027  rftransp 50" + '
-0001bc10: 5c6e 2720 2023 206d 616b 6520 7468 6520  \n'  # make the 
-0001bc20: 7375 7266 6163 6520 6120 6c69 7474 6c65  surface a little
-0001bc30: 2062 6974 2073 6565 2d74 6872 6f75 6768   bit see-through
-0001bc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bc50: 2023 2022 6261 636b 6772 6f75 6e64 2073   # "background s
-0001bc60: 6f6c 6964 206c 6967 6874 2067 7261 7922  olid light gray"
-0001bc70: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001bc80: 2020 2020 2020 2020 2320 2263 6f70 7920          # "copy 
-0001bc90: 6669 6c65 2022 202b 2073 7472 2873 656c  file " + str(sel
-0001bca0: 662e 6d61 706e 616d 6529 202b 2022 5f7a  f.mapname) + "_z
-0001bcb0: 7375 7266 6163 652e 6a70 6567 2220 2b20  surface.jpeg" + 
-0001bcc0: 2220 7375 7065 7273 616d 706c 6520 3320  " supersample 3 
-0001bcd0: 7769 6474 6820 3132 3030 2068 6569 6768  width 1200 heigh
-0001bce0: 7420 3132 3030 2220 2b20 275c 6e27 0a20  t 1200" + '\n'. 
-0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001bd00: 2022 7475 726e 2078 202d 3930 2220 2b20   "turn x -90" + 
-0001bd10: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001bd20: 2020 2020 2023 2022 6365 6e74 6572 2220       # "center" 
-0001bd30: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-0001bd40: 2020 2020 2020 2023 2022 636f 7079 2066         # "copy f
-0001bd50: 696c 6520 2220 2b20 7374 7228 7365 6c66  ile " + str(self
-0001bd60: 2e6d 6170 6e61 6d65 2920 2b20 225f 7873  .mapname) + "_xs
-0001bd70: 7572 6661 6365 2e6a 7065 6722 202b 2022  urface.jpeg" + "
-0001bd80: 2073 7570 6572 7361 6d70 6c65 2033 2077   supersample 3 w
-0001bd90: 6964 7468 2031 3230 3020 6865 6967 6874  idth 1200 height
-0001bda0: 2031 3230 3022 202b 2027 5c6e 270a 2020   1200" + '\n'.  
-0001bdb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001bdc0: 2274 7572 6e20 7a20 2d39 3022 202b 2027  "turn z -90" + '
-0001bdd0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001bde0: 2020 2020 2320 2263 656e 7465 7222 202b      # "center" +
-0001bdf0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001be00: 2020 2020 2020 2320 2263 6f70 7920 6669        # "copy fi
-0001be10: 6c65 2022 202b 2073 7472 2873 656c 662e  le " + str(self.
-0001be20: 6d61 706e 616d 6529 202b 2022 5f79 7375  mapname) + "_ysu
-0001be30: 7266 6163 652e 6a70 6567 2220 2b20 2220  rface.jpeg" + " 
-0001be40: 7375 7065 7273 616d 706c 6520 3320 7769  supersample 3 wi
-0001be50: 6474 6820 3132 3030 2068 6569 6768 7420  dth 1200 height 
-0001be60: 3132 3030 2220 2b20 275c 6e27 0a20 2020  1200" + '\n'.   
-0001be70: 2020 2020 2020 2020 2020 2020 2023 2022               # "
-0001be80: 636c 6f73 6520 616c 6c22 202b 2022 5c6e  close all" + "\n
-0001be90: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001bea0: 2020 2320 2273 746f 7022 0a0a 2020 2020    # "stop"..    
-0001beb0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0001bec0: 696d 6572 6158 2076 6572 7369 6f6e 0a20  imeraX version. 
-0001bed0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001bee0: 6f70 656e 2022 202b 2073 7472 286d 6170  open " + str(map
-0001bef0: 6e61 6d65 2920 2b20 2220 666f 726d 6174  name) + " format
-0001bf00: 2063 6370 3422 202b 2027 5c6e 270a 2020   ccp4" + '\n'.  
-0001bf10: 2020 2020 2020 2020 2020 2020 2020 2276                "v
-0001bf20: 6f6c 756d 6520 2331 2073 7479 6c65 2073  olume #1 style s
-0001bf30: 7572 6661 6365 2065 7870 616e 6453 696e  urface expandSin
-0001bf40: 676c 6550 6c61 6e65 2054 7275 6522 202b  glePlane True" +
-0001bf50: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001bf60: 2020 2020 2020 2320 2276 6f6c 756d 6520        # "volume 
-0001bf70: 2331 2063 6f6c 6f72 2023 4238 3836 3042  #1 color #B8860B
-0001bf80: 2073 7465 7020 3120 6c65 7665 6c20 2220   step 1 level " 
-0001bf90: 2b20 7374 7228 7365 6c66 2e63 6c29 202b  + str(self.cl) +
-0001bfa0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001bfb0: 2020 2020 2020 2276 6f6c 756d 6520 2331        "volume #1
-0001bfc0: 2073 7465 7020 3120 6c65 7665 6c20 2220   step 1 level " 
-0001bfd0: 2b20 7374 7228 7365 6c66 2e63 6c29 202b  + str(self.cl) +
-0001bfe0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001bff0: 2020 2020 2020 2273 6574 2062 6743 6f6c        "set bgCol
-0001c000: 6f72 2077 6869 7465 2220 2b20 275c 6e27  or white" + '\n'
-0001c010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c020: 2022 6c69 6768 7469 6e67 2066 756c 6c20   "lighting full 
-0001c030: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-0001c040: 2020 2020 2276 6965 7720 636f 6672 2054      "view cofr T
-0001c050: 7275 6520 5c6e 220a 2020 2020 2020 2020  rue \n".        
-0001c060: 2020 2020 2020 2020 2273 6176 6520 2220          "save " 
-0001c070: 2b20 7374 7228 7365 6c66 2e6d 6170 6e61  + str(self.mapna
-0001c080: 6d65 2920 2b20 225f 7a73 7572 6661 6365  me) + "_zsurface
-0001c090: 2e6a 7065 6722 202b 2022 2073 7570 6572  .jpeg" + " super
-0001c0a0: 7361 6d70 6c65 2033 2077 6964 7468 2031  sample 3 width 1
-0001c0b0: 3230 3020 6865 6967 6874 2031 3230 3022  200 height 1200"
-0001c0c0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001c0d0: 2020 2020 2020 2020 2274 7572 6e20 7820          "turn x 
-0001c0e0: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
-0001c0f0: 2020 2020 2020 2020 2020 2020 2274 7572              "tur
-0001c100: 6e20 7920 2d39 3022 202b 2027 5c6e 270a  n y -90" + '\n'.
-0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c120: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
-0001c130: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001c140: 2020 2020 2020 2020 2273 6176 6520 2220          "save " 
-0001c150: 2b20 7374 7228 7365 6c66 2e6d 6170 6e61  + str(self.mapna
-0001c160: 6d65 2920 2b20 225f 7873 7572 6661 6365  me) + "_xsurface
-0001c170: 2e6a 7065 6722 202b 2022 2073 7570 6572  .jpeg" + " super
-0001c180: 7361 6d70 6c65 2033 2077 6964 7468 2031  sample 3 width 1
-0001c190: 3230 3020 6865 6967 6874 2031 3230 3022  200 height 1200"
-0001c1a0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001c1b0: 2020 2020 2020 2020 2276 6965 7720 6f72          "view or
-0001c1c0: 6965 6e74 2220 2b20 275c 6e27 0a20 2020  ient" + '\n'.   
-0001c1d0: 2020 2020 2020 2020 2020 2020 2022 7475               "tu
-0001c1e0: 726e 2078 2039 3022 202b 2027 5c6e 270a  rn x 90" + '\n'.
-0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c200: 2274 7572 6e20 7a20 3930 2220 2b20 275c  "turn z 90" + '\
-0001c210: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-0001c220: 2020 2022 7669 6577 2063 6f66 7220 5472     "view cofr Tr
-0001c230: 7565 2220 2b20 275c 6e27 0a20 2020 2020  ue" + '\n'.     
-0001c240: 2020 2020 2020 2020 2020 2022 7361 7665             "save
-0001c250: 2022 202b 2073 7472 2873 656c 662e 6d61   " + str(self.ma
-0001c260: 706e 616d 6529 202b 2022 5f79 7375 7266  pname) + "_ysurf
-0001c270: 6163 652e 6a70 6567 2220 2b20 2220 7375  ace.jpeg" + " su
-0001c280: 7065 7273 616d 706c 6520 3320 7769 6474  persample 3 widt
-0001c290: 6820 3132 3030 2068 6569 6768 7420 3132  h 1200 height 12
-0001c2a0: 3030 2220 2b20 275c 6e27 0a20 2020 2020  00" + '\n'.     
-0001c2b0: 2020 2020 2020 2020 2020 2022 636c 6f73             "clos
-0001c2c0: 6520 616c 6c22 202b 2022 5c6e 220a 2020  e all" + "\n".  
-0001c2d0: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-0001c2e0: 7869 7422 202b 2027 5c6e 270a 2020 2020  xit" + '\n'.    
-0001c2f0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001c300: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001c310: 2020 2020 6966 206e 6f74 2062 696e 6469      if not bindi
-0001c320: 7370 6c61 793a 0a20 2020 2020 2020 2020  splay:.         
-0001c330: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
-0001c340: 732e 6368 6563 6b5f 6361 6c6c 286c 6f63  s.check_call(loc
-0001c350: 4348 494d 4552 4120 2b20 2220 2d2d 6f66  CHIMERA + " --of
-0001c360: 6673 6372 6565 6e20 2d2d 6e6f 6775 6920  fscreen --nogui 
-0001c370: 2220 2b20 7365 6c66 2e77 6f72 6b64 6972  " + self.workdir
-0001c380: 202b 206d 6170 6368 696d 6572 6163 6d64   + mapchimeracmd
-0001c390: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3b0: 2020 2020 2020 2020 2020 6377 643d 7365            cwd=se
-0001c3c0: 6c66 2e77 6f72 6b64 6972 2c20 7368 656c  lf.workdir, shel
-0001c3d0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-0001c3e0: 2020 2020 2020 2020 656e 6420 3d20 7469          end = ti
-0001c3f0: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-0001c400: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-0001c410: 2020 2020 2070 7269 6e74 2827 5072 696d       print('Prim
-0001c420: 6172 7920 6d61 7020 7375 7266 6163 6520  ary map surface 
-0001c430: 7669 6577 2074 696d 653a 2025 7327 2025  view time: %s' %
-0001c440: 2028 656e 6420 2d20 7374 6172 7429 290a   (end - start)).
-0001c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c460: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
-0001c470: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c480: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020  -----------').  
-0001c490: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4b0: 7375 6270 726f 6365 7373 2e63 6865 636b  subprocess.check
-0001c4c0: 5f63 616c 6c28 6c6f 6343 4849 4d45 5241  _call(locCHIMERA
-0001c4d0: 202b 2022 2022 202b 2073 656c 662e 776f   + " " + self.wo
-0001c4e0: 726b 6469 7220 2b20 6d61 7063 6869 6d65  rkdir + mapchime
-0001c4f0: 7261 636d 642c 2063 7764 3d73 656c 662e  racmd, cwd=self.
-0001c500: 776f 726b 6469 722c 2073 6865 6c6c 3d54  workdir, shell=T
-0001c510: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0001c520: 2020 2020 2065 6e64 203d 2074 696d 6569       end = timei
-0001c530: 742e 6465 6661 756c 745f 7469 6d65 7228  t.default_timer(
-0001c540: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c550: 2020 7072 696e 7428 2750 7269 6d61 7279    print('Primary
-0001c560: 206d 6170 2073 7572 6661 6365 2076 6965   map surface vie
-0001c570: 7720 7469 6d65 3a20 2573 2720 2520 2865  w time: %s' % (e
-0001c580: 6e64 202d 2073 7461 7274 2929 0a20 2020  nd - start)).   
-0001c590: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001c5a0: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
-0001c5b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c5c0: 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020 2020  --------').     
-0001c5d0: 2020 2065 7863 6570 7420 7375 6270 726f     except subpro
-0001c5e0: 6365 7373 2e43 616c 6c65 6450 726f 6365  cess.CalledProce
-0001c5f0: 7373 4572 726f 7220 6173 2073 7562 6572  ssError as suber
-0001c600: 723a 0a20 2020 2020 2020 2020 2020 2065  r:.            e
-0001c610: 6e64 203d 2074 696d 6569 742e 6465 6661  nd = timeit.defa
-0001c620: 756c 745f 7469 6d65 7228 290a 2020 2020  ult_timer().    
-0001c630: 2020 2020 2020 2020 6572 7220 3d20 2750          err = 'P
-0001c640: 7269 6d61 7279 206d 6170 2073 7572 6661  rimary map surfa
-0001c650: 6365 2076 6965 7720 6279 2043 6869 6d65  ce view by Chime
-0001c660: 7261 5820 6572 726f 723a 207b 7d27 2e66  raX error: {}'.f
-0001c670: 6f72 6d61 7428 7375 6265 7272 290a 2020  ormat(suberr).  
-0001c680: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001c690: 2750 7269 6d61 7279 206d 6170 2073 7572  'Primary map sur
-0001c6a0: 6661 6365 2076 6965 7720 7469 6d65 3a20  face view time: 
-0001c6b0: 2573 2720 2520 2865 6e64 202d 2073 7461  %s' % (end - sta
-0001c6c0: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
-0001c6d0: 2070 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d   print('--------
-0001c6e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001c6f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a20  ------------'). 
-0001c700: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
-0001c710: 7374 2e61 7070 656e 6428 6572 7229 0a20  st.append(err). 
-0001c720: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
-0001c730: 7464 6572 722e 7772 6974 6528 6572 7220  tderr.write(err 
-0001c740: 2b20 275c 6e27 290a 0a0a 2020 2020 2020  + '\n')...      
-0001c750: 2020 2320 6d61 7020 616e 6420 6d6f 6465    # map and mode
-0001c760: 6c73 2076 6965 7720 746f 6765 7468 6572  ls view together
-0001c770: 0a20 2020 2020 2020 206e 7374 6172 7420  .        nstart 
-0001c780: 3d20 7469 6d65 6974 2e64 6566 6175 6c74  = timeit.default
-0001c790: 5f74 696d 6572 2829 0a20 2020 2020 2020  _timer().       
-0001c7a0: 2069 6620 7365 6c66 2e6d 6f64 656c 733a   if self.models:
-0001c7b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001c7c0: 206d 6f64 656c 2069 6e20 7365 6c66 2e6d   model in self.m
-0001c7d0: 6f64 656c 733a 0a20 2020 2020 2020 2020  odels:.         
-0001c7e0: 2020 2020 2020 2023 2070 6462 6964 203d         # pdbid =
-0001c7f0: 206d 6f64 656c 2e66 696c 656e 616d 652e   model.filename.
-0001c800: 7370 6c69 7428 272f 2729 5b2d 315d 2e73  split('/')[-1].s
-0001c810: 706c 6974 2827 2e27 295b 305d 0a20 2020  plit('.')[0].   
-0001c820: 2020 2020 2020 2020 2020 2020 2070 6462               pdb
-0001c830: 6964 203d 206f 732e 7061 7468 2e62 6173  id = os.path.bas
-0001c840: 656e 616d 6528 6d6f 6465 6c2e 6669 6c65  ename(model.file
-0001c850: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0001c860: 2020 2020 2020 7375 7266 6163 6566 6e20        surfacefn 
-0001c870: 3d20 277b 7d5f 7b7d 272e 666f 726d 6174  = '{}_{}'.format
-0001c880: 2870 6462 6964 2c20 7365 6c66 2e6d 6170  (pdbid, self.map
-0001c890: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0001c8a0: 2020 2020 2020 6368 696d 6572 6163 6d64        chimeracmd
-0001c8b0: 203d 2073 7572 6661 6365 666e 202b 2027   = surfacefn + '
-0001c8c0: 5f63 6869 6d65 7261 2e63 7863 270a 2020  _chimera.cxc'.  
-0001c8d0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0001c8e0: 7468 206f 7065 6e28 7365 6c66 2e77 6f72  th open(self.wor
-0001c8f0: 6b64 6972 202b 2063 6869 6d65 7261 636d  kdir + chimeracm
-0001c900: 642c 2027 7727 2920 6173 2066 3a0a 2020  d, 'w') as f:.  
-0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c920: 2020 662e 7772 6974 6528 0a20 2020 2020    f.write(.     
-0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c940: 2020 2023 2043 6869 6d65 7261 2076 6572     # Chimera ver
-0001c950: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
-0001c960: 2020 2020 2020 2020 2020 2020 2023 2027               # '
-0001c970: 6f70 656e 2063 6370 343a 2720 2b20 7374  open ccp4:' + st
-0001c980: 7228 6d61 706e 616d 6529 202b 2027 5c6e  r(mapname) + '\n
-0001c990: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001c9a0: 2020 2020 2020 2020 2020 2320 226f 7065            # "ope
-0001c9b0: 6e20 6369 663a 2220 2b20 7374 7228 6d6f  n cif:" + str(mo
-0001c9c0: 6465 6c2e 6669 6c65 6e61 6d65 2920 2b20  del.filename) + 
-0001c9d0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001c9e0: 2020 2020 2020 2020 2020 2020 2023 2022               # "
-0001c9f0: 766f 6c75 6d65 2023 3020 7374 796c 6520  volume #0 style 
-0001ca00: 7375 7266 6163 6520 6578 7061 6e64 5369  surface expandSi
-0001ca10: 6e67 6c65 506c 616e 6520 5472 7565 2022  nglePlane True "
-0001ca20: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca40: 2320 2276 6f6c 756d 6520 2330 2063 6f6c  # "volume #0 col
-0001ca50: 6f72 2023 4238 3836 3042 2073 7465 7020  or #B8860B step 
-0001ca60: 3120 2220 2b20 636f 6e74 6f75 7220 2b20  1 " + contour + 
-0001ca70: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001ca80: 2020 2020 2020 2020 2020 2020 2023 2022               # "
-0001ca90: 7365 7420 7072 6f6a 6563 7469 6f6e 206f  set projection o
-0001caa0: 7274 686f 6772 6170 6869 6322 202b 2027  rthographic" + '
-0001cab0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001cac0: 2020 2020 2020 2020 2020 2020 2320 2273              # "s
-0001cad0: 7572 6674 7261 6e73 7020 3530 2220 2b20  urftransp 50" + 
-0001cae0: 275c 6e27 2020 2320 6d61 6b65 2074 6865  '\n'  # make the
-0001caf0: 2073 7572 6661 6365 2061 206c 6974 746c   surface a littl
-0001cb00: 6520 6269 7420 7365 652d 7468 726f 7567  e bit see-throug
-0001cb10: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-0001cb20: 2020 2020 2020 2020 2020 2320 2262 6163            # "bac
-0001cb30: 6b67 726f 756e 6420 736f 6c69 6420 6c69  kground solid li
-0001cb40: 6768 7420 6772 6179 2220 2b20 275c 6e27  ght gray" + '\n'
-0001cb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cb60: 2020 2020 2020 2020 2023 2022 636f 7079           # "copy
-0001cb70: 2066 696c 6520 2220 2b20 7374 7228 7375   file " + str(su
-0001cb80: 7266 6163 6566 6e29 202b 2022 5f7a 7375  rfacefn) + "_zsu
-0001cb90: 7266 6163 652e 6a70 6567 2220 2b20 2220  rface.jpeg" + " 
-0001cba0: 7375 7065 7273 616d 706c 6520 3320 7769  supersample 3 wi
-0001cbb0: 6474 6820 3132 3030 2068 6569 6768 7420  dth 1200 height 
-0001cbc0: 3132 3030 2220 2b20 275c 6e27 0a20 2020  1200" + '\n'.   
-0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbe0: 2020 2020 2023 2022 7475 726e 2078 202d       # "turn x -
-0001cbf0: 3930 2220 2b20 275c 6e27 0a20 2020 2020  90" + '\n'.     
-0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc10: 2020 2023 2022 6365 6e74 6572 2220 2b20     # "center" + 
-0001cc20: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001cc30: 2020 2020 2020 2020 2020 2020 2023 2022               # "
-0001cc40: 636f 7079 2066 696c 6520 2220 2b20 7374  copy file " + st
-0001cc50: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
-0001cc60: 5f78 7375 7266 6163 652e 6a70 6567 2220  _xsurface.jpeg" 
-0001cc70: 2b20 2220 7375 7065 7273 616d 706c 6520  + " supersample 
-0001cc80: 3320 7769 6474 6820 3132 3030 2068 6569  3 width 1200 hei
-0001cc90: 6768 7420 3132 3030 2220 2b20 275c 6e27  ght 1200" + '\n'
-0001cca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ccb0: 2020 2020 2020 2020 2023 2022 7475 726e           # "turn
-0001ccc0: 207a 202d 3930 2220 2b20 275c 6e27 0a20   z -90" + '\n'. 
-0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cce0: 2020 2020 2020 2023 2022 6365 6e74 6572         # "center
-0001ccf0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
-0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd10: 2023 2022 636f 7079 2066 696c 6520 2220   # "copy file " 
-0001cd20: 2b20 7374 7228 7375 7266 6163 6566 6e29  + str(surfacefn)
-0001cd30: 202b 2022 5f79 7375 7266 6163 652e 6a70   + "_ysurface.jp
-0001cd40: 6567 2220 2b20 2220 7375 7065 7273 616d  eg" + " supersam
-0001cd50: 706c 6520 3320 7769 6474 6820 3132 3030  ple 3 width 1200
-0001cd60: 2068 6569 6768 7420 3132 3030 2220 2b20   height 1200" + 
-0001cd70: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001cd80: 2020 2020 2020 2020 2020 2020 2023 2022               # "
-0001cd90: 636c 6f73 6520 616c 6c22 202b 2022 5c6e  close all" + "\n
-0001cda0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001cdb0: 2020 2020 2020 2020 2020 2320 2273 746f            # "sto
-0001cdc0: 7022 0a0a 2020 2020 2020 2020 2020 2020  p"..            
-0001cdd0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0001cde0: 696d 6572 6158 2076 6572 7369 6f6e 0a20  imeraX version. 
-0001cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce00: 2020 2020 2020 2027 6f70 656e 2027 202b         'open ' +
-0001ce10: 2073 7472 286d 6170 6e61 6d65 2920 2b20   str(mapname) + 
-0001ce20: 2220 666f 726d 6174 2063 6370 3422 202b  " format ccp4" +
-0001ce30: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001ce40: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-0001ce50: 7065 6e20 2220 2b20 7374 7228 6d6f 6465  pen " + str(mode
-0001ce60: 6c2e 6669 6c65 6e61 6d65 2920 2b20 2220  l.filename) + " 
-0001ce70: 666f 726d 6174 206d 6d63 6966 2220 2b20  format mmcif" + 
-0001ce80: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001ce90: 2020 2020 2020 2020 2020 2020 2022 6869               "hi
-0001cea0: 6465 2073 656c 4174 6f6d 7322 202b 2027  de selAtoms" + '
-0001ceb0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001cec0: 2020 2020 2020 2020 2020 2020 2273 686f              "sho
-0001ced0: 7720 7365 6c41 746f 6d73 2072 6962 626f  w selAtoms ribbo
-0001cee0: 6e73 2220 2b20 275c 6e27 0a20 2020 2020  ns" + '\n'.     
-0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf00: 2020 2022 636f 6c6f 7220 2332 2023 3030     "color #2 #00
-0001cf10: 3342 4646 2220 2b20 275c 6e27 0a20 2020  3BFF" + '\n'.   
-0001cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf30: 2020 2020 2022 766f 6c75 6d65 2023 3120       "volume #1 
-0001cf40: 7374 796c 6520 7375 7266 6163 6520 6578  style surface ex
-0001cf50: 7061 6e64 5369 6e67 6c65 506c 616e 6520  pandSinglePlane 
-0001cf60: 5472 7565 2022 202b 2027 5c6e 270a 2020  True " + '\n'.  
-0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf80: 2020 2020 2020 2276 6f6c 756d 6520 2331        "volume #1
-0001cf90: 2063 6f6c 6f72 2023 4238 3836 3042 2073   color #B8860B s
-0001cfa0: 7465 7020 3120 2220 2b20 636f 6e74 6f75  tep 1 " + contou
-0001cfb0: 7220 2b20 275c 6e27 0a20 2020 2020 2020  r + '\n'.       
-0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfd0: 2022 766f 6c75 6d65 2023 3120 7472 616e   "volume #1 tran
-0001cfe0: 7370 6172 656e 6379 2030 2e36 3522 202b  sparency 0.65" +
-0001cff0: 2027 5c6e 2720 2023 206d 616b 6520 7468   '\n'  # make th
-0001d000: 6520 7375 7266 6163 6520 6120 6c69 7474  e surface a litt
-0001d010: 6c65 2062 6974 2073 6565 2d74 6872 6f75  le bit see-throu
-0001d020: 6768 0a20 2020 2020 2020 2020 2020 2020  gh.             
-0001d030: 2020 2020 2020 2020 2020 2022 7365 7420             "set 
-0001d040: 6267 436f 6c6f 7220 6c69 6768 7420 6772  bgColor light gr
-0001d050: 6179 2220 2b20 275c 6e27 0a20 2020 2020  ay" + '\n'.     
-0001d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d070: 2020 2022 7669 6577 2063 6f66 7220 5472     "view cofr Tr
-0001d080: 7565 205c 6e22 0a20 2020 2020 2020 2020  ue \n".         
-0001d090: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001d0a0: 7361 7665 2022 202b 2073 7472 2873 7572  save " + str(sur
-0001d0b0: 6661 6365 666e 2920 2b20 225f 7a73 7572  facefn) + "_zsur
-0001d0c0: 6661 6365 2e6a 7065 6722 202b 2022 2073  face.jpeg" + " s
-0001d0d0: 7570 6572 7361 6d70 6c65 2033 2077 6964  upersample 3 wid
-0001d0e0: 7468 2031 3230 3020 6865 6967 6874 2031  th 1200 height 1
-0001d0f0: 3230 3022 202b 2027 5c6e 270a 2020 2020  200" + '\n'.    
-0001d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d110: 2020 2020 2274 7572 6e20 7820 2d39 3022      "turn x -90"
-0001d120: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d140: 2274 7572 6e20 7920 2d39 3022 202b 2027  "turn y -90" + '
-0001d150: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001d160: 2020 2020 2020 2020 2020 2020 2276 6965              "vie
-0001d170: 7720 636f 6672 2054 7275 6522 202b 2027  w cofr True" + '
+0001a750: 2023 2022 7374 6f70 220a 0a20 2020 2020   # "stop"..     
+0001a760: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001a770: 2043 6869 6d65 7261 5820 7665 7273 696f   ChimeraX versio
+0001a780: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0001a790: 2020 2020 2020 226f 7065 6e20 2220 2b20        "open " + 
+0001a7a0: 7374 7228 7261 776d 6170 6e61 6d65 2920  str(rawmapname) 
+0001a7b0: 2b20 2220 666f 726d 6174 2063 6370 3422  + " format ccp4"
+0001a7c0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0001a7d0: 2020 2020 2020 2020 2020 2020 2276 6f6c              "vol
+0001a7e0: 756d 6520 2331 2073 7479 6c65 2073 7572  ume #1 style sur
+0001a7f0: 6661 6365 2065 7870 616e 6453 696e 676c  face expandSingl
+0001a800: 6550 6c61 6e65 2054 7275 6522 202b 2027  ePlane True" + '
+0001a810: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001a820: 2020 2020 2020 2020 2320 2276 6f6c 756d          # "volum
+0001a830: 6520 2331 2063 6f6c 6f72 2023 4238 3836  e #1 color #B886
+0001a840: 3042 2073 7465 7020 3120 6c65 7665 6c20  0B step 1 level 
+0001a850: 2220 2b20 7374 7228 7365 6c66 2e63 6c29  " + str(self.cl)
+0001a860: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0001a870: 2020 2020 2020 2020 2020 2020 2276 6f6c              "vol
+0001a880: 756d 6520 2331 2073 7465 7020 3120 6c65  ume #1 step 1 le
+0001a890: 7665 6c20 2220 2b20 7374 7228 7261 776d  vel " + str(rawm
+0001a8a0: 6170 636c 2920 2b20 275c 6e27 0a20 2020  apcl) + '\n'.   
+0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8c0: 2022 7365 7420 6267 436f 6c6f 7220 7768   "set bgColor wh
+0001a8d0: 6974 6522 202b 2027 5c6e 270a 2020 2020  ite" + '\n'.    
+0001a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8f0: 226c 6967 6874 696e 6720 6675 6c6c 205c  "lighting full \
+0001a900: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+0001a910: 2020 2020 2020 2022 7669 6577 2063 6f66         "view cof
+0001a920: 7220 5472 7565 205c 6e22 0a20 2020 2020  r True \n".     
+0001a930: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001a940: 7361 7665 2022 202b 2073 7472 286d 6170  save " + str(map
+0001a950: 6e61 6d65 2920 2b20 225f 7a73 7572 6661  name) + "_zsurfa
+0001a960: 6365 2e6a 7065 6722 202b 2022 2073 7570  ce.jpeg" + " sup
+0001a970: 6572 7361 6d70 6c65 2033 2077 6964 7468  ersample 3 width
+0001a980: 2031 3230 3020 6865 6967 6874 2031 3230   1200 height 120
+0001a990: 3022 202b 2027 5c6e 270a 2020 2020 2020  0" + '\n'.      
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
+0001a9b0: 7572 6e20 7820 2d39 3022 202b 2027 5c6e  urn x -90" + '\n
+0001a9c0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001a9d0: 2020 2020 2020 2274 7572 6e20 7920 2d39        "turn y -9
+0001a9e0: 3022 202b 2027 5c6e 270a 2020 2020 2020  0" + '\n'.      
+0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+0001aa00: 6965 7720 636f 6672 2054 7275 6522 202b  iew cofr True" +
+0001aa10: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
+0001aa20: 2020 2020 2020 2020 2020 2273 6176 6520            "save 
+0001aa30: 2220 2b20 7374 7228 6d61 706e 616d 6529  " + str(mapname)
+0001aa40: 202b 2022 5f78 7375 7266 6163 652e 6a70   + "_xsurface.jp
+0001aa50: 6567 2220 2b20 2220 7375 7065 7273 616d  eg" + " supersam
+0001aa60: 706c 6520 3320 7769 6474 6820 3132 3030  ple 3 width 1200
+0001aa70: 2068 6569 6768 7420 3132 3030 2220 2b20   height 1200" + 
+0001aa80: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001aa90: 2020 2020 2020 2020 2022 7669 6577 206f           "view o
+0001aaa0: 7269 656e 7422 202b 2027 5c6e 270a 2020  rient" + '\n'.  
+0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aac0: 2020 2274 7572 6e20 7820 3930 2220 2b20    "turn x 90" + 
+0001aad0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001aae0: 2020 2020 2020 2020 2022 7475 726e 207a           "turn z
+0001aaf0: 2039 3022 202b 2027 5c6e 270a 2020 2020   90" + '\n'.    
+0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab10: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
+0001ab20: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0001ab30: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
+0001ab40: 6520 2220 2b20 7374 7228 6d61 706e 616d  e " + str(mapnam
+0001ab50: 6529 202b 2022 5f79 7375 7266 6163 652e  e) + "_ysurface.
+0001ab60: 6a70 6567 2220 2b20 2220 7375 7065 7273  jpeg" + " supers
+0001ab70: 616d 706c 6520 3320 7769 6474 6820 3132  ample 3 width 12
+0001ab80: 3030 2068 6569 6768 7420 3132 3030 2220  00 height 1200" 
+0001ab90: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0001aba0: 2020 2020 2020 2020 2020 2022 636c 6f73             "clos
+0001abb0: 6520 616c 6c22 202b 2022 5c6e 220a 2020  e all" + "\n".  
+0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abd0: 2020 2265 7869 7422 202b 2027 5c6e 270a    "exit" + '\n'.
+0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abf0: 290a 2020 2020 2020 2020 2020 2020 7472  ).            tr
+0001ac00: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001ac10: 2020 2069 6620 6e6f 7420 6269 6e64 6973     if not bindis
+0001ac20: 706c 6179 3a0a 2020 2020 2020 2020 2020  play:.          
+0001ac30: 2020 2020 2020 2020 2020 7375 6270 726f            subpro
+0001ac40: 6365 7373 2e63 6865 636b 5f63 616c 6c28  cess.check_call(
+0001ac50: 6c6f 6343 4849 4d45 5241 202b 2022 202d  locCHIMERA + " -
+0001ac60: 2d6f 6666 7363 7265 656e 202d 2d6e 6f67  -offscreen --nog
+0001ac70: 7569 2022 202b 2072 6177 6d61 7063 6869  ui " + rawmapchi
+0001ac80: 6d65 7261 636d 642c 0a20 2020 2020 2020  meracmd,.       
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acb0: 2020 2020 2063 7764 3d73 656c 662e 776f       cwd=self.wo
+0001acc0: 726b 6469 722c 2073 6865 6c6c 3d54 7275  rkdir, shell=Tru
+0001acd0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001ace0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001acf0: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+0001ad00: 7072 6f63 6573 732e 6368 6563 6b5f 6361  process.check_ca
+0001ad10: 6c6c 286c 6f63 4348 494d 4552 4120 2b20  ll(locCHIMERA + 
+0001ad20: 2220 2220 2b20 7261 776d 6170 6368 696d  " " + rawmapchim
+0001ad30: 6572 6163 6d64 2c20 6377 643d 7365 6c66  eracmd, cwd=self
+0001ad40: 2e77 6f72 6b64 6972 2c20 7368 656c 6c3d  .workdir, shell=
+0001ad50: 5472 7565 290a 0a20 2020 2020 2020 2020  True)..         
+0001ad60: 2020 2065 7863 6570 7420 7375 6270 726f     except subpro
+0001ad70: 6365 7373 2e43 616c 6c65 6450 726f 6365  cess.CalledProce
+0001ad80: 7373 4572 726f 7220 6173 2073 7562 6572  ssError as suber
+0001ad90: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0001ada0: 2020 2065 7272 203d 2027 5261 7720 6d61     err = 'Raw ma
+0001adb0: 7020 7375 7266 6163 6520 7669 6577 2062  p surface view b
+0001adc0: 7920 4368 696d 6572 6158 2065 7272 6f72  y ChimeraX error
+0001add0: 3a20 7b7d 272e 666f 726d 6174 2873 7562  : {}'.format(sub
+0001ade0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+0001adf0: 2020 2020 2065 7272 6c69 7374 2e61 7070       errlist.app
+0001ae00: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
+0001ae10: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0001ae20: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
+0001ae30: 275c 6e27 290a 0a20 2020 2020 2020 2020  '\n')..         
+0001ae40: 2020 2070 7269 6e74 2827 5261 7720 6d61     print('Raw ma
+0001ae50: 7020 7375 7266 6163 6520 7669 6577 7320  p surface views 
+0001ae60: 7765 7265 2067 656e 6572 6174 6564 2062  were generated b
+0001ae70: 7920 4368 696d 6572 6158 206d 6574 686f  y ChimeraX metho
+0001ae80: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
+0001ae90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001aea0: 2020 2020 2073 656c 662e 7363 616c 655f       self.scale_
+0001aeb0: 7375 7266 6163 6576 6965 7728 290a 2020  surfaceview().  
+0001aec0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0001aed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001aee0: 2020 6572 7220 3d20 2753 6361 6c69 6e67    err = 'Scaling
+0001aef0: 2074 6865 2073 7572 6661 6365 2076 6965   the surface vie
+0001af00: 7773 2065 7272 3a20 7b7d 272e 666f 726d  ws err: {}'.form
+0001af10: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
+0001af20: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+0001af30: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+0001af40: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+0001af50: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+0001af60: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
+0001af70: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+0001af80: 2020 2020 7261 7773 7572 6661 6365 7669      rawsurfacevi
+0001af90: 6577 6a73 6f6e 203d 2064 6963 7428 290a  ewjson = dict().
+0001afa0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0001afb0: 6d61 7078 696d 6167 6520 3d20 7374 7228  mapximage = str(
+0001afc0: 6d61 706e 616d 6529 202b 2027 5f78 7375  mapname) + '_xsu
+0001afd0: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
+0001afe0: 2020 2020 2020 2020 6d61 7078 6c69 7374          mapxlist
+0001aff0: 203d 206f 7574 6d61 7078 696d 6167 652e   = outmapximage.
+0001b000: 7370 6c69 7428 275f 2729 0a20 2020 2020  split('_').     
+0001b010: 2020 2020 2020 206d 6170 7873 6361 6c65         mapxscale
+0001b020: 696d 6167 6520 3d20 275f 272e 6a6f 696e  image = '_'.join
+0001b030: 286d 6170 786c 6973 745b 3a2d 315d 2920  (mapxlist[:-1]) 
+0001b040: 2b20 275f 7363 616c 6564 5f27 202b 206d  + '_scaled_' + m
+0001b050: 6170 786c 6973 745b 2d31 5d0a 2020 2020  apxlist[-1].    
+0001b060: 2020 2020 2020 2020 7261 7773 7572 6661          rawsurfa
+0001b070: 6365 7669 6577 6a73 6f6e 5b27 7827 5d20  ceviewjson['x'] 
+0001b080: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+0001b090: 6d65 286d 6170 7873 6361 6c65 696d 6167  me(mapxscaleimag
+0001b0a0: 6529 2069 6620 6f73 2e70 6174 682e 6973  e) if os.path.is
+0001b0b0: 6669 6c65 280a 2020 2020 2020 2020 2020  file(.          
+0001b0c0: 2020 2020 2020 7365 6c66 2e77 6f72 6b64        self.workd
+0001b0d0: 6972 202b 206d 6170 7873 6361 6c65 696d  ir + mapxscaleim
+0001b0e0: 6167 6529 2065 6c73 6520 4e6f 6e65 0a0a  age) else None..
+0001b0f0: 2020 2020 2020 2020 2020 2020 6f75 746d              outm
+0001b100: 6170 7969 6d61 6765 203d 2073 7472 286d  apyimage = str(m
+0001b110: 6170 6e61 6d65 2920 2b20 275f 7973 7572  apname) + '_ysur
+0001b120: 6661 6365 2e6a 7065 6727 0a20 2020 2020  face.jpeg'.     
+0001b130: 2020 2020 2020 206d 6170 796c 6973 7420         mapylist 
+0001b140: 3d20 6f75 746d 6170 7969 6d61 6765 2e73  = outmapyimage.s
+0001b150: 706c 6974 2827 5f27 290a 2020 2020 2020  plit('_').      
+0001b160: 2020 2020 2020 6d61 7079 7363 616c 6569        mapyscalei
+0001b170: 6d61 6765 203d 2027 5f27 2e6a 6f69 6e28  mage = '_'.join(
+0001b180: 6d61 7079 6c69 7374 5b3a 2d31 5d29 202b  mapylist[:-1]) +
+0001b190: 2027 5f73 6361 6c65 645f 2720 2b20 6d61   '_scaled_' + ma
+0001b1a0: 7079 6c69 7374 5b2d 315d 0a20 2020 2020  pylist[-1].     
+0001b1b0: 2020 2020 2020 2072 6177 7375 7266 6163         rawsurfac
+0001b1c0: 6576 6965 776a 736f 6e5b 2779 275d 203d  eviewjson['y'] =
+0001b1d0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+0001b1e0: 6528 6d61 7079 7363 616c 6569 6d61 6765  e(mapyscaleimage
+0001b1f0: 2920 6966 206f 732e 7061 7468 2e69 7366  ) if os.path.isf
+0001b200: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
+0001b210: 2020 2020 2073 656c 662e 776f 726b 6469       self.workdi
+0001b220: 7220 2b20 6d61 7079 7363 616c 6569 6d61  r + mapyscaleima
+0001b230: 6765 2920 656c 7365 204e 6f6e 650a 0a20  ge) else None.. 
+0001b240: 2020 2020 2020 2020 2020 206f 7574 6d61             outma
+0001b250: 707a 696d 6167 6520 3d20 7374 7228 6d61  pzimage = str(ma
+0001b260: 706e 616d 6529 202b 2027 5f7a 7375 7266  pname) + '_zsurf
+0001b270: 6163 652e 6a70 6567 270a 2020 2020 2020  ace.jpeg'.      
+0001b280: 2020 2020 2020 6d61 707a 6c69 7374 203d        mapzlist =
+0001b290: 206f 7574 6d61 707a 696d 6167 652e 7370   outmapzimage.sp
+0001b2a0: 6c69 7428 275f 2729 0a20 2020 2020 2020  lit('_').       
+0001b2b0: 2020 2020 206d 6170 7a73 6361 6c65 696d       mapzscaleim
+0001b2c0: 6167 6520 3d20 275f 272e 6a6f 696e 286d  age = '_'.join(m
+0001b2d0: 6170 7a6c 6973 745b 3a2d 315d 2920 2b20  apzlist[:-1]) + 
+0001b2e0: 275f 7363 616c 6564 5f27 202b 206d 6170  '_scaled_' + map
+0001b2f0: 7a6c 6973 745b 2d31 5d0a 2020 2020 2020  zlist[-1].      
+0001b300: 2020 2020 2020 7261 7773 7572 6661 6365        rawsurface
+0001b310: 7669 6577 6a73 6f6e 5b27 7a27 5d20 3d20  viewjson['z'] = 
+0001b320: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0001b330: 286d 6170 7a73 6361 6c65 696d 6167 6529  (mapzscaleimage)
+0001b340: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+0001b350: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+0001b360: 2020 2020 7365 6c66 2e77 6f72 6b64 6972      self.workdir
+0001b370: 202b 206d 6170 7a73 6361 6c65 696d 6167   + mapzscaleimag
+0001b380: 6529 2065 6c73 6520 4e6f 6e65 0a20 2020  e) else None.   
+0001b390: 2020 2020 2020 2020 2069 6620 6572 726c           if errl
+0001b3a0: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+0001b3b0: 2020 2020 2072 6177 7375 7266 6163 6576       rawsurfacev
+0001b3c0: 6965 776a 736f 6e5b 2765 7272 275d 203d  iewjson['err'] =
+0001b3d0: 207b 2772 6177 6d61 705f 7375 7266 6163   {'rawmap_surfac
+0001b3e0: 655f 6572 7227 3a20 6572 726c 6973 747d  e_err': errlist}
+0001b3f0: 0a0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+0001b400: 6e61 6c64 6963 7420 3d20 7b27 7261 776d  naldict = {'rawm
+0001b410: 6170 5f6d 6170 5f73 7572 6661 6365 273a  ap_map_surface':
+0001b420: 2072 6177 7375 7266 6163 6576 6965 776a   rawsurfaceviewj
+0001b430: 736f 6e7d 0a20 2020 2020 2020 2020 2020  son}.           
+0001b440: 2072 6177 636c 6469 6374 203d 207b 2772   rawcldict = {'r
+0001b450: 6177 6d61 705f 636f 6e74 6f75 725f 6c65  awmap_contour_le
+0001b460: 7665 6c27 3a20 7b27 636c 273a 2027 7b3a  vel': {'cl': '{:
+0001b470: 302e 3266 7d27 2e66 6f72 6d61 7428 7261  0.2f}'.format(ra
+0001b480: 776d 6170 636c 297d 7d0a 0a20 2020 2020  wmapcl)}}..     
+0001b490: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001b4a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0001b4b0: 2063 6f64 6563 732e 6f70 656e 2873 656c   codecs.open(sel
+0001b4c0: 662e 776f 726b 6469 7220 2b20 6d61 706e  f.workdir + mapn
+0001b4d0: 616d 6520 2b20 275f 7261 776d 6170 7375  ame + '_rawmapsu
+0001b4e0: 7266 6163 6576 6965 772e 6a73 6f6e 272c  rfaceview.json',
+0001b4f0: 2027 7727 2c0a 2020 2020 2020 2020 2020   'w',.          
+0001b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b510: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+0001b520: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
+0001b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b540: 2020 206a 736f 6e2e 6475 6d70 2866 696e     json.dump(fin
+0001b550: 616c 6469 6374 2c20 6629 0a20 2020 2020  aldict, f).     
+0001b560: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0001b570: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001b580: 7272 203d 2027 5361 7669 6e67 206d 6170  rr = 'Saving map
+0001b590: 2073 7572 6661 6365 2076 6965 7720 6a73   surface view js
+0001b5a0: 6f6e 2065 7272 6f72 3a20 7b7d 2e27 2e66  on error: {}.'.f
+0001b5b0: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
+0001b5c0: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
+0001b5d0: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0001b5e0: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
+0001b5f0: 275c 6e27 290a 0a20 2020 2020 2020 2020  '\n')..         
+0001b600: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001b610: 2020 2020 2020 2020 7769 7468 2063 6f64          with cod
+0001b620: 6563 732e 6f70 656e 2873 656c 662e 776f  ecs.open(self.wo
+0001b630: 726b 6469 7220 2b20 6d61 706e 616d 6520  rkdir + mapname 
+0001b640: 2b20 275f 7261 776d 6170 636c 2e6a 736f  + '_rawmapcl.jso
+0001b650: 6e27 2c20 2777 272c 2065 6e63 6f64 696e  n', 'w', encodin
+0001b660: 673d 2775 7466 2d38 2729 2061 7320 6666  g='utf-8') as ff
+0001b670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b680: 2020 2020 2020 6a73 6f6e 2e64 756d 7028        json.dump(
+0001b690: 7261 7763 6c64 6963 742c 2066 6629 0a20  rawcldict, ff). 
+0001b6a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0001b6b0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001b6c0: 2020 2065 7272 203d 2027 5361 7669 6e67     err = 'Saving
+0001b6d0: 2072 6177 6d61 7020 636f 6e74 6f75 7220   rawmap contour 
+0001b6e0: 6c65 7665 6c20 6a73 6f6e 2065 7272 6f72  level json error
+0001b6f0: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 7379  : {}.'.format(sy
+0001b700: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
+0001b710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b720: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
+0001b730: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
+0001b740: 2020 2020 2020 2020 2020 2065 6e64 203d             end =
+0001b750: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
+0001b760: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
+0001b770: 2020 2020 7072 696e 7428 2752 6177 206d      print('Raw m
+0001b780: 6170 2073 7572 6661 6365 2076 6965 7720  ap surface view 
+0001b790: 7469 6d65 3a20 2573 2720 2520 2865 6e64  time: %s' % (end
+0001b7a0: 202d 2073 7461 7274 2929 0a20 2020 2020   - start)).     
+0001b7b0: 2020 2020 2020 2070 7269 6e74 2827 2d2d         print('--
+0001b7c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001b7d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001b7e0: 2d2d 2729 0a0a 2020 2020 2020 2020 656c  --')..        el
+0001b7f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b800: 7072 696e 7428 274e 6f20 7261 7720 6d61  print('No raw ma
+0001b810: 7020 6f72 2068 616c 6620 6d61 7073 206f  p or half maps o
+0001b820: 7220 7261 7720 6d61 7020 636f 6e74 6f75  r raw map contou
+0001b830: 7220 6c65 7665 6c20 666f 7220 7261 7720  r level for raw 
+0001b840: 6d61 7020 7375 7266 6163 6573 2e27 290a  map surfaces.').
+0001b850: 0a0a 2020 2020 2320 5375 7266 6163 6520  ..    # Surface 
+0001b860: 4368 696d 6572 6120 7761 790a 2020 2020  Chimera way.    
+0001b870: 6465 6620 7375 7266 6163 6576 6965 775f  def surfaceview_
+0001b880: 6368 696d 6572 6128 7365 6c66 2c20 6368  chimera(self, ch
+0001b890: 696d 6572 6161 7070 293a 0a20 2020 2020  imeraapp):.     
+0001b8a0: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+0001b8b0: 2020 2047 656e 6572 6174 6520 7375 7266     Generate surf
+0001b8c0: 6163 6520 7669 6577 2062 7920 7573 696e  ace view by usin
+0001b8d0: 6720 6865 6164 6c65 7373 2043 6869 6d65  g headless Chime
+0001b8e0: 7261 2061 6e64 2070 7963 6869 6d65 7261  ra and pychimera
+0001b8f0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001b900: 2020 2020 2020 696d 706f 7274 206d 6d61        import mma
+0001b910: 700a 0a20 2020 2020 2020 2073 7461 7274  p..        start
+0001b920: 203d 2074 696d 6569 742e 6465 6661 756c   = timeit.defaul
+0001b930: 745f 7469 6d65 7228 290a 2020 2020 2020  t_timer().      
+0001b940: 2020 6572 726c 6973 7420 3d20 5b5d 0a20    errlist = []. 
+0001b950: 2020 2020 2020 206d 6d65 7272 6c69 7374         mmerrlist
+0001b960: 203d 205b 5d0a 2020 2020 2020 2020 6269   = [].        bi
+0001b970: 6e64 6973 706c 6179 203d 206f 732e 6765  ndisplay = os.ge
+0001b980: 7465 6e76 2827 4449 5350 4c41 5927 290a  tenv('DISPLAY').
+0001b990: 0a20 2020 2020 2020 206d 6170 6e61 6d65  .        mapname
+0001b9a0: 203d 2073 656c 662e 776f 726b 6469 7220   = self.workdir 
+0001b9b0: 2b20 7365 6c66 2e6d 6170 6e61 6d65 0a20  + self.mapname. 
+0001b9c0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+0001b9d0: 2e70 6174 682e 6973 6669 6c65 286d 6170  .path.isfile(map
+0001b9e0: 6e61 6d65 2920 616e 6420 6f73 2e70 6174  name) and os.pat
+0001b9f0: 682e 6973 6669 6c65 2873 656c 662e 6d61  h.isfile(self.ma
+0001ba00: 706e 616d 6529 3a0a 2020 2020 2020 2020  pname):.        
+0001ba10: 2020 2020 6d61 706e 616d 6520 3d20 7365      mapname = se
+0001ba20: 6c66 2e6d 6170 6e61 6d65 0a0a 2020 2020  lf.mapname..    
+0001ba30: 2020 2020 6c6f 6343 4849 4d45 5241 203d      locCHIMERA =
+0001ba40: 2063 6869 6d65 7261 6170 700a 2020 2020   chimeraapp.    
+0001ba50: 2020 2020 636f 6e74 6f75 7220 3d20 226c      contour = "l
+0001ba60: 6576 656c 2022 202b 2073 7472 2873 656c  evel " + str(sel
+0001ba70: 662e 636c 2920 6966 2073 656c 662e 636c  f.cl) if self.cl
+0001ba80: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0001ba90: 6520 2727 0a20 2020 2020 2020 2023 206d  e ''.        # m
+0001baa0: 6170 2073 7572 6661 6365 2076 6965 7720  ap surface view 
+0001bab0: 616c 6f6e 650a 2020 2020 2020 2020 6d61  alone.        ma
+0001bac0: 7063 6869 6d65 7261 636d 6420 3d20 7365  pchimeracmd = se
+0001bad0: 6c66 2e6d 6170 6e61 6d65 202b 2027 5f63  lf.mapname + '_c
+0001bae0: 6869 6d65 7261 2e63 7863 270a 2020 2020  himera.cxc'.    
+0001baf0: 2020 2020 6173 7365 6d62 6c65 203d 2046      assemble = F
+0001bb00: 616c 7365 0a20 2020 2020 2020 2077 6974  alse.        wit
+0001bb10: 6820 6f70 656e 2873 656c 662e 776f 726b  h open(self.work
+0001bb20: 6469 7220 2b20 6d61 7063 6869 6d65 7261  dir + mapchimera
+0001bb30: 636d 642c 2027 7727 2920 6173 2066 3a0a  cmd, 'w') as f:.
+0001bb40: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+0001bb50: 6974 6528 0a20 2020 2020 2020 2020 2020  ite(.           
+0001bb60: 2020 2020 2023 2043 6869 6d65 7261 2076       # Chimera v
+0001bb70: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
+0001bb80: 2020 2020 2020 2023 2027 6f70 656e 2063         # 'open c
+0001bb90: 6370 343a 2720 2b20 7374 7228 6d61 706e  cp4:' + str(mapn
+0001bba0: 616d 6529 202b 2027 5c6e 270a 2020 2020  ame) + '\n'.    
+0001bbb0: 2020 2020 2020 2020 2020 2020 2320 2276              # "v
+0001bbc0: 6f6c 756d 6520 2330 2073 7479 6c65 2073  olume #0 style s
+0001bbd0: 7572 6661 6365 2065 7870 616e 6453 696e  urface expandSin
+0001bbe0: 676c 6550 6c61 6e65 2054 7275 6520 2220  glePlane True " 
+0001bbf0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0001bc00: 2020 2020 2020 2023 2022 766f 6c75 6d65         # "volume
+0001bc10: 2023 3020 636f 6c6f 7220 2342 3838 3630   #0 color #B8860
+0001bc20: 4220 7374 6570 2031 2022 202b 2063 6f6e  B step 1 " + con
+0001bc30: 746f 7572 202b 2027 5c6e 270a 2020 2020  tour + '\n'.    
+0001bc40: 2020 2020 2020 2020 2020 2020 2320 2273              # "s
+0001bc50: 6574 2070 726f 6a65 6374 696f 6e20 6f72  et projection or
+0001bc60: 7468 6f67 7261 7068 6963 2220 2b20 275c  thographic" + '\
+0001bc70: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001bc80: 2020 2023 2022 7375 7266 7472 616e 7370     # "surftransp
+0001bc90: 2035 3022 202b 2027 5c6e 2720 2023 206d   50" + '\n'  # m
+0001bca0: 616b 6520 7468 6520 7375 7266 6163 6520  ake the surface 
+0001bcb0: 6120 6c69 7474 6c65 2062 6974 2073 6565  a little bit see
+0001bcc0: 2d74 6872 6f75 6768 0a20 2020 2020 2020  -through.       
+0001bcd0: 2020 2020 2020 2020 2023 2022 6261 636b           # "back
+0001bce0: 6772 6f75 6e64 2073 6f6c 6964 206c 6967  ground solid lig
+0001bcf0: 6874 2067 7261 7922 202b 2027 5c6e 270a  ht gray" + '\n'.
+0001bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd10: 2320 2263 6f70 7920 6669 6c65 2022 202b  # "copy file " +
+0001bd20: 2073 7472 2873 656c 662e 6d61 706e 616d   str(self.mapnam
+0001bd30: 6529 202b 2022 5f7a 7375 7266 6163 652e  e) + "_zsurface.
+0001bd40: 6a70 6567 2220 2b20 2220 7375 7065 7273  jpeg" + " supers
+0001bd50: 616d 706c 6520 3320 7769 6474 6820 3132  ample 3 width 12
+0001bd60: 3030 2068 6569 6768 7420 3132 3030 2220  00 height 1200" 
+0001bd70: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0001bd80: 2020 2020 2020 2023 2022 7475 726e 2078         # "turn x
+0001bd90: 202d 3930 2220 2b20 275c 6e27 0a20 2020   -90" + '\n'.   
+0001bda0: 2020 2020 2020 2020 2020 2020 2023 2022               # "
+0001bdb0: 6365 6e74 6572 2220 2b20 275c 6e27 0a20  center" + '\n'. 
+0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001bdd0: 2022 636f 7079 2066 696c 6520 2220 2b20   "copy file " + 
+0001bde0: 7374 7228 7365 6c66 2e6d 6170 6e61 6d65  str(self.mapname
+0001bdf0: 2920 2b20 225f 7873 7572 6661 6365 2e6a  ) + "_xsurface.j
+0001be00: 7065 6722 202b 2022 2073 7570 6572 7361  peg" + " supersa
+0001be10: 6d70 6c65 2033 2077 6964 7468 2031 3230  mple 3 width 120
+0001be20: 3020 6865 6967 6874 2031 3230 3022 202b  0 height 1200" +
+0001be30: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
+0001be40: 2020 2020 2020 2320 2274 7572 6e20 7a20        # "turn z 
+0001be50: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
+0001be60: 2020 2020 2020 2020 2020 2020 2320 2263              # "c
+0001be70: 656e 7465 7222 202b 2027 5c6e 270a 2020  enter" + '\n'.  
+0001be80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001be90: 2263 6f70 7920 6669 6c65 2022 202b 2073  "copy file " + s
+0001bea0: 7472 2873 656c 662e 6d61 706e 616d 6529  tr(self.mapname)
+0001beb0: 202b 2022 5f79 7375 7266 6163 652e 6a70   + "_ysurface.jp
+0001bec0: 6567 2220 2b20 2220 7375 7065 7273 616d  eg" + " supersam
+0001bed0: 706c 6520 3320 7769 6474 6820 3132 3030  ple 3 width 1200
+0001bee0: 2068 6569 6768 7420 3132 3030 2220 2b20   height 1200" + 
+0001bef0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001bf00: 2020 2020 2023 2022 636c 6f73 6520 616c       # "close al
+0001bf10: 6c22 202b 2022 5c6e 220a 2020 2020 2020  l" + "\n".      
+0001bf20: 2020 2020 2020 2020 2020 2320 2273 746f            # "sto
+0001bf30: 7022 0a0a 2020 2020 2020 2020 2020 2020  p"..            
+0001bf40: 2020 2020 2320 4368 696d 6572 6158 2076      # ChimeraX v
+0001bf50: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
+0001bf60: 2020 2020 2020 2022 6f70 656e 2022 202b         "open " +
+0001bf70: 2073 7472 286d 6170 6e61 6d65 2920 2b20   str(mapname) + 
+0001bf80: 2220 666f 726d 6174 2063 6370 3422 202b  " format ccp4" +
+0001bf90: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
+0001bfa0: 2020 2020 2020 2276 6f6c 756d 6520 2331        "volume #1
+0001bfb0: 2073 7479 6c65 2073 7572 6661 6365 2065   style surface e
+0001bfc0: 7870 616e 6453 696e 676c 6550 6c61 6e65  xpandSinglePlane
+0001bfd0: 2054 7275 6522 202b 2027 5c6e 270a 2020   True" + '\n'.  
+0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001bff0: 2276 6f6c 756d 6520 2331 2063 6f6c 6f72  "volume #1 color
+0001c000: 2023 4238 3836 3042 2073 7465 7020 3120   #B8860B step 1 
+0001c010: 6c65 7665 6c20 2220 2b20 7374 7228 7365  level " + str(se
+0001c020: 6c66 2e63 6c29 202b 2027 5c6e 270a 2020  lf.cl) + '\n'.  
+0001c030: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+0001c040: 6f6c 756d 6520 2331 2073 7465 7020 3120  olume #1 step 1 
+0001c050: 6c65 7665 6c20 2220 2b20 7374 7228 7365  level " + str(se
+0001c060: 6c66 2e63 6c29 202b 2027 5c6e 270a 2020  lf.cl) + '\n'.  
+0001c070: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+0001c080: 6574 2062 6743 6f6c 6f72 2077 6869 7465  et bgColor white
+0001c090: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001c0a0: 2020 2020 2020 2020 2022 6c69 6768 7469           "lighti
+0001c0b0: 6e67 2066 756c 6c20 5c6e 220a 2020 2020  ng full \n".    
+0001c0c0: 2020 2020 2020 2020 2020 2020 2276 6965              "vie
+0001c0d0: 7720 636f 6672 2054 7275 6520 5c6e 220a  w cofr True \n".
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0f0: 2273 6176 6520 2220 2b20 7374 7228 7365  "save " + str(se
+0001c100: 6c66 2e6d 6170 6e61 6d65 2920 2b20 225f  lf.mapname) + "_
+0001c110: 7a73 7572 6661 6365 2e6a 7065 6722 202b  zsurface.jpeg" +
+0001c120: 2022 2073 7570 6572 7361 6d70 6c65 2033   " supersample 3
+0001c130: 2077 6964 7468 2031 3230 3020 6865 6967   width 1200 heig
+0001c140: 6874 2031 3230 3022 202b 2027 5c6e 270a  ht 1200" + '\n'.
+0001c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c160: 2274 7572 6e20 7820 2d39 3022 202b 2027  "turn x -90" + '
+0001c170: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001c180: 2020 2020 2274 7572 6e20 7920 2d39 3022      "turn y -90"
+0001c190: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0001c1a0: 2020 2020 2020 2020 2276 6965 7720 636f          "view co
+0001c1b0: 6672 2054 7275 6522 202b 2027 5c6e 270a  fr True" + '\n'.
+0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1d0: 2273 6176 6520 2220 2b20 7374 7228 7365  "save " + str(se
+0001c1e0: 6c66 2e6d 6170 6e61 6d65 2920 2b20 225f  lf.mapname) + "_
+0001c1f0: 7873 7572 6661 6365 2e6a 7065 6722 202b  xsurface.jpeg" +
+0001c200: 2022 2073 7570 6572 7361 6d70 6c65 2033   " supersample 3
+0001c210: 2077 6964 7468 2031 3230 3020 6865 6967   width 1200 heig
+0001c220: 6874 2031 3230 3022 202b 2027 5c6e 270a  ht 1200" + '\n'.
+0001c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c240: 2276 6965 7720 6f72 6965 6e74 2220 2b20  "view orient" + 
+0001c250: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001c260: 2020 2020 2022 7475 726e 2078 2039 3022       "turn x 90"
+0001c270: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0001c280: 2020 2020 2020 2020 2274 7572 6e20 7a20          "turn z 
+0001c290: 3930 2220 2b20 275c 6e27 0a20 2020 2020  90" + '\n'.     
+0001c2a0: 2020 2020 2020 2020 2020 2022 7669 6577             "view
+0001c2b0: 2063 6f66 7220 5472 7565 2220 2b20 275c   cofr True" + '\
+0001c2c0: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001c2d0: 2020 2022 7361 7665 2022 202b 2073 7472     "save " + str
+0001c2e0: 2873 656c 662e 6d61 706e 616d 6529 202b  (self.mapname) +
+0001c2f0: 2022 5f79 7375 7266 6163 652e 6a70 6567   "_ysurface.jpeg
+0001c300: 2220 2b20 2220 7375 7065 7273 616d 706c  " + " supersampl
+0001c310: 6520 3320 7769 6474 6820 3132 3030 2068  e 3 width 1200 h
+0001c320: 6569 6768 7420 3132 3030 2220 2b20 275c  eight 1200" + '\
+0001c330: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001c340: 2020 2022 636c 6f73 6520 616c 6c22 202b     "close all" +
+0001c350: 2022 5c6e 220a 2020 2020 2020 2020 2020   "\n".          
+0001c360: 2020 2020 2020 2265 7869 7422 202b 2027        "exit" + '
+0001c370: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001c380: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
+0001c390: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001c3a0: 6f74 2062 696e 6469 7370 6c61 793a 0a20  ot bindisplay:. 
+0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c3c0: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
+0001c3d0: 6361 6c6c 286c 6f63 4348 494d 4552 4120  call(locCHIMERA 
+0001c3e0: 2b20 2220 2d2d 6f66 6673 6372 6565 6e20  + " --offscreen 
+0001c3f0: 2d2d 6e6f 6775 6920 2220 2b20 7365 6c66  --nogui " + self
+0001c400: 2e77 6f72 6b64 6972 202b 206d 6170 6368  .workdir + mapch
+0001c410: 696d 6572 6163 6d64 2c0a 2020 2020 2020  imeracmd,.      
+0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c440: 2020 6377 643d 7365 6c66 2e77 6f72 6b64    cwd=self.workd
+0001c450: 6972 2c20 7368 656c 6c3d 5472 7565 290a  ir, shell=True).
+0001c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c470: 656e 6420 3d20 7469 6d65 6974 2e64 6566  end = timeit.def
+0001c480: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
+0001c490: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001c4a0: 6e74 2827 5072 696d 6172 7920 6d61 7020  nt('Primary map 
+0001c4b0: 7375 7266 6163 6520 7669 6577 2074 696d  surface view tim
+0001c4c0: 653a 2025 7327 2025 2028 656e 6420 2d20  e: %s' % (end - 
+0001c4d0: 7374 6172 7429 290a 2020 2020 2020 2020  start)).        
+0001c4e0: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+0001c4f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c510: 2d2d 2d27 290a 2020 2020 2020 2020 2020  ---').          
+0001c520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001c530: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
+0001c540: 7373 2e63 6865 636b 5f63 616c 6c28 6c6f  ss.check_call(lo
+0001c550: 6343 4849 4d45 5241 202b 2022 2022 202b  cCHIMERA + " " +
+0001c560: 2073 656c 662e 776f 726b 6469 7220 2b20   self.workdir + 
+0001c570: 6d61 7063 6869 6d65 7261 636d 642c 2063  mapchimeracmd, c
+0001c580: 7764 3d73 656c 662e 776f 726b 6469 722c  wd=self.workdir,
+0001c590: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
+0001c5a0: 2020 2020 2020 2020 2020 2020 2065 6e64               end
+0001c5b0: 203d 2074 696d 6569 742e 6465 6661 756c   = timeit.defaul
+0001c5c0: 745f 7469 6d65 7228 290a 2020 2020 2020  t_timer().      
+0001c5d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001c5e0: 2750 7269 6d61 7279 206d 6170 2073 7572  'Primary map sur
+0001c5f0: 6661 6365 2076 6965 7720 7469 6d65 3a20  face view time: 
+0001c600: 2573 2720 2520 2865 6e64 202d 2073 7461  %s' % (end - sta
+0001c610: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
+0001c620: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+0001c630: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c650: 2729 0a20 2020 2020 2020 2065 7863 6570  ').        excep
+0001c660: 7420 7375 6270 726f 6365 7373 2e43 616c  t subprocess.Cal
+0001c670: 6c65 6450 726f 6365 7373 4572 726f 7220  ledProcessError 
+0001c680: 6173 2073 7562 6572 723a 0a20 2020 2020  as suberr:.     
+0001c690: 2020 2020 2020 2065 6e64 203d 2074 696d         end = tim
+0001c6a0: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
+0001c6b0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+0001c6c0: 6572 7220 3d20 2750 7269 6d61 7279 206d  err = 'Primary m
+0001c6d0: 6170 2073 7572 6661 6365 2076 6965 7720  ap surface view 
+0001c6e0: 6279 2043 6869 6d65 7261 5820 6572 726f  by ChimeraX erro
+0001c6f0: 723a 207b 7d27 2e66 6f72 6d61 7428 7375  r: {}'.format(su
+0001c700: 6265 7272 290a 2020 2020 2020 2020 2020  berr).          
+0001c710: 2020 7072 696e 7428 2750 7269 6d61 7279    print('Primary
+0001c720: 206d 6170 2073 7572 6661 6365 2076 6965   map surface vie
+0001c730: 7720 7469 6d65 3a20 2573 2720 2520 2865  w time: %s' % (e
+0001c740: 6e64 202d 2073 7461 7274 2929 0a20 2020  nd - start)).   
+0001c750: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0001c760: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c770: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001c780: 2d2d 2d2d 2729 0a20 2020 2020 2020 2020  ----').         
+0001c790: 2020 2065 7272 6c69 7374 2e61 7070 656e     errlist.appen
+0001c7a0: 6428 6572 7229 0a20 2020 2020 2020 2020  d(err).         
+0001c7b0: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
+0001c7c0: 6974 6528 6572 7220 2b20 275c 6e27 290a  ite(err + '\n').
+0001c7d0: 0a0a 2020 2020 2020 2020 2320 6d61 7020  ..        # map 
+0001c7e0: 616e 6420 6d6f 6465 6c73 2076 6965 7720  and models view 
+0001c7f0: 746f 6765 7468 6572 0a20 2020 2020 2020  together.       
+0001c800: 206e 7374 6172 7420 3d20 7469 6d65 6974   nstart = timeit
+0001c810: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
+0001c820: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001c830: 2e6d 6f64 656c 733a 0a20 2020 2020 2020  .models:.       
+0001c840: 2020 2020 2066 6f72 206d 6f64 656c 2069       for model i
+0001c850: 6e20 7365 6c66 2e6d 6f64 656c 733a 0a20  n self.models:. 
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001c870: 2070 6462 6964 203d 206d 6f64 656c 2e66   pdbid = model.f
+0001c880: 696c 656e 616d 652e 7370 6c69 7428 272f  ilename.split('/
+0001c890: 2729 5b2d 315d 2e73 706c 6974 2827 2e27  ')[-1].split('.'
+0001c8a0: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
+0001c8b0: 2020 2020 2070 6462 6964 203d 206f 732e       pdbid = os.
+0001c8c0: 7061 7468 2e62 6173 656e 616d 6528 6d6f  path.basename(mo
+0001c8d0: 6465 6c2e 6669 6c65 6e61 6d65 290a 2020  del.filename).  
+0001c8e0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0001c8f0: 7266 6163 6566 6e20 3d20 277b 7d5f 7b7d  rfacefn = '{}_{}
+0001c900: 272e 666f 726d 6174 2870 6462 6964 2c20  '.format(pdbid, 
+0001c910: 7365 6c66 2e6d 6170 6e61 6d65 290a 2020  self.mapname).  
+0001c920: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0001c930: 696d 6572 6163 6d64 203d 2073 7572 6661  imeracmd = surfa
+0001c940: 6365 666e 202b 2027 5f63 6869 6d65 7261  cefn + '_chimera
+0001c950: 2e63 7863 270a 2020 2020 2020 2020 2020  .cxc'.          
+0001c960: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+0001c970: 7365 6c66 2e77 6f72 6b64 6972 202b 2063  self.workdir + c
+0001c980: 6869 6d65 7261 636d 642c 2027 7727 2920  himeracmd, 'w') 
+0001c990: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0001c9a0: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
+0001c9b0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0001c9c0: 2020 2020 2020 2020 2020 2023 2043 6869             # Chi
+0001c9d0: 6d65 7261 2076 6572 7369 6f6e 0a20 2020  mera version.   
+0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9f0: 2020 2020 2023 2027 6f70 656e 2063 6370       # 'open ccp
+0001ca00: 343a 2720 2b20 7374 7228 6d61 706e 616d  4:' + str(mapnam
+0001ca10: 6529 202b 2027 5c6e 270a 2020 2020 2020  e) + '\n'.      
+0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca30: 2020 2320 226f 7065 6e20 6369 663a 2220    # "open cif:" 
+0001ca40: 2b20 7374 7228 6d6f 6465 6c2e 6669 6c65  + str(model.file
+0001ca50: 6e61 6d65 2920 2b20 275c 6e27 0a20 2020  name) + '\n'.   
+0001ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca70: 2020 2020 2023 2022 766f 6c75 6d65 2023       # "volume #
+0001ca80: 3020 7374 796c 6520 7375 7266 6163 6520  0 style surface 
+0001ca90: 6578 7061 6e64 5369 6e67 6c65 506c 616e  expandSinglePlan
+0001caa0: 6520 5472 7565 2022 202b 2027 5c6e 270a  e True " + '\n'.
+0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cac0: 2020 2020 2020 2020 2320 2276 6f6c 756d          # "volum
+0001cad0: 6520 2330 2063 6f6c 6f72 2023 4238 3836  e #0 color #B886
+0001cae0: 3042 2073 7465 7020 3120 2220 2b20 636f  0B step 1 " + co
+0001caf0: 6e74 6f75 7220 2b20 275c 6e27 0a20 2020  ntour + '\n'.   
+0001cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb10: 2020 2020 2023 2022 7365 7420 7072 6f6a       # "set proj
+0001cb20: 6563 7469 6f6e 206f 7274 686f 6772 6170  ection orthograp
+0001cb30: 6869 6322 202b 2027 5c6e 270a 2020 2020  hic" + '\n'.    
+0001cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb50: 2020 2020 2320 2273 7572 6674 7261 6e73      # "surftrans
+0001cb60: 7020 3530 2220 2b20 275c 6e27 2020 2320  p 50" + '\n'  # 
+0001cb70: 6d61 6b65 2074 6865 2073 7572 6661 6365  make the surface
+0001cb80: 2061 206c 6974 746c 6520 6269 7420 7365   a little bit se
+0001cb90: 652d 7468 726f 7567 680a 2020 2020 2020  e-through.      
+0001cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbb0: 2020 2320 2262 6163 6b67 726f 756e 6420    # "background 
+0001cbc0: 736f 6c69 6420 6c69 6768 7420 6772 6179  solid light gray
+0001cbd0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbf0: 2023 2022 636f 7079 2066 696c 6520 2220   # "copy file " 
+0001cc00: 2b20 7374 7228 7375 7266 6163 6566 6e29  + str(surfacefn)
+0001cc10: 202b 2022 5f7a 7375 7266 6163 652e 6a70   + "_zsurface.jp
+0001cc20: 6567 2220 2b20 2220 7375 7065 7273 616d  eg" + " supersam
+0001cc30: 706c 6520 3320 7769 6474 6820 3132 3030  ple 3 width 1200
+0001cc40: 2068 6569 6768 7420 3132 3030 2220 2b20   height 1200" + 
+0001cc50: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001cc60: 2020 2020 2020 2020 2020 2020 2023 2022               # "
+0001cc70: 7475 726e 2078 202d 3930 2220 2b20 275c  turn x -90" + '\
+0001cc80: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001cc90: 2020 2020 2020 2020 2020 2023 2022 6365             # "ce
+0001cca0: 6e74 6572 2220 2b20 275c 6e27 0a20 2020  nter" + '\n'.   
+0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccc0: 2020 2020 2023 2022 636f 7079 2066 696c       # "copy fil
+0001ccd0: 6520 2220 2b20 7374 7228 7375 7266 6163  e " + str(surfac
+0001cce0: 6566 6e29 202b 2022 5f78 7375 7266 6163  efn) + "_xsurfac
+0001ccf0: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
+0001cd00: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
+0001cd10: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
+0001cd20: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd40: 2023 2022 7475 726e 207a 202d 3930 2220   # "turn z -90" 
+0001cd50: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001cd70: 2022 6365 6e74 6572 2220 2b20 275c 6e27   "center" + '\n'
+0001cd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd90: 2020 2020 2020 2020 2023 2022 636f 7079           # "copy
+0001cda0: 2066 696c 6520 2220 2b20 7374 7228 7375   file " + str(su
+0001cdb0: 7266 6163 6566 6e29 202b 2022 5f79 7375  rfacefn) + "_ysu
+0001cdc0: 7266 6163 652e 6a70 6567 2220 2b20 2220  rface.jpeg" + " 
+0001cdd0: 7375 7065 7273 616d 706c 6520 3320 7769  supersample 3 wi
+0001cde0: 6474 6820 3132 3030 2068 6569 6768 7420  dth 1200 height 
+0001cdf0: 3132 3030 2220 2b20 275c 6e27 0a20 2020  1200" + '\n'.   
+0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce10: 2020 2020 2023 2022 636c 6f73 6520 616c       # "close al
+0001ce20: 6c22 202b 2022 5c6e 220a 2020 2020 2020  l" + "\n".      
+0001ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce40: 2020 2320 2273 746f 7022 0a0a 2020 2020    # "stop"..    
+0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce60: 2020 2020 2320 4368 696d 6572 6158 2076      # ChimeraX v
+0001ce70: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
+0001ce80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001ce90: 6f70 656e 2027 202b 2073 7472 286d 6170  open ' + str(map
+0001cea0: 6e61 6d65 2920 2b20 2220 666f 726d 6174  name) + " format
+0001ceb0: 2063 6370 3422 202b 2027 5c6e 270a 2020   ccp4" + '\n'.  
+0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ced0: 2020 2020 2020 226f 7065 6e20 2220 2b20        "open " + 
+0001cee0: 7374 7228 6d6f 6465 6c2e 6669 6c65 6e61  str(model.filena
+0001cef0: 6d65 2920 2b20 2220 666f 726d 6174 206d  me) + " format m
+0001cf00: 6d63 6966 2220 2b20 275c 6e27 0a20 2020  mcif" + '\n'.   
+0001cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf20: 2020 2020 2022 6869 6465 2073 656c 4174       "hide selAt
+0001cf30: 6f6d 7322 202b 2027 5c6e 270a 2020 2020  oms" + '\n'.    
+0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf50: 2020 2020 2273 686f 7720 7365 6c41 746f      "show selAto
+0001cf60: 6d73 2072 6962 626f 6e73 2220 2b20 275c  ms ribbons" + '\
+0001cf70: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001cf80: 2020 2020 2020 2020 2020 2022 636f 6c6f             "colo
+0001cf90: 7220 2332 2023 3030 3342 4646 2220 2b20  r #2 #003BFF" + 
+0001cfa0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001cfb0: 2020 2020 2020 2020 2020 2020 2022 766f               "vo
+0001cfc0: 6c75 6d65 2023 3120 7374 796c 6520 7375  lume #1 style su
+0001cfd0: 7266 6163 6520 6578 7061 6e64 5369 6e67  rface expandSing
+0001cfe0: 6c65 506c 616e 6520 5472 7565 2022 202b  lePlane True " +
+0001cff0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
+0001d000: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+0001d010: 6f6c 756d 6520 2331 2063 6f6c 6f72 2023  olume #1 color #
+0001d020: 4238 3836 3042 2073 7465 7020 3120 2220  B8860B step 1 " 
+0001d030: 2b20 636f 6e74 6f75 7220 2b20 275c 6e27  + contour + '\n'
+0001d040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d050: 2020 2020 2020 2020 2022 766f 6c75 6d65           "volume
+0001d060: 2023 3120 7472 616e 7370 6172 656e 6379   #1 transparency
+0001d070: 2030 2e36 3522 202b 2027 5c6e 2720 2023   0.65" + '\n'  #
+0001d080: 206d 616b 6520 7468 6520 7375 7266 6163   make the surfac
+0001d090: 6520 6120 6c69 7474 6c65 2062 6974 2073  e a little bit s
+0001d0a0: 6565 2d74 6872 6f75 6768 0a20 2020 2020  ee-through.     
+0001d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0c0: 2020 2022 7365 7420 6267 436f 6c6f 7220     "set bgColor 
+0001d0d0: 6c69 6768 7420 6772 6179 2220 2b20 275c  light gray" + '\
+0001d0e0: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0001d0f0: 2020 2020 2020 2020 2020 2022 7669 6577             "view
+0001d100: 2063 6f66 7220 5472 7565 205c 6e22 0a20   cofr True \n". 
+0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d120: 2020 2020 2020 2022 7361 7665 2022 202b         "save " +
+0001d130: 2073 7472 2873 7572 6661 6365 666e 2920   str(surfacefn) 
+0001d140: 2b20 225f 7a73 7572 6661 6365 2e6a 7065  + "_zsurface.jpe
+0001d150: 6722 202b 2022 2073 7570 6572 7361 6d70  g" + " supersamp
+0001d160: 6c65 2033 2077 6964 7468 2031 3230 3020  le 3 width 1200 
+0001d170: 6865 6967 6874 2031 3230 3022 202b 2027  height 1200" + '
 0001d180: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001d190: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
-0001d1a0: 6520 2220 2b20 7374 7228 7375 7266 6163  e " + str(surfac
-0001d1b0: 6566 6e29 202b 2022 5f78 7375 7266 6163  efn) + "_xsurfac
-0001d1c0: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
-0001d1d0: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
-0001d1e0: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
-0001d1f0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
-0001d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d210: 2022 7669 6577 206f 7269 656e 7422 202b   "view orient" +
-0001d220: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001d230: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-0001d240: 7572 6e20 7820 3930 2220 2b20 275c 6e27  urn x 90" + '\n'
-0001d250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d260: 2020 2020 2020 2020 2022 7475 726e 207a           "turn z
-0001d270: 2039 3022 202b 2027 5c6e 270a 2020 2020   90" + '\n'.    
-0001d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d290: 2020 2020 2276 6965 7720 636f 6672 2054      "view cofr T
-0001d2a0: 7275 6522 202b 2027 5c6e 270a 2020 2020  rue" + '\n'.    
+0001d190: 2020 2020 2020 2020 2020 2020 2274 7572              "tur
+0001d1a0: 6e20 7820 2d39 3022 202b 2027 5c6e 270a  n x -90" + '\n'.
+0001d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1c0: 2020 2020 2020 2020 2274 7572 6e20 7920          "turn y 
+0001d1d0: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
+0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1f0: 2020 2020 2276 6965 7720 636f 6672 2054      "view cofr T
+0001d200: 7275 6522 202b 2027 5c6e 270a 2020 2020  rue" + '\n'.    
+0001d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d220: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
+0001d230: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
+0001d240: 5f78 7375 7266 6163 652e 6a70 6567 2220  _xsurface.jpeg" 
+0001d250: 2b20 2220 7375 7065 7273 616d 706c 6520  + " supersample 
+0001d260: 3320 7769 6474 6820 3132 3030 2068 6569  3 width 1200 hei
+0001d270: 6768 7420 3132 3030 2220 2b20 275c 6e27  ght 1200" + '\n'
+0001d280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d290: 2020 2020 2020 2020 2022 7669 6577 206f           "view o
+0001d2a0: 7269 656e 7422 202b 2027 5c6e 270a 2020  rient" + '\n'.  
 0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2c0: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
-0001d2d0: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
-0001d2e0: 5f79 7375 7266 6163 652e 6a70 6567 2220  _ysurface.jpeg" 
-0001d2f0: 2b20 2220 7375 7065 7273 616d 706c 6520  + " supersample 
-0001d300: 3320 7769 6474 6820 3132 3030 2068 6569  3 width 1200 hei
-0001d310: 6768 7420 3132 3030 2220 2b20 275c 6e27  ght 1200" + '\n'
-0001d320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d330: 2020 2020 2020 2020 2022 636c 6f73 6520           "close 
-0001d340: 616c 6c22 202b 2022 5c6e 220a 2020 2020  all" + "\n".    
-0001d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d360: 2020 2020 2265 7869 7422 0a0a 2020 2020      "exit"..    
-0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d380: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d390: 2020 7769 7468 206f 7065 6e28 7374 7228    with open(str(
-0001d3a0: 6d6f 6465 6c2e 6669 6c65 6e61 6d65 2929  model.filename))
-0001d3b0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0001d3c0: 2020 2020 2020 2020 2020 2073 203d 206d             s = m
-0001d3d0: 6d61 702e 6d6d 6170 2866 2e66 696c 656e  map.mmap(f.filen
-0001d3e0: 6f28 292c 2030 2c20 6163 6365 7373 3d6d  o(), 0, access=m
-0001d3f0: 6d61 702e 4143 4345 5353 5f52 4541 4429  map.ACCESS_READ)
-0001d400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d410: 2020 2020 2023 2070 7974 686f 6e20 3320       # python 3 
-0001d420: 6d6d 6170 2e6d 6d61 7028 6669 6c65 2e66  mmap.mmap(file.f
-0001d430: 696c 656e 6f28 292c 2030 2c20 6163 6365  ileno(), 0, acce
-0001d440: 7373 3d6d 6d61 702e 4143 4345 5353 5f52  ss=mmap.ACCESS_R
-0001d450: 4541 4429 2061 7320 733a 0a20 2020 2020  EAD) as s:.     
-0001d460: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d470: 6620 732e 6669 6e64 2862 2770 6f69 6e74  f s.find(b'point
-0001d480: 2073 796d 6d65 7472 7920 6f70 6572 6174   symmetry operat
-0001d490: 696f 6e27 2920 213d 202d 313a 0a20 2020  ion') != -1:.   
-0001d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4b0: 2020 2020 2061 7373 656d 626c 6520 3d20       assemble = 
-0001d4c0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0001d4d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4f0: 2020 2020 2020 2061 7373 656d 626c 6520         assemble 
-0001d500: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0001d510: 2020 2020 2020 2020 6368 696d 6572 6163          chimerac
-0001d520: 6d64 6173 7365 6d62 6c65 203d 2073 7572  mdassemble = sur
-0001d530: 6661 6365 666e 202b 2027 5f63 6869 6d65  facefn + '_chime
-0001d540: 7261 5f61 7373 656d 626c 652e 6378 6327  ra_assemble.cxc'
-0001d550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d560: 2069 6620 6173 7365 6d62 6c65 3a0a 2020   if assemble:.  
-0001d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d580: 2020 6d6f 6465 6c6e 616d 6520 3d20 6f73    modelname = os
-0001d590: 2e70 6174 682e 6261 7365 6e61 6d65 286d  .path.basename(m
-0001d5a0: 6f64 656c 2e66 696c 656e 616d 6529 0a20  odel.filename). 
-0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5c0: 2020 206d 6170 6e61 6d65 203d 206f 732e     mapname = os.
-0001d5d0: 7061 7468 2e62 6173 656e 616d 6528 6d61  path.basename(ma
-0001d5e0: 706e 616d 6529 0a20 2020 2020 2020 2020  pname).         
-0001d5f0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0001d600: 7820 3d20 277b 7d5f 7b7d 272e 666f 726d  x = '{}_{}'.form
-0001d610: 6174 286d 6f64 656c 6e61 6d65 2c20 6d61  at(modelname, ma
-0001d620: 706e 616d 6529 0a0a 2020 2020 2020 2020  pname)..        
-0001d630: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001d640: 206f 7065 6e28 7365 6c66 2e77 6f72 6b64   open(self.workd
-0001d650: 6972 202b 2063 6869 6d65 7261 636d 6461  ir + chimeracmda
-0001d660: 7373 656d 626c 652c 2027 7727 2920 6173  ssemble, 'w') as
-0001d670: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-0001d680: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-0001d690: 6974 6528 0a20 2020 2020 2020 2020 2020  ite(.           
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6b0: 2023 2043 6869 6d65 7261 5820 7665 7273   # ChimeraX vers
-0001d6c0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-0001d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6e0: 226f 7065 6e20 2220 2b20 7374 7228 6d61  "open " + str(ma
-0001d6f0: 706e 616d 6529 202b 2022 2066 6f72 6d61  pname) + " forma
-0001d700: 7420 6363 7034 2220 2b20 275c 6e27 0a20  t ccp4" + '\n'. 
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 2020 2020 2020 2020 2020 2022 6f70 656e             "open
-0001d730: 2022 202b 2073 7472 286d 6f64 656c 2e66   " + str(model.f
-0001d740: 696c 656e 616d 6529 202b 2022 2066 6f72  ilename) + " for
-0001d750: 6d61 7420 6d6d 6369 6622 202b 2027 5c6e  mat mmcif" + '\n
-0001d760: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001d770: 2020 2020 2020 2020 2020 2020 2020 2268                "h
-0001d780: 6964 6520 7365 6c41 746f 6d73 2220 2b20  ide selAtoms" + 
-0001d790: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0001d2c0: 2020 2020 2020 2274 7572 6e20 7820 3930        "turn x 90
+0001d2d0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2f0: 2022 7475 726e 207a 2039 3022 202b 2027   "turn z 90" + '
+0001d300: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001d310: 2020 2020 2020 2020 2020 2020 2276 6965              "vie
+0001d320: 7720 636f 6672 2054 7275 6522 202b 2027  w cofr True" + '
+0001d330: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001d340: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
+0001d350: 6520 2220 2b20 7374 7228 7375 7266 6163  e " + str(surfac
+0001d360: 6566 6e29 202b 2022 5f79 7375 7266 6163  efn) + "_ysurfac
+0001d370: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
+0001d380: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
+0001d390: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
+0001d3a0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3c0: 2022 636c 6f73 6520 616c 6c22 202b 2022   "close all" + "
+0001d3d0: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+0001d3e0: 2020 2020 2020 2020 2020 2020 2265 7869              "exi
+0001d3f0: 7422 0a0a 2020 2020 2020 2020 2020 2020  t"..            
+0001d400: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001d410: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+0001d420: 7065 6e28 7374 7228 6d6f 6465 6c2e 6669  pen(str(model.fi
+0001d430: 6c65 6e61 6d65 2929 2061 7320 663a 0a20  lename)) as f:. 
+0001d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d450: 2020 2073 203d 206d 6d61 702e 6d6d 6170     s = mmap.mmap
+0001d460: 2866 2e66 696c 656e 6f28 292c 2030 2c20  (f.fileno(), 0, 
+0001d470: 6163 6365 7373 3d6d 6d61 702e 4143 4345  access=mmap.ACCE
+0001d480: 5353 5f52 4541 4429 0a20 2020 2020 2020  SS_READ).       
+0001d490: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+0001d4a0: 7974 686f 6e20 3320 6d6d 6170 2e6d 6d61  ython 3 mmap.mma
+0001d4b0: 7028 6669 6c65 2e66 696c 656e 6f28 292c  p(file.fileno(),
+0001d4c0: 2030 2c20 6163 6365 7373 3d6d 6d61 702e   0, access=mmap.
+0001d4d0: 4143 4345 5353 5f52 4541 4429 2061 7320  ACCESS_READ) as 
+0001d4e0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001d4f0: 2020 2020 2020 2069 6620 732e 6669 6e64         if s.find
+0001d500: 2862 2770 6f69 6e74 2073 796d 6d65 7472  (b'point symmetr
+0001d510: 7920 6f70 6572 6174 696f 6e27 2920 213d  y operation') !=
+0001d520: 202d 313a 0a20 2020 2020 2020 2020 2020   -1:.           
+0001d530: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0001d540: 656d 626c 6520 3d20 5472 7565 0a20 2020  emble = True.   
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001d570: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001d580: 7373 656d 626c 6520 3d20 4661 6c73 650a  ssemble = False.
+0001d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5a0: 6368 696d 6572 6163 6d64 6173 7365 6d62  chimeracmdassemb
+0001d5b0: 6c65 203d 2073 7572 6661 6365 666e 202b  le = surfacefn +
+0001d5c0: 2027 5f63 6869 6d65 7261 5f61 7373 656d   '_chimera_assem
+0001d5d0: 626c 652e 6378 6327 0a20 2020 2020 2020  ble.cxc'.       
+0001d5e0: 2020 2020 2020 2020 2069 6620 6173 7365           if asse
+0001d5f0: 6d62 6c65 3a0a 2020 2020 2020 2020 2020  mble:.          
+0001d600: 2020 2020 2020 2020 2020 6d6f 6465 6c6e            modeln
+0001d610: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+0001d620: 7365 6e61 6d65 286d 6f64 656c 2e66 696c  sename(model.fil
+0001d630: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
+0001d640: 2020 2020 2020 2020 2020 206d 6170 6e61             mapna
+0001d650: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
+0001d660: 656e 616d 6528 6d61 706e 616d 6529 0a20  ename(mapname). 
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d680: 2020 2070 7265 6669 7820 3d20 277b 7d5f     prefix = '{}_
+0001d690: 7b7d 272e 666f 726d 6174 286d 6f64 656c  {}'.format(model
+0001d6a0: 6e61 6d65 2c20 6d61 706e 616d 6529 0a0a  name, mapname)..
+0001d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6c0: 2020 2020 7769 7468 206f 7065 6e28 7365      with open(se
+0001d6d0: 6c66 2e77 6f72 6b64 6972 202b 2063 6869  lf.workdir + chi
+0001d6e0: 6d65 7261 636d 6461 7373 656d 626c 652c  meracmdassemble,
+0001d6f0: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
+0001d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d710: 2020 2020 662e 7772 6974 6528 0a20 2020      f.write(.   
+0001d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d730: 2020 2020 2020 2020 2023 2043 6869 6d65           # Chime
+0001d740: 7261 5820 7665 7273 696f 6e0a 2020 2020  raX version.    
+0001d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d760: 2020 2020 2020 2020 226f 7065 6e20 2220          "open " 
+0001d770: 2b20 7374 7228 6d61 706e 616d 6529 202b  + str(mapname) +
+0001d780: 2022 2066 6f72 6d61 7420 6363 7034 2220   " format ccp4" 
+0001d790: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
 0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7b0: 2022 7368 6f77 2073 656c 4174 6f6d 7320   "show selAtoms 
-0001d7c0: 7269 6262 6f6e 7322 202b 2027 5c6e 270a  ribbons" + '\n'.
-0001d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7e0: 2020 2020 2020 2020 2020 2020 2263 6f6c              "col
-0001d7f0: 6f72 2023 3220 2330 3033 4246 4622 202b  or #2 #003BFF" +
-0001d800: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d820: 2020 2276 6f6c 756d 6520 2331 2073 7479    "volume #1 sty
-0001d830: 6c65 2073 7572 6661 6365 2065 7870 616e  le surface expan
-0001d840: 6453 696e 676c 6550 6c61 6e65 2054 7275  dSinglePlane Tru
-0001d850: 6522 202b 2027 5c6e 270a 2020 2020 2020  e" + '\n'.      
+0001d7b0: 2020 2022 6f70 656e 2022 202b 2073 7472     "open " + str
+0001d7c0: 286d 6f64 656c 2e66 696c 656e 616d 6529  (model.filename)
+0001d7d0: 202b 2022 2066 6f72 6d61 7420 6d6d 6369   + " format mmci
+0001d7e0: 6622 202b 2027 5c6e 270a 2020 2020 2020  f" + '\n'.      
+0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d800: 2020 2020 2020 2268 6964 6520 7365 6c41        "hide selA
+0001d810: 746f 6d73 2220 2b20 275c 6e27 0a20 2020  toms" + '\n'.   
+0001d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d830: 2020 2020 2020 2020 2022 7368 6f77 2073           "show s
+0001d840: 656c 4174 6f6d 7320 7269 6262 6f6e 7322  elAtoms ribbons"
+0001d850: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
 0001d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d870: 2020 2020 2020 2276 6f6c 756d 6520 2331        "volume #1
-0001d880: 2063 6f6c 6f72 2023 4238 3836 3042 2073   color #B8860B s
-0001d890: 7465 7020 3120 2220 2b20 636f 6e74 6f75  tep 1 " + contou
-0001d8a0: 7220 2b20 275c 6e27 0a20 2020 2020 2020  r + '\n'.       
-0001d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8c0: 2020 2020 2022 766f 6c75 6d65 2023 3120       "volume #1 
-0001d8d0: 7472 616e 7370 6172 656e 6379 2030 2e36  transparency 0.6
-0001d8e0: 3522 202b 2027 5c6e 2720 2023 206d 616b  5" + '\n'  # mak
-0001d8f0: 6520 7468 6520 7375 7266 6163 6520 6120  e the surface a 
-0001d900: 6c69 7474 6c65 2062 6974 2073 6565 2d74  little bit see-t
-0001d910: 6872 6f75 6768 0a20 2020 2020 2020 2020  hrough.         
-0001d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d930: 2020 2022 7379 6d20 2332 2061 7373 656d     "sym #2 assem
-0001d940: 626c 7920 315c 6e22 0a20 2020 2020 2020  bly 1\n".       
-0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d960: 2020 2020 2022 7365 7420 6267 436f 6c6f       "set bgColo
-0001d970: 7220 6c69 6768 7420 6772 6179 2220 2b20  r light gray" + 
-0001d980: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-0001d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9a0: 2022 7669 6577 2063 6f66 7220 5472 7565   "view cofr True
-0001d9b0: 205c 6e22 0a20 2020 2020 2020 2020 2020   \n".           
-0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9d0: 2022 7361 7665 2022 202b 2073 7472 2870   "save " + str(p
-0001d9e0: 7265 6669 7829 202b 2022 5f61 7373 656d  refix) + "_assem
-0001d9f0: 626c 655f 7a73 7572 6661 6365 2e6a 7065  ble_zsurface.jpe
-0001da00: 6722 202b 2022 2073 7570 6572 7361 6d70  g" + " supersamp
-0001da10: 6c65 2033 2077 6964 7468 2031 3230 3020  le 3 width 1200 
-0001da20: 6865 6967 6874 2031 3230 3022 202b 2027  height 1200" + '
-0001da30: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001d870: 2020 2020 2263 6f6c 6f72 2023 3220 2330      "color #2 #0
+0001d880: 3033 4246 4622 202b 2027 5c6e 270a 2020  03BFF" + '\n'.  
+0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8a0: 2020 2020 2020 2020 2020 2276 6f6c 756d            "volum
+0001d8b0: 6520 2331 2073 7479 6c65 2073 7572 6661  e #1 style surfa
+0001d8c0: 6365 2065 7870 616e 6453 696e 676c 6550  ce expandSingleP
+0001d8d0: 6c61 6e65 2054 7275 6522 202b 2027 5c6e  lane True" + '\n
+0001d8e0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001d8f0: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+0001d900: 6f6c 756d 6520 2331 2063 6f6c 6f72 2023  olume #1 color #
+0001d910: 4238 3836 3042 2073 7465 7020 3120 2220  B8860B step 1 " 
+0001d920: 2b20 636f 6e74 6f75 7220 2b20 275c 6e27  + contour + '\n'
+0001d930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d940: 2020 2020 2020 2020 2020 2020 2022 766f               "vo
+0001d950: 6c75 6d65 2023 3120 7472 616e 7370 6172  lume #1 transpar
+0001d960: 656e 6379 2030 2e36 3522 202b 2027 5c6e  ency 0.65" + '\n
+0001d970: 2720 2023 206d 616b 6520 7468 6520 7375  '  # make the su
+0001d980: 7266 6163 6520 6120 6c69 7474 6c65 2062  rface a little b
+0001d990: 6974 2073 6565 2d74 6872 6f75 6768 0a20  it see-through. 
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2020 2020 2020 2020 2020 2022 7379 6d20             "sym 
+0001d9c0: 2332 2061 7373 656d 626c 7920 315c 6e22  #2 assembly 1\n"
+0001d9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d9e0: 2020 2020 2020 2020 2020 2020 2022 7365               "se
+0001d9f0: 7420 6267 436f 6c6f 7220 6c69 6768 7420  t bgColor light 
+0001da00: 6772 6179 2220 2b20 275c 6e27 0a20 2020  gray" + '\n'.   
+0001da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da20: 2020 2020 2020 2020 2022 7669 6577 2063           "view c
+0001da30: 6f66 7220 5472 7565 205c 6e22 0a20 2020  ofr True \n".   
 0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da50: 2274 7572 6e20 7820 2d39 3022 202b 2027  "turn x -90" + '
-0001da60: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da80: 2274 7572 6e20 7920 2d39 3022 202b 2027  "turn y -90" + '
-0001da90: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dab0: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
-0001dac0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dae0: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
-0001daf0: 7228 7072 6566 6978 2920 2b20 225f 6173  r(prefix) + "_as
-0001db00: 7365 6d62 6c65 5f78 7375 7266 6163 652e  semble_xsurface.
-0001db10: 6a70 6567 2220 2b20 2220 7375 7065 7273  jpeg" + " supers
-0001db20: 616d 706c 6520 3320 7769 6474 6820 3132  ample 3 width 12
-0001db30: 3030 2068 6569 6768 7420 3132 3030 2220  00 height 1200" 
-0001db40: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0001da50: 2020 2020 2020 2020 2022 7361 7665 2022           "save "
+0001da60: 202b 2073 7472 2870 7265 6669 7829 202b   + str(prefix) +
+0001da70: 2022 5f61 7373 656d 626c 655f 7a73 7572   "_assemble_zsur
+0001da80: 6661 6365 2e6a 7065 6722 202b 2022 2073  face.jpeg" + " s
+0001da90: 7570 6572 7361 6d70 6c65 2033 2077 6964  upersample 3 wid
+0001daa0: 7468 2031 3230 3020 6865 6967 6874 2031  th 1200 height 1
+0001dab0: 3230 3022 202b 2027 5c6e 270a 2020 2020  200" + '\n'.    
+0001dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dad0: 2020 2020 2020 2020 2274 7572 6e20 7820          "turn x 
+0001dae0: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
+0001daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db00: 2020 2020 2020 2020 2274 7572 6e20 7920          "turn y 
+0001db10: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
+0001db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db30: 2020 2020 2020 2020 2276 6965 7720 636f          "view co
+0001db40: 6672 2054 7275 6522 202b 2027 5c6e 270a  fr True" + '\n'.
 0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db60: 2020 2022 7669 6577 206f 7269 656e 7422     "view orient"
-0001db70: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0001db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db90: 2020 2020 2274 7572 6e20 7820 3930 2220      "turn x 90" 
-0001dba0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbc0: 2020 2022 7475 726e 207a 2039 3022 202b     "turn z 90" +
-0001dbd0: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbf0: 2020 2276 6965 7720 636f 6672 2054 7275    "view cofr Tru
-0001dc00: 6522 202b 2027 5c6e 270a 2020 2020 2020  e" + '\n'.      
-0001dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc20: 2020 2020 2020 2273 6176 6520 2220 2b20        "save " + 
-0001dc30: 7374 7228 7072 6566 6978 2920 2b20 225f  str(prefix) + "_
-0001dc40: 6173 7365 6d62 6c65 5f79 7375 7266 6163  assemble_ysurfac
-0001dc50: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
-0001dc60: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
-0001dc70: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
-0001dc80: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
-0001dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dca0: 2020 2020 2022 636c 6f73 6520 616c 6c22       "close all"
-0001dcb0: 202b 2022 5c6e 220a 2020 2020 2020 2020   + "\n".        
-0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcd0: 2020 2020 2265 7869 7422 202b 2027 5c6e      "exit" + '\n
-0001dce0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001dcf0: 2020 2020 2020 2020 2020 290a 0a0a 2020            )...  
-0001dd00: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0001dd10: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0001dd20: 2020 2020 2020 2069 6620 6e6f 7420 6269         if not bi
-0001dd30: 6e64 6973 706c 6179 3a0a 2020 2020 2020  ndisplay:.      
+0001db60: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
+0001db70: 6520 2220 2b20 7374 7228 7072 6566 6978  e " + str(prefix
+0001db80: 2920 2b20 225f 6173 7365 6d62 6c65 5f78  ) + "_assemble_x
+0001db90: 7375 7266 6163 652e 6a70 6567 2220 2b20  surface.jpeg" + 
+0001dba0: 2220 7375 7065 7273 616d 706c 6520 3320  " supersample 3 
+0001dbb0: 7769 6474 6820 3132 3030 2068 6569 6768  width 1200 heigh
+0001dbc0: 7420 3132 3030 2220 2b20 275c 6e27 0a20  t 1200" + '\n'. 
+0001dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbe0: 2020 2020 2020 2020 2020 2022 7669 6577             "view
+0001dbf0: 206f 7269 656e 7422 202b 2027 5c6e 270a   orient" + '\n'.
+0001dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc10: 2020 2020 2020 2020 2020 2020 2274 7572              "tur
+0001dc20: 6e20 7820 3930 2220 2b20 275c 6e27 0a20  n x 90" + '\n'. 
+0001dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc40: 2020 2020 2020 2020 2020 2022 7475 726e             "turn
+0001dc50: 207a 2039 3022 202b 2027 5c6e 270a 2020   z 90" + '\n'.  
+0001dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc70: 2020 2020 2020 2020 2020 2276 6965 7720            "view 
+0001dc80: 636f 6672 2054 7275 6522 202b 2027 5c6e  cofr True" + '\n
+0001dc90: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001dca0: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+0001dcb0: 6176 6520 2220 2b20 7374 7228 7072 6566  ave " + str(pref
+0001dcc0: 6978 2920 2b20 225f 6173 7365 6d62 6c65  ix) + "_assemble
+0001dcd0: 5f79 7375 7266 6163 652e 6a70 6567 2220  _ysurface.jpeg" 
+0001dce0: 2b20 2220 7375 7065 7273 616d 706c 6520  + " supersample 
+0001dcf0: 3320 7769 6474 6820 3132 3030 2068 6569  3 width 1200 hei
+0001dd00: 6768 7420 3132 3030 2220 2b20 275c 6e27  ght 1200" + '\n'
+0001dd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dd20: 2020 2020 2020 2020 2020 2020 2022 636c               "cl
+0001dd30: 6f73 6520 616c 6c22 202b 2022 5c6e 220a  ose all" + "\n".
 0001dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd50: 2020 7375 6270 726f 6365 7373 2e63 6865    subprocess.che
-0001dd60: 636b 5f63 616c 6c28 6c6f 6343 4849 4d45  ck_call(locCHIME
-0001dd70: 5241 202b 2022 202d 2d6f 6666 7363 7265  RA + " --offscre
-0001dd80: 656e 202d 2d6e 6f67 7569 2022 202b 2073  en --nogui " + s
-0001dd90: 656c 662e 776f 726b 6469 7220 2b20 6368  elf.workdir + ch
-0001dda0: 696d 6572 6163 6d64 2c0a 2020 2020 2020  imeracmd,.      
-0001ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddd0: 2020 2020 2020 2020 6377 643d 7365 6c66          cwd=self
-0001dde0: 2e77 6f72 6b64 6972 2c20 7368 656c 6c3d  .workdir, shell=
-0001ddf0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0001de00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001de10: 2061 7373 656d 626c 653a 0a20 2020 2020   assemble:.     
-0001de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de30: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
-0001de40: 732e 6368 6563 6b5f 6361 6c6c 286c 6f63  s.check_call(loc
-0001de50: 4348 494d 4552 4120 2b20 2220 2d2d 6f66  CHIMERA + " --of
-0001de60: 6673 6372 6565 6e20 2d2d 6e6f 6775 6920  fscreen --nogui 
-0001de70: 2220 2b20 7365 6c66 2e77 6f72 6b64 6972  " + self.workdir
-0001de80: 202b 2063 6869 6d65 7261 636d 6461 7373   + chimeracmdass
-0001de90: 656d 626c 652c 0a20 2020 2020 2020 2020  emble,.         
-0001dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dec0: 2020 2020 2020 2020 2063 7764 3d73 656c           cwd=sel
-0001ded0: 662e 776f 726b 6469 722c 2073 6865 6c6c  f.workdir, shell
-0001dee0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-0001def0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001df00: 656e 6420 3d20 7469 6d65 6974 2e64 6566  end = timeit.def
-0001df10: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
+0001dd50: 2020 2020 2020 2020 2020 2020 2265 7869              "exi
+0001dd60: 7422 202b 2027 5c6e 270a 2020 2020 2020  t" + '\n'.      
+0001dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd80: 2020 290a 0a0a 2020 2020 2020 2020 2020    )...          
+0001dd90: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001dda0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ddb0: 6620 6e6f 7420 6269 6e64 6973 706c 6179  f not bindisplay
+0001ddc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ddd0: 2020 2020 2020 2020 2020 7375 6270 726f            subpro
+0001dde0: 6365 7373 2e63 6865 636b 5f63 616c 6c28  cess.check_call(
+0001ddf0: 6c6f 6343 4849 4d45 5241 202b 2022 202d  locCHIMERA + " -
+0001de00: 2d6f 6666 7363 7265 656e 202d 2d6e 6f67  -offscreen --nog
+0001de10: 7569 2022 202b 2073 656c 662e 776f 726b  ui " + self.work
+0001de20: 6469 7220 2b20 6368 696d 6572 6163 6d64  dir + chimeracmd
+0001de30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de60: 6377 643d 7365 6c66 2e77 6f72 6b64 6972  cwd=self.workdir
+0001de70: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
+0001de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de90: 2020 2020 2020 6966 2061 7373 656d 626c        if assembl
+0001dea0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001deb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001dec0: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
+0001ded0: 6361 6c6c 286c 6f63 4348 494d 4552 4120  call(locCHIMERA 
+0001dee0: 2b20 2220 2d2d 6f66 6673 6372 6565 6e20  + " --offscreen 
+0001def0: 2d2d 6e6f 6775 6920 2220 2b20 7365 6c66  --nogui " + self
+0001df00: 2e77 6f72 6b64 6972 202b 2063 6869 6d65  .workdir + chime
+0001df10: 7261 636d 6461 7373 656d 626c 652c 0a20  racmdassemble,. 
 0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df30: 2020 2020 2070 7269 6e74 2827 5072 696d       print('Prim
-0001df40: 6172 7920 6d61 7020 616e 6420 6d6f 6465  ary map and mode
-0001df50: 6c20 7669 6577 2074 696d 653a 2025 7327  l view time: %s'
-0001df60: 2025 2028 6e65 6e64 202d 206e 7374 6172   % (nend - nstar
-0001df70: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-0001df80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001df90: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
-0001dfa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001dfb0: 2d2d 2d2d 2d2d 2d27 290a 2020 2020 2020  -------').      
-0001dfc0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001dfd0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001dfe0: 2020 2020 2020 2020 2020 2020 7375 6270              subp
-0001dff0: 726f 6365 7373 2e63 6865 636b 5f63 616c  rocess.check_cal
-0001e000: 6c28 6c6f 6343 4849 4d45 5241 202b 2022  l(locCHIMERA + "
-0001e010: 2022 202b 2073 656c 662e 776f 726b 6469   " + self.workdi
-0001e020: 7220 2b20 6368 696d 6572 6163 6d64 2c20  r + chimeracmd, 
-0001e030: 6377 643d 7365 6c66 2e77 6f72 6b64 6972  cwd=self.workdir
-0001e040: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e060: 2020 2020 2020 6966 2061 7373 656d 626c        if assembl
-0001e070: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001e080: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001e090: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
-0001e0a0: 6361 6c6c 286c 6f63 4348 494d 4552 4120  call(locCHIMERA 
-0001e0b0: 2b20 2220 2220 2b20 7365 6c66 2e77 6f72  + " " + self.wor
-0001e0c0: 6b64 6972 202b 2063 6869 6d65 7261 636d  kdir + chimeracm
-0001e0d0: 6461 7373 656d 626c 652c 0a20 2020 2020  dassemble,.     
-0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e100: 2020 2020 2020 2020 2020 2020 2063 7764               cwd
-0001e110: 3d73 656c 662e 776f 726b 6469 722c 2073  =self.workdir, s
-0001e120: 6865 6c6c 3d54 7275 6529 0a20 2020 2020  hell=True).     
-0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e140: 2020 206e 656e 6420 3d20 7469 6d65 6974     nend = timeit
-0001e150: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
-0001e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e170: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0001e180: 5072 696d 6172 7920 6d61 7020 616e 6420  Primary map and 
-0001e190: 6d6f 6465 6c20 7669 6577 2074 696d 653a  model view time:
-0001e1a0: 2025 7327 2025 2028 6e65 6e64 202d 206e   %s' % (nend - n
-0001e1b0: 7374 6172 7429 290a 2020 2020 2020 2020  start)).        
-0001e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1d0: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
-0001e1e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001e1f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a 0a20  -----------').. 
-0001e200: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e210: 7863 6570 7420 7375 6270 726f 6365 7373  xcept subprocess
-0001e220: 2e43 616c 6c65 6450 726f 6365 7373 4572  .CalledProcessEr
-0001e230: 726f 7220 6173 2073 7562 6572 723a 0a20  ror as suberr:. 
+0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df50: 2063 7764 3d73 656c 662e 776f 726b 6469   cwd=self.workdi
+0001df60: 722c 2073 6865 6c6c 3d54 7275 6529 0a20  r, shell=True). 
+0001df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df80: 2020 2020 2020 206e 656e 6420 3d20 7469         nend = ti
+0001df90: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
+0001dfa0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+0001dfb0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0001dfc0: 6e74 2827 5072 696d 6172 7920 6d61 7020  nt('Primary map 
+0001dfd0: 616e 6420 6d6f 6465 6c20 7669 6577 2074  and model view t
+0001dfe0: 696d 653a 2025 7327 2025 2028 6e65 6e64  ime: %s' % (nend
+0001dff0: 202d 206e 7374 6172 7429 290a 2020 2020   - nstart)).    
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+0001e020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001e030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+0001e040: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e050: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e070: 2020 2020 7375 6270 726f 6365 7373 2e63      subprocess.c
+0001e080: 6865 636b 5f63 616c 6c28 6c6f 6343 4849  heck_call(locCHI
+0001e090: 4d45 5241 202b 2022 2022 202b 2073 656c  MERA + " " + sel
+0001e0a0: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
+0001e0b0: 6572 6163 6d64 2c20 6377 643d 7365 6c66  eracmd, cwd=self
+0001e0c0: 2e77 6f72 6b64 6972 2c20 7368 656c 6c3d  .workdir, shell=
+0001e0d0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0001e0e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001e0f0: 2061 7373 656d 626c 653a 0a20 2020 2020   assemble:.     
+0001e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e110: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
+0001e120: 732e 6368 6563 6b5f 6361 6c6c 286c 6f63  s.check_call(loc
+0001e130: 4348 494d 4552 4120 2b20 2220 2220 2b20  CHIMERA + " " + 
+0001e140: 7365 6c66 2e77 6f72 6b64 6972 202b 2063  self.workdir + c
+0001e150: 6869 6d65 7261 636d 6461 7373 656d 626c  himeracmdassembl
+0001e160: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e190: 2020 2020 2063 7764 3d73 656c 662e 776f       cwd=self.wo
+0001e1a0: 726b 6469 722c 2073 6865 6c6c 3d54 7275  rkdir, shell=Tru
+0001e1b0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001e1c0: 2020 2020 2020 2020 2020 206e 656e 6420             nend 
+0001e1d0: 3d20 7469 6d65 6974 2e64 6566 6175 6c74  = timeit.default
+0001e1e0: 5f74 696d 6572 2829 0a20 2020 2020 2020  _timer().       
+0001e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e200: 2070 7269 6e74 2827 5072 696d 6172 7920   print('Primary 
+0001e210: 6d61 7020 616e 6420 6d6f 6465 6c20 7669  map and model vi
+0001e220: 6577 2074 696d 653a 2025 7327 2025 2028  ew time: %s' % (
+0001e230: 6e65 6e64 202d 206e 7374 6172 7429 290a  nend - nstart)).
 0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e250: 2020 2065 7272 203d 2027 5361 7669 6e67     err = 'Saving
-0001e260: 206d 6f64 656c 207b 7d20 616e 6420 6d61   model {} and ma
-0001e270: 7020 6572 723a 207b 7d27 2e66 6f72 6d61  p err: {}'.forma
-0001e280: 7428 7374 7228 6d6f 6465 6c2e 6669 6c65  t(str(model.file
-0001e290: 6e61 6d65 292c 2073 7562 6572 7229 0a20  name), suberr). 
-0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2b0: 2020 206d 6d65 7272 6c69 7374 2e61 7070     mmerrlist.app
-0001e2c0: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
-0001e2d0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0001e2e0: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
-0001e2f0: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
-0001e300: 2020 2070 7269 6e74 2827 5375 7266 6163     print('Surfac
-0001e310: 6520 7669 6577 7320 7765 7265 2067 656e  e views were gen
-0001e320: 6572 6174 6564 2062 7920 4368 696d 6572  erated by Chimer
-0001e330: 6158 2729 0a20 2020 2020 2020 2074 7279  aX').        try
-0001e340: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0001e350: 6c66 2e73 6361 6c65 5f73 7572 6661 6365  lf.scale_surface
-0001e360: 7669 6577 2829 0a20 2020 2020 2020 2065  view().        e
-0001e370: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-0001e380: 2020 2065 7272 203d 2027 5363 616c 696e     err = 'Scalin
-0001e390: 6720 7468 6520 7375 7266 6163 6520 7669  g the surface vi
-0001e3a0: 6577 7320 6572 723a 207b 7d27 2e66 6f72  ews err: {}'.for
-0001e3b0: 6d61 7428 7379 732e 6578 635f 696e 666f  mat(sys.exc_info
-0001e3c0: 2829 5b31 5d29 0a20 2020 2020 2020 2020  ()[1]).         
-0001e3d0: 2020 2065 7272 6c69 7374 2e61 7070 656e     errlist.appen
-0001e3e0: 6428 6572 7229 0a20 2020 2020 2020 2020  d(err).         
-0001e3f0: 2020 206d 6d65 7272 6c69 7374 2e61 7070     mmerrlist.app
-0001e400: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
-0001e410: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-0001e420: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
-0001e430: 290a 0a20 2020 2020 2020 2073 7572 6661  )..        surfa
-0001e440: 6365 7669 6577 6a73 6f6e 203d 2064 6963  ceviewjson = dic
-0001e450: 7428 290a 2020 2020 2020 2020 6f75 746d  t().        outm
-0001e460: 6170 7869 6d61 6765 203d 2073 7472 2873  apximage = str(s
-0001e470: 656c 662e 6d61 706e 616d 6529 202b 2027  elf.mapname) + '
-0001e480: 5f78 7375 7266 6163 652e 6a70 6567 270a  _xsurface.jpeg'.
-0001e490: 2020 2020 2020 2020 6d61 7078 6c69 7374          mapxlist
-0001e4a0: 203d 206f 7574 6d61 7078 696d 6167 652e   = outmapximage.
-0001e4b0: 7370 6c69 7428 275f 2729 0a20 2020 2020  split('_').     
-0001e4c0: 2020 206d 6170 7873 6361 6c65 696d 6167     mapxscaleimag
-0001e4d0: 6520 3d20 275f 272e 6a6f 696e 286d 6170  e = '_'.join(map
-0001e4e0: 786c 6973 745b 3a2d 315d 2920 2b20 275f  xlist[:-1]) + '_
-0001e4f0: 7363 616c 6564 5f27 202b 206d 6170 786c  scaled_' + mapxl
-0001e500: 6973 745b 2d31 5d0a 2020 2020 2020 2020  ist[-1].        
-0001e510: 7375 7266 6163 6576 6965 776a 736f 6e5b  surfaceviewjson[
-0001e520: 2778 275d 203d 206f 732e 7061 7468 2e62  'x'] = os.path.b
-0001e530: 6173 656e 616d 6528 6d61 7078 7363 616c  asename(mapxscal
-0001e540: 6569 6d61 6765 2920 6966 206f 732e 7061  eimage) if os.pa
-0001e550: 7468 2e69 7366 696c 6528 7365 6c66 2e77  th.isfile(self.w
-0001e560: 6f72 6b64 6972 202b 206d 6170 7873 6361  orkdir + mapxsca
-0001e570: 6c65 696d 6167 6529 2065 6c73 6520 4e6f  leimage) else No
-0001e580: 6e65 0a0a 2020 2020 2020 2020 6f75 746d  ne..        outm
-0001e590: 6170 7969 6d61 6765 203d 2073 7472 2873  apyimage = str(s
-0001e5a0: 656c 662e 6d61 706e 616d 6529 202b 2027  elf.mapname) + '
-0001e5b0: 5f79 7375 7266 6163 652e 6a70 6567 270a  _ysurface.jpeg'.
-0001e5c0: 2020 2020 2020 2020 6d61 7079 6c69 7374          mapylist
-0001e5d0: 203d 206f 7574 6d61 7079 696d 6167 652e   = outmapyimage.
-0001e5e0: 7370 6c69 7428 275f 2729 0a20 2020 2020  split('_').     
-0001e5f0: 2020 206d 6170 7973 6361 6c65 696d 6167     mapyscaleimag
-0001e600: 6520 3d20 275f 272e 6a6f 696e 286d 6170  e = '_'.join(map
-0001e610: 796c 6973 745b 3a2d 315d 2920 2b20 275f  ylist[:-1]) + '_
-0001e620: 7363 616c 6564 5f27 202b 206d 6170 796c  scaled_' + mapyl
-0001e630: 6973 745b 2d31 5d0a 2020 2020 2020 2020  ist[-1].        
-0001e640: 7375 7266 6163 6576 6965 776a 736f 6e5b  surfaceviewjson[
-0001e650: 2779 275d 203d 206f 732e 7061 7468 2e62  'y'] = os.path.b
-0001e660: 6173 656e 616d 6528 6d61 7079 7363 616c  asename(mapyscal
-0001e670: 6569 6d61 6765 2920 6966 206f 732e 7061  eimage) if os.pa
-0001e680: 7468 2e69 7366 696c 6528 7365 6c66 2e77  th.isfile(self.w
-0001e690: 6f72 6b64 6972 202b 206d 6170 7973 6361  orkdir + mapysca
-0001e6a0: 6c65 696d 6167 6529 2065 6c73 6520 4e6f  leimage) else No
-0001e6b0: 6e65 0a0a 2020 2020 2020 2020 6f75 746d  ne..        outm
-0001e6c0: 6170 7a69 6d61 6765 203d 2073 7472 2873  apzimage = str(s
-0001e6d0: 656c 662e 6d61 706e 616d 6529 202b 2027  elf.mapname) + '
-0001e6e0: 5f7a 7375 7266 6163 652e 6a70 6567 270a  _zsurface.jpeg'.
-0001e6f0: 2020 2020 2020 2020 6d61 707a 6c69 7374          mapzlist
-0001e700: 203d 206f 7574 6d61 707a 696d 6167 652e   = outmapzimage.
-0001e710: 7370 6c69 7428 275f 2729 0a20 2020 2020  split('_').     
-0001e720: 2020 206d 6170 7a73 6361 6c65 696d 6167     mapzscaleimag
-0001e730: 6520 3d20 275f 272e 6a6f 696e 286d 6170  e = '_'.join(map
-0001e740: 7a6c 6973 745b 3a2d 315d 2920 2b20 275f  zlist[:-1]) + '_
-0001e750: 7363 616c 6564 5f27 202b 206d 6170 7a6c  scaled_' + mapzl
-0001e760: 6973 745b 2d31 5d0a 2020 2020 2020 2020  ist[-1].        
-0001e770: 7375 7266 6163 6576 6965 776a 736f 6e5b  surfaceviewjson[
-0001e780: 277a 275d 203d 206f 732e 7061 7468 2e62  'z'] = os.path.b
-0001e790: 6173 656e 616d 6528 6d61 707a 7363 616c  asename(mapzscal
-0001e7a0: 6569 6d61 6765 2920 6966 206f 732e 7061  eimage) if os.pa
-0001e7b0: 7468 2e69 7366 696c 6528 7365 6c66 2e77  th.isfile(self.w
-0001e7c0: 6f72 6b64 6972 202b 206d 6170 7a73 6361  orkdir + mapzsca
-0001e7d0: 6c65 696d 6167 6529 2065 6c73 6520 4e6f  leimage) else No
-0001e7e0: 6e65 0a20 2020 2020 2020 2069 6620 6572  ne.        if er
-0001e7f0: 726c 6973 743a 0a20 2020 2020 2020 2020  rlist:.         
-0001e800: 2020 2073 7572 6661 6365 7669 6577 6a73     surfaceviewjs
-0001e810: 6f6e 5b27 6572 7227 5d20 3d20 7b27 6d61  on['err'] = {'ma
-0001e820: 705f 7375 7266 6163 655f 6572 7227 3a20  p_surface_err': 
-0001e830: 6572 726c 6973 747d 0a0a 2020 2020 2020  errlist}..      
-0001e840: 2020 6669 6e61 6c64 6963 7420 3d20 7b27    finaldict = {'
-0001e850: 6d61 705f 7375 7266 6163 6527 3a20 7375  map_surface': su
-0001e860: 7266 6163 6576 6965 776a 736f 6e7d 0a0a  rfaceviewjson}..
-0001e870: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001e880: 2020 2020 2020 2020 2077 6974 6820 636f           with co
-0001e890: 6465 6373 2e6f 7065 6e28 7365 6c66 2e77  decs.open(self.w
-0001e8a0: 6f72 6b64 6972 202b 2073 656c 662e 6d61  orkdir + self.ma
-0001e8b0: 706e 616d 6520 2b20 275f 6d61 7073 7572  pname + '_mapsur
-0001e8c0: 6661 6365 7669 6577 2e6a 736f 6e27 2c20  faceview.json', 
-0001e8d0: 2777 272c 0a20 2020 2020 2020 2020 2020  'w',.           
-0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8f0: 2020 656e 636f 6469 6e67 3d27 7574 662d    encoding='utf-
-0001e900: 3827 2920 6173 2066 3a0a 2020 2020 2020  8') as f:.      
-0001e910: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
-0001e920: 756d 7028 6669 6e61 6c64 6963 742c 2066  ump(finaldict, f
-0001e930: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0001e940: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-0001e950: 7220 3d20 2753 6176 696e 6720 6d61 7020  r = 'Saving map 
-0001e960: 7375 7266 6163 6520 7669 6577 206a 736f  surface view jso
-0001e970: 6e20 6572 726f 723a 207b 7d2e 272e 666f  n error: {}.'.fo
-0001e980: 726d 6174 2873 7973 2e65 7863 5f69 6e66  rmat(sys.exc_inf
-0001e990: 6f28 295b 315d 290a 2020 2020 2020 2020  o()[1]).        
-0001e9a0: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-0001e9b0: 7269 7465 2865 7272 202b 2027 5c6e 2729  rite(err + '\n')
-0001e9c0: 0a0a 2020 2020 2020 2020 6a70 6567 7320  ..        jpegs 
-0001e9d0: 3d20 676c 6f62 2e67 6c6f 6228 7365 6c66  = glob.glob(self
-0001e9e0: 2e77 6f72 6b64 6972 202b 2027 2f2a 7375  .workdir + '/*su
-0001e9f0: 7266 6163 652e 6a70 6567 2729 0a20 2020  rface.jpeg').   
-0001ea00: 2020 2020 206d 6f64 656c 7375 7266 203d       modelsurf =
-0001ea10: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-0001ea20: 6669 6e61 6c6d 6d64 6963 7420 3d20 6469  finalmmdict = di
-0001ea30: 6374 2829 0a20 2020 2020 2020 2069 6620  ct().        if 
-0001ea40: 7365 6c66 2e6d 6f64 656c 733a 0a20 2020  self.models:.   
-0001ea50: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
-0001ea60: 2022 7365 6c66 2e6d 6f64 656c 733a 2573   "self.models:%s
-0001ea70: 2220 2520 7365 6c66 2e6d 6f64 656c 730a  " % self.models.
-0001ea80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001ea90: 6d6f 6465 6c20 696e 2073 656c 662e 6d6f  model in self.mo
-0001eaa0: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
-0001eab0: 2020 2020 2020 6d6f 6465 6c6e 616d 6520        modelname 
-0001eac0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-0001ead0: 6d65 286d 6f64 656c 2e66 696c 656e 616d  me(model.filenam
-0001eae0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001eaf0: 2020 2073 7572 6661 6365 666e 203d 2027     surfacefn = '
-0001eb00: 7b7d 5f7b 7d27 2e66 6f72 6d61 7428 6d6f  {}_{}'.format(mo
-0001eb10: 6465 6c6e 616d 652c 2073 656c 662e 6d61  delname, self.ma
-0001eb20: 706e 616d 6529 0a20 2020 2020 2020 2020  pname).         
-0001eb30: 2020 2020 2020 206d 6f64 656c 6d61 7073         modelmaps
-0001eb40: 7572 6661 6365 203d 2064 6963 7428 290a  urface = dict().
-0001eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb60: 666f 7220 6a70 6567 2069 6e20 6a70 6567  for jpeg in jpeg
-0001eb70: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001eb80: 2020 2020 2020 2069 6620 6d6f 6465 6c6e         if modeln
-0001eb90: 616d 6520 696e 206a 7065 6720 616e 6420  ame in jpeg and 
-0001eba0: 2778 7375 7266 6163 6527 2069 6e20 6a70  'xsurface' in jp
-0001ebb0: 6567 3a0a 2020 2020 2020 2020 2020 2020  eg:.            
-0001ebc0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0001ebd0: 6c6d 6170 7375 7266 6163 655b 2778 275d  lmapsurface['x']
-0001ebe0: 203d 2073 7472 2873 7572 6661 6365 666e   = str(surfacefn
-0001ebf0: 2920 2b20 275f 7363 616c 6564 5f78 7375  ) + '_scaled_xsu
-0001ec00: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
-0001ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec20: 6966 206d 6f64 656c 6e61 6d65 2069 6e20  if modelname in 
-0001ec30: 6a70 6567 2061 6e64 2027 7973 7572 6661  jpeg and 'ysurfa
-0001ec40: 6365 2720 696e 206a 7065 673a 0a20 2020  ce' in jpeg:.   
-0001ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec60: 2020 2020 206d 6f64 656c 6d61 7073 7572       modelmapsur
-0001ec70: 6661 6365 5b27 7927 5d20 3d20 7374 7228  face['y'] = str(
-0001ec80: 7375 7266 6163 6566 6e29 202b 2027 5f73  surfacefn) + '_s
-0001ec90: 6361 6c65 645f 7973 7572 6661 6365 2e6a  caled_ysurface.j
-0001eca0: 7065 6727 0a20 2020 2020 2020 2020 2020  peg'.           
-0001ecb0: 2020 2020 2020 2020 2069 6620 6d6f 6465           if mode
-0001ecc0: 6c6e 616d 6520 696e 206a 7065 6720 616e  lname in jpeg an
-0001ecd0: 6420 277a 7375 7266 6163 6527 2069 6e20  d 'zsurface' in 
-0001ece0: 6a70 6567 3a0a 2020 2020 2020 2020 2020  jpeg:.          
-0001ecf0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0001ed00: 6465 6c6d 6170 7375 7266 6163 655b 277a  delmapsurface['z
-0001ed10: 275d 203d 2073 7472 2873 7572 6661 6365  '] = str(surface
-0001ed20: 666e 2920 2b20 275f 7363 616c 6564 5f7a  fn) + '_scaled_z
-0001ed30: 7375 7266 6163 652e 6a70 6567 270a 0a20  surface.jpeg'.. 
-0001ed40: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001ed50: 6974 6820 6f70 656e 2873 7472 286d 6f64  ith open(str(mod
-0001ed60: 656c 2e66 696c 656e 616d 6529 2920 6173  el.filename)) as
-0001ed70: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-0001ed80: 2020 2020 2020 2020 7320 3d20 6d6d 6170          s = mmap
-0001ed90: 2e6d 6d61 7028 662e 6669 6c65 6e6f 2829  .mmap(f.fileno()
-0001eda0: 2c20 302c 2061 6363 6573 733d 6d6d 6170  , 0, access=mmap
-0001edb0: 2e41 4343 4553 535f 5245 4144 290a 2020  .ACCESS_READ).  
-0001edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001edd0: 2020 2320 7079 7468 6f6e 2033 206d 6d61    # python 3 mma
-0001ede0: 702e 6d6d 6170 2866 696c 652e 6669 6c65  p.mmap(file.file
-0001edf0: 6e6f 2829 2c20 302c 2061 6363 6573 733d  no(), 0, access=
-0001ee00: 6d6d 6170 2e41 4343 4553 535f 5245 4144  mmap.ACCESS_READ
-0001ee10: 2920 6173 2073 3a0a 2020 2020 2020 2020  ) as s:.        
-0001ee20: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001ee30: 2e66 696e 6428 6227 706f 696e 7420 7379  .find(b'point sy
-0001ee40: 6d6d 6574 7279 206f 7065 7261 7469 6f6e  mmetry operation
-0001ee50: 2729 2021 3d20 2d31 3a0a 2020 2020 2020  ') != -1:.      
-0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee70: 2020 6173 7365 6d62 6c65 203d 2054 7275    assemble = Tru
-0001ee80: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001ee90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001e250: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+0001e260: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001e270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001e280: 2d2d 2d27 290a 0a20 2020 2020 2020 2020  ---')..         
+0001e290: 2020 2020 2020 2065 7863 6570 7420 7375         except su
+0001e2a0: 6270 726f 6365 7373 2e43 616c 6c65 6450  bprocess.CalledP
+0001e2b0: 726f 6365 7373 4572 726f 7220 6173 2073  rocessError as s
+0001e2c0: 7562 6572 723a 0a20 2020 2020 2020 2020  uberr:.         
+0001e2d0: 2020 2020 2020 2020 2020 2065 7272 203d             err =
+0001e2e0: 2027 5361 7669 6e67 206d 6f64 656c 207b   'Saving model {
+0001e2f0: 7d20 616e 6420 6d61 7020 6572 723a 207b  } and map err: {
+0001e300: 7d27 2e66 6f72 6d61 7428 7374 7228 6d6f  }'.format(str(mo
+0001e310: 6465 6c2e 6669 6c65 6e61 6d65 292c 2073  del.filename), s
+0001e320: 7562 6572 7229 0a20 2020 2020 2020 2020  uberr).         
+0001e330: 2020 2020 2020 2020 2020 206d 6d65 7272             mmerr
+0001e340: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
+0001e350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e360: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+0001e370: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
+0001e380: 290a 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+0001e390: 2827 5375 7266 6163 6520 7669 6577 7320  ('Surface views 
+0001e3a0: 7765 7265 2067 656e 6572 6174 6564 2062  were generated b
+0001e3b0: 7920 4368 696d 6572 6158 2729 0a20 2020  y ChimeraX').   
+0001e3c0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001e3d0: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
+0001e3e0: 5f73 7572 6661 6365 7669 6577 2829 0a20  _surfaceview(). 
+0001e3f0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0001e400: 2020 2020 2020 2020 2020 2065 7272 203d             err =
+0001e410: 2027 5363 616c 696e 6720 7468 6520 7375   'Scaling the su
+0001e420: 7266 6163 6520 7669 6577 7320 6572 723a  rface views err:
+0001e430: 207b 7d27 2e66 6f72 6d61 7428 7379 732e   {}'.format(sys.
+0001e440: 6578 635f 696e 666f 2829 5b31 5d29 0a20  exc_info()[1]). 
+0001e450: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+0001e460: 7374 2e61 7070 656e 6428 6572 7229 0a20  st.append(err). 
+0001e470: 2020 2020 2020 2020 2020 206d 6d65 7272             mmerr
+0001e480: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
+0001e490: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+0001e4a0: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
+0001e4b0: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
+0001e4c0: 2020 2073 7572 6661 6365 7669 6577 6a73     surfaceviewjs
+0001e4d0: 6f6e 203d 2064 6963 7428 290a 2020 2020  on = dict().    
+0001e4e0: 2020 2020 6f75 746d 6170 7869 6d61 6765      outmapximage
+0001e4f0: 203d 2073 7472 2873 656c 662e 6d61 706e   = str(self.mapn
+0001e500: 616d 6529 202b 2027 5f78 7375 7266 6163  ame) + '_xsurfac
+0001e510: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
+0001e520: 6d61 7078 6c69 7374 203d 206f 7574 6d61  mapxlist = outma
+0001e530: 7078 696d 6167 652e 7370 6c69 7428 275f  pximage.split('_
+0001e540: 2729 0a20 2020 2020 2020 206d 6170 7873  ').        mapxs
+0001e550: 6361 6c65 696d 6167 6520 3d20 275f 272e  caleimage = '_'.
+0001e560: 6a6f 696e 286d 6170 786c 6973 745b 3a2d  join(mapxlist[:-
+0001e570: 315d 2920 2b20 275f 7363 616c 6564 5f27  1]) + '_scaled_'
+0001e580: 202b 206d 6170 786c 6973 745b 2d31 5d0a   + mapxlist[-1].
+0001e590: 2020 2020 2020 2020 7375 7266 6163 6576          surfacev
+0001e5a0: 6965 776a 736f 6e5b 2778 275d 203d 206f  iewjson['x'] = o
+0001e5b0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001e5c0: 6d61 7078 7363 616c 6569 6d61 6765 2920  mapxscaleimage) 
+0001e5d0: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+0001e5e0: 6528 7365 6c66 2e77 6f72 6b64 6972 202b  e(self.workdir +
+0001e5f0: 206d 6170 7873 6361 6c65 696d 6167 6529   mapxscaleimage)
+0001e600: 2065 6c73 6520 4e6f 6e65 0a0a 2020 2020   else None..    
+0001e610: 2020 2020 6f75 746d 6170 7969 6d61 6765      outmapyimage
+0001e620: 203d 2073 7472 2873 656c 662e 6d61 706e   = str(self.mapn
+0001e630: 616d 6529 202b 2027 5f79 7375 7266 6163  ame) + '_ysurfac
+0001e640: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
+0001e650: 6d61 7079 6c69 7374 203d 206f 7574 6d61  mapylist = outma
+0001e660: 7079 696d 6167 652e 7370 6c69 7428 275f  pyimage.split('_
+0001e670: 2729 0a20 2020 2020 2020 206d 6170 7973  ').        mapys
+0001e680: 6361 6c65 696d 6167 6520 3d20 275f 272e  caleimage = '_'.
+0001e690: 6a6f 696e 286d 6170 796c 6973 745b 3a2d  join(mapylist[:-
+0001e6a0: 315d 2920 2b20 275f 7363 616c 6564 5f27  1]) + '_scaled_'
+0001e6b0: 202b 206d 6170 796c 6973 745b 2d31 5d0a   + mapylist[-1].
+0001e6c0: 2020 2020 2020 2020 7375 7266 6163 6576          surfacev
+0001e6d0: 6965 776a 736f 6e5b 2779 275d 203d 206f  iewjson['y'] = o
+0001e6e0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001e6f0: 6d61 7079 7363 616c 6569 6d61 6765 2920  mapyscaleimage) 
+0001e700: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+0001e710: 6528 7365 6c66 2e77 6f72 6b64 6972 202b  e(self.workdir +
+0001e720: 206d 6170 7973 6361 6c65 696d 6167 6529   mapyscaleimage)
+0001e730: 2065 6c73 6520 4e6f 6e65 0a0a 2020 2020   else None..    
+0001e740: 2020 2020 6f75 746d 6170 7a69 6d61 6765      outmapzimage
+0001e750: 203d 2073 7472 2873 656c 662e 6d61 706e   = str(self.mapn
+0001e760: 616d 6529 202b 2027 5f7a 7375 7266 6163  ame) + '_zsurfac
+0001e770: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
+0001e780: 6d61 707a 6c69 7374 203d 206f 7574 6d61  mapzlist = outma
+0001e790: 707a 696d 6167 652e 7370 6c69 7428 275f  pzimage.split('_
+0001e7a0: 2729 0a20 2020 2020 2020 206d 6170 7a73  ').        mapzs
+0001e7b0: 6361 6c65 696d 6167 6520 3d20 275f 272e  caleimage = '_'.
+0001e7c0: 6a6f 696e 286d 6170 7a6c 6973 745b 3a2d  join(mapzlist[:-
+0001e7d0: 315d 2920 2b20 275f 7363 616c 6564 5f27  1]) + '_scaled_'
+0001e7e0: 202b 206d 6170 7a6c 6973 745b 2d31 5d0a   + mapzlist[-1].
+0001e7f0: 2020 2020 2020 2020 7375 7266 6163 6576          surfacev
+0001e800: 6965 776a 736f 6e5b 277a 275d 203d 206f  iewjson['z'] = o
+0001e810: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0001e820: 6d61 707a 7363 616c 6569 6d61 6765 2920  mapzscaleimage) 
+0001e830: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+0001e840: 6528 7365 6c66 2e77 6f72 6b64 6972 202b  e(self.workdir +
+0001e850: 206d 6170 7a73 6361 6c65 696d 6167 6529   mapzscaleimage)
+0001e860: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+0001e870: 2020 2069 6620 6572 726c 6973 743a 0a20     if errlist:. 
+0001e880: 2020 2020 2020 2020 2020 2073 7572 6661             surfa
+0001e890: 6365 7669 6577 6a73 6f6e 5b27 6572 7227  ceviewjson['err'
+0001e8a0: 5d20 3d20 7b27 6d61 705f 7375 7266 6163  ] = {'map_surfac
+0001e8b0: 655f 6572 7227 3a20 6572 726c 6973 747d  e_err': errlist}
+0001e8c0: 0a0a 2020 2020 2020 2020 6669 6e61 6c64  ..        finald
+0001e8d0: 6963 7420 3d20 7b27 6d61 705f 7375 7266  ict = {'map_surf
+0001e8e0: 6163 6527 3a20 7375 7266 6163 6576 6965  ace': surfacevie
+0001e8f0: 776a 736f 6e7d 0a0a 2020 2020 2020 2020  wjson}..        
+0001e900: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001e910: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
+0001e920: 6e28 7365 6c66 2e77 6f72 6b64 6972 202b  n(self.workdir +
+0001e930: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
+0001e940: 275f 6d61 7073 7572 6661 6365 7669 6577  '_mapsurfaceview
+0001e950: 2e6a 736f 6e27 2c20 2777 272c 0a20 2020  .json', 'w',.   
+0001e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e970: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
+0001e980: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
+0001e990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e9a0: 2020 6a73 6f6e 2e64 756d 7028 6669 6e61    json.dump(fina
+0001e9b0: 6c64 6963 742c 2066 290a 2020 2020 2020  ldict, f).      
+0001e9c0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0001e9d0: 2020 2020 2020 6572 7220 3d20 2753 6176        err = 'Sav
+0001e9e0: 696e 6720 6d61 7020 7375 7266 6163 6520  ing map surface 
+0001e9f0: 7669 6577 206a 736f 6e20 6572 726f 723a  view json error:
+0001ea00: 207b 7d2e 272e 666f 726d 6174 2873 7973   {}.'.format(sys
+0001ea10: 2e65 7863 5f69 6e66 6f28 295b 315d 290a  .exc_info()[1]).
+0001ea20: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+0001ea30: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
+0001ea40: 202b 2027 5c6e 2729 0a0a 2020 2020 2020   + '\n')..      
+0001ea50: 2020 6a70 6567 7320 3d20 676c 6f62 2e67    jpegs = glob.g
+0001ea60: 6c6f 6228 7365 6c66 2e77 6f72 6b64 6972  lob(self.workdir
+0001ea70: 202b 2027 2f2a 7375 7266 6163 652e 6a70   + '/*surface.jp
+0001ea80: 6567 2729 0a20 2020 2020 2020 206d 6f64  eg').        mod
+0001ea90: 656c 7375 7266 203d 2064 6963 7428 290a  elsurf = dict().
+0001eaa0: 2020 2020 2020 2020 6669 6e61 6c6d 6d64          finalmmd
+0001eab0: 6963 7420 3d20 6469 6374 2829 0a20 2020  ict = dict().   
+0001eac0: 2020 2020 2069 6620 7365 6c66 2e6d 6f64       if self.mod
+0001ead0: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
+0001eae0: 2023 2070 7269 6e74 2022 7365 6c66 2e6d   # print "self.m
+0001eaf0: 6f64 656c 733a 2573 2220 2520 7365 6c66  odels:%s" % self
+0001eb00: 2e6d 6f64 656c 730a 2020 2020 2020 2020  .models.        
+0001eb10: 2020 2020 666f 7220 6d6f 6465 6c20 696e      for model in
+0001eb20: 2073 656c 662e 6d6f 6465 6c73 3a0a 2020   self.models:.  
+0001eb30: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0001eb40: 6465 6c6e 616d 6520 3d20 6f73 2e70 6174  delname = os.pat
+0001eb50: 682e 6261 7365 6e61 6d65 286d 6f64 656c  h.basename(model
+0001eb60: 2e66 696c 656e 616d 6529 0a20 2020 2020  .filename).     
+0001eb70: 2020 2020 2020 2020 2020 2073 7572 6661             surfa
+0001eb80: 6365 666e 203d 2027 7b7d 5f7b 7d27 2e66  cefn = '{}_{}'.f
+0001eb90: 6f72 6d61 7428 6d6f 6465 6c6e 616d 652c  ormat(modelname,
+0001eba0: 2073 656c 662e 6d61 706e 616d 6529 0a20   self.mapname). 
+0001ebb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001ebc0: 6f64 656c 6d61 7073 7572 6661 6365 203d  odelmapsurface =
+0001ebd0: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
+0001ebe0: 2020 2020 2020 2020 666f 7220 6a70 6567          for jpeg
+0001ebf0: 2069 6e20 6a70 6567 733a 0a20 2020 2020   in jpegs:.     
+0001ec00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ec10: 6620 6d6f 6465 6c6e 616d 6520 696e 206a  f modelname in j
+0001ec20: 7065 6720 616e 6420 2778 7375 7266 6163  peg and 'xsurfac
+0001ec30: 6527 2069 6e20 6a70 6567 3a0a 2020 2020  e' in jpeg:.    
+0001ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec50: 2020 2020 6d6f 6465 6c6d 6170 7375 7266      modelmapsurf
+0001ec60: 6163 655b 2778 275d 203d 2073 7472 2873  ace['x'] = str(s
+0001ec70: 7572 6661 6365 666e 2920 2b20 275f 7363  urfacefn) + '_sc
+0001ec80: 616c 6564 5f78 7375 7266 6163 652e 6a70  aled_xsurface.jp
+0001ec90: 6567 270a 2020 2020 2020 2020 2020 2020  eg'.            
+0001eca0: 2020 2020 2020 2020 6966 206d 6f64 656c          if model
+0001ecb0: 6e61 6d65 2069 6e20 6a70 6567 2061 6e64  name in jpeg and
+0001ecc0: 2027 7973 7572 6661 6365 2720 696e 206a   'ysurface' in j
+0001ecd0: 7065 673a 0a20 2020 2020 2020 2020 2020  peg:.           
+0001ece0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0001ecf0: 656c 6d61 7073 7572 6661 6365 5b27 7927  elmapsurface['y'
+0001ed00: 5d20 3d20 7374 7228 7375 7266 6163 6566  ] = str(surfacef
+0001ed10: 6e29 202b 2027 5f73 6361 6c65 645f 7973  n) + '_scaled_ys
+0001ed20: 7572 6661 6365 2e6a 7065 6727 0a20 2020  urface.jpeg'.   
+0001ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed40: 2069 6620 6d6f 6465 6c6e 616d 6520 696e   if modelname in
+0001ed50: 206a 7065 6720 616e 6420 277a 7375 7266   jpeg and 'zsurf
+0001ed60: 6163 6527 2069 6e20 6a70 6567 3a0a 2020  ace' in jpeg:.  
+0001ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed80: 2020 2020 2020 6d6f 6465 6c6d 6170 7375        modelmapsu
+0001ed90: 7266 6163 655b 277a 275d 203d 2073 7472  rface['z'] = str
+0001eda0: 2873 7572 6661 6365 666e 2920 2b20 275f  (surfacefn) + '_
+0001edb0: 7363 616c 6564 5f7a 7375 7266 6163 652e  scaled_zsurface.
+0001edc0: 6a70 6567 270a 0a20 2020 2020 2020 2020  jpeg'..         
+0001edd0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0001ede0: 2873 7472 286d 6f64 656c 2e66 696c 656e  (str(model.filen
+0001edf0: 616d 6529 2920 6173 2066 3a0a 2020 2020  ame)) as f:.    
+0001ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee10: 7320 3d20 6d6d 6170 2e6d 6d61 7028 662e  s = mmap.mmap(f.
+0001ee20: 6669 6c65 6e6f 2829 2c20 302c 2061 6363  fileno(), 0, acc
+0001ee30: 6573 733d 6d6d 6170 2e41 4343 4553 535f  ess=mmap.ACCESS_
+0001ee40: 5245 4144 290a 2020 2020 2020 2020 2020  READ).          
+0001ee50: 2020 2020 2020 2020 2020 2320 7079 7468            # pyth
+0001ee60: 6f6e 2033 206d 6d61 702e 6d6d 6170 2866  on 3 mmap.mmap(f
+0001ee70: 696c 652e 6669 6c65 6e6f 2829 2c20 302c  ile.fileno(), 0,
+0001ee80: 2061 6363 6573 733d 6d6d 6170 2e41 4343   access=mmap.ACC
+0001ee90: 4553 535f 5245 4144 2920 6173 2073 3a0a  ESS_READ) as s:.
 0001eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eeb0: 2020 2020 6173 7365 6d62 6c65 203d 2046      assemble = F
-0001eec0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0001eed0: 2020 2020 2061 7373 656d 626c 656d 6170       assemblemap
-0001eee0: 7375 7266 6163 6520 3d20 6469 6374 2829  surface = dict()
-0001eef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef00: 2069 6620 6173 7365 6d62 6c65 3a0a 2020   if assemble:.  
-0001ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef20: 2020 6d6f 6465 6c6e 616d 6520 3d20 6f73    modelname = os
-0001ef30: 2e70 6174 682e 6261 7365 6e61 6d65 286d  .path.basename(m
-0001ef40: 6f64 656c 2e66 696c 656e 616d 6529 0a20  odel.filename). 
-0001ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef60: 2020 2073 7572 6661 6365 666e 203d 2027     surfacefn = '
-0001ef70: 7b7d 5f7b 7d27 2e66 6f72 6d61 7428 6d6f  {}_{}'.format(mo
-0001ef80: 6465 6c6e 616d 652c 2073 656c 662e 6d61  delname, self.ma
-0001ef90: 706e 616d 6529 0a20 2020 2020 2020 2020  pname).         
-0001efa0: 2020 2020 2020 2020 2020 2066 6f72 206a             for j
-0001efb0: 7065 6720 696e 206a 7065 6773 3a0a 2020  peg in jpegs:.  
-0001efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efd0: 2020 2020 2020 6966 206d 6f64 656c 6e61        if modelna
-0001efe0: 6d65 2069 6e20 6a70 6567 2061 6e64 2027  me in jpeg and '
-0001eff0: 7873 7572 6661 6365 2720 696e 206a 7065  xsurface' in jpe
-0001f000: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-0001f010: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001f020: 7373 656d 626c 656d 6170 7375 7266 6163  ssemblemapsurfac
-0001f030: 655b 2778 5f61 7373 656d 626c 6527 5d20  e['x_assemble'] 
-0001f040: 3d20 7374 7228 7375 7266 6163 6566 6e29  = str(surfacefn)
-0001f050: 202b 2027 5f61 7373 656d 626c 655f 7363   + '_assemble_sc
-0001f060: 616c 6564 5f78 7375 7266 6163 652e 6a70  aled_xsurface.jp
-0001f070: 6567 270a 2020 2020 2020 2020 2020 2020  eg'.            
-0001f080: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0001f090: 6f64 656c 6e61 6d65 2069 6e20 6a70 6567  odelname in jpeg
-0001f0a0: 2061 6e64 2027 7973 7572 6661 6365 2720   and 'ysurface' 
-0001f0b0: 696e 206a 7065 673a 0a20 2020 2020 2020  in jpeg:.       
-0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0d0: 2020 2020 2061 7373 656d 626c 656d 6170       assemblemap
-0001f0e0: 7375 7266 6163 655b 2779 5f61 7373 656d  surface['y_assem
-0001f0f0: 626c 6527 5d20 3d20 7374 7228 7375 7266  ble'] = str(surf
-0001f100: 6163 6566 6e29 202b 2027 5f61 7373 656d  acefn) + '_assem
-0001f110: 626c 655f 7363 616c 6564 5f79 7375 7266  ble_scaled_ysurf
-0001f120: 6163 652e 6a70 6567 270a 2020 2020 2020  ace.jpeg'.      
-0001f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f140: 2020 6966 206d 6f64 656c 6e61 6d65 2069    if modelname i
-0001f150: 6e20 6a70 6567 2061 6e64 2027 7a73 7572  n jpeg and 'zsur
-0001f160: 6661 6365 2720 696e 206a 7065 673a 0a20  face' in jpeg:. 
-0001f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f180: 2020 2020 2020 2020 2020 2061 7373 656d             assem
-0001f190: 626c 656d 6170 7375 7266 6163 655b 277a  blemapsurface['z
-0001f1a0: 5f61 7373 656d 626c 6527 5d20 3d20 7374  _assemble'] = st
-0001f1b0: 7228 7375 7266 6163 6566 6e29 202b 2027  r(surfacefn) + '
-0001f1c0: 5f61 7373 656d 626c 655f 7363 616c 6564  _assemble_scaled
-0001f1d0: 5f7a 7375 7266 6163 652e 6a70 6567 270a  _zsurface.jpeg'.
-0001f1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f1f0: 206d 6572 6765 6464 6963 7420 3d20 6469   mergeddict = di
-0001f200: 6374 286d 6f64 656c 6d61 7073 7572 6661  ct(modelmapsurfa
-0001f210: 6365 2c20 2a2a 6173 7365 6d62 6c65 6d61  ce, **assemblema
-0001f220: 7073 7572 6661 6365 290a 2020 2020 2020  psurface).      
-0001f230: 2020 2020 2020 2020 2020 6d6f 6465 6c73            models
-0001f240: 7572 665b 6d6f 6465 6c6e 616d 655d 203d  urf[modelname] =
-0001f250: 206d 6572 6765 6464 6963 740a 2020 2020   mergeddict.    
-0001f260: 2020 2020 6966 206d 6d65 7272 6c69 7374      if mmerrlist
-0001f270: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
-0001f280: 6465 6c73 7572 665b 2765 7272 275d 203d  delsurf['err'] =
-0001f290: 207b 276d 6170 6d6f 6465 6c5f 7375 7266   {'mapmodel_surf
-0001f2a0: 6163 655f 6572 7227 3a20 6d6d 6572 726c  ace_err': mmerrl
-0001f2b0: 6973 747d 0a20 2020 2020 2020 2066 696e  ist}.        fin
-0001f2c0: 616c 6d6d 6469 6374 5b27 6d61 706d 6f64  almmdict['mapmod
-0001f2d0: 656c 5f73 7572 6661 6365 275d 203d 206d  el_surface'] = m
-0001f2e0: 6f64 656c 7375 7266 0a0a 2020 2020 2020  odelsurf..      
-0001f2f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001f300: 2020 2077 6974 6820 636f 6465 6373 2e6f     with codecs.o
-0001f310: 7065 6e28 7365 6c66 2e77 6f72 6b64 6972  pen(self.workdir
-0001f320: 202b 2073 656c 662e 6d61 706e 616d 6520   + self.mapname 
-0001f330: 2b20 275f 6d61 706d 6f64 656c 7375 7266  + '_mapmodelsurf
-0001f340: 6163 6576 6965 772e 6a73 6f6e 272c 2027  aceview.json', '
-0001f350: 7727 2c0a 2020 2020 2020 2020 2020 2020  w',.            
-0001f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f370: 2020 2020 656e 636f 6469 6e67 3d27 7574      encoding='ut
-0001f380: 662d 3827 2920 6173 2066 3a0a 2020 2020  f-8') as f:.    
-0001f390: 2020 2020 2020 2020 2020 2020 6a73 6f6e              json
-0001f3a0: 2e64 756d 7028 6669 6e61 6c6d 6d64 6963  .dump(finalmmdic
-0001f3b0: 742c 2066 290a 2020 2020 2020 2020 6578  t, f).        ex
-0001f3c0: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-0001f3d0: 2020 6572 7220 3d20 2753 6176 696e 6720    err = 'Saving 
-0001f3e0: 6d6f 6465 6c20 616e 6420 6d61 7020 7375  model and map su
-0001f3f0: 7266 6163 6520 7669 6577 7320 6a73 6f6e  rface views json
-0001f400: 2065 7272 6f72 3a20 7b7d 2e27 2e66 6f72   error: {}.'.for
-0001f410: 6d61 7428 7379 732e 6578 635f 696e 666f  mat(sys.exc_info
-0001f420: 2829 5b31 5d29 0a20 2020 2020 2020 2020  ()[1]).         
-0001f430: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
-0001f440: 6974 6528 6572 7220 2b20 275c 6e27 290a  ite(err + '\n').
-0001f450: 0a20 2020 2020 2020 2065 6e64 203d 2074  .        end = t
-0001f460: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
-0001f470: 6d65 7228 290a 2020 2020 2020 2020 7072  mer().        pr
-0001f480: 696e 7428 2753 7572 6661 6365 7669 6577  int('Surfaceview
-0001f490: 2074 696d 653a 2025 7327 2025 2028 656e   time: %s' % (en
-0001f4a0: 6420 2d20 7374 6172 7429 290a 2020 2020  d - start)).    
-0001f4b0: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
-0001f4c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f4d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
-0001f4e0: 290a 0a0a 2020 2020 6465 6620 6d6f 6465  )...    def mode
-0001f4f0: 6c66 6974 7375 7266 6163 6528 7365 6c66  lfitsurface(self
-0001f500: 2c20 6368 696d 6572 6161 7070 293a 0a0a  , chimeraapp):..
-0001f510: 2020 2020 2020 2020 2320 7265 6164 206a          # read j
-0001f520: 736f 6e0a 2020 2020 2020 2020 7374 6172  son.        star
-0001f530: 7420 3d20 7469 6d65 6974 2e64 6566 6175  t = timeit.defau
-0001f540: 6c74 5f74 696d 6572 2829 0a20 2020 2020  lt_timer().     
-0001f550: 2020 2069 6e6a 736f 6e20 3d20 676c 6f62     injson = glob
-0001f560: 2e67 6c6f 6228 7365 6c66 2e77 6f72 6b64  .glob(self.workd
-0001f570: 6972 202b 2027 2a72 6573 6964 7565 5f69  ir + '*residue_i
-0001f580: 6e63 6c75 7369 6f6e 2e6a 736f 6e27 290a  nclusion.json').
-0001f590: 2020 2020 2020 2020 6261 7365 6469 7220          basedir 
-0001f5a0: 3d20 7365 6c66 2e77 6f72 6b64 6972 0a20  = self.workdir. 
-0001f5b0: 2020 2020 2020 206d 6170 6e61 6d65 203d         mapname =
-0001f5c0: 2073 656c 662e 6d61 706e 616d 650a 2020   self.mapname.  
-0001f5d0: 2020 2020 2020 6c6f 6343 4849 4d45 5241        locCHIMERA
-0001f5e0: 203d 2063 6869 6d65 7261 6170 700a 2020   = chimeraapp.  
-0001f5f0: 2020 2020 2020 6269 6e64 6973 706c 6179        bindisplay
-0001f600: 203d 206f 732e 6765 7465 6e76 2827 4449   = os.getenv('DI
-0001f610: 5350 4c41 5927 290a 2020 2020 2020 2020  SPLAY').        
-0001f620: 6572 726c 6973 7420 3d20 5b5d 0a0a 2020  errlist = []..  
-0001f630: 2020 2020 2020 6675 6c69 6e6a 736f 6e20        fulinjson 
-0001f640: 3d20 696e 6a73 6f6e 5b30 5d20 6966 2069  = injson[0] if i
-0001f650: 6e6a 736f 6e20 656c 7365 204e 6f6e 650a  njson else None.
-0001f660: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001f670: 2020 2020 2020 2020 2069 6620 6675 6c69           if fuli
-0001f680: 6e6a 736f 6e3a 0a20 2020 2020 2020 2020  njson:.         
-0001f690: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0001f6a0: 2866 756c 696e 6a73 6f6e 2c20 2772 2729  (fulinjson, 'r')
-0001f6b0: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0001f6c0: 2020 2020 2020 2020 2020 2061 7267 7320             args 
-0001f6d0: 3d20 6a73 6f6e 2e6c 6f61 6428 6629 0a20  = json.load(f). 
-0001f6e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001f6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f700: 2061 7267 7320 3d20 4e6f 6e65 0a20 2020   args = None.   
-0001f710: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0001f720: 6e74 2827 5468 6572 6520 6973 206e 6f20  nt('There is no 
-0001f730: 7265 7369 6475 6520 696e 636c 7573 696f  residue inclusio
-0001f740: 6e20 6a73 6f6e 2066 696c 652e 2729 0a20  n json file.'). 
-0001f750: 2020 2020 2020 2065 7863 6570 7420 5479         except Ty
-0001f760: 7065 4572 726f 723a 0a20 2020 2020 2020  peError:.       
-0001f770: 2020 2020 2065 7272 203d 2027 4f70 656e       err = 'Open
-0001f780: 2072 6573 6964 7565 5f69 6e63 6c75 7369   residue_inclusi
-0001f790: 6f6e 2065 7272 6f72 3a20 7b7d 2e27 2e66  on error: {}.'.f
-0001f7a0: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
-0001f7b0: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
-0001f7c0: 2020 2020 2065 7272 6c69 7374 2e61 7070       errlist.app
-0001f7d0: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
-0001f7e0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-0001f7f0: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
-0001f800: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0001f810: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0001f820: 7267 7320 6973 206e 6f74 204e 6f6e 653a  rgs is not None:
-0001f830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f840: 206d 6f64 656c 7320 3d20 6172 6773 5b27   models = args['
-0001f850: 7265 7369 6475 655f 696e 636c 7573 696f  residue_inclusio
-0001f860: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
-0001f870: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001f880: 2020 2020 2020 2020 2020 2020 2064 656c               del
-0001f890: 206d 6f64 656c 735b 2765 7272 275d 0a20   models['err']. 
-0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001f8b0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-0001f8c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0001f8d0: 2827 5265 7369 6475 6520 696e 636c 7573  ('Residue inclus
-0001f8e0: 696f 6e20 6a73 6f6e 2072 6573 756c 7420  ion json result 
-0001f8f0: 6973 2063 6f72 7265 6374 2729 0a0a 2020  is correct')..  
-0001f900: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001f910: 696e 7428 2754 6865 7265 2069 732f 6172  int('There is/ar
-0001f920: 6520 2573 206d 6f64 656c 2873 292e 2720  e %s model(s).' 
-0001f930: 2520 6c65 6e28 6d6f 6465 6c73 2929 0a0a  % len(models))..
+0001eeb0: 2020 2020 6966 2073 2e66 696e 6428 6227      if s.find(b'
+0001eec0: 706f 696e 7420 7379 6d6d 6574 7279 206f  point symmetry o
+0001eed0: 7065 7261 7469 6f6e 2729 2021 3d20 2d31  peration') != -1
+0001eee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001eef0: 2020 2020 2020 2020 2020 6173 7365 6d62            assemb
+0001ef00: 6c65 203d 2054 7275 650a 2020 2020 2020  le = True.      
+0001ef10: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001ef20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001ef30: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0001ef40: 6d62 6c65 203d 2046 616c 7365 0a20 2020  mble = False.   
+0001ef50: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0001ef60: 656d 626c 656d 6170 7375 7266 6163 6520  emblemapsurface 
+0001ef70: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
+0001ef80: 2020 2020 2020 2020 2069 6620 6173 7365           if asse
+0001ef90: 6d62 6c65 3a0a 2020 2020 2020 2020 2020  mble:.          
+0001efa0: 2020 2020 2020 2020 2020 6d6f 6465 6c6e            modeln
+0001efb0: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+0001efc0: 7365 6e61 6d65 286d 6f64 656c 2e66 696c  sename(model.fil
+0001efd0: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
+0001efe0: 2020 2020 2020 2020 2020 2073 7572 6661             surfa
+0001eff0: 6365 666e 203d 2027 7b7d 5f7b 7d27 2e66  cefn = '{}_{}'.f
+0001f000: 6f72 6d61 7428 6d6f 6465 6c6e 616d 652c  ormat(modelname,
+0001f010: 2073 656c 662e 6d61 706e 616d 6529 0a20   self.mapname). 
+0001f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f030: 2020 2066 6f72 206a 7065 6720 696e 206a     for jpeg in j
+0001f040: 7065 6773 3a0a 2020 2020 2020 2020 2020  pegs:.          
+0001f050: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001f060: 206d 6f64 656c 6e61 6d65 2069 6e20 6a70   modelname in jp
+0001f070: 6567 2061 6e64 2027 7873 7572 6661 6365  eg and 'xsurface
+0001f080: 2720 696e 206a 7065 673a 0a20 2020 2020  ' in jpeg:.     
+0001f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f0a0: 2020 2020 2020 2061 7373 656d 626c 656d         assemblem
+0001f0b0: 6170 7375 7266 6163 655b 2778 5f61 7373  apsurface['x_ass
+0001f0c0: 656d 626c 6527 5d20 3d20 7374 7228 7375  emble'] = str(su
+0001f0d0: 7266 6163 6566 6e29 202b 2027 5f61 7373  rfacefn) + '_ass
+0001f0e0: 656d 626c 655f 7363 616c 6564 5f78 7375  emble_scaled_xsu
+0001f0f0: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
+0001f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f110: 2020 2020 6966 206d 6f64 656c 6e61 6d65      if modelname
+0001f120: 2069 6e20 6a70 6567 2061 6e64 2027 7973   in jpeg and 'ys
+0001f130: 7572 6661 6365 2720 696e 206a 7065 673a  urface' in jpeg:
+0001f140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f150: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0001f160: 656d 626c 656d 6170 7375 7266 6163 655b  emblemapsurface[
+0001f170: 2779 5f61 7373 656d 626c 6527 5d20 3d20  'y_assemble'] = 
+0001f180: 7374 7228 7375 7266 6163 6566 6e29 202b  str(surfacefn) +
+0001f190: 2027 5f61 7373 656d 626c 655f 7363 616c   '_assemble_scal
+0001f1a0: 6564 5f79 7375 7266 6163 652e 6a70 6567  ed_ysurface.jpeg
+0001f1b0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001f1c0: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
+0001f1d0: 656c 6e61 6d65 2069 6e20 6a70 6567 2061  elname in jpeg a
+0001f1e0: 6e64 2027 7a73 7572 6661 6365 2720 696e  nd 'zsurface' in
+0001f1f0: 206a 7065 673a 0a20 2020 2020 2020 2020   jpeg:.         
+0001f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f210: 2020 2061 7373 656d 626c 656d 6170 7375     assemblemapsu
+0001f220: 7266 6163 655b 277a 5f61 7373 656d 626c  rface['z_assembl
+0001f230: 6527 5d20 3d20 7374 7228 7375 7266 6163  e'] = str(surfac
+0001f240: 6566 6e29 202b 2027 5f61 7373 656d 626c  efn) + '_assembl
+0001f250: 655f 7363 616c 6564 5f7a 7375 7266 6163  e_scaled_zsurfac
+0001f260: 652e 6a70 6567 270a 0a20 2020 2020 2020  e.jpeg'..       
+0001f270: 2020 2020 2020 2020 206d 6572 6765 6464           mergedd
+0001f280: 6963 7420 3d20 6469 6374 286d 6f64 656c  ict = dict(model
+0001f290: 6d61 7073 7572 6661 6365 2c20 2a2a 6173  mapsurface, **as
+0001f2a0: 7365 6d62 6c65 6d61 7073 7572 6661 6365  semblemapsurface
+0001f2b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001f2c0: 2020 6d6f 6465 6c73 7572 665b 6d6f 6465    modelsurf[mode
+0001f2d0: 6c6e 616d 655d 203d 206d 6572 6765 6464  lname] = mergedd
+0001f2e0: 6963 740a 2020 2020 2020 2020 6966 206d  ict.        if m
+0001f2f0: 6d65 7272 6c69 7374 3a0a 2020 2020 2020  merrlist:.      
+0001f300: 2020 2020 2020 6d6f 6465 6c73 7572 665b        modelsurf[
+0001f310: 2765 7272 275d 203d 207b 276d 6170 6d6f  'err'] = {'mapmo
+0001f320: 6465 6c5f 7375 7266 6163 655f 6572 7227  del_surface_err'
+0001f330: 3a20 6d6d 6572 726c 6973 747d 0a20 2020  : mmerrlist}.   
+0001f340: 2020 2020 2066 696e 616c 6d6d 6469 6374       finalmmdict
+0001f350: 5b27 6d61 706d 6f64 656c 5f73 7572 6661  ['mapmodel_surfa
+0001f360: 6365 275d 203d 206d 6f64 656c 7375 7266  ce'] = modelsurf
+0001f370: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0001f380: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001f390: 636f 6465 6373 2e6f 7065 6e28 7365 6c66  codecs.open(self
+0001f3a0: 2e77 6f72 6b64 6972 202b 2073 656c 662e  .workdir + self.
+0001f3b0: 6d61 706e 616d 6520 2b20 275f 6d61 706d  mapname + '_mapm
+0001f3c0: 6f64 656c 7375 7266 6163 6576 6965 772e  odelsurfaceview.
+0001f3d0: 6a73 6f6e 272c 2027 7727 2c0a 2020 2020  json', 'w',.    
+0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3f0: 2020 2020 2020 2020 2020 2020 656e 636f              enco
+0001f400: 6469 6e67 3d27 7574 662d 3827 2920 6173  ding='utf-8') as
+0001f410: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+0001f420: 2020 2020 6a73 6f6e 2e64 756d 7028 6669      json.dump(fi
+0001f430: 6e61 6c6d 6d64 6963 742c 2066 290a 2020  nalmmdict, f).  
+0001f440: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0001f450: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
+0001f460: 2753 6176 696e 6720 6d6f 6465 6c20 616e  'Saving model an
+0001f470: 6420 6d61 7020 7375 7266 6163 6520 7669  d map surface vi
+0001f480: 6577 7320 6a73 6f6e 2065 7272 6f72 3a20  ews json error: 
+0001f490: 7b7d 2e27 2e66 6f72 6d61 7428 7379 732e  {}.'.format(sys.
+0001f4a0: 6578 635f 696e 666f 2829 5b31 5d29 0a20  exc_info()[1]). 
+0001f4b0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+0001f4c0: 7464 6572 722e 7772 6974 6528 6572 7220  tderr.write(err 
+0001f4d0: 2b20 275c 6e27 290a 0a20 2020 2020 2020  + '\n')..       
+0001f4e0: 2065 6e64 203d 2074 696d 6569 742e 6465   end = timeit.de
+0001f4f0: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
+0001f500: 2020 2020 2020 7072 696e 7428 2753 7572        print('Sur
+0001f510: 6661 6365 7669 6577 2074 696d 653a 2025  faceview time: %
+0001f520: 7327 2025 2028 656e 6420 2d20 7374 6172  s' % (end - star
+0001f530: 7429 290a 2020 2020 2020 2020 7072 696e  t)).        prin
+0001f540: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
+0001f550: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f560: 2d2d 2d2d 2d2d 2d27 290a 0a0a 2020 2020  -------')...    
+0001f570: 6465 6620 6d6f 6465 6c66 6974 7375 7266  def modelfitsurf
+0001f580: 6163 6528 7365 6c66 2c20 6368 696d 6572  ace(self, chimer
+0001f590: 6161 7070 293a 0a0a 2020 2020 2020 2020  aapp):..        
+0001f5a0: 2320 7265 6164 206a 736f 6e0a 2020 2020  # read json.    
+0001f5b0: 2020 2020 7374 6172 7420 3d20 7469 6d65      start = time
+0001f5c0: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
+0001f5d0: 2829 0a20 2020 2020 2020 2069 6e6a 736f  ().        injso
+0001f5e0: 6e20 3d20 676c 6f62 2e67 6c6f 6228 7365  n = glob.glob(se
+0001f5f0: 6c66 2e77 6f72 6b64 6972 202b 2027 2a72  lf.workdir + '*r
+0001f600: 6573 6964 7565 5f69 6e63 6c75 7369 6f6e  esidue_inclusion
+0001f610: 2e6a 736f 6e27 290a 2020 2020 2020 2020  .json').        
+0001f620: 6261 7365 6469 7220 3d20 7365 6c66 2e77  basedir = self.w
+0001f630: 6f72 6b64 6972 0a20 2020 2020 2020 206d  orkdir.        m
+0001f640: 6170 6e61 6d65 203d 2073 656c 662e 6d61  apname = self.ma
+0001f650: 706e 616d 650a 2020 2020 2020 2020 6c6f  pname.        lo
+0001f660: 6343 4849 4d45 5241 203d 2063 6869 6d65  cCHIMERA = chime
+0001f670: 7261 6170 700a 2020 2020 2020 2020 6269  raapp.        bi
+0001f680: 6e64 6973 706c 6179 203d 206f 732e 6765  ndisplay = os.ge
+0001f690: 7465 6e76 2827 4449 5350 4c41 5927 290a  tenv('DISPLAY').
+0001f6a0: 2020 2020 2020 2020 6572 726c 6973 7420          errlist 
+0001f6b0: 3d20 5b5d 0a0a 2020 2020 2020 2020 6675  = []..        fu
+0001f6c0: 6c69 6e6a 736f 6e20 3d20 696e 6a73 6f6e  linjson = injson
+0001f6d0: 5b30 5d20 6966 2069 6e6a 736f 6e20 656c  [0] if injson el
+0001f6e0: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+0001f6f0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001f700: 2069 6620 6675 6c69 6e6a 736f 6e3a 0a20   if fulinjson:. 
+0001f710: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0001f720: 6974 6820 6f70 656e 2866 756c 696e 6a73  ith open(fulinjs
+0001f730: 6f6e 2c20 2772 2729 2061 7320 663a 0a20  on, 'r') as f:. 
+0001f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f750: 2020 2061 7267 7320 3d20 6a73 6f6e 2e6c     args = json.l
+0001f760: 6f61 6428 6629 0a20 2020 2020 2020 2020  oad(f).         
+0001f770: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001f780: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
+0001f790: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0001f7a0: 2020 2020 2070 7269 6e74 2827 5468 6572       print('Ther
+0001f7b0: 6520 6973 206e 6f20 7265 7369 6475 6520  e is no residue 
+0001f7c0: 696e 636c 7573 696f 6e20 6a73 6f6e 2066  inclusion json f
+0001f7d0: 696c 652e 2729 0a20 2020 2020 2020 2065  ile.').        e
+0001f7e0: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
+0001f7f0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+0001f800: 203d 2027 4f70 656e 2072 6573 6964 7565   = 'Open residue
+0001f810: 5f69 6e63 6c75 7369 6f6e 2065 7272 6f72  _inclusion error
+0001f820: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 7379  : {}.'.format(sy
+0001f830: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
+0001f840: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+0001f850: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
+0001f860: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+0001f870: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
+0001f880: 7220 2b20 275c 6e27 290a 2020 2020 2020  r + '\n').      
+0001f890: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001f8a0: 2020 2020 6966 2061 7267 7320 6973 206e      if args is n
+0001f8b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001f8c0: 2020 2020 2020 2020 206d 6f64 656c 7320           models 
+0001f8d0: 3d20 6172 6773 5b27 7265 7369 6475 655f  = args['residue_
+0001f8e0: 696e 636c 7573 696f 6e27 5d0a 2020 2020  inclusion'].    
+0001f8f0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0001f900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f910: 2020 2020 2064 656c 206d 6f64 656c 735b       del models[
+0001f920: 2765 7272 275d 0a20 2020 2020 2020 2020  'err'].         
+0001f930: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
 0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f950: 666f 7220 286b 6579 2c20 7661 6c75 6529  for (key, value)
-0001f960: 2069 6e20 6974 6572 6974 656d 7328 6d6f   in iteritems(mo
-0001f970: 6465 6c73 293a 0a20 2020 2020 2020 2020  dels):.         
-0001f980: 2020 2020 2020 2020 2020 2023 2066 6f72             # for
-0001f990: 2028 6b65 7932 2c20 7661 6c75 6532 2920   (key2, value2) 
-0001f9a0: 696e 2069 7465 7269 7465 6d73 2876 616c  in iteritems(val
-0001f9b0: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
-0001f9c0: 2020 2020 2020 2020 206b 6579 6c69 7374           keylist
-0001f9d0: 203d 206c 6973 7428 7661 6c75 6529 0a20   = list(value). 
-0001f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9f0: 2020 2066 6f72 206b 6579 2069 6e20 6b65     for key in ke
-0001fa00: 796c 6973 743a 0a20 2020 2020 2020 2020  ylist:.         
-0001fa10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001fa20: 6620 6b65 7920 213d 2027 6e61 6d65 273a  f key != 'name':
-0001fa30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fa40: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-0001fa50: 6f72 7320 3d20 7661 6c75 655b 6b65 795d  ors = value[key]
-0001fa60: 5b27 636f 6c6f 7227 5d0a 2020 2020 2020  ['color'].      
-0001fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa80: 2020 2020 2020 7265 7369 6475 6573 203d        residues =
-0001fa90: 2076 616c 7565 5b6b 6579 5d5b 2772 6573   value[key]['res
-0001faa0: 6964 7565 275d 0a20 2020 2020 2020 2020  idue'].         
-0001fab0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001fac0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fae0: 206d 6f64 656c 6e61 6d65 203d 2076 616c   modelname = val
-0001faf0: 7565 5b6b 6579 5d0a 2020 2020 2020 2020  ue[key].        
-0001fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb10: 2020 2020 6d6f 6465 6c20 3d20 7365 6c66      model = self
-0001fb20: 2e77 6f72 6b64 6972 202b 206d 6f64 656c  .workdir + model
-0001fb30: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-0001fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb50: 2063 6869 6d65 7261 666e 616d 6520 3d20   chimerafname = 
-0001fb60: 277b 7d5f 7b7d 5f66 6974 5f63 6869 6d65  '{}_{}_fit_chime
-0001fb70: 7261 2e63 7863 272e 666f 726d 6174 286d  ra.cxc'.format(m
-0001fb80: 6f64 656c 6e61 6d65 2c20 6d61 706e 616d  odelname, mapnam
-0001fb90: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001fba0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001fbb0: 7269 6e74 2863 6869 6d65 7261 666e 616d  rint(chimerafnam
-0001fbc0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001fbd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001fbe0: 7572 6661 6365 666e 203d 2027 7b7d 7b7d  urfacefn = '{}{}
-0001fbf0: 5f7b 7d27 2e66 6f72 6d61 7428 6261 7365  _{}'.format(base
-0001fc00: 6469 722c 206d 6f64 656c 6e61 6d65 2c20  dir, modelname, 
-0001fc10: 6d61 706e 616d 6529 0a20 2020 2020 2020  mapname).       
+0001f950: 2020 2070 7269 6e74 2827 5265 7369 6475     print('Residu
+0001f960: 6520 696e 636c 7573 696f 6e20 6a73 6f6e  e inclusion json
+0001f970: 2072 6573 756c 7420 6973 2063 6f72 7265   result is corre
+0001f980: 6374 2729 0a0a 2020 2020 2020 2020 2020  ct')..          
+0001f990: 2020 2020 2020 7072 696e 7428 2754 6865        print('The
+0001f9a0: 7265 2069 732f 6172 6520 2573 206d 6f64  re is/are %s mod
+0001f9b0: 656c 2873 292e 2720 2520 6c65 6e28 6d6f  el(s).' % len(mo
+0001f9c0: 6465 6c73 2929 0a0a 2020 2020 2020 2020  dels))..        
+0001f9d0: 2020 2020 2020 2020 666f 7220 286b 6579          for (key
+0001f9e0: 2c20 7661 6c75 6529 2069 6e20 6974 6572  , value) in iter
+0001f9f0: 6974 656d 7328 6d6f 6465 6c73 293a 0a20  items(models):. 
+0001fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa10: 2020 2023 2066 6f72 2028 6b65 7932 2c20     # for (key2, 
+0001fa20: 7661 6c75 6532 2920 696e 2069 7465 7269  value2) in iteri
+0001fa30: 7465 6d73 2876 616c 7565 293a 0a20 2020  tems(value):.   
+0001fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa50: 206b 6579 6c69 7374 203d 206c 6973 7428   keylist = list(
+0001fa60: 7661 6c75 6529 0a20 2020 2020 2020 2020  value).         
+0001fa70: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0001fa80: 6579 2069 6e20 6b65 796c 6973 743a 0a20  ey in keylist:. 
+0001fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001faa0: 2020 2020 2020 2069 6620 6b65 7920 213d         if key !=
+0001fab0: 2027 6e61 6d65 273a 0a20 2020 2020 2020   'name':.       
+0001fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fad0: 2020 2020 2063 6f6c 6f72 7320 3d20 7661       colors = va
+0001fae0: 6c75 655b 6b65 795d 5b27 636f 6c6f 7227  lue[key]['color'
+0001faf0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001fb00: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001fb10: 7369 6475 6573 203d 2076 616c 7565 5b6b  sidues = value[k
+0001fb20: 6579 5d5b 2772 6573 6964 7565 275d 0a20  ey]['residue']. 
+0001fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb40: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb60: 2020 2020 2020 2020 206d 6f64 656c 6e61           modelna
+0001fb70: 6d65 203d 2076 616c 7565 5b6b 6579 5d0a  me = value[key].
+0001fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb90: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0001fba0: 6c20 3d20 7365 6c66 2e77 6f72 6b64 6972  l = self.workdir
+0001fbb0: 202b 206d 6f64 656c 6e61 6d65 0a20 2020   + modelname.   
+0001fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fbd0: 2020 2020 2020 2020 2063 6869 6d65 7261           chimera
+0001fbe0: 666e 616d 6520 3d20 277b 7d5f 7b7d 5f66  fname = '{}_{}_f
+0001fbf0: 6974 5f63 6869 6d65 7261 2e63 7863 272e  it_chimera.cxc'.
+0001fc00: 666f 726d 6174 286d 6f64 656c 6e61 6d65  format(modelname
+0001fc10: 2c20 6d61 706e 616d 6529 0a20 2020 2020  , mapname).     
 0001fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc30: 2020 2020 2063 6869 6d65 7261 636d 6420       chimeracmd 
-0001fc40: 3d20 6368 696d 6572 6166 6e61 6d65 0a20  = chimerafname. 
+0001fc30: 2020 2020 2020 2070 7269 6e74 2863 6869         print(chi
+0001fc40: 6d65 7261 666e 616d 6529 0a20 2020 2020  merafname).     
 0001fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc60: 2020 2077 6974 6820 6f70 656e 2873 656c     with open(sel
-0001fc70: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
-0001fc80: 6572 6163 6d64 2c20 2777 2729 2061 7320  eracmd, 'w') as 
-0001fc90: 6670 3a0a 2020 2020 2020 2020 2020 2020  fp:.            
-0001fca0: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
-0001fcb0: 7269 7465 2822 6f70 656e 2022 202b 2073  rite("open " + s
-0001fcc0: 7472 286d 6f64 656c 2920 2b20 2220 666f  tr(model) + " fo
-0001fcd0: 726d 6174 206d 6d63 6966 2220 2b20 275c  rmat mmcif" + '\
-0001fce0: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-0001fcf0: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
-0001fd00: 7269 7465 2827 7368 6f77 2073 656c 4174  rite('show selAt
-0001fd10: 6f6d 7320 7269 6262 6f6e 7327 202b 2027  oms ribbons' + '
-0001fd20: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
-0001fd30: 2020 2020 2020 2020 2020 2020 2066 702e               fp.
-0001fd40: 7772 6974 6528 2768 6964 6520 7365 6c41  write('hide selA
-0001fd50: 746f 6d73 2720 2b20 275c 6e27 290a 0a20  toms' + '\n').. 
-0001fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd70: 2020 2020 2020 2066 6f72 2028 636f 6c6f         for (colo
-0001fd80: 722c 2072 6573 6964 7565 2920 696e 207a  r, residue) in z
-0001fd90: 6970 2863 6f6c 6f72 732c 2072 6573 6964  ip(colors, resid
-0001fda0: 7565 7329 3a0a 2020 2020 2020 2020 2020  ues):.          
+0001fc60: 2020 2020 2020 2073 7572 6661 6365 666e         surfacefn
+0001fc70: 203d 2027 7b7d 7b7d 5f7b 7d27 2e66 6f72   = '{}{}_{}'.for
+0001fc80: 6d61 7428 6261 7365 6469 722c 206d 6f64  mat(basedir, mod
+0001fc90: 656c 6e61 6d65 2c20 6d61 706e 616d 6529  elname, mapname)
+0001fca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fcb0: 2020 2020 2020 2020 2020 2020 2063 6869               chi
+0001fcc0: 6d65 7261 636d 6420 3d20 6368 696d 6572  meracmd = chimer
+0001fcd0: 6166 6e61 6d65 0a20 2020 2020 2020 2020  afname.         
+0001fce0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001fcf0: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
+0001fd00: 7220 2b20 6368 696d 6572 6163 6d64 2c20  r + chimeracmd, 
+0001fd10: 2777 2729 2061 7320 6670 3a0a 2020 2020  'w') as fp:.    
+0001fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd30: 2020 2020 6670 2e77 7269 7465 2822 6f70      fp.write("op
+0001fd40: 656e 2022 202b 2073 7472 286d 6f64 656c  en " + str(model
+0001fd50: 2920 2b20 2220 666f 726d 6174 206d 6d63  ) + " format mmc
+0001fd60: 6966 2220 2b20 275c 6e27 290a 2020 2020  if" + '\n').    
+0001fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd80: 2020 2020 6670 2e77 7269 7465 2827 7368      fp.write('sh
+0001fd90: 6f77 2073 656c 4174 6f6d 7320 7269 6262  ow selAtoms ribb
+0001fda0: 6f6e 7327 202b 2027 5c6e 2729 0a20 2020  ons' + '\n').   
 0001fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdc0: 2020 6368 6169 6e2c 2072 6573 746d 7020    chain, restmp 
-0001fdd0: 3d20 7265 7369 6475 652e 7370 6c69 7428  = residue.split(
-0001fde0: 273a 2729 0a20 2020 2020 2020 2020 2020  ':').           
-0001fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe00: 2023 204e 6f74 2073 7572 6520 6966 2061   # Not sure if a
-0001fe10: 6c6c 2074 6865 206c 6574 7465 7273 2073  ll the letters s
-0001fe20: 686f 756c 6420 6265 2072 6570 6c61 6365  hould be replace
-0001fe30: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0001fe40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001fe50: 7265 7320 3d20 7265 2e73 7562 2822 5c44  res = re.sub("\D
-0001fe60: 222c 2022 222c 2072 6573 746d 7029 0a20  ", "", restmp). 
+0001fdc0: 2020 2020 2066 702e 7772 6974 6528 2768       fp.write('h
+0001fdd0: 6964 6520 7365 6c41 746f 6d73 2720 2b20  ide selAtoms' + 
+0001fde0: 275c 6e27 290a 0a20 2020 2020 2020 2020  '\n')..         
+0001fdf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001fe00: 6f72 2028 636f 6c6f 722c 2072 6573 6964  or (color, resid
+0001fe10: 7565 2920 696e 207a 6970 2863 6f6c 6f72  ue) in zip(color
+0001fe20: 732c 2072 6573 6964 7565 7329 3a0a 2020  s, residues):.  
+0001fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe40: 2020 2020 2020 2020 2020 6368 6169 6e2c            chain,
+0001fe50: 2072 6573 746d 7020 3d20 7265 7369 6475   restmp = residu
+0001fe60: 652e 7370 6c69 7428 273a 2729 0a20 2020  e.split(':').   
 0001fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe80: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-0001fe90: 2072 652e 6669 6e64 616c 6c28 7227 2d3f   re.findall(r'-?
-0001fea0: 5c64 2b27 2c20 7265 7374 6d70 295b 305d  \d+', restmp)[0]
-0001feb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fec0: 2020 2020 2020 2020 2020 2020 2066 702e               fp.
-0001fed0: 7772 6974 6528 0a20 2020 2020 2020 2020  write(.         
-0001fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fef0: 2020 2020 2020 2027 636f 6c6f 7220 2f27         'color /'
-0001ff00: 202b 2063 6861 696e 202b 2027 3a27 202b   + chain + ':' +
-0001ff10: 2072 6573 202b 2027 2027 202b 2063 6f6c   res + ' ' + col
-0001ff20: 6f72 202b 2027 5c6e 270a 2020 2020 2020  or + '\n'.      
-0001ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff60: 6670 2e77 7269 7465 280a 2020 2020 2020  fp.write(.      
-0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff80: 2020 2020 2020 2273 6574 2062 6743 6f6c        "set bgCol
-0001ff90: 6f72 2077 6869 7465 2220 2b20 275c 6e27  or white" + '\n'
-0001ffa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ffb0: 2020 2020 2020 2020 2020 2020 2022 6c69               "li
-0001ffc0: 6768 7469 6e67 2073 6f66 7422 202b 2027  ghting soft" + '
-0001ffd0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0001ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fff0: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
-00020000: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-00020010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020020: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
-00020030: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
-00020040: 5f7a 6669 7473 7572 6661 6365 2e6a 7065  _zfitsurface.jpe
-00020050: 6722 202b 2022 2073 7570 6572 7361 6d70  g" + " supersamp
-00020060: 6c65 2033 2077 6964 7468 2031 3230 3020  le 3 width 1200 
-00020070: 6865 6967 6874 2031 3230 3022 202b 2027  height 1200" + '
-00020080: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0001fe80: 2020 2020 2020 2020 2023 204e 6f74 2073           # Not s
+0001fe90: 7572 6520 6966 2061 6c6c 2074 6865 206c  ure if all the l
+0001fea0: 6574 7465 7273 2073 686f 756c 6420 6265  etters should be
+0001feb0: 2072 6570 6c61 6365 640a 2020 2020 2020   replaced.      
+0001fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fed0: 2020 2020 2020 2320 7265 7320 3d20 7265        # res = re
+0001fee0: 2e73 7562 2822 5c44 222c 2022 222c 2072  .sub("\D", "", r
+0001fef0: 6573 746d 7029 0a20 2020 2020 2020 2020  estmp).         
+0001ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff10: 2020 2072 6573 203d 2072 652e 6669 6e64     res = re.find
+0001ff20: 616c 6c28 7227 2d3f 5c64 2b27 2c20 7265  all(r'-?\d+', re
+0001ff30: 7374 6d70 295b 305d 0a20 2020 2020 2020  stmp)[0].       
+0001ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff50: 2020 2020 2066 702e 7772 6974 6528 0a20       fp.write(. 
+0001ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001ff80: 636f 6c6f 7220 2f27 202b 2063 6861 696e  color /' + chain
+0001ff90: 202b 2027 3a27 202b 2072 6573 202b 2027   + ':' + res + '
+0001ffa0: 2027 202b 2063 6f6c 6f72 202b 2027 5c6e   ' + color + '\n
+0001ffb0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001ffc0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffe0: 2020 2020 2020 2020 6670 2e77 7269 7465          fp.write
+0001fff0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00020000: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+00020010: 6574 2062 6743 6f6c 6f72 2077 6869 7465  et bgColor white
+00020020: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
+00020030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020040: 2020 2020 2022 6c69 6768 7469 6e67 2073       "lighting s
+00020050: 6f66 7422 202b 2027 5c6e 270a 2020 2020  oft" + '\n'.    
+00020060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020070: 2020 2020 2020 2020 2276 6965 7720 636f          "view co
+00020080: 6672 2054 7275 6522 202b 2027 5c6e 270a  fr True" + '\n'.
 00020090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200a0: 2274 7572 6e20 7820 2d39 3022 202b 2027  "turn x -90" + '
-000200b0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-000200c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200d0: 2274 7572 6e20 7920 2d39 3022 202b 2027  "turn y -90" + '
-000200e0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020100: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
-00020110: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-00020120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020130: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
-00020140: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
-00020150: 5f78 6669 7473 7572 6661 6365 2e6a 7065  _xfitsurface.jpe
-00020160: 6722 202b 2022 2073 7570 6572 7361 6d70  g" + " supersamp
-00020170: 6c65 2033 2077 6964 7468 2031 3230 3020  le 3 width 1200 
-00020180: 6865 6967 6874 2031 3230 3022 202b 2027  height 1200" + '
-00020190: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+000200a0: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
+000200b0: 6520 2220 2b20 7374 7228 7375 7266 6163  e " + str(surfac
+000200c0: 6566 6e29 202b 2022 5f7a 6669 7473 7572  efn) + "_zfitsur
+000200d0: 6661 6365 2e6a 7065 6722 202b 2022 2073  face.jpeg" + " s
+000200e0: 7570 6572 7361 6d70 6c65 2033 2077 6964  upersample 3 wid
+000200f0: 7468 2031 3230 3020 6865 6967 6874 2031  th 1200 height 1
+00020100: 3230 3022 202b 2027 5c6e 270a 2020 2020  200" + '\n'.    
+00020110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020120: 2020 2020 2020 2020 2274 7572 6e20 7820          "turn x 
+00020130: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
+00020140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020150: 2020 2020 2020 2020 2274 7572 6e20 7920          "turn y 
+00020160: 2d39 3022 202b 2027 5c6e 270a 2020 2020  -90" + '\n'.    
+00020170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020180: 2020 2020 2020 2020 2276 6965 7720 636f          "view co
+00020190: 6672 2054 7275 6522 202b 2027 5c6e 270a  fr True" + '\n'.
 000201a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201b0: 2276 6965 7720 6f72 6965 6e74 2220 2b20  "view orient" + 
-000201c0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-000201d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201e0: 2022 7475 726e 2078 2039 3022 202b 2027   "turn x 90" + '
-000201f0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020210: 2274 7572 6e20 7a20 3930 2220 2b20 275c  "turn z 90" + '\
-00020220: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-00020230: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00020240: 7669 6577 2063 6f66 7220 5472 7565 2220  view cofr True" 
-00020250: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-00020260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020270: 2020 2022 7361 7665 2022 202b 2073 7472     "save " + str
-00020280: 2873 7572 6661 6365 666e 2920 2b20 225f  (surfacefn) + "_
-00020290: 7966 6974 7375 7266 6163 652e 6a70 6567  yfitsurface.jpeg
-000202a0: 2220 2b20 2220 7375 7065 7273 616d 706c  " + " supersampl
-000202b0: 6520 3320 7769 6474 6820 3132 3030 2068  e 3 width 1200 h
-000202c0: 6569 6768 7420 3132 3030 2220 2b20 275c  eight 1200" + '\
-000202d0: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-000202e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000202f0: 636c 6f73 6520 616c 6c22 202b 2022 5c6e  close all" + "\n
-00020300: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00020310: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-00020320: 7869 7422 0a20 2020 2020 2020 2020 2020  xit".           
-00020330: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00020340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020350: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+000201b0: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
+000201c0: 6520 2220 2b20 7374 7228 7375 7266 6163  e " + str(surfac
+000201d0: 6566 6e29 202b 2022 5f78 6669 7473 7572  efn) + "_xfitsur
+000201e0: 6661 6365 2e6a 7065 6722 202b 2022 2073  face.jpeg" + " s
+000201f0: 7570 6572 7361 6d70 6c65 2033 2077 6964  upersample 3 wid
+00020200: 7468 2031 3230 3020 6865 6967 6874 2031  th 1200 height 1
+00020210: 3230 3022 202b 2027 5c6e 270a 2020 2020  200" + '\n'.    
+00020220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020230: 2020 2020 2020 2020 2276 6965 7720 6f72          "view or
+00020240: 6965 6e74 2220 2b20 275c 6e27 0a20 2020  ient" + '\n'.   
+00020250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020260: 2020 2020 2020 2020 2022 7475 726e 2078           "turn x
+00020270: 2039 3022 202b 2027 5c6e 270a 2020 2020   90" + '\n'.    
+00020280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020290: 2020 2020 2020 2020 2274 7572 6e20 7a20          "turn z 
+000202a0: 3930 2220 2b20 275c 6e27 0a20 2020 2020  90" + '\n'.     
+000202b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202c0: 2020 2020 2020 2022 7669 6577 2063 6f66         "view cof
+000202d0: 7220 5472 7565 2220 2b20 275c 6e27 0a20  r True" + '\n'. 
+000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202f0: 2020 2020 2020 2020 2020 2022 7361 7665             "save
+00020300: 2022 202b 2073 7472 2873 7572 6661 6365   " + str(surface
+00020310: 666e 2920 2b20 225f 7966 6974 7375 7266  fn) + "_yfitsurf
+00020320: 6163 652e 6a70 6567 2220 2b20 2220 7375  ace.jpeg" + " su
+00020330: 7065 7273 616d 706c 6520 3320 7769 6474  persample 3 widt
+00020340: 6820 3132 3030 2068 6569 6768 7420 3132  h 1200 height 12
+00020350: 3030 2220 2b20 275c 6e27 0a20 2020 2020  00" + '\n'.     
 00020360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020370: 6966 206e 6f74 2062 696e 6469 7370 6c61  if not bindispla
-00020380: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00020390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000203a0: 7562 7072 6f63 6573 732e 6368 6563 6b5f  ubprocess.check_
-000203b0: 6361 6c6c 286c 6f63 4348 494d 4552 4120  call(locCHIMERA 
-000203c0: 2b20 2220 2d2d 6f66 6673 6372 6565 6e20  + " --offscreen 
-000203d0: 2d2d 6e6f 6775 6920 2220 2b20 7365 6c66  --nogui " + self
-000203e0: 2e77 6f72 6b64 6972 202b 2063 6869 6d65  .workdir + chime
-000203f0: 7261 636d 642c 0a20 2020 2020 2020 2020  racmd,.         
-00020400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020370: 2020 2020 2020 2022 636c 6f73 6520 616c         "close al
+00020380: 6c22 202b 2022 5c6e 220a 2020 2020 2020  l" + "\n".      
+00020390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203a0: 2020 2020 2020 2265 7869 7422 0a20 2020        "exit".   
+000203b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000203d0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+000203e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000203f0: 2020 2020 2020 2020 6966 206e 6f74 2062          if not b
+00020400: 696e 6469 7370 6c61 793a 0a20 2020 2020  indisplay:.     
 00020410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020420: 2020 2020 2020 2020 2063 7764 3d73 656c           cwd=sel
-00020430: 662e 776f 726b 6469 722c 2073 6865 6c6c  f.workdir, shell
-00020440: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00020450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020460: 2020 2070 7269 6e74 2827 436f 6c6f 7265     print('Colore
-00020470: 6420 6d6f 6465 6c73 2077 6572 6520 7072  d models were pr
-00020480: 6f64 7563 6564 2e27 290a 2020 2020 2020  oduced.').      
+00020420: 2020 2020 2020 2073 7562 7072 6f63 6573         subproces
+00020430: 732e 6368 6563 6b5f 6361 6c6c 286c 6f63  s.check_call(loc
+00020440: 4348 494d 4552 4120 2b20 2220 2d2d 6f66  CHIMERA + " --of
+00020450: 6673 6372 6565 6e20 2d2d 6e6f 6775 6920  fscreen --nogui 
+00020460: 2220 2b20 7365 6c66 2e77 6f72 6b64 6972  " + self.workdir
+00020470: 202b 2063 6869 6d65 7261 636d 642c 0a20   + chimeracmd,. 
+00020480: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000204b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204c0: 2020 2020 7375 6270 726f 6365 7373 2e63      subprocess.c
-000204d0: 6865 636b 5f63 616c 6c28 6c6f 6343 4849  heck_call(locCHI
-000204e0: 4d45 5241 202b 2022 2022 202b 2073 656c  MERA + " " + sel
-000204f0: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
-00020500: 6572 6163 6d64 2c20 6377 643d 7365 6c66  eracmd, cwd=self
-00020510: 2e77 6f72 6b64 6972 2c0a 2020 2020 2020  .workdir,.      
-00020520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204b0: 2063 7764 3d73 656c 662e 776f 726b 6469   cwd=self.workdi
+000204c0: 722c 2073 6865 6c6c 3d54 7275 6529 0a20  r, shell=True). 
+000204d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000204f0: 2827 436f 6c6f 7265 6420 6d6f 6465 6c73  ('Colored models
+00020500: 2077 6572 6520 7072 6f64 7563 6564 2e27   were produced.'
+00020510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020520: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 00020530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020540: 2020 2020 2020 2020 2020 2020 7368 656c              shel
-00020550: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-00020560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020570: 2020 2020 7072 696e 7428 2743 6f6c 6f72      print('Color
-00020580: 6564 206d 6f64 656c 7320 7765 7265 2070  ed models were p
-00020590: 726f 6475 6365 642e 2729 0a20 2020 2020  roduced.').     
-000205a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000205b0: 7863 6570 7420 7375 6270 726f 6365 7373  xcept subprocess
-000205c0: 2e43 616c 6c65 6450 726f 6365 7373 4572  .CalledProcessEr
-000205d0: 726f 7220 6173 2073 7562 6572 723a 0a20  ror as suberr:. 
+00020540: 2020 2020 2020 2020 2020 2020 7375 6270              subp
+00020550: 726f 6365 7373 2e63 6865 636b 5f63 616c  rocess.check_cal
+00020560: 6c28 6c6f 6343 4849 4d45 5241 202b 2022  l(locCHIMERA + "
+00020570: 2022 202b 2073 656c 662e 776f 726b 6469   " + self.workdi
+00020580: 7220 2b20 6368 696d 6572 6163 6d64 2c20  r + chimeracmd, 
+00020590: 6377 643d 7365 6c66 2e77 6f72 6b64 6972  cwd=self.workdir
+000205a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000205b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205d0: 2020 2020 7368 656c 6c3d 5472 7565 290a      shell=True).
 000205e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205f0: 2020 2020 2020 2065 7272 203d 2027 5361         err = 'Sa
-00020600: 7669 6e67 206d 6f64 656c 207b 7d20 6669  ving model {} fi
-00020610: 7420 7375 7266 6163 6520 7669 6577 2065  t surface view e
-00020620: 7272 6f72 3a20 7b7d 2e27 2e66 6f72 6d61  rror: {}.'.forma
-00020630: 7428 6d6f 6465 6c6e 616d 652c 2073 7562  t(modelname, sub
-00020640: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-00020650: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00020660: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
-00020670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020680: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
-00020690: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
-000206a0: 275c 6e27 290a 0a20 2020 2020 2020 2020  '\n')..         
-000206b0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000206c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000206d0: 2020 2020 2020 2020 7365 6c66 2e73 6361          self.sca
-000206e0: 6c65 5f73 7572 6661 6365 7669 6577 2829  le_surfaceview()
-000206f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020700: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00020710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020720: 2020 2020 2065 7272 203d 2027 5363 616c       err = 'Scal
-00020730: 696e 6720 6d6f 6465 6c20 6669 7420 7375  ing model fit su
-00020740: 7266 6163 6520 7669 6577 2065 7272 6f72  rface view error
-00020750: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 7379  : {}.'.format(sy
-00020760: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
-00020770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020780: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
-00020790: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
-000207a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000207b0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-000207c0: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
-000207d0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-000207e0: 2020 2020 2020 206a 7065 6773 203d 2067         jpegs = g
-000207f0: 6c6f 622e 676c 6f62 2873 656c 662e 776f  lob.glob(self.wo
-00020800: 726b 6469 7220 2b20 272f 2a73 7572 6661  rkdir + '/*surfa
-00020810: 6365 2e6a 7065 6727 290a 2020 2020 2020  ce.jpeg').      
-00020820: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00020830: 6465 6c73 7572 6620 3d20 6469 6374 2829  delsurf = dict()
-00020840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020850: 2020 2020 2066 696e 616c 6d6d 6469 6374       finalmmdict
-00020860: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-00020870: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020880: 2073 656c 662e 6d6f 6465 6c73 3a0a 2020   self.models:.  
-00020890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208a0: 2020 2020 2020 666f 7220 6d6f 6465 6c20        for model 
-000208b0: 696e 2073 656c 662e 6d6f 6465 6c73 3a0a  in self.models:.
-000208c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208d0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-000208e0: 6c6e 616d 6520 3d20 6f73 2e70 6174 682e  lname = os.path.
-000208f0: 6261 7365 6e61 6d65 286d 6f64 656c 2e66  basename(model.f
-00020900: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00020910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020920: 2020 2020 2073 7572 6661 6365 666e 203d       surfacefn =
-00020930: 2027 7b7d 5f7b 7d27 2e66 6f72 6d61 7428   '{}_{}'.format(
-00020940: 6d6f 6465 6c6e 616d 652c 2073 656c 662e  modelname, self.
-00020950: 6d61 706e 616d 6529 0a20 2020 2020 2020  mapname).       
-00020960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020970: 2020 2020 206d 6f64 656c 6d61 7073 7572       modelmapsur
-00020980: 6661 6365 203d 2064 6963 7428 290a 2020  face = dict().  
-00020990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209a0: 2020 2020 2020 2020 2020 666f 7220 6a70            for jp
-000209b0: 6567 2069 6e20 6a70 6567 733a 0a20 2020  eg in jpegs:.   
-000209c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000209e0: 6d6f 6465 6c6e 616d 6520 696e 206a 7065  modelname in jpe
-000209f0: 6720 616e 6420 2778 6669 7473 7572 6661  g and 'xfitsurfa
-00020a00: 6365 2720 696e 206a 7065 673a 0a20 2020  ce' in jpeg:.   
-00020a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00020600: 7428 2743 6f6c 6f72 6564 206d 6f64 656c  t('Colored model
+00020610: 7320 7765 7265 2070 726f 6475 6365 642e  s were produced.
+00020620: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00020630: 2020 2020 2020 2065 7863 6570 7420 7375         except su
+00020640: 6270 726f 6365 7373 2e43 616c 6c65 6450  bprocess.CalledP
+00020650: 726f 6365 7373 4572 726f 7220 6173 2073  rocessError as s
+00020660: 7562 6572 723a 0a20 2020 2020 2020 2020  uberr:.         
+00020670: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00020680: 7272 203d 2027 5361 7669 6e67 206d 6f64  rr = 'Saving mod
+00020690: 656c 207b 7d20 6669 7420 7375 7266 6163  el {} fit surfac
+000206a0: 6520 7669 6577 2065 7272 6f72 3a20 7b7d  e view error: {}
+000206b0: 2e27 2e66 6f72 6d61 7428 6d6f 6465 6c6e  .'.format(modeln
+000206c0: 616d 652c 2073 7562 6572 7229 0a20 2020  ame, suberr).   
+000206d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206e0: 2020 2020 2065 7272 6c69 7374 2e61 7070       errlist.app
+000206f0: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
+00020700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020710: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
+00020720: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
+00020730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020740: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00020750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020760: 7365 6c66 2e73 6361 6c65 5f73 7572 6661  self.scale_surfa
+00020770: 6365 7669 6577 2829 0a20 2020 2020 2020  ceview().       
+00020780: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00020790: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+000207a0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+000207b0: 203d 2027 5363 616c 696e 6720 6d6f 6465   = 'Scaling mode
+000207c0: 6c20 6669 7420 7375 7266 6163 6520 7669  l fit surface vi
+000207d0: 6577 2065 7272 6f72 3a20 7b7d 2e27 2e66  ew error: {}.'.f
+000207e0: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
+000207f0: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
+00020800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020810: 2065 7272 6c69 7374 2e61 7070 656e 6428   errlist.append(
+00020820: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+00020830: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00020840: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
+00020850: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
+00020860: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+00020870: 7065 6773 203d 2067 6c6f 622e 676c 6f62  pegs = glob.glob
+00020880: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
+00020890: 272f 2a73 7572 6661 6365 2e6a 7065 6727  '/*surface.jpeg'
+000208a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000208b0: 2020 2020 2020 6d6f 6465 6c73 7572 6620        modelsurf 
+000208c0: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
+000208d0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+000208e0: 616c 6d6d 6469 6374 203d 2064 6963 7428  almmdict = dict(
+000208f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020900: 2020 2020 2020 6966 2073 656c 662e 6d6f        if self.mo
+00020910: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
+00020920: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00020930: 7220 6d6f 6465 6c20 696e 2073 656c 662e  r model in self.
+00020940: 6d6f 6465 6c73 3a0a 2020 2020 2020 2020  models:.        
+00020950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020960: 2020 2020 6d6f 6465 6c6e 616d 6520 3d20      modelname = 
+00020970: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00020980: 286d 6f64 656c 2e66 696c 656e 616d 6529  (model.filename)
+00020990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000209a0: 2020 2020 2020 2020 2020 2020 2073 7572               sur
+000209b0: 6661 6365 666e 203d 2027 7b7d 5f7b 7d27  facefn = '{}_{}'
+000209c0: 2e66 6f72 6d61 7428 6d6f 6465 6c6e 616d  .format(modelnam
+000209d0: 652c 2073 656c 662e 6d61 706e 616d 6529  e, self.mapname)
+000209e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000209f0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+00020a00: 656c 6d61 7073 7572 6661 6365 203d 2064  elmapsurface = d
+00020a10: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
 00020a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a30: 206d 6f64 656c 6d61 7073 7572 6661 6365   modelmapsurface
-00020a40: 5b27 7827 5d20 3d20 7374 7228 7375 7266  ['x'] = str(surf
-00020a50: 6163 6566 6e29 202b 2027 5f73 6361 6c65  acefn) + '_scale
-00020a60: 645f 7866 6974 7375 7266 6163 652e 6a70  d_xfitsurface.jp
-00020a70: 6567 270a 2020 2020 2020 2020 2020 2020  eg'.            
-00020a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a90: 2020 2020 6966 206d 6f64 656c 6e61 6d65      if modelname
-00020aa0: 2069 6e20 6a70 6567 2061 6e64 2027 7966   in jpeg and 'yf
-00020ab0: 6974 7375 7266 6163 6527 2069 6e20 6a70  itsurface' in jp
-00020ac0: 6567 3a0a 2020 2020 2020 2020 2020 2020  eg:.            
-00020ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ae0: 2020 2020 2020 2020 6d6f 6465 6c6d 6170          modelmap
-00020af0: 7375 7266 6163 655b 2779 275d 203d 2073  surface['y'] = s
-00020b00: 7472 2873 7572 6661 6365 666e 2920 2b20  tr(surfacefn) + 
-00020b10: 275f 7363 616c 6564 5f79 6669 7473 7572  '_scaled_yfitsur
-00020b20: 6661 6365 2e6a 7065 6727 0a20 2020 2020  face.jpeg'.     
-00020b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b40: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
-00020b50: 6465 6c6e 616d 6520 696e 206a 7065 6720  delname in jpeg 
-00020b60: 616e 6420 277a 6669 7473 7572 6661 6365  and 'zfitsurface
-00020b70: 2720 696e 206a 7065 673a 0a20 2020 2020  ' in jpeg:.     
-00020b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b90: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00020ba0: 6f64 656c 6d61 7073 7572 6661 6365 5b27  odelmapsurface['
-00020bb0: 7a27 5d20 3d20 7374 7228 7375 7266 6163  z'] = str(surfac
-00020bc0: 6566 6e29 202b 2027 5f73 6361 6c65 645f  efn) + '_scaled_
-00020bd0: 7a66 6974 7375 7266 6163 652e 6a70 6567  zfitsurface.jpeg
-00020be0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00020bf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020c00: 2065 7272 6c69 7374 3a0a 2020 2020 2020   errlist:.      
+00020a30: 2020 666f 7220 6a70 6567 2069 6e20 6a70    for jpeg in jp
+00020a40: 6567 733a 0a20 2020 2020 2020 2020 2020  egs:.           
+00020a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a60: 2020 2020 2069 6620 6d6f 6465 6c6e 616d       if modelnam
+00020a70: 6520 696e 206a 7065 6720 616e 6420 2778  e in jpeg and 'x
+00020a80: 6669 7473 7572 6661 6365 2720 696e 206a  fitsurface' in j
+00020a90: 7065 673a 0a20 2020 2020 2020 2020 2020  peg:.           
+00020aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ab0: 2020 2020 2020 2020 206d 6f64 656c 6d61           modelma
+00020ac0: 7073 7572 6661 6365 5b27 7827 5d20 3d20  psurface['x'] = 
+00020ad0: 7374 7228 7375 7266 6163 6566 6e29 202b  str(surfacefn) +
+00020ae0: 2027 5f73 6361 6c65 645f 7866 6974 7375   '_scaled_xfitsu
+00020af0: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
+00020b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b10: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00020b20: 6f64 656c 6e61 6d65 2069 6e20 6a70 6567  odelname in jpeg
+00020b30: 2061 6e64 2027 7966 6974 7375 7266 6163   and 'yfitsurfac
+00020b40: 6527 2069 6e20 6a70 6567 3a0a 2020 2020  e' in jpeg:.    
+00020b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b70: 6d6f 6465 6c6d 6170 7375 7266 6163 655b  modelmapsurface[
+00020b80: 2779 275d 203d 2073 7472 2873 7572 6661  'y'] = str(surfa
+00020b90: 6365 666e 2920 2b20 275f 7363 616c 6564  cefn) + '_scaled
+00020ba0: 5f79 6669 7473 7572 6661 6365 2e6a 7065  _yfitsurface.jpe
+00020bb0: 6727 0a20 2020 2020 2020 2020 2020 2020  g'.             
+00020bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bd0: 2020 2069 6620 6d6f 6465 6c6e 616d 6520     if modelname 
+00020be0: 696e 206a 7065 6720 616e 6420 277a 6669  in jpeg and 'zfi
+00020bf0: 7473 7572 6661 6365 2720 696e 206a 7065  tsurface' in jpe
+00020c00: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
 00020c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c20: 2020 2020 2020 2020 2020 6d6f 6465 6c73            models
-00020c30: 7572 665b 2765 7272 275d 203d 207b 276d  urf['err'] = {'m
-00020c40: 6f64 656c 5f66 6974 5f65 7272 273a 2065  odel_fit_err': e
-00020c50: 7272 6c69 7374 7d0a 2020 2020 2020 2020  rrlist}.        
-00020c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c70: 2020 2020 6d6f 6465 6c73 7572 665b 6d6f      modelsurf[mo
-00020c80: 6465 6c6e 616d 655d 203d 206d 6f64 656c  delname] = model
-00020c90: 6d61 7073 7572 6661 6365 0a20 2020 2020  mapsurface.     
+00020c20: 2020 2020 2020 206d 6f64 656c 6d61 7073         modelmaps
+00020c30: 7572 6661 6365 5b27 7a27 5d20 3d20 7374  urface['z'] = st
+00020c40: 7228 7375 7266 6163 6566 6e29 202b 2027  r(surfacefn) + '
+00020c50: 5f73 6361 6c65 645f 7a66 6974 7375 7266  _scaled_zfitsurf
+00020c60: 6163 652e 6a70 6567 270a 2020 2020 2020  ace.jpeg'.      
+00020c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c80: 2020 2020 2020 6966 2065 7272 6c69 7374        if errlist
+00020c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 00020ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cb0: 2020 2066 696e 616c 6d6d 6469 6374 5b27     finalmmdict['
-00020cc0: 6d6f 6465 6c66 6974 5f73 7572 6661 6365  modelfit_surface
-00020cd0: 275d 203d 206d 6f64 656c 7375 7266 0a0a  '] = modelsurf..
+00020cb0: 2020 6d6f 6465 6c73 7572 665b 2765 7272    modelsurf['err
+00020cc0: 275d 203d 207b 276d 6f64 656c 5f66 6974  '] = {'model_fit
+00020cd0: 5f65 7272 273a 2065 7272 6c69 7374 7d0a  _err': errlist}.
 00020ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cf0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00020d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d10: 2020 2020 2020 2020 2077 6974 6820 636f           with co
-00020d20: 6465 6373 2e6f 7065 6e28 7365 6c66 2e77  decs.open(self.w
-00020d30: 6f72 6b64 6972 202b 2073 656c 662e 6d61  orkdir + self.ma
-00020d40: 706e 616d 6520 2b20 275f 6d6f 6465 6c66  pname + '_modelf
-00020d50: 6974 7375 7266 6163 6576 6965 772e 6a73  itsurfaceview.js
-00020d60: 6f6e 272c 2027 7727 2c0a 2020 2020 2020  on', 'w',.      
+00020cf0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00020d00: 6c73 7572 665b 6d6f 6465 6c6e 616d 655d  lsurf[modelname]
+00020d10: 203d 206d 6f64 656c 6d61 7073 7572 6661   = modelmapsurfa
+00020d20: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00020d30: 2020 2020 2020 2020 2020 2066 696e 616c             final
+00020d40: 6d6d 6469 6374 5b27 6d6f 6465 6c66 6974  mmdict['modelfit
+00020d50: 5f73 7572 6661 6365 275d 203d 206d 6f64  _surface'] = mod
+00020d60: 656c 7375 7266 0a0a 2020 2020 2020 2020  elsurf..        
 00020d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d90: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
-00020da0: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
-00020db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020dc0: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-00020dd0: 736f 6e2e 6475 6d70 2866 696e 616c 6d6d  son.dump(finalmm
-00020de0: 6469 6374 2c20 6629 0a20 2020 2020 2020  dict, f).       
-00020df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e00: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00020e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e20: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-00020e30: 7772 6974 6528 2753 6176 696e 6720 6d6f  write('Saving mo
-00020e40: 6465 6c20 6669 7420 7375 7266 6163 6520  del fit surface 
-00020e50: 7669 6577 2074 6f20 6a73 6f6e 2065 7272  view to json err
-00020e60: 6f72 3a20 7b7d 2e5c 6e27 2e66 6f72 6d61  or: {}.\n'.forma
-00020e70: 7428 7379 732e 6578 635f 696e 666f 2829  t(sys.exc_info()
-00020e80: 5b31 5d29 290a 0a20 2020 2020 2020 2020  [1]))..         
-00020e90: 2020 2020 2020 2065 6e64 203d 2074 696d         end = tim
-00020ea0: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
-00020eb0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-00020ec0: 2020 2020 7072 696e 7428 274d 6f64 656c      print('Model
-00020ed0: 6669 7473 7572 6661 6365 2074 696d 653a  fitsurface time:
-00020ee0: 2025 7327 2025 2028 656e 6420 2d20 7374   %s' % (end - st
-00020ef0: 6172 7429 290a 2020 2020 2020 2020 2020  art)).          
-00020f00: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
-00020f10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00020f30: 2d27 290a 0a0a 2020 2020 6465 6620 7363  -')...    def sc
-00020f40: 616c 655f 7375 7266 6163 6576 6965 7728  ale_surfaceview(
-00020f50: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00020f60: 2222 0a20 2020 2020 2020 2020 2020 2053  "".            S
-00020f70: 6361 6c65 2074 6865 2073 7572 6661 6365  cale the surface
-00020f80: 2076 6965 7720 696d 6167 6573 2073 697a   view images siz
-00020f90: 6520 746f 2033 3030 5833 3030 0a0a 2020  e to 300X300..  
-00020fa0: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
-00020fb0: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
-00020fc0: 0a20 2020 2020 2020 2023 2069 6d70 6f72  .        # impor
-00020fd0: 7420 696d 6167 6569 6f0a 2020 2020 2020  t imageio.      
-00020fe0: 2020 696d 706f 7274 2067 6c6f 620a 0a20    import glob.. 
-00020ff0: 2020 2020 2020 2066 6f72 2069 6d67 6669         for imgfi
-00021000: 6c65 2069 6e20 676c 6f62 2e67 6c6f 6228  le in glob.glob(
-00021010: 7365 6c66 2e77 6f72 6b64 6972 202b 2027  self.workdir + '
-00021020: 2a73 7572 6661 6365 2e6a 7065 6727 293a  *surface.jpeg'):
-00021030: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00021040: 2773 6361 6c65 6427 206e 6f74 2069 6e20  'scaled' not in 
-00021050: 696d 6766 696c 653a 0a20 2020 2020 2020  imgfile:.       
-00021060: 2020 2020 2020 2020 206e 616d 656c 6973           namelis
-00021070: 7420 3d20 696d 6766 696c 652e 7370 6c69  t = imgfile.spli
-00021080: 7428 272f 2729 5b2d 315d 2e73 706c 6974  t('/')[-1].split
-00021090: 2827 5f27 290a 2020 2020 2020 2020 2020  ('_').          
-000210a0: 2020 2020 2020 6e61 6d65 6f6e 6520 3d20        nameone = 
-000210b0: 275f 272e 6a6f 696e 286e 616d 656c 6973  '_'.join(namelis
-000210c0: 745b 3a2d 315d 290a 2020 2020 2020 2020  t[:-1]).        
-000210d0: 2020 2020 2020 2020 6e61 6d65 7477 6f20          nametwo 
-000210e0: 3d20 6e61 6d65 6c69 7374 5b2d 315d 0a20  = namelist[-1]. 
-000210f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00021100: 7069 6d67 203d 2049 6d61 6765 2e6f 7065  pimg = Image.ope
-00021110: 6e28 696d 6766 696c 6529 0a20 2020 2020  n(imgfile).     
-00021120: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
-00021130: 6e70 696d 672e 7265 7369 7a65 2828 3330  npimg.resize((30
-00021140: 302c 2033 3030 2929 0a20 2020 2020 2020  0, 300)).       
-00021150: 2020 2020 2020 2020 2069 6d2e 7361 7665           im.save
-00021160: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
-00021170: 6e61 6d65 6f6e 6520 2b20 275f 7363 616c  nameone + '_scal
-00021180: 6564 5f27 202b 206e 616d 6574 776f 290a  ed_' + nametwo).
-00021190: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000211a0: 4e6f 6e65 0a0a 2020 2020 6465 6620 7363  None..    def sc
-000211b0: 616c 655f 6d61 736b 696d 6728 7365 6c66  ale_maskimg(self
-000211c0: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
-000211d0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-000211e0: 204e 6f6e 650a 2020 2020 2020 2020 2222   None.        ""
-000211f0: 220a 0a20 2020 2020 2020 2023 2069 6d70  "..        # imp
-00021200: 6f72 7420 696d 6167 6569 6f0a 2020 2020  ort imageio.    
-00021210: 2020 2020 696d 706f 7274 2067 6c6f 620a      import glob.
-00021220: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-00021230: 6669 6c65 2069 6e20 676c 6f62 2e67 6c6f  file in glob.glo
-00021240: 6228 7365 6c66 2e77 6f72 6b64 6972 202b  b(self.workdir +
-00021250: 2027 2a6d 6173 6b76 6965 772e 6a70 6567   '*maskview.jpeg
-00021260: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00021270: 6966 2027 7363 616c 6564 2720 6e6f 7420  if 'scaled' not 
-00021280: 696e 2069 6d67 6669 6c65 3a0a 2020 2020  in imgfile:.    
-00021290: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000212a0: 6c69 7374 203d 2069 6d67 6669 6c65 2e73  list = imgfile.s
-000212b0: 706c 6974 2827 2f27 295b 2d31 5d2e 7370  plit('/')[-1].sp
-000212c0: 6c69 7428 275f 2729 0a20 2020 2020 2020  lit('_').       
-000212d0: 2020 2020 2020 2020 206e 616d 656f 6e65           nameone
-000212e0: 203d 2027 5f27 2e6a 6f69 6e28 6e61 6d65   = '_'.join(name
-000212f0: 6c69 7374 5b3a 2d31 5d29 0a20 2020 2020  list[:-1]).     
-00021300: 2020 2020 2020 2020 2020 206e 616d 6574             namet
-00021310: 776f 203d 206e 616d 656c 6973 745b 2d31  wo = namelist[-1
-00021320: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00021330: 2020 6e70 696d 6720 3d20 496d 6167 652e    npimg = Image.
-00021340: 6f70 656e 2869 6d67 6669 6c65 290a 2020  open(imgfile).  
-00021350: 2020 2020 2020 2020 2020 2020 2020 696d                im
-00021360: 203d 206e 7069 6d67 2e72 6573 697a 6528   = npimg.resize(
-00021370: 2833 3030 2c20 3330 3029 290a 2020 2020  (300, 300)).    
-00021380: 2020 2020 2020 2020 2020 2020 696d 2e73              im.s
-00021390: 6176 6528 7365 6c66 2e77 6f72 6b64 6972  ave(self.workdir
-000213a0: 202b 206e 616d 656f 6e65 202b 2027 5f73   + nameone + '_s
-000213b0: 6361 6c65 645f 2720 2b20 6e61 6d65 7477  caled_' + nametw
-000213c0: 6f29 0a0a 2020 2020 2020 2020 7265 7475  o)..        retu
-000213d0: 726e 204e 6f6e 650a 0a0a 2020 2020 6465  rn None...    de
-000213e0: 6620 7a6f 6f6d 696e 2873 656c 662c 696d  f zoomin(self,im
-000213f0: 672c 2066 6163 746f 722c 202a 2a6b 7761  g, factor, **kwa
-00021400: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-00021410: 220a 2020 2020 2020 2020 2020 2020 5a6f  ".            Zo
-00021420: 6f6d 2069 6e20 746f 2074 6865 2073 7572  om in to the sur
-00021430: 6661 6365 2076 6965 7720 696d 6167 6573  face view images
-00021440: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00021450: 696d 673a 2069 6d67 206f 626a 6563 7420  img: img object 
-00021460: 6f66 2069 6e70 7574 0a20 2020 2020 2020  of input.       
-00021470: 203a 7265 7475 726e 3a0a 2020 2020 2020   :return:.      
-00021480: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00021490: 6f6d 2073 6369 7079 2e6e 6469 6d61 6765  om scipy.ndimage
-000214a0: 2069 6d70 6f72 7420 7a6f 6f6d 0a0a 2020   import zoom..  
-000214b0: 2020 2020 2020 682c 2077 203d 2069 6d67        h, w = img
-000214c0: 2e73 6861 7065 5b3a 325d 0a20 2020 2020  .shape[:2].     
-000214d0: 2020 207a 6f6f 6d5f 7475 706c 6520 3d20     zoom_tuple = 
-000214e0: 2866 6163 746f 722c 2920 2a20 3220 2b20  (factor,) * 2 + 
-000214f0: 2831 2c29 202a 2028 696d 672e 6e64 696d  (1,) * (img.ndim
-00021500: 202d 2032 290a 2020 2020 2020 2020 6966   - 2).        if
-00021510: 2066 6163 746f 7220 213d 2031 2e3a 0a20   factor != 1.:. 
-00021520: 2020 2020 2020 2020 2020 2023 2042 6f75             # Bou
-00021530: 6e64 696e 6720 626f 7820 6f66 2074 6865  nding box of the
-00021540: 207a 6f6f 6d65 642d 696e 2072 6567 696f   zoomed-in regio
-00021550: 6e20 7769 7468 696e 2074 6865 2069 6e70  n within the inp
-00021560: 7574 2061 7272 6179 0a20 2020 2020 2020  ut array.       
-00021570: 2020 2020 207a 6820 3d20 696e 7428 6e70       zh = int(np
-00021580: 2e72 6f75 6e64 2868 202f 2066 6163 746f  .round(h / facto
-00021590: 7229 290a 2020 2020 2020 2020 2020 2020  r)).            
-000215a0: 7a77 203d 2069 6e74 286e 702e 726f 756e  zw = int(np.roun
-000215b0: 6428 7720 2f20 6661 6374 6f72 2929 0a20  d(w / factor)). 
-000215c0: 2020 2020 2020 2020 2020 2074 6f70 203d             top =
-000215d0: 2028 6820 2d20 7a68 2920 2f2f 2032 0a20   (h - zh) // 2. 
-000215e0: 2020 2020 2020 2020 2020 206c 6566 7420             left 
-000215f0: 3d20 2877 202d 207a 7729 202f 2f20 320a  = (w - zw) // 2.
-00021600: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00021610: 203d 207a 6f6f 6d28 696d 675b 746f 703a   = zoom(img[top:
-00021620: 746f 7020 2b20 7a68 2c20 6c65 6674 3a6c  top + zh, left:l
-00021630: 6566 7420 2b20 7a77 5d2c 207a 6f6f 6d5f  eft + zw], zoom_
-00021640: 7475 706c 652c 202a 2a6b 7761 7267 7329  tuple, **kwargs)
-00021650: 0a20 2020 2020 2020 2020 2020 2074 7269  .            tri
-00021660: 6d5f 746f 7020 3d20 2828 6f75 742e 7368  m_top = ((out.sh
-00021670: 6170 655b 305d 202d 2068 2920 2f2f 2032  ape[0] - h) // 2
-00021680: 290a 2020 2020 2020 2020 2020 2020 7472  ).            tr
-00021690: 696d 5f6c 6566 7420 3d20 2828 6f75 742e  im_left = ((out.
-000216a0: 7368 6170 655b 315d 202d 2077 2920 2f2f  shape[1] - w) //
-000216b0: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-000216c0: 6f75 7420 3d20 6f75 745b 7472 696d 5f74  out = out[trim_t
-000216d0: 6f70 3a74 7269 6d5f 746f 7020 2b20 682c  op:trim_top + h,
-000216e0: 2074 7269 6d5f 6c65 6674 3a74 7269 6d5f   trim_left:trim_
-000216f0: 6c65 6674 202b 2077 5d0a 0a20 2020 2020  left + w]..     
-00021700: 2020 2023 2049 6620 6661 6374 6f72 203d     # If factor =
-00021710: 3d20 312c 206a 7573 7420 7265 7475 726e  = 1, just return
-00021720: 2074 6865 2069 6e70 7574 2061 7272 6179   the input array
-00021730: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00021740: 2020 2020 2020 2020 2020 206f 7574 203d             out =
-00021750: 2069 6d67 0a0a 2020 2020 2020 2020 7265   img..        re
-00021760: 7475 726e 206f 7574 0a0a 0a20 2020 2040  turn out...    @
-00021770: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-00021780: 2064 6566 2073 7572 6661 6365 5f65 6e76   def surface_env
-00021790: 6368 6563 6b28 293a 0a20 2020 2020 2020  check():.       
-000217a0: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
-000217b0: 2020 4368 6563 6b20 7468 6520 7275 6e6e    Check the runn
-000217c0: 696e 6720 656e 7669 726f 6e6d 656e 7420  ing environment 
-000217d0: 666f 7220 7375 7266 6163 6520 7669 6577  for surface view
-000217e0: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-000217f0: 2074 6865 206d 6163 6869 6e65 2069 7320   the machine is 
-00021800: 6865 6164 6c65 7373 2c20 7265 6d69 6e64  headless, remind
-00021810: 2074 6865 2075 7365 7220 7674 6b20 6f72   the user vtk or
-00021820: 2043 6869 6d65 7261 2068 6176 6520 746f   Chimera have to
-00021830: 2062 6520 6275 696c 6420 696e 2074 6865   be build in the
-00021840: 2068 6561 646c 6573 7320 7761 792e 0a20   headless way.. 
-00021850: 2020 2020 2020 2020 2020 2049 6620 7674             If vt
-00021860: 6b20 6361 6e20 6e6f 7420 696d 706f 7274  k can not import
-00021870: 6564 2c20 7472 7920 7573 6520 4368 696d  ed, try use Chim
-00021880: 6572 612e 0a0a 2020 2020 2020 2020 3a72  era...        :r
-00021890: 6574 7572 6e3a 2074 7570 6c65 206f 6620  eturn: tuple of 
-000218a0: 7674 6b70 6163 6b20 616e 6420 6368 696d  vtkpack and chim
-000218b0: 6572 6161 7070 2062 696e 6172 7920 7661  eraapp binary va
-000218c0: 6c75 650a 2020 2020 2020 2020 2222 220a  lue.        """.
-000218d0: 0a20 2020 2020 2020 2064 6973 706c 6179  .        display
-000218e0: 203d 206f 732e 6765 7465 6e76 2827 4449   = os.getenv('DI
-000218f0: 5350 4c41 5927 290a 2020 2020 2020 2020  SPLAY').        
-00021900: 6966 2064 6973 706c 6179 2069 7320 4e6f  if display is No
-00021910: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00021920: 7072 696e 7428 2759 6f75 206d 6179 2072  print('You may r
-00021930: 756e 6e69 6e67 2074 6869 7320 7072 6f67  unning this prog
-00021940: 7261 6d20 6f6e 2061 2068 6561 646c 6573  ram on a headles
-00021950: 7320 6d61 6368 696e 652e 2050 6c65 6173  s machine. Pleas
-00021960: 6520 6d61 6b65 2073 7572 6520 6569 7468  e make sure eith
-00021970: 6572 2068 6561 646c 6573 7320 5654 4b20  er headless VTK 
-00021980: 6f72 2068 6561 646c 6573 7327 205c 0a20  or headless' \. 
-00021990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219a0: 2027 4368 696d 6572 6158 2061 7265 2070   'ChimeraX are p
-000219b0: 726f 7065 726c 7920 696e 7374 616c 6c65  roperly installe
-000219c0: 6420 6163 636f 7264 696e 676c 792e 2729  d accordingly.')
-000219d0: 0a0a 2020 2020 2020 2020 7674 6b70 6163  ..        vtkpac
-000219e0: 6b20 3d20 4661 6c73 650a 2020 2020 2020  k = False.      
-000219f0: 2020 6368 696d 6572 6161 7070 203d 2046    chimeraapp = F
-00021a00: 616c 7365 0a20 2020 2020 2020 2074 7279  alse.        try
-00021a10: 3a0a 2020 2020 2020 2020 2020 2020 696d  :.            im
-00021a20: 706f 7274 2076 746b 0a20 2020 2020 2020  port vtk.       
-00021a30: 2020 2020 2076 746b 7061 636b 203d 2054       vtkpack = T
-00021a40: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
-00021a50: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
-00021a60: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00021a70: 7374 6465 7272 2e77 7269 7465 2827 5654  stderr.write('VT
-00021a80: 4b20 6973 206e 6f74 2069 6e73 7461 6c6c  K is not install
-00021a90: 6564 206f 7220 696d 706f 7274 6564 2070  ed or imported p
-00021aa0: 726f 7065 726c 792e 2054 7279 696e 6720  roperly. Trying 
-00021ab0: 746f 2075 7365 2043 6869 6d65 7261 5820  to use ChimeraX 
-00021ac0: 746f 2070 726f 6475 6365 2073 7572 6661  to produce surfa
-00021ad0: 6365 2076 6965 7773 2e5c 6e27 290a 0a20  ce views.\n').. 
-00021ae0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00021af0: 2020 2020 2020 2020 6966 2043 4849 4d45          if CHIME
-00021b00: 5241 2069 7320 6e6f 7420 4e6f 6e65 3a0a  RA is not None:.
-00021b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b20: 6368 696d 6572 6161 7070 203d 2043 4849  chimeraapp = CHI
-00021b30: 4d45 5241 0a20 2020 2020 2020 2020 2020  MERA.           
-00021b40: 2020 2020 2070 7269 6e74 2863 6869 6d65       print(chime
-00021b50: 7261 6170 7029 0a20 2020 2020 2020 2020  raapp).         
-00021b60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021b70: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00021b80: 6669 6e64 5f65 7865 6375 7461 626c 6528  find_executable(
-00021b90: 2743 6869 6d65 7261 5827 2920 6973 206e  'ChimeraX') is n
-00021ba0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00021bb0: 2020 2020 2020 2020 6368 696d 6572 6161          chimeraa
-00021bc0: 7070 203d 2066 696e 645f 6578 6563 7574  pp = find_execut
-00021bd0: 6162 6c65 2827 4368 696d 6572 6158 2729  able('ChimeraX')
-00021be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021bf0: 2070 7269 6e74 2863 6869 6d65 7261 6170   print(chimeraap
-00021c00: 7029 0a20 2020 2020 2020 2065 7863 6570  p).        excep
-00021c10: 7420 4173 7365 7274 696f 6e45 7272 6f72  t AssertionError
-00021c20: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00021c30: 7072 696e 7428 2743 6869 6d65 7261 2065  print('Chimera e
-00021c40: 7865 6375 7461 626c 6520 6973 206e 6f74  xecutable is not
-00021c50: 2074 6865 7265 2e27 2c20 6669 6c65 3d73   there.', file=s
-00021c60: 7973 2e73 7464 6572 7229 0a20 2020 2020  ys.stderr).     
-00021c70: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-00021c80: 722e 7772 6974 6528 2743 6869 6d65 7261  r.write('Chimera
-00021c90: 5820 6578 6563 7574 6162 6c65 2069 7320  X executable is 
-00021ca0: 6e6f 7420 7468 6572 652e 5c6e 2729 0a0a  not there.\n')..
-00021cb0: 2020 2020 2020 2020 7265 7475 726e 2076          return v
-00021cc0: 746b 7061 636b 2c20 6368 696d 6572 6161  tkpack, chimeraa
-00021cd0: 7070 0a0a 2020 2020 2320 4465 6e73 6974  pp..    # Densit
-00021ce0: 7920 6469 7374 7269 6275 7469 6f6e 0a20  y distribution. 
-00021cf0: 2020 2023 2040 7072 6f66 696c 650a 2020     # @profile.  
-00021d00: 2020 6465 6620 6d61 7064 656e 7369 7479    def mapdensity
-00021d10: 5f64 6973 7472 6962 7574 696f 6e28 7365  _distribution(se
-00021d20: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00021d30: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00021d40: 6f64 7563 6520 7468 6520 6d61 7020 6465  oduce the map de
-00021d50: 6e73 6974 7920 6469 7374 7269 6275 7469  nsity distributi
-00021d60: 6f6e 0a0a 2020 2020 2020 2020 3a72 6574  on..        :ret
-00021d70: 7572 6e3a 204e 6f6e 650a 2020 2020 2020  urn: None.      
-00021d80: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-00021d90: 6c66 2e64 656e 7369 7479 5f64 6973 7472  lf.density_distr
-00021da0: 6962 7574 696f 6e28 7365 6c66 2e6d 6170  ibution(self.map
-00021db0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00021dc0: 6e20 4e6f 6e65 0a0a 2020 2020 2320 4070  n None..    # @p
-00021dd0: 726f 6669 6c65 0a20 2020 2064 6566 2072  rofile.    def r
-00021de0: 6177 6d61 7064 656e 7369 7479 5f64 6973  awmapdensity_dis
-00021df0: 7472 6962 7574 696f 6e28 7365 6c66 293a  tribution(self):
-00021e00: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00021e10: 2020 2020 2020 2020 2020 5072 6f64 7563            Produc
-00021e20: 6520 7261 7720 6d61 7020 6465 6e73 6974  e raw map densit
-00021e30: 7920 6469 7374 7269 6275 7469 6f6e 0a0a  y distribution..
-00021e40: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-00021e50: 6177 6d61 703a 2052 6177 206d 6170 206f  awmap: Raw map o
-00021e60: 626a 6563 740a 2020 2020 2020 2020 3a72  bject.        :r
-00021e70: 6574 7572 6e3a 204e 6f6e 650a 2020 2020  eturn: None.    
-00021e80: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00021e90: 2069 6620 7365 6c66 2e72 6177 6d61 7020   if self.rawmap 
-00021ea0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00021eb0: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
-00021ec0: 6e73 6974 795f 6469 7374 7269 6275 7469  nsity_distributi
-00021ed0: 6f6e 2873 656c 662e 7261 776d 6170 290a  on(self.rawmap).
-00021ee0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00021ef0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00021f00: 2754 6865 7265 2069 7320 6e6f 2072 6177  'There is no raw
-00021f10: 206d 6170 2066 6f72 2064 656e 7369 7479   map for density
-00021f20: 2064 6973 7472 6962 7574 696f 6e2e 2729   distribution.')
-00021f30: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00021f40: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
-00021f50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021f60: 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020 2020  --------')..    
-00021f70: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00021f80: 0a20 2020 2023 2040 7072 6f66 696c 650a  .    # @profile.
-00021f90: 2020 2020 6465 6620 6465 6e73 6974 795f      def density_
-00021fa0: 6469 7374 7269 6275 7469 6f6e 2873 656c  distribution(sel
-00021fb0: 662c 2064 656e 6d61 703d 4e6f 6e65 293a  f, denmap=None):
-00021fc0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00021fd0: 2020 2020 2020 2020 2020 5072 6f64 7563            Produc
-00021fe0: 6520 6465 6e73 6974 7920 7661 6c75 6520  e density value 
-00021ff0: 6469 7374 7269 6275 7469 6f6e 2069 6e66  distribution inf
-00022000: 6f72 6d61 7469 6f6e 2077 6974 6820 7468  ormation with th
-00022010: 6520 6465 6e73 6974 7920 6d61 7020 696e  e density map in
-00022020: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
-00022030: 2020 2020 2020 2078 2077 6173 2064 6976         x was div
-00022040: 6964 6564 2069 6e74 6f20 3132 3820 6269  ided into 128 bi
-00022050: 6e73 0a20 2020 2020 2020 2020 2020 2079  ns.            y
-00022060: 2077 6173 2073 6361 6c65 6420 6279 206c   was scaled by l
-00022070: 6f67 6172 6974 686d 6963 2031 3020 2866  ogarithmic 10 (f
-00022080: 6f72 2030 2076 616c 7565 2061 6464 2031  or 0 value add 1
-00022090: 2074 6f20 6967 6f6e 7265 2061 7274 6966   to igonre artif
-000220a0: 6163 7473 290a 0a20 2020 2020 2020 203a  acts)..        :
-000220b0: 7061 7261 6d3a 204e 6f6e 650a 2020 2020  param: None.    
-000220c0: 2020 2020 3a72 6574 7572 6e3a 204e 6f6e      :return: Non
-000220d0: 650a 0a20 2020 2020 2020 2022 2222 0a0a  e..        """..
-000220e0: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-000220f0: 7469 6d65 6974 2e64 6566 6175 6c74 5f74  timeit.default_t
-00022100: 696d 6572 2829 0a20 2020 2020 2020 2062  imer().        b
-00022110: 696e 7320 3d20 3132 380a 2020 2020 2020  ins = 128.      
-00022120: 2020 6572 726c 6973 7420 3d20 5b5d 0a20    errlist = []. 
-00022130: 2020 2020 2020 2064 6174 6164 6963 7420         datadict 
-00022140: 3d20 7b7d 0a20 2020 2020 2020 2023 2063  = {}.        # c
-00022150: 7572 6d61 706e 616d 6520 3d20 6f73 2e70  urmapname = os.p
-00022160: 6174 682e 6261 7365 6e61 6d65 2864 656e  ath.basename(den
-00022170: 6d61 702e 6669 6c65 6e61 6d65 290a 2020  map.filename).  
-00022180: 2020 2020 2020 6375 726d 6170 6e61 6d65        curmapname
-00022190: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-000221a0: 616d 6528 6465 6e6d 6170 2e66 756c 6c6e  ame(denmap.fulln
-000221b0: 616d 6529 0a20 2020 2020 2020 2069 6620  ame).        if 
-000221c0: 2772 6177 6d61 7027 2069 6e20 6375 726d  'rawmap' in curm
-000221d0: 6170 6e61 6d65 3a0a 2020 2020 2020 2020  apname:.        
-000221e0: 2020 2020 7461 6720 3d20 2772 6177 6d61      tag = 'rawma
-000221f0: 705f 270a 2020 2020 2020 2020 656c 7365  p_'.        else
-00022200: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
-00022210: 6720 3d20 2727 0a20 2020 2020 2020 2074  g = ''.        t
-00022220: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00022230: 2320 6d61 7064 6174 6120 3d20 7365 6c66  # mapdata = self
-00022240: 2e6d 6170 2e67 6574 4d61 7028 290a 2020  .map.getMap().  
-00022250: 2020 2020 2020 2020 2020 6d61 7064 6174            mapdat
-00022260: 6120 3d20 6465 6e6d 6170 2e64 6174 610a  a = denmap.data.
-00022270: 2020 2020 2020 2020 2020 2020 666c 6174              flat
-00022280: 6d61 7020 3d20 6d61 7064 6174 612e 666c  map = mapdata.fl
-00022290: 6174 7465 6e28 290a 2020 2020 2020 2020  atten().        
-000222a0: 2020 2020 2320 6461 7461 6d6f 6465 203d      # datamode =
-000222b0: 2073 656c 662e 6d61 702e 6865 6164 6572   self.map.header
-000222c0: 5b33 5d0a 2020 2020 2020 2020 2020 2020  [3].            
-000222d0: 6461 7461 6d6f 6465 203d 2073 656c 662e  datamode = self.
-000222e0: 6d61 702e 6865 6164 6572 2e6d 6f64 650a  map.header.mode.
-000222f0: 2020 2020 2020 2020 2020 2020 756e 6971              uniq
-00022300: 7565 732c 2075 6e69 7175 6563 6f75 6e74  ues, uniquecount
-00022310: 7320 3d20 6e70 2e75 6e69 7175 6528 666c  s = np.unique(fl
-00022320: 6174 6d61 702c 2072 6574 7572 6e5f 636f  atmap, return_co
-00022330: 756e 7473 3d54 7275 6529 0a20 2020 2020  unts=True).     
-00022340: 2020 2020 2020 2075 6e69 7175 656c 656e         uniquelen
-00022350: 203d 206c 656e 2875 6e69 7175 6573 290a   = len(uniques).
-00022360: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00022370: 6174 616d 6f64 6520 3d3d 2030 3a0a 2020  atamode == 0:.  
-00022380: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-00022390: 6e73 203d 2075 6e69 7175 6573 0a20 2020  ns = uniques.   
-000223a0: 2020 2020 2020 2020 2020 2020 2068 6973               his
-000223b0: 742c 2062 696e 5f65 6467 6573 203d 206e  t, bin_edges = n
-000223c0: 702e 6869 7374 6f67 7261 6d28 666c 6174  p.histogram(flat
-000223d0: 6d61 702c 2062 696e 733d 6269 6e73 290a  map, bins=bins).
-000223e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000223f0: 2064 6174 616d 6f64 6520 3d3d 2031 206f   datamode == 1 o
-00022400: 7220 6461 7461 6d6f 6465 203d 3d20 363a  r datamode == 6:
-00022410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022420: 2069 6620 756e 6971 7565 6c65 6e20 3e20   if uniquelen > 
-00022430: 3130 3030 3a0a 2020 2020 2020 2020 2020  1000:.          
-00022440: 2020 2020 2020 2020 2020 696e 6473 203d            inds =
-00022450: 206e 702e 6c69 6e73 7061 6365 2830 2c20   np.linspace(0, 
-00022460: 756e 6971 7565 6c65 6e2d 312c 206e 756d  uniquelen-1, num
-00022470: 3d31 3238 2c20 6474 7970 653d 6e70 2e75  =128, dtype=np.u
-00022480: 696e 7431 3629 0a20 2020 2020 2020 2020  int16).         
-00022490: 2020 2020 2020 2020 2020 2062 696e 7320             bins 
-000224a0: 3d20 6e70 2e74 616b 6528 756e 6971 7565  = np.take(unique
-000224b0: 732c 2069 6e64 7329 0a20 2020 2020 2020  s, inds).       
-000224c0: 2020 2020 2020 2020 2020 2020 2068 6973               his
-000224d0: 742c 2062 696e 5f65 6467 6573 203d 206e  t, bin_edges = n
-000224e0: 702e 6869 7374 6f67 7261 6d28 666c 6174  p.histogram(flat
-000224f0: 6d61 702c 2062 696e 733d 6269 6e73 290a  map, bins=bins).
-00022500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022510: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00022520: 2020 2020 2020 2020 2020 6869 7374 203d            hist =
-00022530: 2075 6e69 7175 6563 6f75 6e74 730a 2020   uniquecounts.  
-00022540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022550: 2020 6269 6e5f 6564 6765 7320 3d20 6e70    bin_edges = np
-00022560: 2e61 7070 656e 6428 756e 6971 7565 732c  .append(uniques,
-00022570: 2075 6e69 7175 6573 5b2d 315d 290a 2020   uniques[-1]).  
-00022580: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00022590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000225a0: 6269 6e73 203d 206e 702e 6c69 6e73 7061  bins = np.linspa
-000225b0: 6365 286d 696e 2866 6c61 746d 6170 292c  ce(min(flatmap),
-000225c0: 206d 6178 2866 6c61 746d 6170 292c 2031   max(flatmap), 1
-000225d0: 3238 290a 2020 2020 2020 2020 2020 2020  28).            
-000225e0: 2020 2020 6869 7374 2c20 6269 6e5f 6564      hist, bin_ed
-000225f0: 6765 7320 3d20 6e70 2e68 6973 746f 6772  ges = np.histogr
-00022600: 616d 2866 6c61 746d 6170 2c20 6269 6e73  am(flatmap, bins
-00022610: 3d62 696e 7329 0a20 2020 2020 2020 2020  =bins).         
-00022620: 2020 2023 2068 6973 742c 2062 696e 5f65     # hist, bin_e
-00022630: 6467 6573 203d 206e 702e 6869 7374 6f67  dges = np.histog
-00022640: 7261 6d28 666c 6174 6d61 702c 2062 696e  ram(flatmap, bin
-00022650: 733d 6269 6e73 290a 2020 2020 2020 2020  s=bins).        
-00022660: 2020 2020 6869 7374 5b68 6973 7420 3c20      hist[hist < 
-00022670: 315d 203d 2031 0a20 2020 2020 2020 2020  1] = 1.         
-00022680: 2020 206e 6577 6869 7374 203d 206e 702e     newhist = np.
-00022690: 6c6f 6731 3028 6869 7374 290a 0a20 2020  log10(hist)..   
-000226a0: 2020 2020 2020 2020 2070 6c74 2e66 6967           plt.fig
-000226b0: 7572 6528 6669 6773 697a 653d 2831 302c  ure(figsize=(10,
-000226c0: 2033 2929 0a20 2020 2020 2020 2020 2020   3)).           
-000226d0: 2070 6c74 2e70 6c6f 7428 6e70 2e72 6f75   plt.plot(np.rou
-000226e0: 6e64 2862 696e 5f65 6467 6573 5b3a 2d31  nd(bin_edges[:-1
-000226f0: 5d2c 2031 3029 2e74 6f6c 6973 7428 292c  ], 10).tolist(),
-00022700: 206e 702e 726f 756e 6428 6e65 7768 6973   np.round(newhis
-00022710: 742c 2031 3029 2e74 6f6c 6973 7428 2929  t, 10).tolist())
-00022720: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
-00022730: 2e73 6176 6566 6967 2873 656c 662e 776f  .savefig(self.wo
-00022740: 726b 6469 7220 2b20 272f 2720 2b20 6375  rkdir + '/' + cu
-00022750: 726d 6170 6e61 6d65 202b 2027 5f76 6f78  rmapname + '_vox
-00022760: 656c 5f64 6973 7472 6962 7574 696f 6e2e  el_distribution.
-00022770: 706e 6727 290a 2020 2020 2020 2020 2020  png').          
-00022780: 2020 706c 742e 636c 6f73 6528 290a 0a20    plt.close().. 
-00022790: 2020 2020 2020 2020 2020 206d 6f64 6520             mode 
-000227a0: 3d20 6e70 2e72 6f75 6e64 2862 696e 5f65  = np.round(bin_e
-000227b0: 6467 6573 5b3a 2d31 5d5b 6e70 2e61 7267  dges[:-1][np.arg
-000227c0: 6d61 7828 6e65 7768 6973 7429 5d2c 2035  max(newhist)], 5
-000227d0: 292e 746f 6c69 7374 2829 0a20 2020 2020  ).tolist().     
-000227e0: 2020 2020 2020 2064 6174 6164 6963 7420         datadict 
-000227f0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00022800: 2020 2020 7461 6720 2b20 2764 656e 7369      tag + 'densi
-00022810: 7479 5f64 6973 7472 6962 7574 696f 6e27  ty_distribution'
-00022820: 3a20 7b27 7927 3a20 6e70 2e72 6f75 6e64  : {'y': np.round
-00022830: 286e 6577 6869 7374 2c20 3130 292e 746f  (newhist, 10).to
-00022840: 6c69 7374 2829 2c0a 2020 2020 2020 2020  list(),.        
-00022850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022870: 2027 7827 3a20 6e70 2e72 6f75 6e64 2862   'x': np.round(b
-00022880: 696e 5f65 6467 6573 5b3a 2d31 5d2c 2031  in_edges[:-1], 1
-00022890: 3029 2e74 6f6c 6973 7428 292c 0a20 2020  0).tolist(),.   
-000228a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000228c0: 2020 2020 2020 276d 6f64 6527 3a20 6d6f        'mode': mo
-000228d0: 6465 7d7d 0a20 2020 2020 2020 2065 7863  de}}.        exc
-000228e0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-000228f0: 2065 7272 203d 2027 4465 6e73 6974 7920   err = 'Density 
-00022900: 6469 7374 7269 6275 7469 6f6e 2065 7272  distribution err
-00022910: 6f72 3a7b 7d2e 272e 666f 726d 6174 2873  or:{}.'.format(s
-00022920: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
-00022930: 290a 2020 2020 2020 2020 2020 2020 6572  ).            er
-00022940: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
-00022950: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
-00022960: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
-00022970: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
-00022980: 2020 2020 6966 2065 7272 6c69 7374 3a0a      if errlist:.
-00022990: 2020 2020 2020 2020 2020 2020 6461 7461              data
-000229a0: 6469 6374 203d 207b 7461 6720 2b20 2764  dict = {tag + 'd
-000229b0: 656e 7369 7479 5f64 6973 7472 6962 7574  ensity_distribut
-000229c0: 696f 6e27 3a20 7b27 6572 7227 3a20 7b27  ion': {'err': {'
-000229d0: 6465 6e73 6974 795f 6469 7374 7269 6275  density_distribu
-000229e0: 7469 6f6e 5f65 7272 6f72 273a 2065 7272  tion_error': err
-000229f0: 6c69 7374 7d7d 7d0a 0a20 2020 2020 2020  list}}}..       
-00022a00: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00022a10: 2020 7769 7468 2063 6f64 6563 732e 6f70    with codecs.op
-00022a20: 656e 2873 656c 662e 776f 726b 6469 7220  en(self.workdir 
-00022a30: 2b20 6375 726d 6170 6e61 6d65 202b 2027  + curmapname + '
-00022a40: 5f64 656e 7369 7479 5f64 6973 7472 6962  _density_distrib
-00022a50: 7574 696f 6e2e 6a73 6f6e 272c 2027 7727  ution.json', 'w'
-00022a60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00022a70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00022a80: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
-00022a90: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-00022aa0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
-00022ab0: 2864 6174 6164 6963 742c 2066 290a 2020  (datadict, f).  
-00022ac0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00022ad0: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-00022ae0: 6465 7272 2e77 7269 7465 2827 5361 7669  derr.write('Savi
-00022af0: 6e67 2064 656e 6973 7479 2064 6973 7472  ng denisty distr
-00022b00: 6962 7574 696f 6e20 746f 206a 736f 6e20  ibution to json 
-00022b10: 6572 726f 722e 2729 0a0a 2020 2020 2020  error.')..      
-00022b20: 2020 656e 6420 3d20 7469 6d65 6974 2e64    end = timeit.d
-00022b30: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
-00022b40: 2020 2020 2020 2070 7269 6e74 2874 6167         print(tag
-00022b50: 202b 2027 4465 6e73 6974 7920 6469 7374   + 'Density dist
-00022b60: 7269 6275 7469 6f6e 2074 696d 653a 2025  ribution time: %
-00022b70: 7327 2025 2028 656e 6420 2d20 7374 6172  s' % (end - star
-00022b80: 7429 290a 2020 2020 2020 2020 7072 696e  t)).        prin
-00022b90: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
-00022ba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00022bb0: 2d2d 2d2d 2d2d 2d27 290a 0a20 2020 2020  -------')..     
-00022bc0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
-00022bd0: 2020 2020 2320 4174 6f6d 2061 6e64 2072      # Atom and r
-00022be0: 6573 6964 7565 2069 6e63 6c75 6473 696f  esidue includsio
-00022bf0: 6e0a 2020 2020 4073 7461 7469 636d 6574  n.    @staticmet
-00022c00: 686f 640a 2020 2020 6465 6620 5f5f 666c  hod.    def __fl
-00022c10: 6f61 746f 6865 7828 6e75 6d6c 6973 7429  oatohex(numlist)
-00022c20: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
-00022c30: 2020 2020 2020 2020 2020 2050 726f 6475             Produ
-00022c40: 6365 2068 6578 2063 6f6c 6f72 2062 6574  ce hex color bet
-00022c50: 7765 656e 2072 6564 2061 6e64 2067 7265  ween red and gre
-00022c60: 656e 0a0a 2020 2020 2020 2020 3a70 6172  en..        :par
-00022c70: 616d 206e 756d 6c69 7374 3a20 4120 6c69  am numlist: A li
-00022c80: 7374 206f 6620 5247 4220 7661 6c75 6573  st of RGB values
-00022c90: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00022ca0: 3a20 4120 6c69 7374 206f 6620 6865 7820  : A list of hex 
-00022cb0: 7661 6c75 6520 6265 7477 6565 6e20 5220  value between R 
-00022cc0: 616e 6420 4720 7769 7468 2042 203d 2030  and G with B = 0
-00022cd0: 0a0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00022ce0: 2020 2020 2020 2023 2072 6762 7320 3d20         # rgbs = 
-00022cf0: 5b5b 696e 7428 2831 202d 206e 756d 2920  [[int((1 - num) 
-00022d00: 2a20 3235 3529 2c20 696e 7428 6e75 6d20  * 255), int(num 
-00022d10: 2a20 3235 3529 2c20 305d 2066 6f72 206e  * 255), 0] for n
-00022d20: 756d 2069 6e20 6e75 6d6c 6973 745d 0a20  um in numlist]. 
-00022d30: 2020 2020 2020 2023 2072 6762 7320 3d20         # rgbs = 
-00022d40: 5b5b 696e 7428 2831 202d 206e 756d 2920  [[int((1 - num) 
-00022d50: 2a20 3235 3529 2a30 2e35 2c20 3132 302c  * 255)*0.5, 120,
-00022d60: 2069 6e74 286e 756d 202a 2032 3535 292a   int(num * 255)*
-00022d70: 302e 355d 2066 6f72 206e 756d 2069 6e20  0.5] for num in 
-00022d80: 6e75 6d6c 6973 745d 0a20 2020 2020 2020  numlist].       
-00022d90: 206e 756d 6c69 7374 203d 205b 2d31 2069   numlist = [-1 i
-00022da0: 6620 6920 3c20 3020 656c 7365 2069 2066  f i < 0 else i f
-00022db0: 6f72 2069 2069 6e20 6e75 6d6c 6973 745d  or i in numlist]
-00022dc0: 0a20 2020 2020 2020 2072 6762 7320 3d20  .        rgbs = 
-00022dd0: 5b5b 3132 322c 2069 6e74 286e 756d 202a  [[122, int(num *
-00022de0: 2032 3535 292c 2069 6e74 286e 756d 202a   255), int(num *
-00022df0: 2032 3535 295d 2069 6620 6e75 6d20 3e3d   255)] if num >=
-00022e00: 2030 2065 6c73 6520 5b32 3535 2c20 302c   0 else [255, 0,
-00022e10: 2032 3535 5d20 666f 7220 6e75 6d20 696e   255] for num in
-00022e20: 206e 756d 6c69 7374 5d0a 2020 2020 2020   numlist].      
-00022e30: 2020 7265 7375 6c74 6c69 7374 203d 205b    resultlist = [
-00022e40: 2723 2530 3258 2530 3258 2530 3258 2720  '#%02X%02X%02X' 
-00022e50: 2520 2872 6762 5b30 5d2c 2072 6762 5b31  % (rgb[0], rgb[1
-00022e60: 5d2c 2072 6762 5b32 5d29 2066 6f72 2072  ], rgb[2]) for r
-00022e70: 6762 2069 6e20 7267 6273 5d0a 0a20 2020  gb in rgbs]..   
-00022e80: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-00022e90: 6c74 6c69 7374 0a0a 2020 2020 2320 4174  ltlist..    # At
-00022ea0: 6f6d 2061 6e64 2072 6573 6964 7565 2069  om and residue i
-00022eb0: 6e63 6c75 6473 696f 6e0a 2020 2020 4073  ncludsion.    @s
-00022ec0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00022ed0: 6465 6620 5f5f 666c 6f61 746f 6865 785f  def __floatohex_
-00022ee0: 6162 6f76 656f 6e65 286e 756d 6c69 7374  aboveone(numlist
-00022ef0: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
-00022f00: 2020 2020 2020 2020 2020 2020 5072 6f64              Prod
-00022f10: 7563 6520 6865 7820 636f 6c6f 7220 6265  uce hex color be
-00022f20: 7477 6565 6e20 7265 6420 616e 6420 6772  tween red and gr
-00022f30: 6565 6e0a 0a20 2020 2020 2020 203a 7061  een..        :pa
-00022f40: 7261 6d20 6e75 6d6c 6973 743a 2041 206c  ram numlist: A l
-00022f50: 6973 7420 6f66 2052 4742 2076 616c 7565  ist of RGB value
-00022f60: 730a 2020 2020 2020 2020 3a72 6574 7572  s.        :retur
-00022f70: 6e3a 2041 206c 6973 7420 6f66 2068 6578  n: A list of hex
-00022f80: 2076 616c 7565 2062 6574 7765 656e 2052   value between R
-00022f90: 2061 6e64 2047 2077 6974 6820 4220 3d20   and G with B = 
-00022fa0: 300a 0a20 2020 2020 2020 2022 2222 0a0a  0..        """..
-00022fb0: 2020 2020 2020 2020 2320 7267 6273 203d          # rgbs =
-00022fc0: 205b 5b69 6e74 2828 3120 2d20 6e75 6d29   [[int((1 - num)
-00022fd0: 202a 2032 3535 292c 2069 6e74 286e 756d   * 255), int(num
-00022fe0: 202a 2032 3535 292c 2030 5d20 666f 7220   * 255), 0] for 
-00022ff0: 6e75 6d20 696e 206e 756d 6c69 7374 5d0a  num in numlist].
-00023000: 2020 2020 2020 2020 2320 7267 6273 203d          # rgbs =
-00023010: 205b 5b69 6e74 2828 3120 2d20 6e75 6d29   [[int((1 - num)
-00023020: 202a 2032 3535 292a 302e 352c 2031 3230   * 255)*0.5, 120
-00023030: 2c20 696e 7428 6e75 6d20 2a20 3235 3529  , int(num * 255)
-00023040: 2a30 2e35 5d20 666f 7220 6e75 6d20 696e  *0.5] for num in
-00023050: 206e 756d 6c69 7374 5d0a 2020 2020 2020   numlist].      
-00023060: 2020 6e75 6d6c 6973 7420 3d20 5b2d 3120    numlist = [-1 
-00023070: 6966 2069 203c 2030 2065 6c73 6520 6920  if i < 0 else i 
-00023080: 666f 7220 6920 696e 206e 756d 6c69 7374  for i in numlist
-00023090: 5d0a 2020 2020 2020 2020 7267 6273 203d  ].        rgbs =
-000230a0: 205b 5b69 6e74 286e 756d 202a 2031 3329   [[int(num * 13)
-000230b0: 2c20 302c 2069 6e74 286e 756d 202a 2032  , 0, int(num * 2
-000230c0: 3535 295d 2069 6620 6e75 6d20 3e3d 2030  55)] if num >= 0
-000230d0: 2065 6c73 6520 5b32 3535 2c20 302c 2032   else [255, 0, 2
-000230e0: 3535 5d20 666f 7220 6e75 6d20 696e 206e  55] for num in n
-000230f0: 756d 6c69 7374 5d0a 2020 2020 2020 2020  umlist].        
-00023100: 7265 7375 6c74 6c69 7374 203d 205b 5d0a  resultlist = [].
-00023110: 2020 2020 2020 2020 7265 7375 6c74 6c69          resultli
-00023120: 7374 203d 205b 2723 2530 3258 2530 3258  st = ['#%02X%02X
-00023130: 2530 3258 2720 2520 2872 6762 5b30 5d2c  %02X' % (rgb[0],
-00023140: 2072 6762 5b31 5d2c 2072 6762 5b32 5d29   rgb[1], rgb[2])
-00023150: 2066 6f72 2072 6762 2069 6e20 7267 6273   for rgb in rgbs
-00023160: 5d0a 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
-00023170: 6e20 7265 7375 6c74 6c69 7374 0a0a 2020  n resultlist..  
-00023180: 2020 6465 6620 5f5f 696e 7465 7250 6f6c    def __interPol
-00023190: 6174 696f 6e28 7365 6c66 293a 0a20 2020  ation(self):.   
-000231a0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000231b0: 2020 2020 2020 5573 6320 7363 6970 7920        Usc scipy 
-000231c0: 7265 6775 6c61 7267 7269 6420 696e 7465  regulargrid inte
-000231d0: 7270 6f6c 6174 696f 6e20 6d65 7468 6f64  rpolation method
-000231e0: 2066 6565 6420 7769 7468 2061 6c6c 206d   feed with all m
-000231f0: 6170 7320 696e 666f 0a0a 2020 2020 2020  aps info..      
-00023200: 2020 3a70 6172 616d 206d 6170 3a20 456c    :param map: El
-00023210: 6563 7472 6f6e 2064 656e 7369 7479 206d  ectron density m
-00023220: 6170 2069 6e20 6d72 632f 6d61 7020 666f  ap in mrc/map fo
-00023230: 726d 6174 0a20 2020 2020 2020 203a 7061  rmat.        :pa
-00023240: 7261 6d20 6d6f 6465 6c3a 2050 726f 7465  ram model: Prote
-00023250: 696e 206d 6f64 656c 2069 6e20 6d6d 6369  in model in mmci
-00023260: 6620 666f 726d 6174 0a20 2020 2020 2020  f format.       
-00023270: 203a 7265 7475 726e 3a20 4120 696e 7465   :return: A inte
-00023280: 7270 6f6c 6174 696f 6e20 6675 6e63 7469  rpolation functi
-00023290: 6f6e 0a0a 2020 2020 2020 2020 2222 220a  on..        """.
-000232a0: 0a20 2020 2020 2020 2023 206d 6170 6461  .        # mapda
-000232b0: 7461 203d 2073 656c 662e 6d61 702e 6765  ta = self.map.ge
-000232c0: 744d 6170 2829 0a20 2020 2020 2020 206d  tMap().        m
-000232d0: 6170 6461 7461 203d 2073 656c 662e 6d61  apdata = self.ma
-000232e0: 702e 6461 7461 0a20 2020 2020 2020 2074  p.data.        t
-000232f0: 6d70 6d61 7064 6174 6120 3d20 6e70 2e73  mpmapdata = np.s
-00023300: 7761 7061 7865 7328 6d61 7064 6174 612c  wapaxes(mapdata,
-00023310: 2030 2c20 3229 0a20 2020 2020 2020 2063   0, 2).        c
-00023320: 6c69 6d2c 2062 6c69 6d2c 2061 6c69 6d20  lim, blim, alim 
-00023330: 3d20 6d61 7064 6174 612e 7368 6170 650a  = mapdata.shape.
-00023340: 2020 2020 2020 2020 7820 3d20 7261 6e67          x = rang
-00023350: 6528 616c 696d 290a 2020 2020 2020 2020  e(alim).        
-00023360: 7920 3d20 7261 6e67 6528 626c 696d 290a  y = range(blim).
-00023370: 2020 2020 2020 2020 7a20 3d20 7261 6e67          z = rang
-00023380: 6528 636c 696d 290a 2020 2020 2020 2020  e(clim).        
-00023390: 6d79 696e 7465 7220 3d20 5265 6775 6c61  myinter = Regula
-000233a0: 7247 7269 6449 6e74 6572 706f 6c61 746f  rGridInterpolato
-000233b0: 7228 2878 2c20 792c 207a 292c 2074 6d70  r((x, y, z), tmp
-000233c0: 6d61 7064 6174 6129 0a0a 2020 2020 2020  mapdata)..      
-000233d0: 2020 7265 7475 726e 206d 7969 6e74 6572    return myinter
-000233e0: 0a0a 2020 2020 2320 7665 7273 696f 6e20  ..    # version 
-000233f0: 3120 6279 2075 7369 6e67 2054 454d 5079  1 by using TEMPy
-00023400: 0a20 2020 2064 6566 205f 5f69 6e74 6572  .    def __inter
-00023410: 7468 6972 6428 7365 6c66 293a 0a20 2020  third(self):.   
-00023420: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00023430: 2020 2020 2020 496e 7465 7270 6f6c 6174        Interpolat
-00023440: 6520 6465 6e73 6974 7920 7661 6c75 6520  e density value 
-00023450: 6f66 206f 6e65 2061 746f 6d2c 2069 6620  of one atom, if 
-00023460: 696e 6469 6365 7320 6172 6520 6f6e 2074  indices are on t
-00023470: 6865 2073 616d 6520 706c 616e 6520 7573  he same plane us
-00023480: 6520 6e65 6172 6573 7420 6d65 7468 6f64  e nearest method
-00023490: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-000234a0: 6572 7769 7365 2075 7365 206c 696e 6561  erwise use linea
-000234b0: 720a 0a20 2020 2020 2020 203a 7061 7261  r..        :para
-000234c0: 6d20 6d61 703a 2054 454d 5079 206d 6170  m map: TEMPy map
-000234d0: 2069 6e73 7461 6e63 650a 2020 2020 2020   instance.      
-000234e0: 2020 3a70 6172 616d 206d 6f64 656c 3a20    :param model: 
-000234f0: 5374 7275 6374 7572 6520 696e 7374 616e  Structure instan
-00023500: 6365 2066 726f 6d20 5445 4d50 7920 7061  ce from TEMPy pa
-00023510: 636b 6167 6520 6d6d 6369 6620 7061 7273  ckage mmcif pars
-00023520: 6572 0a20 2020 2020 2020 203a 7265 7475  er.        :retu
-00023530: 726e 3a20 4c69 7374 2063 6f6e 7461 696e  rn: List contain
-00023540: 7320 616c 6c20 6465 6e73 6974 7920 696e  s all density in
-00023550: 7465 7270 6f6c 6174 696f 6e73 206f 6620  terpolations of 
-00023560: 6174 6f6d 7320 6672 6f6d 206d 6f64 656c  atoms from model
-00023570: 0a0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00023580: 2020 2020 2020 206d 7969 6e74 6572 203d         myinter =
-00023590: 2073 656c 662e 5f5f 696e 7465 7250 6f6c   self.__interPol
-000235a0: 6174 696f 6e28 290a 2020 2020 2020 2020  ation().        
-000235b0: 2320 4d69 6768 7420 6861 7669 6e67 206d  # Might having m
-000235c0: 756c 7470 6c65 206d 6f64 656c 730a 2020  ultple models.  
-000235d0: 2020 2020 2020 6d6f 6465 6c73 203d 205b        models = [
-000235e0: 5d0a 2020 2020 2020 2020 6966 2069 7369  ].        if isi
-000235f0: 6e73 7461 6e63 6528 7365 6c66 2e6d 6f64  nstance(self.mod
-00023600: 656c 732c 206c 6973 7429 3a0a 2020 2020  els, list):.    
-00023610: 2020 2020 2020 2020 6d6f 6465 6c73 203d          models =
-00023620: 2073 656c 662e 6d6f 6465 6c73 0a20 2020   self.models.   
-00023630: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00023640: 2020 2020 2020 206d 6f64 656c 732e 6170         models.ap
-00023650: 7065 6e64 2873 656c 662e 6d6f 6465 6c73  pend(self.models
-00023660: 290a 2020 2020 2020 2020 6d61 7020 3d20  ).        map = 
-00023670: 7365 6c66 2e6d 6170 0a20 2020 2020 2020  self.map.       
-00023680: 2063 6f6e 746f 7572 203d 2073 656c 662e   contour = self.
-00023690: 636c 0a20 2020 2020 2020 2023 2052 616e  cl.        # Ran
-000236a0: 6765 206f 6620 636f 6e74 6f75 7220 6c65  ge of contour le
-000236b0: 7665 6c20 7661 6c75 6573 2066 6f72 2073  vel values for s
-000236c0: 6361 6c65 7220 6261 720a 2020 2020 2020  caler bar.      
-000236d0: 2020 2320 546f 646f 3a20 5269 6768 7420    # Todo: Right 
-000236e0: 6e6f 7720 7769 7468 2066 6978 6564 206e  now with fixed n
-000236f0: 756d 6265 7220 6f66 2070 6f69 6e74 7320  umber of points 
-00023700: 6f6e 2062 6f74 6820 7369 6465 7320 6f66  on both sides of
-00023710: 2074 6865 2072 6563 6f6d 6d65 6e64 6564   the recommended
-00023720: 2063 6f6e 746f 7572 206c 6576 656c 2c20   contour level, 
-00023730: 636f 756c 6420 696d 7072 6f76 6520 746f  could improve to
-00023740: 0a20 2020 2020 2020 2023 2054 6f64 6f3a  .        # Todo:
-00023750: 2067 656e 6572 6174 6520 6120 7265 6173   generate a reas
-00023760: 6f6e 6162 6c65 2072 616e 6765 2073 7572  onable range sur
-00023770: 726f 756e 6420 7468 6520 7265 636f 6d6d  round the recomm
-00023780: 656e 6465 6420 636f 6e74 6f75 7220 6c65  ended contour le
-00023790: 7665 6c0a 2020 2020 2020 2020 2320 5365  vel.        # Se
-000237a0: 7474 696e 6720 6120 736d 6172 7465 7220  tting a smarter 
-000237b0: 7261 6e67 6520 6265 7477 6565 6e20 2863  range between (c
-000237c0: 6f6e 746f 7572 2d73 6967 2c63 6f6e 746f  ontour-sig,conto
-000237d0: 7572 2c20 636f 756e 746f 7572 202b 2073  ur, countour + s
-000237e0: 6967 290a 2020 2020 2020 2020 6d61 7073  ig).        maps
-000237f0: 6967 203d 206d 6170 2e73 7464 2829 0a20  ig = map.std(). 
-00023800: 2020 2020 2020 2023 2063 6f6e 746f 7572         # contour
-00023810: 7261 6e67 6520 3d20 6e70 2e63 6f6e 6361  range = np.conca
-00023820: 7465 6e61 7465 2828 6e70 2e6c 696e 7370  tenate((np.linsp
-00023830: 6163 6528 636f 6e74 6f75 7220 2d20 666c  ace(contour - fl
-00023840: 6f61 7428 312e 3520 2a20 6d61 7073 6967  oat(1.5 * mapsig
-00023850: 292c 2063 6f6e 746f 7572 2c20 332c 2065  ), contour, 3, e
-00023860: 6e64 706f 696e 743d 4661 6c73 6529 2c0a  ndpoint=False),.
-00023870: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00023880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023890: 2020 2020 2020 2020 206e 702e 6c69 6e73           np.lins
-000238a0: 7061 6365 2863 6f6e 746f 7572 2c20 636f  pace(contour, co
-000238b0: 6e74 6f75 7220 2b20 666c 6f61 7428 312e  ntour + float(1.
-000238c0: 3520 2a20 6d61 7073 6967 292c 2034 2929  5 * mapsig), 4))
-000238d0: 2c20 6178 6973 3d4e 6f6e 6529 0a20 2020  , axis=None).   
-000238e0: 2020 2020 2023 2063 6f6e 746f 7572 7261       # contourra
-000238f0: 6e67 6520 3d20 6e70 2e63 6f6e 6361 7465  nge = np.concate
-00023900: 6e61 7465 2828 6e70 2e6c 696e 7370 6163  nate((np.linspac
-00023910: 6528 6d61 702e 6d69 6e28 292c 2063 6f6e  e(map.min(), con
-00023920: 746f 7572 2c20 332c 2065 6e64 706f 696e  tour, 3, endpoin
-00023930: 743d 4661 6c73 6529 2c20 6e70 2e6c 696e  t=False), np.lin
-00023940: 7370 6163 6528 636f 6e74 6f75 722c 206d  space(contour, m
-00023950: 6170 2e6d 6178 2829 2c20 3329 292c 2061  ap.max(), 3)), a
-00023960: 7869 733d 4e6f 6e65 290a 2020 2020 2020  xis=None).      
-00023970: 2020 2320 5768 656e 2072 756e 6e69 6e67    # When running
-00023980: 2066 6f72 2045 4d44 4220 6b65 6570 2069   for EMDB keep i
-00023990: 7420 6173 2061 2066 6c65 7869 626c 6520  t as a flexible 
-000239a0: 7261 6e67 6520 666f 7220 6f6e 6564 6570  range for onedep
-000239b0: 206f 7220 6f74 6865 7220 7573 6572 7320   or other users 
-000239c0: 6f6e 6c79 2072 756e 2069 7420 6f6e 6365  only run it once
-000239d0: 2066 6f72 2072 6563 6f6d 6d65 6e64 6564   for recommended
-000239e0: 0a20 2020 2020 2020 2023 2063 6f6e 746f  .        # conto
-000239f0: 7572 206c 6576 656c 3a0a 0a20 2020 2020  ur level:..     
-00023a00: 2020 2023 2069 6620 7365 6c66 2e65 6d64     # if self.emd
-00023a10: 6964 3a0a 2020 2020 2020 2020 2320 2020  id:.        #   
-00023a20: 2020 636f 6e74 6f75 7272 616e 6765 203d    contourrange =
-00023a30: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-00023a40: 286e 702e 6c69 6e73 7061 6365 2863 6f6e  (np.linspace(con
-00023a50: 746f 7572 202d 2066 6c6f 6174 2831 2e35  tour - float(1.5
-00023a60: 202a 206d 6170 7369 6729 2c20 636f 6e74   * mapsig), cont
-00023a70: 6f75 722c 2033 2c20 656e 6470 6f69 6e74  our, 3, endpoint
-00023a80: 3d46 616c 7365 292c 0a20 2020 2020 2020  =False),.       
-00023a90: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00023aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ab0: 2020 2020 2020 6e70 2e6c 696e 7370 6163        np.linspac
-00023ac0: 6528 636f 6e74 6f75 722c 2063 6f6e 746f  e(contour, conto
-00023ad0: 7572 202b 2066 6c6f 6174 2831 2e35 202a  ur + float(1.5 *
-00023ae0: 206d 6170 7369 6729 2c20 3429 292c 2061   mapsig), 4)), a
-00023af0: 7869 733d 4e6f 6e65 290a 2020 2020 2020  xis=None).      
-00023b00: 2020 2320 656c 7365 3a0a 2020 2020 2020    # else:.      
-00023b10: 2020 2320 2020 2020 636f 6e74 6f75 7272    #     contourr
-00023b20: 616e 6765 203d 206e 702e 6173 6172 7261  ange = np.asarra
-00023b30: 7928 5b63 6f6e 746f 7572 5d29 0a0a 2020  y([contour])..  
-00023b40: 2020 2020 2020 636f 6e74 6f75 7272 616e        contourran
-00023b50: 6765 203d 206e 702e 6173 6172 7261 7928  ge = np.asarray(
-00023b60: 5b63 6f6e 746f 7572 5d29 0a20 2020 2020  [contour]).     
-00023b70: 2020 2072 6573 756c 7420 3d20 7b7d 0a20     result = {}. 
-00023b80: 2020 2020 2020 2066 6f72 206d 6f64 656c         for model
-00023b90: 2069 6e20 6d6f 6465 6c73 3a0a 2020 2020   in models:.    
-00023ba0: 2020 2020 2020 2020 616c 6c63 6f6e 746f          allconto
-00023bb0: 7572 7364 6963 7420 3d20 4f72 6465 7265  ursdict = Ordere
-00023bc0: 6444 6963 7428 290a 2020 2020 2020 2020  dDict().        
-00023bd0: 2020 2020 6174 6f6d 6f75 7473 6964 656e      atomoutsiden
-00023be0: 756d 203d 2030 0a20 2020 2020 2020 2020  um = 0.         
-00023bf0: 2020 206d 6f64 656c 6e61 6d65 203d 206d     modelname = m
-00023c00: 6f64 656c 2e66 696c 656e 616d 652e 7370  odel.filename.sp
-00023c10: 6c69 7428 272f 2729 5b2d 315d 0a0a 2020  lit('/')[-1]..  
-00023c20: 2020 2020 2020 2020 2020 6174 6f6d 636f            atomco
-00023c30: 756e 7420 3d20 300a 2020 2020 2020 2020  unt = 0.        
-00023c40: 2020 2020 6368 6169 6e63 6f75 6e74 203d      chaincount =
-00023c50: 2031 0a20 2020 2020 2020 2020 2020 2063   1.            c
-00023c60: 6861 696e 6174 6f6d 7320 3d20 300a 2020  hainatoms = 0.  
-00023c70: 2020 2020 2020 2020 2020 6368 6169 6e61            chaina
-00023c80: 6973 636f 7265 203d 207b 7d0a 2020 2020  iscore = {}.    
-00023c90: 2020 2020 2020 2020 6368 6169 6e61 6920          chainai 
-00023ca0: 3d20 302e 0a0a 2020 2020 2020 2020 2020  = 0...          
-00023cb0: 2020 666f 7220 636f 6e74 6f75 7220 696e    for contour in
-00023cc0: 2063 6f6e 746f 7572 7261 6e67 653a 0a20   contourrange:. 
-00023cd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023ce0: 6e74 6572 706f 6c61 7469 6f6e 7320 3d20  nterpolations = 
-00023cf0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-00023d00: 2020 2061 6c6c 6b65 7973 203d 205b 5d0a     allkeys = [].
-00023d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d20: 616c 6c76 616c 7565 7320 3d20 5b5d 0a20  allvalues = []. 
-00023d30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00023d40: 7265 7265 7369 6420 3d20 300a 2020 2020  reresid = 0.    
-00023d50: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-00023d60: 6861 696e 203d 2027 270a 2020 2020 2020  hain = ''.      
-00023d70: 2020 2020 2020 2020 2020 6169 7072 6563            aiprec
-00023d80: 6861 696e 203d 2027 270a 2020 2020 2020  hain = ''.      
-00023d90: 2020 2020 2020 2020 2020 7072 6572 6573            preres
-00023da0: 203d 2027 270a 2020 2020 2020 2020 2020   = ''.          
-00023db0: 2020 2020 2020 7265 7363 6f75 6e74 203d        rescount =
-00023dc0: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-00023dd0: 2020 2073 756d 6174 6f6d 696e 7465 7262     sumatominterb
-00023de0: 696e 203d 2030 0a20 2020 2020 2020 2020  in = 0.         
-00023df0: 2020 2020 2020 2066 6f72 2061 746f 6d20         for atom 
-00023e00: 696e 206d 6f64 656c 3a0a 2020 2020 2020  in model:.      
-00023e10: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00023e20: 6f6d 636f 756e 7420 2b3d 2031 0a20 2020  omcount += 1.   
-00023e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e40: 2023 2069 6620 2748 2720 6e6f 7420 696e   # if 'H' not in
-00023e50: 2061 746f 6d2e 6174 6f6d 5f6e 616d 653a   atom.atom_name:
-00023e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023e70: 2020 2020 206f 6e65 636f 6f72 203d 205b       onecoor = [
-00023e80: 6174 6f6d 2e78 2c20 6174 6f6d 2e79 2c20  atom.x, atom.y, 
-00023e90: 6174 6f6d 2e7a 5d0a 2020 2020 2020 2020  atom.z].        
-00023ea0: 2020 2020 2020 2020 2020 2020 6f6e 6569              onei
-00023eb0: 6e64 6578 203d 2073 656c 662e 5f5f 6765  ndex = self.__ge
-00023ec0: 7469 6e64 6963 6573 286f 6e65 636f 6f72  tindices(onecoor
-00023ed0: 295b 315d 0a20 2020 2020 2020 2020 2020  )[1].           
-00023ee0: 2020 2020 2020 2020 2069 6620 6f6e 6569           if onei
-00023ef0: 6e64 6578 5b30 5d20 3e20 6d61 702e 785f  ndex[0] > map.x_
-00023f00: 7369 7a65 2829 202d 2031 206f 7220 6f6e  size() - 1 or on
-00023f10: 6569 6e64 6578 5b30 5d20 3c20 3020 6f72  eindex[0] < 0 or
-00023f20: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00023f30: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00023f40: 6e65 696e 6465 785b 315d 203e 206d 6170  neindex[1] > map
-00023f50: 2e79 5f73 697a 6528 2920 2d20 3120 6f72  .y_size() - 1 or
-00023f60: 206f 6e65 696e 6465 785b 315d 203c 2030   oneindex[1] < 0
-00023f70: 206f 7220 5c0a 2020 2020 2020 2020 2020   or \.          
-00023f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f90: 2020 6f6e 6569 6e64 6578 5b32 5d20 3e20    oneindex[2] > 
-00023fa0: 6d61 702e 7a5f 7369 7a65 2829 202d 2031  map.z_size() - 1
-00023fb0: 206f 7220 6f6e 6569 6e64 6578 5b32 5d20   or oneindex[2] 
-00023fc0: 3c20 303a 0a20 2020 2020 2020 2020 2020  < 0:.           
-00023fd0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00023fe0: 696e 7465 7270 6f6c 6174 696f 6e20 3d20  interpolation = 
-00023ff0: 6d61 702e 6d69 6e28 290a 2020 2020 2020  map.min().      
+00020d80: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00020d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020da0: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
+00020db0: 6e28 7365 6c66 2e77 6f72 6b64 6972 202b  n(self.workdir +
+00020dc0: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
+00020dd0: 275f 6d6f 6465 6c66 6974 7375 7266 6163  '_modelfitsurfac
+00020de0: 6576 6965 772e 6a73 6f6e 272c 2027 7727  eview.json', 'w'
+00020df0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00020e20: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
+00020e30: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+00020e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e50: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
+00020e60: 2866 696e 616c 6d6d 6469 6374 2c20 6629  (finalmmdict, f)
+00020e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020e80: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+00020e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020ea0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00020eb0: 2e73 7464 6572 722e 7772 6974 6528 2753  .stderr.write('S
+00020ec0: 6176 696e 6720 6d6f 6465 6c20 6669 7420  aving model fit 
+00020ed0: 7375 7266 6163 6520 7669 6577 2074 6f20  surface view to 
+00020ee0: 6a73 6f6e 2065 7272 6f72 3a20 7b7d 2e5c  json error: {}.\
+00020ef0: 6e27 2e66 6f72 6d61 7428 7379 732e 6578  n'.format(sys.ex
+00020f00: 635f 696e 666f 2829 5b31 5d29 290a 0a20  c_info()[1])).. 
+00020f10: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00020f20: 6e64 203d 2074 696d 6569 742e 6465 6661  nd = timeit.defa
+00020f30: 756c 745f 7469 6d65 7228 290a 2020 2020  ult_timer().    
+00020f40: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00020f50: 7428 274d 6f64 656c 6669 7473 7572 6661  t('Modelfitsurfa
+00020f60: 6365 2074 696d 653a 2025 7327 2025 2028  ce time: %s' % (
+00020f70: 656e 6420 2d20 7374 6172 7429 290a 2020  end - start)).  
+00020f80: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00020f90: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
+00020fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00020fb0: 2d2d 2d2d 2d2d 2d2d 2d27 290a 0a0a 2020  ---------')...  
+00020fc0: 2020 6465 6620 7363 616c 655f 7375 7266    def scale_surf
+00020fd0: 6163 6576 6965 7728 7365 6c66 293a 0a20  aceview(self):. 
+00020fe0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00020ff0: 2020 2020 2020 2053 6361 6c65 2074 6865         Scale the
+00021000: 2073 7572 6661 6365 2076 6965 7720 696d   surface view im
+00021010: 6167 6573 2073 697a 6520 746f 2033 3030  ages size to 300
+00021020: 5833 3030 0a0a 2020 2020 2020 2020 3a72  X300..        :r
+00021030: 6574 7572 6e3a 204e 6f6e 650a 2020 2020  eturn: None.    
+00021040: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00021050: 2023 2069 6d70 6f72 7420 696d 6167 6569   # import imagei
+00021060: 6f0a 2020 2020 2020 2020 696d 706f 7274  o.        import
+00021070: 2067 6c6f 620a 0a20 2020 2020 2020 2066   glob..        f
+00021080: 6f72 2069 6d67 6669 6c65 2069 6e20 676c  or imgfile in gl
+00021090: 6f62 2e67 6c6f 6228 7365 6c66 2e77 6f72  ob.glob(self.wor
+000210a0: 6b64 6972 202b 2027 2a73 7572 6661 6365  kdir + '*surface
+000210b0: 2e6a 7065 6727 293a 0a20 2020 2020 2020  .jpeg'):.       
+000210c0: 2020 2020 2069 6620 2773 6361 6c65 6427       if 'scaled'
+000210d0: 206e 6f74 2069 6e20 696d 6766 696c 653a   not in imgfile:
+000210e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000210f0: 206e 616d 656c 6973 7420 3d20 696d 6766   namelist = imgf
+00021100: 696c 652e 7370 6c69 7428 272f 2729 5b2d  ile.split('/')[-
+00021110: 315d 2e73 706c 6974 2827 5f27 290a 2020  1].split('_').  
+00021120: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00021130: 6d65 6f6e 6520 3d20 275f 272e 6a6f 696e  meone = '_'.join
+00021140: 286e 616d 656c 6973 745b 3a2d 315d 290a  (namelist[:-1]).
+00021150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021160: 6e61 6d65 7477 6f20 3d20 6e61 6d65 6c69  nametwo = nameli
+00021170: 7374 5b2d 315d 0a20 2020 2020 2020 2020  st[-1].         
+00021180: 2020 2020 2020 206e 7069 6d67 203d 2049         npimg = I
+00021190: 6d61 6765 2e6f 7065 6e28 696d 6766 696c  mage.open(imgfil
+000211a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000211b0: 2020 2069 6d20 3d20 6e70 696d 672e 7265     im = npimg.re
+000211c0: 7369 7a65 2828 3330 302c 2033 3030 2929  size((300, 300))
+000211d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000211e0: 2069 6d2e 7361 7665 2873 656c 662e 776f   im.save(self.wo
+000211f0: 726b 6469 7220 2b20 6e61 6d65 6f6e 6520  rkdir + nameone 
+00021200: 2b20 275f 7363 616c 6564 5f27 202b 206e  + '_scaled_' + n
+00021210: 616d 6574 776f 290a 0a20 2020 2020 2020  ametwo)..       
+00021220: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+00021230: 2020 6465 6620 7363 616c 655f 6d61 736b    def scale_mask
+00021240: 696d 6728 7365 6c66 293a 0a20 2020 2020  img(self):.     
+00021250: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00021260: 3a72 6574 7572 6e3a 204e 6f6e 650a 2020  :return: None.  
+00021270: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00021280: 2020 2023 2069 6d70 6f72 7420 696d 6167     # import imag
+00021290: 6569 6f0a 2020 2020 2020 2020 696d 706f  eio.        impo
+000212a0: 7274 2067 6c6f 620a 0a20 2020 2020 2020  rt glob..       
+000212b0: 2066 6f72 2069 6d67 6669 6c65 2069 6e20   for imgfile in 
+000212c0: 676c 6f62 2e67 6c6f 6228 7365 6c66 2e77  glob.glob(self.w
+000212d0: 6f72 6b64 6972 202b 2027 2a6d 6173 6b76  orkdir + '*maskv
+000212e0: 6965 772e 6a70 6567 2729 3a0a 2020 2020  iew.jpeg'):.    
+000212f0: 2020 2020 2020 2020 6966 2027 7363 616c          if 'scal
+00021300: 6564 2720 6e6f 7420 696e 2069 6d67 6669  ed' not in imgfi
+00021310: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00021320: 2020 2020 6e61 6d65 6c69 7374 203d 2069      namelist = i
+00021330: 6d67 6669 6c65 2e73 706c 6974 2827 2f27  mgfile.split('/'
+00021340: 295b 2d31 5d2e 7370 6c69 7428 275f 2729  )[-1].split('_')
+00021350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021360: 206e 616d 656f 6e65 203d 2027 5f27 2e6a   nameone = '_'.j
+00021370: 6f69 6e28 6e61 6d65 6c69 7374 5b3a 2d31  oin(namelist[:-1
+00021380: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00021390: 2020 206e 616d 6574 776f 203d 206e 616d     nametwo = nam
+000213a0: 656c 6973 745b 2d31 5d0a 2020 2020 2020  elist[-1].      
+000213b0: 2020 2020 2020 2020 2020 6e70 696d 6720            npimg 
+000213c0: 3d20 496d 6167 652e 6f70 656e 2869 6d67  = Image.open(img
+000213d0: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+000213e0: 2020 2020 2020 696d 203d 206e 7069 6d67        im = npimg
+000213f0: 2e72 6573 697a 6528 2833 3030 2c20 3330  .resize((300, 30
+00021400: 3029 290a 2020 2020 2020 2020 2020 2020  0)).            
+00021410: 2020 2020 696d 2e73 6176 6528 7365 6c66      im.save(self
+00021420: 2e77 6f72 6b64 6972 202b 206e 616d 656f  .workdir + nameo
+00021430: 6e65 202b 2027 5f73 6361 6c65 645f 2720  ne + '_scaled_' 
+00021440: 2b20 6e61 6d65 7477 6f29 0a0a 2020 2020  + nametwo)..    
+00021450: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00021460: 0a0a 2020 2020 6465 6620 7a6f 6f6d 696e  ..    def zoomin
+00021470: 2873 656c 662c 696d 672c 2066 6163 746f  (self,img, facto
+00021480: 722c 202a 2a6b 7761 7267 7329 3a0a 2020  r, **kwargs):.  
+00021490: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000214a0: 2020 2020 2020 5a6f 6f6d 2069 6e20 746f        Zoom in to
+000214b0: 2074 6865 2073 7572 6661 6365 2076 6965   the surface vie
+000214c0: 7720 696d 6167 6573 0a20 2020 2020 2020  w images.       
+000214d0: 203a 7061 7261 6d20 696d 673a 2069 6d67   :param img: img
+000214e0: 206f 626a 6563 7420 6f66 2069 6e70 7574   object of input
+000214f0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00021500: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00021510: 2020 2020 2020 6672 6f6d 2073 6369 7079        from scipy
+00021520: 2e6e 6469 6d61 6765 2069 6d70 6f72 7420  .ndimage import 
+00021530: 7a6f 6f6d 0a0a 2020 2020 2020 2020 682c  zoom..        h,
+00021540: 2077 203d 2069 6d67 2e73 6861 7065 5b3a   w = img.shape[:
+00021550: 325d 0a20 2020 2020 2020 207a 6f6f 6d5f  2].        zoom_
+00021560: 7475 706c 6520 3d20 2866 6163 746f 722c  tuple = (factor,
+00021570: 2920 2a20 3220 2b20 2831 2c29 202a 2028  ) * 2 + (1,) * (
+00021580: 696d 672e 6e64 696d 202d 2032 290a 2020  img.ndim - 2).  
+00021590: 2020 2020 2020 6966 2066 6163 746f 7220        if factor 
+000215a0: 213d 2031 2e3a 0a20 2020 2020 2020 2020  != 1.:.         
+000215b0: 2020 2023 2042 6f75 6e64 696e 6720 626f     # Bounding bo
+000215c0: 7820 6f66 2074 6865 207a 6f6f 6d65 642d  x of the zoomed-
+000215d0: 696e 2072 6567 696f 6e20 7769 7468 696e  in region within
+000215e0: 2074 6865 2069 6e70 7574 2061 7272 6179   the input array
+000215f0: 0a20 2020 2020 2020 2020 2020 207a 6820  .            zh 
+00021600: 3d20 696e 7428 6e70 2e72 6f75 6e64 2868  = int(np.round(h
+00021610: 202f 2066 6163 746f 7229 290a 2020 2020   / factor)).    
+00021620: 2020 2020 2020 2020 7a77 203d 2069 6e74          zw = int
+00021630: 286e 702e 726f 756e 6428 7720 2f20 6661  (np.round(w / fa
+00021640: 6374 6f72 2929 0a20 2020 2020 2020 2020  ctor)).         
+00021650: 2020 2074 6f70 203d 2028 6820 2d20 7a68     top = (h - zh
+00021660: 2920 2f2f 2032 0a20 2020 2020 2020 2020  ) // 2.         
+00021670: 2020 206c 6566 7420 3d20 2877 202d 207a     left = (w - z
+00021680: 7729 202f 2f20 320a 0a20 2020 2020 2020  w) // 2..       
+00021690: 2020 2020 206f 7574 203d 207a 6f6f 6d28       out = zoom(
+000216a0: 696d 675b 746f 703a 746f 7020 2b20 7a68  img[top:top + zh
+000216b0: 2c20 6c65 6674 3a6c 6566 7420 2b20 7a77  , left:left + zw
+000216c0: 5d2c 207a 6f6f 6d5f 7475 706c 652c 202a  ], zoom_tuple, *
+000216d0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+000216e0: 2020 2020 2074 7269 6d5f 746f 7020 3d20       trim_top = 
+000216f0: 2828 6f75 742e 7368 6170 655b 305d 202d  ((out.shape[0] -
+00021700: 2068 2920 2f2f 2032 290a 2020 2020 2020   h) // 2).      
+00021710: 2020 2020 2020 7472 696d 5f6c 6566 7420        trim_left 
+00021720: 3d20 2828 6f75 742e 7368 6170 655b 315d  = ((out.shape[1]
+00021730: 202d 2077 2920 2f2f 2032 290a 2020 2020   - w) // 2).    
+00021740: 2020 2020 2020 2020 6f75 7420 3d20 6f75          out = ou
+00021750: 745b 7472 696d 5f74 6f70 3a74 7269 6d5f  t[trim_top:trim_
+00021760: 746f 7020 2b20 682c 2074 7269 6d5f 6c65  top + h, trim_le
+00021770: 6674 3a74 7269 6d5f 6c65 6674 202b 2077  ft:trim_left + w
+00021780: 5d0a 0a20 2020 2020 2020 2023 2049 6620  ]..        # If 
+00021790: 6661 6374 6f72 203d 3d20 312c 206a 7573  factor == 1, jus
+000217a0: 7420 7265 7475 726e 2074 6865 2069 6e70  t return the inp
+000217b0: 7574 2061 7272 6179 0a20 2020 2020 2020  ut array.       
+000217c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000217d0: 2020 206f 7574 203d 2069 6d67 0a0a 2020     out = img..  
+000217e0: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+000217f0: 0a0a 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
+00021800: 7468 6f64 0a20 2020 2064 6566 2073 7572  thod.    def sur
+00021810: 6661 6365 5f65 6e76 6368 6563 6b28 293a  face_envcheck():
+00021820: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00021830: 2020 2020 2020 2020 2020 4368 6563 6b20            Check 
+00021840: 7468 6520 7275 6e6e 696e 6720 656e 7669  the running envi
+00021850: 726f 6e6d 656e 7420 666f 7220 7375 7266  ronment for surf
+00021860: 6163 6520 7669 6577 2e0a 2020 2020 2020  ace view..      
+00021870: 2020 2020 2020 4966 2074 6865 206d 6163        If the mac
+00021880: 6869 6e65 2069 7320 6865 6164 6c65 7373  hine is headless
+00021890: 2c20 7265 6d69 6e64 2074 6865 2075 7365  , remind the use
+000218a0: 7220 7674 6b20 6f72 2043 6869 6d65 7261  r vtk or Chimera
+000218b0: 2068 6176 6520 746f 2062 6520 6275 696c   have to be buil
+000218c0: 6420 696e 2074 6865 2068 6561 646c 6573  d in the headles
+000218d0: 7320 7761 792e 0a20 2020 2020 2020 2020  s way..         
+000218e0: 2020 2049 6620 7674 6b20 6361 6e20 6e6f     If vtk can no
+000218f0: 7420 696d 706f 7274 6564 2c20 7472 7920  t imported, try 
+00021900: 7573 6520 4368 696d 6572 612e 0a0a 2020  use Chimera...  
+00021910: 2020 2020 2020 3a72 6574 7572 6e3a 2074        :return: t
+00021920: 7570 6c65 206f 6620 7674 6b70 6163 6b20  uple of vtkpack 
+00021930: 616e 6420 6368 696d 6572 6161 7070 2062  and chimeraapp b
+00021940: 696e 6172 7920 7661 6c75 650a 2020 2020  inary value.    
+00021950: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00021960: 2064 6973 706c 6179 203d 206f 732e 6765   display = os.ge
+00021970: 7465 6e76 2827 4449 5350 4c41 5927 290a  tenv('DISPLAY').
+00021980: 2020 2020 2020 2020 6966 2064 6973 706c          if displ
+00021990: 6179 2069 7320 4e6f 6e65 3a0a 2020 2020  ay is None:.    
+000219a0: 2020 2020 2020 2020 7072 696e 7428 2759          print('Y
+000219b0: 6f75 206d 6179 2072 756e 6e69 6e67 2074  ou may running t
+000219c0: 6869 7320 7072 6f67 7261 6d20 6f6e 2061  his program on a
+000219d0: 2068 6561 646c 6573 7320 6d61 6368 696e   headless machin
+000219e0: 652e 2050 6c65 6173 6520 6d61 6b65 2073  e. Please make s
+000219f0: 7572 6520 6569 7468 6572 2068 6561 646c  ure either headl
+00021a00: 6573 7320 5654 4b20 6f72 2068 6561 646c  ess VTK or headl
+00021a10: 6573 7327 205c 0a20 2020 2020 2020 2020  ess' \.         
+00021a20: 2020 2020 2020 2020 2027 4368 696d 6572           'Chimer
+00021a30: 6158 2061 7265 2070 726f 7065 726c 7920  aX are properly 
+00021a40: 696e 7374 616c 6c65 6420 6163 636f 7264  installed accord
+00021a50: 696e 676c 792e 2729 0a0a 2020 2020 2020  ingly.')..      
+00021a60: 2020 7674 6b70 6163 6b20 3d20 4661 6c73    vtkpack = Fals
+00021a70: 650a 2020 2020 2020 2020 6368 696d 6572  e.        chimer
+00021a80: 6161 7070 203d 2046 616c 7365 0a20 2020  aapp = False.   
+00021a90: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00021aa0: 2020 2020 2020 696d 706f 7274 2076 746b        import vtk
+00021ab0: 0a20 2020 2020 2020 2020 2020 2076 746b  .            vtk
+00021ac0: 7061 636b 203d 2054 7275 650a 2020 2020  pack = True.    
+00021ad0: 2020 2020 6578 6365 7074 2049 6d70 6f72      except Impor
+00021ae0: 7445 7272 6f72 3a0a 2020 2020 2020 2020  tError:.        
+00021af0: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
+00021b00: 7269 7465 2827 5654 4b20 6973 206e 6f74  rite('VTK is not
+00021b10: 2069 6e73 7461 6c6c 6564 206f 7220 696d   installed or im
+00021b20: 706f 7274 6564 2070 726f 7065 726c 792e  ported properly.
+00021b30: 2054 7279 696e 6720 746f 2075 7365 2043   Trying to use C
+00021b40: 6869 6d65 7261 5820 746f 2070 726f 6475  himeraX to produ
+00021b50: 6365 2073 7572 6661 6365 2076 6965 7773  ce surface views
+00021b60: 2e5c 6e27 290a 0a20 2020 2020 2020 2074  .\n')..        t
+00021b70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00021b80: 6966 2043 4849 4d45 5241 2069 7320 6e6f  if CHIMERA is no
+00021b90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00021ba0: 2020 2020 2020 2020 6368 696d 6572 6161          chimeraa
+00021bb0: 7070 203d 2043 4849 4d45 5241 0a20 2020  pp = CHIMERA.   
+00021bc0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00021bd0: 6e74 2863 6869 6d65 7261 6170 7029 0a20  nt(chimeraapp). 
+00021be0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00021bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021c00: 2061 7373 6572 7420 6669 6e64 5f65 7865   assert find_exe
+00021c10: 6375 7461 626c 6528 2743 6869 6d65 7261  cutable('Chimera
+00021c20: 5827 2920 6973 206e 6f74 204e 6f6e 650a  X') is not None.
+00021c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021c40: 6368 696d 6572 6161 7070 203d 2066 696e  chimeraapp = fin
+00021c50: 645f 6578 6563 7574 6162 6c65 2827 4368  d_executable('Ch
+00021c60: 696d 6572 6158 2729 0a20 2020 2020 2020  imeraX').       
+00021c70: 2020 2020 2020 2020 2070 7269 6e74 2863           print(c
+00021c80: 6869 6d65 7261 6170 7029 0a20 2020 2020  himeraapp).     
+00021c90: 2020 2065 7863 6570 7420 4173 7365 7274     except Assert
+00021ca0: 696f 6e45 7272 6f72 3a0a 2020 2020 2020  ionError:.      
+00021cb0: 2020 2020 2020 2320 7072 696e 7428 2743        # print('C
+00021cc0: 6869 6d65 7261 2065 7865 6375 7461 626c  himera executabl
+00021cd0: 6520 6973 206e 6f74 2074 6865 7265 2e27  e is not there.'
+00021ce0: 2c20 6669 6c65 3d73 7973 2e73 7464 6572  , file=sys.stder
+00021cf0: 7229 0a20 2020 2020 2020 2020 2020 2073  r).            s
+00021d00: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+00021d10: 2743 6869 6d65 7261 5820 6578 6563 7574  'ChimeraX execut
+00021d20: 6162 6c65 2069 7320 6e6f 7420 7468 6572  able is not ther
+00021d30: 652e 5c6e 2729 0a0a 2020 2020 2020 2020  e.\n')..        
+00021d40: 7265 7475 726e 2076 746b 7061 636b 2c20  return vtkpack, 
+00021d50: 6368 696d 6572 6161 7070 0a0a 2020 2020  chimeraapp..    
+00021d60: 2320 4465 6e73 6974 7920 6469 7374 7269  # Density distri
+00021d70: 6275 7469 6f6e 0a20 2020 2023 2040 7072  bution.    # @pr
+00021d80: 6f66 696c 650a 2020 2020 6465 6620 6d61  ofile.    def ma
+00021d90: 7064 656e 7369 7479 5f64 6973 7472 6962  pdensity_distrib
+00021da0: 7574 696f 6e28 7365 6c66 293a 0a20 2020  ution(self):.   
+00021db0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00021dc0: 2020 2020 2020 7072 6f64 7563 6520 7468        produce th
+00021dd0: 6520 6d61 7020 6465 6e73 6974 7920 6469  e map density di
+00021de0: 7374 7269 6275 7469 6f6e 0a0a 2020 2020  stribution..    
+00021df0: 2020 2020 3a72 6574 7572 6e3a 204e 6f6e      :return: Non
+00021e00: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00021e10: 2020 2020 2020 7365 6c66 2e64 656e 7369        self.densi
+00021e20: 7479 5f64 6973 7472 6962 7574 696f 6e28  ty_distribution(
+00021e30: 7365 6c66 2e6d 6170 290a 0a20 2020 2020  self.map)..     
+00021e40: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+00021e50: 2020 2020 2320 4070 726f 6669 6c65 0a20      # @profile. 
+00021e60: 2020 2064 6566 2072 6177 6d61 7064 656e     def rawmapden
+00021e70: 7369 7479 5f64 6973 7472 6962 7574 696f  sity_distributio
+00021e80: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
+00021e90: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+00021ea0: 2020 5072 6f64 7563 6520 7261 7720 6d61    Produce raw ma
+00021eb0: 7020 6465 6e73 6974 7920 6469 7374 7269  p density distri
+00021ec0: 6275 7469 6f6e 0a0a 2020 2020 2020 2020  bution..        
+00021ed0: 3a70 6172 616d 2072 6177 6d61 703a 2052  :param rawmap: R
+00021ee0: 6177 206d 6170 206f 626a 6563 740a 2020  aw map object.  
+00021ef0: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
+00021f00: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
+00021f10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00021f20: 2e72 6177 6d61 7020 6973 206e 6f74 204e  .rawmap is not N
+00021f30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00021f40: 2073 656c 662e 6465 6e73 6974 795f 6469   self.density_di
+00021f50: 7374 7269 6275 7469 6f6e 2873 656c 662e  stribution(self.
+00021f60: 7261 776d 6170 290a 2020 2020 2020 2020  rawmap).        
+00021f70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00021f80: 2020 7072 696e 7428 2754 6865 7265 2069    print('There i
+00021f90: 7320 6e6f 2072 6177 206d 6170 2066 6f72  s no raw map for
+00021fa0: 2064 656e 7369 7479 2064 6973 7472 6962   density distrib
+00021fb0: 7574 696f 6e2e 2729 0a20 2020 2020 2020  ution.').       
+00021fc0: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+00021fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00021fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00021ff0: 2729 0a0a 2020 2020 2020 2020 7265 7475  ')..        retu
+00022000: 726e 204e 6f6e 650a 0a20 2020 2023 2040  rn None..    # @
+00022010: 7072 6f66 696c 650a 2020 2020 6465 6620  profile.    def 
+00022020: 6465 6e73 6974 795f 6469 7374 7269 6275  density_distribu
+00022030: 7469 6f6e 2873 656c 662c 2064 656e 6d61  tion(self, denma
+00022040: 703d 4e6f 6e65 293a 0a20 2020 2020 2020  p=None):.       
+00022050: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+00022060: 2020 5072 6f64 7563 6520 6465 6e73 6974    Produce densit
+00022070: 7920 7661 6c75 6520 6469 7374 7269 6275  y value distribu
+00022080: 7469 6f6e 2069 6e66 6f72 6d61 7469 6f6e  tion information
+00022090: 2077 6974 6820 7468 6520 6465 6e73 6974   with the densit
+000220a0: 7920 6d61 7020 696e 666f 726d 6174 696f  y map informatio
+000220b0: 6e2e 0a20 2020 2020 2020 2020 2020 2078  n..            x
+000220c0: 2077 6173 2064 6976 6964 6564 2069 6e74   was divided int
+000220d0: 6f20 3132 3820 6269 6e73 0a20 2020 2020  o 128 bins.     
+000220e0: 2020 2020 2020 2079 2077 6173 2073 6361         y was sca
+000220f0: 6c65 6420 6279 206c 6f67 6172 6974 686d  led by logarithm
+00022100: 6963 2031 3020 2866 6f72 2030 2076 616c  ic 10 (for 0 val
+00022110: 7565 2061 6464 2031 2074 6f20 6967 6f6e  ue add 1 to igon
+00022120: 7265 2061 7274 6966 6163 7473 290a 0a20  re artifacts).. 
+00022130: 2020 2020 2020 203a 7061 7261 6d3a 204e         :param: N
+00022140: 6f6e 650a 2020 2020 2020 2020 3a72 6574  one.        :ret
+00022150: 7572 6e3a 204e 6f6e 650a 0a20 2020 2020  urn: None..     
+00022160: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00022170: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+00022180: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+00022190: 2020 2020 2020 2062 696e 7320 3d20 3132         bins = 12
+000221a0: 380a 2020 2020 2020 2020 6572 726c 6973  8.        errlis
+000221b0: 7420 3d20 5b5d 0a20 2020 2020 2020 2064  t = [].        d
+000221c0: 6174 6164 6963 7420 3d20 7b7d 0a20 2020  atadict = {}.   
+000221d0: 2020 2020 2023 2063 7572 6d61 706e 616d       # curmapnam
+000221e0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+000221f0: 6e61 6d65 2864 656e 6d61 702e 6669 6c65  name(denmap.file
+00022200: 6e61 6d65 290a 2020 2020 2020 2020 6375  name).        cu
+00022210: 726d 6170 6e61 6d65 203d 206f 732e 7061  rmapname = os.pa
+00022220: 7468 2e62 6173 656e 616d 6528 6465 6e6d  th.basename(denm
+00022230: 6170 2e66 756c 6c6e 616d 6529 0a20 2020  ap.fullname).   
+00022240: 2020 2020 2069 6620 2772 6177 6d61 7027       if 'rawmap'
+00022250: 2069 6e20 6375 726d 6170 6e61 6d65 3a0a   in curmapname:.
+00022260: 2020 2020 2020 2020 2020 2020 7461 6720              tag 
+00022270: 3d20 2772 6177 6d61 705f 270a 2020 2020  = 'rawmap_'.    
+00022280: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00022290: 2020 2020 2020 7461 6720 3d20 2727 0a20        tag = ''. 
+000222a0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000222b0: 2020 2020 2020 2020 2320 6d61 7064 6174          # mapdat
+000222c0: 6120 3d20 7365 6c66 2e6d 6170 2e67 6574  a = self.map.get
+000222d0: 4d61 7028 290a 2020 2020 2020 2020 2020  Map().          
+000222e0: 2020 6d61 7064 6174 6120 3d20 6465 6e6d    mapdata = denm
+000222f0: 6170 2e64 6174 610a 2020 2020 2020 2020  ap.data.        
+00022300: 2020 2020 666c 6174 6d61 7020 3d20 6d61      flatmap = ma
+00022310: 7064 6174 612e 666c 6174 7465 6e28 290a  pdata.flatten().
+00022320: 2020 2020 2020 2020 2020 2020 2320 6461              # da
+00022330: 7461 6d6f 6465 203d 2073 656c 662e 6d61  tamode = self.ma
+00022340: 702e 6865 6164 6572 5b33 5d0a 2020 2020  p.header[3].    
+00022350: 2020 2020 2020 2020 6461 7461 6d6f 6465          datamode
+00022360: 203d 2073 656c 662e 6d61 702e 6865 6164   = self.map.head
+00022370: 6572 2e6d 6f64 650a 2020 2020 2020 2020  er.mode.        
+00022380: 2020 2020 756e 6971 7565 732c 2075 6e69      uniques, uni
+00022390: 7175 6563 6f75 6e74 7320 3d20 6e70 2e75  quecounts = np.u
+000223a0: 6e69 7175 6528 666c 6174 6d61 702c 2072  nique(flatmap, r
+000223b0: 6574 7572 6e5f 636f 756e 7473 3d54 7275  eturn_counts=Tru
+000223c0: 6529 0a20 2020 2020 2020 2020 2020 2075  e).            u
+000223d0: 6e69 7175 656c 656e 203d 206c 656e 2875  niquelen = len(u
+000223e0: 6e69 7175 6573 290a 2020 2020 2020 2020  niques).        
+000223f0: 2020 2020 6966 2064 6174 616d 6f64 6520      if datamode 
+00022400: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00022410: 2020 2020 2020 6269 6e73 203d 2075 6e69        bins = uni
+00022420: 7175 6573 0a20 2020 2020 2020 2020 2020  ques.           
+00022430: 2020 2020 2068 6973 742c 2062 696e 5f65       hist, bin_e
+00022440: 6467 6573 203d 206e 702e 6869 7374 6f67  dges = np.histog
+00022450: 7261 6d28 666c 6174 6d61 702c 2062 696e  ram(flatmap, bin
+00022460: 733d 6269 6e73 290a 2020 2020 2020 2020  s=bins).        
+00022470: 2020 2020 656c 6966 2064 6174 616d 6f64      elif datamod
+00022480: 6520 3d3d 2031 206f 7220 6461 7461 6d6f  e == 1 or datamo
+00022490: 6465 203d 3d20 363a 0a20 2020 2020 2020  de == 6:.       
+000224a0: 2020 2020 2020 2020 2069 6620 756e 6971           if uniq
+000224b0: 7565 6c65 6e20 3e20 3130 3030 3a0a 2020  uelen > 1000:.  
+000224c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000224d0: 2020 696e 6473 203d 206e 702e 6c69 6e73    inds = np.lins
+000224e0: 7061 6365 2830 2c20 756e 6971 7565 6c65  pace(0, uniquele
+000224f0: 6e2d 312c 206e 756d 3d31 3238 2c20 6474  n-1, num=128, dt
+00022500: 7970 653d 6e70 2e75 696e 7431 3629 0a20  ype=np.uint16). 
+00022510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022520: 2020 2062 696e 7320 3d20 6e70 2e74 616b     bins = np.tak
+00022530: 6528 756e 6971 7565 732c 2069 6e64 7329  e(uniques, inds)
+00022540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022550: 2020 2020 2068 6973 742c 2062 696e 5f65       hist, bin_e
+00022560: 6467 6573 203d 206e 702e 6869 7374 6f67  dges = np.histog
+00022570: 7261 6d28 666c 6174 6d61 702c 2062 696e  ram(flatmap, bin
+00022580: 733d 6269 6e73 290a 2020 2020 2020 2020  s=bins).        
+00022590: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000225a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225b0: 2020 6869 7374 203d 2075 6e69 7175 6563    hist = uniquec
+000225c0: 6f75 6e74 730a 2020 2020 2020 2020 2020  ounts.          
+000225d0: 2020 2020 2020 2020 2020 6269 6e5f 6564            bin_ed
+000225e0: 6765 7320 3d20 6e70 2e61 7070 656e 6428  ges = np.append(
+000225f0: 756e 6971 7565 732c 2075 6e69 7175 6573  uniques, uniques
+00022600: 5b2d 315d 290a 2020 2020 2020 2020 2020  [-1]).          
+00022610: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00022620: 2020 2020 2020 2020 6269 6e73 203d 206e          bins = n
+00022630: 702e 6c69 6e73 7061 6365 286d 696e 2866  p.linspace(min(f
+00022640: 6c61 746d 6170 292c 206d 6178 2866 6c61  latmap), max(fla
+00022650: 746d 6170 292c 2031 3238 290a 2020 2020  tmap), 128).    
+00022660: 2020 2020 2020 2020 2020 2020 6869 7374              hist
+00022670: 2c20 6269 6e5f 6564 6765 7320 3d20 6e70  , bin_edges = np
+00022680: 2e68 6973 746f 6772 616d 2866 6c61 746d  .histogram(flatm
+00022690: 6170 2c20 6269 6e73 3d62 696e 7329 0a20  ap, bins=bins). 
+000226a0: 2020 2020 2020 2020 2020 2023 2068 6973             # his
+000226b0: 742c 2062 696e 5f65 6467 6573 203d 206e  t, bin_edges = n
+000226c0: 702e 6869 7374 6f67 7261 6d28 666c 6174  p.histogram(flat
+000226d0: 6d61 702c 2062 696e 733d 6269 6e73 290a  map, bins=bins).
+000226e0: 2020 2020 2020 2020 2020 2020 6869 7374              hist
+000226f0: 5b68 6973 7420 3c20 315d 203d 2031 0a20  [hist < 1] = 1. 
+00022700: 2020 2020 2020 2020 2020 206e 6577 6869             newhi
+00022710: 7374 203d 206e 702e 6c6f 6731 3028 6869  st = np.log10(hi
+00022720: 7374 290a 0a20 2020 2020 2020 2020 2020  st)..           
+00022730: 2070 6c74 2e66 6967 7572 6528 6669 6773   plt.figure(figs
+00022740: 697a 653d 2831 302c 2033 2929 0a20 2020  ize=(10, 3)).   
+00022750: 2020 2020 2020 2020 2070 6c74 2e70 6c6f           plt.plo
+00022760: 7428 6e70 2e72 6f75 6e64 2862 696e 5f65  t(np.round(bin_e
+00022770: 6467 6573 5b3a 2d31 5d2c 2031 3029 2e74  dges[:-1], 10).t
+00022780: 6f6c 6973 7428 292c 206e 702e 726f 756e  olist(), np.roun
+00022790: 6428 6e65 7768 6973 742c 2031 3029 2e74  d(newhist, 10).t
+000227a0: 6f6c 6973 7428 2929 0a20 2020 2020 2020  olist()).       
+000227b0: 2020 2020 2070 6c74 2e73 6176 6566 6967       plt.savefig
+000227c0: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
+000227d0: 272f 2720 2b20 6375 726d 6170 6e61 6d65  '/' + curmapname
+000227e0: 202b 2027 5f76 6f78 656c 5f64 6973 7472   + '_voxel_distr
+000227f0: 6962 7574 696f 6e2e 706e 6727 290a 2020  ibution.png').  
+00022800: 2020 2020 2020 2020 2020 706c 742e 636c            plt.cl
+00022810: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
+00022820: 2020 206d 6f64 6520 3d20 6e70 2e72 6f75     mode = np.rou
+00022830: 6e64 2862 696e 5f65 6467 6573 5b3a 2d31  nd(bin_edges[:-1
+00022840: 5d5b 6e70 2e61 7267 6d61 7828 6e65 7768  ][np.argmax(newh
+00022850: 6973 7429 5d2c 2035 292e 746f 6c69 7374  ist)], 5).tolist
+00022860: 2829 0a20 2020 2020 2020 2020 2020 2064  ().            d
+00022870: 6174 6164 6963 7420 3d20 7b0a 2020 2020  atadict = {.    
+00022880: 2020 2020 2020 2020 2020 2020 7461 6720              tag 
+00022890: 2b20 2764 656e 7369 7479 5f64 6973 7472  + 'density_distr
+000228a0: 6962 7574 696f 6e27 3a20 7b27 7927 3a20  ibution': {'y': 
+000228b0: 6e70 2e72 6f75 6e64 286e 6577 6869 7374  np.round(newhist
+000228c0: 2c20 3130 292e 746f 6c69 7374 2829 2c0a  , 10).tolist(),.
+000228d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228f0: 2020 2020 2020 2020 2027 7827 3a20 6e70           'x': np
+00022900: 2e72 6f75 6e64 2862 696e 5f65 6467 6573  .round(bin_edges
+00022910: 5b3a 2d31 5d2c 2031 3029 2e74 6f6c 6973  [:-1], 10).tolis
+00022920: 7428 292c 0a20 2020 2020 2020 2020 2020  t(),.           
+00022930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022940: 2020 2020 2020 2020 2020 2020 2020 276d                'm
+00022950: 6f64 6527 3a20 6d6f 6465 7d7d 0a20 2020  ode': mode}}.   
+00022960: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00022970: 2020 2020 2020 2020 2065 7272 203d 2027           err = '
+00022980: 4465 6e73 6974 7920 6469 7374 7269 6275  Density distribu
+00022990: 7469 6f6e 2065 7272 6f72 3a7b 7d2e 272e  tion error:{}.'.
+000229a0: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
+000229b0: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
+000229c0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+000229d0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+000229e0: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
+000229f0: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
+00022a00: 2729 0a0a 2020 2020 2020 2020 6966 2065  ')..        if e
+00022a10: 7272 6c69 7374 3a0a 2020 2020 2020 2020  rrlist:.        
+00022a20: 2020 2020 6461 7461 6469 6374 203d 207b      datadict = {
+00022a30: 7461 6720 2b20 2764 656e 7369 7479 5f64  tag + 'density_d
+00022a40: 6973 7472 6962 7574 696f 6e27 3a20 7b27  istribution': {'
+00022a50: 6572 7227 3a20 7b27 6465 6e73 6974 795f  err': {'density_
+00022a60: 6469 7374 7269 6275 7469 6f6e 5f65 7272  distribution_err
+00022a70: 6f72 273a 2065 7272 6c69 7374 7d7d 7d0a  or': errlist}}}.
+00022a80: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00022a90: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+00022aa0: 6f64 6563 732e 6f70 656e 2873 656c 662e  odecs.open(self.
+00022ab0: 776f 726b 6469 7220 2b20 6375 726d 6170  workdir + curmap
+00022ac0: 6e61 6d65 202b 2027 5f64 656e 7369 7479  name + '_density
+00022ad0: 5f64 6973 7472 6962 7574 696f 6e2e 6a73  _distribution.js
+00022ae0: 6f6e 272c 2027 7727 2c0a 2020 2020 2020  on', 'w',.      
+00022af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b00: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+00022b10: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
+00022b20: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+00022b30: 736f 6e2e 6475 6d70 2864 6174 6164 6963  son.dump(datadic
+00022b40: 742c 2066 290a 2020 2020 2020 2020 6578  t, f).        ex
+00022b50: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+00022b60: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
+00022b70: 7465 2827 5361 7669 6e67 2064 656e 6973  te('Saving denis
+00022b80: 7479 2064 6973 7472 6962 7574 696f 6e20  ty distribution 
+00022b90: 746f 206a 736f 6e20 6572 726f 722e 2729  to json error.')
+00022ba0: 0a0a 2020 2020 2020 2020 656e 6420 3d20  ..        end = 
+00022bb0: 7469 6d65 6974 2e64 6566 6175 6c74 5f74  timeit.default_t
+00022bc0: 696d 6572 2829 0a20 2020 2020 2020 2070  imer().        p
+00022bd0: 7269 6e74 2874 6167 202b 2027 4465 6e73  rint(tag + 'Dens
+00022be0: 6974 7920 6469 7374 7269 6275 7469 6f6e  ity distribution
+00022bf0: 2074 696d 653a 2025 7327 2025 2028 656e   time: %s' % (en
+00022c00: 6420 2d20 7374 6172 7429 290a 2020 2020  d - start)).    
+00022c10: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+00022c20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00022c30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+00022c40: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00022c50: 6e20 4e6f 6e65 0a0a 2020 2020 2320 4174  n None..    # At
+00022c60: 6f6d 2061 6e64 2072 6573 6964 7565 2069  om and residue i
+00022c70: 6e63 6c75 6473 696f 6e0a 2020 2020 4073  ncludsion.    @s
+00022c80: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00022c90: 6465 6620 5f5f 666c 6f61 746f 6865 7828  def __floatohex(
+00022ca0: 6e75 6d6c 6973 7429 3a0a 2020 2020 2020  numlist):.      
+00022cb0: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
+00022cc0: 2020 2050 726f 6475 6365 2068 6578 2063     Produce hex c
+00022cd0: 6f6c 6f72 2062 6574 7765 656e 2072 6564  olor between red
+00022ce0: 2061 6e64 2067 7265 656e 0a0a 2020 2020   and green..    
+00022cf0: 2020 2020 3a70 6172 616d 206e 756d 6c69      :param numli
+00022d00: 7374 3a20 4120 6c69 7374 206f 6620 5247  st: A list of RG
+00022d10: 4220 7661 6c75 6573 0a20 2020 2020 2020  B values.       
+00022d20: 203a 7265 7475 726e 3a20 4120 6c69 7374   :return: A list
+00022d30: 206f 6620 6865 7820 7661 6c75 6520 6265   of hex value be
+00022d40: 7477 6565 6e20 5220 616e 6420 4720 7769  tween R and G wi
+00022d50: 7468 2042 203d 2030 0a0a 2020 2020 2020  th B = 0..      
+00022d60: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00022d70: 2072 6762 7320 3d20 5b5b 696e 7428 2831   rgbs = [[int((1
+00022d80: 202d 206e 756d 2920 2a20 3235 3529 2c20   - num) * 255), 
+00022d90: 696e 7428 6e75 6d20 2a20 3235 3529 2c20  int(num * 255), 
+00022da0: 305d 2066 6f72 206e 756d 2069 6e20 6e75  0] for num in nu
+00022db0: 6d6c 6973 745d 0a20 2020 2020 2020 2023  mlist].        #
+00022dc0: 2072 6762 7320 3d20 5b5b 696e 7428 2831   rgbs = [[int((1
+00022dd0: 202d 206e 756d 2920 2a20 3235 3529 2a30   - num) * 255)*0
+00022de0: 2e35 2c20 3132 302c 2069 6e74 286e 756d  .5, 120, int(num
+00022df0: 202a 2032 3535 292a 302e 355d 2066 6f72   * 255)*0.5] for
+00022e00: 206e 756d 2069 6e20 6e75 6d6c 6973 745d   num in numlist]
+00022e10: 0a20 2020 2020 2020 206e 756d 6c69 7374  .        numlist
+00022e20: 203d 205b 2d31 2069 6620 6920 3c20 3020   = [-1 if i < 0 
+00022e30: 656c 7365 2069 2066 6f72 2069 2069 6e20  else i for i in 
+00022e40: 6e75 6d6c 6973 745d 0a20 2020 2020 2020  numlist].       
+00022e50: 2072 6762 7320 3d20 5b5b 3132 322c 2069   rgbs = [[122, i
+00022e60: 6e74 286e 756d 202a 2032 3535 292c 2069  nt(num * 255), i
+00022e70: 6e74 286e 756d 202a 2032 3535 295d 2069  nt(num * 255)] i
+00022e80: 6620 6e75 6d20 3e3d 2030 2065 6c73 6520  f num >= 0 else 
+00022e90: 5b32 3535 2c20 302c 2032 3535 5d20 666f  [255, 0, 255] fo
+00022ea0: 7220 6e75 6d20 696e 206e 756d 6c69 7374  r num in numlist
+00022eb0: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
+00022ec0: 6c69 7374 203d 205b 2723 2530 3258 2530  list = ['#%02X%0
+00022ed0: 3258 2530 3258 2720 2520 2872 6762 5b30  2X%02X' % (rgb[0
+00022ee0: 5d2c 2072 6762 5b31 5d2c 2072 6762 5b32  ], rgb[1], rgb[2
+00022ef0: 5d29 2066 6f72 2072 6762 2069 6e20 7267  ]) for rgb in rg
+00022f00: 6273 5d0a 0a20 2020 2020 2020 2072 6574  bs]..        ret
+00022f10: 7572 6e20 7265 7375 6c74 6c69 7374 0a0a  urn resultlist..
+00022f20: 2020 2020 2320 4174 6f6d 2061 6e64 2072      # Atom and r
+00022f30: 6573 6964 7565 2069 6e63 6c75 6473 696f  esidue includsio
+00022f40: 6e0a 2020 2020 4073 7461 7469 636d 6574  n.    @staticmet
+00022f50: 686f 640a 2020 2020 6465 6620 5f5f 666c  hod.    def __fl
+00022f60: 6f61 746f 6865 785f 6162 6f76 656f 6e65  oatohex_aboveone
+00022f70: 286e 756d 6c69 7374 293a 0a20 2020 2020  (numlist):.     
+00022f80: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00022f90: 2020 2020 5072 6f64 7563 6520 6865 7820      Produce hex 
+00022fa0: 636f 6c6f 7220 6265 7477 6565 6e20 7265  color between re
+00022fb0: 6420 616e 6420 6772 6565 6e0a 0a20 2020  d and green..   
+00022fc0: 2020 2020 203a 7061 7261 6d20 6e75 6d6c       :param numl
+00022fd0: 6973 743a 2041 206c 6973 7420 6f66 2052  ist: A list of R
+00022fe0: 4742 2076 616c 7565 730a 2020 2020 2020  GB values.      
+00022ff0: 2020 3a72 6574 7572 6e3a 2041 206c 6973    :return: A lis
+00023000: 7420 6f66 2068 6578 2076 616c 7565 2062  t of hex value b
+00023010: 6574 7765 656e 2052 2061 6e64 2047 2077  etween R and G w
+00023020: 6974 6820 4220 3d20 300a 0a20 2020 2020  ith B = 0..     
+00023030: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00023040: 2320 7267 6273 203d 205b 5b69 6e74 2828  # rgbs = [[int((
+00023050: 3120 2d20 6e75 6d29 202a 2032 3535 292c  1 - num) * 255),
+00023060: 2069 6e74 286e 756d 202a 2032 3535 292c   int(num * 255),
+00023070: 2030 5d20 666f 7220 6e75 6d20 696e 206e   0] for num in n
+00023080: 756d 6c69 7374 5d0a 2020 2020 2020 2020  umlist].        
+00023090: 2320 7267 6273 203d 205b 5b69 6e74 2828  # rgbs = [[int((
+000230a0: 3120 2d20 6e75 6d29 202a 2032 3535 292a  1 - num) * 255)*
+000230b0: 302e 352c 2031 3230 2c20 696e 7428 6e75  0.5, 120, int(nu
+000230c0: 6d20 2a20 3235 3529 2a30 2e35 5d20 666f  m * 255)*0.5] fo
+000230d0: 7220 6e75 6d20 696e 206e 756d 6c69 7374  r num in numlist
+000230e0: 5d0a 2020 2020 2020 2020 6e75 6d6c 6973  ].        numlis
+000230f0: 7420 3d20 5b2d 3120 6966 2069 203c 2030  t = [-1 if i < 0
+00023100: 2065 6c73 6520 6920 666f 7220 6920 696e   else i for i in
+00023110: 206e 756d 6c69 7374 5d0a 2020 2020 2020   numlist].      
+00023120: 2020 7267 6273 203d 205b 5b69 6e74 286e    rgbs = [[int(n
+00023130: 756d 202a 2031 3329 2c20 302c 2069 6e74  um * 13), 0, int
+00023140: 286e 756d 202a 2032 3535 295d 2069 6620  (num * 255)] if 
+00023150: 6e75 6d20 3e3d 2030 2065 6c73 6520 5b32  num >= 0 else [2
+00023160: 3535 2c20 302c 2032 3535 5d20 666f 7220  55, 0, 255] for 
+00023170: 6e75 6d20 696e 206e 756d 6c69 7374 5d0a  num in numlist].
+00023180: 2020 2020 2020 2020 7265 7375 6c74 6c69          resultli
+00023190: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+000231a0: 7265 7375 6c74 6c69 7374 203d 205b 2723  resultlist = ['#
+000231b0: 2530 3258 2530 3258 2530 3258 2720 2520  %02X%02X%02X' % 
+000231c0: 2872 6762 5b30 5d2c 2072 6762 5b31 5d2c  (rgb[0], rgb[1],
+000231d0: 2072 6762 5b32 5d29 2066 6f72 2072 6762   rgb[2]) for rgb
+000231e0: 2069 6e20 7267 6273 5d0a 0a20 2020 2020   in rgbs]..     
+000231f0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00023200: 6c69 7374 0a0a 2020 2020 6465 6620 5f5f  list..    def __
+00023210: 696e 7465 7250 6f6c 6174 696f 6e28 7365  interPolation(se
+00023220: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00023230: 0a0a 2020 2020 2020 2020 2020 2020 5573  ..            Us
+00023240: 6320 7363 6970 7920 7265 6775 6c61 7267  c scipy regularg
+00023250: 7269 6420 696e 7465 7270 6f6c 6174 696f  rid interpolatio
+00023260: 6e20 6d65 7468 6f64 2066 6565 6420 7769  n method feed wi
+00023270: 7468 2061 6c6c 206d 6170 7320 696e 666f  th all maps info
+00023280: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00023290: 206d 6170 3a20 456c 6563 7472 6f6e 2064   map: Electron d
+000232a0: 656e 7369 7479 206d 6170 2069 6e20 6d72  ensity map in mr
+000232b0: 632f 6d61 7020 666f 726d 6174 0a20 2020  c/map format.   
+000232c0: 2020 2020 203a 7061 7261 6d20 6d6f 6465       :param mode
+000232d0: 6c3a 2050 726f 7465 696e 206d 6f64 656c  l: Protein model
+000232e0: 2069 6e20 6d6d 6369 6620 666f 726d 6174   in mmcif format
+000232f0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00023300: 3a20 4120 696e 7465 7270 6f6c 6174 696f  : A interpolatio
+00023310: 6e20 6675 6e63 7469 6f6e 0a0a 2020 2020  n function..    
+00023320: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00023330: 2023 206d 6170 6461 7461 203d 2073 656c   # mapdata = sel
+00023340: 662e 6d61 702e 6765 744d 6170 2829 0a20  f.map.getMap(). 
+00023350: 2020 2020 2020 206d 6170 6461 7461 203d         mapdata =
+00023360: 2073 656c 662e 6d61 702e 6461 7461 0a20   self.map.data. 
+00023370: 2020 2020 2020 2074 6d70 6d61 7064 6174         tmpmapdat
+00023380: 6120 3d20 6e70 2e73 7761 7061 7865 7328  a = np.swapaxes(
+00023390: 6d61 7064 6174 612c 2030 2c20 3229 0a20  mapdata, 0, 2). 
+000233a0: 2020 2020 2020 2063 6c69 6d2c 2062 6c69         clim, bli
+000233b0: 6d2c 2061 6c69 6d20 3d20 6d61 7064 6174  m, alim = mapdat
+000233c0: 612e 7368 6170 650a 2020 2020 2020 2020  a.shape.        
+000233d0: 7820 3d20 7261 6e67 6528 616c 696d 290a  x = range(alim).
+000233e0: 2020 2020 2020 2020 7920 3d20 7261 6e67          y = rang
+000233f0: 6528 626c 696d 290a 2020 2020 2020 2020  e(blim).        
+00023400: 7a20 3d20 7261 6e67 6528 636c 696d 290a  z = range(clim).
+00023410: 2020 2020 2020 2020 6d79 696e 7465 7220          myinter 
+00023420: 3d20 5265 6775 6c61 7247 7269 6449 6e74  = RegularGridInt
+00023430: 6572 706f 6c61 746f 7228 2878 2c20 792c  erpolator((x, y,
+00023440: 207a 292c 2074 6d70 6d61 7064 6174 6129   z), tmpmapdata)
+00023450: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00023460: 206d 7969 6e74 6572 0a0a 2020 2020 2320   myinter..    # 
+00023470: 7665 7273 696f 6e20 3120 6279 2075 7369  version 1 by usi
+00023480: 6e67 2054 454d 5079 0a20 2020 2064 6566  ng TEMPy.    def
+00023490: 205f 5f69 6e74 6572 7468 6972 6428 7365   __interthird(se
+000234a0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+000234b0: 0a0a 2020 2020 2020 2020 2020 2020 496e  ..            In
+000234c0: 7465 7270 6f6c 6174 6520 6465 6e73 6974  terpolate densit
+000234d0: 7920 7661 6c75 6520 6f66 206f 6e65 2061  y value of one a
+000234e0: 746f 6d2c 2069 6620 696e 6469 6365 7320  tom, if indices 
+000234f0: 6172 6520 6f6e 2074 6865 2073 616d 6520  are on the same 
+00023500: 706c 616e 6520 7573 6520 6e65 6172 6573  plane use neares
+00023510: 7420 6d65 7468 6f64 0a20 2020 2020 2020  t method.       
+00023520: 2020 2020 206f 7468 6572 7769 7365 2075       otherwise u
+00023530: 7365 206c 696e 6561 720a 0a20 2020 2020  se linear..     
+00023540: 2020 203a 7061 7261 6d20 6d61 703a 2054     :param map: T
+00023550: 454d 5079 206d 6170 2069 6e73 7461 6e63  EMPy map instanc
+00023560: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+00023570: 206d 6f64 656c 3a20 5374 7275 6374 7572   model: Structur
+00023580: 6520 696e 7374 616e 6365 2066 726f 6d20  e instance from 
+00023590: 5445 4d50 7920 7061 636b 6167 6520 6d6d  TEMPy package mm
+000235a0: 6369 6620 7061 7273 6572 0a20 2020 2020  cif parser.     
+000235b0: 2020 203a 7265 7475 726e 3a20 4c69 7374     :return: List
+000235c0: 2063 6f6e 7461 696e 7320 616c 6c20 6465   contains all de
+000235d0: 6e73 6974 7920 696e 7465 7270 6f6c 6174  nsity interpolat
+000235e0: 696f 6e73 206f 6620 6174 6f6d 7320 6672  ions of atoms fr
+000235f0: 6f6d 206d 6f64 656c 0a0a 2020 2020 2020  om model..      
+00023600: 2020 2222 220a 0a20 2020 2020 2020 206d    """..        m
+00023610: 7969 6e74 6572 203d 2073 656c 662e 5f5f  yinter = self.__
+00023620: 696e 7465 7250 6f6c 6174 696f 6e28 290a  interPolation().
+00023630: 2020 2020 2020 2020 2320 4d69 6768 7420          # Might 
+00023640: 6861 7669 6e67 206d 756c 7470 6c65 206d  having multple m
+00023650: 6f64 656c 730a 2020 2020 2020 2020 6d6f  odels.        mo
+00023660: 6465 6c73 203d 205b 5d0a 2020 2020 2020  dels = [].      
+00023670: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00023680: 7365 6c66 2e6d 6f64 656c 732c 206c 6973  self.models, lis
+00023690: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+000236a0: 6d6f 6465 6c73 203d 2073 656c 662e 6d6f  models = self.mo
+000236b0: 6465 6c73 0a20 2020 2020 2020 2065 6c73  dels.        els
+000236c0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+000236d0: 6f64 656c 732e 6170 7065 6e64 2873 656c  odels.append(sel
+000236e0: 662e 6d6f 6465 6c73 290a 2020 2020 2020  f.models).      
+000236f0: 2020 6d61 7020 3d20 7365 6c66 2e6d 6170    map = self.map
+00023700: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
+00023710: 203d 2073 656c 662e 636c 0a20 2020 2020   = self.cl.     
+00023720: 2020 2023 2052 616e 6765 206f 6620 636f     # Range of co
+00023730: 6e74 6f75 7220 6c65 7665 6c20 7661 6c75  ntour level valu
+00023740: 6573 2066 6f72 2073 6361 6c65 7220 6261  es for scaler ba
+00023750: 720a 2020 2020 2020 2020 2320 546f 646f  r.        # Todo
+00023760: 3a20 5269 6768 7420 6e6f 7720 7769 7468  : Right now with
+00023770: 2066 6978 6564 206e 756d 6265 7220 6f66   fixed number of
+00023780: 2070 6f69 6e74 7320 6f6e 2062 6f74 6820   points on both 
+00023790: 7369 6465 7320 6f66 2074 6865 2072 6563  sides of the rec
+000237a0: 6f6d 6d65 6e64 6564 2063 6f6e 746f 7572  ommended contour
+000237b0: 206c 6576 656c 2c20 636f 756c 6420 696d   level, could im
+000237c0: 7072 6f76 6520 746f 0a20 2020 2020 2020  prove to.       
+000237d0: 2023 2054 6f64 6f3a 2067 656e 6572 6174   # Todo: generat
+000237e0: 6520 6120 7265 6173 6f6e 6162 6c65 2072  e a reasonable r
+000237f0: 616e 6765 2073 7572 726f 756e 6420 7468  ange surround th
+00023800: 6520 7265 636f 6d6d 656e 6465 6420 636f  e recommended co
+00023810: 6e74 6f75 7220 6c65 7665 6c0a 2020 2020  ntour level.    
+00023820: 2020 2020 2320 5365 7474 696e 6720 6120      # Setting a 
+00023830: 736d 6172 7465 7220 7261 6e67 6520 6265  smarter range be
+00023840: 7477 6565 6e20 2863 6f6e 746f 7572 2d73  tween (contour-s
+00023850: 6967 2c63 6f6e 746f 7572 2c20 636f 756e  ig,contour, coun
+00023860: 746f 7572 202b 2073 6967 290a 2020 2020  tour + sig).    
+00023870: 2020 2020 6d61 7073 6967 203d 206d 6170      mapsig = map
+00023880: 2e73 7464 2829 0a20 2020 2020 2020 2023  .std().        #
+00023890: 2063 6f6e 746f 7572 7261 6e67 6520 3d20   contourrange = 
+000238a0: 6e70 2e63 6f6e 6361 7465 6e61 7465 2828  np.concatenate((
+000238b0: 6e70 2e6c 696e 7370 6163 6528 636f 6e74  np.linspace(cont
+000238c0: 6f75 7220 2d20 666c 6f61 7428 312e 3520  our - float(1.5 
+000238d0: 2a20 6d61 7073 6967 292c 2063 6f6e 746f  * mapsig), conto
+000238e0: 7572 2c20 332c 2065 6e64 706f 696e 743d  ur, 3, endpoint=
+000238f0: 4661 6c73 6529 2c0a 2020 2020 2020 2020  False),.        
+00023900: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00023910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023920: 206e 702e 6c69 6e73 7061 6365 2863 6f6e   np.linspace(con
+00023930: 746f 7572 2c20 636f 6e74 6f75 7220 2b20  tour, contour + 
+00023940: 666c 6f61 7428 312e 3520 2a20 6d61 7073  float(1.5 * maps
+00023950: 6967 292c 2034 2929 2c20 6178 6973 3d4e  ig), 4)), axis=N
+00023960: 6f6e 6529 0a20 2020 2020 2020 2023 2063  one).        # c
+00023970: 6f6e 746f 7572 7261 6e67 6520 3d20 6e70  ontourrange = np
+00023980: 2e63 6f6e 6361 7465 6e61 7465 2828 6e70  .concatenate((np
+00023990: 2e6c 696e 7370 6163 6528 6d61 702e 6d69  .linspace(map.mi
+000239a0: 6e28 292c 2063 6f6e 746f 7572 2c20 332c  n(), contour, 3,
+000239b0: 2065 6e64 706f 696e 743d 4661 6c73 6529   endpoint=False)
+000239c0: 2c20 6e70 2e6c 696e 7370 6163 6528 636f  , np.linspace(co
+000239d0: 6e74 6f75 722c 206d 6170 2e6d 6178 2829  ntour, map.max()
+000239e0: 2c20 3329 292c 2061 7869 733d 4e6f 6e65  , 3)), axis=None
+000239f0: 290a 2020 2020 2020 2020 2320 5768 656e  ).        # When
+00023a00: 2072 756e 6e69 6e67 2066 6f72 2045 4d44   running for EMD
+00023a10: 4220 6b65 6570 2069 7420 6173 2061 2066  B keep it as a f
+00023a20: 6c65 7869 626c 6520 7261 6e67 6520 666f  lexible range fo
+00023a30: 7220 6f6e 6564 6570 206f 7220 6f74 6865  r onedep or othe
+00023a40: 7220 7573 6572 7320 6f6e 6c79 2072 756e  r users only run
+00023a50: 2069 7420 6f6e 6365 2066 6f72 2072 6563   it once for rec
+00023a60: 6f6d 6d65 6e64 6564 0a20 2020 2020 2020  ommended.       
+00023a70: 2023 2063 6f6e 746f 7572 206c 6576 656c   # contour level
+00023a80: 3a0a 0a20 2020 2020 2020 2023 2069 6620  :..        # if 
+00023a90: 7365 6c66 2e65 6d64 6964 3a0a 2020 2020  self.emdid:.    
+00023aa0: 2020 2020 2320 2020 2020 636f 6e74 6f75      #     contou
+00023ab0: 7272 616e 6765 203d 206e 702e 636f 6e63  rrange = np.conc
+00023ac0: 6174 656e 6174 6528 286e 702e 6c69 6e73  atenate((np.lins
+00023ad0: 7061 6365 2863 6f6e 746f 7572 202d 2066  pace(contour - f
+00023ae0: 6c6f 6174 2831 2e35 202a 206d 6170 7369  loat(1.5 * mapsi
+00023af0: 6729 2c20 636f 6e74 6f75 722c 2033 2c20  g), contour, 3, 
+00023b00: 656e 6470 6f69 6e74 3d46 616c 7365 292c  endpoint=False),
+00023b10: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+00023b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b30: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+00023b40: 2e6c 696e 7370 6163 6528 636f 6e74 6f75  .linspace(contou
+00023b50: 722c 2063 6f6e 746f 7572 202b 2066 6c6f  r, contour + flo
+00023b60: 6174 2831 2e35 202a 206d 6170 7369 6729  at(1.5 * mapsig)
+00023b70: 2c20 3429 292c 2061 7869 733d 4e6f 6e65  , 4)), axis=None
+00023b80: 290a 2020 2020 2020 2020 2320 656c 7365  ).        # else
+00023b90: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
+00023ba0: 636f 6e74 6f75 7272 616e 6765 203d 206e  contourrange = n
+00023bb0: 702e 6173 6172 7261 7928 5b63 6f6e 746f  p.asarray([conto
+00023bc0: 7572 5d29 0a0a 2020 2020 2020 2020 636f  ur])..        co
+00023bd0: 6e74 6f75 7272 616e 6765 203d 206e 702e  ntourrange = np.
+00023be0: 6173 6172 7261 7928 5b63 6f6e 746f 7572  asarray([contour
+00023bf0: 5d29 0a20 2020 2020 2020 2072 6573 756c  ]).        resul
+00023c00: 7420 3d20 7b7d 0a20 2020 2020 2020 2066  t = {}.        f
+00023c10: 6f72 206d 6f64 656c 2069 6e20 6d6f 6465  or model in mode
+00023c20: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+00023c30: 616c 6c63 6f6e 746f 7572 7364 6963 7420  allcontoursdict 
+00023c40: 3d20 4f72 6465 7265 6444 6963 7428 290a  = OrderedDict().
+00023c50: 2020 2020 2020 2020 2020 2020 6174 6f6d              atom
+00023c60: 6f75 7473 6964 656e 756d 203d 2030 0a20  outsidenum = 0. 
+00023c70: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+00023c80: 6e61 6d65 203d 206d 6f64 656c 2e66 696c  name = model.fil
+00023c90: 656e 616d 652e 7370 6c69 7428 272f 2729  ename.split('/')
+00023ca0: 5b2d 315d 0a0a 2020 2020 2020 2020 2020  [-1]..          
+00023cb0: 2020 6174 6f6d 636f 756e 7420 3d20 300a    atomcount = 0.
+00023cc0: 2020 2020 2020 2020 2020 2020 6368 6169              chai
+00023cd0: 6e63 6f75 6e74 203d 2031 0a20 2020 2020  ncount = 1.     
+00023ce0: 2020 2020 2020 2063 6861 696e 6174 6f6d         chainatom
+00023cf0: 7320 3d20 300a 2020 2020 2020 2020 2020  s = 0.          
+00023d00: 2020 6368 6169 6e61 6973 636f 7265 203d    chainaiscore =
+00023d10: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+00023d20: 6368 6169 6e61 6920 3d20 302e 0a0a 2020  chainai = 0...  
+00023d30: 2020 2020 2020 2020 2020 666f 7220 636f            for co
+00023d40: 6e74 6f75 7220 696e 2063 6f6e 746f 7572  ntour in contour
+00023d50: 7261 6e67 653a 0a20 2020 2020 2020 2020  range:.         
+00023d60: 2020 2020 2020 2069 6e74 6572 706f 6c61         interpola
+00023d70: 7469 6f6e 7320 3d20 5b5d 0a20 2020 2020  tions = [].     
+00023d80: 2020 2020 2020 2020 2020 2061 6c6c 6b65             allke
+00023d90: 7973 203d 205b 5d0a 2020 2020 2020 2020  ys = [].        
+00023da0: 2020 2020 2020 2020 616c 6c76 616c 7565          allvalue
+00023db0: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+00023dc0: 2020 2020 2020 2070 7265 7265 7369 6420         preresid 
+00023dd0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00023de0: 2020 2020 7072 6563 6861 696e 203d 2027      prechain = '
+00023df0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00023e00: 2020 6169 7072 6563 6861 696e 203d 2027    aiprechain = '
+00023e10: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00023e20: 2020 7072 6572 6573 203d 2027 270a 2020    preres = ''.  
+00023e30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00023e40: 7363 6f75 6e74 203d 2030 0a20 2020 2020  scount = 0.     
+00023e50: 2020 2020 2020 2020 2020 2073 756d 6174             sumat
+00023e60: 6f6d 696e 7465 7262 696e 203d 2030 0a20  ominterbin = 0. 
+00023e70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00023e80: 6f72 2061 746f 6d20 696e 206d 6f64 656c  or atom in model
+00023e90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023ea0: 2020 2020 2020 6174 6f6d 636f 756e 7420        atomcount 
+00023eb0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00023ec0: 2020 2020 2020 2020 2023 2069 6620 2748           # if 'H
+00023ed0: 2720 6e6f 7420 696e 2061 746f 6d2e 6174  ' not in atom.at
+00023ee0: 6f6d 5f6e 616d 653a 0a20 2020 2020 2020  om_name:.       
+00023ef0: 2020 2020 2020 2020 2020 2020 206f 6e65               one
+00023f00: 636f 6f72 203d 205b 6174 6f6d 2e78 2c20  coor = [atom.x, 
+00023f10: 6174 6f6d 2e79 2c20 6174 6f6d 2e7a 5d0a  atom.y, atom.z].
+00023f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f30: 2020 2020 6f6e 6569 6e64 6578 203d 2073      oneindex = s
+00023f40: 656c 662e 5f5f 6765 7469 6e64 6963 6573  elf.__getindices
+00023f50: 286f 6e65 636f 6f72 295b 315d 0a20 2020  (onecoor)[1].   
+00023f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f70: 2069 6620 6f6e 6569 6e64 6578 5b30 5d20   if oneindex[0] 
+00023f80: 3e20 6d61 702e 785f 7369 7a65 2829 202d  > map.x_size() -
+00023f90: 2031 206f 7220 6f6e 6569 6e64 6578 5b30   1 or oneindex[0
+00023fa0: 5d20 3c20 3020 6f72 205c 0a20 2020 2020  ] < 0 or \.     
+00023fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023fc0: 2020 2020 2020 206f 6e65 696e 6465 785b         oneindex[
+00023fd0: 315d 203e 206d 6170 2e79 5f73 697a 6528  1] > map.y_size(
+00023fe0: 2920 2d20 3120 6f72 206f 6e65 696e 6465  ) - 1 or oneinde
+00023ff0: 785b 315d 203c 2030 206f 7220 5c0a 2020  x[1] < 0 or \.  
 00024000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024010: 2020 6174 6f6d 6f75 7473 6964 656e 756d    atomoutsidenum
-00024020: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00024030: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00024040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024050: 2020 2020 2020 2020 6375 7269 6e74 6572          curinter
-00024060: 706f 6c61 7469 6f6e 203d 206d 7969 6e74  polation = myint
-00024070: 6572 286f 6e65 696e 6465 7829 2e74 6f6c  er(oneindex).tol
-00024080: 6973 7428 295b 305d 0a20 2020 2020 2020  ist()[0].       
-00024090: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-000240a0: 6572 706f 6c61 7469 6f6e 732e 6170 7065  erpolations.appe
-000240b0: 6e64 2863 7572 696e 7465 7270 6f6c 6174  nd(curinterpolat
-000240c0: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
-000240d0: 2020 2020 2020 2020 2061 746f 6d69 6e74           atomint
-000240e0: 6572 6269 6e20 3d20 3120 6966 2063 7572  erbin = 1 if cur
-000240f0: 696e 7465 7270 6f6c 6174 696f 6e20 3e20  interpolation > 
-00024100: 636f 6e74 6f75 7220 656c 7365 2030 0a20  contour else 0. 
-00024110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024120: 2020 2069 6620 2872 6573 636f 756e 7420     if (rescount 
-00024130: 3d3d 2030 2920 6f72 2028 6174 6f6d 2e72  == 0) or (atom.r
-00024140: 6573 5f6e 6f20 3d3d 2070 7265 7265 7369  es_no == preresi
-00024150: 6420 616e 6420 6174 6f6d 2e63 6861 696e  d and atom.chain
-00024160: 203d 3d20 7072 6563 6861 696e 293a 0a20   == prechain):. 
-00024170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024180: 2020 2020 2020 2073 756d 6174 6f6d 696e         sumatomin
-00024190: 7465 7262 696e 202b 3d20 6174 6f6d 696e  terbin += atomin
-000241a0: 7465 7262 696e 0a20 2020 2020 2020 2020  terbin.         
-000241b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000241c0: 6573 636f 756e 7420 2b3d 2031 0a20 2020  escount += 1.   
-000241d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000241e0: 2020 2020 2070 7265 7265 7369 6420 3d20       preresid = 
-000241f0: 6174 6f6d 2e72 6573 5f6e 6f0a 2020 2020  atom.res_no.    
-00024200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024210: 2020 2020 7072 6563 6861 696e 203d 2061      prechain = a
-00024220: 746f 6d2e 6368 6169 6e0a 2020 2020 2020  tom.chain.      
+00024010: 2020 2020 2020 2020 2020 6f6e 6569 6e64            oneind
+00024020: 6578 5b32 5d20 3e20 6d61 702e 7a5f 7369  ex[2] > map.z_si
+00024030: 7a65 2829 202d 2031 206f 7220 6f6e 6569  ze() - 1 or onei
+00024040: 6e64 6578 5b32 5d20 3c20 303a 0a20 2020  ndex[2] < 0:.   
+00024050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024060: 2020 2020 2063 7572 696e 7465 7270 6f6c       curinterpol
+00024070: 6174 696f 6e20 3d20 6d61 702e 6d69 6e28  ation = map.min(
+00024080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024090: 2020 2020 2020 2020 2020 6174 6f6d 6f75            atomou
+000240a0: 7473 6964 656e 756d 202b 3d20 310a 2020  tsidenum += 1.  
+000240b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000240d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240e0: 6375 7269 6e74 6572 706f 6c61 7469 6f6e  curinterpolation
+000240f0: 203d 206d 7969 6e74 6572 286f 6e65 696e   = myinter(onein
+00024100: 6465 7829 2e74 6f6c 6973 7428 295b 305d  dex).tolist()[0]
+00024110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024120: 2020 2020 2069 6e74 6572 706f 6c61 7469       interpolati
+00024130: 6f6e 732e 6170 7065 6e64 2863 7572 696e  ons.append(curin
+00024140: 7465 7270 6f6c 6174 696f 6e29 0a20 2020  terpolation).   
+00024150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024160: 2061 746f 6d69 6e74 6572 6269 6e20 3d20   atominterbin = 
+00024170: 3120 6966 2063 7572 696e 7465 7270 6f6c  1 if curinterpol
+00024180: 6174 696f 6e20 3e20 636f 6e74 6f75 7220  ation > contour 
+00024190: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
+000241a0: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
+000241b0: 6573 636f 756e 7420 3d3d 2030 2920 6f72  escount == 0) or
+000241c0: 2028 6174 6f6d 2e72 6573 5f6e 6f20 3d3d   (atom.res_no ==
+000241d0: 2070 7265 7265 7369 6420 616e 6420 6174   preresid and at
+000241e0: 6f6d 2e63 6861 696e 203d 3d20 7072 6563  om.chain == prec
+000241f0: 6861 696e 293a 0a20 2020 2020 2020 2020  hain):.         
+00024200: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00024210: 756d 6174 6f6d 696e 7465 7262 696e 202b  umatominterbin +
+00024220: 3d20 6174 6f6d 696e 7465 7262 696e 0a20  = atominterbin. 
 00024230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024240: 2020 7072 6572 6573 203d 2061 746f 6d2e    preres = atom.
-00024250: 7265 730a 0a20 2020 2020 2020 2020 2020  res..           
-00024260: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00024270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024280: 2020 2020 2020 206b 6579 7374 7220 3d20         keystr = 
-00024290: 7072 6563 6861 696e 202b 2027 3a27 202b  prechain + ':' +
-000242a0: 2073 7472 2870 7265 7265 7369 6429 202b   str(preresid) +
-000242b0: 2070 7265 7265 730a 2020 2020 2020 2020   preres.        
-000242c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242d0: 616c 6c6b 6579 732e 6170 7065 6e64 286b  allkeys.append(k
-000242e0: 6579 7374 7229 0a20 2020 2020 2020 2020  eystr).         
-000242f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00024300: 2076 616c 7565 203d 2066 6c6f 6174 2873   value = float(s
-00024310: 756d 6174 6f6d 696e 7465 7262 696e 292f  umatominterbin)/
-00024320: 7265 7363 6f75 6e74 0a20 2020 2020 2020  rescount.       
-00024330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024340: 2076 616c 7565 203d 2066 6c6f 6174 2827   value = float('
-00024350: 252e 3466 2720 2520 726f 756e 6428 2866  %.4f' % round((f
-00024360: 6c6f 6174 2873 756d 6174 6f6d 696e 7465  loat(sumatominte
-00024370: 7262 696e 2920 2f20 7265 7363 6f75 6e74  rbin) / rescount
-00024380: 292c 2034 2929 0a20 2020 2020 2020 2020  ), 4)).         
-00024390: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000243a0: 6c6c 7661 6c75 6573 2e61 7070 656e 6428  llvalues.append(
-000243b0: 7661 6c75 6529 0a20 2020 2020 2020 2020  value).         
-000243c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000243d0: 756d 6174 6f6d 696e 7465 7262 696e 203d  umatominterbin =
-000243e0: 2061 746f 6d69 6e74 6572 6269 6e0a 2020   atominterbin.  
-000243f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024400: 2020 2020 2020 7072 6572 6573 6964 203d        preresid =
-00024410: 2061 746f 6d2e 7265 735f 6e6f 0a20 2020   atom.res_no.   
-00024420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024430: 2020 2020 2070 7265 6368 6169 6e20 3d20       prechain = 
-00024440: 6174 6f6d 2e63 6861 696e 0a20 2020 2020  atom.chain.     
-00024450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024460: 2020 2072 6573 636f 756e 7420 3d20 310a     rescount = 1.
-00024470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024480: 2020 2020 2023 2041 6464 2074 6865 2063       # Add the c
-00024490: 6861 696e 2062 6173 6564 2061 746f 6d20  hain based atom 
-000244a0: 696e 636c 7573 696f 6e20 7363 6f72 650a  inclusion score.
-000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244c0: 2020 2020 6966 2028 6174 6f6d 636f 756e      if (atomcoun
-000244d0: 7420 3d3d 2031 2920 6f72 2028 6174 6f6d  t == 1) or (atom
-000244e0: 2e63 6861 696e 203d 3d20 6169 7072 6563  .chain == aiprec
-000244f0: 6861 696e 293a 0a20 2020 2020 2020 2020  hain):.         
-00024500: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00024510: 6861 696e 6174 6f6d 7320 2b3d 2031 0a20  hainatoms += 1. 
-00024520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024530: 2020 2020 2020 2061 6970 7265 6368 6169         aiprechai
-00024540: 6e20 3d20 6174 6f6d 2e63 6861 696e 0a20  n = atom.chain. 
-00024550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024560: 2020 2020 2020 2063 6861 696e 6169 202b         chainai +
-00024570: 3d20 6174 6f6d 696e 7465 7262 696e 0a20  = atominterbin. 
+00024240: 2020 2020 2020 2072 6573 636f 756e 7420         rescount 
+00024250: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00024260: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00024270: 7265 7369 6420 3d20 6174 6f6d 2e72 6573  resid = atom.res
+00024280: 5f6e 6f0a 2020 2020 2020 2020 2020 2020  _no.            
+00024290: 2020 2020 2020 2020 2020 2020 7072 6563              prec
+000242a0: 6861 696e 203d 2061 746f 6d2e 6368 6169  hain = atom.chai
+000242b0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000242c0: 2020 2020 2020 2020 2020 7072 6572 6573            preres
+000242d0: 203d 2061 746f 6d2e 7265 730a 0a20 2020   = atom.res..   
+000242e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000242f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00024300: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00024310: 6579 7374 7220 3d20 7072 6563 6861 696e  eystr = prechain
+00024320: 202b 2027 3a27 202b 2073 7472 2870 7265   + ':' + str(pre
+00024330: 7265 7369 6429 202b 2070 7265 7265 730a  resid) + preres.
+00024340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024350: 2020 2020 2020 2020 616c 6c6b 6579 732e          allkeys.
+00024360: 6170 7065 6e64 286b 6579 7374 7229 0a20  append(keystr). 
+00024370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024380: 2020 2020 2020 2023 2076 616c 7565 203d         # value =
+00024390: 2066 6c6f 6174 2873 756d 6174 6f6d 696e   float(sumatomin
+000243a0: 7465 7262 696e 292f 7265 7363 6f75 6e74  terbin)/rescount
+000243b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000243c0: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+000243d0: 2066 6c6f 6174 2827 252e 3466 2720 2520   float('%.4f' % 
+000243e0: 726f 756e 6428 2866 6c6f 6174 2873 756d  round((float(sum
+000243f0: 6174 6f6d 696e 7465 7262 696e 2920 2f20  atominterbin) / 
+00024400: 7265 7363 6f75 6e74 292c 2034 2929 0a20  rescount), 4)). 
+00024410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024420: 2020 2020 2020 2061 6c6c 7661 6c75 6573         allvalues
+00024430: 2e61 7070 656e 6428 7661 6c75 6529 0a20  .append(value). 
+00024440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024450: 2020 2020 2020 2073 756d 6174 6f6d 696e         sumatomin
+00024460: 7465 7262 696e 203d 2061 746f 6d69 6e74  terbin = atomint
+00024470: 6572 6269 6e0a 2020 2020 2020 2020 2020  erbin.          
+00024480: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00024490: 6572 6573 6964 203d 2061 746f 6d2e 7265  eresid = atom.re
+000244a0: 735f 6e6f 0a20 2020 2020 2020 2020 2020  s_no.           
+000244b0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+000244c0: 6368 6169 6e20 3d20 6174 6f6d 2e63 6861  chain = atom.cha
+000244d0: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
+000244e0: 2020 2020 2020 2020 2020 2072 6573 636f             resco
+000244f0: 756e 7420 3d20 310a 0a20 2020 2020 2020  unt = 1..       
+00024500: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+00024510: 6464 2074 6865 2063 6861 696e 2062 6173  dd the chain bas
+00024520: 6564 2061 746f 6d20 696e 636c 7573 696f  ed atom inclusio
+00024530: 6e20 7363 6f72 650a 2020 2020 2020 2020  n score.        
+00024540: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00024550: 6174 6f6d 636f 756e 7420 3d3d 2031 2920  atomcount == 1) 
+00024560: 6f72 2028 6174 6f6d 2e63 6861 696e 203d  or (atom.chain =
+00024570: 3d20 6169 7072 6563 6861 696e 293a 0a20  = aiprechain):. 
 00024580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024590: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000245a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000245b0: 2061 6976 616c 7565 203d 2072 6f75 6e64   aivalue = round
-000245c0: 2866 6c6f 6174 2863 6861 696e 6169 2920  (float(chainai) 
-000245d0: 2f20 6368 6169 6e61 746f 6d73 2c20 3329  / chainatoms, 3)
-000245e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000245f0: 2020 2020 2020 2020 2061 6963 6f6c 6f72           aicolor
-00024600: 203d 2073 656c 662e 5f5f 666c 6f61 746f   = self.__floato
-00024610: 6865 7828 5b61 6976 616c 7565 5d29 5b30  hex([aivalue])[0
-00024620: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00024630: 2020 2020 2020 2020 2020 2320 6368 6169            # chai
-00024640: 6e61 6973 636f 7265 5b70 7265 6368 6169  naiscore[prechai
-00024650: 6e5d 203d 207b 2776 616c 7565 273a 2061  n] = {'value': a
-00024660: 6976 616c 7565 2c20 2763 6f6c 6f72 273a  ivalue, 'color':
-00024670: 2061 6963 6f6c 6f72 7d0a 2020 2020 2020   aicolor}.      
-00024680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024690: 2020 2320 2854 6f64 6f29 2046 6f72 2063    # (Todo) For c
-000246a0: 6861 696e 2077 6869 6368 2068 6176 6520  hain which have 
-000246b0: 7468 6520 7361 6d65 2063 6861 696e 2069  the same chain i
-000246c0: 6420 6e6f 6e2d 7072 6f74 6569 6e20 7061  d non-protein pa
-000246d0: 7274 206e 6f74 2069 6e63 6c75 6465 6420  rt not included 
-000246e0: 7965 7420 6573 7065 6369 616c 6c79 0a20  yet especially. 
-000246f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024700: 2020 2020 2020 2023 206c 6967 616e 6420         # ligand 
-00024710: 6269 6e64 2074 6f20 7468 6520 7072 6f74  bind to the prot
-00024720: 6569 6e20 6c69 6761 6e64 2068 6173 2074  ein ligand has t
-00024730: 6865 2073 616d 6520 6368 6169 6e20 6964  he same chain id
-00024740: 2061 7320 7468 6520 7072 6f74 6569 6e2c   as the protein,
-00024750: 2074 6865 6e20 686f 7720 746f 2061 7665   then how to ave
-00024760: 7267 650a 2020 2020 2020 2020 2020 2020  rge.            
-00024770: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-00024780: 6520 6c69 6761 6e64 2061 6e64 2074 6865  e ligand and the
-00024790: 2070 726f 7465 696e 2074 6f67 6574 6865   protein togethe
-000247a0: 7220 6e65 6564 2074 6f20 7461 6b65 2074  r need to take t
-000247b0: 6865 206e 756d 6265 7273 2069 6e74 6f20  he numbers into 
-000247c0: 6163 636f 756e 7420 7768 6963 6820 616c  account which al
-000247d0: 736f 206d 6561 6e73 0a20 2020 2020 2020  so means.       
-000247e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000247f0: 2023 206e 6565 6420 746f 2061 6464 2061   # need to add a
-00024800: 6e6f 7468 6572 2076 616c 7565 2069 6e20  nother value in 
-00024810: 7468 6520 6469 6374 6f6e 6172 790a 2020  the dictonary.  
-00024820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024830: 2020 2020 2020 2320 4e65 6564 2074 6f20        # Need to 
-00024840: 7072 6f70 6572 6c79 2063 616e 6375 6c61  properly cancula
-00024850: 7465 6420 7468 6520 6176 6572 6167 6520  ted the average 
-00024860: 6f66 206f 6e65 2063 6861 696e 0a20 2020  of one chain.   
-00024870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024880: 2020 2020 2069 6620 6169 7072 6563 6861       if aiprecha
-00024890: 696e 2069 6e20 6368 6169 6e61 6973 636f  in in chainaisco
-000248a0: 7265 2e6b 6579 7328 293a 0a20 2020 2020  re.keys():.     
-000248b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000248c0: 2020 2020 2020 2023 2063 6861 696e 6169         # chainai
-000248d0: 7363 6f72 655b 6169 7072 6563 6861 696e  score[aiprechain
-000248e0: 202b 2027 5f27 202b 2073 7472 2861 6976   + '_' + str(aiv
-000248f0: 616c 7565 295d 203d 207b 2776 616c 7565  alue)] = {'value
-00024900: 273a 2061 6976 616c 7565 2c20 2763 6f6c  ': aivalue, 'col
-00024910: 6f72 273a 2061 6963 6f6c 6f72 7d0a 2020  or': aicolor}.  
-00024920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024930: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00024940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024950: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00024960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024970: 2020 2020 2020 2020 2063 6861 696e 6169           chainai
-00024980: 7363 6f72 655b 6169 7072 6563 6861 696e  score[aiprechain
-00024990: 5d20 3d20 7b27 7661 6c75 6527 3a20 6169  ] = {'value': ai
-000249a0: 7661 6c75 652c 2027 636f 6c6f 7227 3a20  value, 'color': 
-000249b0: 6169 636f 6c6f 722c 2027 6e75 6d62 6572  aicolor, 'number
-000249c0: 4f66 4174 6f6d 7327 3a20 6368 6169 6e61  OfAtoms': chaina
-000249d0: 746f 6d73 7d0a 0a20 2020 2020 2020 2020  toms}..         
-000249e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000249f0: 6861 696e 6174 6f6d 7320 3d20 310a 2020  hainatoms = 1.  
-00024a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a10: 2020 2020 2020 6368 6169 6e63 6f75 6e74        chaincount
-00024a20: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00024a30: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00024a40: 6169 6e61 6920 3d20 6174 6f6d 696e 7465  ainai = atominte
-00024a50: 7262 696e 0a20 2020 2020 2020 2020 2020  rbin.           
-00024a60: 2020 2020 2020 2020 2020 2020 2061 6970               aip
-00024a70: 7265 6368 6169 6e20 3d20 6174 6f6d 2e63  rechain = atom.c
-00024a80: 6861 696e 0a0a 2020 2020 2020 2020 2020  hain..          
-00024a90: 2020 2020 2020 6169 7661 6c75 6520 3d20        aivalue = 
-00024aa0: 726f 756e 6428 666c 6f61 7428 6368 6169  round(float(chai
-00024ab0: 6e61 6929 202f 2063 6861 696e 6174 6f6d  nai) / chainatom
-00024ac0: 732c 2033 290a 2020 2020 2020 2020 2020  s, 3).          
-00024ad0: 2020 2020 2020 6169 636f 6c6f 7220 3d20        aicolor = 
-00024ae0: 7365 6c66 2e5f 5f66 6c6f 6174 6f68 6578  self.__floatohex
-00024af0: 285b 6169 7661 6c75 655d 295b 305d 0a20  ([aivalue])[0]. 
-00024b00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00024b10: 6620 6169 7072 6563 6861 696e 2069 6e20  f aiprechain in 
-00024b20: 6368 6169 6e61 6973 636f 7265 2e6b 6579  chainaiscore.key
-00024b30: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00024b40: 2020 2020 2020 2020 2023 2063 6861 696e           # chain
-00024b50: 6169 7363 6f72 655b 6169 7072 6563 6861  aiscore[aiprecha
-00024b60: 696e 202b 2027 5f27 202b 2073 7472 2861  in + '_' + str(a
-00024b70: 6976 616c 7565 295d 203d 207b 2776 616c  ivalue)] = {'val
-00024b80: 7565 273a 2061 6976 616c 7565 2c20 2763  ue': aivalue, 'c
-00024b90: 6f6c 6f72 273a 2061 6963 6f6c 6f72 7d0a  olor': aicolor}.
-00024ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024bb0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00024bc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00024bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024be0: 2020 2063 6861 696e 6169 7363 6f72 655b     chainaiscore[
-00024bf0: 6169 7072 6563 6861 696e 5d20 3d20 7b27  aiprechain] = {'
-00024c00: 7661 6c75 6527 3a20 6169 7661 6c75 652c  value': aivalue,
-00024c10: 2027 636f 6c6f 7227 3a20 6169 636f 6c6f   'color': aicolo
-00024c20: 722c 2027 6e75 6d62 6572 4f66 4174 6f6d  r, 'numberOfAtom
-00024c30: 7327 3a20 6368 6169 6e61 746f 6d73 7d0a  s': chainatoms}.
-00024c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024c50: 6b65 7973 7472 203d 2061 6970 7265 6368  keystr = aiprech
-00024c60: 6169 6e20 2b20 273a 2720 2b20 7374 7228  ain + ':' + str(
-00024c70: 7072 6572 6573 6964 2920 2b20 7072 6572  preresid) + prer
-00024c80: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-00024c90: 2020 2061 6c6c 6b65 7973 2e61 7070 656e     allkeys.appen
-00024ca0: 6428 6b65 7973 7472 290a 2020 2020 2020  d(keystr).      
-00024cb0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-00024cc0: 3d20 666c 6f61 7428 2725 2e34 6627 2025  = float('%.4f' %
-00024cd0: 2072 6f75 6e64 2828 666c 6f61 7428 7375   round((float(su
-00024ce0: 6d61 746f 6d69 6e74 6572 6269 6e29 202f  matominterbin) /
-00024cf0: 2072 6573 636f 756e 7429 2c20 3429 290a   rescount), 4)).
-00024d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d10: 616c 6c76 616c 7565 732e 6170 7065 6e64  allvalues.append
-00024d20: 2876 616c 7565 290a 2020 2020 2020 2020  (value).        
-00024d30: 2020 2020 2020 2020 616c 6c63 6f6e 746f          allconto
-00024d40: 7572 7364 6963 745b 7374 7228 636f 6e74  ursdict[str(cont
-00024d50: 6f75 7229 5d20 3d20 2861 6c6c 6b65 7973  our)] = (allkeys
-00024d60: 2c20 616c 6c76 616c 7565 7329 0a20 2020  , allvalues).   
-00024d70: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00024d80: 6e74 2827 4d6f 6465 6c3a 2025 7320 6174  nt('Model: %s at
-00024d90: 2063 6f6e 746f 7572 206c 6576 656c 2025   contour level %
-00024da0: 7320 6861 7320 2573 2061 746f 6d73 2073  s has %s atoms s
-00024db0: 7469 636b 206f 7574 206f 6620 7468 6520  tick out of the 
-00024dc0: 6465 6e73 6974 792e 2720 2520 286d 6f64  density.' % (mod
-00024dd0: 656c 6e61 6d65 2c20 636f 6e74 6f75 722c  elname, contour,
-00024de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e40: 2020 6174 6f6d 6f75 7473 6964 656e 756d    atomoutsidenum
-00024e50: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00024e60: 2320 7265 7375 6c74 5b6d 6f64 656c 6e61  # result[modelna
-00024e70: 6d65 5d20 3d20 2869 6e74 6572 706f 6c61  me] = (interpola
-00024e80: 7469 6f6e 732c 2061 6c6c 6b65 7973 2c20  tions, allkeys, 
-00024e90: 616c 6c76 616c 7565 7329 0a20 2020 2020  allvalues).     
-00024ea0: 2020 2020 2020 2023 2072 6573 756c 743a         # result:
-00024eb0: 207b 6d6f 6465 6c6e 616d 6520 2331 3a20   {modelname #1: 
-00024ec0: 2869 6e74 6572 706f 6c61 7469 6f6e 7320  (interpolations 
-00024ed0: 2331 2c20 7b63 6f6e 746f 7572 313a 2028  #1, {contour1: (
-00024ee0: 616c 6c6b 6579 732c 2061 6c6c 7661 6c75  allkeys, allvalu
-00024ef0: 6573 292c 2063 6f6e 746f 7572 323a 2028  es), contour2: (
-00024f00: 616c 6c6b 6579 732c 2061 6c6c 7661 6c75  allkeys, allvalu
-00024f10: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00024f20: 2320 2e2e 2e7d 292c 206d 6f64 656c 6e61  # ...}), modelna
-00024f30: 6d65 2023 323a 2028 696e 7465 7270 6f6c  me #2: (interpol
-00024f40: 6174 696f 6e73 2023 322c 207b 636f 6e74  ations #2, {cont
-00024f50: 6f75 7231 3a20 2861 6c6c 6b65 7973 2c20  our1: (allkeys, 
-00024f60: 616c 6c76 616c 7565 7329 2c2e 2e2e 7d29  allvalues),...})
-00024f70: 2c2e 2e2e 7d0a 2020 2020 2020 2020 2020  ,...}.          
-00024f80: 2020 7265 7375 6c74 5b6d 6f64 656c 6e61    result[modelna
-00024f90: 6d65 5d20 3d20 2869 6e74 6572 706f 6c61  me] = (interpola
-00024fa0: 7469 6f6e 732c 2061 6c6c 636f 6e74 6f75  tions, allcontou
-00024fb0: 7273 6469 6374 2c20 6368 6169 6e61 6973  rsdict, chainais
-00024fc0: 636f 7265 2c20 6174 6f6d 6f75 7473 6964  core, atomoutsid
-00024fd0: 656e 756d 290a 0a20 2020 2020 2020 2072  enum)..        r
-00024fe0: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
-00024ff0: 2020 2320 7665 7273 696f 6e20 3220 7769    # version 2 wi
-00025000: 7468 6f75 7420 7573 696e 6720 5445 4d50  thout using TEMP
-00025010: 7920 666f 7220 6d6f 6465 6c20 6c6f 6164  y for model load
-00025020: 696e 6720 7768 6963 6820 6973 2077 6f72  ing which is wor
-00025030: 6b69 6e67 2062 7574 206e 6f74 206f 7074  king but not opt
-00025040: 696d 616c 2066 6f72 2075 7369 6e67 2062  imal for using b
-00025050: 696f 7079 7468 6f6e 0a20 2020 2064 6566  iopython.    def
-00025060: 205f 5f6e 6577 696e 7465 7274 6869 7264   __newinterthird
-00025070: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00025080: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
-00025090: 2049 6e74 6572 706f 6c61 7465 2064 656e   Interpolate den
-000250a0: 7369 7479 2076 616c 7565 206f 6620 6f6e  sity value of on
-000250b0: 6520 6174 6f6d 2c20 6966 2069 6e64 6963  e atom, if indic
-000250c0: 6573 2061 7265 206f 6e20 7468 6520 7361  es are on the sa
-000250d0: 6d65 2070 6c61 6e65 2075 7365 206e 6561  me plane use nea
-000250e0: 7265 7374 206d 6574 686f 640a 2020 2020  rest method.    
-000250f0: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
-00025100: 6520 7573 6520 6c69 6e65 6172 0a0a 2020  e use linear..  
-00025110: 2020 2020 2020 3a70 6172 616d 206d 6170        :param map
-00025120: 3a20 5445 4d50 7920 6d61 7020 696e 7374  : TEMPy map inst
-00025130: 616e 6365 0a20 2020 2020 2020 203a 7061  ance.        :pa
-00025140: 7261 6d20 6d6f 6465 6c3a 2053 7472 7563  ram model: Struc
-00025150: 7475 7265 2069 6e73 7461 6e63 6520 6672  ture instance fr
-00025160: 6f6d 2054 454d 5079 2070 6163 6b61 6765  om TEMPy package
-00025170: 206d 6d63 6966 2070 6172 7365 720a 2020   mmcif parser.  
-00025180: 2020 2020 2020 3a72 6574 7572 6e3a 204c        :return: L
-00025190: 6973 7420 636f 6e74 6169 6e73 2061 6c6c  ist contains all
-000251a0: 2064 656e 7369 7479 2069 6e74 6572 706f   density interpo
-000251b0: 6c61 7469 6f6e 7320 6f66 2061 746f 6d73  lations of atoms
-000251c0: 2066 726f 6d20 6d6f 6465 6c0a 0a20 2020   from model..   
-000251d0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000251e0: 2020 6d79 696e 7465 7220 3d20 7365 6c66    myinter = self
-000251f0: 2e5f 5f69 6e74 6572 506f 6c61 7469 6f6e  .__interPolation
-00025200: 2829 0a20 2020 2020 2020 2023 204d 6967  ().        # Mig
-00025210: 6874 2068 6176 696e 6720 6d75 6c74 706c  ht having multpl
-00025220: 6520 6d6f 6465 6c73 0a20 2020 2020 2020  e models.       
-00025230: 206d 6f64 656c 7320 3d20 5b5d 0a20 2020   models = [].   
-00025240: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00025250: 6365 2873 656c 662e 6d6f 6465 6c73 2c20  ce(self.models, 
-00025260: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-00025270: 2020 206d 6f64 656c 7320 3d20 7365 6c66     models = self
-00025280: 2e6d 6f64 656c 730a 2020 2020 2020 2020  .models.        
-00025290: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000252a0: 2020 6d6f 6465 6c73 2e61 7070 656e 6428    models.append(
-000252b0: 7365 6c66 2e6d 6f64 656c 7329 0a20 2020  self.models).   
-000252c0: 2020 2020 206d 6170 203d 2073 656c 662e       map = self.
-000252d0: 6d61 700a 2020 2020 2020 2020 636f 6e74  map.        cont
-000252e0: 6f75 7220 3d20 7365 6c66 2e63 6c0a 2020  our = self.cl.  
-000252f0: 2020 2020 2020 2320 5261 6e67 6520 6f66        # Range of
-00025300: 2063 6f6e 746f 7572 206c 6576 656c 2076   contour level v
-00025310: 616c 7565 7320 666f 7220 7363 616c 6572  alues for scaler
-00025320: 2062 6172 0a20 2020 2020 2020 2023 2054   bar.        # T
-00025330: 6f64 6f3a 2052 6967 6874 206e 6f77 2077  odo: Right now w
-00025340: 6974 6820 6669 7865 6420 6e75 6d62 6572  ith fixed number
-00025350: 206f 6620 706f 696e 7473 206f 6e20 626f   of points on bo
-00025360: 7468 2073 6964 6573 206f 6620 7468 6520  th sides of the 
-00025370: 7265 636f 6d6d 656e 6465 6420 636f 6e74  recommended cont
-00025380: 6f75 7220 6c65 7665 6c2c 2063 6f75 6c64  our level, could
-00025390: 2069 6d70 726f 7665 2074 6f0a 2020 2020   improve to.    
-000253a0: 2020 2020 2320 546f 646f 3a20 6765 6e65      # Todo: gene
-000253b0: 7261 7465 2061 2072 6561 736f 6e61 626c  rate a reasonabl
-000253c0: 6520 7261 6e67 6520 7375 7272 6f75 6e64  e range surround
-000253d0: 2074 6865 2072 6563 6f6d 6d65 6e64 6564   the recommended
-000253e0: 2063 6f6e 746f 7572 206c 6576 656c 0a20   contour level. 
-000253f0: 2020 2020 2020 2023 2053 6574 7469 6e67         # Setting
-00025400: 2061 2073 6d61 7274 6572 2072 616e 6765   a smarter range
-00025410: 2062 6574 7765 656e 2028 636f 6e74 6f75   between (contou
-00025420: 722d 7369 672c 636f 6e74 6f75 722c 2063  r-sig,contour, c
-00025430: 6f75 6e74 6f75 7220 2b20 7369 6729 0a20  ountour + sig). 
-00025440: 2020 2020 2020 2023 206d 6170 7369 6720         # mapsig 
-00025450: 3d20 6d61 702e 7374 6428 290a 2020 2020  = map.std().    
-00025460: 2020 2020 2320 636f 6e74 6f75 7272 616e      # contourran
-00025470: 6765 203d 206e 702e 636f 6e63 6174 656e  ge = np.concaten
-00025480: 6174 6528 286e 702e 6c69 6e73 7061 6365  ate((np.linspace
-00025490: 2863 6f6e 746f 7572 202d 2066 6c6f 6174  (contour - float
-000254a0: 2831 2e35 202a 206d 6170 7369 6729 2c20  (1.5 * mapsig), 
-000254b0: 636f 6e74 6f75 722c 2033 2c20 656e 6470  contour, 3, endp
-000254c0: 6f69 6e74 3d46 616c 7365 292c 0a20 2020  oint=False),.   
-000254d0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-000254e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000254f0: 2020 2020 2020 6e70 2e6c 696e 7370 6163        np.linspac
-00025500: 6528 636f 6e74 6f75 722c 2063 6f6e 746f  e(contour, conto
-00025510: 7572 202b 2066 6c6f 6174 2831 2e35 202a  ur + float(1.5 *
-00025520: 206d 6170 7369 6729 2c20 3429 292c 2061   mapsig), 4)), a
-00025530: 7869 733d 4e6f 6e65 290a 2020 2020 2020  xis=None).      
-00025540: 2020 2320 636f 6e74 6f75 7272 616e 6765    # contourrange
-00025550: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
-00025560: 6528 286e 702e 6c69 6e73 7061 6365 286d  e((np.linspace(m
-00025570: 6170 2e6d 696e 2829 2c20 636f 6e74 6f75  ap.min(), contou
-00025580: 722c 2033 2c20 656e 6470 6f69 6e74 3d46  r, 3, endpoint=F
-00025590: 616c 7365 292c 206e 702e 6c69 6e73 7061  alse), np.linspa
-000255a0: 6365 2863 6f6e 746f 7572 2c20 6d61 702e  ce(contour, map.
-000255b0: 6d61 7828 292c 2033 2929 2c20 6178 6973  max(), 3)), axis
-000255c0: 3d4e 6f6e 6529 0a20 2020 2020 2020 2023  =None).        #
-000255d0: 2057 6865 6e20 7275 6e6e 696e 6720 666f   When running fo
-000255e0: 7220 454d 4442 206b 6565 7020 6974 2061  r EMDB keep it a
-000255f0: 7320 6120 666c 6578 6962 6c65 2072 616e  s a flexible ran
-00025600: 6765 2066 6f72 206f 6e65 6465 7020 6f72  ge for onedep or
-00025610: 206f 7468 6572 2075 7365 7273 206f 6e6c   other users onl
-00025620: 7920 7275 6e20 6974 206f 6e63 6520 666f  y run it once fo
-00025630: 7220 7265 636f 6d6d 656e 6465 640a 2020  r recommended.  
-00025640: 2020 2020 2020 2320 636f 6e74 6f75 7220        # contour 
-00025650: 6c65 7665 6c3a 0a0a 2020 2020 2020 2020  level:..        
-00025660: 2320 6966 2073 656c 662e 656d 6469 643a  # if self.emdid:
-00025670: 0a20 2020 2020 2020 2023 2020 2020 2063  .        #     c
-00025680: 6f6e 746f 7572 7261 6e67 6520 3d20 6e70  ontourrange = np
-00025690: 2e63 6f6e 6361 7465 6e61 7465 2828 6e70  .concatenate((np
-000256a0: 2e6c 696e 7370 6163 6528 636f 6e74 6f75  .linspace(contou
-000256b0: 7220 2d20 666c 6f61 7428 312e 3520 2a20  r - float(1.5 * 
-000256c0: 6d61 7073 6967 292c 2063 6f6e 746f 7572  mapsig), contour
-000256d0: 2c20 332c 2065 6e64 706f 696e 743d 4661  , 3, endpoint=Fa
-000256e0: 6c73 6529 2c0a 2020 2020 2020 2020 2320  lse),.        # 
-000256f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025710: 2020 206e 702e 6c69 6e73 7061 6365 2863     np.linspace(c
-00025720: 6f6e 746f 7572 2c20 636f 6e74 6f75 7220  ontour, contour 
-00025730: 2b20 666c 6f61 7428 312e 3520 2a20 6d61  + float(1.5 * ma
-00025740: 7073 6967 292c 2034 2929 2c20 6178 6973  psig), 4)), axis
-00025750: 3d4e 6f6e 6529 0a20 2020 2020 2020 2023  =None).        #
-00025760: 2065 6c73 653a 0a20 2020 2020 2020 2023   else:.        #
-00025770: 2020 2020 2063 6f6e 746f 7572 7261 6e67       contourrang
-00025780: 6520 3d20 6e70 2e61 7361 7272 6179 285b  e = np.asarray([
-00025790: 636f 6e74 6f75 725d 290a 0a20 2020 2020  contour])..     
-000257a0: 2020 2063 6f6e 746f 7572 7261 6e67 6520     contourrange 
-000257b0: 3d20 6e70 2e61 7361 7272 6179 285b 636f  = np.asarray([co
-000257c0: 6e74 6f75 725d 290a 2020 2020 2020 2020  ntour]).        
-000257d0: 7265 7375 6c74 203d 207b 7d0a 2020 2020  result = {}.    
-000257e0: 2020 2020 666f 7220 6d6f 6465 6c20 696e      for model in
-000257f0: 206d 6f64 656c 733a 0a20 2020 2020 2020   models:.       
-00025800: 2020 2020 2061 6c6c 636f 6e74 6f75 7273       allcontours
-00025810: 6469 6374 203d 204f 7264 6572 6564 4469  dict = OrderedDi
-00025820: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
-00025830: 2061 746f 6d6f 7574 7369 6465 6e75 6d20   atomoutsidenum 
-00025840: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00025850: 6d6f 6465 6c6e 616d 6520 3d20 6d6f 6465  modelname = mode
-00025860: 6c2e 6669 6c65 6e61 6d65 2e73 706c 6974  l.filename.split
-00025870: 2827 2f27 295b 2d31 5d0a 0a20 2020 2020  ('/')[-1]..     
-00025880: 2020 2020 2020 2061 746f 6d63 6f75 6e74         atomcount
-00025890: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-000258a0: 2063 6861 696e 636f 756e 7420 3d20 310a   chaincount = 1.
-000258b0: 2020 2020 2020 2020 2020 2020 6368 6169              chai
-000258c0: 6e61 746f 6d73 203d 2030 0a20 2020 2020  natoms = 0.     
-000258d0: 2020 2020 2020 2063 6861 696e 6169 7363         chainaisc
-000258e0: 6f72 6520 3d20 7b7d 0a20 2020 2020 2020  ore = {}.       
-000258f0: 2020 2020 2063 6861 696e 6169 203d 2030       chainai = 0
-00025900: 2e0a 0a20 2020 2020 2020 2020 2020 2066  ...            f
-00025910: 6f72 2063 6f6e 746f 7572 2069 6e20 636f  or contour in co
-00025920: 6e74 6f75 7272 616e 6765 3a0a 2020 2020  ntourrange:.    
-00025930: 2020 2020 2020 2020 2020 2020 696e 7465              inte
-00025940: 7270 6f6c 6174 696f 6e73 203d 205b 5d0a  rpolations = [].
-00025950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025960: 616c 6c6b 6579 7320 3d20 5b5d 0a20 2020  allkeys = [].   
-00025970: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
-00025980: 7661 6c75 6573 203d 205b 5d0a 2020 2020  values = [].    
-00025990: 2020 2020 2020 2020 2020 2020 7072 6572              prer
-000259a0: 6573 6964 203d 2030 0a20 2020 2020 2020  esid = 0.       
-000259b0: 2020 2020 2020 2020 2070 7265 6368 6169           prechai
-000259c0: 6e20 3d20 2727 0a20 2020 2020 2020 2020  n = ''.         
-000259d0: 2020 2020 2020 2061 6970 7265 6368 6169         aiprechai
-000259e0: 6e20 3d20 2727 0a20 2020 2020 2020 2020  n = ''.         
-000259f0: 2020 2020 2020 2070 7265 7265 7320 3d20         preres = 
-00025a00: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
-00025a10: 2020 2072 6573 636f 756e 7420 3d20 300a     rescount = 0.
-00025a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a30: 7375 6d61 746f 6d69 6e74 6572 6269 6e20  sumatominterbin 
-00025a40: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00025a50: 2020 2020 666f 7220 6174 6f6d 2069 6e20      for atom in 
-00025a60: 6d6f 6465 6c2e 6765 745f 6174 6f6d 7328  model.get_atoms(
-00025a70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00025a80: 2020 2020 2020 2061 746f 6d63 6f75 6e74         atomcount
-00025a90: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00025aa0: 2020 2020 2020 2020 2020 2320 6966 2027            # if '
-00025ab0: 4827 206e 6f74 2069 6e20 6174 6f6d 2e61  H' not in atom.a
-00025ac0: 746f 6d5f 6e61 6d65 3a0a 2020 2020 2020  tom_name:.      
-00025ad0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00025ae0: 6f6e 6563 6f6f 7220 3d20 5b61 746f 6d2e  onecoor = [atom.
-00025af0: 782c 2061 746f 6d2e 792c 2061 746f 6d2e  x, atom.y, atom.
-00025b00: 7a5d 0a20 2020 2020 2020 2020 2020 2020  z].             
-00025b10: 2020 2020 2020 206f 6e65 636f 6f72 203d         onecoor =
-00025b20: 2061 746f 6d2e 636f 6f72 640a 2020 2020   atom.coord.    
-00025b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b40: 6f6e 6569 6e64 6578 203d 2073 656c 662e  oneindex = self.
-00025b50: 5f5f 6765 7469 6e64 6963 6573 286f 6e65  __getindices(one
-00025b60: 636f 6f72 295b 315d 0a20 2020 2020 2020  coor)[1].       
-00025b70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00025b80: 6f6e 6569 6e64 6578 5b30 5d20 3e20 6d61  oneindex[0] > ma
-00025b90: 702e 6865 6164 6572 2e6e 7820 2d20 3120  p.header.nx - 1 
-00025ba0: 6f72 206f 6e65 696e 6465 785b 305d 203c  or oneindex[0] <
-00025bb0: 2030 206f 7220 5c0a 2020 2020 2020 2020   0 or \.        
-00025bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025bd0: 2020 2020 6f6e 6569 6e64 6578 5b31 5d20      oneindex[1] 
-00025be0: 3e20 6d61 702e 6865 6164 6572 2e6e 7920  > map.header.ny 
-00025bf0: 2d20 3120 6f72 206f 6e65 696e 6465 785b  - 1 or oneindex[
-00025c00: 315d 203c 2030 206f 7220 5c0a 2020 2020  1] < 0 or \.    
-00025c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c20: 2020 2020 2020 2020 6f6e 6569 6e64 6578          oneindex
-00025c30: 5b32 5d20 3e20 6d61 702e 6865 6164 6572  [2] > map.header
-00025c40: 2e6e 7a20 2d20 3120 6f72 206f 6e65 696e  .nz - 1 or onein
-00025c50: 6465 785b 325d 203c 2030 3a0a 2020 2020  dex[2] < 0:.    
-00025c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c70: 2020 2020 6375 7269 6e74 6572 706f 6c61      curinterpola
-00025c80: 7469 6f6e 203d 206d 6170 2e6d 696e 2829  tion = map.min()
-00025c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025ca0: 2020 2020 2020 2020 2061 746f 6d6f 7574           atomout
-00025cb0: 7369 6465 6e75 6d20 2b3d 2031 0a20 2020  sidenum += 1.   
-00025cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025cd0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00025ce0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00025cf0: 7572 696e 7465 7270 6f6c 6174 696f 6e20  urinterpolation 
-00025d00: 3d20 6d79 696e 7465 7228 6f6e 6569 6e64  = myinter(oneind
-00025d10: 6578 292e 746f 6c69 7374 2829 5b30 5d0a  ex).tolist()[0].
+00024590: 2020 2020 2020 2063 6861 696e 6174 6f6d         chainatom
+000245a0: 7320 2b3d 2031 0a20 2020 2020 2020 2020  s += 1.         
+000245b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000245c0: 6970 7265 6368 6169 6e20 3d20 6174 6f6d  iprechain = atom
+000245d0: 2e63 6861 696e 0a20 2020 2020 2020 2020  .chain.         
+000245e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000245f0: 6861 696e 6169 202b 3d20 6174 6f6d 696e  hainai += atomin
+00024600: 7465 7262 696e 0a20 2020 2020 2020 2020  terbin.         
+00024610: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00024620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024630: 2020 2020 2020 2020 2061 6976 616c 7565           aivalue
+00024640: 203d 2072 6f75 6e64 2866 6c6f 6174 2863   = round(float(c
+00024650: 6861 696e 6169 2920 2f20 6368 6169 6e61  hainai) / chaina
+00024660: 746f 6d73 2c20 3329 0a20 2020 2020 2020  toms, 3).       
+00024670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024680: 2061 6963 6f6c 6f72 203d 2073 656c 662e   aicolor = self.
+00024690: 5f5f 666c 6f61 746f 6865 7828 5b61 6976  __floatohex([aiv
+000246a0: 616c 7565 5d29 5b30 5d0a 2020 2020 2020  alue])[0].      
+000246b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000246c0: 2020 2320 6368 6169 6e61 6973 636f 7265    # chainaiscore
+000246d0: 5b70 7265 6368 6169 6e5d 203d 207b 2776  [prechain] = {'v
+000246e0: 616c 7565 273a 2061 6976 616c 7565 2c20  alue': aivalue, 
+000246f0: 2763 6f6c 6f72 273a 2061 6963 6f6c 6f72  'color': aicolor
+00024700: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00024710: 2020 2020 2020 2020 2020 2320 2854 6f64            # (Tod
+00024720: 6f29 2046 6f72 2063 6861 696e 2077 6869  o) For chain whi
+00024730: 6368 2068 6176 6520 7468 6520 7361 6d65  ch have the same
+00024740: 2063 6861 696e 2069 6420 6e6f 6e2d 7072   chain id non-pr
+00024750: 6f74 6569 6e20 7061 7274 206e 6f74 2069  otein part not i
+00024760: 6e63 6c75 6465 6420 7965 7420 6573 7065  ncluded yet espe
+00024770: 6369 616c 6c79 0a20 2020 2020 2020 2020  cially.         
+00024780: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00024790: 206c 6967 616e 6420 6269 6e64 2074 6f20   ligand bind to 
+000247a0: 7468 6520 7072 6f74 6569 6e20 6c69 6761  the protein liga
+000247b0: 6e64 2068 6173 2074 6865 2073 616d 6520  nd has the same 
+000247c0: 6368 6169 6e20 6964 2061 7320 7468 6520  chain id as the 
+000247d0: 7072 6f74 6569 6e2c 2074 6865 6e20 686f  protein, then ho
+000247e0: 7720 746f 2061 7665 7267 650a 2020 2020  w to averge.    
+000247f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024800: 2020 2020 2320 7468 6520 6c69 6761 6e64      # the ligand
+00024810: 2061 6e64 2074 6865 2070 726f 7465 696e   and the protein
+00024820: 2074 6f67 6574 6865 7220 6e65 6564 2074   together need t
+00024830: 6f20 7461 6b65 2074 6865 206e 756d 6265  o take the numbe
+00024840: 7273 2069 6e74 6f20 6163 636f 756e 7420  rs into account 
+00024850: 7768 6963 6820 616c 736f 206d 6561 6e73  which also means
+00024860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024870: 2020 2020 2020 2020 2023 206e 6565 6420           # need 
+00024880: 746f 2061 6464 2061 6e6f 7468 6572 2076  to add another v
+00024890: 616c 7565 2069 6e20 7468 6520 6469 6374  alue in the dict
+000248a0: 6f6e 6172 790a 2020 2020 2020 2020 2020  onary.          
+000248b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000248c0: 4e65 6564 2074 6f20 7072 6f70 6572 6c79  Need to properly
+000248d0: 2063 616e 6375 6c61 7465 6420 7468 6520   canculated the 
+000248e0: 6176 6572 6167 6520 6f66 206f 6e65 2063  average of one c
+000248f0: 6861 696e 0a20 2020 2020 2020 2020 2020  hain.           
+00024900: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00024910: 6169 7072 6563 6861 696e 2069 6e20 6368  aiprechain in ch
+00024920: 6169 6e61 6973 636f 7265 2e6b 6579 7328  ainaiscore.keys(
+00024930: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00024940: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00024950: 2063 6861 696e 6169 7363 6f72 655b 6169   chainaiscore[ai
+00024960: 7072 6563 6861 696e 202b 2027 5f27 202b  prechain + '_' +
+00024970: 2073 7472 2861 6976 616c 7565 295d 203d   str(aivalue)] =
+00024980: 207b 2776 616c 7565 273a 2061 6976 616c   {'value': aival
+00024990: 7565 2c20 2763 6f6c 6f72 273a 2061 6963  ue, 'color': aic
+000249a0: 6f6c 6f72 7d0a 2020 2020 2020 2020 2020  olor}.          
+000249b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000249c0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+000249d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000249e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000249f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a00: 2063 6861 696e 6169 7363 6f72 655b 6169   chainaiscore[ai
+00024a10: 7072 6563 6861 696e 5d20 3d20 7b27 7661  prechain] = {'va
+00024a20: 6c75 6527 3a20 6169 7661 6c75 652c 2027  lue': aivalue, '
+00024a30: 636f 6c6f 7227 3a20 6169 636f 6c6f 722c  color': aicolor,
+00024a40: 2027 6e75 6d62 6572 4f66 4174 6f6d 7327   'numberOfAtoms'
+00024a50: 3a20 6368 6169 6e61 746f 6d73 7d0a 0a20  : chainatoms}.. 
+00024a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a70: 2020 2020 2020 2063 6861 696e 6174 6f6d         chainatom
+00024a80: 7320 3d20 310a 2020 2020 2020 2020 2020  s = 1.          
+00024a90: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00024aa0: 6169 6e63 6f75 6e74 202b 3d20 310a 2020  aincount += 1.  
+00024ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ac0: 2020 2020 2020 6368 6169 6e61 6920 3d20        chainai = 
+00024ad0: 6174 6f6d 696e 7465 7262 696e 0a20 2020  atominterbin.   
+00024ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024af0: 2020 2020 2061 6970 7265 6368 6169 6e20       aiprechain 
+00024b00: 3d20 6174 6f6d 2e63 6861 696e 0a0a 2020  = atom.chain..  
+00024b10: 2020 2020 2020 2020 2020 2020 2020 6169                ai
+00024b20: 7661 6c75 6520 3d20 726f 756e 6428 666c  value = round(fl
+00024b30: 6f61 7428 6368 6169 6e61 6929 202f 2063  oat(chainai) / c
+00024b40: 6861 696e 6174 6f6d 732c 2033 290a 2020  hainatoms, 3).  
+00024b50: 2020 2020 2020 2020 2020 2020 2020 6169                ai
+00024b60: 636f 6c6f 7220 3d20 7365 6c66 2e5f 5f66  color = self.__f
+00024b70: 6c6f 6174 6f68 6578 285b 6169 7661 6c75  loatohex([aivalu
+00024b80: 655d 295b 305d 0a20 2020 2020 2020 2020  e])[0].         
+00024b90: 2020 2020 2020 2069 6620 6169 7072 6563         if aiprec
+00024ba0: 6861 696e 2069 6e20 6368 6169 6e61 6973  hain in chainais
+00024bb0: 636f 7265 2e6b 6579 7328 293a 0a20 2020  core.keys():.   
+00024bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024bd0: 2023 2063 6861 696e 6169 7363 6f72 655b   # chainaiscore[
+00024be0: 6169 7072 6563 6861 696e 202b 2027 5f27  aiprechain + '_'
+00024bf0: 202b 2073 7472 2861 6976 616c 7565 295d   + str(aivalue)]
+00024c00: 203d 207b 2776 616c 7565 273a 2061 6976   = {'value': aiv
+00024c10: 616c 7565 2c20 2763 6f6c 6f72 273a 2061  alue, 'color': a
+00024c20: 6963 6f6c 6f72 7d0a 2020 2020 2020 2020  icolor}.        
+00024c30: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00024c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024c50: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00024c60: 2020 2020 2020 2020 2020 2063 6861 696e             chain
+00024c70: 6169 7363 6f72 655b 6169 7072 6563 6861  aiscore[aiprecha
+00024c80: 696e 5d20 3d20 7b27 7661 6c75 6527 3a20  in] = {'value': 
+00024c90: 6169 7661 6c75 652c 2027 636f 6c6f 7227  aivalue, 'color'
+00024ca0: 3a20 6169 636f 6c6f 722c 2027 6e75 6d62  : aicolor, 'numb
+00024cb0: 6572 4f66 4174 6f6d 7327 3a20 6368 6169  erOfAtoms': chai
+00024cc0: 6e61 746f 6d73 7d0a 2020 2020 2020 2020  natoms}.        
+00024cd0: 2020 2020 2020 2020 6b65 7973 7472 203d          keystr =
+00024ce0: 2061 6970 7265 6368 6169 6e20 2b20 273a   aiprechain + ':
+00024cf0: 2720 2b20 7374 7228 7072 6572 6573 6964  ' + str(preresid
+00024d00: 2920 2b20 7072 6572 6573 0a20 2020 2020  ) + preres.     
+00024d10: 2020 2020 2020 2020 2020 2061 6c6c 6b65             allke
+00024d20: 7973 2e61 7070 656e 6428 6b65 7973 7472  ys.append(keystr
+00024d30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00024d40: 2020 7661 6c75 6520 3d20 666c 6f61 7428    value = float(
+00024d50: 2725 2e34 6627 2025 2072 6f75 6e64 2828  '%.4f' % round((
+00024d60: 666c 6f61 7428 7375 6d61 746f 6d69 6e74  float(sumatomint
+00024d70: 6572 6269 6e29 202f 2072 6573 636f 756e  erbin) / rescoun
+00024d80: 7429 2c20 3429 290a 2020 2020 2020 2020  t), 4)).        
+00024d90: 2020 2020 2020 2020 616c 6c76 616c 7565          allvalue
+00024da0: 732e 6170 7065 6e64 2876 616c 7565 290a  s.append(value).
+00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024dc0: 616c 6c63 6f6e 746f 7572 7364 6963 745b  allcontoursdict[
+00024dd0: 7374 7228 636f 6e74 6f75 7229 5d20 3d20  str(contour)] = 
+00024de0: 2861 6c6c 6b65 7973 2c20 616c 6c76 616c  (allkeys, allval
+00024df0: 7565 7329 0a20 2020 2020 2020 2020 2020  ues).           
+00024e00: 2020 2020 2070 7269 6e74 2827 4d6f 6465       print('Mode
+00024e10: 6c3a 2025 7320 6174 2063 6f6e 746f 7572  l: %s at contour
+00024e20: 206c 6576 656c 2025 7320 6861 7320 2573   level %s has %s
+00024e30: 2061 746f 6d73 2073 7469 636b 206f 7574   atoms stick out
+00024e40: 206f 6620 7468 6520 6465 6e73 6974 792e   of the density.
+00024e50: 2720 2520 286d 6f64 656c 6e61 6d65 2c20  ' % (modelname, 
+00024e60: 636f 6e74 6f75 722c 0a20 2020 2020 2020  contour,.       
+00024e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ec0: 2020 2020 2020 2020 2020 6174 6f6d 6f75            atomou
+00024ed0: 7473 6964 656e 756d 2929 0a0a 2020 2020  tsidenum))..    
+00024ee0: 2020 2020 2020 2020 2320 7265 7375 6c74          # result
+00024ef0: 5b6d 6f64 656c 6e61 6d65 5d20 3d20 2869  [modelname] = (i
+00024f00: 6e74 6572 706f 6c61 7469 6f6e 732c 2061  nterpolations, a
+00024f10: 6c6c 6b65 7973 2c20 616c 6c76 616c 7565  llkeys, allvalue
+00024f20: 7329 0a20 2020 2020 2020 2020 2020 2023  s).            #
+00024f30: 2072 6573 756c 743a 207b 6d6f 6465 6c6e   result: {modeln
+00024f40: 616d 6520 2331 3a20 2869 6e74 6572 706f  ame #1: (interpo
+00024f50: 6c61 7469 6f6e 7320 2331 2c20 7b63 6f6e  lations #1, {con
+00024f60: 746f 7572 313a 2028 616c 6c6b 6579 732c  tour1: (allkeys,
+00024f70: 2061 6c6c 7661 6c75 6573 292c 2063 6f6e   allvalues), con
+00024f80: 746f 7572 323a 2028 616c 6c6b 6579 732c  tour2: (allkeys,
+00024f90: 2061 6c6c 7661 6c75 6573 290a 2020 2020   allvalues).    
+00024fa0: 2020 2020 2020 2020 2320 2e2e 2e7d 292c          # ...}),
+00024fb0: 206d 6f64 656c 6e61 6d65 2023 323a 2028   modelname #2: (
+00024fc0: 696e 7465 7270 6f6c 6174 696f 6e73 2023  interpolations #
+00024fd0: 322c 207b 636f 6e74 6f75 7231 3a20 2861  2, {contour1: (a
+00024fe0: 6c6c 6b65 7973 2c20 616c 6c76 616c 7565  llkeys, allvalue
+00024ff0: 7329 2c2e 2e2e 7d29 2c2e 2e2e 7d0a 2020  s),...}),...}.  
+00025000: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00025010: 5b6d 6f64 656c 6e61 6d65 5d20 3d20 2869  [modelname] = (i
+00025020: 6e74 6572 706f 6c61 7469 6f6e 732c 2061  nterpolations, a
+00025030: 6c6c 636f 6e74 6f75 7273 6469 6374 2c20  llcontoursdict, 
+00025040: 6368 6169 6e61 6973 636f 7265 2c20 6174  chainaiscore, at
+00025050: 6f6d 6f75 7473 6964 656e 756d 290a 0a20  omoutsidenum).. 
+00025060: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00025070: 7375 6c74 0a0a 2020 2020 2320 7665 7273  sult..    # vers
+00025080: 696f 6e20 3220 7769 7468 6f75 7420 7573  ion 2 without us
+00025090: 696e 6720 5445 4d50 7920 666f 7220 6d6f  ing TEMPy for mo
+000250a0: 6465 6c20 6c6f 6164 696e 6720 7768 6963  del loading whic
+000250b0: 6820 6973 2077 6f72 6b69 6e67 2062 7574  h is working but
+000250c0: 206e 6f74 206f 7074 696d 616c 2066 6f72   not optimal for
+000250d0: 2075 7369 6e67 2062 696f 7079 7468 6f6e   using biopython
+000250e0: 0a20 2020 2064 6566 205f 5f6e 6577 696e  .    def __newin
+000250f0: 7465 7274 6869 7264 2873 656c 6629 3a0a  terthird(self):.
+00025100: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00025110: 2020 2020 2020 2020 2049 6e74 6572 706f           Interpo
+00025120: 6c61 7465 2064 656e 7369 7479 2076 616c  late density val
+00025130: 7565 206f 6620 6f6e 6520 6174 6f6d 2c20  ue of one atom, 
+00025140: 6966 2069 6e64 6963 6573 2061 7265 206f  if indices are o
+00025150: 6e20 7468 6520 7361 6d65 2070 6c61 6e65  n the same plane
+00025160: 2075 7365 206e 6561 7265 7374 206d 6574   use nearest met
+00025170: 686f 640a 2020 2020 2020 2020 2020 2020  hod.            
+00025180: 6f74 6865 7277 6973 6520 7573 6520 6c69  otherwise use li
+00025190: 6e65 6172 0a0a 2020 2020 2020 2020 3a70  near..        :p
+000251a0: 6172 616d 206d 6170 3a20 5445 4d50 7920  aram map: TEMPy 
+000251b0: 6d61 7020 696e 7374 616e 6365 0a20 2020  map instance.   
+000251c0: 2020 2020 203a 7061 7261 6d20 6d6f 6465       :param mode
+000251d0: 6c3a 2053 7472 7563 7475 7265 2069 6e73  l: Structure ins
+000251e0: 7461 6e63 6520 6672 6f6d 2054 454d 5079  tance from TEMPy
+000251f0: 2070 6163 6b61 6765 206d 6d63 6966 2070   package mmcif p
+00025200: 6172 7365 720a 2020 2020 2020 2020 3a72  arser.        :r
+00025210: 6574 7572 6e3a 204c 6973 7420 636f 6e74  eturn: List cont
+00025220: 6169 6e73 2061 6c6c 2064 656e 7369 7479  ains all density
+00025230: 2069 6e74 6572 706f 6c61 7469 6f6e 7320   interpolations 
+00025240: 6f66 2061 746f 6d73 2066 726f 6d20 6d6f  of atoms from mo
+00025250: 6465 6c0a 0a20 2020 2020 2020 2022 2222  del..        """
+00025260: 0a0a 2020 2020 2020 2020 6d79 696e 7465  ..        myinte
+00025270: 7220 3d20 7365 6c66 2e5f 5f69 6e74 6572  r = self.__inter
+00025280: 506f 6c61 7469 6f6e 2829 0a20 2020 2020  Polation().     
+00025290: 2020 2023 204d 6967 6874 2068 6176 696e     # Might havin
+000252a0: 6720 6d75 6c74 706c 6520 6d6f 6465 6c73  g multple models
+000252b0: 0a20 2020 2020 2020 206d 6f64 656c 7320  .        models 
+000252c0: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
+000252d0: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+000252e0: 6d6f 6465 6c73 2c20 6c69 7374 293a 0a20  models, list):. 
+000252f0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+00025300: 7320 3d20 7365 6c66 2e6d 6f64 656c 730a  s = self.models.
+00025310: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00025320: 2020 2020 2020 2020 2020 6d6f 6465 6c73            models
+00025330: 2e61 7070 656e 6428 7365 6c66 2e6d 6f64  .append(self.mod
+00025340: 656c 7329 0a20 2020 2020 2020 206d 6170  els).        map
+00025350: 203d 2073 656c 662e 6d61 700a 2020 2020   = self.map.    
+00025360: 2020 2020 636f 6e74 6f75 7220 3d20 7365      contour = se
+00025370: 6c66 2e63 6c0a 2020 2020 2020 2020 2320  lf.cl.        # 
+00025380: 5261 6e67 6520 6f66 2063 6f6e 746f 7572  Range of contour
+00025390: 206c 6576 656c 2076 616c 7565 7320 666f   level values fo
+000253a0: 7220 7363 616c 6572 2062 6172 0a20 2020  r scaler bar.   
+000253b0: 2020 2020 2023 2054 6f64 6f3a 2052 6967       # Todo: Rig
+000253c0: 6874 206e 6f77 2077 6974 6820 6669 7865  ht now with fixe
+000253d0: 6420 6e75 6d62 6572 206f 6620 706f 696e  d number of poin
+000253e0: 7473 206f 6e20 626f 7468 2073 6964 6573  ts on both sides
+000253f0: 206f 6620 7468 6520 7265 636f 6d6d 656e   of the recommen
+00025400: 6465 6420 636f 6e74 6f75 7220 6c65 7665  ded contour leve
+00025410: 6c2c 2063 6f75 6c64 2069 6d70 726f 7665  l, could improve
+00025420: 2074 6f0a 2020 2020 2020 2020 2320 546f   to.        # To
+00025430: 646f 3a20 6765 6e65 7261 7465 2061 2072  do: generate a r
+00025440: 6561 736f 6e61 626c 6520 7261 6e67 6520  easonable range 
+00025450: 7375 7272 6f75 6e64 2074 6865 2072 6563  surround the rec
+00025460: 6f6d 6d65 6e64 6564 2063 6f6e 746f 7572  ommended contour
+00025470: 206c 6576 656c 0a20 2020 2020 2020 2023   level.        #
+00025480: 2053 6574 7469 6e67 2061 2073 6d61 7274   Setting a smart
+00025490: 6572 2072 616e 6765 2062 6574 7765 656e  er range between
+000254a0: 2028 636f 6e74 6f75 722d 7369 672c 636f   (contour-sig,co
+000254b0: 6e74 6f75 722c 2063 6f75 6e74 6f75 7220  ntour, countour 
+000254c0: 2b20 7369 6729 0a20 2020 2020 2020 2023  + sig).        #
+000254d0: 206d 6170 7369 6720 3d20 6d61 702e 7374   mapsig = map.st
+000254e0: 6428 290a 2020 2020 2020 2020 2320 636f  d().        # co
+000254f0: 6e74 6f75 7272 616e 6765 203d 206e 702e  ntourrange = np.
+00025500: 636f 6e63 6174 656e 6174 6528 286e 702e  concatenate((np.
+00025510: 6c69 6e73 7061 6365 2863 6f6e 746f 7572  linspace(contour
+00025520: 202d 2066 6c6f 6174 2831 2e35 202a 206d   - float(1.5 * m
+00025530: 6170 7369 6729 2c20 636f 6e74 6f75 722c  apsig), contour,
+00025540: 2033 2c20 656e 6470 6f69 6e74 3d46 616c   3, endpoint=Fal
+00025550: 7365 292c 0a20 2020 2020 2020 2023 2020  se),.        #  
+00025560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025570: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+00025580: 2e6c 696e 7370 6163 6528 636f 6e74 6f75  .linspace(contou
+00025590: 722c 2063 6f6e 746f 7572 202b 2066 6c6f  r, contour + flo
+000255a0: 6174 2831 2e35 202a 206d 6170 7369 6729  at(1.5 * mapsig)
+000255b0: 2c20 3429 292c 2061 7869 733d 4e6f 6e65  , 4)), axis=None
+000255c0: 290a 2020 2020 2020 2020 2320 636f 6e74  ).        # cont
+000255d0: 6f75 7272 616e 6765 203d 206e 702e 636f  ourrange = np.co
+000255e0: 6e63 6174 656e 6174 6528 286e 702e 6c69  ncatenate((np.li
+000255f0: 6e73 7061 6365 286d 6170 2e6d 696e 2829  nspace(map.min()
+00025600: 2c20 636f 6e74 6f75 722c 2033 2c20 656e  , contour, 3, en
+00025610: 6470 6f69 6e74 3d46 616c 7365 292c 206e  dpoint=False), n
+00025620: 702e 6c69 6e73 7061 6365 2863 6f6e 746f  p.linspace(conto
+00025630: 7572 2c20 6d61 702e 6d61 7828 292c 2033  ur, map.max(), 3
+00025640: 2929 2c20 6178 6973 3d4e 6f6e 6529 0a20  )), axis=None). 
+00025650: 2020 2020 2020 2023 2057 6865 6e20 7275         # When ru
+00025660: 6e6e 696e 6720 666f 7220 454d 4442 206b  nning for EMDB k
+00025670: 6565 7020 6974 2061 7320 6120 666c 6578  eep it as a flex
+00025680: 6962 6c65 2072 616e 6765 2066 6f72 206f  ible range for o
+00025690: 6e65 6465 7020 6f72 206f 7468 6572 2075  nedep or other u
+000256a0: 7365 7273 206f 6e6c 7920 7275 6e20 6974  sers only run it
+000256b0: 206f 6e63 6520 666f 7220 7265 636f 6d6d   once for recomm
+000256c0: 656e 6465 640a 2020 2020 2020 2020 2320  ended.        # 
+000256d0: 636f 6e74 6f75 7220 6c65 7665 6c3a 0a0a  contour level:..
+000256e0: 2020 2020 2020 2020 2320 6966 2073 656c          # if sel
+000256f0: 662e 656d 6469 643a 0a20 2020 2020 2020  f.emdid:.       
+00025700: 2023 2020 2020 2063 6f6e 746f 7572 7261   #     contourra
+00025710: 6e67 6520 3d20 6e70 2e63 6f6e 6361 7465  nge = np.concate
+00025720: 6e61 7465 2828 6e70 2e6c 696e 7370 6163  nate((np.linspac
+00025730: 6528 636f 6e74 6f75 7220 2d20 666c 6f61  e(contour - floa
+00025740: 7428 312e 3520 2a20 6d61 7073 6967 292c  t(1.5 * mapsig),
+00025750: 2063 6f6e 746f 7572 2c20 332c 2065 6e64   contour, 3, end
+00025760: 706f 696e 743d 4661 6c73 6529 2c0a 2020  point=False),.  
+00025770: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00025780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025790: 2020 2020 2020 2020 2020 206e 702e 6c69             np.li
+000257a0: 6e73 7061 6365 2863 6f6e 746f 7572 2c20  nspace(contour, 
+000257b0: 636f 6e74 6f75 7220 2b20 666c 6f61 7428  contour + float(
+000257c0: 312e 3520 2a20 6d61 7073 6967 292c 2034  1.5 * mapsig), 4
+000257d0: 2929 2c20 6178 6973 3d4e 6f6e 6529 0a20  )), axis=None). 
+000257e0: 2020 2020 2020 2023 2065 6c73 653a 0a20         # else:. 
+000257f0: 2020 2020 2020 2023 2020 2020 2063 6f6e         #     con
+00025800: 746f 7572 7261 6e67 6520 3d20 6e70 2e61  tourrange = np.a
+00025810: 7361 7272 6179 285b 636f 6e74 6f75 725d  sarray([contour]
+00025820: 290a 0a20 2020 2020 2020 2063 6f6e 746f  )..        conto
+00025830: 7572 7261 6e67 6520 3d20 6e70 2e61 7361  urrange = np.asa
+00025840: 7272 6179 285b 636f 6e74 6f75 725d 290a  rray([contour]).
+00025850: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00025860: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+00025870: 6d6f 6465 6c20 696e 206d 6f64 656c 733a  model in models:
+00025880: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+00025890: 636f 6e74 6f75 7273 6469 6374 203d 204f  contoursdict = O
+000258a0: 7264 6572 6564 4469 6374 2829 0a20 2020  rderedDict().   
+000258b0: 2020 2020 2020 2020 2061 746f 6d6f 7574           atomout
+000258c0: 7369 6465 6e75 6d20 3d20 300a 2020 2020  sidenum = 0.    
+000258d0: 2020 2020 2020 2020 6d6f 6465 6c6e 616d          modelnam
+000258e0: 6520 3d20 6d6f 6465 6c2e 6669 6c65 6e61  e = model.filena
+000258f0: 6d65 2e73 706c 6974 2827 2f27 295b 2d31  me.split('/')[-1
+00025900: 5d0a 0a20 2020 2020 2020 2020 2020 2061  ]..            a
+00025910: 746f 6d63 6f75 6e74 203d 2030 0a20 2020  tomcount = 0.   
+00025920: 2020 2020 2020 2020 2063 6861 696e 636f           chainco
+00025930: 756e 7420 3d20 310a 2020 2020 2020 2020  unt = 1.        
+00025940: 2020 2020 6368 6169 6e61 746f 6d73 203d      chainatoms =
+00025950: 2030 0a20 2020 2020 2020 2020 2020 2063   0.            c
+00025960: 6861 696e 6169 7363 6f72 6520 3d20 7b7d  hainaiscore = {}
+00025970: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
+00025980: 696e 6169 203d 2030 2e0a 0a20 2020 2020  inai = 0...     
+00025990: 2020 2020 2020 2066 6f72 2063 6f6e 746f         for conto
+000259a0: 7572 2069 6e20 636f 6e74 6f75 7272 616e  ur in contourran
+000259b0: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
+000259c0: 2020 2020 696e 7465 7270 6f6c 6174 696f      interpolatio
+000259d0: 6e73 203d 205b 5d0a 2020 2020 2020 2020  ns = [].        
+000259e0: 2020 2020 2020 2020 616c 6c6b 6579 7320          allkeys 
+000259f0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00025a00: 2020 2020 2061 6c6c 7661 6c75 6573 203d       allvalues =
+00025a10: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00025a20: 2020 2020 7072 6572 6573 6964 203d 2030      preresid = 0
+00025a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025a40: 2070 7265 6368 6169 6e20 3d20 2727 0a20   prechain = ''. 
+00025a50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00025a60: 6970 7265 6368 6169 6e20 3d20 2727 0a20  iprechain = ''. 
+00025a70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00025a80: 7265 7265 7320 3d20 2727 0a20 2020 2020  reres = ''.     
+00025a90: 2020 2020 2020 2020 2020 2072 6573 636f             resco
+00025aa0: 756e 7420 3d20 300a 2020 2020 2020 2020  unt = 0.        
+00025ab0: 2020 2020 2020 2020 7375 6d61 746f 6d69          sumatomi
+00025ac0: 6e74 6572 6269 6e20 3d20 300a 2020 2020  nterbin = 0.    
+00025ad0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00025ae0: 6174 6f6d 2069 6e20 6d6f 6465 6c2e 6765  atom in model.ge
+00025af0: 745f 6174 6f6d 7328 293a 0a20 2020 2020  t_atoms():.     
+00025b00: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00025b10: 746f 6d63 6f75 6e74 202b 3d20 310a 2020  tomcount += 1.  
+00025b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b30: 2020 2320 6966 2027 4827 206e 6f74 2069    # if 'H' not i
+00025b40: 6e20 6174 6f6d 2e61 746f 6d5f 6e61 6d65  n atom.atom_name
+00025b50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025b60: 2020 2020 2020 2320 6f6e 6563 6f6f 7220        # onecoor 
+00025b70: 3d20 5b61 746f 6d2e 782c 2061 746f 6d2e  = [atom.x, atom.
+00025b80: 792c 2061 746f 6d2e 7a5d 0a20 2020 2020  y, atom.z].     
+00025b90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00025ba0: 6e65 636f 6f72 203d 2061 746f 6d2e 636f  necoor = atom.co
+00025bb0: 6f72 640a 2020 2020 2020 2020 2020 2020  ord.            
+00025bc0: 2020 2020 2020 2020 6f6e 6569 6e64 6578          oneindex
+00025bd0: 203d 2073 656c 662e 5f5f 6765 7469 6e64   = self.__getind
+00025be0: 6963 6573 286f 6e65 636f 6f72 295b 315d  ices(onecoor)[1]
+00025bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025c00: 2020 2020 2069 6620 6f6e 6569 6e64 6578       if oneindex
+00025c10: 5b30 5d20 3e20 6d61 702e 6865 6164 6572  [0] > map.header
+00025c20: 2e6e 7820 2d20 3120 6f72 206f 6e65 696e  .nx - 1 or onein
+00025c30: 6465 785b 305d 203c 2030 206f 7220 5c0a  dex[0] < 0 or \.
+00025c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025c50: 2020 2020 2020 2020 2020 2020 6f6e 6569              onei
+00025c60: 6e64 6578 5b31 5d20 3e20 6d61 702e 6865  ndex[1] > map.he
+00025c70: 6164 6572 2e6e 7920 2d20 3120 6f72 206f  ader.ny - 1 or o
+00025c80: 6e65 696e 6465 785b 315d 203c 2030 206f  neindex[1] < 0 o
+00025c90: 7220 5c0a 2020 2020 2020 2020 2020 2020  r \.            
+00025ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025cb0: 6f6e 6569 6e64 6578 5b32 5d20 3e20 6d61  oneindex[2] > ma
+00025cc0: 702e 6865 6164 6572 2e6e 7a20 2d20 3120  p.header.nz - 1 
+00025cd0: 6f72 206f 6e65 696e 6465 785b 325d 203c  or oneindex[2] <
+00025ce0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00025cf0: 2020 2020 2020 2020 2020 2020 6375 7269              curi
+00025d00: 6e74 6572 706f 6c61 7469 6f6e 203d 206d  nterpolation = m
+00025d10: 6170 2e6d 696e 2829 0a20 2020 2020 2020  ap.min().       
 00025d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d30: 2020 2020 696e 7465 7270 6f6c 6174 696f      interpolatio
-00025d40: 6e73 2e61 7070 656e 6428 6375 7269 6e74  ns.append(curint
-00025d50: 6572 706f 6c61 7469 6f6e 290a 2020 2020  erpolation).    
+00025d30: 2061 746f 6d6f 7574 7369 6465 6e75 6d20   atomoutsidenum 
+00025d40: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00025d50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 00025d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d70: 6174 6f6d 696e 7465 7262 696e 203d 2031  atominterbin = 1
-00025d80: 2069 6620 6375 7269 6e74 6572 706f 6c61   if curinterpola
-00025d90: 7469 6f6e 203e 2063 6f6e 746f 7572 2065  tion > contour e
-00025da0: 6c73 6520 300a 0a20 2020 2020 2020 2020  lse 0..         
-00025db0: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
-00025dc0: 6573 636f 756e 7420 3d3d 2030 2920 6f72  escount == 0) or
-00025dd0: 2028 7265 7369 6475 652e 6964 5b31 5d20   (residue.id[1] 
-00025de0: 3d3d 2070 7265 7265 7369 6420 616e 6420  == preresid and 
-00025df0: 6174 6f6d 2e66 756c 6c5f 6964 5b32 5d20  atom.full_id[2] 
-00025e00: 3d3d 2070 7265 6368 6169 6e29 3a0a 2020  == prechain):.  
-00025e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e20: 2020 2020 2020 7375 6d61 746f 6d69 6e74        sumatomint
-00025e30: 6572 6269 6e20 2b3d 2061 746f 6d69 6e74  erbin += atomint
-00025e40: 6572 6269 6e0a 2020 2020 2020 2020 2020  erbin.          
-00025e50: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00025e60: 7363 6f75 6e74 202b 3d20 310a 2020 2020  scount += 1.    
-00025e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e80: 2020 2020 7072 6572 6573 6964 203d 2072      preresid = r
-00025e90: 6573 6964 7565 2e69 645b 315d 0a20 2020  esidue.id[1].   
-00025ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025eb0: 2020 2020 2070 7265 6368 6169 6e20 3d20       prechain = 
-00025ec0: 6174 6f6d 2e66 756c 6c5f 6964 5b32 5d0a  atom.full_id[2].
+00025d70: 2020 2020 2020 2063 7572 696e 7465 7270         curinterp
+00025d80: 6f6c 6174 696f 6e20 3d20 6d79 696e 7465  olation = myinte
+00025d90: 7228 6f6e 6569 6e64 6578 292e 746f 6c69  r(oneindex).toli
+00025da0: 7374 2829 5b30 5d0a 2020 2020 2020 2020  st()[0].        
+00025db0: 2020 2020 2020 2020 2020 2020 696e 7465              inte
+00025dc0: 7270 6f6c 6174 696f 6e73 2e61 7070 656e  rpolations.appen
+00025dd0: 6428 6375 7269 6e74 6572 706f 6c61 7469  d(curinterpolati
+00025de0: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+00025df0: 2020 2020 2020 2020 6174 6f6d 696e 7465          atominte
+00025e00: 7262 696e 203d 2031 2069 6620 6375 7269  rbin = 1 if curi
+00025e10: 6e74 6572 706f 6c61 7469 6f6e 203e 2063  nterpolation > c
+00025e20: 6f6e 746f 7572 2065 6c73 6520 300a 0a20  ontour else 0.. 
+00025e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025e40: 2020 2069 6620 2872 6573 636f 756e 7420     if (rescount 
+00025e50: 3d3d 2030 2920 6f72 2028 7265 7369 6475  == 0) or (residu
+00025e60: 652e 6964 5b31 5d20 3d3d 2070 7265 7265  e.id[1] == prere
+00025e70: 7369 6420 616e 6420 6174 6f6d 2e66 756c  sid and atom.ful
+00025e80: 6c5f 6964 5b32 5d20 3d3d 2070 7265 6368  l_id[2] == prech
+00025e90: 6169 6e29 3a0a 2020 2020 2020 2020 2020  ain):.          
+00025ea0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+00025eb0: 6d61 746f 6d69 6e74 6572 6269 6e20 2b3d  matominterbin +=
+00025ec0: 2061 746f 6d69 6e74 6572 6269 6e0a 2020   atominterbin.  
 00025ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ee0: 2020 2020 2020 2020 7072 6572 6573 203d          preres =
-00025ef0: 2072 6573 6964 7565 2e72 6573 6e61 6d65   residue.resname
-00025f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025f10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00025f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f30: 2020 206b 6579 7374 7220 3d20 7072 6563     keystr = prec
-00025f40: 6861 696e 202b 2027 3a27 202b 2073 7472  hain + ':' + str
-00025f50: 2870 7265 7265 7369 6429 202b 2070 7265  (preresid) + pre
-00025f60: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
-00025f70: 2020 2020 2020 2020 2020 2020 616c 6c6b              allk
-00025f80: 6579 732e 6170 7065 6e64 286b 6579 7374  eys.append(keyst
-00025f90: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00025fa0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00025fb0: 203d 2066 6c6f 6174 2827 252e 3466 2720   = float('%.4f' 
-00025fc0: 2520 726f 756e 6428 2866 6c6f 6174 2873  % round((float(s
-00025fd0: 756d 6174 6f6d 696e 7465 7262 696e 2920  umatominterbin) 
-00025fe0: 2f20 7265 7363 6f75 6e74 292c 2034 2929  / rescount), 4))
-00025ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026000: 2020 2020 2020 2020 2061 6c6c 7661 6c75           allvalu
-00026010: 6573 2e61 7070 656e 6428 7661 6c75 6529  es.append(value)
-00026020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026030: 2020 2020 2020 2020 2073 756d 6174 6f6d           sumatom
-00026040: 696e 7465 7262 696e 203d 2061 746f 6d69  interbin = atomi
-00026050: 6e74 6572 6269 6e0a 2020 2020 2020 2020  nterbin.        
-00026060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026070: 7072 6572 6573 6964 203d 2072 6573 6964  preresid = resid
-00026080: 7565 2e69 645b 315d 0a20 2020 2020 2020  ue.id[1].       
-00026090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260a0: 2070 7265 6368 6169 6e20 3d20 6174 6f6d   prechain = atom
-000260b0: 2e66 756c 6c5f 6964 5b32 5d0a 2020 2020  .full_id[2].    
-000260c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260d0: 2020 2020 7265 7363 6f75 6e74 203d 2031      rescount = 1
-000260e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000260f0: 2020 2020 2020 2320 4164 6420 7468 6520        # Add the 
-00026100: 6368 6169 6e20 6261 7365 6420 6174 6f6d  chain based atom
-00026110: 2069 6e63 6c75 7369 6f6e 2073 636f 7265   inclusion score
-00026120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026130: 2020 2020 2069 6620 2861 746f 6d63 6f75       if (atomcou
-00026140: 6e74 203d 3d20 3129 206f 7220 2861 746f  nt == 1) or (ato
-00026150: 6d2e 6675 6c6c 5f69 645b 325d 203d 3d20  m.full_id[2] == 
-00026160: 6169 7072 6563 6861 696e 293a 0a20 2020  aiprechain):.   
-00026170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026180: 2020 2020 2063 6861 696e 6174 6f6d 7320       chainatoms 
-00026190: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-000261a0: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-000261b0: 6970 7265 6368 6169 6e20 3d20 6174 6f6d  iprechain = atom
-000261c0: 2e63 6861 696e 0a20 2020 2020 2020 2020  .chain.         
-000261d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000261e0: 6970 7265 6368 6169 6e20 3d20 6174 6f6d  iprechain = atom
-000261f0: 2e66 756c 6c5f 6964 5b32 5d0a 2020 2020  .full_id[2].    
-00026200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026210: 2020 2020 6368 6169 6e61 6920 2b3d 2061      chainai += a
-00026220: 746f 6d69 6e74 6572 6269 6e0a 2020 2020  tominterbin.    
-00026230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026240: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00026250: 2020 2020 2020 2020 2020 2020 2020 6169                ai
-00026260: 7661 6c75 6520 3d20 726f 756e 6428 666c  value = round(fl
-00026270: 6f61 7428 6368 6169 6e61 6929 202f 2063  oat(chainai) / c
-00026280: 6861 696e 6174 6f6d 732c 2033 290a 2020  hainatoms, 3).  
-00026290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262a0: 2020 2020 2020 6169 636f 6c6f 7220 3d20        aicolor = 
-000262b0: 7365 6c66 2e5f 5f66 6c6f 6174 6f68 6578  self.__floatohex
-000262c0: 285b 6169 7661 6c75 655d 295b 305d 0a20  ([aivalue])[0]. 
+00025ee0: 2020 2020 2020 7265 7363 6f75 6e74 202b        rescount +
+00025ef0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00025f00: 2020 2020 2020 2020 2020 2020 7072 6572              prer
+00025f10: 6573 6964 203d 2072 6573 6964 7565 2e69  esid = residue.i
+00025f20: 645b 315d 0a20 2020 2020 2020 2020 2020  d[1].           
+00025f30: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00025f40: 6368 6169 6e20 3d20 6174 6f6d 2e66 756c  chain = atom.ful
+00025f50: 6c5f 6964 5b32 5d0a 2020 2020 2020 2020  l_id[2].        
+00025f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f70: 7072 6572 6573 203d 2072 6573 6964 7565  preres = residue
+00025f80: 2e72 6573 6e61 6d65 0a20 2020 2020 2020  .resname.       
+00025f90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00025fa0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00025fb0: 2020 2020 2020 2020 2020 206b 6579 7374             keyst
+00025fc0: 7220 3d20 7072 6563 6861 696e 202b 2027  r = prechain + '
+00025fd0: 3a27 202b 2073 7472 2870 7265 7265 7369  :' + str(preresi
+00025fe0: 6429 202b 2070 7265 7265 730a 2020 2020  d) + preres.    
+00025ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026000: 2020 2020 616c 6c6b 6579 732e 6170 7065      allkeys.appe
+00026010: 6e64 286b 6579 7374 7229 0a20 2020 2020  nd(keystr).     
+00026020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026030: 2020 2076 616c 7565 203d 2066 6c6f 6174     value = float
+00026040: 2827 252e 3466 2720 2520 726f 756e 6428  ('%.4f' % round(
+00026050: 2866 6c6f 6174 2873 756d 6174 6f6d 696e  (float(sumatomin
+00026060: 7465 7262 696e 2920 2f20 7265 7363 6f75  terbin) / rescou
+00026070: 6e74 292c 2034 2929 0a20 2020 2020 2020  nt), 4)).       
+00026080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026090: 2061 6c6c 7661 6c75 6573 2e61 7070 656e   allvalues.appen
+000260a0: 6428 7661 6c75 6529 0a20 2020 2020 2020  d(value).       
+000260b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260c0: 2073 756d 6174 6f6d 696e 7465 7262 696e   sumatominterbin
+000260d0: 203d 2061 746f 6d69 6e74 6572 6269 6e0a   = atominterbin.
+000260e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260f0: 2020 2020 2020 2020 7072 6572 6573 6964          preresid
+00026100: 203d 2072 6573 6964 7565 2e69 645b 315d   = residue.id[1]
+00026110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026120: 2020 2020 2020 2020 2070 7265 6368 6169           prechai
+00026130: 6e20 3d20 6174 6f6d 2e66 756c 6c5f 6964  n = atom.full_id
+00026140: 5b32 5d0a 2020 2020 2020 2020 2020 2020  [2].            
+00026150: 2020 2020 2020 2020 2020 2020 7265 7363              resc
+00026160: 6f75 6e74 203d 2031 0a0a 2020 2020 2020  ount = 1..      
+00026170: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00026180: 4164 6420 7468 6520 6368 6169 6e20 6261  Add the chain ba
+00026190: 7365 6420 6174 6f6d 2069 6e63 6c75 7369  sed atom inclusi
+000261a0: 6f6e 2073 636f 7265 0a20 2020 2020 2020  on score.       
+000261b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000261c0: 2861 746f 6d63 6f75 6e74 203d 3d20 3129  (atomcount == 1)
+000261d0: 206f 7220 2861 746f 6d2e 6675 6c6c 5f69   or (atom.full_i
+000261e0: 645b 325d 203d 3d20 6169 7072 6563 6861  d[2] == aiprecha
+000261f0: 696e 293a 0a20 2020 2020 2020 2020 2020  in):.           
+00026200: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+00026210: 696e 6174 6f6d 7320 2b3d 2031 0a20 2020  inatoms += 1.   
+00026220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026230: 2020 2020 2023 2061 6970 7265 6368 6169       # aiprechai
+00026240: 6e20 3d20 6174 6f6d 2e63 6861 696e 0a20  n = atom.chain. 
+00026250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026260: 2020 2020 2020 2061 6970 7265 6368 6169         aiprechai
+00026270: 6e20 3d20 6174 6f6d 2e66 756c 6c5f 6964  n = atom.full_id
+00026280: 5b32 5d0a 2020 2020 2020 2020 2020 2020  [2].            
+00026290: 2020 2020 2020 2020 2020 2020 6368 6169              chai
+000262a0: 6e61 6920 2b3d 2061 746f 6d69 6e74 6572  nai += atominter
+000262b0: 6269 6e0a 2020 2020 2020 2020 2020 2020  bin.            
+000262c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 000262d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262e0: 2020 2020 2020 2023 2063 6861 696e 6169         # chainai
-000262f0: 7363 6f72 655b 7072 6563 6861 696e 5d20  score[prechain] 
-00026300: 3d20 7b27 7661 6c75 6527 3a20 6169 7661  = {'value': aiva
-00026310: 6c75 652c 2027 636f 6c6f 7227 3a20 6169  lue, 'color': ai
-00026320: 636f 6c6f 727d 0a20 2020 2020 2020 2020  color}.         
-00026330: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00026340: 2028 546f 646f 2920 466f 7220 6368 6169   (Todo) For chai
-00026350: 6e20 7768 6963 6820 6861 7665 2074 6865  n which have the
-00026360: 2073 616d 6520 6368 6169 6e20 6964 206e   same chain id n
-00026370: 6f6e 2d70 726f 7465 696e 2070 6172 7420  on-protein part 
-00026380: 6e6f 7420 696e 636c 7564 6564 2079 6574  not included yet
-00026390: 2065 7370 6563 6961 6c6c 790a 2020 2020   especially.    
-000263a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263b0: 2020 2020 2320 6c69 6761 6e64 2062 696e      # ligand bin
-000263c0: 6420 746f 2074 6865 2070 726f 7465 696e  d to the protein
-000263d0: 206c 6967 616e 6420 6861 7320 7468 6520   ligand has the 
-000263e0: 7361 6d65 2063 6861 696e 2069 6420 6173  same chain id as
-000263f0: 2074 6865 2070 726f 7465 696e 2c20 7468   the protein, th
-00026400: 656e 2068 6f77 2074 6f20 6176 6572 6765  en how to averge
-00026410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026420: 2020 2020 2020 2020 2023 2074 6865 206c           # the l
-00026430: 6967 616e 6420 616e 6420 7468 6520 7072  igand and the pr
-00026440: 6f74 6569 6e20 746f 6765 7468 6572 206e  otein together n
-00026450: 6565 6420 746f 2074 616b 6520 7468 6520  eed to take the 
-00026460: 6e75 6d62 6572 7320 696e 746f 2061 6363  numbers into acc
-00026470: 6f75 6e74 2077 6869 6368 2061 6c73 6f20  ount which also 
-00026480: 6d65 616e 730a 2020 2020 2020 2020 2020  means.          
-00026490: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000264a0: 6e65 6564 2074 6f20 6164 6420 616e 6f74  need to add anot
-000264b0: 6865 7220 7661 6c75 6520 696e 2074 6865  her value in the
-000264c0: 2064 6963 746f 6e61 7279 0a20 2020 2020   dictonary.     
-000264d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264e0: 2020 2023 204e 6565 6420 746f 2070 726f     # Need to pro
-000264f0: 7065 726c 7920 6361 6e63 756c 6174 6564  perly canculated
-00026500: 2074 6865 2061 7665 7261 6765 206f 6620   the average of 
-00026510: 6f6e 6520 6368 6169 6e0a 2020 2020 2020  one chain.      
-00026520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026530: 2020 6966 2061 6970 7265 6368 6169 6e20    if aiprechain 
-00026540: 696e 2063 6861 696e 6169 7363 6f72 652e  in chainaiscore.
-00026550: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-00026560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026570: 2020 2020 2320 6368 6169 6e61 6973 636f      # chainaisco
-00026580: 7265 5b61 6970 7265 6368 6169 6e20 2b20  re[aiprechain + 
-00026590: 275f 2720 2b20 7374 7228 6169 7661 6c75  '_' + str(aivalu
-000265a0: 6529 5d20 3d20 7b27 7661 6c75 6527 3a20  e)] = {'value': 
-000265b0: 6169 7661 6c75 652c 2027 636f 6c6f 7227  aivalue, 'color'
-000265c0: 3a20 6169 636f 6c6f 727d 0a20 2020 2020  : aicolor}.     
-000265d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000265e0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-000265f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00026610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026620: 2020 2020 2020 6368 6169 6e61 6973 636f        chainaisco
-00026630: 7265 5b61 6970 7265 6368 6169 6e5d 203d  re[aiprechain] =
-00026640: 207b 2776 616c 7565 273a 2061 6976 616c   {'value': aival
-00026650: 7565 2c20 2763 6f6c 6f72 273a 2061 6963  ue, 'color': aic
-00026660: 6f6c 6f72 7d0a 0a20 2020 2020 2020 2020  olor}..         
-00026670: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00026680: 6861 696e 6174 6f6d 7320 3d20 310a 2020  hainatoms = 1.  
-00026690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266a0: 2020 2020 2020 6368 6169 6e63 6f75 6e74        chaincount
-000266b0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-000266c0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-000266d0: 6169 6e61 6920 3d20 6174 6f6d 696e 7465  ainai = atominte
-000266e0: 7262 696e 0a20 2020 2020 2020 2020 2020  rbin.           
-000266f0: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-00026700: 6970 7265 6368 6169 6e20 3d20 6174 6f6d  iprechain = atom
-00026710: 2e63 6861 696e 0a20 2020 2020 2020 2020  .chain.         
-00026720: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00026730: 6970 7265 6368 6169 6e20 3d20 6174 6f6d  iprechain = atom
-00026740: 2e66 756c 6c5f 6964 5b32 5d0a 0a20 2020  .full_id[2]..   
-00026750: 2020 2020 2020 2020 2020 2020 2061 6976               aiv
-00026760: 616c 7565 203d 2072 6f75 6e64 2866 6c6f  alue = round(flo
-00026770: 6174 2863 6861 696e 6169 2920 2f20 6368  at(chainai) / ch
-00026780: 6169 6e61 746f 6d73 2c20 3329 0a20 2020  ainatoms, 3).   
-00026790: 2020 2020 2020 2020 2020 2020 2061 6963               aic
-000267a0: 6f6c 6f72 203d 2073 656c 662e 5f5f 666c  olor = self.__fl
-000267b0: 6f61 746f 6865 7828 5b61 6976 616c 7565  oatohex([aivalue
-000267c0: 5d29 5b30 5d0a 2020 2020 2020 2020 2020  ])[0].          
-000267d0: 2020 2020 2020 6966 2061 6970 7265 6368        if aiprech
-000267e0: 6169 6e20 696e 2063 6861 696e 6169 7363  ain in chainaisc
-000267f0: 6f72 652e 6b65 7973 2829 3a0a 2020 2020  ore.keys():.    
-00026800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026810: 2320 6368 6169 6e61 6973 636f 7265 5b61  # chainaiscore[a
-00026820: 6970 7265 6368 6169 6e20 2b20 275f 2720  iprechain + '_' 
-00026830: 2b20 7374 7228 6169 7661 6c75 6529 5d20  + str(aivalue)] 
-00026840: 3d20 7b27 7661 6c75 6527 3a20 6169 7661  = {'value': aiva
-00026850: 6c75 652c 2027 636f 6c6f 7227 3a20 6169  lue, 'color': ai
-00026860: 636f 6c6f 727d 0a20 2020 2020 2020 2020  color}.         
-00026870: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00026880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026890: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000268a0: 2020 2020 2020 2020 2020 6368 6169 6e61            chaina
-000268b0: 6973 636f 7265 5b61 6970 7265 6368 6169  iscore[aiprechai
-000268c0: 6e5d 203d 207b 2776 616c 7565 273a 2061  n] = {'value': a
-000268d0: 6976 616c 7565 2c20 2763 6f6c 6f72 273a  ivalue, 'color':
-000268e0: 2061 6963 6f6c 6f72 7d0a 2020 2020 2020   aicolor}.      
-000268f0: 2020 2020 2020 2020 2020 6b65 7973 7472            keystr
-00026900: 203d 2061 6970 7265 6368 6169 6e20 2b20   = aiprechain + 
-00026910: 273a 2720 2b20 7374 7228 7072 6572 6573  ':' + str(preres
-00026920: 6964 2920 2b20 7072 6572 6573 0a20 2020  id) + preres.   
-00026930: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
-00026940: 6b65 7973 2e61 7070 656e 6428 6b65 7973  keys.append(keys
-00026950: 7472 290a 2020 2020 2020 2020 2020 2020  tr).            
-00026960: 2020 2020 7661 6c75 6520 3d20 666c 6f61      value = floa
-00026970: 7428 2725 2e34 6627 2025 2072 6f75 6e64  t('%.4f' % round
-00026980: 2828 666c 6f61 7428 7375 6d61 746f 6d69  ((float(sumatomi
-00026990: 6e74 6572 6269 6e29 202f 2072 6573 636f  nterbin) / resco
-000269a0: 756e 7429 2c20 3429 290a 2020 2020 2020  unt), 4)).      
-000269b0: 2020 2020 2020 2020 2020 616c 6c76 616c            allval
-000269c0: 7565 732e 6170 7065 6e64 2876 616c 7565  ues.append(value
-000269d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000269e0: 2020 616c 6c63 6f6e 746f 7572 7364 6963    allcontoursdic
-000269f0: 745b 7374 7228 636f 6e74 6f75 7229 5d20  t[str(contour)] 
-00026a00: 3d20 2861 6c6c 6b65 7973 2c20 616c 6c76  = (allkeys, allv
-00026a10: 616c 7565 7329 0a20 2020 2020 2020 2020  alues).         
-00026a20: 2020 2020 2020 2070 7269 6e74 2827 4d6f         print('Mo
-00026a30: 6465 6c3a 2025 7320 6174 2063 6f6e 746f  del: %s at conto
-00026a40: 7572 206c 6576 656c 2025 7320 6861 7320  ur level %s has 
-00026a50: 2573 2061 746f 6d73 2073 7469 636b 206f  %s atoms stick o
-00026a60: 7574 206f 6620 7468 6520 6465 6e73 6974  ut of the densit
-00026a70: 792e 2720 2520 286d 6f64 656c 6e61 6d65  y.' % (modelname
-00026a80: 2c20 636f 6e74 6f75 722c 0a20 2020 2020  , contour,.     
-00026a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ae0: 2020 2020 2020 2020 2020 2020 6174 6f6d              atom
-00026af0: 6f75 7473 6964 656e 756d 2929 0a0a 2020  outsidenum))..  
-00026b00: 2020 2020 2020 2020 2020 2320 7265 7375            # resu
-00026b10: 6c74 5b6d 6f64 656c 6e61 6d65 5d20 3d20  lt[modelname] = 
-00026b20: 2869 6e74 6572 706f 6c61 7469 6f6e 732c  (interpolations,
-00026b30: 2061 6c6c 6b65 7973 2c20 616c 6c76 616c   allkeys, allval
-00026b40: 7565 7329 0a20 2020 2020 2020 2020 2020  ues).           
-00026b50: 2023 2072 6573 756c 743a 207b 6d6f 6465   # result: {mode
-00026b60: 6c6e 616d 6520 2331 3a20 2869 6e74 6572  lname #1: (inter
-00026b70: 706f 6c61 7469 6f6e 7320 2331 2c20 7b63  polations #1, {c
-00026b80: 6f6e 746f 7572 313a 2028 616c 6c6b 6579  ontour1: (allkey
-00026b90: 732c 2061 6c6c 7661 6c75 6573 292c 2063  s, allvalues), c
-00026ba0: 6f6e 746f 7572 323a 2028 616c 6c6b 6579  ontour2: (allkey
-00026bb0: 732c 2061 6c6c 7661 6c75 6573 290a 2020  s, allvalues).  
-00026bc0: 2020 2020 2020 2020 2020 2320 2e2e 2e7d            # ...}
-00026bd0: 292c 206d 6f64 656c 6e61 6d65 2023 323a  ), modelname #2:
-00026be0: 2028 696e 7465 7270 6f6c 6174 696f 6e73   (interpolations
-00026bf0: 2023 322c 207b 636f 6e74 6f75 7231 3a20   #2, {contour1: 
-00026c00: 2861 6c6c 6b65 7973 2c20 616c 6c76 616c  (allkeys, allval
-00026c10: 7565 7329 2c2e 2e2e 7d29 2c2e 2e2e 7d0a  ues),...}),...}.
-00026c20: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00026c30: 6c74 5b6d 6f64 656c 6e61 6d65 5d20 3d20  lt[modelname] = 
-00026c40: 2869 6e74 6572 706f 6c61 7469 6f6e 732c  (interpolations,
-00026c50: 2061 6c6c 636f 6e74 6f75 7273 6469 6374   allcontoursdict
-00026c60: 2c20 6368 6169 6e61 6973 636f 7265 2c20  , chainaiscore, 
-00026c70: 6174 6f6d 6f75 7473 6964 656e 756d 290a  atomoutsidenum).
-00026c80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00026c90: 7265 7375 6c74 0a0a 2020 2020 2320 7665  result..    # ve
-00026ca0: 7273 696f 6e20 3320 666f 7220 6f70 7469  rsion 3 for opti
-00026cb0: 6d61 6c20 7573 6167 6520 6f66 2062 696f  mal usage of bio
-00026cc0: 7079 7468 6f6e 0a20 2020 2064 6566 205f  python.    def _
-00026cd0: 5f6e 6e65 7769 6e74 6572 7468 6972 6428  _nnewinterthird(
-00026ce0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00026cf0: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-00026d00: 496e 7465 7270 6f6c 6174 6520 6465 6e73  Interpolate dens
-00026d10: 6974 7920 7661 6c75 6520 6f66 206f 6e65  ity value of one
-00026d20: 2061 746f 6d2c 2069 6620 696e 6469 6365   atom, if indice
-00026d30: 7320 6172 6520 6f6e 2074 6865 2073 616d  s are on the sam
-00026d40: 6520 706c 616e 6520 7573 6520 6e65 6172  e plane use near
-00026d50: 6573 7420 6d65 7468 6f64 0a20 2020 2020  est method.     
-00026d60: 2020 2020 2020 206f 7468 6572 7769 7365         otherwise
-00026d70: 2075 7365 206c 696e 6561 720a 0a20 2020   use linear..   
-00026d80: 2020 2020 203a 7061 7261 6d20 6d61 703a       :param map:
-00026d90: 2054 454d 5079 206d 6170 2069 6e73 7461   TEMPy map insta
-00026da0: 6e63 650a 2020 2020 2020 2020 3a70 6172  nce.        :par
-00026db0: 616d 206d 6f64 656c 3a20 5374 7275 6374  am model: Struct
-00026dc0: 7572 6520 696e 7374 616e 6365 2066 726f  ure instance fro
-00026dd0: 6d20 5445 4d50 7920 7061 636b 6167 6520  m TEMPy package 
-00026de0: 6d6d 6369 6620 7061 7273 6572 0a20 2020  mmcif parser.   
-00026df0: 2020 2020 203a 7265 7475 726e 3a20 4c69       :return: Li
-00026e00: 7374 2063 6f6e 7461 696e 7320 616c 6c20  st contains all 
-00026e10: 6465 6e73 6974 7920 696e 7465 7270 6f6c  density interpol
-00026e20: 6174 696f 6e73 206f 6620 6174 6f6d 7320  ations of atoms 
-00026e30: 6672 6f6d 206d 6f64 656c 0a0a 2020 2020  from model..    
-00026e40: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00026e50: 206d 7969 6e74 6572 203d 2073 656c 662e   myinter = self.
-00026e60: 5f5f 696e 7465 7250 6f6c 6174 696f 6e28  __interPolation(
-00026e70: 290a 2020 2020 2020 2020 2320 4d69 6768  ).        # Migh
-00026e80: 7420 6861 7669 6e67 206d 756c 7470 6c65  t having multple
-00026e90: 206d 6f64 656c 730a 2020 2020 2020 2020   models.        
-00026ea0: 6d6f 6465 6c73 203d 205b 5d0a 2020 2020  models = [].    
-00026eb0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00026ec0: 6528 7365 6c66 2e6d 6f64 656c 732c 206c  e(self.models, l
-00026ed0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-00026ee0: 2020 6d6f 6465 6c73 203d 2073 656c 662e    models = self.
-00026ef0: 6d6f 6465 6c73 0a20 2020 2020 2020 2065  models.        e
-00026f00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00026f10: 206d 6f64 656c 732e 6170 7065 6e64 2873   models.append(s
-00026f20: 656c 662e 6d6f 6465 6c73 290a 2020 2020  elf.models).    
-00026f30: 2020 2020 6d61 7020 3d20 7365 6c66 2e6d      map = self.m
-00026f40: 6170 0a20 2020 2020 2020 2063 6f6e 746f  ap.        conto
-00026f50: 7572 203d 2073 656c 662e 636c 0a20 2020  ur = self.cl.   
-00026f60: 2020 2020 2023 2052 616e 6765 206f 6620       # Range of 
-00026f70: 636f 6e74 6f75 7220 6c65 7665 6c20 7661  contour level va
-00026f80: 6c75 6573 2066 6f72 2073 6361 6c65 7220  lues for scaler 
-00026f90: 6261 720a 2020 2020 2020 2020 2320 546f  bar.        # To
-00026fa0: 646f 3a20 5269 6768 7420 6e6f 7720 7769  do: Right now wi
-00026fb0: 7468 2066 6978 6564 206e 756d 6265 7220  th fixed number 
-00026fc0: 6f66 2070 6f69 6e74 7320 6f6e 2062 6f74  of points on bot
-00026fd0: 6820 7369 6465 7320 6f66 2074 6865 2072  h sides of the r
-00026fe0: 6563 6f6d 6d65 6e64 6564 2063 6f6e 746f  ecommended conto
-00026ff0: 7572 206c 6576 656c 2c20 636f 756c 6420  ur level, could 
-00027000: 696d 7072 6f76 6520 746f 0a20 2020 2020  improve to.     
-00027010: 2020 2023 2054 6f64 6f3a 2067 656e 6572     # Todo: gener
-00027020: 6174 6520 6120 7265 6173 6f6e 6162 6c65  ate a reasonable
-00027030: 2072 616e 6765 2073 7572 726f 756e 6420   range surround 
-00027040: 7468 6520 7265 636f 6d6d 656e 6465 6420  the recommended 
-00027050: 636f 6e74 6f75 7220 6c65 7665 6c0a 2020  contour level.  
-00027060: 2020 2020 2020 2320 5365 7474 696e 6720        # Setting 
-00027070: 6120 736d 6172 7465 7220 7261 6e67 6520  a smarter range 
-00027080: 6265 7477 6565 6e20 2863 6f6e 746f 7572  between (contour
-00027090: 2d73 6967 2c63 6f6e 746f 7572 2c20 636f  -sig,contour, co
-000270a0: 756e 746f 7572 202b 2073 6967 290a 2020  untour + sig).  
-000270b0: 2020 2020 2020 2320 6d61 7073 6967 203d        # mapsig =
-000270c0: 206d 6170 2e73 7464 2829 0a20 2020 2020   map.std().     
-000270d0: 2020 2023 206d 6170 7369 6720 3d20 6d61     # mapsig = ma
-000270e0: 702e 6461 7461 2e73 7464 2829 0a20 2020  p.data.std().   
-000270f0: 2020 2020 2023 2063 6f6e 746f 7572 7261       # contourra
-00027100: 6e67 6520 3d20 6e70 2e63 6f6e 6361 7465  nge = np.concate
-00027110: 6e61 7465 2828 6e70 2e6c 696e 7370 6163  nate((np.linspac
-00027120: 6528 636f 6e74 6f75 7220 2d20 666c 6f61  e(contour - floa
-00027130: 7428 312e 3520 2a20 6d61 7073 6967 292c  t(1.5 * mapsig),
-00027140: 2063 6f6e 746f 7572 2c20 332c 2065 6e64   contour, 3, end
-00027150: 706f 696e 743d 4661 6c73 6529 2c0a 2020  point=False),.  
-00027160: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00027170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027180: 2020 2020 2020 206e 702e 6c69 6e73 7061         np.linspa
-00027190: 6365 2863 6f6e 746f 7572 2c20 636f 6e74  ce(contour, cont
-000271a0: 6f75 7220 2b20 666c 6f61 7428 312e 3520  our + float(1.5 
-000271b0: 2a20 6d61 7073 6967 292c 2034 2929 2c20  * mapsig), 4)), 
-000271c0: 6178 6973 3d4e 6f6e 6529 0a20 2020 2020  axis=None).     
-000271d0: 2020 2023 2063 6f6e 746f 7572 7261 6e67     # contourrang
-000271e0: 6520 3d20 6e70 2e63 6f6e 6361 7465 6e61  e = np.concatena
-000271f0: 7465 2828 6e70 2e6c 696e 7370 6163 6528  te((np.linspace(
-00027200: 6d61 702e 6d69 6e28 292c 2063 6f6e 746f  map.min(), conto
-00027210: 7572 2c20 332c 2065 6e64 706f 696e 743d  ur, 3, endpoint=
-00027220: 4661 6c73 6529 2c20 6e70 2e6c 696e 7370  False), np.linsp
-00027230: 6163 6528 636f 6e74 6f75 722c 206d 6170  ace(contour, map
-00027240: 2e6d 6178 2829 2c20 3329 292c 2061 7869  .max(), 3)), axi
-00027250: 733d 4e6f 6e65 290a 2020 2020 2020 2020  s=None).        
-00027260: 2320 5768 656e 2072 756e 6e69 6e67 2066  # When running f
-00027270: 6f72 2045 4d44 4220 6b65 6570 2069 7420  or EMDB keep it 
-00027280: 6173 2061 2066 6c65 7869 626c 6520 7261  as a flexible ra
-00027290: 6e67 6520 666f 7220 6f6e 6564 6570 206f  nge for onedep o
-000272a0: 7220 6f74 6865 7220 7573 6572 7320 6f6e  r other users on
-000272b0: 6c79 2072 756e 2069 7420 6f6e 6365 2066  ly run it once f
-000272c0: 6f72 2072 6563 6f6d 6d65 6e64 6564 0a20  or recommended. 
-000272d0: 2020 2020 2020 2023 2063 6f6e 746f 7572         # contour
-000272e0: 206c 6576 656c 3a0a 0a20 2020 2020 2020   level:..       
-000272f0: 2023 2069 6620 7365 6c66 2e65 6d64 6964   # if self.emdid
-00027300: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-00027310: 636f 6e74 6f75 7272 616e 6765 203d 206e  contourrange = n
-00027320: 702e 636f 6e63 6174 656e 6174 6528 286e  p.concatenate((n
-00027330: 702e 6c69 6e73 7061 6365 2863 6f6e 746f  p.linspace(conto
-00027340: 7572 202d 2066 6c6f 6174 2831 2e35 202a  ur - float(1.5 *
-00027350: 206d 6170 7369 6729 2c20 636f 6e74 6f75   mapsig), contou
-00027360: 722c 2033 2c20 656e 6470 6f69 6e74 3d46  r, 3, endpoint=F
-00027370: 616c 7365 292c 0a20 2020 2020 2020 2023  alse),.        #
-00027380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000273a0: 2020 2020 6e70 2e6c 696e 7370 6163 6528      np.linspace(
-000273b0: 636f 6e74 6f75 722c 2063 6f6e 746f 7572  contour, contour
-000273c0: 202b 2066 6c6f 6174 2831 2e35 202a 206d   + float(1.5 * m
-000273d0: 6170 7369 6729 2c20 3429 292c 2061 7869  apsig), 4)), axi
-000273e0: 733d 4e6f 6e65 290a 2020 2020 2020 2020  s=None).        
-000273f0: 2320 656c 7365 3a0a 2020 2020 2020 2020  # else:.        
-00027400: 2320 2020 2020 636f 6e74 6f75 7272 616e  #     contourran
-00027410: 6765 203d 206e 702e 6173 6172 7261 7928  ge = np.asarray(
-00027420: 5b63 6f6e 746f 7572 5d29 0a0a 2020 2020  [contour])..    
-00027430: 2020 2020 636f 6e74 6f75 7272 616e 6765      contourrange
-00027440: 203d 206e 702e 6173 6172 7261 7928 5b63   = np.asarray([c
-00027450: 6f6e 746f 7572 5d29 0a20 2020 2020 2020  ontour]).       
-00027460: 2072 6573 756c 7420 3d20 7b7d 0a20 2020   result = {}.   
-00027470: 2020 2020 2066 6f72 206d 6f64 656c 2069       for model i
-00027480: 6e20 6d6f 6465 6c73 3a0a 2020 2020 2020  n models:.      
-00027490: 2020 2020 2020 616c 6c63 6f6e 746f 7572        allcontour
-000274a0: 7364 6963 7420 3d20 4f72 6465 7265 6444  sdict = OrderedD
-000274b0: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
-000274c0: 2020 6174 6f6d 6f75 7473 6964 656e 756d    atomoutsidenum
-000274d0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-000274e0: 206d 6f64 656c 6e61 6d65 203d 206d 6f64   modelname = mod
-000274f0: 656c 2e66 696c 656e 616d 652e 7370 6c69  el.filename.spli
-00027500: 7428 272f 2729 5b2d 315d 0a0a 2020 2020  t('/')[-1]..    
-00027510: 2020 2020 2020 2020 6174 6f6d 636f 756e          atomcoun
-00027520: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
-00027530: 2020 6368 6169 6e63 6f75 6e74 203d 2031    chaincount = 1
-00027540: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-00027550: 696e 6174 6f6d 7320 3d20 300a 2020 2020  inatoms = 0.    
-00027560: 2020 2020 2020 2020 6368 6169 6e61 6973          chainais
-00027570: 636f 7265 203d 207b 7d0a 2020 2020 2020  core = {}.      
-00027580: 2020 2020 2020 6368 6169 6e61 6920 3d20        chainai = 
-00027590: 302e 0a0a 2020 2020 2020 2020 2020 2020  0...            
-000275a0: 666f 7220 636f 6e74 6f75 7220 696e 2063  for contour in c
-000275b0: 6f6e 746f 7572 7261 6e67 653a 0a20 2020  ontourrange:.   
-000275c0: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-000275d0: 6572 706f 6c61 7469 6f6e 7320 3d20 5b5d  erpolations = []
-000275e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000275f0: 2061 6c6c 6b65 7973 203d 205b 5d0a 2020   allkeys = [].  
-00027600: 2020 2020 2020 2020 2020 2020 2020 616c                al
-00027610: 6c76 616c 7565 7320 3d20 5b5d 0a20 2020  lvalues = [].   
-00027620: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00027630: 7265 7369 6420 3d20 300a 2020 2020 2020  resid = 0.      
-00027640: 2020 2020 2020 2020 2020 7072 6563 6861            precha
-00027650: 696e 203d 2027 270a 2020 2020 2020 2020  in = ''.        
-00027660: 2020 2020 2020 2020 6169 7072 6563 6861          aiprecha
-00027670: 696e 203d 2027 270a 2020 2020 2020 2020  in = ''.        
-00027680: 2020 2020 2020 2020 7072 6572 6573 203d          preres =
-00027690: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
-000276a0: 2020 2020 7265 7363 6f75 6e74 203d 2030      rescount = 0
-000276b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000276c0: 2073 756d 6174 6f6d 696e 7465 7262 696e   sumatominterbin
-000276d0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-000276e0: 2020 2020 2063 6861 696e 6169 5f61 746f       chainai_ato
-000276f0: 6d73 6e6f 203d 207b 7d0a 2020 2020 2020  msno = {}.      
-00027700: 2020 2020 2020 2020 2020 666f 7220 6368            for ch
-00027710: 6169 6e20 696e 206d 6f64 656c 2e67 6574  ain in model.get
-00027720: 5f63 6861 696e 7328 293a 0a20 2020 2020  _chains():.     
-00027730: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00027740: 6861 696e 6174 6f6d 696e 7465 7262 696e  hainatominterbin
-00027750: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00027760: 2020 2020 2020 2020 2063 6861 696e 5f61           chain_a
-00027770: 746f 6d5f 636f 756e 7420 3d20 300a 2020  tom_count = 0.  
-00027780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027790: 2020 6368 6169 6e5f 6e61 6d65 203d 2063    chain_name = c
-000277a0: 6861 696e 2e69 640a 2020 2020 2020 2020  hain.id.        
-000277b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000277c0: 7265 7369 6475 6520 696e 2063 6861 696e  residue in chain
-000277d0: 2e67 6574 5f72 6573 6964 7565 7328 293a  .get_residues():
-000277e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000277f0: 2020 2020 2020 2020 2072 6573 6174 6f6d           resatom
-00027800: 696e 7465 7262 696e 203d 2030 0a20 2020  interbin = 0.   
-00027810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027820: 2020 2020 2072 6573 6964 7565 5f61 746f       residue_ato
-00027830: 6d5f 636f 756e 7420 3d20 300a 2020 2020  m_count = 0.    
-00027840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027850: 2020 2020 7265 7369 6475 655f 6e61 6d65      residue_name
-00027860: 203d 2072 6573 6964 7565 2e72 6573 6e61   = residue.resna
-00027870: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-00027880: 2020 2020 2020 2020 2020 2072 6573 6964             resid
-00027890: 7565 5f6e 6f20 3d20 7265 7369 6475 652e  ue_no = residue.
-000278a0: 6964 5b31 5d0a 2020 2020 2020 2020 2020  id[1].          
-000278b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000278c0: 7220 6174 6f6d 2069 6e20 7265 7369 6475  r atom in residu
-000278d0: 652e 6765 745f 6174 6f6d 7328 293a 0a20  e.get_atoms():. 
-000278e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278f0: 2020 2020 2020 2020 2020 2069 6620 6174             if at
-00027900: 6f6d 2e6e 616d 652e 7374 6172 7473 7769  om.name.startswi
-00027910: 7468 2827 4827 2920 6f72 2061 746f 6d2e  th('H') or atom.
-00027920: 6765 745f 7061 7265 6e74 2829 2e72 6573  get_parent().res
-00027930: 6e61 6d65 203d 3d20 2748 4f48 273a 0a20  name == 'HOH':. 
-00027940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027950: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00027960: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+000262e0: 2020 2020 2020 6169 7661 6c75 6520 3d20        aivalue = 
+000262f0: 726f 756e 6428 666c 6f61 7428 6368 6169  round(float(chai
+00026300: 6e61 6929 202f 2063 6861 696e 6174 6f6d  nai) / chainatom
+00026310: 732c 2033 290a 2020 2020 2020 2020 2020  s, 3).          
+00026320: 2020 2020 2020 2020 2020 2020 2020 6169                ai
+00026330: 636f 6c6f 7220 3d20 7365 6c66 2e5f 5f66  color = self.__f
+00026340: 6c6f 6174 6f68 6578 285b 6169 7661 6c75  loatohex([aivalu
+00026350: 655d 295b 305d 0a20 2020 2020 2020 2020  e])[0].         
+00026360: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00026370: 2063 6861 696e 6169 7363 6f72 655b 7072   chainaiscore[pr
+00026380: 6563 6861 696e 5d20 3d20 7b27 7661 6c75  echain] = {'valu
+00026390: 6527 3a20 6169 7661 6c75 652c 2027 636f  e': aivalue, 'co
+000263a0: 6c6f 7227 3a20 6169 636f 6c6f 727d 0a20  lor': aicolor}. 
+000263b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000263c0: 2020 2020 2020 2023 2028 546f 646f 2920         # (Todo) 
+000263d0: 466f 7220 6368 6169 6e20 7768 6963 6820  For chain which 
+000263e0: 6861 7665 2074 6865 2073 616d 6520 6368  have the same ch
+000263f0: 6169 6e20 6964 206e 6f6e 2d70 726f 7465  ain id non-prote
+00026400: 696e 2070 6172 7420 6e6f 7420 696e 636c  in part not incl
+00026410: 7564 6564 2079 6574 2065 7370 6563 6961  uded yet especia
+00026420: 6c6c 790a 2020 2020 2020 2020 2020 2020  lly.            
+00026430: 2020 2020 2020 2020 2020 2020 2320 6c69              # li
+00026440: 6761 6e64 2062 696e 6420 746f 2074 6865  gand bind to the
+00026450: 2070 726f 7465 696e 206c 6967 616e 6420   protein ligand 
+00026460: 6861 7320 7468 6520 7361 6d65 2063 6861  has the same cha
+00026470: 696e 2069 6420 6173 2074 6865 2070 726f  in id as the pro
+00026480: 7465 696e 2c20 7468 656e 2068 6f77 2074  tein, then how t
+00026490: 6f20 6176 6572 6765 0a20 2020 2020 2020  o averge.       
+000264a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264b0: 2023 2074 6865 206c 6967 616e 6420 616e   # the ligand an
+000264c0: 6420 7468 6520 7072 6f74 6569 6e20 746f  d the protein to
+000264d0: 6765 7468 6572 206e 6565 6420 746f 2074  gether need to t
+000264e0: 616b 6520 7468 6520 6e75 6d62 6572 7320  ake the numbers 
+000264f0: 696e 746f 2061 6363 6f75 6e74 2077 6869  into account whi
+00026500: 6368 2061 6c73 6f20 6d65 616e 730a 2020  ch also means.  
+00026510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026520: 2020 2020 2020 2320 6e65 6564 2074 6f20        # need to 
+00026530: 6164 6420 616e 6f74 6865 7220 7661 6c75  add another valu
+00026540: 6520 696e 2074 6865 2064 6963 746f 6e61  e in the dictona
+00026550: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
+00026560: 2020 2020 2020 2020 2020 2023 204e 6565             # Nee
+00026570: 6420 746f 2070 726f 7065 726c 7920 6361  d to properly ca
+00026580: 6e63 756c 6174 6564 2074 6865 2061 7665  nculated the ave
+00026590: 7261 6765 206f 6620 6f6e 6520 6368 6169  rage of one chai
+000265a0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+000265b0: 2020 2020 2020 2020 2020 6966 2061 6970            if aip
+000265c0: 7265 6368 6169 6e20 696e 2063 6861 696e  rechain in chain
+000265d0: 6169 7363 6f72 652e 6b65 7973 2829 3a0a  aiscore.keys():.
+000265e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000265f0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
+00026600: 6169 6e61 6973 636f 7265 5b61 6970 7265  ainaiscore[aipre
+00026610: 6368 6169 6e20 2b20 275f 2720 2b20 7374  chain + '_' + st
+00026620: 7228 6169 7661 6c75 6529 5d20 3d20 7b27  r(aivalue)] = {'
+00026630: 7661 6c75 6527 3a20 6169 7661 6c75 652c  value': aivalue,
+00026640: 2027 636f 6c6f 7227 3a20 6169 636f 6c6f   'color': aicolo
+00026650: 727d 0a20 2020 2020 2020 2020 2020 2020  r}.             
+00026660: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00026670: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+00026680: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00026690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000266a0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000266b0: 6169 6e61 6973 636f 7265 5b61 6970 7265  ainaiscore[aipre
+000266c0: 6368 6169 6e5d 203d 207b 2776 616c 7565  chain] = {'value
+000266d0: 273a 2061 6976 616c 7565 2c20 2763 6f6c  ': aivalue, 'col
+000266e0: 6f72 273a 2061 6963 6f6c 6f72 7d0a 0a20  or': aicolor}.. 
+000266f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026700: 2020 2020 2020 2063 6861 696e 6174 6f6d         chainatom
+00026710: 7320 3d20 310a 2020 2020 2020 2020 2020  s = 1.          
+00026720: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00026730: 6169 6e63 6f75 6e74 202b 3d20 310a 2020  aincount += 1.  
+00026740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026750: 2020 2020 2020 6368 6169 6e61 6920 3d20        chainai = 
+00026760: 6174 6f6d 696e 7465 7262 696e 0a20 2020  atominterbin.   
+00026770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026780: 2020 2020 2023 2061 6970 7265 6368 6169       # aiprechai
+00026790: 6e20 3d20 6174 6f6d 2e63 6861 696e 0a20  n = atom.chain. 
+000267a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000267b0: 2020 2020 2020 2061 6970 7265 6368 6169         aiprechai
+000267c0: 6e20 3d20 6174 6f6d 2e66 756c 6c5f 6964  n = atom.full_id
+000267d0: 5b32 5d0a 0a20 2020 2020 2020 2020 2020  [2]..           
+000267e0: 2020 2020 2061 6976 616c 7565 203d 2072       aivalue = r
+000267f0: 6f75 6e64 2866 6c6f 6174 2863 6861 696e  ound(float(chain
+00026800: 6169 2920 2f20 6368 6169 6e61 746f 6d73  ai) / chainatoms
+00026810: 2c20 3329 0a20 2020 2020 2020 2020 2020  , 3).           
+00026820: 2020 2020 2061 6963 6f6c 6f72 203d 2073       aicolor = s
+00026830: 656c 662e 5f5f 666c 6f61 746f 6865 7828  elf.__floatohex(
+00026840: 5b61 6976 616c 7565 5d29 5b30 5d0a 2020  [aivalue])[0].  
+00026850: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00026860: 2061 6970 7265 6368 6169 6e20 696e 2063   aiprechain in c
+00026870: 6861 696e 6169 7363 6f72 652e 6b65 7973  hainaiscore.keys
+00026880: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00026890: 2020 2020 2020 2020 2320 6368 6169 6e61          # chaina
+000268a0: 6973 636f 7265 5b61 6970 7265 6368 6169  iscore[aiprechai
+000268b0: 6e20 2b20 275f 2720 2b20 7374 7228 6169  n + '_' + str(ai
+000268c0: 7661 6c75 6529 5d20 3d20 7b27 7661 6c75  value)] = {'valu
+000268d0: 6527 3a20 6169 7661 6c75 652c 2027 636f  e': aivalue, 'co
+000268e0: 6c6f 7227 3a20 6169 636f 6c6f 727d 0a20  lor': aicolor}. 
+000268f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026900: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00026910: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00026920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026930: 2020 6368 6169 6e61 6973 636f 7265 5b61    chainaiscore[a
+00026940: 6970 7265 6368 6169 6e5d 203d 207b 2776  iprechain] = {'v
+00026950: 616c 7565 273a 2061 6976 616c 7565 2c20  alue': aivalue, 
+00026960: 2763 6f6c 6f72 273a 2061 6963 6f6c 6f72  'color': aicolor
+00026970: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00026980: 2020 6b65 7973 7472 203d 2061 6970 7265    keystr = aipre
+00026990: 6368 6169 6e20 2b20 273a 2720 2b20 7374  chain + ':' + st
+000269a0: 7228 7072 6572 6573 6964 2920 2b20 7072  r(preresid) + pr
+000269b0: 6572 6573 0a20 2020 2020 2020 2020 2020  eres.           
+000269c0: 2020 2020 2061 6c6c 6b65 7973 2e61 7070       allkeys.app
+000269d0: 656e 6428 6b65 7973 7472 290a 2020 2020  end(keystr).    
+000269e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000269f0: 6520 3d20 666c 6f61 7428 2725 2e34 6627  e = float('%.4f'
+00026a00: 2025 2072 6f75 6e64 2828 666c 6f61 7428   % round((float(
+00026a10: 7375 6d61 746f 6d69 6e74 6572 6269 6e29  sumatominterbin)
+00026a20: 202f 2072 6573 636f 756e 7429 2c20 3429   / rescount), 4)
+00026a30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00026a40: 2020 616c 6c76 616c 7565 732e 6170 7065    allvalues.appe
+00026a50: 6e64 2876 616c 7565 290a 2020 2020 2020  nd(value).      
+00026a60: 2020 2020 2020 2020 2020 616c 6c63 6f6e            allcon
+00026a70: 746f 7572 7364 6963 745b 7374 7228 636f  toursdict[str(co
+00026a80: 6e74 6f75 7229 5d20 3d20 2861 6c6c 6b65  ntour)] = (allke
+00026a90: 7973 2c20 616c 6c76 616c 7565 7329 0a20  ys, allvalues). 
+00026aa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00026ab0: 7269 6e74 2827 4d6f 6465 6c3a 2025 7320  rint('Model: %s 
+00026ac0: 6174 2063 6f6e 746f 7572 206c 6576 656c  at contour level
+00026ad0: 2025 7320 6861 7320 2573 2061 746f 6d73   %s has %s atoms
+00026ae0: 2073 7469 636b 206f 7574 206f 6620 7468   stick out of th
+00026af0: 6520 6465 6e73 6974 792e 2720 2520 286d  e density.' % (m
+00026b00: 6f64 656c 6e61 6d65 2c20 636f 6e74 6f75  odelname, contou
+00026b10: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00026b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b70: 2020 2020 6174 6f6d 6f75 7473 6964 656e      atomoutsiden
+00026b80: 756d 2929 0a0a 2020 2020 2020 2020 2020  um))..          
+00026b90: 2020 2320 7265 7375 6c74 5b6d 6f64 656c    # result[model
+00026ba0: 6e61 6d65 5d20 3d20 2869 6e74 6572 706f  name] = (interpo
+00026bb0: 6c61 7469 6f6e 732c 2061 6c6c 6b65 7973  lations, allkeys
+00026bc0: 2c20 616c 6c76 616c 7565 7329 0a20 2020  , allvalues).   
+00026bd0: 2020 2020 2020 2020 2023 2072 6573 756c           # resul
+00026be0: 743a 207b 6d6f 6465 6c6e 616d 6520 2331  t: {modelname #1
+00026bf0: 3a20 2869 6e74 6572 706f 6c61 7469 6f6e  : (interpolation
+00026c00: 7320 2331 2c20 7b63 6f6e 746f 7572 313a  s #1, {contour1:
+00026c10: 2028 616c 6c6b 6579 732c 2061 6c6c 7661   (allkeys, allva
+00026c20: 6c75 6573 292c 2063 6f6e 746f 7572 323a  lues), contour2:
+00026c30: 2028 616c 6c6b 6579 732c 2061 6c6c 7661   (allkeys, allva
+00026c40: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
+00026c50: 2020 2320 2e2e 2e7d 292c 206d 6f64 656c    # ...}), model
+00026c60: 6e61 6d65 2023 323a 2028 696e 7465 7270  name #2: (interp
+00026c70: 6f6c 6174 696f 6e73 2023 322c 207b 636f  olations #2, {co
+00026c80: 6e74 6f75 7231 3a20 2861 6c6c 6b65 7973  ntour1: (allkeys
+00026c90: 2c20 616c 6c76 616c 7565 7329 2c2e 2e2e  , allvalues),...
+00026ca0: 7d29 2c2e 2e2e 7d0a 2020 2020 2020 2020  }),...}.        
+00026cb0: 2020 2020 7265 7375 6c74 5b6d 6f64 656c      result[model
+00026cc0: 6e61 6d65 5d20 3d20 2869 6e74 6572 706f  name] = (interpo
+00026cd0: 6c61 7469 6f6e 732c 2061 6c6c 636f 6e74  lations, allcont
+00026ce0: 6f75 7273 6469 6374 2c20 6368 6169 6e61  oursdict, chaina
+00026cf0: 6973 636f 7265 2c20 6174 6f6d 6f75 7473  iscore, atomouts
+00026d00: 6964 656e 756d 290a 0a20 2020 2020 2020  idenum)..       
+00026d10: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+00026d20: 2020 2020 2320 7665 7273 696f 6e20 3320      # version 3 
+00026d30: 666f 7220 6f70 7469 6d61 6c20 7573 6167  for optimal usag
+00026d40: 6520 6f66 2062 696f 7079 7468 6f6e 0a20  e of biopython. 
+00026d50: 2020 2064 6566 205f 5f6e 6e65 7769 6e74     def __nnewint
+00026d60: 6572 7468 6972 6428 7365 6c66 293a 0a20  erthird(self):. 
+00026d70: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00026d80: 2020 2020 2020 2020 496e 7465 7270 6f6c          Interpol
+00026d90: 6174 6520 6465 6e73 6974 7920 7661 6c75  ate density valu
+00026da0: 6520 6f66 206f 6e65 2061 746f 6d2c 2069  e of one atom, i
+00026db0: 6620 696e 6469 6365 7320 6172 6520 6f6e  f indices are on
+00026dc0: 2074 6865 2073 616d 6520 706c 616e 6520   the same plane 
+00026dd0: 7573 6520 6e65 6172 6573 7420 6d65 7468  use nearest meth
+00026de0: 6f64 0a20 2020 2020 2020 2020 2020 206f  od.            o
+00026df0: 7468 6572 7769 7365 2075 7365 206c 696e  therwise use lin
+00026e00: 6561 720a 0a20 2020 2020 2020 203a 7061  ear..        :pa
+00026e10: 7261 6d20 6d61 703a 2054 454d 5079 206d  ram map: TEMPy m
+00026e20: 6170 2069 6e73 7461 6e63 650a 2020 2020  ap instance.    
+00026e30: 2020 2020 3a70 6172 616d 206d 6f64 656c      :param model
+00026e40: 3a20 5374 7275 6374 7572 6520 696e 7374  : Structure inst
+00026e50: 616e 6365 2066 726f 6d20 5445 4d50 7920  ance from TEMPy 
+00026e60: 7061 636b 6167 6520 6d6d 6369 6620 7061  package mmcif pa
+00026e70: 7273 6572 0a20 2020 2020 2020 203a 7265  rser.        :re
+00026e80: 7475 726e 3a20 4c69 7374 2063 6f6e 7461  turn: List conta
+00026e90: 696e 7320 616c 6c20 6465 6e73 6974 7920  ins all density 
+00026ea0: 696e 7465 7270 6f6c 6174 696f 6e73 206f  interpolations o
+00026eb0: 6620 6174 6f6d 7320 6672 6f6d 206d 6f64  f atoms from mod
+00026ec0: 656c 0a0a 2020 2020 2020 2020 2222 220a  el..        """.
+00026ed0: 0a20 2020 2020 2020 206d 7969 6e74 6572  .        myinter
+00026ee0: 203d 2073 656c 662e 5f5f 696e 7465 7250   = self.__interP
+00026ef0: 6f6c 6174 696f 6e28 290a 2020 2020 2020  olation().      
+00026f00: 2020 2320 4d69 6768 7420 6861 7669 6e67    # Might having
+00026f10: 206d 756c 7470 6c65 206d 6f64 656c 730a   multple models.
+00026f20: 2020 2020 2020 2020 6d6f 6465 6c73 203d          models =
+00026f30: 205b 5d0a 2020 2020 2020 2020 6966 2069   [].        if i
+00026f40: 7369 6e73 7461 6e63 6528 7365 6c66 2e6d  sinstance(self.m
+00026f50: 6f64 656c 732c 206c 6973 7429 3a0a 2020  odels, list):.  
+00026f60: 2020 2020 2020 2020 2020 6d6f 6465 6c73            models
+00026f70: 203d 2073 656c 662e 6d6f 6465 6c73 0a20   = self.models. 
+00026f80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00026f90: 2020 2020 2020 2020 206d 6f64 656c 732e           models.
+00026fa0: 6170 7065 6e64 2873 656c 662e 6d6f 6465  append(self.mode
+00026fb0: 6c73 290a 2020 2020 2020 2020 6d61 7020  ls).        map 
+00026fc0: 3d20 7365 6c66 2e6d 6170 0a20 2020 2020  = self.map.     
+00026fd0: 2020 2063 6f6e 746f 7572 203d 2073 656c     contour = sel
+00026fe0: 662e 636c 0a20 2020 2020 2020 2023 2052  f.cl.        # R
+00026ff0: 616e 6765 206f 6620 636f 6e74 6f75 7220  ange of contour 
+00027000: 6c65 7665 6c20 7661 6c75 6573 2066 6f72  level values for
+00027010: 2073 6361 6c65 7220 6261 720a 2020 2020   scaler bar.    
+00027020: 2020 2020 2320 546f 646f 3a20 5269 6768      # Todo: Righ
+00027030: 7420 6e6f 7720 7769 7468 2066 6978 6564  t now with fixed
+00027040: 206e 756d 6265 7220 6f66 2070 6f69 6e74   number of point
+00027050: 7320 6f6e 2062 6f74 6820 7369 6465 7320  s on both sides 
+00027060: 6f66 2074 6865 2072 6563 6f6d 6d65 6e64  of the recommend
+00027070: 6564 2063 6f6e 746f 7572 206c 6576 656c  ed contour level
+00027080: 2c20 636f 756c 6420 696d 7072 6f76 6520  , could improve 
+00027090: 746f 0a20 2020 2020 2020 2023 2054 6f64  to.        # Tod
+000270a0: 6f3a 2067 656e 6572 6174 6520 6120 7265  o: generate a re
+000270b0: 6173 6f6e 6162 6c65 2072 616e 6765 2073  asonable range s
+000270c0: 7572 726f 756e 6420 7468 6520 7265 636f  urround the reco
+000270d0: 6d6d 656e 6465 6420 636f 6e74 6f75 7220  mmended contour 
+000270e0: 6c65 7665 6c0a 2020 2020 2020 2020 2320  level.        # 
+000270f0: 5365 7474 696e 6720 6120 736d 6172 7465  Setting a smarte
+00027100: 7220 7261 6e67 6520 6265 7477 6565 6e20  r range between 
+00027110: 2863 6f6e 746f 7572 2d73 6967 2c63 6f6e  (contour-sig,con
+00027120: 746f 7572 2c20 636f 756e 746f 7572 202b  tour, countour +
+00027130: 2073 6967 290a 2020 2020 2020 2020 2320   sig).        # 
+00027140: 6d61 7073 6967 203d 206d 6170 2e73 7464  mapsig = map.std
+00027150: 2829 0a20 2020 2020 2020 2023 206d 6170  ().        # map
+00027160: 7369 6720 3d20 6d61 702e 6461 7461 2e73  sig = map.data.s
+00027170: 7464 2829 0a20 2020 2020 2020 2023 2063  td().        # c
+00027180: 6f6e 746f 7572 7261 6e67 6520 3d20 6e70  ontourrange = np
+00027190: 2e63 6f6e 6361 7465 6e61 7465 2828 6e70  .concatenate((np
+000271a0: 2e6c 696e 7370 6163 6528 636f 6e74 6f75  .linspace(contou
+000271b0: 7220 2d20 666c 6f61 7428 312e 3520 2a20  r - float(1.5 * 
+000271c0: 6d61 7073 6967 292c 2063 6f6e 746f 7572  mapsig), contour
+000271d0: 2c20 332c 2065 6e64 706f 696e 743d 4661  , 3, endpoint=Fa
+000271e0: 6c73 6529 2c0a 2020 2020 2020 2020 2320  lse),.        # 
+000271f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027200: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00027210: 702e 6c69 6e73 7061 6365 2863 6f6e 746f  p.linspace(conto
+00027220: 7572 2c20 636f 6e74 6f75 7220 2b20 666c  ur, contour + fl
+00027230: 6f61 7428 312e 3520 2a20 6d61 7073 6967  oat(1.5 * mapsig
+00027240: 292c 2034 2929 2c20 6178 6973 3d4e 6f6e  ), 4)), axis=Non
+00027250: 6529 0a20 2020 2020 2020 2023 2063 6f6e  e).        # con
+00027260: 746f 7572 7261 6e67 6520 3d20 6e70 2e63  tourrange = np.c
+00027270: 6f6e 6361 7465 6e61 7465 2828 6e70 2e6c  oncatenate((np.l
+00027280: 696e 7370 6163 6528 6d61 702e 6d69 6e28  inspace(map.min(
+00027290: 292c 2063 6f6e 746f 7572 2c20 332c 2065  ), contour, 3, e
+000272a0: 6e64 706f 696e 743d 4661 6c73 6529 2c20  ndpoint=False), 
+000272b0: 6e70 2e6c 696e 7370 6163 6528 636f 6e74  np.linspace(cont
+000272c0: 6f75 722c 206d 6170 2e6d 6178 2829 2c20  our, map.max(), 
+000272d0: 3329 292c 2061 7869 733d 4e6f 6e65 290a  3)), axis=None).
+000272e0: 2020 2020 2020 2020 2320 5768 656e 2072          # When r
+000272f0: 756e 6e69 6e67 2066 6f72 2045 4d44 4220  unning for EMDB 
+00027300: 6b65 6570 2069 7420 6173 2061 2066 6c65  keep it as a fle
+00027310: 7869 626c 6520 7261 6e67 6520 666f 7220  xible range for 
+00027320: 6f6e 6564 6570 206f 7220 6f74 6865 7220  onedep or other 
+00027330: 7573 6572 7320 6f6e 6c79 2072 756e 2069  users only run i
+00027340: 7420 6f6e 6365 2066 6f72 2072 6563 6f6d  t once for recom
+00027350: 6d65 6e64 6564 0a20 2020 2020 2020 2023  mended.        #
+00027360: 2063 6f6e 746f 7572 206c 6576 656c 3a0a   contour level:.
+00027370: 0a20 2020 2020 2020 2023 2069 6620 7365  .        # if se
+00027380: 6c66 2e65 6d64 6964 3a0a 2020 2020 2020  lf.emdid:.      
+00027390: 2020 2320 2020 2020 636f 6e74 6f75 7272    #     contourr
+000273a0: 616e 6765 203d 206e 702e 636f 6e63 6174  ange = np.concat
+000273b0: 656e 6174 6528 286e 702e 6c69 6e73 7061  enate((np.linspa
+000273c0: 6365 2863 6f6e 746f 7572 202d 2066 6c6f  ce(contour - flo
+000273d0: 6174 2831 2e35 202a 206d 6170 7369 6729  at(1.5 * mapsig)
+000273e0: 2c20 636f 6e74 6f75 722c 2033 2c20 656e  , contour, 3, en
+000273f0: 6470 6f69 6e74 3d46 616c 7365 292c 0a20  dpoint=False),. 
+00027400: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+00027410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027420: 2020 2020 2020 2020 2020 2020 6e70 2e6c              np.l
+00027430: 696e 7370 6163 6528 636f 6e74 6f75 722c  inspace(contour,
+00027440: 2063 6f6e 746f 7572 202b 2066 6c6f 6174   contour + float
+00027450: 2831 2e35 202a 206d 6170 7369 6729 2c20  (1.5 * mapsig), 
+00027460: 3429 292c 2061 7869 733d 4e6f 6e65 290a  4)), axis=None).
+00027470: 2020 2020 2020 2020 2320 656c 7365 3a0a          # else:.
+00027480: 2020 2020 2020 2020 2320 2020 2020 636f          #     co
+00027490: 6e74 6f75 7272 616e 6765 203d 206e 702e  ntourrange = np.
+000274a0: 6173 6172 7261 7928 5b63 6f6e 746f 7572  asarray([contour
+000274b0: 5d29 0a0a 2020 2020 2020 2020 636f 6e74  ])..        cont
+000274c0: 6f75 7272 616e 6765 203d 206e 702e 6173  ourrange = np.as
+000274d0: 6172 7261 7928 5b63 6f6e 746f 7572 5d29  array([contour])
+000274e0: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
+000274f0: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
+00027500: 206d 6f64 656c 2069 6e20 6d6f 6465 6c73   model in models
+00027510: 3a0a 2020 2020 2020 2020 2020 2020 616c  :.            al
+00027520: 6c63 6f6e 746f 7572 7364 6963 7420 3d20  lcontoursdict = 
+00027530: 4f72 6465 7265 6444 6963 7428 290a 2020  OrderedDict().  
+00027540: 2020 2020 2020 2020 2020 6174 6f6d 6f75            atomou
+00027550: 7473 6964 656e 756d 203d 2030 0a20 2020  tsidenum = 0.   
+00027560: 2020 2020 2020 2020 206d 6f64 656c 6e61           modelna
+00027570: 6d65 203d 206d 6f64 656c 2e66 696c 656e  me = model.filen
+00027580: 616d 652e 7370 6c69 7428 272f 2729 5b2d  ame.split('/')[-
+00027590: 315d 0a0a 2020 2020 2020 2020 2020 2020  1]..            
+000275a0: 6174 6f6d 636f 756e 7420 3d20 300a 2020  atomcount = 0.  
+000275b0: 2020 2020 2020 2020 2020 6368 6169 6e63            chainc
+000275c0: 6f75 6e74 203d 2031 0a20 2020 2020 2020  ount = 1.       
+000275d0: 2020 2020 2063 6861 696e 6174 6f6d 7320       chainatoms 
+000275e0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+000275f0: 6368 6169 6e61 6973 636f 7265 203d 207b  chainaiscore = {
+00027600: 7d0a 2020 2020 2020 2020 2020 2020 6368  }.            ch
+00027610: 6169 6e61 6920 3d20 302e 0a0a 2020 2020  ainai = 0...    
+00027620: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
+00027630: 6f75 7220 696e 2063 6f6e 746f 7572 7261  our in contourra
+00027640: 6e67 653a 0a20 2020 2020 2020 2020 2020  nge:.           
+00027650: 2020 2020 2069 6e74 6572 706f 6c61 7469       interpolati
+00027660: 6f6e 7320 3d20 5b5d 0a20 2020 2020 2020  ons = [].       
+00027670: 2020 2020 2020 2020 2061 6c6c 6b65 7973           allkeys
+00027680: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+00027690: 2020 2020 2020 616c 6c76 616c 7565 7320        allvalues 
+000276a0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+000276b0: 2020 2020 2070 7265 7265 7369 6420 3d20       preresid = 
+000276c0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+000276d0: 2020 7072 6563 6861 696e 203d 2027 270a    prechain = ''.
+000276e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276f0: 6169 7072 6563 6861 696e 203d 2027 270a  aiprechain = ''.
+00027700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027710: 7072 6572 6573 203d 2027 270a 2020 2020  preres = ''.    
+00027720: 2020 2020 2020 2020 2020 2020 7265 7363              resc
+00027730: 6f75 6e74 203d 2030 0a20 2020 2020 2020  ount = 0.       
+00027740: 2020 2020 2020 2020 2073 756d 6174 6f6d           sumatom
+00027750: 696e 7465 7262 696e 203d 2030 0a20 2020  interbin = 0.   
+00027760: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+00027770: 696e 6169 5f61 746f 6d73 6e6f 203d 207b  inai_atomsno = {
+00027780: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00027790: 2020 666f 7220 6368 6169 6e20 696e 206d    for chain in m
+000277a0: 6f64 656c 2e67 6574 5f63 6861 696e 7328  odel.get_chains(
+000277b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000277c0: 2020 2020 2020 2063 6861 696e 6174 6f6d         chainatom
+000277d0: 696e 7465 7262 696e 203d 2030 0a20 2020  interbin = 0.   
+000277e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000277f0: 2063 6861 696e 5f61 746f 6d5f 636f 756e   chain_atom_coun
+00027800: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+00027810: 2020 2020 2020 2020 2020 6368 6169 6e5f            chain_
+00027820: 6e61 6d65 203d 2063 6861 696e 2e69 640a  name = chain.id.
+00027830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027840: 2020 2020 666f 7220 7265 7369 6475 6520      for residue 
+00027850: 696e 2063 6861 696e 2e67 6574 5f72 6573  in chain.get_res
+00027860: 6964 7565 7328 293a 0a20 2020 2020 2020  idues():.       
+00027870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027880: 2072 6573 6174 6f6d 696e 7465 7262 696e   resatominterbin
+00027890: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+000278a0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000278b0: 6964 7565 5f61 746f 6d5f 636f 756e 7420  idue_atom_count 
+000278c0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+000278d0: 2020 2020 2020 2020 2020 2020 7265 7369              resi
+000278e0: 6475 655f 6e61 6d65 203d 2072 6573 6964  due_name = resid
+000278f0: 7565 2e72 6573 6e61 6d65 0a20 2020 2020  ue.resname.     
+00027900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027910: 2020 2072 6573 6964 7565 5f6e 6f20 3d20     residue_no = 
+00027920: 7265 7369 6475 652e 6964 5b31 5d0a 2020  residue.id[1].  
+00027930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027940: 2020 2020 2020 666f 7220 6174 6f6d 2069        for atom i
+00027950: 6e20 7265 7369 6475 652e 6765 745f 6174  n residue.get_at
+00027960: 6f6d 7328 293a 0a20 2020 2020 2020 2020  oms():.         
 00027970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027980: 2020 2020 2320 6966 2027 4827 206e 6f74      # if 'H' not
-00027990: 2069 6e20 6174 6f6d 2e6e 616d 653a 0a20   in atom.name:. 
-000279a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279b0: 2020 2020 2020 2020 2020 2061 746f 6d63             atomc
-000279c0: 6f75 6e74 202b 3d20 310a 2020 2020 2020  ount += 1.      
+00027980: 2020 2069 6620 6174 6f6d 2e6e 616d 652e     if atom.name.
+00027990: 7374 6172 7473 7769 7468 2827 4827 2920  startswith('H') 
+000279a0: 6f72 2061 746f 6d2e 6765 745f 7061 7265  or atom.get_pare
+000279b0: 6e74 2829 2e72 6573 6e61 6d65 203d 3d20  nt().resname == 
+000279c0: 2748 4f48 273a 0a20 2020 2020 2020 2020  'HOH':.         
 000279d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279e0: 2020 2020 2020 7265 7369 6475 655f 6174        residue_at
-000279f0: 6f6d 5f63 6f75 6e74 202b 3d20 310a 2020  om_count += 1.  
-00027a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027a10: 2020 2020 2020 2020 2020 2320 6368 6169            # chai
-00027a20: 6e5f 6174 6f6d 5f63 6f75 6e74 202b 3d20  n_atom_count += 
-00027a30: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00027a40: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-00027a50: 6563 6f6f 7220 3d20 6174 6f6d 2e63 6f6f  ecoor = atom.coo
-00027a60: 7264 0a20 2020 2020 2020 2020 2020 2020  rd.             
-00027a70: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00027a80: 6e65 696e 6465 7820 3d20 7365 6c66 2e5f  neindex = self._
-00027a90: 5f67 6574 696e 6469 6365 7328 6f6e 6563  _getindices(onec
-00027aa0: 6f6f 7229 5b31 5d0a 2020 2020 2020 2020  oor)[1].        
-00027ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ac0: 2020 2020 2320 6966 206f 6e65 696e 6465      # if oneinde
-00027ad0: 785b 305d 203e 206d 6170 2e78 5f73 697a  x[0] > map.x_siz
-00027ae0: 6528 2920 2d20 3120 6f72 206f 6e65 696e  e() - 1 or onein
-00027af0: 6465 785b 305d 203c 2030 206f 7220 5c0a  dex[0] < 0 or \.
-00027b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b10: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00027b20: 2020 2020 2020 6f6e 6569 6e64 6578 5b31        oneindex[1
-00027b30: 5d20 3e20 6d61 702e 795f 7369 7a65 2829  ] > map.y_size()
-00027b40: 202d 2031 206f 7220 6f6e 6569 6e64 6578   - 1 or oneindex
-00027b50: 5b31 5d20 3c20 3020 6f72 205c 0a20 2020  [1] < 0 or \.   
-00027b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b70: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-00027b80: 2020 206f 6e65 696e 6465 785b 325d 203e     oneindex[2] >
-00027b90: 206d 6170 2e7a 5f73 697a 6528 2920 2d20   map.z_size() - 
-00027ba0: 3120 6f72 206f 6e65 696e 6465 785b 325d  1 or oneindex[2]
-00027bb0: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
-00027bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027bd0: 2020 6966 206f 6e65 696e 6465 785b 305d    if oneindex[0]
-00027be0: 203e 206d 6170 2e68 6561 6465 722e 6e78   > map.header.nx
-00027bf0: 202d 2031 206f 7220 6f6e 6569 6e64 6578   - 1 or oneindex
-00027c00: 5b30 5d20 3c20 3020 6f72 205c 0a20 2020  [0] < 0 or \.   
-00027c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c30: 206f 6e65 696e 6465 785b 315d 203e 206d   oneindex[1] > m
-00027c40: 6170 2e68 6561 6465 722e 6e79 202d 2031  ap.header.ny - 1
-00027c50: 206f 7220 6f6e 6569 6e64 6578 5b31 5d20   or oneindex[1] 
-00027c60: 3c20 3020 6f72 205c 0a20 2020 2020 2020  < 0 or \.       
-00027c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c80: 2020 2020 2020 2020 2020 2020 206f 6e65               one
-00027c90: 696e 6465 785b 325d 203e 206d 6170 2e68  index[2] > map.h
-00027ca0: 6561 6465 722e 6e7a 202d 2031 206f 7220  eader.nz - 1 or 
-00027cb0: 6f6e 6569 6e64 6578 5b32 5d20 3c20 303a  oneindex[2] < 0:
-00027cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ce0: 2023 2063 7572 696e 7465 7270 6f6c 6174   # curinterpolat
-00027cf0: 696f 6e20 3d20 6d61 702e 6d69 6e28 290a  ion = map.min().
+000279e0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+000279f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a00: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00027a10: 2027 4827 206e 6f74 2069 6e20 6174 6f6d   'H' not in atom
+00027a20: 2e6e 616d 653a 0a20 2020 2020 2020 2020  .name:.         
+00027a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a40: 2020 2061 746f 6d63 6f75 6e74 202b 3d20     atomcount += 
+00027a50: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00027a60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00027a70: 7369 6475 655f 6174 6f6d 5f63 6f75 6e74  sidue_atom_count
+00027a80: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+00027a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027aa0: 2020 2320 6368 6169 6e5f 6174 6f6d 5f63    # chain_atom_c
+00027ab0: 6f75 6e74 202b 3d20 310a 2020 2020 2020  ount += 1.      
+00027ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ad0: 2020 2020 2020 6f6e 6563 6f6f 7220 3d20        onecoor = 
+00027ae0: 6174 6f6d 2e63 6f6f 7264 0a20 2020 2020  atom.coord.     
+00027af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b00: 2020 2020 2020 206f 6e65 696e 6465 7820         oneindex 
+00027b10: 3d20 7365 6c66 2e5f 5f67 6574 696e 6469  = self.__getindi
+00027b20: 6365 7328 6f6e 6563 6f6f 7229 5b31 5d0a  ces(onecoor)[1].
+00027b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b40: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00027b50: 206f 6e65 696e 6465 785b 305d 203e 206d   oneindex[0] > m
+00027b60: 6170 2e78 5f73 697a 6528 2920 2d20 3120  ap.x_size() - 1 
+00027b70: 6f72 206f 6e65 696e 6465 785b 305d 203c  or oneindex[0] <
+00027b80: 2030 206f 7220 5c0a 2020 2020 2020 2020   0 or \.        
+00027b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027ba0: 2020 2020 2320 2020 2020 2020 2020 6f6e      #         on
+00027bb0: 6569 6e64 6578 5b31 5d20 3e20 6d61 702e  eindex[1] > map.
+00027bc0: 795f 7369 7a65 2829 202d 2031 206f 7220  y_size() - 1 or 
+00027bd0: 6f6e 6569 6e64 6578 5b31 5d20 3c20 3020  oneindex[1] < 0 
+00027be0: 6f72 205c 0a20 2020 2020 2020 2020 2020  or \.           
+00027bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c00: 2023 2020 2020 2020 2020 206f 6e65 696e   #         onein
+00027c10: 6465 785b 325d 203e 206d 6170 2e7a 5f73  dex[2] > map.z_s
+00027c20: 697a 6528 2920 2d20 3120 6f72 206f 6e65  ize() - 1 or one
+00027c30: 696e 6465 785b 325d 203c 2030 3a0a 2020  index[2] < 0:.  
+00027c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c50: 2020 2020 2020 2020 2020 6966 206f 6e65            if one
+00027c60: 696e 6465 785b 305d 203e 206d 6170 2e68  index[0] > map.h
+00027c70: 6561 6465 722e 6e78 202d 2031 206f 7220  eader.nx - 1 or 
+00027c80: 6f6e 6569 6e64 6578 5b30 5d20 3c20 3020  oneindex[0] < 0 
+00027c90: 6f72 205c 0a20 2020 2020 2020 2020 2020  or \.           
+00027ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027cb0: 2020 2020 2020 2020 206f 6e65 696e 6465           oneinde
+00027cc0: 785b 315d 203e 206d 6170 2e68 6561 6465  x[1] > map.heade
+00027cd0: 722e 6e79 202d 2031 206f 7220 6f6e 6569  r.ny - 1 or onei
+00027ce0: 6e64 6578 5b31 5d20 3c20 3020 6f72 205c  ndex[1] < 0 or \
+00027cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00027d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d20: 6375 7269 6e74 6572 706f 6c61 7469 6f6e  curinterpolation
-00027d30: 203d 206d 6170 2e64 6174 612e 6d69 6e28   = map.data.min(
-00027d40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00027d10: 2020 2020 206f 6e65 696e 6465 785b 325d       oneindex[2]
+00027d20: 203e 206d 6170 2e68 6561 6465 722e 6e7a   > map.header.nz
+00027d30: 202d 2031 206f 7220 6f6e 6569 6e64 6578   - 1 or oneindex
+00027d40: 5b32 5d20 3c20 303a 0a20 2020 2020 2020  [2] < 0:.       
 00027d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d60: 2020 6174 6f6d 6f75 7473 6964 656e 756d    atomoutsidenum
-00027d70: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00027d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00027da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027db0: 2020 2020 2020 2020 6375 7269 6e74 6572          curinter
-00027dc0: 706f 6c61 7469 6f6e 203d 206d 7969 6e74  polation = myint
-00027dd0: 6572 286f 6e65 696e 6465 7829 2e74 6f6c  er(oneindex).tol
-00027de0: 6973 7428 295b 305d 0a20 2020 2020 2020  ist()[0].       
-00027df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e00: 2020 2020 2069 6e74 6572 706f 6c61 7469       interpolati
-00027e10: 6f6e 732e 6170 7065 6e64 2863 7572 696e  ons.append(curin
-00027e20: 7465 7270 6f6c 6174 696f 6e29 0a20 2020  terpolation).   
+00027d60: 2020 2020 2020 2020 2023 2063 7572 696e           # curin
+00027d70: 7465 7270 6f6c 6174 696f 6e20 3d20 6d61  terpolation = ma
+00027d80: 702e 6d69 6e28 290a 2020 2020 2020 2020  p.min().        
+00027d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027da0: 2020 2020 2020 2020 6375 7269 6e74 6572          curinter
+00027db0: 706f 6c61 7469 6f6e 203d 206d 6170 2e64  polation = map.d
+00027dc0: 6174 612e 6d69 6e28 290a 2020 2020 2020  ata.min().      
+00027dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027de0: 2020 2020 2020 2020 2020 6174 6f6d 6f75            atomou
+00027df0: 7473 6964 656e 756d 202b 3d20 310a 2020  tsidenum += 1.  
+00027e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00027e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00027e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e40: 2020 2020 2020 2020 2061 746f 6d69 6e74           atomint
-00027e50: 6572 6269 6e20 3d20 3120 6966 2063 7572  erbin = 1 if cur
-00027e60: 696e 7465 7270 6f6c 6174 696f 6e20 3e20  interpolation > 
-00027e70: 636f 6e74 6f75 7220 656c 7365 2030 0a20  contour else 0. 
-00027e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e90: 2020 2020 2020 2020 2020 2072 6573 6174             resat
-00027ea0: 6f6d 696e 7465 7262 696e 202b 3d20 6174  ominterbin += at
-00027eb0: 6f6d 696e 7465 7262 696e 0a20 2020 2020  ominterbin.     
+00027e40: 6375 7269 6e74 6572 706f 6c61 7469 6f6e  curinterpolation
+00027e50: 203d 206d 7969 6e74 6572 286f 6e65 696e   = myinter(onein
+00027e60: 6465 7829 2e74 6f6c 6973 7428 295b 305d  dex).tolist()[0]
+00027e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027e80: 2020 2020 2020 2020 2020 2020 2069 6e74               int
+00027e90: 6572 706f 6c61 7469 6f6e 732e 6170 7065  erpolations.appe
+00027ea0: 6e64 2863 7572 696e 7465 7270 6f6c 6174  nd(curinterpolat
+00027eb0: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
 00027ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ed0: 2020 2020 2020 2069 6620 2748 2720 6e6f         if 'H' no
-00027ee0: 7420 696e 2061 746f 6d2e 6e61 6d65 3a0a  t in atom.name:.
-00027ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f10: 6368 6169 6e61 746f 6d69 6e74 6572 6269  chainatominterbi
-00027f20: 6e20 2b3d 2061 746f 6d69 6e74 6572 6269  n += atominterbi
-00027f30: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00027f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f50: 2020 6368 6169 6e5f 6174 6f6d 5f63 6f75    chain_atom_cou
-00027f60: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-00027f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027f80: 2020 2020 7375 6d61 746f 6d69 6e74 6572      sumatominter
-00027f90: 6269 6e20 2b3d 2061 746f 6d69 6e74 6572  bin += atominter
-00027fa0: 6269 6e0a 2020 2020 2020 2020 2020 2020  bin.            
-00027fb0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00027fc0: 6573 6964 7565 5f61 746f 6d5f 636f 756e  esidue_atom_coun
-00027fd0: 7420 3d3d 2030 3a0a 2020 2020 2020 2020  t == 0:.        
-00027fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ff0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-00028000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028010: 2020 2020 2023 2072 6573 6964 7565 2069       # residue i
-00028020: 6e63 6c75 7369 6f6e 2073 6563 7469 6f6e  nclusion section
-00028030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028040: 2020 2020 2020 2020 206b 6579 7374 7220           keystr 
-00028050: 3d20 6368 6169 6e5f 6e61 6d65 202b 2027  = chain_name + '
-00028060: 3a27 202b 2073 7472 2872 6573 6964 7565  :' + str(residue
-00028070: 5f6e 6f29 202b 2072 6573 6964 7565 5f6e  _no) + residue_n
-00028080: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00028090: 2020 2020 2020 2020 2020 2020 616c 6c6b              allk
-000280a0: 6579 732e 6170 7065 6e64 286b 6579 7374  eys.append(keyst
-000280b0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-000280c0: 2020 2020 2020 2020 2020 2076 616c 7565             value
-000280d0: 203d 2066 6c6f 6174 2827 252e 3466 2720   = float('%.4f' 
-000280e0: 2520 726f 756e 6428 2866 6c6f 6174 2872  % round((float(r
-000280f0: 6573 6174 6f6d 696e 7465 7262 696e 2920  esatominterbin) 
-00028100: 2f20 7265 7369 6475 655f 6174 6f6d 5f63  / residue_atom_c
-00028110: 6f75 6e74 292c 2034 2929 0a20 2020 2020  ount), 4)).     
-00028120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028130: 2020 2061 6c6c 7661 6c75 6573 2e61 7070     allvalues.app
-00028140: 656e 6428 7661 6c75 6529 0a0a 2020 2020  end(value)..    
-00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028160: 2320 6368 6169 6e20 696e 636c 7573 696f  # chain inclusio
-00028170: 6e20 7365 6374 696f 6e0a 2020 2020 2020  n section.      
-00028180: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00028190: 2063 6861 696e 5f6e 616d 6520 696e 2063   chain_name in c
-000281a0: 6861 696e 6169 5f61 746f 6d73 6e6f 2e6b  hainai_atomsno.k
-000281b0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-000281c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000281d0: 6861 696e 6174 6f6d 696e 7465 7262 696e  hainatominterbin
-000281e0: 202b 3d20 6368 6169 6e61 695f 6174 6f6d   += chainai_atom
-000281f0: 736e 6f5b 6368 6169 6e5f 6e61 6d65 5d5b  sno[chain_name][
-00028200: 2776 616c 7565 275d 0a20 2020 2020 2020  'value'].       
-00028210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028220: 2063 6861 696e 5f61 746f 6d5f 636f 756e   chain_atom_coun
-00028230: 7420 2b3d 2063 6861 696e 6169 5f61 746f  t += chainai_ato
-00028240: 6d73 6e6f 5b63 6861 696e 5f6e 616d 655d  msno[chain_name]
-00028250: 5b27 6174 6f6d 7369 6e63 6861 696e 275d  ['atomsinchain']
-00028260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028270: 2020 2020 2023 2046 6f72 2063 6173 6573       # For cases
-00028280: 2077 6865 7265 206f 6e65 2077 6174 6572   where one water
-00028290: 206d 6f6c 6563 756c 6520 6861 7320 6120   molecule has a 
-000282a0: 7369 676c 6520 6275 7420 6469 6666 6572  sigle but differ
-000282b0: 656e 7420 6368 6169 6e20 6964 0a20 2020  ent chain id.   
-000282c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000282d0: 2069 6620 6368 6169 6e5f 6174 6f6d 5f63   if chain_atom_c
-000282e0: 6f75 6e74 203d 3d20 303a 0a20 2020 2020  ount == 0:.     
-000282f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028300: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00028310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028320: 6368 6169 6e61 695f 6174 6f6d 736e 6f5b  chainai_atomsno[
-00028330: 6368 6169 6e5f 6e61 6d65 5d20 3d20 7b27  chain_name] = {'
-00028340: 7661 6c75 6527 3a20 6368 6169 6e61 746f  value': chainato
-00028350: 6d69 6e74 6572 6269 6e2c 2027 6174 6f6d  minterbin, 'atom
-00028360: 7369 6e63 6861 696e 273a 2063 6861 696e  sinchain': chain
-00028370: 5f61 746f 6d5f 636f 756e 747d 0a0a 2020  _atom_count}..  
-00028380: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00028390: 7220 6368 6169 6e6e 616d 652c 2063 6861  r chainname, cha
-000283a0: 696e 5f73 636f 7265 7320 696e 2063 6861  in_scores in cha
-000283b0: 696e 6169 5f61 746f 6d73 6e6f 2e69 7465  inai_atomsno.ite
-000283c0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-000283d0: 2020 2020 2020 2020 2020 6368 6169 6e5f            chain_
-000283e0: 6169 203d 2066 6c6f 6174 2827 252e 3366  ai = float('%.3f
-000283f0: 2720 2520 726f 756e 6428 2866 6c6f 6174  ' % round((float
-00028400: 2863 6861 696e 5f73 636f 7265 735b 2776  (chain_scores['v
-00028410: 616c 7565 275d 2920 2f20 6368 6169 6e5f  alue']) / chain_
-00028420: 7363 6f72 6573 5b27 6174 6f6d 7369 6e63  scores['atomsinc
-00028430: 6861 696e 275d 292c 2034 2929 0a20 2020  hain']), 4)).   
-00028440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028450: 2061 6963 6f6c 6f72 203d 2073 656c 662e   aicolor = self.
-00028460: 5f5f 666c 6f61 746f 6865 7828 5b63 6861  __floatohex([cha
-00028470: 696e 5f61 695d 295b 305d 0a20 2020 2020  in_ai])[0].     
-00028480: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00028490: 6861 696e 6169 7363 6f72 655b 6368 6169  hainaiscore[chai
-000284a0: 6e6e 616d 655d 203d 207b 2776 616c 7565  nname] = {'value
-000284b0: 273a 2063 6861 696e 5f61 692c 2027 636f  ': chain_ai, 'co
-000284c0: 6c6f 7227 3a20 6169 636f 6c6f 722c 2027  lor': aicolor, '
-000284d0: 6e75 6d62 6572 4f66 4174 6f6d 7327 3a20  numberOfAtoms': 
-000284e0: 6368 6169 6e5f 7363 6f72 6573 5b27 6174  chain_scores['at
-000284f0: 6f6d 7369 6e63 6861 696e 275d 7d0a 2020  omsinchain']}.  
-00028500: 2020 2020 2020 2020 2020 2020 2020 616c                al
-00028510: 6c63 6f6e 746f 7572 7364 6963 745b 7374  lcontoursdict[st
-00028520: 7228 636f 6e74 6f75 7229 5d20 3d20 2861  r(contour)] = (a
-00028530: 6c6c 6b65 7973 2c20 616c 6c76 616c 7565  llkeys, allvalue
-00028540: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00028550: 2020 2070 7269 6e74 2827 4d6f 6465 6c3a     print('Model:
-00028560: 2025 7320 6174 2063 6f6e 746f 7572 206c   %s at contour l
-00028570: 6576 656c 2025 7320 6861 7320 2573 2061  evel %s has %s a
-00028580: 746f 6d73 2073 7469 636b 206f 7574 206f  toms stick out o
-00028590: 6620 7468 6520 6465 6e73 6974 792e 2720  f the density.' 
-000285a0: 2520 286d 6f64 656c 6e61 6d65 2c20 636f  % (modelname, co
-000285b0: 6e74 6f75 722c 0a20 2020 2020 2020 2020  ntour,.         
-000285c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000285d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000285e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000285f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028610: 2020 2020 2020 2061 746f 6d6f 7574 7369         atomoutsi
-00028620: 6465 6e75 6d29 290a 0a20 2020 2020 2020  denum))..       
-00028630: 2020 2020 2023 2072 6573 756c 745b 6d6f       # result[mo
-00028640: 6465 6c6e 616d 655d 203d 2028 696e 7465  delname] = (inte
-00028650: 7270 6f6c 6174 696f 6e73 2c20 616c 6c6b  rpolations, allk
-00028660: 6579 732c 2061 6c6c 7661 6c75 6573 290a  eys, allvalues).
-00028670: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-00028680: 7375 6c74 3a20 7b6d 6f64 656c 6e61 6d65  sult: {modelname
-00028690: 2023 313a 2028 696e 7465 7270 6f6c 6174   #1: (interpolat
-000286a0: 696f 6e73 2023 312c 207b 636f 6e74 6f75  ions #1, {contou
-000286b0: 7231 3a20 2861 6c6c 6b65 7973 2c20 616c  r1: (allkeys, al
-000286c0: 6c76 616c 7565 7329 2c20 636f 6e74 6f75  lvalues), contou
-000286d0: 7232 3a20 2861 6c6c 6b65 7973 2c20 616c  r2: (allkeys, al
-000286e0: 6c76 616c 7565 7329 0a20 2020 2020 2020  lvalues).       
-000286f0: 2020 2020 2023 202e 2e2e 7d29 2c20 6d6f       # ...}), mo
-00028700: 6465 6c6e 616d 6520 2332 3a20 2869 6e74  delname #2: (int
-00028710: 6572 706f 6c61 7469 6f6e 7320 2332 2c20  erpolations #2, 
-00028720: 7b63 6f6e 746f 7572 313a 2028 616c 6c6b  {contour1: (allk
-00028730: 6579 732c 2061 6c6c 7661 6c75 6573 292c  eys, allvalues),
-00028740: 2e2e 2e7d 292c 2e2e 2e7d 0a20 2020 2020  ...}),...}.     
-00028750: 2020 2020 2020 2072 6573 756c 745b 6d6f         result[mo
-00028760: 6465 6c6e 616d 655d 203d 2028 696e 7465  delname] = (inte
-00028770: 7270 6f6c 6174 696f 6e73 2c20 616c 6c63  rpolations, allc
-00028780: 6f6e 746f 7572 7364 6963 742c 2063 6861  ontoursdict, cha
-00028790: 696e 6169 7363 6f72 652c 2061 746f 6d6f  inaiscore, atomo
-000287a0: 7574 7369 6465 6e75 6d29 0a0a 2020 2020  utsidenum)..    
-000287b0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000287c0: 740a 0a0a 2020 2020 6465 6620 6d61 705f  t...    def map_
-000287d0: 6d61 7472 6978 2873 656c 662c 2061 7069  matrix(self, api
-000287e0: 7873 2c20 616e 6773 293a 0a20 2020 2020  xs, angs):.     
-000287f0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00028800: 2020 2020 6361 6c63 756c 6174 6520 7468      calculate th
-00028810: 6520 6d61 7472 6978 2074 6f20 7472 616e  e matrix to tran
-00028820: 7366 6f72 6d20 4361 7274 6573 6961 6e20  sform Cartesian 
-00028830: 636f 6f72 6469 6e61 7465 7320 746f 2066  coordinates to f
-00028840: 7261 6374 696f 6e61 6c20 636f 6f72 6469  ractional coordi
-00028850: 6e61 7465 730a 2020 2020 2020 2020 2020  nates.          
-00028860: 2020 2863 6865 636b 2074 6865 2064 6566    (check the def
-00028870: 696e 696e 6174 696f 6e20 746f 2073 6565  inination to see
-00028880: 2074 6865 206d 6174 7269 7820 666f 726d   the matrix form
-00028890: 756c 6172 290a 0a20 2020 2020 2020 203a  ular)..        :
-000288a0: 7061 7261 6d20 6170 6978 733a 2061 7272  param apixs: arr
-000288b0: 6179 206f 6620 6170 6978 206c 656e 6768  ay of apix lengh
-000288c0: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
-000288d0: 2061 6e67 733a 2061 7272 6179 206f 6620   angs: array of 
-000288e0: 616e 676c 6578 2069 6e20 616c 7068 612c  anglex in alpha,
-000288f0: 2062 6574 612c 2067 616d 6d61 206f 7264   beta, gamma ord
-00028900: 6572 0a20 2020 2020 2020 203a 7265 7475  er.        :retu
-00028910: 726e 3a0a 2020 2020 2020 2020 2222 220a  rn:.        """.
-00028920: 0a20 2020 2020 2020 2061 6e67 203d 2028  .        ang = (
-00028930: 616e 6773 5b30 5d2a 6d61 7468 2e70 692f  angs[0]*math.pi/
-00028940: 3138 302c 2061 6e67 735b 315d 2a6d 6174  180, angs[1]*mat
-00028950: 682e 7069 2f31 3830 2c20 616e 6773 5b32  h.pi/180, angs[2
-00028960: 5d2a 6d61 7468 2e70 692f 3138 3029 0a20  ]*math.pi/180). 
-00028970: 2020 2020 2020 2069 6e73 6964 6573 7172         insidesqr
-00028980: 7420 3d20 3120 2b20 3220 2a20 6d61 7468  t = 1 + 2 * math
-00028990: 2e63 6f73 2861 6e67 5b30 5d29 202a 206d  .cos(ang[0]) * m
-000289a0: 6174 682e 636f 7328 616e 675b 315d 2920  ath.cos(ang[1]) 
-000289b0: 2a20 6d61 7468 2e63 6f73 2861 6e67 5b32  * math.cos(ang[2
-000289c0: 5d29 202d 205c 0a20 2020 2020 2020 2020  ]) - \.         
-000289d0: 2020 2020 2020 2020 2020 2020 6d61 7468              math
-000289e0: 2e63 6f73 2861 6e67 5b30 5d29 2a2a 3220  .cos(ang[0])**2 
-000289f0: 2d20 5c0a 2020 2020 2020 2020 2020 2020  - \.            
-00028a00: 2020 2020 2020 2020 206d 6174 682e 636f           math.co
-00028a10: 7328 616e 675b 315d 292a 2a32 202d 205c  s(ang[1])**2 - \
-00028a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028a30: 2020 2020 2020 6d61 7468 2e63 6f73 2861        math.cos(a
-00028a40: 6e67 5b32 5d29 2a2a 320a 0a20 2020 2020  ng[2])**2..     
-00028a50: 2020 2063 656c 6c76 6f6c 756d 6520 3d20     cellvolume = 
-00028a60: 6170 6978 735b 305d 2a61 7069 7873 5b31  apixs[0]*apixs[1
-00028a70: 5d2a 6170 6978 735b 325d 2a6d 6174 682e  ]*apixs[2]*math.
-00028a80: 7371 7274 2869 6e73 6964 6573 7172 7429  sqrt(insidesqrt)
-00028a90: 0a0a 2020 2020 2020 2020 6d31 3120 3d20  ..        m11 = 
-00028aa0: 312f 6170 6978 735b 305d 0a20 2020 2020  1/apixs[0].     
-00028ab0: 2020 206d 3132 203d 202d 6d61 7468 2e63     m12 = -math.c
-00028ac0: 6f73 2861 6e67 5b32 5d29 2f28 6170 6978  os(ang[2])/(apix
-00028ad0: 735b 305d 2a6d 6174 682e 7369 6e28 616e  s[0]*math.sin(an
-00028ae0: 675b 325d 2929 0a0a 2020 2020 2020 2020  g[2]))..        
-00028af0: 6d31 3320 3d20 6170 6978 735b 315d 202a  m13 = apixs[1] *
-00028b00: 2061 7069 7873 5b32 5d20 2a20 286d 6174   apixs[2] * (mat
-00028b10: 682e 636f 7328 616e 675b 305d 2920 2a20  h.cos(ang[0]) * 
-00028b20: 6d61 7468 2e63 6f73 2861 6e67 5b32 5d29  math.cos(ang[2])
-00028b30: 202d 206d 6174 682e 636f 7328 616e 675b   - math.cos(ang[
-00028b40: 315d 2929 202f 2028 6365 6c6c 766f 6c75  1])) / (cellvolu
-00028b50: 6d65 202a 206d 6174 682e 7369 6e28 616e  me * math.sin(an
-00028b60: 675b 325d 2929 0a20 2020 2020 2020 206d  g[2])).        m
-00028b70: 3231 203d 2030 0a20 2020 2020 2020 206d  21 = 0.        m
-00028b80: 3232 203d 2031 202f 2028 6170 6978 735b  22 = 1 / (apixs[
-00028b90: 315d 202a 206d 6174 682e 7369 6e28 616e  1] * math.sin(an
-00028ba0: 675b 325d 2929 0a20 2020 2020 2020 206d  g[2])).        m
-00028bb0: 3233 203d 2061 7069 7873 5b30 5d20 2a20  23 = apixs[0] * 
-00028bc0: 6170 6978 735b 325d 202a 2028 6d61 7468  apixs[2] * (math
-00028bd0: 2e63 6f73 2861 6e67 5b31 5d29 202a 206d  .cos(ang[1]) * m
-00028be0: 6174 682e 636f 7328 616e 675b 325d 2920  ath.cos(ang[2]) 
-00028bf0: 2d20 6d61 7468 2e63 6f73 2861 6e67 5b30  - math.cos(ang[0
-00028c00: 5d29 2920 2f20 2863 656c 6c76 6f6c 756d  ])) / (cellvolum
-00028c10: 6520 2a20 6d61 7468 2e73 696e 2861 6e67  e * math.sin(ang
-00028c20: 5b32 5d29 290a 2020 2020 2020 2020 6d33  [2])).        m3
-00028c30: 3120 3d20 300a 2020 2020 2020 2020 6d33  1 = 0.        m3
-00028c40: 3220 3d20 300a 2020 2020 2020 2020 6d33  2 = 0.        m3
-00028c50: 3320 3d20 6170 6978 735b 305d 202a 2061  3 = apixs[0] * a
-00028c60: 7069 7873 5b31 5d20 2a20 6d61 7468 2e73  pixs[1] * math.s
-00028c70: 696e 2861 6e67 5b32 5d29 202f 2063 656c  in(ang[2]) / cel
-00028c80: 6c76 6f6c 756d 650a 2020 2020 2020 2020  lvolume.        
-00028c90: 7072 656d 6174 7269 7820 3d20 5b5b 6d31  prematrix = [[m1
-00028ca0: 312c 206d 3132 2c20 6d31 335d 2c20 5b6d  1, m12, m13], [m
-00028cb0: 3231 2c20 6d32 322c 206d 3233 5d2c 205b  21, m22, m23], [
-00028cc0: 6d33 312c 206d 3332 2c20 6d33 335d 5d0a  m31, m32, m33]].
-00028cd0: 2020 2020 2020 2020 6d61 7472 6978 203d          matrix =
-00028ce0: 206e 702e 6173 6172 7261 7928 7072 656d   np.asarray(prem
-00028cf0: 6174 7269 7829 0a0a 2020 2020 2020 2020  atrix)..        
-00028d00: 7265 7475 726e 206d 6174 7269 780a 0a0a  return matrix...
-00028d10: 2020 2020 6465 6620 6d61 7472 6978 5f69      def matrix_i
-00028d20: 6e64 6963 6573 2873 656c 662c 2061 7069  ndices(self, api
-00028d30: 7873 2c20 6f6e 6563 6f6f 7229 3a0a 2020  xs, onecoor):.  
-00028d40: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00028d50: 2020 2020 2020 204d 6574 686f 6420 323a         Method 2:
-00028d60: 2075 7369 6e67 2074 6865 2066 7261 6374   using the fract
-00028d70: 696f 6e61 6c20 636f 6f72 6469 6e61 7465  ional coordinate
-00028d80: 206d 6174 7269 7820 746f 2063 616c 6375   matrix to calcu
-00028d90: 6c61 7465 2074 6865 2069 6e64 6963 6573  late the indices
-00028da0: 2077 6865 6e20 7468 6520 6d61 7073 2061   when the maps a
-00028db0: 7265 206e 6f6e 2d6f 7274 686f 676f 6e61  re non-orthogona
-00028dc0: 6c0a 0a20 2020 2020 2020 203a 7265 7475  l..        :retu
-00028dd0: 726e 3a0a 2020 2020 2020 2020 2222 220a  rn:.        """.
-00028de0: 0a20 2020 2020 2020 2023 204d 6574 686f  .        # Metho
-00028df0: 6420 323a 2062 7920 7573 696e 6720 7468  d 2: by using th
-00028e00: 6520 6672 6163 7469 6f6e 616c 2063 6f6f  e fractional coo
-00028e10: 7264 696e 6174 6520 6d61 7472 6978 0a20  rdinate matrix. 
-00028e20: 2020 2020 2020 2023 2043 686f 7365 6e20         # Chosen 
-00028e30: 6173 2074 6865 206d 6169 6e20 6675 6e63  as the main func
-00028e40: 7469 6f6e 2066 6f72 2074 6865 2063 7572  tion for the cur
-00028e50: 7265 6e74 2069 6d70 6c65 6d65 6e74 6174  rent implementat
-00028e60: 696f 6e0a 0a20 2020 2020 2020 2023 2046  ion..        # F
-00028e70: 6967 7572 6520 6f75 7420 7468 6520 6f72  igure out the or
-00028e80: 6465 7220 6f66 2074 6865 2078 2c20 792c  der of the x, y,
-00028e90: 207a 2062 6173 6564 206f 6e20 6372 7320   z based on crs 
-00028ea0: 696e 666f 2069 6e20 7468 6520 6865 6164  info in the head
-00028eb0: 6572 0a20 2020 2020 2020 2023 2063 7273  er.        # crs
-00028ec0: 203d 206c 6973 7428 7365 6c66 2e6d 6170   = list(self.map
-00028ed0: 2e68 6561 6465 725b 3136 3a31 395d 290a  .header[16:19]).
-00028ee0: 2020 2020 2020 2020 6372 7320 3d20 5b73          crs = [s
-00028ef0: 656c 662e 6d61 702e 6865 6164 6572 2e6d  elf.map.header.m
-00028f00: 6170 632c 2073 656c 662e 6d61 702e 6865  apc, self.map.he
-00028f10: 6164 6572 2e6d 6170 722c 2073 656c 662e  ader.mapr, self.
-00028f20: 6d61 702e 6865 6164 6572 2e6d 6170 735d  map.header.maps]
-00028f30: 0a20 2020 2020 2020 2023 206f 7264 696e  .        # ordin
-00028f40: 6473 2073 6176 6520 7468 6520 696e 6469  ds save the indi
-00028f50: 6365 7320 636f 7272 6573 706f 6469 6e67  ces correspoding
-00028f60: 2074 6f20 782c 2079 202c 7a0a 2020 2020   to x, y ,z.    
-00028f70: 2020 2020 6f72 6469 6e64 7320 3d20 5b63      ordinds = [c
-00028f80: 7273 2e69 6e64 6578 2831 292c 2063 7273  rs.index(1), crs
-00028f90: 2e69 6e64 6578 2832 292c 2063 7273 2e69  .index(2), crs.i
-00028fa0: 6e64 6578 2833 295d 0a20 2020 2020 2020  ndex(3)].       
-00028fb0: 2023 2061 6e67 7320 3d20 7365 6c66 2e6d   # angs = self.m
-00028fc0: 6170 2e68 6561 6465 725b 3133 3a31 365d  ap.header[13:16]
-00028fd0: 0a20 2020 2020 2020 2061 6e67 7320 3d20  .        angs = 
-00028fe0: 5b73 656c 662e 6d61 702e 6865 6164 6572  [self.map.header
-00028ff0: 2e63 656c 6c62 2e61 6c70 6861 2c20 7365  .cellb.alpha, se
-00029000: 6c66 2e6d 6170 2e68 6561 6465 722e 6365  lf.map.header.ce
-00029010: 6c6c 622e 6265 7461 2c20 7365 6c66 2e6d  llb.beta, self.m
-00029020: 6170 2e68 6561 6465 722e 6365 6c6c 622e  ap.header.cellb.
-00029030: 6761 6d6d 615d 0a20 2020 2020 2020 206d  gamma].        m
-00029040: 6174 7269 7820 3d20 7365 6c66 2e6d 6170  atrix = self.map
-00029050: 5f6d 6174 7269 7828 6170 6978 732c 2061  _matrix(apixs, a
-00029060: 6e67 7329 0a20 2020 2020 2020 2072 6573  ngs).        res
-00029070: 756c 7420 3d20 6d61 7472 6978 2e64 6f74  ult = matrix.dot
-00029080: 286e 702e 6173 6172 7261 7928 6f6e 6563  (np.asarray(onec
-00029090: 6f6f 7229 290a 2020 2020 2020 2020 2320  oor)).        # 
-000290a0: 7869 6e64 6578 203d 2072 6573 756c 745b  xindex = result[
-000290b0: 305d 202d 2073 656c 662e 6d61 702e 6865  0] - self.map.he
-000290c0: 6164 6572 5b34 202b 206f 7264 696e 6473  ader[4 + ordinds
-000290d0: 5b30 5d5d 0a20 2020 2020 2020 2023 2079  [0]].        # y
-000290e0: 696e 6465 7820 3d20 7265 7375 6c74 5b31  index = result[1
-000290f0: 5d20 2d20 7365 6c66 2e6d 6170 2e68 6561  ] - self.map.hea
-00029100: 6465 725b 3420 2b20 6f72 6469 6e64 735b  der[4 + ordinds[
-00029110: 315d 5d0a 2020 2020 2020 2020 2320 7a69  1]].        # zi
-00029120: 6e64 6578 203d 2072 6573 756c 745b 325d  ndex = result[2]
-00029130: 202d 2073 656c 662e 6d61 702e 6865 6164   - self.map.head
-00029140: 6572 5b34 202b 206f 7264 696e 6473 5b32  er[4 + ordinds[2
-00029150: 5d5d 0a20 2020 2020 2020 2078 696e 6465  ]].        xinde
-00029160: 7820 3d20 7265 7375 6c74 5b30 5d20 2d20  x = result[0] - 
-00029170: 7365 6c66 2e6d 6170 2e68 6561 6465 722e  self.map.header.
-00029180: 6e78 7374 6172 740a 2020 2020 2020 2020  nxstart.        
-00029190: 7969 6e64 6578 203d 2072 6573 756c 745b  yindex = result[
-000291a0: 315d 202d 2073 656c 662e 6d61 702e 6865  1] - self.map.he
-000291b0: 6164 6572 2e6e 7973 7461 7274 0a20 2020  ader.nystart.   
-000291c0: 2020 2020 207a 696e 6465 7820 3d20 7265       zindex = re
-000291d0: 7375 6c74 5b32 5d20 2d20 7365 6c66 2e6d  sult[2] - self.m
-000291e0: 6170 2e68 6561 6465 722e 6e7a 7374 6172  ap.header.nzstar
-000291f0: 740a 0a20 2020 2020 2020 2072 6574 7572  t..        retur
-00029200: 6e20 2878 696e 6465 782c 2079 696e 6465  n (xindex, yinde
-00029210: 782c 207a 696e 6465 7829 0a0a 0a20 2020  x, zindex)...   
-00029220: 2064 6566 2070 726f 6a65 6374 696f 6e5f   def projection_
-00029230: 696e 6469 6365 7328 7365 6c66 2c20 6f6e  indices(self, on
-00029240: 6563 6f6f 7229 3a0a 2020 2020 2020 2020  ecoor):.        
-00029250: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
-00029260: 204d 6574 686f 6420 313a 2075 7369 6e67   Method 1: using
-00029270: 2074 6865 2070 726f 6a65 6374 696f 6e20   the projection 
-00029280: 7761 7920 746f 2063 616c 6375 6c61 7465  way to calculate
-00029290: 2074 6865 2069 6e64 6963 6573 2077 6865   the indices whe
-000292a0: 6e20 7468 6520 6d61 7073 2061 7265 206e  n the maps are n
-000292b0: 6f6e 2d6f 7274 686f 676f 6e61 6c0a 0a20  on-orthogonal.. 
-000292c0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-000292d0: 7475 6d70 6c65 2077 6869 6368 2063 6f6e  tumple which con
-000292e0: 7461 696e 7320 616c 6c20 7468 7265 6520  tains all three 
-000292f0: 666c 6f61 7420 6e65 7720 696e 6469 6365  float new indice
-00029300: 7320 696e 2028 782c 2079 2c20 7a29 206f  s in (x, y, z) o
-00029310: 7264 6572 0a20 2020 2020 2020 2022 2222  rder.        """
-00029320: 0a0a 2020 2020 2020 2020 6d61 7020 3d20  ..        map = 
-00029330: 7365 6c66 2e6d 6170 0a20 2020 2020 2020  self.map.       
-00029340: 207a 6469 6d20 3d20 6d61 702e 6865 6164   zdim = map.head
-00029350: 6572 5b31 325d 0a20 2020 2020 2020 207a  er[12].        z
-00029360: 6e69 6e74 6572 7661 6c73 203d 206d 6170  nintervals = map
-00029370: 2e68 6561 6465 725b 395d 0a20 2020 2020  .header[9].     
-00029380: 2020 207a 5f61 7069 7820 3d20 7a64 696d     z_apix = zdim
-00029390: 202f 207a 6e69 6e74 6572 7661 6c73 0a0a   / znintervals..
-000293a0: 2020 2020 2020 2020 7964 696d 203d 206d          ydim = m
-000293b0: 6170 2e68 6561 6465 725b 3131 5d0a 2020  ap.header[11].  
-000293c0: 2020 2020 2020 796e 696e 7465 7276 616c        yninterval
-000293d0: 7320 3d20 6d61 702e 6865 6164 6572 5b38  s = map.header[8
-000293e0: 5d0a 2020 2020 2020 2020 795f 6170 6978  ].        y_apix
-000293f0: 203d 2079 6469 6d20 2f20 796e 696e 7465   = ydim / yninte
-00029400: 7276 616c 730a 0a20 2020 2020 2020 2078  rvals..        x
-00029410: 6469 6d20 3d20 6d61 702e 6865 6164 6572  dim = map.header
-00029420: 5b31 305d 0a20 2020 2020 2020 2078 6e69  [10].        xni
-00029430: 6e74 6572 7661 6c73 203d 206d 6170 2e68  ntervals = map.h
-00029440: 6561 6465 725b 375d 0a20 2020 2020 2020  eader[7].       
-00029450: 2078 5f61 7069 7820 3d20 7864 696d 202f   x_apix = xdim /
-00029460: 2078 6e69 6e74 6572 7661 6c73 0a0a 2020   xnintervals..  
-00029470: 2020 2020 2020 7468 6574 6120 3d20 286d        theta = (m
-00029480: 6170 2e68 6561 6465 725b 3133 5d20 2f20  ap.header[13] / 
-00029490: 3930 2920 2a20 286d 6174 682e 7069 202f  90) * (math.pi /
-000294a0: 2032 290a 2020 2020 2020 2020 6265 7461   2).        beta
-000294b0: 203d 2028 6d61 702e 6865 6164 6572 5b31   = (map.header[1
-000294c0: 345d 202f 2039 3029 202a 2028 6d61 7468  4] / 90) * (math
-000294d0: 2e70 6920 2f20 3229 0a20 2020 2020 2020  .pi / 2).       
-000294e0: 2067 616d 6d61 203d 2028 6d61 702e 6865   gamma = (map.he
-000294f0: 6164 6572 5b31 355d 202f 2039 3029 202a  ader[15] / 90) *
-00029500: 2028 6d61 7468 2e70 6920 2f20 3229 0a0a   (math.pi / 2)..
-00029510: 2020 2020 2020 2020 696e 7369 6465 7371          insidesq
-00029520: 7274 203d 2031 202b 2032 202a 206d 6174  rt = 1 + 2 * mat
-00029530: 682e 636f 7328 7468 6574 6129 202a 206d  h.cos(theta) * m
-00029540: 6174 682e 636f 7328 6265 7461 2920 2a20  ath.cos(beta) * 
-00029550: 6d61 7468 2e63 6f73 2867 616d 6d61 2920  math.cos(gamma) 
-00029560: 2d20 5c0a 2020 2020 2020 2020 2020 2020  - \.            
-00029570: 2020 2020 2020 2020 206d 6174 682e 636f           math.co
-00029580: 7328 7468 6574 6129 202a 206d 6174 682e  s(theta) * math.
-00029590: 636f 7328 7468 6574 6129 202d 205c 0a20  cos(theta) - \. 
-000295a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000295b0: 2020 2020 6d61 7468 2e63 6f73 2862 6574      math.cos(bet
-000295c0: 6129 202a 206d 6174 682e 636f 7328 6265  a) * math.cos(be
-000295d0: 7461 2920 2d20 5c0a 2020 2020 2020 2020  ta) - \.        
-000295e0: 2020 2020 2020 2020 2020 2020 206d 6174               mat
-000295f0: 682e 636f 7328 6761 6d6d 6129 202a 206d  h.cos(gamma) * m
-00029600: 6174 682e 636f 7328 6761 6d6d 6129 0a0a  ath.cos(gamma)..
-00029610: 2020 2020 2020 2020 6365 6c6c 766f 6c75          cellvolu
-00029620: 6d65 203d 2078 5f61 7069 7820 2a20 795f  me = x_apix * y_
-00029630: 6170 6978 202a 207a 5f61 7069 7820 2a20  apix * z_apix * 
-00029640: 6d61 7468 2e73 7172 7428 696e 7369 6465  math.sqrt(inside
-00029650: 7371 7274 290a 0a20 2020 2020 2020 2063  sqrt)..        c
-00029660: 656c 6c68 6569 6768 747a 203d 2063 656c  ellheightz = cel
-00029670: 6c76 6f6c 756d 6520 2f20 2878 5f61 7069  lvolume / (x_api
-00029680: 7820 2a20 795f 6170 6978 202a 206d 6174  x * y_apix * mat
-00029690: 682e 7369 6e28 6761 6d6d 6129 290a 2020  h.sin(gamma)).  
-000296a0: 2020 2020 2020 6365 6c6c 6865 6967 6874        cellheight
-000296b0: 7920 3d20 6365 6c6c 766f 6c75 6d65 202f  y = cellvolume /
-000296c0: 2028 785f 6170 6978 202a 207a 5f61 7069   (x_apix * z_api
-000296d0: 7820 2a20 6d61 7468 2e73 696e 2862 6574  x * math.sin(bet
-000296e0: 6129 290a 2020 2020 2020 2020 6365 6c6c  a)).        cell
-000296f0: 6865 6967 6874 7820 3d20 6365 6c6c 766f  heightx = cellvo
-00029700: 6c75 6d65 202f 2028 7a5f 6170 6978 202a  lume / (z_apix *
-00029710: 2079 5f61 7069 7820 2a20 6d61 7468 2e73   y_apix * math.s
-00029720: 696e 2874 6865 7461 2929 0a0a 2020 2020  in(theta))..    
-00029730: 2020 2020 2320 4669 6775 7265 206f 7574      # Figure out
-00029740: 2074 6865 206f 7264 6572 206f 6620 7468   the order of th
-00029750: 6520 782c 2079 2c20 7a20 6261 7365 6420  e x, y, z based 
-00029760: 6f6e 2063 7273 2069 6e66 6f20 696e 2074  on crs info in t
-00029770: 6865 2068 6561 6465 720a 2020 2020 2020  he header.      
-00029780: 2020 6372 7320 3d20 6c69 7374 286d 6170    crs = list(map
-00029790: 2e68 6561 6465 725b 3136 3a31 395d 290a  .header[16:19]).
-000297a0: 2020 2020 2020 2020 2320 6f72 6469 6e64          # ordind
-000297b0: 7320 7361 7665 2074 6865 2069 6e64 6963  s save the indic
-000297c0: 6573 2063 6f72 7265 7370 6f64 696e 6720  es correspoding 
-000297d0: 746f 2078 2c20 7920 2c7a 0a20 2020 2020  to x, y ,z.     
-000297e0: 2020 206f 7264 696e 6473 203d 205b 6372     ordinds = [cr
-000297f0: 732e 696e 6465 7828 3129 2c20 6372 732e  s.index(1), crs.
-00029800: 696e 6465 7828 3229 2c20 6372 732e 696e  index(2), crs.in
-00029810: 6465 7828 3329 5d0a 0a20 2020 2020 2020  dex(3)]..       
-00029820: 2023 204d 6568 746f 6420 313a 2043 616c   # Mehtod 1: Cal
-00029830: 6375 6c61 7465 696e 6720 7468 6520 6469  culateing the di
-00029840: 7374 616e 6365 7320 6672 6f6d 2074 6865  stances from the
-00029850: 2061 746f 6d20 746f 2064 6966 6665 7265   atom to differe
-00029860: 6e74 2070 6c61 6e65 7328 7827 7927 2c20  nt planes(x'y', 
-00029870: 7827 7a27 2c20 7927 7a27 2920 616e 6420  x'z', y'z') and 
-00029880: 6469 7669 6465 6420 6279 0a20 2020 2020  divided by.     
-00029890: 2020 2023 2054 6865 2075 6e69 7420 6365     # The unit ce
-000298a0: 6c6c 2068 6569 6768 7428 6361 6c63 756c  ll height(calcul
-000298b0: 6174 6564 2062 7920 7573 696e 6720 756e  ated by using un
-000298c0: 6974 2063 656c 6c20 766f 6c75 6d65 2064  it cell volume d
-000298d0: 6976 6964 6564 2062 7920 7468 6520 706c  ivided by the pl
-000298e0: 616e 6520 7375 7266 6163 6520 6172 6561  ane surface area
-000298f0: 2920 746f 2067 6574 2074 6865 0a20 2020  ) to get the.   
-00029900: 2020 2020 2023 2069 6e64 6963 6573 2c20       # indices, 
-00029910: 7468 656e 2064 6564 7563 7420 7468 6520  then deduct the 
-00029920: 6f72 6967 696e 2069 6e64 6578 2077 6869  origin index whi
-00029930: 6368 2067 6976 6520 7468 6520 6669 6e61  ch give the fina
-00029940: 6c20 7265 7375 6c74 732e 2057 6865 6e20  l results. When 
-00029950: 6361 6c63 756c 6174 696e 6720 7468 6520  calculating the 
-00029960: 7369 676e 206f 6620 7468 650a 2020 2020  sign of the.    
-00029970: 2020 2020 2320 6469 7374 616e 6365 2c20      # distance, 
-00029980: 6669 6e64 2061 2070 6c61 6e65 2070 6172  find a plane par
-00029990: 616c 6c65 6c20 746f 2074 6865 2070 726f  allel to the pro
-000299a0: 6a65 6374 696f 6e20 706c 616e 6520 616e  jection plane an
-000299b0: 6420 6974 2070 6173 7320 7468 726f 7567  d it pass throug
-000299c0: 6820 7468 6520 6174 6f6d 2c20 7468 6520  h the atom, the 
-000299d0: 6375 746f 6666 206f 6620 7468 6973 0a20  cutoff of this. 
-000299e0: 2020 2020 2020 2023 2070 6c61 6e65 2061         # plane a
-000299f0: 6e64 2074 6865 2063 6f72 7265 7370 6f64  nd the correspod
-00029a00: 696e 6720 6178 6973 2067 6976 6520 7468  ing axis give th
-00029a10: 6520 6c6f 6361 7469 6f6e 206f 6620 7468  e location of th
-00029a20: 6520 6174 6f6d 2070 726f 6a65 6374 696f  e atom projectio
-00029a30: 6e20 6375 746f 6666 2061 7420 7468 6520  n cutoff at the 
-00029a40: 6178 6973 0a20 2020 2020 2020 2023 2028  axis.        # (
-00029a50: 7468 6973 2073 686f 756c 6420 616c 736f  this should also
-00029a60: 2062 6520 6162 6c65 2074 6f20 7573 6564   be able to used
-00029a70: 2074 6f20 6361 6c63 756c 6174 6520 7468   to calculate th
-00029a80: 6520 6669 6e61 6c20 696e 6469 6365 7328  e final indices(
-00029a90: 6e6f 7420 7472 6965 6429 292e 2049 6620  not tried)). If 
-00029aa0: 7468 6973 2070 6f69 6e74 2069 7320 6f75  this point is ou
-00029ab0: 7473 6964 650a 2020 2020 2020 2020 2320  tside.        # 
-00029ac0: 7468 6520 6e6f 726d 616c 2063 656c 6c20  the normal cell 
-00029ad0: 6469 6d65 6e73 696f 6e20 7261 6e67 652c  dimension range,
-00029ae0: 2074 6865 6e20 7468 6520 6469 7374 616e   then the distan
-00029af0: 6365 2073 686f 756c 6420 6265 206e 6567  ce should be neg
-00029b00: 6174 6976 6520 616e 6420 7669 6365 2076  ative and vice v
-00029b10: 6572 7365 0a20 2020 2020 2020 2072 656c  erse.        rel
-00029b20: 6174 6976 6578 203d 206f 6e65 636f 6f72  ativex = onecoor
-00029b30: 5b30 5d20 2d20 6d61 702e 6865 6164 6572  [0] - map.header
-00029b40: 5b34 395d 0a20 2020 2020 2020 2072 656c  [49].        rel
-00029b50: 6174 6976 6579 203d 206f 6e65 636f 6f72  ativey = onecoor
-00029b60: 5b31 5d20 2d20 6d61 702e 6865 6164 6572  [1] - map.header
-00029b70: 5b35 305d 0a20 2020 2020 2020 2072 656c  [50].        rel
-00029b80: 6174 6976 657a 203d 206f 6e65 636f 6f72  ativez = onecoor
-00029b90: 5b32 5d20 2d20 6d61 702e 6865 6164 6572  [2] - map.header
-00029ba0: 5b35 315d 0a0a 2020 2020 2020 2020 2320  [51]..        # 
-00029bb0: 5a20 696e 6465 7820 6279 2075 7369 6e67  Z index by using
-00029bc0: 2074 6865 2072 656c 6174 6976 657a 202f   the relativez /
-00029bd0: 2063 656c 6c68 6569 6768 747a 0a20 2020   cellheightz.   
-00029be0: 2020 2020 207a 696e 6420 3d20 7265 6c61       zind = rela
-00029bf0: 7469 7665 7a20 2f20 6365 6c6c 6865 6967  tivez / cellheig
-00029c00: 6874 7a0a 2020 2020 2020 2020 7a69 6e64  htz.        zind
-00029c10: 6578 203d 207a 696e 6420 2d20 6d61 702e  ex = zind - map.
-00029c20: 6865 6164 6572 5b34 202b 206f 7264 696e  header[4 + ordin
-00029c30: 6473 5b32 5d5d 0a0a 2020 2020 2020 2020  ds[2]]..        
-00029c40: 2320 5820 696e 6465 7820 6279 2063 616c  # X index by cal
-00029c50: 6375 6c61 7469 6e67 2074 6865 2070 6c61  culating the pla
-00029c60: 6e65 2066 6972 7374 2061 6e64 2074 6865  ne first and the
-00029c70: 6e20 6361 6c63 756c 6174 6520 7468 6520  n calculate the 
-00029c80: 6469 7374 616e 6365 2066 726f 6d20 6174  distance from at
-00029c90: 6f6d 2074 6f20 706c 616e 650a 2020 2020  om to plane.    
-00029ca0: 2020 2020 2320 506c 616e 6520 7827 7a27      # Plane x'z'
-00029cb0: 0a20 2020 2020 2020 2023 2041 7820 2b20  .        # Ax + 
-00029cc0: 4279 202b 2043 7a20 2b20 4420 3d20 3020  By + Cz + D = 0 
-00029cd0: 7769 7468 2074 6872 6565 2064 6174 6120  with three data 
-00029ce0: 706f 696e 7473 3a20 2830 2c20 302c 2030  points: (0, 0, 0
-00029cf0: 292c 2028 622c 2030 2c20 3029 2c0a 2020  ), (b, 0, 0),.  
-00029d00: 2020 2020 2020 2320 2861 2a63 6f73 2861        # (a*cos(a
-00029d10: 6c70 6861 292c 2073 7172 7428 612a 2a32  lpha), sqrt(a**2
-00029d20: 202d 2028 6365 6c6c 6c68 7a29 2a2a 3220   - (celllhz)**2 
-00029d30: 2d20 2861 2a63 6f73 2861 6c70 6861 292a  - (a*cos(alpha)*
-00029d40: 2a32 292c 2063 656c 6c68 7a29 2c20 7827  *2), cellhz), x'
-00029d50: 2075 6e69 7420 6365 6c6c 206c 656e 6774   unit cell lengt
-00029d60: 6820 6973 2062 2c20 616c 7068 6120 6973  h is b, alpha is
-00029d70: 0a20 2020 2020 2020 2023 2074 6865 2061  .        # the a
-00029d80: 6e67 6c65 2062 6574 7765 656e 2078 2720  ngle between x' 
-00029d90: 616e 6420 7a27 2877 6869 6368 2061 7265  and z'(which are
-00029da0: 2074 6865 2063 656c 6c20 6178 6573 290a   the cell axes).
-00029db0: 2020 2020 2020 2020 2320 4279 2075 7369          # By usi
-00029dc0: 6e67 2074 6865 7365 2074 6872 6565 2070  ng these three p
-00029dd0: 6f69 6e74 7320 7468 6520 706c 616e 6520  oints the plane 
-00029de0: 6f66 2078 277a 2720 6361 6e20 6265 2063  of x'z' can be c
-00029df0: 616c 6375 6c61 7465 640a 2020 2020 2020  alculated.      
-00029e00: 2020 2320 413d 302c 2042 3d63 656c 6c68    # A=0, B=cellh
-00029e10: 7a2c 2043 203d 202d 7371 7274 2861 2a2a  z, C = -sqrt(a**
-00029e20: 3220 2d20 2863 656c 6c68 7a29 2a2a 3220  2 - (cellhz)**2 
-00029e30: 2d20 2861 2a63 6f73 2861 6c70 6861 2929  - (a*cos(alpha))
-00029e40: 2a2a 3229 2c20 443d 300a 2020 2020 2020  **2), D=0.      
-00029e50: 2020 4120 3d20 300a 2020 2020 2020 2020    A = 0.        
-00029e60: 4220 3d20 6365 6c6c 6865 6967 6874 7a0a  B = cellheightz.
-00029e70: 2020 2020 2020 2020 4320 3d20 2d6d 6174          C = -mat
-00029e80: 682e 7371 7274 287a 5f61 7069 7820 2a2a  h.sqrt(z_apix **
-00029e90: 2032 202d 2063 656c 6c68 6569 6768 747a   2 - cellheightz
-00029ea0: 202a 2a20 3220 2d20 287a 5f61 7069 7820   ** 2 - (z_apix 
-00029eb0: 2a20 6d61 7468 2e63 6f73 2862 6574 6129  * math.cos(beta)
-00029ec0: 2920 2a2a 2032 290a 2020 2020 2020 2020  ) ** 2).        
-00029ed0: 4420 3d20 300a 0a20 2020 2020 2020 2023  D = 0..        #
-00029ee0: 2064 6973 7461 6e63 6520 6672 6f6d 2061   distance from a
-00029ef0: 746f 6d20 746f 2078 277a 2720 706c 616e  tom to x'z' plan
-00029f00: 653a 0a20 2020 2020 2020 2023 2020 2020  e:.        #    
-00029f10: 2020 2020 207c 4178 202b 2042 7920 2b20       |Ax + By + 
-00029f20: 437a 202b 2044 7c0a 2020 2020 2020 2020  Cz + D|.        
-00029f30: 2320 6420 3d20 2d2d 2d2d 2d2d 2d2d 2d2d  # d = ----------
-00029f40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00029f50: 2d2d 2d0a 2020 2020 2020 2020 2320 2020  ---.        #   
-00029f60: 2020 2020 7371 7274 2841 2a2a 3220 2b20      sqrt(A**2 + 
-00029f70: 422a 2a32 202b 2043 2a2a 3229 0a20 2020  B**2 + C**2).   
-00029f80: 2020 2020 2064 7920 3d20 6d61 7468 2e66       dy = math.f
-00029f90: 6162 7328 4220 2a20 7265 6c61 7469 7665  abs(B * relative
-00029fa0: 7920 2b20 4320 2a20 7265 6c61 7469 7665  y + C * relative
-00029fb0: 7a29 202f 206d 6174 682e 7371 7274 2841  z) / math.sqrt(A
-00029fc0: 202a 2a20 3220 2b20 4220 2a2a 2032 202b   ** 2 + B ** 2 +
-00029fd0: 2043 202a 2a20 3229 0a0a 2020 2020 2020   C ** 2)..      
-00029fe0: 2020 2320 5468 6520 7061 7261 6c6c 656c    # The parallel
-00029ff0: 2070 6c61 6e20 7768 6963 6820 7061 7373   plan which pass
-0002a000: 2074 6865 2061 746f 6d20 616e 6420 696e   the atom and in
-0002a010: 7465 7273 6563 7420 7769 7468 2074 6865  tersect with the
-0002a020: 2078 2069 733a 0a20 2020 2020 2020 2023   x is:.        #
-0002a030: 2041 7829 202b 2042 2879 202b 2061 2920   Ax) + B(y + a) 
-0002a040: 2b20 437a 202b 2044 203d 2030 0a20 2020  + Cz + D = 0.   
-0002a050: 2020 2020 2023 2061 203d 202d 2841 7820       # a = -(Ax 
-0002a060: 2b20 4279 202b 2043 7a20 2b20 4429 2f41  + By + Cz + D)/A
-0002a070: 0a20 2020 2020 2020 2023 2078 6375 7420  .        # xcut 
-0002a080: 3d20 2d61 0a20 2020 2020 2020 2079 6375  = -a.        ycu
-0002a090: 7420 3d20 2d28 4120 2a20 6f6e 6563 6f6f  t = -(A * onecoo
-0002a0a0: 725b 305d 202b 206f 6e65 636f 6f72 5b31  r[0] + onecoor[1
-0002a0b0: 5d20 2b20 2843 202f 2042 2920 2a20 6f6e  ] + (C / B) * on
-0002a0c0: 6563 6f6f 725b 325d 290a 2020 2020 2020  ecoor[2]).      
-0002a0d0: 2020 7963 7574 203d 202d 7963 7574 0a20    ycut = -ycut. 
-0002a0e0: 2020 2020 2020 2069 6620 7963 7574 203c         if ycut <
-0002a0f0: 2030 206f 7220 7963 7574 203e 206d 6170   0 or ycut > map
-0002a100: 2e68 6561 6465 725b 3020 2b20 6f72 6469  .header[0 + ordi
-0002a110: 6e64 735b 315d 5d20 2a20 795f 6170 6978  nds[1]] * y_apix
-0002a120: 202a 206d 6174 682e 7369 6e28 6761 6d6d   * math.sin(gamm
-0002a130: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
-0002a140: 6479 203d 202d 6479 0a0a 2020 2020 2020  dy = -dy..      
-0002a150: 2020 7969 6e64 203d 2064 7920 2f20 6365    yind = dy / ce
-0002a160: 6c6c 6865 6967 6874 790a 2020 2020 2020  llheighty.      
-0002a170: 2020 7969 6e64 6578 203d 2079 696e 6420    yindex = yind 
-0002a180: 2d20 6d61 702e 6865 6164 6572 5b34 202b  - map.header[4 +
-0002a190: 206f 7264 696e 6473 5b31 5d5d 0a0a 2020   ordinds[1]]..  
-0002a1a0: 2020 2020 2020 2320 506c 616e 6520 7a27        # Plane z'
-0002a1b0: 7927 0a20 2020 2020 2020 2023 2041 7820  y'.        # Ax 
-0002a1c0: 2b20 4279 202b 2043 7a20 2b20 4420 3d20  + By + Cz + D = 
-0002a1d0: 3020 7769 7468 2074 6872 6565 2064 6174  0 with three dat
-0002a1e0: 6120 706f 696e 7473 3a20 2830 2c20 302c  a points: (0, 0,
-0002a1f0: 2030 292c 2028 612a 636f 7328 616c 7068   0), (a*cos(alph
-0002a200: 6129 2c0a 2020 2020 2020 2020 2320 7371  a),.        # sq
-0002a210: 7274 2861 2a2a 3220 2d20 2863 656c 6c68  rt(a**2 - (cellh
-0002a220: 7a29 2a2a 3220 2d20 2861 2a63 6f73 2861  z)**2 - (a*cos(a
-0002a230: 6c70 6861 292a 2a32 292c 2063 656c 6c68  lpha)**2), cellh
-0002a240: 7a29 2c0a 2020 2020 2020 2020 2320 2864  z),.        # (d
-0002a250: 2a63 6f73 2867 616d 6d61 292c 2064 2a73  *cos(gamma), d*s
-0002a260: 696e 2867 616d 6d61 292c 2030 290a 2020  in(gamma), 0).  
-0002a270: 2020 2020 2020 2320 6265 7461 2069 7320        # beta is 
-0002a280: 7468 6520 616e 676c 6520 6265 7477 6565  the angle betwee
-0002a290: 6e20 7827 2061 6e64 207a 273b 2067 616d  n x' and z'; gam
-0002a2a0: 6d61 2069 7320 7468 6520 616e 676c 6520  ma is the angle 
-0002a2b0: 6265 7477 6565 6e20 7827 2061 6e64 2079  between x' and y
-0002a2c0: 273b 2064 2069 7320 7468 6520 6365 6c6c  '; d is the cell
-0002a2d0: 2075 6e69 7420 6c65 6e67 7468 0a20 2020   unit length.   
-0002a2e0: 2020 2020 2023 2061 6c6f 6e67 2079 270a       # along y'.
-0002a2f0: 2020 2020 2020 2020 2320 5573 696e 6720          # Using 
-0002a300: 7468 6573 6520 7468 7265 6520 706f 696e  these three poin
-0002a310: 7473 2061 2070 6c61 6e65 2063 616e 2062  ts a plane can b
-0002a320: 6520 6361 6c63 756c 6174 6564 0a20 2020  e calculated.   
-0002a330: 2020 2020 2023 2041 3d2d 7467 2862 6574       # A=-tg(bet
-0002a340: 6129 2c20 4220 3d20 312c 2044 3d30 2c0a  a), B = 1, D=0,.
-0002a350: 2020 2020 2020 2020 2320 2020 2020 2061          #      a
-0002a360: 2a63 6f73 2861 6c70 6861 292a 7467 2862  *cos(alpha)*tg(b
-0002a370: 6574 6129 202d 2074 0a20 2020 2020 2020  eta) - t.       
-0002a380: 2023 2043 203d 202d 2d2d 2d2d 2d2d 2d2d   # C = ---------
-0002a390: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0002a3a0: 2d2d 202c 2020 2020 2074 203d 2073 7172  -- ,     t = sqr
-0002a3b0: 7428 612a 2a32 202d 2028 6365 6c6c 687a  t(a**2 - (cellhz
-0002a3c0: 292a 2a32 202d 2028 612a 636f 7328 616c  )**2 - (a*cos(al
-0002a3d0: 7068 6129 292a 2a32 290a 2020 2020 2020  pha))**2).      
-0002a3e0: 2020 2320 2020 2020 2020 2020 2020 2063    #            c
-0002a3f0: 656c 6c68 7a0a 2020 2020 2020 2020 2320  ellhz.        # 
-0002a400: 4120 3d20 2d6d 6174 682e 7461 6e28 6761  A = -math.tan(ga
-0002a410: 6d6d 6129 0a20 2020 2020 2020 2023 2042  mma).        # B
-0002a420: 203d 2031 0a20 2020 2020 2020 2023 2044   = 1.        # D
-0002a430: 203d 2030 0a20 2020 2020 2020 2023 2074   = 0.        # t
-0002a440: 203d 206d 6174 682e 7371 7274 287a 5f61   = math.sqrt(z_a
-0002a450: 7069 782a 2a32 202d 2063 656c 6c68 6569  pix**2 - cellhei
-0002a460: 6768 747a 2a2a 3220 2d20 287a 5f61 7069  ghtz**2 - (z_api
-0002a470: 782a 6d61 7468 2e63 6f73 2862 6574 6129  x*math.cos(beta)
-0002a480: 292a 2a32 290a 2020 2020 2020 2020 2320  )**2).        # 
-0002a490: 4320 3d20 287a 5f61 7069 7820 2a20 6d61  C = (z_apix * ma
-0002a4a0: 7468 2e63 6f73 2862 6574 6129 2a6d 6174  th.cos(beta)*mat
-0002a4b0: 682e 7461 6e28 6761 6d6d 6129 202d 2074  h.tan(gamma) - t
-0002a4c0: 2920 2f20 6365 6c6c 6865 6967 6874 7a0a  ) / cellheightz.
-0002a4d0: 0a20 2020 2020 2020 2069 6620 6d61 702e  .        if map.
-0002a4e0: 6865 6164 6572 5b31 355d 203d 3d20 3930  header[15] == 90
-0002a4f0: 2e3a 0a20 2020 2020 2020 2020 2020 2073  .:.            s
-0002a500: 696e 6761 6d6d 6120 3d20 312e 0a20 2020  ingamma = 1..   
-0002a510: 2020 2020 2020 2020 2063 6f73 6761 6d6d           cosgamm
-0002a520: 6120 3d20 302e 0a20 2020 2020 2020 2065  a = 0..        e
-0002a530: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002a540: 2073 696e 6761 6d6d 6120 3d20 6d61 7468   singamma = math
-0002a550: 2e73 696e 2867 616d 6d61 290a 2020 2020  .sin(gamma).    
-0002a560: 2020 2020 2020 2020 636f 7367 616d 6d61          cosgamma
-0002a570: 203d 206d 6174 682e 636f 7328 6761 6d6d   = math.cos(gamm
-0002a580: 6129 0a0a 2020 2020 2020 2020 6966 206d  a)..        if m
-0002a590: 6170 2e68 6561 6465 725b 3134 5d20 3d3d  ap.header[14] ==
-0002a5a0: 2039 302e 3a0a 2020 2020 2020 2020 2020   90.:.          
-0002a5b0: 2020 7369 6e67 6265 7461 203d 2031 2e0a    singbeta = 1..
-0002a5c0: 2020 2020 2020 2020 2020 2020 636f 7362              cosb
-0002a5d0: 6574 6120 3d20 302e 0a20 2020 2020 2020  eta = 0..       
-0002a5e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002a5f0: 2020 2073 696e 6265 7461 203d 206d 6174     sinbeta = mat
-0002a600: 682e 7369 6e28 6265 7461 290a 2020 2020  h.sin(beta).    
-0002a610: 2020 2020 2020 2020 636f 7362 6574 6120          cosbeta 
-0002a620: 3d20 6d61 7468 2e63 6f73 2862 6574 6129  = math.cos(beta)
-0002a630: 0a0a 2020 2020 2020 2020 4120 3d20 2d73  ..        A = -s
-0002a640: 696e 6761 6d6d 610a 2020 2020 2020 2020  ingamma.        
-0002a650: 4220 3d20 636f 7367 616d 6d61 0a20 2020  B = cosgamma.   
-0002a660: 2020 2020 2044 203d 2030 0a20 2020 2020       D = 0.     
-0002a670: 2020 2074 203d 206d 6174 682e 7371 7274     t = math.sqrt
-0002a680: 287a 5f61 7069 7820 2a2a 2032 202d 2063  (z_apix ** 2 - c
-0002a690: 656c 6c68 6569 6768 747a 202a 2a20 3220  ellheightz ** 2 
-0002a6a0: 2d20 287a 5f61 7069 7820 2a20 636f 7362  - (z_apix * cosb
-0002a6b0: 6574 6129 202a 2a20 3229 0a20 2020 2020  eta) ** 2).     
-0002a6c0: 2020 2043 203d 2028 7a5f 6170 6978 202a     C = (z_apix *
-0002a6d0: 2063 6f73 6265 7461 202a 2073 696e 6761   cosbeta * singa
-0002a6e0: 6d6d 6120 2d20 7420 2a20 636f 7367 616d  mma - t * cosgam
-0002a6f0: 6d61 2920 2f20 6365 6c6c 6865 6967 6874  ma) / cellheight
-0002a700: 7a0a 0a20 2020 2020 2020 2023 2064 6973  z..        # dis
-0002a710: 7461 6e63 6520 6672 6f6d 2061 746f 6d20  tance from atom 
-0002a720: 746f 207a 2779 2720 706c 616e 653a 0a20  to z'y' plane:. 
-0002a730: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0002a740: 207c 4178 202b 2042 7920 2b20 437a 202b   |Ax + By + Cz +
-0002a750: 2044 7c0a 2020 2020 2020 2020 2320 6420   D|.        # d 
-0002a760: 3d20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  = --------------
-0002a770: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-0002a780: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0002a790: 7371 7274 2841 2a2a 3220 2b20 422a 2a32  sqrt(A**2 + B**2
-0002a7a0: 202b 2043 2a2a 3229 0a20 2020 2020 2020   + C**2).       
-0002a7b0: 2064 7820 3d20 6d61 7468 2e66 6162 7328   dx = math.fabs(
-0002a7c0: 4120 2a20 7265 6c61 7469 7665 7820 2b20  A * relativex + 
-0002a7d0: 4220 2a20 7265 6c61 7469 7665 7920 2b20  B * relativey + 
-0002a7e0: 4320 2a20 7265 6c61 7469 7665 7a29 202f  C * relativez) /
-0002a7f0: 206d 6174 682e 7371 7274 2841 202a 2a20   math.sqrt(A ** 
-0002a800: 3220 2b20 4220 2a2a 2032 202b 2043 202a  2 + B ** 2 + C *
-0002a810: 2a20 3229 0a20 2020 2020 2020 2078 6375  * 2).        xcu
-0002a820: 7420 3d20 282d 286f 6e65 636f 6f72 5b30  t = (-(onecoor[0
-0002a830: 5d20 2b20 2842 202f 2041 2920 2a20 6f6e  ] + (B / A) * on
-0002a840: 6563 6f6f 725b 315d 202b 2028 4320 2f20  ecoor[1] + (C / 
-0002a850: 4129 202a 206f 6e65 636f 6f72 5b32 5d29  A) * onecoor[2])
-0002a860: 290a 2020 2020 2020 2020 7863 7574 203d  ).        xcut =
-0002a870: 202d 7863 7574 0a20 2020 2020 2020 2069   -xcut.        i
-0002a880: 6620 7863 7574 203c 2030 206f 7220 7863  f xcut < 0 or xc
-0002a890: 7574 203e 206d 6170 2e68 6561 6465 725b  ut > map.header[
-0002a8a0: 3020 2b20 6f72 6469 6e64 735b 305d 5d20  0 + ordinds[0]] 
-0002a8b0: 2a20 785f 6170 6978 3a0a 2020 2020 2020  * x_apix:.      
-0002a8c0: 2020 2020 2020 6478 203d 202d 6478 0a20        dx = -dx. 
-0002a8d0: 2020 2020 2020 2078 696e 6420 3d20 6478         xind = dx
-0002a8e0: 202f 2063 656c 6c68 6569 6768 7478 0a20   / cellheightx. 
-0002a8f0: 2020 2020 2020 2078 696e 6465 7820 3d20         xindex = 
-0002a900: 7869 6e64 202d 206d 6170 2e68 6561 6465  xind - map.heade
-0002a910: 725b 3420 2b20 6f72 6469 6e64 735b 305d  r[4 + ordinds[0]
-0002a920: 5d0a 0a0a 2020 2020 2020 2020 7265 7475  ]...        retu
-0002a930: 726e 2878 696e 6465 782c 2079 696e 6465  rn(xindex, yinde
-0002a940: 782c 207a 696e 6465 7829 0a0a 0a20 2020  x, zindex)...   
-0002a950: 2064 6566 205f 5f67 6574 696e 6469 6365   def __getindice
-0002a960: 7328 7365 6c66 2c20 6f6e 6563 6f6f 7229  s(self, onecoor)
-0002a970: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
-0002a980: 2020 2020 2020 2020 2020 2046 696e 6420             Find 
-0002a990: 6f6e 6520 6174 6f6d 2773 2069 6e64 6963  one atom's indic
-0002a9a0: 6573 2063 6f72 7265 7370 6f64 696e 6720  es correspoding 
-0002a9b0: 746f 2069 7473 2063 7562 6963 206f 7220  to its cubic or 
-0002a9c0: 706c 616e 650a 2020 2020 2020 2020 2020  plane.          
-0002a9d0: 2020 7468 6520 3820 2863 7562 6963 2920    the 8 (cubic) 
-0002a9e0: 6f72 2034 2028 706c 616e 6529 2069 6e64  or 4 (plane) ind
-0002a9f0: 6963 6573 2061 7265 2073 6176 6564 2069  ices are saved i
-0002aa00: 6e20 696e 6469 6365 7320 7661 7269 6162  n indices variab
-0002aa10: 6c65 0a0a 2020 2020 2020 2020 3a70 6172  le..        :par
-0002aa20: 616d 206d 6170 3a20 4465 6e73 6974 7920  am map: Density 
-0002aa30: 6d61 7020 696e 7374 616e 6365 2066 726f  map instance fro
-0002aa40: 6d20 5445 4d50 792e 4d61 7050 6172 7365  m TEMPy.MapParse
-0002aa50: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-0002aa60: 206f 6e65 636f 6f72 3a20 4c69 7374 2063   onecoor: List c
-0002aa70: 6f6e 7461 696e 7320 7468 6520 6174 6f6d  ontains the atom
-0002aa80: 2063 6f6f 7264 696e 6174 6573 2069 6e20   coordinates in 
-0002aa90: 2878 2c20 792c 207a 2920 6f72 6465 720a  (x, y, z) order.
-0002aaa0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0002aab0: 2054 7570 6c65 2063 6f6e 7461 696e 7320   Tuple contains 
-0002aac0: 7477 6f20 6c69 7374 206f 6620 696e 6465  two list of inde
-0002aad0: 783a 2066 6972 7374 2068 6173 2074 6865  x: first has the
-0002aae0: 2038 206f 7220 3420 696e 6469 6365 7320   8 or 4 indices 
-0002aaf0: 696e 2074 6865 2063 7562 6963 3b0a 2020  in the cubic;.  
-0002ab00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002ab10: 6563 6f6e 6420 6861 7320 7468 6520 666c  econd has the fl
-0002ab20: 6f61 7420 696e 6465 7820 6f66 2074 6865  oat index of the
-0002ab30: 2069 6e70 7574 2061 746f 6d0a 0a20 2020   input atom..   
-0002ab40: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0002ab50: 2020 2320 466f 7220 6e6f 6e2d 6375 6269    # For non-cubi
-0002ab60: 6320 6f72 2073 6b65 7765 6420 6465 6e73  c or skewed dens
-0002ab70: 6974 7920 6d61 7073 2c20 7468 6579 206d  ity maps, they m
-0002ab80: 6967 6874 2068 6176 6520 6469 6666 6572  ight have differ
-0002ab90: 656e 7420 6170 6978 206f 6e20 6469 6666  ent apix on diff
-0002aba0: 6572 656e 7420 6178 6973 6573 0a20 2020  erent axises.   
-0002abb0: 2020 2020 206d 6170 203d 2073 656c 662e       map = self.
-0002abc0: 6d61 700a 2020 2020 2020 2020 7a64 696d  map.        zdim
-0002abd0: 203d 206d 6170 2e68 6561 6465 722e 6365   = map.header.ce
-0002abe0: 6c6c 612e 7a0a 2020 2020 2020 2020 7a6e  lla.z.        zn
-0002abf0: 696e 7465 7276 616c 7320 3d20 6d61 702e  intervals = map.
-0002ac00: 6865 6164 6572 2e6d 7a0a 2020 2020 2020  header.mz.      
-0002ac10: 2020 7a5f 6170 6978 203d 207a 6469 6d20    z_apix = zdim 
-0002ac20: 2f20 7a6e 696e 7465 7276 616c 730a 0a20  / znintervals.. 
-0002ac30: 2020 2020 2020 2079 6469 6d20 3d20 6d61         ydim = ma
-0002ac40: 702e 6865 6164 6572 2e63 656c 6c61 2e79  p.header.cella.y
-0002ac50: 0a20 2020 2020 2020 2079 6e69 6e74 6572  .        yninter
-0002ac60: 7661 6c73 203d 206d 6170 2e68 6561 6465  vals = map.heade
-0002ac70: 722e 6d79 0a20 2020 2020 2020 2079 5f61  r.my.        y_a
-0002ac80: 7069 7820 3d20 7964 696d 202f 2079 6e69  pix = ydim / yni
-0002ac90: 6e74 6572 7661 6c73 0a0a 2020 2020 2020  ntervals..      
-0002aca0: 2020 7864 696d 203d 206d 6170 2e68 6561    xdim = map.hea
-0002acb0: 6465 722e 6365 6c6c 612e 780a 2020 2020  der.cella.x.    
-0002acc0: 2020 2020 786e 696e 7465 7276 616c 7320      xnintervals 
-0002acd0: 3d20 6d61 702e 6865 6164 6572 2e6d 780a  = map.header.mx.
-0002ace0: 2020 2020 2020 2020 785f 6170 6978 203d          x_apix =
-0002acf0: 2078 6469 6d20 2f20 786e 696e 7465 7276   xdim / xninterv
-0002ad00: 616c 730a 0a20 2020 2020 2020 206d 6170  als..        map
-0002ad10: 5f7a 7369 7a65 203d 206d 6170 2e68 6561  _zsize = map.hea
-0002ad20: 6465 722e 6e7a 0a20 2020 2020 2020 206d  der.nz.        m
-0002ad30: 6170 5f79 7369 7a65 203d 206d 6170 2e68  ap_ysize = map.h
-0002ad40: 6561 6465 722e 6e79 0a20 2020 2020 2020  eader.ny.       
-0002ad50: 206d 6170 5f78 7369 7a65 203d 206d 6170   map_xsize = map
-0002ad60: 2e68 6561 6465 722e 6e78 0a0a 2020 2020  .header.nx..    
-0002ad70: 2020 2020 2320 6966 206d 6170 2e68 6561      # if map.hea
-0002ad80: 6465 725b 3133 5d20 3d3d 206d 6170 2e68  der[13] == map.h
-0002ad90: 6561 6465 725b 3134 5d20 3d3d 206d 6170  eader[14] == map
-0002ada0: 2e68 6561 6465 725b 3135 5d20 3d3d 2039  .header[15] == 9
-0002adb0: 302e 3a0a 2020 2020 2020 2020 6966 206d  0.:.        if m
-0002adc0: 6170 2e68 6561 6465 722e 6365 6c6c 622e  ap.header.cellb.
-0002add0: 616c 7068 6120 3d3d 206d 6170 2e68 6561  alpha == map.hea
-0002ade0: 6465 722e 6365 6c6c 622e 6265 7461 203d  der.cellb.beta =
-0002adf0: 3d20 6d61 702e 6865 6164 6572 2e63 656c  = map.header.cel
-0002ae00: 6c62 2e67 616d 6d61 203d 3d20 3930 2e3a  lb.gamma == 90.:
-0002ae10: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-0002ae20: 6967 7572 6520 6f75 7420 7468 6520 6f72  igure out the or
-0002ae30: 6465 7220 6f66 2074 6865 2078 2c20 792c  der of the x, y,
-0002ae40: 207a 2062 6173 6564 206f 6e20 6372 7320   z based on crs 
-0002ae50: 696e 666f 2069 6e20 7468 6520 6865 6164  info in the head
-0002ae60: 6572 0a20 2020 2020 2020 2020 2020 2023  er.            #
-0002ae70: 2063 7273 203d 206c 6973 7428 6d61 702e   crs = list(map.
-0002ae80: 6865 6164 6572 5b31 363a 3139 5d29 0a20  header[16:19]). 
-0002ae90: 2020 2020 2020 2020 2020 2063 7273 203d             crs =
-0002aea0: 205b 6d61 702e 6865 6164 6572 2e6d 6170   [map.header.map
-0002aeb0: 632c 206d 6170 2e68 6561 6465 722e 6d61  c, map.header.ma
-0002aec0: 7072 2c20 6d61 702e 6865 6164 6572 2e6d  pr, map.header.m
-0002aed0: 6170 735d 0a20 2020 2020 2020 2020 2020  aps].           
-0002aee0: 2023 206f 7264 696e 6473 2073 6176 6520   # ordinds save 
-0002aef0: 7468 6520 696e 6469 6365 7320 636f 7272  the indices corr
-0002af00: 6573 706f 6469 6e67 2074 6f20 782c 2079  espoding to x, y
-0002af10: 202c 7a0a 2020 2020 2020 2020 2020 2020   ,z.            
-0002af20: 6f72 6469 6e64 7320 3d20 5b63 7273 2e69  ordinds = [crs.i
-0002af30: 6e64 6578 2831 292c 2063 7273 2e69 6e64  ndex(1), crs.ind
-0002af40: 6578 2832 292c 2063 7273 2e69 6e64 6578  ex(2), crs.index
-0002af50: 2833 295d 0a0a 2020 2020 2020 2020 2020  (3)]..          
-0002af60: 2020 7a69 6e64 6578 203d 2066 6c6f 6174    zindex = float
-0002af70: 286f 6e65 636f 6f72 5b32 5d20 2d20 6d61  (onecoor[2] - ma
-0002af80: 702e 6865 6164 6572 2e6f 7269 6769 6e2e  p.header.origin.
-0002af90: 7a29 202f 207a 5f61 7069 7820 2d20 6d61  z) / z_apix - ma
-0002afa0: 702e 6865 6164 6572 2e6e 7a73 7461 7274  p.header.nzstart
-0002afb0: 0a20 2020 2020 2020 2020 2020 2079 696e  .            yin
-0002afc0: 6465 7820 3d20 666c 6f61 7428 6f6e 6563  dex = float(onec
-0002afd0: 6f6f 725b 315d 202d 206d 6170 2e68 6561  oor[1] - map.hea
-0002afe0: 6465 722e 6f72 6967 696e 2e79 2920 2f20  der.origin.y) / 
-0002aff0: 795f 6170 6978 202d 206d 6170 2e68 6561  y_apix - map.hea
-0002b000: 6465 722e 6e79 7374 6172 740a 2020 2020  der.nystart.    
-0002b010: 2020 2020 2020 2020 7869 6e64 6578 203d          xindex =
-0002b020: 2066 6c6f 6174 286f 6e65 636f 6f72 5b30   float(onecoor[0
-0002b030: 5d20 2d20 6d61 702e 6865 6164 6572 2e6f  ] - map.header.o
-0002b040: 7269 6769 6e2e 7829 202f 2078 5f61 7069  rigin.x) / x_api
-0002b050: 7820 2d20 6d61 702e 6865 6164 6572 2e6e  x - map.header.n
-0002b060: 7873 7461 7274 0a0a 2020 2020 2020 2020  xstart..        
-0002b070: 2020 2020 7a66 6c6f 6f72 203d 2069 6e74      zfloor = int
-0002b080: 2866 6c6f 6f72 287a 696e 6465 7829 290a  (floor(zindex)).
-0002b090: 2020 2020 2020 2020 2020 2020 6966 207a              if z
-0002b0a0: 666c 6f6f 7220 3e3d 206d 6170 5f7a 7369  floor >= map_zsi
-0002b0b0: 7a65 202d 2031 3a0a 2020 2020 2020 2020  ze - 1:.        
-0002b0c0: 2020 2020 2020 2020 7a63 6569 6c20 3d20          zceil = 
-0002b0d0: 7a66 6c6f 6f72 0a20 2020 2020 2020 2020  zfloor.         
-0002b0e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002b0f0: 2020 2020 2020 2020 207a 6365 696c 203d           zceil =
-0002b100: 207a 666c 6f6f 7220 2b20 310a 0a20 2020   zfloor + 1..   
-0002b110: 2020 2020 2020 2020 2079 666c 6f6f 7220           yfloor 
-0002b120: 3d20 696e 7428 666c 6f6f 7228 7969 6e64  = int(floor(yind
-0002b130: 6578 2929 0a20 2020 2020 2020 2020 2020  ex)).           
-0002b140: 2069 6620 7966 6c6f 6f72 203e 3d20 6d61   if yfloor >= ma
-0002b150: 705f 7973 697a 6520 2d20 313a 0a20 2020  p_ysize - 1:.   
-0002b160: 2020 2020 2020 2020 2020 2020 2079 6365               yce
-0002b170: 696c 203d 2079 666c 6f6f 720a 2020 2020  il = yfloor.    
-0002b180: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002b190: 2020 2020 2020 2020 2020 2020 2020 7963                yc
-0002b1a0: 6569 6c20 3d20 7966 6c6f 6f72 202b 2031  eil = yfloor + 1
-0002b1b0: 0a0a 2020 2020 2020 2020 2020 2020 7866  ..            xf
-0002b1c0: 6c6f 6f72 203d 2069 6e74 2866 6c6f 6f72  loor = int(floor
-0002b1d0: 2878 696e 6465 7829 290a 2020 2020 2020  (xindex)).      
-0002b1e0: 2020 2020 2020 6966 2078 666c 6f6f 7220        if xfloor 
-0002b1f0: 3e3d 206d 6170 5f78 7369 7a65 202d 2031  >= map_xsize - 1
-0002b200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b210: 2020 7863 6569 6c20 3d20 7866 6c6f 6f72    xceil = xfloor
-0002b220: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002b230: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002b240: 2020 2078 6365 696c 203d 2078 666c 6f6f     xceil = xfloo
-0002b250: 7220 2b20 310a 2020 2020 2020 2020 656c  r + 1.        el
-0002b260: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002b270: 2320 4d65 7468 6f64 2032 3a20 6279 2075  # Method 2: by u
-0002b280: 7369 6e67 2074 6865 2066 7261 6374 696f  sing the fractio
-0002b290: 6e61 6c20 636f 6f72 6469 6e61 7465 206d  nal coordinate m
-0002b2a0: 6174 7269 780a 2020 2020 2020 2020 2020  atrix.          
-0002b2b0: 2020 2320 4368 6f73 656e 2061 7320 7468    # Chosen as th
-0002b2c0: 6520 7072 696d 6172 7920 666f 7220 7468  e primary for th
-0002b2d0: 6520 6375 7272 656e 7420 696d 706c 656d  e current implem
-0002b2e0: 656e 7461 7469 6f6e 0a20 2020 2020 2020  entation.       
-0002b2f0: 2020 2020 2061 7069 7873 203d 205b 785f       apixs = [x_
-0002b300: 6170 6978 2c20 795f 6170 6978 2c20 7a5f  apix, y_apix, z_
-0002b310: 6170 6978 5d0a 2020 2020 2020 2020 2020  apix].          
-0002b320: 2020 2320 4d65 7468 6f64 2031 3a20 6279    # Method 1: by
-0002b330: 2075 7369 6e67 2074 6865 2061 746f 6d20   using the atom 
-0002b340: 7072 6f6a 6563 7469 6f6e 206f 6e20 706c  projection on pl
-0002b350: 616e 6573 0a20 2020 2020 2020 2020 2020  anes.           
-0002b360: 2023 2078 696e 6465 782c 2079 696e 6465   # xindex, yinde
-0002b370: 782c 207a 696e 6465 7820 3d20 7365 6c66  x, zindex = self
-0002b380: 2e70 726f 6a65 6374 696f 6e5f 696e 6469  .projection_indi
-0002b390: 6365 7328 6f6e 6563 6f6f 7229 290a 2020  ces(onecoor)).  
-0002b3a0: 2020 2020 2020 2020 2020 7869 6e64 6578            xindex
-0002b3b0: 2c20 7969 6e64 6578 2c20 7a69 6e64 6578  , yindex, zindex
-0002b3c0: 203d 2073 656c 662e 6d61 7472 6978 5f69   = self.matrix_i
-0002b3d0: 6e64 6963 6573 2861 7069 7873 2c20 6f6e  ndices(apixs, on
-0002b3e0: 6563 6f6f 7229 0a0a 2020 2020 2020 2020  ecoor)..        
-0002b3f0: 2020 2020 7a66 6c6f 6f72 203d 2069 6e74      zfloor = int
-0002b400: 2866 6c6f 6f72 287a 696e 6465 7829 290a  (floor(zindex)).
-0002b410: 2020 2020 2020 2020 2020 2020 6966 207a              if z
-0002b420: 666c 6f6f 7220 3e3d 206d 6170 5f7a 7369  floor >= map_zsi
-0002b430: 7a65 202d 2031 3a0a 2020 2020 2020 2020  ze - 1:.        
-0002b440: 2020 2020 2020 2020 7a63 6569 6c20 3d20          zceil = 
-0002b450: 7a66 6c6f 6f72 0a20 2020 2020 2020 2020  zfloor.         
-0002b460: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002b470: 2020 2020 2020 2020 207a 6365 696c 203d           zceil =
-0002b480: 207a 666c 6f6f 7220 2b20 310a 0a20 2020   zfloor + 1..   
-0002b490: 2020 2020 2020 2020 2079 666c 6f6f 7220           yfloor 
-0002b4a0: 3d20 696e 7428 666c 6f6f 7228 7969 6e64  = int(floor(yind
-0002b4b0: 6578 2929 0a20 2020 2020 2020 2020 2020  ex)).           
-0002b4c0: 2069 6620 7966 6c6f 6f72 203e 3d20 6d61   if yfloor >= ma
-0002b4d0: 705f 7973 697a 6520 2d20 313a 0a20 2020  p_ysize - 1:.   
-0002b4e0: 2020 2020 2020 2020 2020 2020 2079 6365               yce
-0002b4f0: 696c 203d 2079 666c 6f6f 720a 2020 2020  il = yfloor.    
-0002b500: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002b510: 2020 2020 2020 2020 2020 2020 2020 7963                yc
-0002b520: 6569 6c20 3d20 7966 6c6f 6f72 202b 2031  eil = yfloor + 1
-0002b530: 0a0a 2020 2020 2020 2020 2020 2020 7866  ..            xf
-0002b540: 6c6f 6f72 203d 2069 6e74 2866 6c6f 6f72  loor = int(floor
-0002b550: 2878 696e 6465 7829 290a 2020 2020 2020  (xindex)).      
-0002b560: 2020 2020 2020 6966 2078 666c 6f6f 7220        if xfloor 
-0002b570: 3e3d 206d 6170 5f78 7369 7a65 202d 2031  >= map_xsize - 1
-0002b580: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002b590: 2020 7863 6569 6c20 3d20 7866 6c6f 6f72    xceil = xfloor
-0002b5a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002b5b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002b5c0: 2020 2078 6365 696c 203d 2078 666c 6f6f     xceil = xfloo
-0002b5d0: 7220 2b20 310a 0a20 2020 2020 2020 2069  r + 1..        i
-0002b5e0: 6e64 6963 6573 203d 206e 702e 6172 7261  ndices = np.arra
-0002b5f0: 7928 6e70 2e6d 6573 6867 7269 6428 6e70  y(np.meshgrid(np
-0002b600: 2e61 7261 6e67 6528 7866 6c6f 6f72 2c20  .arange(xfloor, 
-0002b610: 7863 6569 6c20 2b20 3129 2c20 6e70 2e61  xceil + 1), np.a
-0002b620: 7261 6e67 6528 7966 6c6f 6f72 2c20 7963  range(yfloor, yc
-0002b630: 6569 6c20 2b20 3129 2c0a 2020 2020 2020  eil + 1),.      
-0002b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b660: 206e 702e 6172 616e 6765 287a 666c 6f6f   np.arange(zfloo
-0002b670: 722c 207a 6365 696c 202b 2031 2929 292e  r, zceil + 1))).
-0002b680: 542e 7265 7368 6170 6528 2d31 2c20 3329  T.reshape(-1, 3)
-0002b690: 0a20 2020 2020 2020 206f 6e65 696e 6465  .        oneinde
-0002b6a0: 7820 3d20 5b78 696e 6465 782c 2079 696e  x = [xindex, yin
-0002b6b0: 6465 782c 207a 696e 6465 785d 0a0a 2020  dex, zindex]..  
-0002b6c0: 2020 2020 2020 7265 7475 726e 2028 696e        return (in
-0002b6d0: 6469 6365 732c 206f 6e65 696e 6465 7829  dices, oneindex)
-0002b6e0: 0a0a 0a20 2020 2064 6566 205f 5f67 6574  ...    def __get
-0002b6f0: 6672 6163 7469 6f6e 7328 7365 6c66 2c20  fractions(self, 
-0002b700: 696e 7465 7270 6f6c 6174 696f 6e2c 206d  interpolation, m
-0002b710: 6f64 656c 293a 0a20 2020 2020 2020 2022  odel):.        "
-0002b720: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-0002b730: 5072 6f64 7563 6520 6174 6f6d 2069 6e63  Produce atom inc
-0002b740: 6c75 7369 6f6e 2066 7261 6374 696f 6e20  lusion fraction 
-0002b750: 696e 666f 726d 6174 696f 6e20 666f 7220  information for 
-0002b760: 6675 6c6c 2061 746f 6d73 2061 6e64 2062  full atoms and b
-0002b770: 6163 6b62 6f6e 6520 7472 6163 650a 0a20  ackbone trace.. 
-0002b780: 2020 2020 2020 203a 7061 7261 6d20 696e         :param in
-0002b790: 7465 7270 6f6c 6174 696f 6e3a 204c 6973  terpolation: Lis
-0002b7a0: 7420 6f66 2069 6e74 6572 706f 6c61 7469  t of interpolati
-0002b7b0: 6f6e 2076 616c 7565 730a 2020 2020 2020  on values.      
-0002b7c0: 2020 3a70 6172 616d 206d 6170 3a20 456c    :param map: El
-0002b7d0: 6563 7472 6f6e 2064 656e 7369 7479 206d  ectron density m
-0002b7e0: 6170 2069 6e20 6d72 632f 6d61 7020 666f  ap in mrc/map fo
-0002b7f0: 726d 6174 0a20 2020 2020 2020 203a 7061  rmat.        :pa
-0002b800: 7261 6d20 6d6f 6465 6c3a 2050 726f 7465  ram model: Prote
-0002b810: 696e 206d 6f64 656c 2069 6e20 6d6d 6369  in model in mmci
-0002b820: 6620 666f 726d 6174 0a20 2020 2020 2020  f format.       
-0002b830: 203a 7265 7475 726e 3a20 5475 706c 6520   :return: Tuple 
-0002b840: 636f 6e74 6169 6e73 2066 756c 6c20 6174  contains full at
-0002b850: 6f6d 2069 6e63 6c75 7369 6f6e 2066 7261  om inclusion fra
-0002b860: 6374 696f 6e73 2061 6e64 2062 6163 6b62  ctions and backb
-0002b870: 6f6e 6520 696e 636c 7573 696f 6e20 6672  one inclusion fr
-0002b880: 6163 7469 6f6e 730a 0a20 2020 2020 2020  actions..       
-0002b890: 2022 2222 0a0a 2020 2020 2020 2020 6d61   """..        ma
-0002b8a0: 7020 3d20 7365 6c66 2e6d 6170 0a20 2020  p = self.map.   
-0002b8b0: 2020 2020 2062 696e 7320 3d20 6e70 2e6c       bins = np.l
-0002b8c0: 696e 7370 6163 6528 6d61 702e 6461 7461  inspace(map.data
-0002b8d0: 2e6d 696e 2829 2c20 6d61 702e 6461 7461  .min(), map.data
-0002b8e0: 2e6d 6178 2829 2c20 3132 3929 0a20 2020  .max(), 129).   
-0002b8f0: 2020 2020 2062 696e 6c69 7374 203d 2062       binlist = b
-0002b900: 696e 732e 746f 6c69 7374 2829 0a20 2020  ins.tolist().   
-0002b910: 2020 2020 2062 6973 6563 742e 696e 736f       bisect.inso
-0002b920: 7274 2862 696e 6c69 7374 2c20 7365 6c66  rt(binlist, self
-0002b930: 2e63 6c29 0a20 2020 2020 2020 2063 6c69  .cl).        cli
-0002b940: 6e64 6578 203d 2062 696e 6c69 7374 2e69  ndex = binlist.i
-0002b950: 6e64 6578 2873 656c 662e 636c 290a 2020  ndex(self.cl).  
-0002b960: 2020 2020 2020 6269 6e6c 6973 742e 706f        binlist.po
-0002b970: 7028 636c 696e 6465 7820 2d20 3129 0a20  p(clindex - 1). 
-0002b980: 2020 2020 2020 2062 696e 7320 3d20 6e70         bins = np
-0002b990: 2e61 7361 7272 6179 2862 696e 6c69 7374  .asarray(binlist
-0002b9a0: 290a 0a20 2020 2020 2020 206e 6577 696e  )..        newin
-0002b9b0: 7465 7270 6f6c 6174 696f 6e20 3d20 5b5d  terpolation = []
-0002b9c0: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
-0002b9d0: 6e20 7261 6e67 6528 6c65 6e28 696e 7465  n range(len(inte
-0002b9e0: 7270 6f6c 6174 696f 6e29 293a 0a20 2020  rpolation)):.   
-0002b9f0: 2020 2020 2020 2020 2023 2069 6620 2748           # if 'H
-0002ba00: 2720 6e6f 7420 696e 206d 6f64 656c 5b69  ' not in model[i
-0002ba10: 5d2e 6174 6f6d 5f6e 616d 653a 0a20 2020  ].atom_name:.   
-0002ba20: 2020 2020 2020 2020 2069 6620 2748 2720           if 'H' 
-0002ba30: 6e6f 7420 696e 206d 6f64 656c 5b69 5d2e  not in model[i].
-0002ba40: 6675 6c6c 6e61 6d65 3a0a 2020 2020 2020  fullname:.      
-0002ba50: 2020 2020 2020 2020 2020 6e65 7769 6e74            newint
-0002ba60: 6572 706f 6c61 7469 6f6e 2e61 7070 656e  erpolation.appen
-0002ba70: 6428 696e 7465 7270 6f6c 6174 696f 6e5b  d(interpolation[
-0002ba80: 695d 290a 0a20 2020 2020 2020 2023 2057  i])..        # W
-0002ba90: 686f 6c65 206d 6f64 656c 2061 7665 7261  hole model avera
-0002baa0: 6765 2061 746f 6d20 696e 6c63 7573 696f  ge atom inlcusio
-0002bab0: 6e0a 2020 2020 2020 2020 656e 7469 7265  n.        entire
-0002bac0: 5f61 7665 7261 6765 203d 2073 756d 286e  _average = sum(n
-0002bad0: 702e 6173 6172 7261 7928 6e65 7769 6e74  p.asarray(newint
-0002bae0: 6572 706f 6c61 7469 6f6e 2920 3e20 7365  erpolation) > se
-0002baf0: 6c66 2e63 6c29 202f 2066 6c6f 6174 286c  lf.cl) / float(l
-0002bb00: 656e 286e 6577 696e 7465 7270 6f6c 6174  en(newinterpolat
-0002bb10: 696f 6e29 290a 0a20 2020 2020 2020 2023  ion))..        #
-0002bb20: 2046 756c 6c20 6174 6f6d 2069 6e63 6c75   Full atom inclu
-0002bb30: 7369 6f6e 0a20 2020 2020 2020 2061 203d  sion.        a =
-0002bb40: 205b 5d0a 2020 2020 2020 2020 7465 6d70   [].        temp
-0002bb50: 6c69 7374 203d 206e 702e 6173 6172 7261  list = np.asarra
+00027ed0: 2061 746f 6d69 6e74 6572 6269 6e20 3d20   atominterbin = 
+00027ee0: 3120 6966 2063 7572 696e 7465 7270 6f6c  1 if curinterpol
+00027ef0: 6174 696f 6e20 3e20 636f 6e74 6f75 7220  ation > contour 
+00027f00: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
+00027f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f20: 2020 2072 6573 6174 6f6d 696e 7465 7262     resatominterb
+00027f30: 696e 202b 3d20 6174 6f6d 696e 7465 7262  in += atominterb
+00027f40: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
+00027f50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00027f60: 6620 2748 2720 6e6f 7420 696e 2061 746f  f 'H' not in ato
+00027f70: 6d2e 6e61 6d65 3a0a 2020 2020 2020 2020  m.name:.        
+00027f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f90: 2020 2020 2020 2020 6368 6169 6e61 746f          chainato
+00027fa0: 6d69 6e74 6572 6269 6e20 2b3d 2061 746f  minterbin += ato
+00027fb0: 6d69 6e74 6572 6269 6e0a 2020 2020 2020  minterbin.      
+00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fd0: 2020 2020 2020 2020 2020 6368 6169 6e5f            chain_
+00027fe0: 6174 6f6d 5f63 6f75 6e74 202b 3d20 310a  atom_count += 1.
+00027ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028000: 2020 2020 2020 2020 2020 2020 7375 6d61              suma
+00028010: 746f 6d69 6e74 6572 6269 6e20 2b3d 2061  tominterbin += a
+00028020: 746f 6d69 6e74 6572 6269 6e0a 2020 2020  tominterbin.    
+00028030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028040: 2020 2020 6966 2072 6573 6964 7565 5f61      if residue_a
+00028050: 746f 6d5f 636f 756e 7420 3d3d 2030 3a0a  tom_count == 0:.
+00028060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028070: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00028080: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00028090: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+000280a0: 6573 6964 7565 2069 6e63 6c75 7369 6f6e  esidue inclusion
+000280b0: 2073 6563 7469 6f6e 0a20 2020 2020 2020   section.       
+000280c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000280d0: 206b 6579 7374 7220 3d20 6368 6169 6e5f   keystr = chain_
+000280e0: 6e61 6d65 202b 2027 3a27 202b 2073 7472  name + ':' + str
+000280f0: 2872 6573 6964 7565 5f6e 6f29 202b 2072  (residue_no) + r
+00028100: 6573 6964 7565 5f6e 616d 650a 2020 2020  esidue_name.    
+00028110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028120: 2020 2020 616c 6c6b 6579 732e 6170 7065      allkeys.appe
+00028130: 6e64 286b 6579 7374 7229 0a20 2020 2020  nd(keystr).     
+00028140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028150: 2020 2076 616c 7565 203d 2066 6c6f 6174     value = float
+00028160: 2827 252e 3466 2720 2520 726f 756e 6428  ('%.4f' % round(
+00028170: 2866 6c6f 6174 2872 6573 6174 6f6d 696e  (float(resatomin
+00028180: 7465 7262 696e 2920 2f20 7265 7369 6475  terbin) / residu
+00028190: 655f 6174 6f6d 5f63 6f75 6e74 292c 2034  e_atom_count), 4
+000281a0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+000281b0: 2020 2020 2020 2020 2020 2061 6c6c 7661             allva
+000281c0: 6c75 6573 2e61 7070 656e 6428 7661 6c75  lues.append(valu
+000281d0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+000281e0: 2020 2020 2020 2020 2320 6368 6169 6e20          # chain 
+000281f0: 696e 636c 7573 696f 6e20 7365 6374 696f  inclusion sectio
+00028200: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00028210: 2020 2020 2020 6966 2063 6861 696e 5f6e        if chain_n
+00028220: 616d 6520 696e 2063 6861 696e 6169 5f61  ame in chainai_a
+00028230: 746f 6d73 6e6f 2e6b 6579 7328 293a 0a20  tomsno.keys():. 
+00028240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028250: 2020 2020 2020 2063 6861 696e 6174 6f6d         chainatom
+00028260: 696e 7465 7262 696e 202b 3d20 6368 6169  interbin += chai
+00028270: 6e61 695f 6174 6f6d 736e 6f5b 6368 6169  nai_atomsno[chai
+00028280: 6e5f 6e61 6d65 5d5b 2776 616c 7565 275d  n_name]['value']
+00028290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000282a0: 2020 2020 2020 2020 2063 6861 696e 5f61           chain_a
+000282b0: 746f 6d5f 636f 756e 7420 2b3d 2063 6861  tom_count += cha
+000282c0: 696e 6169 5f61 746f 6d73 6e6f 5b63 6861  inai_atomsno[cha
+000282d0: 696e 5f6e 616d 655d 5b27 6174 6f6d 7369  in_name]['atomsi
+000282e0: 6e63 6861 696e 275d 0a20 2020 2020 2020  nchain'].       
+000282f0: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+00028300: 6f72 2063 6173 6573 2077 6865 7265 206f  or cases where o
+00028310: 6e65 2077 6174 6572 206d 6f6c 6563 756c  ne water molecul
+00028320: 6520 6861 7320 6120 7369 676c 6520 6275  e has a sigle bu
+00028330: 7420 6469 6666 6572 656e 7420 6368 6169  t different chai
+00028340: 6e20 6964 0a20 2020 2020 2020 2020 2020  n id.           
+00028350: 2020 2020 2020 2020 2069 6620 6368 6169           if chai
+00028360: 6e5f 6174 6f6d 5f63 6f75 6e74 203d 3d20  n_atom_count == 
+00028370: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00028380: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00028390: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+000283a0: 2020 2020 2020 2020 6368 6169 6e61 695f          chainai_
+000283b0: 6174 6f6d 736e 6f5b 6368 6169 6e5f 6e61  atomsno[chain_na
+000283c0: 6d65 5d20 3d20 7b27 7661 6c75 6527 3a20  me] = {'value': 
+000283d0: 6368 6169 6e61 746f 6d69 6e74 6572 6269  chainatominterbi
+000283e0: 6e2c 2027 6174 6f6d 7369 6e63 6861 696e  n, 'atomsinchain
+000283f0: 273a 2063 6861 696e 5f61 746f 6d5f 636f  ': chain_atom_co
+00028400: 756e 747d 0a0a 2020 2020 2020 2020 2020  unt}..          
+00028410: 2020 2020 2020 666f 7220 6368 6169 6e6e        for chainn
+00028420: 616d 652c 2063 6861 696e 5f73 636f 7265  ame, chain_score
+00028430: 7320 696e 2063 6861 696e 6169 5f61 746f  s in chainai_ato
+00028440: 6d73 6e6f 2e69 7465 6d73 2829 3a0a 2020  msno.items():.  
+00028450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028460: 2020 6368 6169 6e5f 6169 203d 2066 6c6f    chain_ai = flo
+00028470: 6174 2827 252e 3366 2720 2520 726f 756e  at('%.3f' % roun
+00028480: 6428 2866 6c6f 6174 2863 6861 696e 5f73  d((float(chain_s
+00028490: 636f 7265 735b 2776 616c 7565 275d 2920  cores['value']) 
+000284a0: 2f20 6368 6169 6e5f 7363 6f72 6573 5b27  / chain_scores['
+000284b0: 6174 6f6d 7369 6e63 6861 696e 275d 292c  atomsinchain']),
+000284c0: 2034 2929 0a20 2020 2020 2020 2020 2020   4)).           
+000284d0: 2020 2020 2020 2020 2061 6963 6f6c 6f72           aicolor
+000284e0: 203d 2073 656c 662e 5f5f 666c 6f61 746f   = self.__floato
+000284f0: 6865 7828 5b63 6861 696e 5f61 695d 295b  hex([chain_ai])[
+00028500: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00028510: 2020 2020 2020 2063 6861 696e 6169 7363         chainaisc
+00028520: 6f72 655b 6368 6169 6e6e 616d 655d 203d  ore[chainname] =
+00028530: 207b 2776 616c 7565 273a 2063 6861 696e   {'value': chain
+00028540: 5f61 692c 2027 636f 6c6f 7227 3a20 6169  _ai, 'color': ai
+00028550: 636f 6c6f 722c 2027 6e75 6d62 6572 4f66  color, 'numberOf
+00028560: 4174 6f6d 7327 3a20 6368 6169 6e5f 7363  Atoms': chain_sc
+00028570: 6f72 6573 5b27 6174 6f6d 7369 6e63 6861  ores['atomsincha
+00028580: 696e 275d 7d0a 2020 2020 2020 2020 2020  in']}.          
+00028590: 2020 2020 2020 616c 6c63 6f6e 746f 7572        allcontour
+000285a0: 7364 6963 745b 7374 7228 636f 6e74 6f75  sdict[str(contou
+000285b0: 7229 5d20 3d20 2861 6c6c 6b65 7973 2c20  r)] = (allkeys, 
+000285c0: 616c 6c76 616c 7565 7329 0a20 2020 2020  allvalues).     
+000285d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000285e0: 2827 4d6f 6465 6c3a 2025 7320 6174 2063  ('Model: %s at c
+000285f0: 6f6e 746f 7572 206c 6576 656c 2025 7320  ontour level %s 
+00028600: 6861 7320 2573 2061 746f 6d73 2073 7469  has %s atoms sti
+00028610: 636b 206f 7574 206f 6620 7468 6520 6465  ck out of the de
+00028620: 6e73 6974 792e 2720 2520 286d 6f64 656c  nsity.' % (model
+00028630: 6e61 6d65 2c20 636f 6e74 6f75 722c 0a20  name, contour,. 
+00028640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028690: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000286a0: 746f 6d6f 7574 7369 6465 6e75 6d29 290a  tomoutsidenum)).
+000286b0: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+000286c0: 6573 756c 745b 6d6f 6465 6c6e 616d 655d  esult[modelname]
+000286d0: 203d 2028 696e 7465 7270 6f6c 6174 696f   = (interpolatio
+000286e0: 6e73 2c20 616c 6c6b 6579 732c 2061 6c6c  ns, allkeys, all
+000286f0: 7661 6c75 6573 290a 2020 2020 2020 2020  values).        
+00028700: 2020 2020 2320 7265 7375 6c74 3a20 7b6d      # result: {m
+00028710: 6f64 656c 6e61 6d65 2023 313a 2028 696e  odelname #1: (in
+00028720: 7465 7270 6f6c 6174 696f 6e73 2023 312c  terpolations #1,
+00028730: 207b 636f 6e74 6f75 7231 3a20 2861 6c6c   {contour1: (all
+00028740: 6b65 7973 2c20 616c 6c76 616c 7565 7329  keys, allvalues)
+00028750: 2c20 636f 6e74 6f75 7232 3a20 2861 6c6c  , contour2: (all
+00028760: 6b65 7973 2c20 616c 6c76 616c 7565 7329  keys, allvalues)
+00028770: 0a20 2020 2020 2020 2020 2020 2023 202e  .            # .
+00028780: 2e2e 7d29 2c20 6d6f 6465 6c6e 616d 6520  ..}), modelname 
+00028790: 2332 3a20 2869 6e74 6572 706f 6c61 7469  #2: (interpolati
+000287a0: 6f6e 7320 2332 2c20 7b63 6f6e 746f 7572  ons #2, {contour
+000287b0: 313a 2028 616c 6c6b 6579 732c 2061 6c6c  1: (allkeys, all
+000287c0: 7661 6c75 6573 292c 2e2e 2e7d 292c 2e2e  values),...}),..
+000287d0: 2e7d 0a20 2020 2020 2020 2020 2020 2072  .}.            r
+000287e0: 6573 756c 745b 6d6f 6465 6c6e 616d 655d  esult[modelname]
+000287f0: 203d 2028 696e 7465 7270 6f6c 6174 696f   = (interpolatio
+00028800: 6e73 2c20 616c 6c63 6f6e 746f 7572 7364  ns, allcontoursd
+00028810: 6963 742c 2063 6861 696e 6169 7363 6f72  ict, chainaiscor
+00028820: 652c 2061 746f 6d6f 7574 7369 6465 6e75  e, atomoutsidenu
+00028830: 6d29 0a0a 2020 2020 2020 2020 7265 7475  m)..        retu
+00028840: 726e 2072 6573 756c 740a 0a0a 2020 2020  rn result...    
+00028850: 6465 6620 6d61 705f 6d61 7472 6978 2873  def map_matrix(s
+00028860: 656c 662c 2061 7069 7873 2c20 616e 6773  elf, apixs, angs
+00028870: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
+00028880: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
+00028890: 756c 6174 6520 7468 6520 6d61 7472 6978  ulate the matrix
+000288a0: 2074 6f20 7472 616e 7366 6f72 6d20 4361   to transform Ca
+000288b0: 7274 6573 6961 6e20 636f 6f72 6469 6e61  rtesian coordina
+000288c0: 7465 7320 746f 2066 7261 6374 696f 6e61  tes to fractiona
+000288d0: 6c20 636f 6f72 6469 6e61 7465 730a 2020  l coordinates.  
+000288e0: 2020 2020 2020 2020 2020 2863 6865 636b            (check
+000288f0: 2074 6865 2064 6566 696e 696e 6174 696f   the defininatio
+00028900: 6e20 746f 2073 6565 2074 6865 206d 6174  n to see the mat
+00028910: 7269 7820 666f 726d 756c 6172 290a 0a20  rix formular).. 
+00028920: 2020 2020 2020 203a 7061 7261 6d20 6170         :param ap
+00028930: 6978 733a 2061 7272 6179 206f 6620 6170  ixs: array of ap
+00028940: 6978 206c 656e 6768 740a 2020 2020 2020  ix lenght.      
+00028950: 2020 3a70 6172 616d 2061 6e67 733a 2061    :param angs: a
+00028960: 7272 6179 206f 6620 616e 676c 6578 2069  rray of anglex i
+00028970: 6e20 616c 7068 612c 2062 6574 612c 2067  n alpha, beta, g
+00028980: 616d 6d61 206f 7264 6572 0a20 2020 2020  amma order.     
+00028990: 2020 203a 7265 7475 726e 3a0a 2020 2020     :return:.    
+000289a0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+000289b0: 2061 6e67 203d 2028 616e 6773 5b30 5d2a   ang = (angs[0]*
+000289c0: 6d61 7468 2e70 692f 3138 302c 2061 6e67  math.pi/180, ang
+000289d0: 735b 315d 2a6d 6174 682e 7069 2f31 3830  s[1]*math.pi/180
+000289e0: 2c20 616e 6773 5b32 5d2a 6d61 7468 2e70  , angs[2]*math.p
+000289f0: 692f 3138 3029 0a20 2020 2020 2020 2069  i/180).        i
+00028a00: 6e73 6964 6573 7172 7420 3d20 3120 2b20  nsidesqrt = 1 + 
+00028a10: 3220 2a20 6d61 7468 2e63 6f73 2861 6e67  2 * math.cos(ang
+00028a20: 5b30 5d29 202a 206d 6174 682e 636f 7328  [0]) * math.cos(
+00028a30: 616e 675b 315d 2920 2a20 6d61 7468 2e63  ang[1]) * math.c
+00028a40: 6f73 2861 6e67 5b32 5d29 202d 205c 0a20  os(ang[2]) - \. 
+00028a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a60: 2020 2020 6d61 7468 2e63 6f73 2861 6e67      math.cos(ang
+00028a70: 5b30 5d29 2a2a 3220 2d20 5c0a 2020 2020  [0])**2 - \.    
+00028a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028a90: 206d 6174 682e 636f 7328 616e 675b 315d   math.cos(ang[1]
+00028aa0: 292a 2a32 202d 205c 0a20 2020 2020 2020  )**2 - \.       
+00028ab0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00028ac0: 7468 2e63 6f73 2861 6e67 5b32 5d29 2a2a  th.cos(ang[2])**
+00028ad0: 320a 0a20 2020 2020 2020 2063 656c 6c76  2..        cellv
+00028ae0: 6f6c 756d 6520 3d20 6170 6978 735b 305d  olume = apixs[0]
+00028af0: 2a61 7069 7873 5b31 5d2a 6170 6978 735b  *apixs[1]*apixs[
+00028b00: 325d 2a6d 6174 682e 7371 7274 2869 6e73  2]*math.sqrt(ins
+00028b10: 6964 6573 7172 7429 0a0a 2020 2020 2020  idesqrt)..      
+00028b20: 2020 6d31 3120 3d20 312f 6170 6978 735b    m11 = 1/apixs[
+00028b30: 305d 0a20 2020 2020 2020 206d 3132 203d  0].        m12 =
+00028b40: 202d 6d61 7468 2e63 6f73 2861 6e67 5b32   -math.cos(ang[2
+00028b50: 5d29 2f28 6170 6978 735b 305d 2a6d 6174  ])/(apixs[0]*mat
+00028b60: 682e 7369 6e28 616e 675b 325d 2929 0a0a  h.sin(ang[2]))..
+00028b70: 2020 2020 2020 2020 6d31 3320 3d20 6170          m13 = ap
+00028b80: 6978 735b 315d 202a 2061 7069 7873 5b32  ixs[1] * apixs[2
+00028b90: 5d20 2a20 286d 6174 682e 636f 7328 616e  ] * (math.cos(an
+00028ba0: 675b 305d 2920 2a20 6d61 7468 2e63 6f73  g[0]) * math.cos
+00028bb0: 2861 6e67 5b32 5d29 202d 206d 6174 682e  (ang[2]) - math.
+00028bc0: 636f 7328 616e 675b 315d 2929 202f 2028  cos(ang[1])) / (
+00028bd0: 6365 6c6c 766f 6c75 6d65 202a 206d 6174  cellvolume * mat
+00028be0: 682e 7369 6e28 616e 675b 325d 2929 0a20  h.sin(ang[2])). 
+00028bf0: 2020 2020 2020 206d 3231 203d 2030 0a20         m21 = 0. 
+00028c00: 2020 2020 2020 206d 3232 203d 2031 202f         m22 = 1 /
+00028c10: 2028 6170 6978 735b 315d 202a 206d 6174   (apixs[1] * mat
+00028c20: 682e 7369 6e28 616e 675b 325d 2929 0a20  h.sin(ang[2])). 
+00028c30: 2020 2020 2020 206d 3233 203d 2061 7069         m23 = api
+00028c40: 7873 5b30 5d20 2a20 6170 6978 735b 325d  xs[0] * apixs[2]
+00028c50: 202a 2028 6d61 7468 2e63 6f73 2861 6e67   * (math.cos(ang
+00028c60: 5b31 5d29 202a 206d 6174 682e 636f 7328  [1]) * math.cos(
+00028c70: 616e 675b 325d 2920 2d20 6d61 7468 2e63  ang[2]) - math.c
+00028c80: 6f73 2861 6e67 5b30 5d29 2920 2f20 2863  os(ang[0])) / (c
+00028c90: 656c 6c76 6f6c 756d 6520 2a20 6d61 7468  ellvolume * math
+00028ca0: 2e73 696e 2861 6e67 5b32 5d29 290a 2020  .sin(ang[2])).  
+00028cb0: 2020 2020 2020 6d33 3120 3d20 300a 2020        m31 = 0.  
+00028cc0: 2020 2020 2020 6d33 3220 3d20 300a 2020        m32 = 0.  
+00028cd0: 2020 2020 2020 6d33 3320 3d20 6170 6978        m33 = apix
+00028ce0: 735b 305d 202a 2061 7069 7873 5b31 5d20  s[0] * apixs[1] 
+00028cf0: 2a20 6d61 7468 2e73 696e 2861 6e67 5b32  * math.sin(ang[2
+00028d00: 5d29 202f 2063 656c 6c76 6f6c 756d 650a  ]) / cellvolume.
+00028d10: 2020 2020 2020 2020 7072 656d 6174 7269          prematri
+00028d20: 7820 3d20 5b5b 6d31 312c 206d 3132 2c20  x = [[m11, m12, 
+00028d30: 6d31 335d 2c20 5b6d 3231 2c20 6d32 322c  m13], [m21, m22,
+00028d40: 206d 3233 5d2c 205b 6d33 312c 206d 3332   m23], [m31, m32
+00028d50: 2c20 6d33 335d 5d0a 2020 2020 2020 2020  , m33]].        
+00028d60: 6d61 7472 6978 203d 206e 702e 6173 6172  matrix = np.asar
+00028d70: 7261 7928 7072 656d 6174 7269 7829 0a0a  ray(prematrix)..
+00028d80: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00028d90: 6174 7269 780a 0a0a 2020 2020 6465 6620  atrix...    def 
+00028da0: 6d61 7472 6978 5f69 6e64 6963 6573 2873  matrix_indices(s
+00028db0: 656c 662c 2061 7069 7873 2c20 6f6e 6563  elf, apixs, onec
+00028dc0: 6f6f 7229 3a0a 2020 2020 2020 2020 2222  oor):.        ""
+00028dd0: 220a 0a20 2020 2020 2020 2020 2020 204d  "..            M
+00028de0: 6574 686f 6420 323a 2075 7369 6e67 2074  ethod 2: using t
+00028df0: 6865 2066 7261 6374 696f 6e61 6c20 636f  he fractional co
+00028e00: 6f72 6469 6e61 7465 206d 6174 7269 7820  ordinate matrix 
+00028e10: 746f 2063 616c 6375 6c61 7465 2074 6865  to calculate the
+00028e20: 2069 6e64 6963 6573 2077 6865 6e20 7468   indices when th
+00028e30: 6520 6d61 7073 2061 7265 206e 6f6e 2d6f  e maps are non-o
+00028e40: 7274 686f 676f 6e61 6c0a 0a20 2020 2020  rthogonal..     
+00028e50: 2020 203a 7265 7475 726e 3a0a 2020 2020     :return:.    
+00028e60: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00028e70: 2023 204d 6574 686f 6420 323a 2062 7920   # Method 2: by 
+00028e80: 7573 696e 6720 7468 6520 6672 6163 7469  using the fracti
+00028e90: 6f6e 616c 2063 6f6f 7264 696e 6174 6520  onal coordinate 
+00028ea0: 6d61 7472 6978 0a20 2020 2020 2020 2023  matrix.        #
+00028eb0: 2043 686f 7365 6e20 6173 2074 6865 206d   Chosen as the m
+00028ec0: 6169 6e20 6675 6e63 7469 6f6e 2066 6f72  ain function for
+00028ed0: 2074 6865 2063 7572 7265 6e74 2069 6d70   the current imp
+00028ee0: 6c65 6d65 6e74 6174 696f 6e0a 0a20 2020  lementation..   
+00028ef0: 2020 2020 2023 2046 6967 7572 6520 6f75       # Figure ou
+00028f00: 7420 7468 6520 6f72 6465 7220 6f66 2074  t the order of t
+00028f10: 6865 2078 2c20 792c 207a 2062 6173 6564  he x, y, z based
+00028f20: 206f 6e20 6372 7320 696e 666f 2069 6e20   on crs info in 
+00028f30: 7468 6520 6865 6164 6572 0a20 2020 2020  the header.     
+00028f40: 2020 2023 2063 7273 203d 206c 6973 7428     # crs = list(
+00028f50: 7365 6c66 2e6d 6170 2e68 6561 6465 725b  self.map.header[
+00028f60: 3136 3a31 395d 290a 2020 2020 2020 2020  16:19]).        
+00028f70: 6372 7320 3d20 5b73 656c 662e 6d61 702e  crs = [self.map.
+00028f80: 6865 6164 6572 2e6d 6170 632c 2073 656c  header.mapc, sel
+00028f90: 662e 6d61 702e 6865 6164 6572 2e6d 6170  f.map.header.map
+00028fa0: 722c 2073 656c 662e 6d61 702e 6865 6164  r, self.map.head
+00028fb0: 6572 2e6d 6170 735d 0a20 2020 2020 2020  er.maps].       
+00028fc0: 2023 206f 7264 696e 6473 2073 6176 6520   # ordinds save 
+00028fd0: 7468 6520 696e 6469 6365 7320 636f 7272  the indices corr
+00028fe0: 6573 706f 6469 6e67 2074 6f20 782c 2079  espoding to x, y
+00028ff0: 202c 7a0a 2020 2020 2020 2020 6f72 6469   ,z.        ordi
+00029000: 6e64 7320 3d20 5b63 7273 2e69 6e64 6578  nds = [crs.index
+00029010: 2831 292c 2063 7273 2e69 6e64 6578 2832  (1), crs.index(2
+00029020: 292c 2063 7273 2e69 6e64 6578 2833 295d  ), crs.index(3)]
+00029030: 0a20 2020 2020 2020 2023 2061 6e67 7320  .        # angs 
+00029040: 3d20 7365 6c66 2e6d 6170 2e68 6561 6465  = self.map.heade
+00029050: 725b 3133 3a31 365d 0a20 2020 2020 2020  r[13:16].       
+00029060: 2061 6e67 7320 3d20 5b73 656c 662e 6d61   angs = [self.ma
+00029070: 702e 6865 6164 6572 2e63 656c 6c62 2e61  p.header.cellb.a
+00029080: 6c70 6861 2c20 7365 6c66 2e6d 6170 2e68  lpha, self.map.h
+00029090: 6561 6465 722e 6365 6c6c 622e 6265 7461  eader.cellb.beta
+000290a0: 2c20 7365 6c66 2e6d 6170 2e68 6561 6465  , self.map.heade
+000290b0: 722e 6365 6c6c 622e 6761 6d6d 615d 0a20  r.cellb.gamma]. 
+000290c0: 2020 2020 2020 206d 6174 7269 7820 3d20         matrix = 
+000290d0: 7365 6c66 2e6d 6170 5f6d 6174 7269 7828  self.map_matrix(
+000290e0: 6170 6978 732c 2061 6e67 7329 0a20 2020  apixs, angs).   
+000290f0: 2020 2020 2072 6573 756c 7420 3d20 6d61       result = ma
+00029100: 7472 6978 2e64 6f74 286e 702e 6173 6172  trix.dot(np.asar
+00029110: 7261 7928 6f6e 6563 6f6f 7229 290a 2020  ray(onecoor)).  
+00029120: 2020 2020 2020 2320 7869 6e64 6578 203d        # xindex =
+00029130: 2072 6573 756c 745b 305d 202d 2073 656c   result[0] - sel
+00029140: 662e 6d61 702e 6865 6164 6572 5b34 202b  f.map.header[4 +
+00029150: 206f 7264 696e 6473 5b30 5d5d 0a20 2020   ordinds[0]].   
+00029160: 2020 2020 2023 2079 696e 6465 7820 3d20       # yindex = 
+00029170: 7265 7375 6c74 5b31 5d20 2d20 7365 6c66  result[1] - self
+00029180: 2e6d 6170 2e68 6561 6465 725b 3420 2b20  .map.header[4 + 
+00029190: 6f72 6469 6e64 735b 315d 5d0a 2020 2020  ordinds[1]].    
+000291a0: 2020 2020 2320 7a69 6e64 6578 203d 2072      # zindex = r
+000291b0: 6573 756c 745b 325d 202d 2073 656c 662e  esult[2] - self.
+000291c0: 6d61 702e 6865 6164 6572 5b34 202b 206f  map.header[4 + o
+000291d0: 7264 696e 6473 5b32 5d5d 0a20 2020 2020  rdinds[2]].     
+000291e0: 2020 2078 696e 6465 7820 3d20 7265 7375     xindex = resu
+000291f0: 6c74 5b30 5d20 2d20 7365 6c66 2e6d 6170  lt[0] - self.map
+00029200: 2e68 6561 6465 722e 6e78 7374 6172 740a  .header.nxstart.
+00029210: 2020 2020 2020 2020 7969 6e64 6578 203d          yindex =
+00029220: 2072 6573 756c 745b 315d 202d 2073 656c   result[1] - sel
+00029230: 662e 6d61 702e 6865 6164 6572 2e6e 7973  f.map.header.nys
+00029240: 7461 7274 0a20 2020 2020 2020 207a 696e  tart.        zin
+00029250: 6465 7820 3d20 7265 7375 6c74 5b32 5d20  dex = result[2] 
+00029260: 2d20 7365 6c66 2e6d 6170 2e68 6561 6465  - self.map.heade
+00029270: 722e 6e7a 7374 6172 740a 0a20 2020 2020  r.nzstart..     
+00029280: 2020 2072 6574 7572 6e20 2878 696e 6465     return (xinde
+00029290: 782c 2079 696e 6465 782c 207a 696e 6465  x, yindex, zinde
+000292a0: 7829 0a0a 0a20 2020 2064 6566 2070 726f  x)...    def pro
+000292b0: 6a65 6374 696f 6e5f 696e 6469 6365 7328  jection_indices(
+000292c0: 7365 6c66 2c20 6f6e 6563 6f6f 7229 3a0a  self, onecoor):.
+000292d0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000292e0: 2020 2020 2020 2020 204d 6574 686f 6420           Method 
+000292f0: 313a 2075 7369 6e67 2074 6865 2070 726f  1: using the pro
+00029300: 6a65 6374 696f 6e20 7761 7920 746f 2063  jection way to c
+00029310: 616c 6375 6c61 7465 2074 6865 2069 6e64  alculate the ind
+00029320: 6963 6573 2077 6865 6e20 7468 6520 6d61  ices when the ma
+00029330: 7073 2061 7265 206e 6f6e 2d6f 7274 686f  ps are non-ortho
+00029340: 676f 6e61 6c0a 0a20 2020 2020 2020 203a  gonal..        :
+00029350: 7265 7475 726e 3a20 7475 6d70 6c65 2077  return: tumple w
+00029360: 6869 6368 2063 6f6e 7461 696e 7320 616c  hich contains al
+00029370: 6c20 7468 7265 6520 666c 6f61 7420 6e65  l three float ne
+00029380: 7720 696e 6469 6365 7320 696e 2028 782c  w indices in (x,
+00029390: 2079 2c20 7a29 206f 7264 6572 0a20 2020   y, z) order.   
+000293a0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+000293b0: 2020 6d61 7020 3d20 7365 6c66 2e6d 6170    map = self.map
+000293c0: 0a20 2020 2020 2020 207a 6469 6d20 3d20  .        zdim = 
+000293d0: 6d61 702e 6865 6164 6572 5b31 325d 0a20  map.header[12]. 
+000293e0: 2020 2020 2020 207a 6e69 6e74 6572 7661         zninterva
+000293f0: 6c73 203d 206d 6170 2e68 6561 6465 725b  ls = map.header[
+00029400: 395d 0a20 2020 2020 2020 207a 5f61 7069  9].        z_api
+00029410: 7820 3d20 7a64 696d 202f 207a 6e69 6e74  x = zdim / znint
+00029420: 6572 7661 6c73 0a0a 2020 2020 2020 2020  ervals..        
+00029430: 7964 696d 203d 206d 6170 2e68 6561 6465  ydim = map.heade
+00029440: 725b 3131 5d0a 2020 2020 2020 2020 796e  r[11].        yn
+00029450: 696e 7465 7276 616c 7320 3d20 6d61 702e  intervals = map.
+00029460: 6865 6164 6572 5b38 5d0a 2020 2020 2020  header[8].      
+00029470: 2020 795f 6170 6978 203d 2079 6469 6d20    y_apix = ydim 
+00029480: 2f20 796e 696e 7465 7276 616c 730a 0a20  / ynintervals.. 
+00029490: 2020 2020 2020 2078 6469 6d20 3d20 6d61         xdim = ma
+000294a0: 702e 6865 6164 6572 5b31 305d 0a20 2020  p.header[10].   
+000294b0: 2020 2020 2078 6e69 6e74 6572 7661 6c73       xnintervals
+000294c0: 203d 206d 6170 2e68 6561 6465 725b 375d   = map.header[7]
+000294d0: 0a20 2020 2020 2020 2078 5f61 7069 7820  .        x_apix 
+000294e0: 3d20 7864 696d 202f 2078 6e69 6e74 6572  = xdim / xninter
+000294f0: 7661 6c73 0a0a 2020 2020 2020 2020 7468  vals..        th
+00029500: 6574 6120 3d20 286d 6170 2e68 6561 6465  eta = (map.heade
+00029510: 725b 3133 5d20 2f20 3930 2920 2a20 286d  r[13] / 90) * (m
+00029520: 6174 682e 7069 202f 2032 290a 2020 2020  ath.pi / 2).    
+00029530: 2020 2020 6265 7461 203d 2028 6d61 702e      beta = (map.
+00029540: 6865 6164 6572 5b31 345d 202f 2039 3029  header[14] / 90)
+00029550: 202a 2028 6d61 7468 2e70 6920 2f20 3229   * (math.pi / 2)
+00029560: 0a20 2020 2020 2020 2067 616d 6d61 203d  .        gamma =
+00029570: 2028 6d61 702e 6865 6164 6572 5b31 355d   (map.header[15]
+00029580: 202f 2039 3029 202a 2028 6d61 7468 2e70   / 90) * (math.p
+00029590: 6920 2f20 3229 0a0a 2020 2020 2020 2020  i / 2)..        
+000295a0: 696e 7369 6465 7371 7274 203d 2031 202b  insidesqrt = 1 +
+000295b0: 2032 202a 206d 6174 682e 636f 7328 7468   2 * math.cos(th
+000295c0: 6574 6129 202a 206d 6174 682e 636f 7328  eta) * math.cos(
+000295d0: 6265 7461 2920 2a20 6d61 7468 2e63 6f73  beta) * math.cos
+000295e0: 2867 616d 6d61 2920 2d20 5c0a 2020 2020  (gamma) - \.    
+000295f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029600: 206d 6174 682e 636f 7328 7468 6574 6129   math.cos(theta)
+00029610: 202a 206d 6174 682e 636f 7328 7468 6574   * math.cos(thet
+00029620: 6129 202d 205c 0a20 2020 2020 2020 2020  a) - \.         
+00029630: 2020 2020 2020 2020 2020 2020 6d61 7468              math
+00029640: 2e63 6f73 2862 6574 6129 202a 206d 6174  .cos(beta) * mat
+00029650: 682e 636f 7328 6265 7461 2920 2d20 5c0a  h.cos(beta) - \.
+00029660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029670: 2020 2020 206d 6174 682e 636f 7328 6761       math.cos(ga
+00029680: 6d6d 6129 202a 206d 6174 682e 636f 7328  mma) * math.cos(
+00029690: 6761 6d6d 6129 0a0a 2020 2020 2020 2020  gamma)..        
+000296a0: 6365 6c6c 766f 6c75 6d65 203d 2078 5f61  cellvolume = x_a
+000296b0: 7069 7820 2a20 795f 6170 6978 202a 207a  pix * y_apix * z
+000296c0: 5f61 7069 7820 2a20 6d61 7468 2e73 7172  _apix * math.sqr
+000296d0: 7428 696e 7369 6465 7371 7274 290a 0a20  t(insidesqrt).. 
+000296e0: 2020 2020 2020 2063 656c 6c68 6569 6768         cellheigh
+000296f0: 747a 203d 2063 656c 6c76 6f6c 756d 6520  tz = cellvolume 
+00029700: 2f20 2878 5f61 7069 7820 2a20 795f 6170  / (x_apix * y_ap
+00029710: 6978 202a 206d 6174 682e 7369 6e28 6761  ix * math.sin(ga
+00029720: 6d6d 6129 290a 2020 2020 2020 2020 6365  mma)).        ce
+00029730: 6c6c 6865 6967 6874 7920 3d20 6365 6c6c  llheighty = cell
+00029740: 766f 6c75 6d65 202f 2028 785f 6170 6978  volume / (x_apix
+00029750: 202a 207a 5f61 7069 7820 2a20 6d61 7468   * z_apix * math
+00029760: 2e73 696e 2862 6574 6129 290a 2020 2020  .sin(beta)).    
+00029770: 2020 2020 6365 6c6c 6865 6967 6874 7820      cellheightx 
+00029780: 3d20 6365 6c6c 766f 6c75 6d65 202f 2028  = cellvolume / (
+00029790: 7a5f 6170 6978 202a 2079 5f61 7069 7820  z_apix * y_apix 
+000297a0: 2a20 6d61 7468 2e73 696e 2874 6865 7461  * math.sin(theta
+000297b0: 2929 0a0a 2020 2020 2020 2020 2320 4669  ))..        # Fi
+000297c0: 6775 7265 206f 7574 2074 6865 206f 7264  gure out the ord
+000297d0: 6572 206f 6620 7468 6520 782c 2079 2c20  er of the x, y, 
+000297e0: 7a20 6261 7365 6420 6f6e 2063 7273 2069  z based on crs i
+000297f0: 6e66 6f20 696e 2074 6865 2068 6561 6465  nfo in the heade
+00029800: 720a 2020 2020 2020 2020 6372 7320 3d20  r.        crs = 
+00029810: 6c69 7374 286d 6170 2e68 6561 6465 725b  list(map.header[
+00029820: 3136 3a31 395d 290a 2020 2020 2020 2020  16:19]).        
+00029830: 2320 6f72 6469 6e64 7320 7361 7665 2074  # ordinds save t
+00029840: 6865 2069 6e64 6963 6573 2063 6f72 7265  he indices corre
+00029850: 7370 6f64 696e 6720 746f 2078 2c20 7920  spoding to x, y 
+00029860: 2c7a 0a20 2020 2020 2020 206f 7264 696e  ,z.        ordin
+00029870: 6473 203d 205b 6372 732e 696e 6465 7828  ds = [crs.index(
+00029880: 3129 2c20 6372 732e 696e 6465 7828 3229  1), crs.index(2)
+00029890: 2c20 6372 732e 696e 6465 7828 3329 5d0a  , crs.index(3)].
+000298a0: 0a20 2020 2020 2020 2023 204d 6568 746f  .        # Mehto
+000298b0: 6420 313a 2043 616c 6375 6c61 7465 696e  d 1: Calculatein
+000298c0: 6720 7468 6520 6469 7374 616e 6365 7320  g the distances 
+000298d0: 6672 6f6d 2074 6865 2061 746f 6d20 746f  from the atom to
+000298e0: 2064 6966 6665 7265 6e74 2070 6c61 6e65   different plane
+000298f0: 7328 7827 7927 2c20 7827 7a27 2c20 7927  s(x'y', x'z', y'
+00029900: 7a27 2920 616e 6420 6469 7669 6465 6420  z') and divided 
+00029910: 6279 0a20 2020 2020 2020 2023 2054 6865  by.        # The
+00029920: 2075 6e69 7420 6365 6c6c 2068 6569 6768   unit cell heigh
+00029930: 7428 6361 6c63 756c 6174 6564 2062 7920  t(calculated by 
+00029940: 7573 696e 6720 756e 6974 2063 656c 6c20  using unit cell 
+00029950: 766f 6c75 6d65 2064 6976 6964 6564 2062  volume divided b
+00029960: 7920 7468 6520 706c 616e 6520 7375 7266  y the plane surf
+00029970: 6163 6520 6172 6561 2920 746f 2067 6574  ace area) to get
+00029980: 2074 6865 0a20 2020 2020 2020 2023 2069   the.        # i
+00029990: 6e64 6963 6573 2c20 7468 656e 2064 6564  ndices, then ded
+000299a0: 7563 7420 7468 6520 6f72 6967 696e 2069  uct the origin i
+000299b0: 6e64 6578 2077 6869 6368 2067 6976 6520  ndex which give 
+000299c0: 7468 6520 6669 6e61 6c20 7265 7375 6c74  the final result
+000299d0: 732e 2057 6865 6e20 6361 6c63 756c 6174  s. When calculat
+000299e0: 696e 6720 7468 6520 7369 676e 206f 6620  ing the sign of 
+000299f0: 7468 650a 2020 2020 2020 2020 2320 6469  the.        # di
+00029a00: 7374 616e 6365 2c20 6669 6e64 2061 2070  stance, find a p
+00029a10: 6c61 6e65 2070 6172 616c 6c65 6c20 746f  lane parallel to
+00029a20: 2074 6865 2070 726f 6a65 6374 696f 6e20   the projection 
+00029a30: 706c 616e 6520 616e 6420 6974 2070 6173  plane and it pas
+00029a40: 7320 7468 726f 7567 6820 7468 6520 6174  s through the at
+00029a50: 6f6d 2c20 7468 6520 6375 746f 6666 206f  om, the cutoff o
+00029a60: 6620 7468 6973 0a20 2020 2020 2020 2023  f this.        #
+00029a70: 2070 6c61 6e65 2061 6e64 2074 6865 2063   plane and the c
+00029a80: 6f72 7265 7370 6f64 696e 6720 6178 6973  orrespoding axis
+00029a90: 2067 6976 6520 7468 6520 6c6f 6361 7469   give the locati
+00029aa0: 6f6e 206f 6620 7468 6520 6174 6f6d 2070  on of the atom p
+00029ab0: 726f 6a65 6374 696f 6e20 6375 746f 6666  rojection cutoff
+00029ac0: 2061 7420 7468 6520 6178 6973 0a20 2020   at the axis.   
+00029ad0: 2020 2020 2023 2028 7468 6973 2073 686f       # (this sho
+00029ae0: 756c 6420 616c 736f 2062 6520 6162 6c65  uld also be able
+00029af0: 2074 6f20 7573 6564 2074 6f20 6361 6c63   to used to calc
+00029b00: 756c 6174 6520 7468 6520 6669 6e61 6c20  ulate the final 
+00029b10: 696e 6469 6365 7328 6e6f 7420 7472 6965  indices(not trie
+00029b20: 6429 292e 2049 6620 7468 6973 2070 6f69  d)). If this poi
+00029b30: 6e74 2069 7320 6f75 7473 6964 650a 2020  nt is outside.  
+00029b40: 2020 2020 2020 2320 7468 6520 6e6f 726d        # the norm
+00029b50: 616c 2063 656c 6c20 6469 6d65 6e73 696f  al cell dimensio
+00029b60: 6e20 7261 6e67 652c 2074 6865 6e20 7468  n range, then th
+00029b70: 6520 6469 7374 616e 6365 2073 686f 756c  e distance shoul
+00029b80: 6420 6265 206e 6567 6174 6976 6520 616e  d be negative an
+00029b90: 6420 7669 6365 2076 6572 7365 0a20 2020  d vice verse.   
+00029ba0: 2020 2020 2072 656c 6174 6976 6578 203d       relativex =
+00029bb0: 206f 6e65 636f 6f72 5b30 5d20 2d20 6d61   onecoor[0] - ma
+00029bc0: 702e 6865 6164 6572 5b34 395d 0a20 2020  p.header[49].   
+00029bd0: 2020 2020 2072 656c 6174 6976 6579 203d       relativey =
+00029be0: 206f 6e65 636f 6f72 5b31 5d20 2d20 6d61   onecoor[1] - ma
+00029bf0: 702e 6865 6164 6572 5b35 305d 0a20 2020  p.header[50].   
+00029c00: 2020 2020 2072 656c 6174 6976 657a 203d       relativez =
+00029c10: 206f 6e65 636f 6f72 5b32 5d20 2d20 6d61   onecoor[2] - ma
+00029c20: 702e 6865 6164 6572 5b35 315d 0a0a 2020  p.header[51]..  
+00029c30: 2020 2020 2020 2320 5a20 696e 6465 7820        # Z index 
+00029c40: 6279 2075 7369 6e67 2074 6865 2072 656c  by using the rel
+00029c50: 6174 6976 657a 202f 2063 656c 6c68 6569  ativez / cellhei
+00029c60: 6768 747a 0a20 2020 2020 2020 207a 696e  ghtz.        zin
+00029c70: 6420 3d20 7265 6c61 7469 7665 7a20 2f20  d = relativez / 
+00029c80: 6365 6c6c 6865 6967 6874 7a0a 2020 2020  cellheightz.    
+00029c90: 2020 2020 7a69 6e64 6578 203d 207a 696e      zindex = zin
+00029ca0: 6420 2d20 6d61 702e 6865 6164 6572 5b34  d - map.header[4
+00029cb0: 202b 206f 7264 696e 6473 5b32 5d5d 0a0a   + ordinds[2]]..
+00029cc0: 2020 2020 2020 2020 2320 5820 696e 6465          # X inde
+00029cd0: 7820 6279 2063 616c 6375 6c61 7469 6e67  x by calculating
+00029ce0: 2074 6865 2070 6c61 6e65 2066 6972 7374   the plane first
+00029cf0: 2061 6e64 2074 6865 6e20 6361 6c63 756c   and then calcul
+00029d00: 6174 6520 7468 6520 6469 7374 616e 6365  ate the distance
+00029d10: 2066 726f 6d20 6174 6f6d 2074 6f20 706c   from atom to pl
+00029d20: 616e 650a 2020 2020 2020 2020 2320 506c  ane.        # Pl
+00029d30: 616e 6520 7827 7a27 0a20 2020 2020 2020  ane x'z'.       
+00029d40: 2023 2041 7820 2b20 4279 202b 2043 7a20   # Ax + By + Cz 
+00029d50: 2b20 4420 3d20 3020 7769 7468 2074 6872  + D = 0 with thr
+00029d60: 6565 2064 6174 6120 706f 696e 7473 3a20  ee data points: 
+00029d70: 2830 2c20 302c 2030 292c 2028 622c 2030  (0, 0, 0), (b, 0
+00029d80: 2c20 3029 2c0a 2020 2020 2020 2020 2320  , 0),.        # 
+00029d90: 2861 2a63 6f73 2861 6c70 6861 292c 2073  (a*cos(alpha), s
+00029da0: 7172 7428 612a 2a32 202d 2028 6365 6c6c  qrt(a**2 - (cell
+00029db0: 6c68 7a29 2a2a 3220 2d20 2861 2a63 6f73  lhz)**2 - (a*cos
+00029dc0: 2861 6c70 6861 292a 2a32 292c 2063 656c  (alpha)**2), cel
+00029dd0: 6c68 7a29 2c20 7827 2075 6e69 7420 6365  lhz), x' unit ce
+00029de0: 6c6c 206c 656e 6774 6820 6973 2062 2c20  ll length is b, 
+00029df0: 616c 7068 6120 6973 0a20 2020 2020 2020  alpha is.       
+00029e00: 2023 2074 6865 2061 6e67 6c65 2062 6574   # the angle bet
+00029e10: 7765 656e 2078 2720 616e 6420 7a27 2877  ween x' and z'(w
+00029e20: 6869 6368 2061 7265 2074 6865 2063 656c  hich are the cel
+00029e30: 6c20 6178 6573 290a 2020 2020 2020 2020  l axes).        
+00029e40: 2320 4279 2075 7369 6e67 2074 6865 7365  # By using these
+00029e50: 2074 6872 6565 2070 6f69 6e74 7320 7468   three points th
+00029e60: 6520 706c 616e 6520 6f66 2078 277a 2720  e plane of x'z' 
+00029e70: 6361 6e20 6265 2063 616c 6375 6c61 7465  can be calculate
+00029e80: 640a 2020 2020 2020 2020 2320 413d 302c  d.        # A=0,
+00029e90: 2042 3d63 656c 6c68 7a2c 2043 203d 202d   B=cellhz, C = -
+00029ea0: 7371 7274 2861 2a2a 3220 2d20 2863 656c  sqrt(a**2 - (cel
+00029eb0: 6c68 7a29 2a2a 3220 2d20 2861 2a63 6f73  lhz)**2 - (a*cos
+00029ec0: 2861 6c70 6861 2929 2a2a 3229 2c20 443d  (alpha))**2), D=
+00029ed0: 300a 2020 2020 2020 2020 4120 3d20 300a  0.        A = 0.
+00029ee0: 2020 2020 2020 2020 4220 3d20 6365 6c6c          B = cell
+00029ef0: 6865 6967 6874 7a0a 2020 2020 2020 2020  heightz.        
+00029f00: 4320 3d20 2d6d 6174 682e 7371 7274 287a  C = -math.sqrt(z
+00029f10: 5f61 7069 7820 2a2a 2032 202d 2063 656c  _apix ** 2 - cel
+00029f20: 6c68 6569 6768 747a 202a 2a20 3220 2d20  lheightz ** 2 - 
+00029f30: 287a 5f61 7069 7820 2a20 6d61 7468 2e63  (z_apix * math.c
+00029f40: 6f73 2862 6574 6129 2920 2a2a 2032 290a  os(beta)) ** 2).
+00029f50: 2020 2020 2020 2020 4420 3d20 300a 0a20          D = 0.. 
+00029f60: 2020 2020 2020 2023 2064 6973 7461 6e63         # distanc
+00029f70: 6520 6672 6f6d 2061 746f 6d20 746f 2078  e from atom to x
+00029f80: 277a 2720 706c 616e 653a 0a20 2020 2020  'z' plane:.     
+00029f90: 2020 2023 2020 2020 2020 2020 207c 4178     #         |Ax
+00029fa0: 202b 2042 7920 2b20 437a 202b 2044 7c0a   + By + Cz + D|.
+00029fb0: 2020 2020 2020 2020 2320 6420 3d20 2d2d          # d = --
+00029fc0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00029fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00029fe0: 2020 2020 2320 2020 2020 2020 7371 7274      #       sqrt
+00029ff0: 2841 2a2a 3220 2b20 422a 2a32 202b 2043  (A**2 + B**2 + C
+0002a000: 2a2a 3229 0a20 2020 2020 2020 2064 7920  **2).        dy 
+0002a010: 3d20 6d61 7468 2e66 6162 7328 4220 2a20  = math.fabs(B * 
+0002a020: 7265 6c61 7469 7665 7920 2b20 4320 2a20  relativey + C * 
+0002a030: 7265 6c61 7469 7665 7a29 202f 206d 6174  relativez) / mat
+0002a040: 682e 7371 7274 2841 202a 2a20 3220 2b20  h.sqrt(A ** 2 + 
+0002a050: 4220 2a2a 2032 202b 2043 202a 2a20 3229  B ** 2 + C ** 2)
+0002a060: 0a0a 2020 2020 2020 2020 2320 5468 6520  ..        # The 
+0002a070: 7061 7261 6c6c 656c 2070 6c61 6e20 7768  parallel plan wh
+0002a080: 6963 6820 7061 7373 2074 6865 2061 746f  ich pass the ato
+0002a090: 6d20 616e 6420 696e 7465 7273 6563 7420  m and intersect 
+0002a0a0: 7769 7468 2074 6865 2078 2069 733a 0a20  with the x is:. 
+0002a0b0: 2020 2020 2020 2023 2041 7829 202b 2042         # Ax) + B
+0002a0c0: 2879 202b 2061 2920 2b20 437a 202b 2044  (y + a) + Cz + D
+0002a0d0: 203d 2030 0a20 2020 2020 2020 2023 2061   = 0.        # a
+0002a0e0: 203d 202d 2841 7820 2b20 4279 202b 2043   = -(Ax + By + C
+0002a0f0: 7a20 2b20 4429 2f41 0a20 2020 2020 2020  z + D)/A.       
+0002a100: 2023 2078 6375 7420 3d20 2d61 0a20 2020   # xcut = -a.   
+0002a110: 2020 2020 2079 6375 7420 3d20 2d28 4120       ycut = -(A 
+0002a120: 2a20 6f6e 6563 6f6f 725b 305d 202b 206f  * onecoor[0] + o
+0002a130: 6e65 636f 6f72 5b31 5d20 2b20 2843 202f  necoor[1] + (C /
+0002a140: 2042 2920 2a20 6f6e 6563 6f6f 725b 325d   B) * onecoor[2]
+0002a150: 290a 2020 2020 2020 2020 7963 7574 203d  ).        ycut =
+0002a160: 202d 7963 7574 0a20 2020 2020 2020 2069   -ycut.        i
+0002a170: 6620 7963 7574 203c 2030 206f 7220 7963  f ycut < 0 or yc
+0002a180: 7574 203e 206d 6170 2e68 6561 6465 725b  ut > map.header[
+0002a190: 3020 2b20 6f72 6469 6e64 735b 315d 5d20  0 + ordinds[1]] 
+0002a1a0: 2a20 795f 6170 6978 202a 206d 6174 682e  * y_apix * math.
+0002a1b0: 7369 6e28 6761 6d6d 6129 3a0a 2020 2020  sin(gamma):.    
+0002a1c0: 2020 2020 2020 2020 6479 203d 202d 6479          dy = -dy
+0002a1d0: 0a0a 2020 2020 2020 2020 7969 6e64 203d  ..        yind =
+0002a1e0: 2064 7920 2f20 6365 6c6c 6865 6967 6874   dy / cellheight
+0002a1f0: 790a 2020 2020 2020 2020 7969 6e64 6578  y.        yindex
+0002a200: 203d 2079 696e 6420 2d20 6d61 702e 6865   = yind - map.he
+0002a210: 6164 6572 5b34 202b 206f 7264 696e 6473  ader[4 + ordinds
+0002a220: 5b31 5d5d 0a0a 2020 2020 2020 2020 2320  [1]]..        # 
+0002a230: 506c 616e 6520 7a27 7927 0a20 2020 2020  Plane z'y'.     
+0002a240: 2020 2023 2041 7820 2b20 4279 202b 2043     # Ax + By + C
+0002a250: 7a20 2b20 4420 3d20 3020 7769 7468 2074  z + D = 0 with t
+0002a260: 6872 6565 2064 6174 6120 706f 696e 7473  hree data points
+0002a270: 3a20 2830 2c20 302c 2030 292c 2028 612a  : (0, 0, 0), (a*
+0002a280: 636f 7328 616c 7068 6129 2c0a 2020 2020  cos(alpha),.    
+0002a290: 2020 2020 2320 7371 7274 2861 2a2a 3220      # sqrt(a**2 
+0002a2a0: 2d20 2863 656c 6c68 7a29 2a2a 3220 2d20  - (cellhz)**2 - 
+0002a2b0: 2861 2a63 6f73 2861 6c70 6861 292a 2a32  (a*cos(alpha)**2
+0002a2c0: 292c 2063 656c 6c68 7a29 2c0a 2020 2020  ), cellhz),.    
+0002a2d0: 2020 2020 2320 2864 2a63 6f73 2867 616d      # (d*cos(gam
+0002a2e0: 6d61 292c 2064 2a73 696e 2867 616d 6d61  ma), d*sin(gamma
+0002a2f0: 292c 2030 290a 2020 2020 2020 2020 2320  ), 0).        # 
+0002a300: 6265 7461 2069 7320 7468 6520 616e 676c  beta is the angl
+0002a310: 6520 6265 7477 6565 6e20 7827 2061 6e64  e between x' and
+0002a320: 207a 273b 2067 616d 6d61 2069 7320 7468   z'; gamma is th
+0002a330: 6520 616e 676c 6520 6265 7477 6565 6e20  e angle between 
+0002a340: 7827 2061 6e64 2079 273b 2064 2069 7320  x' and y'; d is 
+0002a350: 7468 6520 6365 6c6c 2075 6e69 7420 6c65  the cell unit le
+0002a360: 6e67 7468 0a20 2020 2020 2020 2023 2061  ngth.        # a
+0002a370: 6c6f 6e67 2079 270a 2020 2020 2020 2020  long y'.        
+0002a380: 2320 5573 696e 6720 7468 6573 6520 7468  # Using these th
+0002a390: 7265 6520 706f 696e 7473 2061 2070 6c61  ree points a pla
+0002a3a0: 6e65 2063 616e 2062 6520 6361 6c63 756c  ne can be calcul
+0002a3b0: 6174 6564 0a20 2020 2020 2020 2023 2041  ated.        # A
+0002a3c0: 3d2d 7467 2862 6574 6129 2c20 4220 3d20  =-tg(beta), B = 
+0002a3d0: 312c 2044 3d30 2c0a 2020 2020 2020 2020  1, D=0,.        
+0002a3e0: 2320 2020 2020 2061 2a63 6f73 2861 6c70  #      a*cos(alp
+0002a3f0: 6861 292a 7467 2862 6574 6129 202d 2074  ha)*tg(beta) - t
+0002a400: 0a20 2020 2020 2020 2023 2043 203d 202d  .        # C = -
+0002a410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002a420: 2d2d 2d2d 2d2d 2d2d 2d2d 202c 2020 2020  ---------- ,    
+0002a430: 2074 203d 2073 7172 7428 612a 2a32 202d   t = sqrt(a**2 -
+0002a440: 2028 6365 6c6c 687a 292a 2a32 202d 2028   (cellhz)**2 - (
+0002a450: 612a 636f 7328 616c 7068 6129 292a 2a32  a*cos(alpha))**2
+0002a460: 290a 2020 2020 2020 2020 2320 2020 2020  ).        #     
+0002a470: 2020 2020 2020 2063 656c 6c68 7a0a 2020         cellhz.  
+0002a480: 2020 2020 2020 2320 4120 3d20 2d6d 6174        # A = -mat
+0002a490: 682e 7461 6e28 6761 6d6d 6129 0a20 2020  h.tan(gamma).   
+0002a4a0: 2020 2020 2023 2042 203d 2031 0a20 2020       # B = 1.   
+0002a4b0: 2020 2020 2023 2044 203d 2030 0a20 2020       # D = 0.   
+0002a4c0: 2020 2020 2023 2074 203d 206d 6174 682e       # t = math.
+0002a4d0: 7371 7274 287a 5f61 7069 782a 2a32 202d  sqrt(z_apix**2 -
+0002a4e0: 2063 656c 6c68 6569 6768 747a 2a2a 3220   cellheightz**2 
+0002a4f0: 2d20 287a 5f61 7069 782a 6d61 7468 2e63  - (z_apix*math.c
+0002a500: 6f73 2862 6574 6129 292a 2a32 290a 2020  os(beta))**2).  
+0002a510: 2020 2020 2020 2320 4320 3d20 287a 5f61        # C = (z_a
+0002a520: 7069 7820 2a20 6d61 7468 2e63 6f73 2862  pix * math.cos(b
+0002a530: 6574 6129 2a6d 6174 682e 7461 6e28 6761  eta)*math.tan(ga
+0002a540: 6d6d 6129 202d 2074 2920 2f20 6365 6c6c  mma) - t) / cell
+0002a550: 6865 6967 6874 7a0a 0a20 2020 2020 2020  heightz..       
+0002a560: 2069 6620 6d61 702e 6865 6164 6572 5b31   if map.header[1
+0002a570: 355d 203d 3d20 3930 2e3a 0a20 2020 2020  5] == 90.:.     
+0002a580: 2020 2020 2020 2073 696e 6761 6d6d 6120         singamma 
+0002a590: 3d20 312e 0a20 2020 2020 2020 2020 2020  = 1..           
+0002a5a0: 2063 6f73 6761 6d6d 6120 3d20 302e 0a20   cosgamma = 0.. 
+0002a5b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002a5c0: 2020 2020 2020 2020 2073 696e 6761 6d6d           singamm
+0002a5d0: 6120 3d20 6d61 7468 2e73 696e 2867 616d  a = math.sin(gam
+0002a5e0: 6d61 290a 2020 2020 2020 2020 2020 2020  ma).            
+0002a5f0: 636f 7367 616d 6d61 203d 206d 6174 682e  cosgamma = math.
+0002a600: 636f 7328 6761 6d6d 6129 0a0a 2020 2020  cos(gamma)..    
+0002a610: 2020 2020 6966 206d 6170 2e68 6561 6465      if map.heade
+0002a620: 725b 3134 5d20 3d3d 2039 302e 3a0a 2020  r[14] == 90.:.  
+0002a630: 2020 2020 2020 2020 2020 7369 6e67 6265            singbe
+0002a640: 7461 203d 2031 2e0a 2020 2020 2020 2020  ta = 1..        
+0002a650: 2020 2020 636f 7362 6574 6120 3d20 302e      cosbeta = 0.
+0002a660: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0002a670: 2020 2020 2020 2020 2020 2073 696e 6265             sinbe
+0002a680: 7461 203d 206d 6174 682e 7369 6e28 6265  ta = math.sin(be
+0002a690: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
+0002a6a0: 636f 7362 6574 6120 3d20 6d61 7468 2e63  cosbeta = math.c
+0002a6b0: 6f73 2862 6574 6129 0a0a 2020 2020 2020  os(beta)..      
+0002a6c0: 2020 4120 3d20 2d73 696e 6761 6d6d 610a    A = -singamma.
+0002a6d0: 2020 2020 2020 2020 4220 3d20 636f 7367          B = cosg
+0002a6e0: 616d 6d61 0a20 2020 2020 2020 2044 203d  amma.        D =
+0002a6f0: 2030 0a20 2020 2020 2020 2074 203d 206d   0.        t = m
+0002a700: 6174 682e 7371 7274 287a 5f61 7069 7820  ath.sqrt(z_apix 
+0002a710: 2a2a 2032 202d 2063 656c 6c68 6569 6768  ** 2 - cellheigh
+0002a720: 747a 202a 2a20 3220 2d20 287a 5f61 7069  tz ** 2 - (z_api
+0002a730: 7820 2a20 636f 7362 6574 6129 202a 2a20  x * cosbeta) ** 
+0002a740: 3229 0a20 2020 2020 2020 2043 203d 2028  2).        C = (
+0002a750: 7a5f 6170 6978 202a 2063 6f73 6265 7461  z_apix * cosbeta
+0002a760: 202a 2073 696e 6761 6d6d 6120 2d20 7420   * singamma - t 
+0002a770: 2a20 636f 7367 616d 6d61 2920 2f20 6365  * cosgamma) / ce
+0002a780: 6c6c 6865 6967 6874 7a0a 0a20 2020 2020  llheightz..     
+0002a790: 2020 2023 2064 6973 7461 6e63 6520 6672     # distance fr
+0002a7a0: 6f6d 2061 746f 6d20 746f 207a 2779 2720  om atom to z'y' 
+0002a7b0: 706c 616e 653a 0a20 2020 2020 2020 2023  plane:.        #
+0002a7c0: 2020 2020 2020 2020 207c 4178 202b 2042           |Ax + B
+0002a7d0: 7920 2b20 437a 202b 2044 7c0a 2020 2020  y + Cz + D|.    
+0002a7e0: 2020 2020 2320 6420 3d20 2d2d 2d2d 2d2d      # d = ------
+0002a7f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002a800: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0002a810: 2320 2020 2020 2020 7371 7274 2841 2a2a  #       sqrt(A**
+0002a820: 3220 2b20 422a 2a32 202b 2043 2a2a 3229  2 + B**2 + C**2)
+0002a830: 0a20 2020 2020 2020 2064 7820 3d20 6d61  .        dx = ma
+0002a840: 7468 2e66 6162 7328 4120 2a20 7265 6c61  th.fabs(A * rela
+0002a850: 7469 7665 7820 2b20 4220 2a20 7265 6c61  tivex + B * rela
+0002a860: 7469 7665 7920 2b20 4320 2a20 7265 6c61  tivey + C * rela
+0002a870: 7469 7665 7a29 202f 206d 6174 682e 7371  tivez) / math.sq
+0002a880: 7274 2841 202a 2a20 3220 2b20 4220 2a2a  rt(A ** 2 + B **
+0002a890: 2032 202b 2043 202a 2a20 3229 0a20 2020   2 + C ** 2).   
+0002a8a0: 2020 2020 2078 6375 7420 3d20 282d 286f       xcut = (-(o
+0002a8b0: 6e65 636f 6f72 5b30 5d20 2b20 2842 202f  necoor[0] + (B /
+0002a8c0: 2041 2920 2a20 6f6e 6563 6f6f 725b 315d   A) * onecoor[1]
+0002a8d0: 202b 2028 4320 2f20 4129 202a 206f 6e65   + (C / A) * one
+0002a8e0: 636f 6f72 5b32 5d29 290a 2020 2020 2020  coor[2])).      
+0002a8f0: 2020 7863 7574 203d 202d 7863 7574 0a20    xcut = -xcut. 
+0002a900: 2020 2020 2020 2069 6620 7863 7574 203c         if xcut <
+0002a910: 2030 206f 7220 7863 7574 203e 206d 6170   0 or xcut > map
+0002a920: 2e68 6561 6465 725b 3020 2b20 6f72 6469  .header[0 + ordi
+0002a930: 6e64 735b 305d 5d20 2a20 785f 6170 6978  nds[0]] * x_apix
+0002a940: 3a0a 2020 2020 2020 2020 2020 2020 6478  :.            dx
+0002a950: 203d 202d 6478 0a20 2020 2020 2020 2078   = -dx.        x
+0002a960: 696e 6420 3d20 6478 202f 2063 656c 6c68  ind = dx / cellh
+0002a970: 6569 6768 7478 0a20 2020 2020 2020 2078  eightx.        x
+0002a980: 696e 6465 7820 3d20 7869 6e64 202d 206d  index = xind - m
+0002a990: 6170 2e68 6561 6465 725b 3420 2b20 6f72  ap.header[4 + or
+0002a9a0: 6469 6e64 735b 305d 5d0a 0a0a 2020 2020  dinds[0]]...    
+0002a9b0: 2020 2020 7265 7475 726e 2878 696e 6465      return(xinde
+0002a9c0: 782c 2079 696e 6465 782c 207a 696e 6465  x, yindex, zinde
+0002a9d0: 7829 0a0a 0a20 2020 2064 6566 205f 5f67  x)...    def __g
+0002a9e0: 6574 696e 6469 6365 7328 7365 6c66 2c20  etindices(self, 
+0002a9f0: 6f6e 6563 6f6f 7229 3a0a 2020 2020 2020  onecoor):.      
+0002aa00: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
+0002aa10: 2020 2046 696e 6420 6f6e 6520 6174 6f6d     Find one atom
+0002aa20: 2773 2069 6e64 6963 6573 2063 6f72 7265  's indices corre
+0002aa30: 7370 6f64 696e 6720 746f 2069 7473 2063  spoding to its c
+0002aa40: 7562 6963 206f 7220 706c 616e 650a 2020  ubic or plane.  
+0002aa50: 2020 2020 2020 2020 2020 7468 6520 3820            the 8 
+0002aa60: 2863 7562 6963 2920 6f72 2034 2028 706c  (cubic) or 4 (pl
+0002aa70: 616e 6529 2069 6e64 6963 6573 2061 7265  ane) indices are
+0002aa80: 2073 6176 6564 2069 6e20 696e 6469 6365   saved in indice
+0002aa90: 7320 7661 7269 6162 6c65 0a0a 2020 2020  s variable..    
+0002aaa0: 2020 2020 3a70 6172 616d 206d 6170 3a20      :param map: 
+0002aab0: 4465 6e73 6974 7920 6d61 7020 696e 7374  Density map inst
+0002aac0: 616e 6365 2066 726f 6d20 5445 4d50 792e  ance from TEMPy.
+0002aad0: 4d61 7050 6172 7365 720a 2020 2020 2020  MapParser.      
+0002aae0: 2020 3a70 6172 616d 206f 6e65 636f 6f72    :param onecoor
+0002aaf0: 3a20 4c69 7374 2063 6f6e 7461 696e 7320  : List contains 
+0002ab00: 7468 6520 6174 6f6d 2063 6f6f 7264 696e  the atom coordin
+0002ab10: 6174 6573 2069 6e20 2878 2c20 792c 207a  ates in (x, y, z
+0002ab20: 2920 6f72 6465 720a 2020 2020 2020 2020  ) order.        
+0002ab30: 3a72 6574 7572 6e3a 2054 7570 6c65 2063  :return: Tuple c
+0002ab40: 6f6e 7461 696e 7320 7477 6f20 6c69 7374  ontains two list
+0002ab50: 206f 6620 696e 6465 783a 2066 6972 7374   of index: first
+0002ab60: 2068 6173 2074 6865 2038 206f 7220 3420   has the 8 or 4 
+0002ab70: 696e 6469 6365 7320 696e 2074 6865 2063  indices in the c
+0002ab80: 7562 6963 3b0a 2020 2020 2020 2020 2020  ubic;.          
+0002ab90: 2020 2020 2020 2073 6563 6f6e 6420 6861         second ha
+0002aba0: 7320 7468 6520 666c 6f61 7420 696e 6465  s the float inde
+0002abb0: 7820 6f66 2074 6865 2069 6e70 7574 2061  x of the input a
+0002abc0: 746f 6d0a 0a20 2020 2020 2020 2022 2222  tom..        """
+0002abd0: 0a0a 2020 2020 2020 2020 2320 466f 7220  ..        # For 
+0002abe0: 6e6f 6e2d 6375 6269 6320 6f72 2073 6b65  non-cubic or ske
+0002abf0: 7765 6420 6465 6e73 6974 7920 6d61 7073  wed density maps
+0002ac00: 2c20 7468 6579 206d 6967 6874 2068 6176  , they might hav
+0002ac10: 6520 6469 6666 6572 656e 7420 6170 6978  e different apix
+0002ac20: 206f 6e20 6469 6666 6572 656e 7420 6178   on different ax
+0002ac30: 6973 6573 0a20 2020 2020 2020 206d 6170  ises.        map
+0002ac40: 203d 2073 656c 662e 6d61 700a 2020 2020   = self.map.    
+0002ac50: 2020 2020 7a64 696d 203d 206d 6170 2e68      zdim = map.h
+0002ac60: 6561 6465 722e 6365 6c6c 612e 7a0a 2020  eader.cella.z.  
+0002ac70: 2020 2020 2020 7a6e 696e 7465 7276 616c        zninterval
+0002ac80: 7320 3d20 6d61 702e 6865 6164 6572 2e6d  s = map.header.m
+0002ac90: 7a0a 2020 2020 2020 2020 7a5f 6170 6978  z.        z_apix
+0002aca0: 203d 207a 6469 6d20 2f20 7a6e 696e 7465   = zdim / zninte
+0002acb0: 7276 616c 730a 0a20 2020 2020 2020 2079  rvals..        y
+0002acc0: 6469 6d20 3d20 6d61 702e 6865 6164 6572  dim = map.header
+0002acd0: 2e63 656c 6c61 2e79 0a20 2020 2020 2020  .cella.y.       
+0002ace0: 2079 6e69 6e74 6572 7661 6c73 203d 206d   ynintervals = m
+0002acf0: 6170 2e68 6561 6465 722e 6d79 0a20 2020  ap.header.my.   
+0002ad00: 2020 2020 2079 5f61 7069 7820 3d20 7964       y_apix = yd
+0002ad10: 696d 202f 2079 6e69 6e74 6572 7661 6c73  im / ynintervals
+0002ad20: 0a0a 2020 2020 2020 2020 7864 696d 203d  ..        xdim =
+0002ad30: 206d 6170 2e68 6561 6465 722e 6365 6c6c   map.header.cell
+0002ad40: 612e 780a 2020 2020 2020 2020 786e 696e  a.x.        xnin
+0002ad50: 7465 7276 616c 7320 3d20 6d61 702e 6865  tervals = map.he
+0002ad60: 6164 6572 2e6d 780a 2020 2020 2020 2020  ader.mx.        
+0002ad70: 785f 6170 6978 203d 2078 6469 6d20 2f20  x_apix = xdim / 
+0002ad80: 786e 696e 7465 7276 616c 730a 0a20 2020  xnintervals..   
+0002ad90: 2020 2020 206d 6170 5f7a 7369 7a65 203d       map_zsize =
+0002ada0: 206d 6170 2e68 6561 6465 722e 6e7a 0a20   map.header.nz. 
+0002adb0: 2020 2020 2020 206d 6170 5f79 7369 7a65         map_ysize
+0002adc0: 203d 206d 6170 2e68 6561 6465 722e 6e79   = map.header.ny
+0002add0: 0a20 2020 2020 2020 206d 6170 5f78 7369  .        map_xsi
+0002ade0: 7a65 203d 206d 6170 2e68 6561 6465 722e  ze = map.header.
+0002adf0: 6e78 0a0a 2020 2020 2020 2020 2320 6966  nx..        # if
+0002ae00: 206d 6170 2e68 6561 6465 725b 3133 5d20   map.header[13] 
+0002ae10: 3d3d 206d 6170 2e68 6561 6465 725b 3134  == map.header[14
+0002ae20: 5d20 3d3d 206d 6170 2e68 6561 6465 725b  ] == map.header[
+0002ae30: 3135 5d20 3d3d 2039 302e 3a0a 2020 2020  15] == 90.:.    
+0002ae40: 2020 2020 6966 206d 6170 2e68 6561 6465      if map.heade
+0002ae50: 722e 6365 6c6c 622e 616c 7068 6120 3d3d  r.cellb.alpha ==
+0002ae60: 206d 6170 2e68 6561 6465 722e 6365 6c6c   map.header.cell
+0002ae70: 622e 6265 7461 203d 3d20 6d61 702e 6865  b.beta == map.he
+0002ae80: 6164 6572 2e63 656c 6c62 2e67 616d 6d61  ader.cellb.gamma
+0002ae90: 203d 3d20 3930 2e3a 0a20 2020 2020 2020   == 90.:.       
+0002aea0: 2020 2020 2023 2046 6967 7572 6520 6f75       # Figure ou
+0002aeb0: 7420 7468 6520 6f72 6465 7220 6f66 2074  t the order of t
+0002aec0: 6865 2078 2c20 792c 207a 2062 6173 6564  he x, y, z based
+0002aed0: 206f 6e20 6372 7320 696e 666f 2069 6e20   on crs info in 
+0002aee0: 7468 6520 6865 6164 6572 0a20 2020 2020  the header.     
+0002aef0: 2020 2020 2020 2023 2063 7273 203d 206c         # crs = l
+0002af00: 6973 7428 6d61 702e 6865 6164 6572 5b31  ist(map.header[1
+0002af10: 363a 3139 5d29 0a20 2020 2020 2020 2020  6:19]).         
+0002af20: 2020 2063 7273 203d 205b 6d61 702e 6865     crs = [map.he
+0002af30: 6164 6572 2e6d 6170 632c 206d 6170 2e68  ader.mapc, map.h
+0002af40: 6561 6465 722e 6d61 7072 2c20 6d61 702e  eader.mapr, map.
+0002af50: 6865 6164 6572 2e6d 6170 735d 0a20 2020  header.maps].   
+0002af60: 2020 2020 2020 2020 2023 206f 7264 696e           # ordin
+0002af70: 6473 2073 6176 6520 7468 6520 696e 6469  ds save the indi
+0002af80: 6365 7320 636f 7272 6573 706f 6469 6e67  ces correspoding
+0002af90: 2074 6f20 782c 2079 202c 7a0a 2020 2020   to x, y ,z.    
+0002afa0: 2020 2020 2020 2020 6f72 6469 6e64 7320          ordinds 
+0002afb0: 3d20 5b63 7273 2e69 6e64 6578 2831 292c  = [crs.index(1),
+0002afc0: 2063 7273 2e69 6e64 6578 2832 292c 2063   crs.index(2), c
+0002afd0: 7273 2e69 6e64 6578 2833 295d 0a0a 2020  rs.index(3)]..  
+0002afe0: 2020 2020 2020 2020 2020 7a69 6e64 6578            zindex
+0002aff0: 203d 2066 6c6f 6174 286f 6e65 636f 6f72   = float(onecoor
+0002b000: 5b32 5d20 2d20 6d61 702e 6865 6164 6572  [2] - map.header
+0002b010: 2e6f 7269 6769 6e2e 7a29 202f 207a 5f61  .origin.z) / z_a
+0002b020: 7069 7820 2d20 6d61 702e 6865 6164 6572  pix - map.header
+0002b030: 2e6e 7a73 7461 7274 0a20 2020 2020 2020  .nzstart.       
+0002b040: 2020 2020 2079 696e 6465 7820 3d20 666c       yindex = fl
+0002b050: 6f61 7428 6f6e 6563 6f6f 725b 315d 202d  oat(onecoor[1] -
+0002b060: 206d 6170 2e68 6561 6465 722e 6f72 6967   map.header.orig
+0002b070: 696e 2e79 2920 2f20 795f 6170 6978 202d  in.y) / y_apix -
+0002b080: 206d 6170 2e68 6561 6465 722e 6e79 7374   map.header.nyst
+0002b090: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
+0002b0a0: 7869 6e64 6578 203d 2066 6c6f 6174 286f  xindex = float(o
+0002b0b0: 6e65 636f 6f72 5b30 5d20 2d20 6d61 702e  necoor[0] - map.
+0002b0c0: 6865 6164 6572 2e6f 7269 6769 6e2e 7829  header.origin.x)
+0002b0d0: 202f 2078 5f61 7069 7820 2d20 6d61 702e   / x_apix - map.
+0002b0e0: 6865 6164 6572 2e6e 7873 7461 7274 0a0a  header.nxstart..
+0002b0f0: 2020 2020 2020 2020 2020 2020 7a66 6c6f              zflo
+0002b100: 6f72 203d 2069 6e74 2866 6c6f 6f72 287a  or = int(floor(z
+0002b110: 696e 6465 7829 290a 2020 2020 2020 2020  index)).        
+0002b120: 2020 2020 6966 207a 666c 6f6f 7220 3e3d      if zfloor >=
+0002b130: 206d 6170 5f7a 7369 7a65 202d 2031 3a0a   map_zsize - 1:.
+0002b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b150: 7a63 6569 6c20 3d20 7a66 6c6f 6f72 0a20  zceil = zfloor. 
+0002b160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002b170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b180: 207a 6365 696c 203d 207a 666c 6f6f 7220   zceil = zfloor 
+0002b190: 2b20 310a 0a20 2020 2020 2020 2020 2020  + 1..           
+0002b1a0: 2079 666c 6f6f 7220 3d20 696e 7428 666c   yfloor = int(fl
+0002b1b0: 6f6f 7228 7969 6e64 6578 2929 0a20 2020  oor(yindex)).   
+0002b1c0: 2020 2020 2020 2020 2069 6620 7966 6c6f           if yflo
+0002b1d0: 6f72 203e 3d20 6d61 705f 7973 697a 6520  or >= map_ysize 
+0002b1e0: 2d20 313a 0a20 2020 2020 2020 2020 2020  - 1:.           
+0002b1f0: 2020 2020 2079 6365 696c 203d 2079 666c       yceil = yfl
+0002b200: 6f6f 720a 2020 2020 2020 2020 2020 2020  oor.            
+0002b210: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002b220: 2020 2020 2020 7963 6569 6c20 3d20 7966        yceil = yf
+0002b230: 6c6f 6f72 202b 2031 0a0a 2020 2020 2020  loor + 1..      
+0002b240: 2020 2020 2020 7866 6c6f 6f72 203d 2069        xfloor = i
+0002b250: 6e74 2866 6c6f 6f72 2878 696e 6465 7829  nt(floor(xindex)
+0002b260: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0002b270: 2078 666c 6f6f 7220 3e3d 206d 6170 5f78   xfloor >= map_x
+0002b280: 7369 7a65 202d 2031 3a0a 2020 2020 2020  size - 1:.      
+0002b290: 2020 2020 2020 2020 2020 7863 6569 6c20            xceil 
+0002b2a0: 3d20 7866 6c6f 6f72 0a20 2020 2020 2020  = xfloor.       
+0002b2b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002b2c0: 2020 2020 2020 2020 2020 2078 6365 696c             xceil
+0002b2d0: 203d 2078 666c 6f6f 7220 2b20 310a 2020   = xfloor + 1.  
+0002b2e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002b2f0: 2020 2020 2020 2020 2320 4d65 7468 6f64          # Method
+0002b300: 2032 3a20 6279 2075 7369 6e67 2074 6865   2: by using the
+0002b310: 2066 7261 6374 696f 6e61 6c20 636f 6f72   fractional coor
+0002b320: 6469 6e61 7465 206d 6174 7269 780a 2020  dinate matrix.  
+0002b330: 2020 2020 2020 2020 2020 2320 4368 6f73            # Chos
+0002b340: 656e 2061 7320 7468 6520 7072 696d 6172  en as the primar
+0002b350: 7920 666f 7220 7468 6520 6375 7272 656e  y for the curren
+0002b360: 7420 696d 706c 656d 656e 7461 7469 6f6e  t implementation
+0002b370: 0a20 2020 2020 2020 2020 2020 2061 7069  .            api
+0002b380: 7873 203d 205b 785f 6170 6978 2c20 795f  xs = [x_apix, y_
+0002b390: 6170 6978 2c20 7a5f 6170 6978 5d0a 2020  apix, z_apix].  
+0002b3a0: 2020 2020 2020 2020 2020 2320 4d65 7468            # Meth
+0002b3b0: 6f64 2031 3a20 6279 2075 7369 6e67 2074  od 1: by using t
+0002b3c0: 6865 2061 746f 6d20 7072 6f6a 6563 7469  he atom projecti
+0002b3d0: 6f6e 206f 6e20 706c 616e 6573 0a20 2020  on on planes.   
+0002b3e0: 2020 2020 2020 2020 2023 2078 696e 6465           # xinde
+0002b3f0: 782c 2079 696e 6465 782c 207a 696e 6465  x, yindex, zinde
+0002b400: 7820 3d20 7365 6c66 2e70 726f 6a65 6374  x = self.project
+0002b410: 696f 6e5f 696e 6469 6365 7328 6f6e 6563  ion_indices(onec
+0002b420: 6f6f 7229 290a 2020 2020 2020 2020 2020  oor)).          
+0002b430: 2020 7869 6e64 6578 2c20 7969 6e64 6578    xindex, yindex
+0002b440: 2c20 7a69 6e64 6578 203d 2073 656c 662e  , zindex = self.
+0002b450: 6d61 7472 6978 5f69 6e64 6963 6573 2861  matrix_indices(a
+0002b460: 7069 7873 2c20 6f6e 6563 6f6f 7229 0a0a  pixs, onecoor)..
+0002b470: 2020 2020 2020 2020 2020 2020 7a66 6c6f              zflo
+0002b480: 6f72 203d 2069 6e74 2866 6c6f 6f72 287a  or = int(floor(z
+0002b490: 696e 6465 7829 290a 2020 2020 2020 2020  index)).        
+0002b4a0: 2020 2020 6966 207a 666c 6f6f 7220 3e3d      if zfloor >=
+0002b4b0: 206d 6170 5f7a 7369 7a65 202d 2031 3a0a   map_zsize - 1:.
+0002b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4d0: 7a63 6569 6c20 3d20 7a66 6c6f 6f72 0a20  zceil = zfloor. 
+0002b4e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0002b4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b500: 207a 6365 696c 203d 207a 666c 6f6f 7220   zceil = zfloor 
+0002b510: 2b20 310a 0a20 2020 2020 2020 2020 2020  + 1..           
+0002b520: 2079 666c 6f6f 7220 3d20 696e 7428 666c   yfloor = int(fl
+0002b530: 6f6f 7228 7969 6e64 6578 2929 0a20 2020  oor(yindex)).   
+0002b540: 2020 2020 2020 2020 2069 6620 7966 6c6f           if yflo
+0002b550: 6f72 203e 3d20 6d61 705f 7973 697a 6520  or >= map_ysize 
+0002b560: 2d20 313a 0a20 2020 2020 2020 2020 2020  - 1:.           
+0002b570: 2020 2020 2079 6365 696c 203d 2079 666c       yceil = yfl
+0002b580: 6f6f 720a 2020 2020 2020 2020 2020 2020  oor.            
+0002b590: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002b5a0: 2020 2020 2020 7963 6569 6c20 3d20 7966        yceil = yf
+0002b5b0: 6c6f 6f72 202b 2031 0a0a 2020 2020 2020  loor + 1..      
+0002b5c0: 2020 2020 2020 7866 6c6f 6f72 203d 2069        xfloor = i
+0002b5d0: 6e74 2866 6c6f 6f72 2878 696e 6465 7829  nt(floor(xindex)
+0002b5e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0002b5f0: 2078 666c 6f6f 7220 3e3d 206d 6170 5f78   xfloor >= map_x
+0002b600: 7369 7a65 202d 2031 3a0a 2020 2020 2020  size - 1:.      
+0002b610: 2020 2020 2020 2020 2020 7863 6569 6c20            xceil 
+0002b620: 3d20 7866 6c6f 6f72 0a20 2020 2020 2020  = xfloor.       
+0002b630: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002b640: 2020 2020 2020 2020 2020 2078 6365 696c             xceil
+0002b650: 203d 2078 666c 6f6f 7220 2b20 310a 0a20   = xfloor + 1.. 
+0002b660: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
+0002b670: 206e 702e 6172 7261 7928 6e70 2e6d 6573   np.array(np.mes
+0002b680: 6867 7269 6428 6e70 2e61 7261 6e67 6528  hgrid(np.arange(
+0002b690: 7866 6c6f 6f72 2c20 7863 6569 6c20 2b20  xfloor, xceil + 
+0002b6a0: 3129 2c20 6e70 2e61 7261 6e67 6528 7966  1), np.arange(yf
+0002b6b0: 6c6f 6f72 2c20 7963 6569 6c20 2b20 3129  loor, yceil + 1)
+0002b6c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b6e0: 2020 2020 2020 2020 206e 702e 6172 616e           np.aran
+0002b6f0: 6765 287a 666c 6f6f 722c 207a 6365 696c  ge(zfloor, zceil
+0002b700: 202b 2031 2929 292e 542e 7265 7368 6170   + 1))).T.reshap
+0002b710: 6528 2d31 2c20 3329 0a20 2020 2020 2020  e(-1, 3).       
+0002b720: 206f 6e65 696e 6465 7820 3d20 5b78 696e   oneindex = [xin
+0002b730: 6465 782c 2079 696e 6465 782c 207a 696e  dex, yindex, zin
+0002b740: 6465 785d 0a0a 2020 2020 2020 2020 7265  dex]..        re
+0002b750: 7475 726e 2028 696e 6469 6365 732c 206f  turn (indices, o
+0002b760: 6e65 696e 6465 7829 0a0a 0a20 2020 2064  neindex)...    d
+0002b770: 6566 205f 5f67 6574 6672 6163 7469 6f6e  ef __getfraction
+0002b780: 7328 7365 6c66 2c20 696e 7465 7270 6f6c  s(self, interpol
+0002b790: 6174 696f 6e2c 206d 6f64 656c 293a 0a20  ation, model):. 
+0002b7a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0002b7b0: 2020 2020 2020 2020 5072 6f64 7563 6520          Produce 
+0002b7c0: 6174 6f6d 2069 6e63 6c75 7369 6f6e 2066  atom inclusion f
+0002b7d0: 7261 6374 696f 6e20 696e 666f 726d 6174  raction informat
+0002b7e0: 696f 6e20 666f 7220 6675 6c6c 2061 746f  ion for full ato
+0002b7f0: 6d73 2061 6e64 2062 6163 6b62 6f6e 6520  ms and backbone 
+0002b800: 7472 6163 650a 0a20 2020 2020 2020 203a  trace..        :
+0002b810: 7061 7261 6d20 696e 7465 7270 6f6c 6174  param interpolat
+0002b820: 696f 6e3a 204c 6973 7420 6f66 2069 6e74  ion: List of int
+0002b830: 6572 706f 6c61 7469 6f6e 2076 616c 7565  erpolation value
+0002b840: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+0002b850: 206d 6170 3a20 456c 6563 7472 6f6e 2064   map: Electron d
+0002b860: 656e 7369 7479 206d 6170 2069 6e20 6d72  ensity map in mr
+0002b870: 632f 6d61 7020 666f 726d 6174 0a20 2020  c/map format.   
+0002b880: 2020 2020 203a 7061 7261 6d20 6d6f 6465       :param mode
+0002b890: 6c3a 2050 726f 7465 696e 206d 6f64 656c  l: Protein model
+0002b8a0: 2069 6e20 6d6d 6369 6620 666f 726d 6174   in mmcif format
+0002b8b0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0002b8c0: 3a20 5475 706c 6520 636f 6e74 6169 6e73  : Tuple contains
+0002b8d0: 2066 756c 6c20 6174 6f6d 2069 6e63 6c75   full atom inclu
+0002b8e0: 7369 6f6e 2066 7261 6374 696f 6e73 2061  sion fractions a
+0002b8f0: 6e64 2062 6163 6b62 6f6e 6520 696e 636c  nd backbone incl
+0002b900: 7573 696f 6e20 6672 6163 7469 6f6e 730a  usion fractions.
+0002b910: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0002b920: 2020 2020 2020 6d61 7020 3d20 7365 6c66        map = self
+0002b930: 2e6d 6170 0a20 2020 2020 2020 2062 696e  .map.        bin
+0002b940: 7320 3d20 6e70 2e6c 696e 7370 6163 6528  s = np.linspace(
+0002b950: 6d61 702e 6461 7461 2e6d 696e 2829 2c20  map.data.min(), 
+0002b960: 6d61 702e 6461 7461 2e6d 6178 2829 2c20  map.data.max(), 
+0002b970: 3132 3929 0a20 2020 2020 2020 2062 696e  129).        bin
+0002b980: 6c69 7374 203d 2062 696e 732e 746f 6c69  list = bins.toli
+0002b990: 7374 2829 0a20 2020 2020 2020 2062 6973  st().        bis
+0002b9a0: 6563 742e 696e 736f 7274 2862 696e 6c69  ect.insort(binli
+0002b9b0: 7374 2c20 7365 6c66 2e63 6c29 0a20 2020  st, self.cl).   
+0002b9c0: 2020 2020 2063 6c69 6e64 6578 203d 2062       clindex = b
+0002b9d0: 696e 6c69 7374 2e69 6e64 6578 2873 656c  inlist.index(sel
+0002b9e0: 662e 636c 290a 2020 2020 2020 2020 6269  f.cl).        bi
+0002b9f0: 6e6c 6973 742e 706f 7028 636c 696e 6465  nlist.pop(clinde
+0002ba00: 7820 2d20 3129 0a20 2020 2020 2020 2062  x - 1).        b
+0002ba10: 696e 7320 3d20 6e70 2e61 7361 7272 6179  ins = np.asarray
+0002ba20: 2862 696e 6c69 7374 290a 0a20 2020 2020  (binlist)..     
+0002ba30: 2020 206e 6577 696e 7465 7270 6f6c 6174     newinterpolat
+0002ba40: 696f 6e20 3d20 5b5d 0a20 2020 2020 2020  ion = [].       
+0002ba50: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0002ba60: 6c65 6e28 696e 7465 7270 6f6c 6174 696f  len(interpolatio
+0002ba70: 6e29 293a 0a20 2020 2020 2020 2020 2020  n)):.           
+0002ba80: 2023 2069 6620 2748 2720 6e6f 7420 696e   # if 'H' not in
+0002ba90: 206d 6f64 656c 5b69 5d2e 6174 6f6d 5f6e   model[i].atom_n
+0002baa0: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
+0002bab0: 2069 6620 2748 2720 6e6f 7420 696e 206d   if 'H' not in m
+0002bac0: 6f64 656c 5b69 5d2e 6675 6c6c 6e61 6d65  odel[i].fullname
+0002bad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002bae0: 2020 6e65 7769 6e74 6572 706f 6c61 7469    newinterpolati
+0002baf0: 6f6e 2e61 7070 656e 6428 696e 7465 7270  on.append(interp
+0002bb00: 6f6c 6174 696f 6e5b 695d 290a 0a20 2020  olation[i])..   
+0002bb10: 2020 2020 2023 2057 686f 6c65 206d 6f64       # Whole mod
+0002bb20: 656c 2061 7665 7261 6765 2061 746f 6d20  el average atom 
+0002bb30: 696e 6c63 7573 696f 6e0a 2020 2020 2020  inlcusion.      
+0002bb40: 2020 656e 7469 7265 5f61 7665 7261 6765    entire_average
+0002bb50: 203d 2073 756d 286e 702e 6173 6172 7261   = sum(np.asarra
 0002bb60: 7928 6e65 7769 6e74 6572 706f 6c61 7469  y(newinterpolati
-0002bb70: 6f6e 290a 2020 2020 2020 2020 666f 7220  on).        for 
-0002bb80: 6920 696e 2062 696e 733a 0a20 2020 2020  i in bins:.     
-0002bb90: 2020 2020 2020 2078 203d 2073 756d 2874         x = sum(t
-0002bba0: 656d 706c 6973 7420 3e20 6929 202f 2066  emplist > i) / f
-0002bbb0: 6c6f 6174 286c 656e 2874 656d 706c 6973  loat(len(templis
-0002bbc0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-0002bbd0: 612e 6170 7065 6e64 2878 290a 0a20 2020  a.append(x)..   
-0002bbe0: 2020 2020 2074 7261 6365 696e 7465 7220       traceinter 
-0002bbf0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0002bc00: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-0002bc10: 696e 7465 7270 6f6c 6174 696f 6e29 293a  interpolation)):
-0002bc20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002bc30: 286d 6f64 656c 5b69 5d2e 6675 6c6c 6e61  (model[i].fullna
-0002bc40: 6d65 203d 3d20 274e 2720 6f72 206d 6f64  me == 'N' or mod
-0002bc50: 656c 5b69 5d2e 6675 6c6c 6e61 6d65 203d  el[i].fullname =
-0002bc60: 3d20 2743 2720 6f72 206d 6f64 656c 5b69  = 'C' or model[i
-0002bc70: 5d2e 6675 6c6c 6e61 6d65 203d 3d20 274f  ].fullname == 'O
-0002bc80: 2720 6f72 0a20 2020 2020 2020 2020 2020  ' or.           
-0002bc90: 2020 2020 2020 2020 206d 6f64 656c 5b69           model[i
-0002bca0: 5d2e 6675 6c6c 6e61 6d65 203d 3d20 2743  ].fullname == 'C
-0002bcb0: 4127 206f 7220 6d6f 6465 6c5b 695d 2e66  A' or model[i].f
-0002bcc0: 756c 6c6e 616d 6520 3d3d 2022 4333 2722  ullname == "C3'"
-0002bcd0: 206f 7220 6d6f 6465 6c5b 695d 2e66 756c   or model[i].ful
-0002bce0: 6c6e 616d 6520 3d3d 2022 4334 2722 206f  lname == "C4'" o
-0002bcf0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0002bd00: 2020 2020 2020 6d6f 6465 6c5b 695d 2e66        model[i].f
-0002bd10: 756c 6c6e 616d 6520 3d3d 2022 4335 2722  ullname == "C5'"
-0002bd20: 206f 7220 6d6f 6465 6c5b 695d 2e66 756c   or model[i].ful
-0002bd30: 6c6e 616d 6520 3d3d 2022 4f33 2722 206f  lname == "O3'" o
-0002bd40: 7220 6d6f 6465 6c5b 695d 2e66 756c 6c6e  r model[i].fulln
-0002bd50: 616d 6520 3d3d 2022 4f35 2722 206f 720a  ame == "O5'" or.
-0002bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd70: 2020 2020 6d6f 6465 6c5b 695d 2e66 756c      model[i].ful
-0002bd80: 6c6e 616d 6520 3d3d 2027 5027 206f 7220  lname == 'P' or 
-0002bd90: 6d6f 6465 6c5b 695d 2e66 756c 6c6e 616d  model[i].fullnam
-0002bda0: 6520 3d3d 2027 4f58 5427 293a 0a20 2020  e == 'OXT'):.   
-0002bdb0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-0002bdc0: 6365 696e 7465 722e 6170 7065 6e64 2869  ceinter.append(i
-0002bdd0: 6e74 6572 706f 6c61 7469 6f6e 5b69 5d29  nterpolation[i])
-0002bde0: 0a0a 2020 2020 2020 2020 2320 4261 636b  ..        # Back
-0002bdf0: 626f 6e65 2069 6e63 6c75 7369 6f6e 0a20  bone inclusion. 
-0002be00: 2020 2020 2020 2062 203d 205b 5d0a 2020         b = [].  
-0002be10: 2020 2020 2020 7465 6d70 7472 6163 6569        temptracei
-0002be20: 6e74 6572 203d 206e 702e 6173 6172 7261  nter = np.asarra
-0002be30: 7928 7472 6163 6569 6e74 6572 290a 2020  y(traceinter).  
-0002be40: 2020 2020 2020 666f 7220 6a20 696e 2062        for j in b
-0002be50: 696e 733a 0a20 2020 2020 2020 2020 2020  ins:.           
-0002be60: 2079 203d 2073 756d 2874 656d 7074 7261   y = sum(temptra
-0002be70: 6365 696e 7465 7220 3e20 6a29 202f 2066  ceinter > j) / f
-0002be80: 6c6f 6174 286c 656e 2874 656d 7074 7261  loat(len(temptra
-0002be90: 6365 696e 7465 7229 290a 2020 2020 2020  ceinter)).      
-0002bea0: 2020 2020 2020 622e 6170 7065 6e64 2879        b.append(y
-0002beb0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0002bec0: 6e20 612c 2062 2c20 656e 7469 7265 5f61  n a, b, entire_a
-0002bed0: 7665 7261 6765 2c20 666c 6f61 7428 6c65  verage, float(le
-0002bee0: 6e28 6e65 7769 6e74 6572 706f 6c61 7469  n(newinterpolati
-0002bef0: 6f6e 2929 0a0a 2020 2020 6465 6620 6169  on))..    def ai
-0002bf00: 5f62 6172 2873 656c 6629 3a0a 0a20 2020  _bar(self):..   
-0002bf10: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-0002bf20: 2e6f 6e6c 7962 6172 3a0a 2020 2020 2020  .onlybar:.      
-0002bf30: 2020 2020 2020 7365 6c66 2e61 746f 6d5f        self.atom_
-0002bf40: 696e 636c 7573 696f 6e28 290a 2020 2020  inclusion().    
-0002bf50: 2020 2020 7365 6c66 2e67 6574 5f62 6172      self.get_bar
-0002bf60: 2827 6174 6f6d 5f69 6e63 6c75 7369 6f6e  ('atom_inclusion
-0002bf70: 2729 0a0a 2020 2020 2320 4070 726f 6669  ')..    # @profi
-0002bf80: 6c65 0a20 2020 2064 6566 2061 746f 6d5f  le.    def atom_
-0002bf90: 696e 636c 7573 696f 6e28 7365 6c66 293a  inclusion(self):
-0002bfa0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0002bfb0: 2020 2020 2020 2020 2020 4765 6e65 7261            Genera
-0002bfc0: 7465 2061 746f 6d20 696e 636c 7573 696f  te atom inclusio
-0002bfd0: 6e20 616e 6420 7265 7369 6475 6520 6174  n and residue at
-0002bfe0: 6f6d 2069 6e63 6c75 7369 6f6e 2069 6e66  om inclusion inf
-0002bff0: 6f72 6d61 7469 6f6e 2076 6572 7365 7320  ormation verses 
-0002c000: 6469 6666 6572 656e 7420 636f 6e74 6f75  different contou
-0002c010: 7220 6c65 7665 6c0a 2020 2020 2020 2020  r level.        
-0002c020: 2020 2020 426f 7468 2066 756c 6c20 6174      Both full at
-0002c030: 6f6d 7320 616e 6420 6261 636b 626f 6e65  oms and backbone
-0002c040: 2069 6e66 6f72 6d61 7469 6f6e 2061 7265   information are
-0002c050: 2069 6e63 6c75 6465 642e 0a20 2020 2020   included..     
-0002c060: 2020 2020 2020 2052 6573 756c 7473 2077         Results w
-0002c070: 726f 7465 2074 6f20 4a53 4f4e 2066 696c  rote to JSON fil
-0002c080: 650a 0a20 2020 2020 2020 203a 7265 7475  e..        :retu
-0002c090: 726e 3a20 4e6f 6e65 0a0a 2020 2020 2020  rn: None..      
-0002c0a0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-0002c0b0: 2073 656c 662e 6d6f 6465 6c73 2069 7320   self.models is 
-0002c0c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002c0d0: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-0002c0e0: 7465 2827 5245 4d49 4e44 4552 3a20 6174  te('REMINDER: at
-0002c0f0: 6f6d 2069 6e63 6c75 7369 6f6e 2061 6e64  om inclusion and
-0002c100: 2072 6573 6964 7565 2069 6e63 6c75 7369   residue inclusi
-0002c110: 6f6e 2077 696c 6c20 6e6f 7420 6265 2063  on will not be c
-0002c120: 616c 6375 6c61 7465 6420 7769 7468 6f75  alculated withou
-0002c130: 7420 270a 2020 2020 2020 2020 2020 2020  t '.            
-0002c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c150: 2027 6d6f 6465 6c20 7374 7275 6374 7572   'model structur
-0002c160: 652e 5c6e 2729 0a20 2020 2020 2020 2020  e.\n').         
-0002c170: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
-0002c180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0002c190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-0002c1a0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-0002c1b0: 6c66 2e63 6c20 6973 204e 6f6e 653a 0a20  lf.cl is None:. 
-0002c1c0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
-0002c1d0: 7464 6572 722e 7772 6974 6528 2752 454d  tderr.write('REM
-0002c1e0: 494e 4445 523a 2061 746f 6d20 696e 636c  INDER: atom incl
-0002c1f0: 7573 696f 6e20 616e 6420 7265 7369 6475  usion and residu
-0002c200: 6520 696e 636c 7573 696f 6e20 7769 6c6c  e inclusion will
-0002c210: 206e 6f74 2062 6520 6361 6c63 756c 6174   not be calculat
-0002c220: 6564 2027 0a20 2020 2020 2020 2020 2020  ed '.           
-0002c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c240: 2020 2777 6974 686f 7574 2063 6f6e 746f    'without conto
-0002c250: 7572 206c 6576 656c 2067 6976 656e 2e5c  ur level given.\
-0002c260: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-0002c270: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
-0002c280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0002c290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020  -----------').  
-0002c2a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002c2b0: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-0002c2c0: 7469 6d65 6974 2e64 6566 6175 6c74 5f74  timeit.default_t
-0002c2d0: 696d 6572 2829 0a20 2020 2020 2020 2020  imer().         
-0002c2e0: 2020 206d 6170 203d 2073 656c 662e 6d61     map = self.ma
-0002c2f0: 700a 0a20 2020 2020 2020 2020 2020 2023  p..            #
-0002c300: 206d 6f64 656c 6e61 6d65 7320 3d20 5b20   modelnames = [ 
-0002c310: 6d6f 6465 6c2e 6669 6c65 6e61 6d65 2066  model.filename f
-0002c320: 6f72 206d 6f64 656c 2069 6e20 7365 6c66  or model in self
-0002c330: 2e6d 6f64 656c 7320 5d0a 2020 2020 2020  .models ].      
-0002c340: 2020 2020 2020 2320 7665 7273 696f 6e20        # version 
-0002c350: 3120 7573 6520 7465 6d70 790a 2020 2020  1 use tempy.    
-0002c360: 2020 2020 2020 2020 2320 636f 6d62 696e          # combin
-0002c370: 7265 7375 6c74 203d 2073 656c 662e 5f5f  result = self.__
-0002c380: 696e 7465 7274 6869 7264 2829 0a20 2020  interthird().   
-0002c390: 2020 2020 2020 2020 2023 2076 6572 7369           # versi
-0002c3a0: 6f6e 2032 2075 7365 2062 696f 7079 7468  on 2 use biopyth
-0002c3b0: 6f6e 2062 7574 206e 6f74 206f 7074 6d69  on but not optmi
-0002c3c0: 7365 6420 666f 7220 6269 6f70 7974 686f  sed for biopytho
-0002c3d0: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
-0002c3e0: 636f 6d62 696e 7265 7375 6c74 203d 2073  combinresult = s
-0002c3f0: 656c 662e 5f5f 6e65 7769 6e74 6572 7468  elf.__newinterth
-0002c400: 6972 6428 290a 2020 2020 2020 2020 2020  ird().          
-0002c410: 2020 2320 7665 7273 696f 6e20 3320 7573    # version 3 us
-0002c420: 6520 6269 6f70 7974 686f 6e20 6e65 6564  e biopython need
-0002c430: 206d 6f72 6520 7465 7374 7320 616e 6420   more tests and 
-0002c440: 7468 656e 2064 656c 6574 6520 7468 6520  then delete the 
-0002c450: 6f74 6865 7220 7477 6f20 6162 6f76 650a  other two above.
-0002c460: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0002c470: 696e 7265 7375 6c74 203d 2073 656c 662e  inresult = self.
-0002c480: 5f5f 6e6e 6577 696e 7465 7274 6869 7264  __nnewinterthird
-0002c490: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
-0002c4a0: 746f 6d69 6e64 6963 7420 3d20 4f72 6465  tomindict = Orde
-0002c4b0: 7265 6444 6963 7428 290a 2020 2020 2020  redDict().      
-0002c4c0: 2020 2020 2020 7265 7369 6e64 6963 7420        resindict 
-0002c4d0: 3d20 4f72 6465 7265 6444 6963 7428 290a  = OrderedDict().
-0002c4e0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0002c4f0: 6469 6374 203d 204f 7264 6572 6564 4469  dict = OrderedDi
-0002c500: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
-0002c510: 2072 6573 6469 6374 203d 204f 7264 6572   resdict = Order
-0002c520: 6564 4469 6374 2829 0a20 2020 2020 2020  edDict().       
-0002c530: 2020 2020 2063 6f75 6e74 6572 203d 2030       counter = 0
-0002c540: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-0002c550: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
-0002c560: 2020 2020 2020 7265 7365 7272 6c69 7374        reserrlist
-0002c570: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0002c580: 2020 616c 6c6d 6f64 656c 735f 6e75 6d62    allmodels_numb
-0002c590: 6572 6174 6f6d 7320 3d20 300a 2020 2020  eratoms = 0.    
-0002c5a0: 2020 2020 2020 2020 616c 6c6d 6f64 656c          allmodel
-0002c5b0: 735f 6174 6f6d 5f69 6e63 6c75 7369 6f6e  s_atom_inclusion
-0002c5c0: 203d 2030 2e30 0a20 2020 2020 2020 2020   = 0.0.         
-0002c5d0: 2020 2066 6f72 206b 6579 2c20 7661 6c75     for key, valu
-0002c5e0: 6520 696e 2063 6f6d 6269 6e72 6573 756c  e in combinresul
-0002c5f0: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
-0002c600: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0002c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c620: 2020 2020 696e 7465 7270 6f6c 6174 696f      interpolatio
-0002c630: 6e73 2c20 616c 6c63 6f6e 746f 7572 7364  ns, allcontoursd
-0002c640: 6963 742c 2063 6861 696e 6169 7363 6f72  ict, chainaiscor
-0002c650: 652c 2061 746f 6d6f 7574 7369 6465 626f  e, atomoutsidebo
-0002c660: 7820 3d20 7661 6c75 650a 2020 2020 2020  x = value.      
-0002c670: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002c680: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-0002c690: 2e6d 6f64 656c 732c 206c 6973 7429 3a0a  .models, list):.
-0002c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c6b0: 2020 2020 2020 2020 6d6f 6465 6c73 203d          models =
-0002c6c0: 205b 6375 726d 6f64 656c 2066 6f72 2063   [curmodel for c
-0002c6d0: 7572 6d6f 6465 6c20 696e 2073 656c 662e  urmodel in self.
-0002c6e0: 6d6f 6465 6c73 2069 6620 6b65 7920 696e  models if key in
-0002c6f0: 2063 7572 6d6f 6465 6c2e 6669 6c65 6e61   curmodel.filena
-0002c700: 6d65 5d0a 2020 2020 2020 2020 2020 2020  me].            
-0002c710: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c730: 2020 2020 2020 6d6f 6465 6c73 203d 206c        models = l
-0002c740: 6973 7428 290a 2020 2020 2020 2020 2020  ist().          
-0002c750: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0002c760: 6465 6c73 2e61 7070 656e 6428 7365 6c66  dels.append(self
-0002c770: 2e6d 6f64 656c 7329 0a0a 2020 2020 2020  .models)..      
-0002c780: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002c790: 206c 656e 286d 6f64 656c 7329 203d 3d20   len(models) == 
-0002c7a0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0002c7b0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-0002c7c0: 203d 206d 6f64 656c 735b 305d 0a20 2020   = models[0].   
+0002bb70: 6f6e 2920 3e20 7365 6c66 2e63 6c29 202f  on) > self.cl) /
+0002bb80: 2066 6c6f 6174 286c 656e 286e 6577 696e   float(len(newin
+0002bb90: 7465 7270 6f6c 6174 696f 6e29 290a 0a20  terpolation)).. 
+0002bba0: 2020 2020 2020 2023 2046 756c 6c20 6174         # Full at
+0002bbb0: 6f6d 2069 6e63 6c75 7369 6f6e 0a20 2020  om inclusion.   
+0002bbc0: 2020 2020 2061 203d 205b 5d0a 2020 2020       a = [].    
+0002bbd0: 2020 2020 7465 6d70 6c69 7374 203d 206e      templist = n
+0002bbe0: 702e 6173 6172 7261 7928 6e65 7769 6e74  p.asarray(newint
+0002bbf0: 6572 706f 6c61 7469 6f6e 290a 2020 2020  erpolation).    
+0002bc00: 2020 2020 666f 7220 6920 696e 2062 696e      for i in bin
+0002bc10: 733a 0a20 2020 2020 2020 2020 2020 2078  s:.            x
+0002bc20: 203d 2073 756d 2874 656d 706c 6973 7420   = sum(templist 
+0002bc30: 3e20 6929 202f 2066 6c6f 6174 286c 656e  > i) / float(len
+0002bc40: 2874 656d 706c 6973 7429 290a 2020 2020  (templist)).    
+0002bc50: 2020 2020 2020 2020 612e 6170 7065 6e64          a.append
+0002bc60: 2878 290a 0a20 2020 2020 2020 2074 7261  (x)..        tra
+0002bc70: 6365 696e 7465 7220 3d20 5b5d 0a20 2020  ceinter = [].   
+0002bc80: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0002bc90: 6e67 6528 6c65 6e28 696e 7465 7270 6f6c  nge(len(interpol
+0002bca0: 6174 696f 6e29 293a 0a20 2020 2020 2020  ation)):.       
+0002bcb0: 2020 2020 2069 6620 286d 6f64 656c 5b69       if (model[i
+0002bcc0: 5d2e 6675 6c6c 6e61 6d65 203d 3d20 274e  ].fullname == 'N
+0002bcd0: 2720 6f72 206d 6f64 656c 5b69 5d2e 6675  ' or model[i].fu
+0002bce0: 6c6c 6e61 6d65 203d 3d20 2743 2720 6f72  llname == 'C' or
+0002bcf0: 206d 6f64 656c 5b69 5d2e 6675 6c6c 6e61   model[i].fullna
+0002bd00: 6d65 203d 3d20 274f 2720 6f72 0a20 2020  me == 'O' or.   
+0002bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd20: 206d 6f64 656c 5b69 5d2e 6675 6c6c 6e61   model[i].fullna
+0002bd30: 6d65 203d 3d20 2743 4127 206f 7220 6d6f  me == 'CA' or mo
+0002bd40: 6465 6c5b 695d 2e66 756c 6c6e 616d 6520  del[i].fullname 
+0002bd50: 3d3d 2022 4333 2722 206f 7220 6d6f 6465  == "C3'" or mode
+0002bd60: 6c5b 695d 2e66 756c 6c6e 616d 6520 3d3d  l[i].fullname ==
+0002bd70: 2022 4334 2722 206f 720a 2020 2020 2020   "C4'" or.      
+0002bd80: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0002bd90: 6465 6c5b 695d 2e66 756c 6c6e 616d 6520  del[i].fullname 
+0002bda0: 3d3d 2022 4335 2722 206f 7220 6d6f 6465  == "C5'" or mode
+0002bdb0: 6c5b 695d 2e66 756c 6c6e 616d 6520 3d3d  l[i].fullname ==
+0002bdc0: 2022 4f33 2722 206f 7220 6d6f 6465 6c5b   "O3'" or model[
+0002bdd0: 695d 2e66 756c 6c6e 616d 6520 3d3d 2022  i].fullname == "
+0002bde0: 4f35 2722 206f 720a 2020 2020 2020 2020  O5'" or.        
+0002bdf0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0002be00: 6c5b 695d 2e66 756c 6c6e 616d 6520 3d3d  l[i].fullname ==
+0002be10: 2027 5027 206f 7220 6d6f 6465 6c5b 695d   'P' or model[i]
+0002be20: 2e66 756c 6c6e 616d 6520 3d3d 2027 4f58  .fullname == 'OX
+0002be30: 5427 293a 0a20 2020 2020 2020 2020 2020  T'):.           
+0002be40: 2020 2020 2074 7261 6365 696e 7465 722e       traceinter.
+0002be50: 6170 7065 6e64 2869 6e74 6572 706f 6c61  append(interpola
+0002be60: 7469 6f6e 5b69 5d29 0a0a 2020 2020 2020  tion[i])..      
+0002be70: 2020 2320 4261 636b 626f 6e65 2069 6e63    # Backbone inc
+0002be80: 6c75 7369 6f6e 0a20 2020 2020 2020 2062  lusion.        b
+0002be90: 203d 205b 5d0a 2020 2020 2020 2020 7465   = [].        te
+0002bea0: 6d70 7472 6163 6569 6e74 6572 203d 206e  mptraceinter = n
+0002beb0: 702e 6173 6172 7261 7928 7472 6163 6569  p.asarray(tracei
+0002bec0: 6e74 6572 290a 2020 2020 2020 2020 666f  nter).        fo
+0002bed0: 7220 6a20 696e 2062 696e 733a 0a20 2020  r j in bins:.   
+0002bee0: 2020 2020 2020 2020 2079 203d 2073 756d           y = sum
+0002bef0: 2874 656d 7074 7261 6365 696e 7465 7220  (temptraceinter 
+0002bf00: 3e20 6a29 202f 2066 6c6f 6174 286c 656e  > j) / float(len
+0002bf10: 2874 656d 7074 7261 6365 696e 7465 7229  (temptraceinter)
+0002bf20: 290a 2020 2020 2020 2020 2020 2020 622e  ).            b.
+0002bf30: 6170 7065 6e64 2879 290a 0a20 2020 2020  append(y)..     
+0002bf40: 2020 2072 6574 7572 6e20 612c 2062 2c20     return a, b, 
+0002bf50: 656e 7469 7265 5f61 7665 7261 6765 2c20  entire_average, 
+0002bf60: 666c 6f61 7428 6c65 6e28 6e65 7769 6e74  float(len(newint
+0002bf70: 6572 706f 6c61 7469 6f6e 2929 0a0a 2020  erpolation))..  
+0002bf80: 2020 6465 6620 6169 5f62 6172 2873 656c    def ai_bar(sel
+0002bf90: 6629 3a0a 0a20 2020 2020 2020 2069 6620  f):..        if 
+0002bfa0: 6e6f 7420 7365 6c66 2e6f 6e6c 7962 6172  not self.onlybar
+0002bfb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0002bfc0: 6c66 2e61 746f 6d5f 696e 636c 7573 696f  lf.atom_inclusio
+0002bfd0: 6e28 290a 2020 2020 2020 2020 7365 6c66  n().        self
+0002bfe0: 2e67 6574 5f62 6172 2827 6174 6f6d 5f69  .get_bar('atom_i
+0002bff0: 6e63 6c75 7369 6f6e 2729 0a0a 2020 2020  nclusion')..    
+0002c000: 2320 4070 726f 6669 6c65 0a20 2020 2064  # @profile.    d
+0002c010: 6566 2061 746f 6d5f 696e 636c 7573 696f  ef atom_inclusio
+0002c020: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
+0002c030: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+0002c040: 2020 4765 6e65 7261 7465 2061 746f 6d20    Generate atom 
+0002c050: 696e 636c 7573 696f 6e20 616e 6420 7265  inclusion and re
+0002c060: 7369 6475 6520 6174 6f6d 2069 6e63 6c75  sidue atom inclu
+0002c070: 7369 6f6e 2069 6e66 6f72 6d61 7469 6f6e  sion information
+0002c080: 2076 6572 7365 7320 6469 6666 6572 656e   verses differen
+0002c090: 7420 636f 6e74 6f75 7220 6c65 7665 6c0a  t contour level.
+0002c0a0: 2020 2020 2020 2020 2020 2020 426f 7468              Both
+0002c0b0: 2066 756c 6c20 6174 6f6d 7320 616e 6420   full atoms and 
+0002c0c0: 6261 636b 626f 6e65 2069 6e66 6f72 6d61  backbone informa
+0002c0d0: 7469 6f6e 2061 7265 2069 6e63 6c75 6465  tion are include
+0002c0e0: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
+0002c0f0: 6573 756c 7473 2077 726f 7465 2074 6f20  esults wrote to 
+0002c100: 4a53 4f4e 2066 696c 650a 0a20 2020 2020  JSON file..     
+0002c110: 2020 203a 7265 7475 726e 3a20 4e6f 6e65     :return: None
+0002c120: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0002c130: 2020 2020 2020 6966 2073 656c 662e 6d6f        if self.mo
+0002c140: 6465 6c73 2069 7320 4e6f 6e65 3a0a 2020  dels is None:.  
+0002c150: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+0002c160: 6465 7272 2e77 7269 7465 2827 5245 4d49  derr.write('REMI
+0002c170: 4e44 4552 3a20 6174 6f6d 2069 6e63 6c75  NDER: atom inclu
+0002c180: 7369 6f6e 2061 6e64 2072 6573 6964 7565  sion and residue
+0002c190: 2069 6e63 6c75 7369 6f6e 2077 696c 6c20   inclusion will 
+0002c1a0: 6e6f 7420 6265 2063 616c 6375 6c61 7465  not be calculate
+0002c1b0: 6420 7769 7468 6f75 7420 270a 2020 2020  d without '.    
+0002c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c1d0: 2020 2020 2020 2020 2027 6d6f 6465 6c20           'model 
+0002c1e0: 7374 7275 6374 7572 652e 5c6e 2729 0a20  structure.\n'). 
+0002c1f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0002c200: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
+0002c210: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002c220: 2d2d 2d2d 2d2d 2729 0a20 2020 2020 2020  ------').       
+0002c230: 2065 6c69 6620 7365 6c66 2e63 6c20 6973   elif self.cl is
+0002c240: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002c250: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
+0002c260: 6974 6528 2752 454d 494e 4445 523a 2061  ite('REMINDER: a
+0002c270: 746f 6d20 696e 636c 7573 696f 6e20 616e  tom inclusion an
+0002c280: 6420 7265 7369 6475 6520 696e 636c 7573  d residue inclus
+0002c290: 696f 6e20 7769 6c6c 206e 6f74 2062 6520  ion will not be 
+0002c2a0: 6361 6c63 756c 6174 6564 2027 0a20 2020  calculated '.   
+0002c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c2c0: 2020 2020 2020 2020 2020 2777 6974 686f            'witho
+0002c2d0: 7574 2063 6f6e 746f 7572 206c 6576 656c  ut contour level
+0002c2e0: 2067 6976 656e 2e5c 6e27 290a 2020 2020   given.\n').    
+0002c2f0: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+0002c300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002c310: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002c320: 2d2d 2d27 290a 2020 2020 2020 2020 656c  ---').        el
+0002c330: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002c340: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+0002c350: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+0002c360: 2020 2020 2020 2020 2020 206d 6170 203d             map =
+0002c370: 2073 656c 662e 6d61 700a 0a20 2020 2020   self.map..     
+0002c380: 2020 2020 2020 2023 206d 6f64 656c 6e61         # modelna
+0002c390: 6d65 7320 3d20 5b20 6d6f 6465 6c2e 6669  mes = [ model.fi
+0002c3a0: 6c65 6e61 6d65 2066 6f72 206d 6f64 656c  lename for model
+0002c3b0: 2069 6e20 7365 6c66 2e6d 6f64 656c 7320   in self.models 
+0002c3c0: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+0002c3d0: 7665 7273 696f 6e20 3120 7573 6520 7465  version 1 use te
+0002c3e0: 6d70 790a 2020 2020 2020 2020 2020 2020  mpy.            
+0002c3f0: 2320 636f 6d62 696e 7265 7375 6c74 203d  # combinresult =
+0002c400: 2073 656c 662e 5f5f 696e 7465 7274 6869   self.__interthi
+0002c410: 7264 2829 0a20 2020 2020 2020 2020 2020  rd().           
+0002c420: 2023 2076 6572 7369 6f6e 2032 2075 7365   # version 2 use
+0002c430: 2062 696f 7079 7468 6f6e 2062 7574 206e   biopython but n
+0002c440: 6f74 206f 7074 6d69 7365 6420 666f 7220  ot optmised for 
+0002c450: 6269 6f70 7974 686f 6e0a 2020 2020 2020  biopython.      
+0002c460: 2020 2020 2020 2320 636f 6d62 696e 7265        # combinre
+0002c470: 7375 6c74 203d 2073 656c 662e 5f5f 6e65  sult = self.__ne
+0002c480: 7769 6e74 6572 7468 6972 6428 290a 2020  winterthird().  
+0002c490: 2020 2020 2020 2020 2020 2320 7665 7273            # vers
+0002c4a0: 696f 6e20 3320 7573 6520 6269 6f70 7974  ion 3 use biopyt
+0002c4b0: 686f 6e20 6e65 6564 206d 6f72 6520 7465  hon need more te
+0002c4c0: 7374 7320 616e 6420 7468 656e 2064 656c  sts and then del
+0002c4d0: 6574 6520 7468 6520 6f74 6865 7220 7477  ete the other tw
+0002c4e0: 6f20 6162 6f76 650a 2020 2020 2020 2020  o above.        
+0002c4f0: 2020 2020 636f 6d62 696e 7265 7375 6c74      combinresult
+0002c500: 203d 2073 656c 662e 5f5f 6e6e 6577 696e   = self.__nnewin
+0002c510: 7465 7274 6869 7264 2829 0a20 2020 2020  terthird().     
+0002c520: 2020 2020 2020 2061 746f 6d69 6e64 6963         atomindic
+0002c530: 7420 3d20 4f72 6465 7265 6444 6963 7428  t = OrderedDict(
+0002c540: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0002c550: 7369 6e64 6963 7420 3d20 4f72 6465 7265  sindict = Ordere
+0002c560: 6444 6963 7428 290a 2020 2020 2020 2020  dDict().        
+0002c570: 2020 2020 6461 7461 6469 6374 203d 204f      datadict = O
+0002c580: 7264 6572 6564 4469 6374 2829 0a20 2020  rderedDict().   
+0002c590: 2020 2020 2020 2020 2072 6573 6469 6374           resdict
+0002c5a0: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
+0002c5b0: 0a20 2020 2020 2020 2020 2020 2063 6f75  .            cou
+0002c5c0: 6e74 6572 203d 2030 0a20 2020 2020 2020  nter = 0.       
+0002c5d0: 2020 2020 2065 7272 6c69 7374 203d 205b       errlist = [
+0002c5e0: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
+0002c5f0: 7365 7272 6c69 7374 203d 205b 5d0a 2020  serrlist = [].  
+0002c600: 2020 2020 2020 2020 2020 616c 6c6d 6f64            allmod
+0002c610: 656c 735f 6e75 6d62 6572 6174 6f6d 7320  els_numberatoms 
+0002c620: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0002c630: 616c 6c6d 6f64 656c 735f 6174 6f6d 5f69  allmodels_atom_i
+0002c640: 6e63 6c75 7369 6f6e 203d 2030 2e30 0a20  nclusion = 0.0. 
+0002c650: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0002c660: 6579 2c20 7661 6c75 6520 696e 2063 6f6d  ey, value in com
+0002c670: 6269 6e72 6573 756c 742e 6974 656d 7328  binresult.items(
+0002c680: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002c690: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0002c6a0: 2020 2020 2020 2020 2020 2020 696e 7465              inte
+0002c6b0: 7270 6f6c 6174 696f 6e73 2c20 616c 6c63  rpolations, allc
+0002c6c0: 6f6e 746f 7572 7364 6963 742c 2063 6861  ontoursdict, cha
+0002c6d0: 696e 6169 7363 6f72 652c 2061 746f 6d6f  inaiscore, atomo
+0002c6e0: 7574 7369 6465 626f 7820 3d20 7661 6c75  utsidebox = valu
+0002c6f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0002c700: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0002c710: 6e63 6528 7365 6c66 2e6d 6f64 656c 732c  nce(self.models,
+0002c720: 206c 6973 7429 3a0a 2020 2020 2020 2020   list):.        
+0002c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c740: 6d6f 6465 6c73 203d 205b 6375 726d 6f64  models = [curmod
+0002c750: 656c 2066 6f72 2063 7572 6d6f 6465 6c20  el for curmodel 
+0002c760: 696e 2073 656c 662e 6d6f 6465 6c73 2069  in self.models i
+0002c770: 6620 6b65 7920 696e 2063 7572 6d6f 6465  f key in curmode
+0002c780: 6c2e 6669 6c65 6e61 6d65 5d0a 2020 2020  l.filename].    
+0002c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c7a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002c7b0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0002c7c0: 6465 6c73 203d 206c 6973 7428 290a 2020  dels = list().  
 0002c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c7e0: 2065 6c69 6620 6c65 6e28 6d6f 6465 6c73   elif len(models
-0002c7f0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0002c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c810: 7072 696e 7428 2754 6865 7265 2069 7320  print('There is 
-0002c820: 6e6f 206d 6f64 656c 2127 290a 2020 2020  no model!').    
+0002c7e0: 2020 2020 2020 6d6f 6465 6c73 2e61 7070        models.app
+0002c7f0: 656e 6428 7365 6c66 2e6d 6f64 656c 7329  end(self.models)
+0002c800: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002c810: 2020 2020 2020 6966 206c 656e 286d 6f64        if len(mod
+0002c820: 656c 7329 203d 3d20 313a 0a20 2020 2020  els) == 1:.     
 0002c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c840: 2020 2020 6578 6974 2829 0a20 2020 2020      exit().     
-0002c850: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002c860: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002c870: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0002c880: 6e74 2827 5468 6572 6520 6172 6520 6d6f  nt('There are mo
-0002c890: 7265 2074 6861 6e20 6f6e 6520 6d6f 6465  re than one mode
-0002c8a0: 6c20 7768 6963 6820 7368 6f75 6c64 2062  l which should b
-0002c8b0: 6520 6f6e 6c79 206f 6e65 2e27 290a 2020  e only one.').  
-0002c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c8d0: 2020 2020 2020 6578 6974 2829 0a0a 2020        exit()..  
-0002c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c8f0: 2020 616c 6c61 746f 6d73 203d 206c 6973    allatoms = lis
-0002c900: 7428 6d6f 6465 6c2e 6765 745f 6174 6f6d  t(model.get_atom
-0002c910: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-0002c920: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-0002c930: 3d20 7365 6c66 2e5f 5f67 6574 6672 6163  = self.__getfrac
-0002c940: 7469 6f6e 7328 696e 7465 7270 6f6c 6174  tions(interpolat
-0002c950: 696f 6e73 2c20 616c 6c61 746f 6d73 290a  ions, allatoms).
-0002c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c970: 2020 2020 6c65 7665 6c73 203d 206e 702e      levels = np.
-0002c980: 6c69 6e73 7061 6365 286d 6170 2e64 6174  linspace(map.dat
-0002c990: 612e 6d69 6e28 292c 206d 6170 2e64 6174  a.min(), map.dat
-0002c9a0: 612e 6d61 7828 292c 2031 3239 290a 0a20  a.max(), 129).. 
-0002c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c9c0: 2020 2062 696e 6c69 7374 203d 206c 6576     binlist = lev
-0002c9d0: 656c 732e 746f 6c69 7374 2829 0a20 2020  els.tolist().   
-0002c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c9f0: 2062 6973 6563 742e 696e 736f 7274 2862   bisect.insort(b
-0002ca00: 696e 6c69 7374 2c20 7365 6c66 2e63 6c29  inlist, self.cl)
-0002ca10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ca20: 2020 2020 2063 6c69 6e64 6578 203d 2062       clindex = b
-0002ca30: 696e 6c69 7374 2e69 6e64 6578 2873 656c  inlist.index(sel
-0002ca40: 662e 636c 290a 2020 2020 2020 2020 2020  f.cl).          
-0002ca50: 2020 2020 2020 2020 2020 6269 6e6c 6973            binlis
-0002ca60: 742e 706f 7028 636c 696e 6465 7820 2d20  t.pop(clindex - 
-0002ca70: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-0002ca80: 2020 2020 2020 206c 6576 656c 7320 3d20         levels = 
-0002ca90: 6e70 2e61 7361 7272 6179 2862 696e 6c69  np.asarray(binli
-0002caa0: 7374 290a 0a20 2020 2020 2020 2020 2020  st)..           
-0002cab0: 2020 2020 2020 2020 2023 2073 636f 7265           # score
-0002cac0: 5f74 7970 6520 3d20 2761 6927 0a20 2020  _type = 'ai'.   
+0002c840: 2020 206d 6f64 656c 203d 206d 6f64 656c     model = model
+0002c850: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+0002c860: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
+0002c870: 6e28 6d6f 6465 6c73 2920 3d3d 2030 3a0a  n(models) == 0:.
+0002c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c890: 2020 2020 2020 2020 7072 696e 7428 2754          print('T
+0002c8a0: 6865 7265 2069 7320 6e6f 206d 6f64 656c  here is no model
+0002c8b0: 2127 290a 2020 2020 2020 2020 2020 2020  !').            
+0002c8c0: 2020 2020 2020 2020 2020 2020 6578 6974              exit
+0002c8d0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0002c8e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c900: 2020 2020 2070 7269 6e74 2827 5468 6572       print('Ther
+0002c910: 6520 6172 6520 6d6f 7265 2074 6861 6e20  e are more than 
+0002c920: 6f6e 6520 6d6f 6465 6c20 7768 6963 6820  one model which 
+0002c930: 7368 6f75 6c64 2062 6520 6f6e 6c79 206f  should be only o
+0002c940: 6e65 2e27 290a 2020 2020 2020 2020 2020  ne.').          
+0002c950: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0002c960: 6974 2829 0a0a 2020 2020 2020 2020 2020  it()..          
+0002c970: 2020 2020 2020 2020 2020 616c 6c61 746f            allato
+0002c980: 6d73 203d 206c 6973 7428 6d6f 6465 6c2e  ms = list(model.
+0002c990: 6765 745f 6174 6f6d 7328 2929 0a20 2020  get_atoms()).   
+0002c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c9b0: 2072 6573 756c 7420 3d20 7365 6c66 2e5f   result = self._
+0002c9c0: 5f67 6574 6672 6163 7469 6f6e 7328 696e  _getfractions(in
+0002c9d0: 7465 7270 6f6c 6174 696f 6e73 2c20 616c  terpolations, al
+0002c9e0: 6c61 746f 6d73 290a 2020 2020 2020 2020  latoms).        
+0002c9f0: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
+0002ca00: 6c73 203d 206e 702e 6c69 6e73 7061 6365  ls = np.linspace
+0002ca10: 286d 6170 2e64 6174 612e 6d69 6e28 292c  (map.data.min(),
+0002ca20: 206d 6170 2e64 6174 612e 6d61 7828 292c   map.data.max(),
+0002ca30: 2031 3239 290a 0a20 2020 2020 2020 2020   129)..         
+0002ca40: 2020 2020 2020 2020 2020 2062 696e 6c69             binli
+0002ca50: 7374 203d 206c 6576 656c 732e 746f 6c69  st = levels.toli
+0002ca60: 7374 2829 0a20 2020 2020 2020 2020 2020  st().           
+0002ca70: 2020 2020 2020 2020 2062 6973 6563 742e           bisect.
+0002ca80: 696e 736f 7274 2862 696e 6c69 7374 2c20  insort(binlist, 
+0002ca90: 7365 6c66 2e63 6c29 0a20 2020 2020 2020  self.cl).       
+0002caa0: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+0002cab0: 6e64 6578 203d 2062 696e 6c69 7374 2e69  ndex = binlist.i
+0002cac0: 6e64 6578 2873 656c 662e 636c 290a 2020  ndex(self.cl).  
 0002cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cae0: 2023 206e 6577 5f64 6963 7420 3d20 7b27   # new_dict = {'
-0002caf0: 6964 273a 2073 656c 662e 656d 6469 642c  id': self.emdid,
-0002cb00: 2027 7265 736f 6c75 7469 6f6e 273a 2066   'resolution': f
-0002cb10: 6c6f 6174 2873 656c 662e 7265 736f 6c75  loat(self.resolu
-0002cb20: 7469 6f6e 292c 2027 6e61 6d65 273a 206b  tion), 'name': k
-0002cb30: 6579 2c0a 2020 2020 2020 2020 2020 2020  ey,.            
-0002cb40: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-0002cb50: 2020 2020 2020 7363 6f72 655f 7479 7065        score_type
-0002cb60: 3a20 726f 756e 6428 7265 7375 6c74 5b32  : round(result[2
-0002cb70: 5d2c 2033 297d 0a20 2020 2020 2020 2020  ], 3)}.         
-0002cb80: 2020 2020 2020 2020 2020 2023 2070 6c6f             # plo
-0002cb90: 745f 6e61 6d65 203d 2027 7b7d 5f7b 7d5f  t_name = '{}_{}_
-0002cba0: 7b7d 5f62 6172 2e70 6e67 272e 666f 726d  {}_bar.png'.form
-0002cbb0: 6174 2873 656c 662e 6d61 706e 616d 652c  at(self.mapname,
-0002cbc0: 206b 6579 2c20 7363 6f72 655f 7479 7065   key, score_type
-0002cbd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002cbe0: 2020 2020 2020 2320 7363 6f72 655f 6469        # score_di
-0002cbf0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-0002cc00: 616d 6528 7661 2e5f 5f66 696c 655f 5f29  ame(va.__file__)
-0002cc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cc20: 2020 2020 2023 2072 656c 6174 6976 655f       # relative_
-0002cc30: 746f 7768 6f6c 652c 2072 656c 6174 6976  towhole, relativ
-0002cc40: 655f 746f 7477 6f20 3d20 6261 7228 6e65  e_totwo = bar(ne
-0002cc50: 775f 6469 6374 2c20 7363 6f72 655f 7479  w_dict, score_ty
-0002cc60: 7065 2c20 7365 6c66 2e77 6f72 6b64 6972  pe, self.workdir
-0002cc70: 2c20 7363 6f72 655f 6469 722c 2070 6c6f  , score_dir, plo
-0002cc80: 745f 6e61 6d65 290a 2020 2020 2020 2020  t_name).        
-0002cc90: 2020 2020 2020 2020 2020 2020 2320 6169              # ai
-0002cca0: 6261 7220 3d20 7b27 7768 6f6c 6527 3a20  bar = {'whole': 
-0002ccb0: 7265 6c61 7469 7665 5f74 6f77 686f 6c65  relative_towhole
-0002ccc0: 2c20 2772 656c 6174 6976 6527 3a20 7265  , 'relative': re
-0002ccd0: 6c61 7469 7665 5f74 6f74 776f 7d0a 0a20  lative_totwo}.. 
-0002cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ccf0: 2020 2064 6174 6164 6963 745b 7374 7228     datadict[str(
-0002cd00: 636f 756e 7465 7229 5d20 3d20 7b27 6e61  counter)] = {'na
-0002cd10: 6d65 273a 206b 6579 2c20 276c 6576 656c  me': key, 'level
-0002cd20: 273a 205b 726f 756e 6428 656c 656d 2c20  ': [round(elem, 
-0002cd30: 3629 2066 6f72 2065 6c65 6d20 696e 206c  6) for elem in l
-0002cd40: 6576 656c 732e 746f 6c69 7374 2829 5d2c  evels.tolist()],
-0002cd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0002cd80: 616c 6c5f 6174 6f6d 273a 205b 726f 756e  all_atom': [roun
-0002cd90: 6428 656c 656d 2c20 3329 2066 6f72 2065  d(elem, 3) for e
-0002cda0: 6c65 6d20 696e 2072 6573 756c 745b 305d  lem in result[0]
-0002cdb0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0002cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cde0: 2027 6261 636b 626f 6e65 273a 205b 726f   'backbone': [ro
-0002cdf0: 756e 6428 656c 656d 2c20 3329 2066 6f72  und(elem, 3) for
-0002ce00: 2065 6c65 6d20 696e 2072 6573 756c 745b   elem in result[
-0002ce10: 315d 5d2c 0a20 2020 2020 2020 2020 2020  1]],.           
-0002ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce40: 2020 2027 6174 6f6d 6f75 7473 6964 6527     'atomoutside'
-0002ce50: 3a20 6174 6f6d 6f75 7473 6964 6562 6f78  : atomoutsidebox
-0002ce60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce90: 2763 6861 696e 6169 7363 6f72 6527 3a20  'chainaiscore': 
-0002cea0: 6368 6169 6e61 6973 636f 7265 2c0a 2020  chainaiscore,.  
+0002cae0: 2020 6269 6e6c 6973 742e 706f 7028 636c    binlist.pop(cl
+0002caf0: 696e 6465 7820 2d20 3129 0a20 2020 2020  index - 1).     
+0002cb00: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0002cb10: 6576 656c 7320 3d20 6e70 2e61 7361 7272  evels = np.asarr
+0002cb20: 6179 2862 696e 6c69 7374 290a 0a20 2020  ay(binlist)..   
+0002cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cb40: 2023 2073 636f 7265 5f74 7970 6520 3d20   # score_type = 
+0002cb50: 2761 6927 0a20 2020 2020 2020 2020 2020  'ai'.           
+0002cb60: 2020 2020 2020 2020 2023 206e 6577 5f64           # new_d
+0002cb70: 6963 7420 3d20 7b27 6964 273a 2073 656c  ict = {'id': sel
+0002cb80: 662e 656d 6469 642c 2027 7265 736f 6c75  f.emdid, 'resolu
+0002cb90: 7469 6f6e 273a 2066 6c6f 6174 2873 656c  tion': float(sel
+0002cba0: 662e 7265 736f 6c75 7469 6f6e 292c 2027  f.resolution), '
+0002cbb0: 6e61 6d65 273a 206b 6579 2c0a 2020 2020  name': key,.    
+0002cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cbd0: 2320 2020 2020 2020 2020 2020 2020 7363  #             sc
+0002cbe0: 6f72 655f 7479 7065 3a20 726f 756e 6428  ore_type: round(
+0002cbf0: 7265 7375 6c74 5b32 5d2c 2033 297d 0a20  result[2], 3)}. 
+0002cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc10: 2020 2023 2070 6c6f 745f 6e61 6d65 203d     # plot_name =
+0002cc20: 2027 7b7d 5f7b 7d5f 7b7d 5f62 6172 2e70   '{}_{}_{}_bar.p
+0002cc30: 6e67 272e 666f 726d 6174 2873 656c 662e  ng'.format(self.
+0002cc40: 6d61 706e 616d 652c 206b 6579 2c20 7363  mapname, key, sc
+0002cc50: 6f72 655f 7479 7065 290a 2020 2020 2020  ore_type).      
+0002cc60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0002cc70: 7363 6f72 655f 6469 7220 3d20 6f73 2e70  score_dir = os.p
+0002cc80: 6174 682e 6469 726e 616d 6528 7661 2e5f  ath.dirname(va._
+0002cc90: 5f66 696c 655f 5f29 0a20 2020 2020 2020  _file__).       
+0002cca0: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+0002ccb0: 656c 6174 6976 655f 746f 7768 6f6c 652c  elative_towhole,
+0002ccc0: 2072 656c 6174 6976 655f 746f 7477 6f20   relative_totwo 
+0002ccd0: 3d20 6261 7228 6e65 775f 6469 6374 2c20  = bar(new_dict, 
+0002cce0: 7363 6f72 655f 7479 7065 2c20 7365 6c66  score_type, self
+0002ccf0: 2e77 6f72 6b64 6972 2c20 7363 6f72 655f  .workdir, score_
+0002cd00: 6469 722c 2070 6c6f 745f 6e61 6d65 290a  dir, plot_name).
+0002cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd20: 2020 2020 2320 6169 6261 7220 3d20 7b27      # aibar = {'
+0002cd30: 7768 6f6c 6527 3a20 7265 6c61 7469 7665  whole': relative
+0002cd40: 5f74 6f77 686f 6c65 2c20 2772 656c 6174  _towhole, 'relat
+0002cd50: 6976 6527 3a20 7265 6c61 7469 7665 5f74  ive': relative_t
+0002cd60: 6f74 776f 7d0a 0a20 2020 2020 2020 2020  otwo}..         
+0002cd70: 2020 2020 2020 2020 2020 2064 6174 6164             datad
+0002cd80: 6963 745b 7374 7228 636f 756e 7465 7229  ict[str(counter)
+0002cd90: 5d20 3d20 7b27 6e61 6d65 273a 206b 6579  ] = {'name': key
+0002cda0: 2c20 276c 6576 656c 273a 205b 726f 756e  , 'level': [roun
+0002cdb0: 6428 656c 656d 2c20 3629 2066 6f72 2065  d(elem, 6) for e
+0002cdc0: 6c65 6d20 696e 206c 6576 656c 732e 746f  lem in levels.to
+0002cdd0: 6c69 7374 2829 5d2c 0a20 2020 2020 2020  list()],.       
+0002cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce00: 2020 2020 2020 2027 616c 6c5f 6174 6f6d         'all_atom
+0002ce10: 273a 205b 726f 756e 6428 656c 656d 2c20  ': [round(elem, 
+0002ce20: 3329 2066 6f72 2065 6c65 6d20 696e 2072  3) for elem in r
+0002ce30: 6573 756c 745b 305d 5d2c 0a20 2020 2020  esult[0]],.     
+0002ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce60: 2020 2020 2020 2020 2027 6261 636b 626f           'backbo
+0002ce70: 6e65 273a 205b 726f 756e 6428 656c 656d  ne': [round(elem
+0002ce80: 2c20 3329 2066 6f72 2065 6c65 6d20 696e  , 3) for elem in
+0002ce90: 2072 6573 756c 745b 315d 5d2c 0a20 2020   result[1]],.   
+0002cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ced0: 2020 2020 2020 2020 2020 2020 2774 6f74              'tot
-0002cee0: 616c 4e75 6d62 6572 4f66 4174 6f6d 7327  alNumberOfAtoms'
-0002cef0: 3a20 696e 7428 7265 7375 6c74 5b33 5d29  : int(result[3])
-0002cf00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf30: 2761 7665 7261 6765 5f61 695f 6d6f 6465  'average_ai_mode
-0002cf40: 6c27 3a20 726f 756e 6428 7265 7375 6c74  l': round(result
-0002cf50: 5b32 5d2c 2033 292c 0a20 2020 2020 2020  [2], 3),.       
-0002cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf80: 2020 2020 2020 2027 6176 6572 6167 655f         'average_
-0002cf90: 6169 5f63 6f6c 6f72 273a 2073 656c 662e  ai_color': self.
-0002cfa0: 5f5f 666c 6f61 746f 6865 7828 5b72 6f75  __floatohex([rou
-0002cfb0: 6e64 2872 6573 756c 745b 325d 2c20 3629  nd(result[2], 6)
-0002cfc0: 5d29 5b30 5d2c 0a20 2020 2020 2020 2020  ])[0],.         
-0002cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cff0: 2020 2020 2023 2027 6169 5f62 6172 273a       # 'ai_bar':
-0002d000: 2061 6962 6172 0a20 2020 2020 2020 2020   aibar.         
-0002d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d030: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-0002d040: 2020 2020 2020 2020 2020 2061 6c6c 6d6f             allmo
-0002d050: 6465 6c73 5f6e 756d 6265 7261 746f 6d73  dels_numberatoms
-0002d060: 202b 3d20 696e 7428 7265 7375 6c74 5b33   += int(result[3
-0002d070: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0002d080: 2020 2020 2020 2061 6c6c 6d6f 6465 6c73         allmodels
-0002d090: 5f61 746f 6d5f 696e 636c 7573 696f 6e20  _atom_inclusion 
-0002d0a0: 2b3d 2072 6573 756c 745b 335d 2a72 6573  += result[3]*res
-0002d0b0: 756c 745b 325d 0a0a 2020 2020 2020 2020  ult[2]..        
-0002d0c0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0002d0d0: 5f6c 656e 203d 206c 656e 286c 6576 656c  _len = len(level
-0002d0e0: 732e 746f 6c69 7374 2829 290a 2020 2020  s.tolist()).    
-0002d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d100: 706c 742e 706c 6f74 285b 726f 756e 6428  plt.plot([round(
-0002d110: 656c 656d 2c20 3130 2920 666f 7220 656c  elem, 10) for el
-0002d120: 656d 2069 6e20 6c65 7665 6c73 2e74 6f6c  em in levels.tol
-0002d130: 6973 7428 295d 2c20 5b72 6f75 6e64 2865  ist()], [round(e
-0002d140: 6c65 6d2c 2031 3029 2066 6f72 2065 6c65  lem, 10) for ele
-0002d150: 6d20 696e 2072 6573 756c 745b 305d 5d2c  m in result[0]],
-0002d160: 2027 2d67 272c 206c 6162 656c 3d27 4675   '-g', label='Fu
-0002d170: 6c6c 2061 746f 6d27 290a 2020 2020 2020  ll atom').      
-0002d180: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-0002d190: 742e 706c 6f74 285b 726f 756e 6428 656c  t.plot([round(el
-0002d1a0: 656d 2c20 3130 2920 666f 7220 656c 656d  em, 10) for elem
-0002d1b0: 2069 6e20 6c65 7665 6c73 2e74 6f6c 6973   in levels.tolis
-0002d1c0: 7428 295d 2c20 5b72 6f75 6e64 2865 6c65  t()], [round(ele
-0002d1d0: 6d2c 2031 3029 2066 6f72 2065 6c65 6d20  m, 10) for elem 
-0002d1e0: 696e 2072 6573 756c 745b 315d 5d2c 2027  in result[1]], '
-0002d1f0: 2d62 272c 206c 6162 656c 3d27 4261 636b  -b', label='Back
-0002d200: 626f 6e65 2729 0a20 2020 2020 2020 2020  bone').         
-0002d210: 2020 2020 2020 2020 2020 2070 6c74 2e70             plt.p
-0002d220: 6c6f 7428 6461 7461 5f6c 656e 202a 205b  lot(data_len * [
-0002d230: 7365 6c66 2e63 6c5d 2c20 6e70 2e6c 696e  self.cl], np.lin
-0002d240: 7370 6163 6528 302c 2031 2c20 6461 7461  space(0, 1, data
-0002d250: 5f6c 656e 292c 2027 2d72 272c 206c 6162  _len), '-r', lab
-0002d260: 656c 3d27 5265 636f 6d6d 656e 6465 6420  el='Recommended 
-0002d270: 636f 6e74 6f75 7220 6c65 7665 6c27 290a  contour level').
-0002d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d290: 2020 2020 706c 742e 6c65 6765 6e64 286c      plt.legend(l
-0002d2a0: 6f63 3d27 6c6f 7765 7220 6c65 6674 2729  oc='lower left')
-0002d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d2c0: 2020 2020 2070 6c74 2e73 6176 6566 6967       plt.savefig
-0002d2d0: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
-0002d2e0: 7365 6c66 2e6d 6170 6e61 6d65 202b 2027  self.mapname + '
-0002d2f0: 5f69 6e63 6c75 7369 6f6e 2e70 6e67 2729  _inclusion.png')
-0002d300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d310: 2020 2020 2070 6c74 2e63 6c6f 7365 2829       plt.close()
-0002d320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d330: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-0002d340: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0002d350: 203d 2027 4174 6f6d 2069 6e63 6c75 7369   = 'Atom inclusi
-0002d360: 6f6e 2063 616c 6375 6c61 7469 6f6e 2065  on calculation e
-0002d370: 7272 6f72 284d 6f64 656c 3a20 7b7d 293a  rror(Model: {}):
-0002d380: 207b 7d2e 272e 666f 726d 6174 286b 6579   {}.'.format(key
-0002d390: 2c20 7379 732e 6578 635f 696e 666f 2829  , sys.exc_info()
-0002d3a0: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-0002d3b0: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
-0002d3c0: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
-0002d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d3e0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-0002d3f0: 6528 6572 7220 2b20 275c 6e27 290a 2020  e(err + '\n').  
-0002d400: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002d410: 2065 7272 6c69 7374 3a0a 2020 2020 2020   errlist:.      
-0002d420: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0002d430: 7461 6469 6374 5b73 7472 2863 6f75 6e74  tadict[str(count
-0002d440: 6572 295d 203d 207b 2765 7272 273a 207b  er)] = {'err': {
-0002d450: 2761 746f 6d5f 696e 636c 7573 696f 6e5f  'atom_inclusion_
-0002d460: 6572 7227 3a20 6572 726c 6973 747d 7d0a  err': errlist}}.
-0002d470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d480: 2063 6f6e 746f 7572 6469 6374 203d 204f   contourdict = O
-0002d490: 7264 6572 6564 4469 6374 2829 0a20 2020  rderedDict().   
-0002d4a0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0002d4b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002d4c0: 2020 2020 2020 666f 7220 636f 6e74 6f75        for contou
-0002d4d0: 722c 206b 6579 7376 616c 7565 7320 696e  r, keysvalues in
-0002d4e0: 2061 6c6c 636f 6e74 6f75 7273 6469 6374   allcontoursdict
-0002d4f0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0002d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d510: 2020 616c 6c76 616c 7565 7320 3d20 6b65    allvalues = ke
-0002d520: 7973 7661 6c75 6573 5b31 5d0a 2020 2020  ysvalues[1].    
-0002d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d540: 2020 2020 616c 6c6b 6579 7320 3d20 6b65      allkeys = ke
-0002d550: 7973 7661 6c75 6573 5b30 5d0a 2020 2020  ysvalues[0].    
-0002d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d570: 2020 2020 636f 6c6f 7572 7320 3d20 7365      colours = se
-0002d580: 6c66 2e5f 5f66 6c6f 6174 6f68 6578 2861  lf.__floatohex(a
-0002d590: 6c6c 7661 6c75 6573 290a 2020 2020 2020  llvalues).      
-0002d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d5b0: 2020 636f 6e74 6f75 726b 6579 203d 2073    contourkey = s
-0002d5c0: 7472 2872 6f75 6e64 2866 6c6f 6174 2863  tr(round(float(c
-0002d5d0: 6f6e 746f 7572 292c 2036 2929 0a20 2020  ontour), 6)).   
-0002d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d5f0: 2020 2020 2063 6f6e 746f 7572 6469 6374       contourdict
-0002d600: 5b63 6f6e 746f 7572 6b65 795d 203d 204f  [contourkey] = O
-0002d610: 7264 6572 6564 4469 6374 285b 2827 636f  rderedDict([('co
-0002d620: 6c6f 7227 2c20 636f 6c6f 7572 7329 2c20  lor', colours), 
-0002d630: 2827 696e 636c 7573 696f 6e27 2c20 616c  ('inclusion', al
-0002d640: 6c76 616c 7565 7329 2c0a 2020 2020 2020  lvalues),.      
-0002d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d680: 2020 2020 2020 2020 2028 2772 6573 6964           ('resid
-0002d690: 7565 272c 2061 6c6c 6b65 7973 295d 290a  ue', allkeys)]).
-0002d6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d6b0: 2020 2020 2063 6f6e 746f 7572 6469 6374       contourdict
-0002d6c0: 5b27 6e61 6d65 275d 203d 206b 6579 0a20  ['name'] = key. 
-0002d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d6e0: 2020 2072 6573 6469 6374 5b73 7472 2863     resdict[str(c
-0002d6f0: 6f75 6e74 6572 295d 203d 2063 6f6e 746f  ounter)] = conto
-0002d700: 7572 6469 6374 0a20 2020 2020 2020 2020  urdict.         
-0002d710: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-0002d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d730: 2020 2065 7272 203d 2027 5265 7369 6475     err = 'Residu
-0002d740: 6520 696e 636c 7573 696f 6e20 6361 6c63  e inclusion calc
-0002d750: 756c 6174 696f 6e20 6572 726f 7228 4d6f  ulation error(Mo
-0002d760: 6465 6c3a 207b 7d29 3a20 7b7d 2e27 2e66  del: {}): {}.'.f
-0002d770: 6f72 6d61 7428 6b65 792c 2073 7973 2e65  ormat(key, sys.e
-0002d780: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-0002d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d7a0: 2020 7265 7365 7272 6c69 7374 2e61 7070    reserrlist.app
-0002d7b0: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
-0002d7c0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0002d7d0: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
-0002d7e0: 7220 2b20 275c 6e27 290a 2020 2020 2020  r + '\n').      
-0002d7f0: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-0002d800: 6572 726c 6973 743a 0a20 2020 2020 2020  errlist:.       
-0002d810: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0002d820: 6469 6374 5b73 7472 2863 6f75 6e74 6572  dict[str(counter
-0002d830: 295d 203d 207b 2765 7272 273a 207b 2772  )] = {'err': {'r
-0002d840: 6573 6964 7565 5f69 6e63 6c75 7369 6f6e  esidue_inclusion
-0002d850: 5f65 7272 273a 2072 6573 6572 726c 6973  _err': reserrlis
-0002d860: 747d 7d0a 2020 2020 2020 2020 2020 2020  t}}.            
-0002d870: 2020 2020 636f 756e 7465 7220 2b3d 2031      counter += 1
-0002d880: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0002d890: 2061 6c6c 6d6f 6465 6c73 5f6e 756d 6265   allmodels_numbe
-0002d8a0: 7261 746f 6d73 2021 3d20 303a 0a20 2020  ratoms != 0:.   
-0002d8b0: 2020 2020 2020 2020 2020 2020 2061 7665               ave
-0002d8c0: 7261 6765 5f61 695f 616c 6c6d 6f64 656c  rage_ai_allmodel
-0002d8d0: 7320 3d20 616c 6c6d 6f64 656c 735f 6174  s = allmodels_at
-0002d8e0: 6f6d 5f69 6e63 6c75 7369 6f6e 202f 2061  om_inclusion / a
-0002d8f0: 6c6c 6d6f 6465 6c73 5f6e 756d 6265 7261  llmodels_numbera
-0002d900: 746f 6d73 0a20 2020 2020 2020 2020 2020  toms.           
-0002d910: 2020 2020 2064 6174 6164 6963 745b 2761       datadict['a
-0002d920: 7665 7261 6765 5f61 695f 616c 6c6d 6f64  verage_ai_allmod
-0002d930: 656c 7327 5d20 3d20 726f 756e 6428 6176  els'] = round(av
-0002d940: 6572 6167 655f 6169 5f61 6c6c 6d6f 6465  erage_ai_allmode
-0002d950: 6c73 2c20 3329 0a20 2020 2020 2020 2020  ls, 3).         
-0002d960: 2020 2061 746f 6d69 6e64 6963 745b 2761     atomindict['a
-0002d970: 746f 6d5f 696e 636c 7573 696f 6e5f 6279  tom_inclusion_by
-0002d980: 5f6c 6576 656c 275d 203d 2064 6174 6164  _level'] = datad
-0002d990: 6963 740a 2020 2020 2020 2020 2020 2020  ict.            
-0002d9a0: 7265 7369 6e64 6963 745b 2772 6573 6964  resindict['resid
-0002d9b0: 7565 5f69 6e63 6c75 7369 6f6e 275d 203d  ue_inclusion'] =
-0002d9c0: 2072 6573 6469 6374 0a0a 2020 2020 2020   resdict..      
-0002d9d0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0002d9e0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0002d9f0: 636f 6465 6373 2e6f 7065 6e28 7365 6c66  codecs.open(self
-0002da00: 2e77 6f72 6b64 6972 202b 2073 656c 662e  .workdir + self.
-0002da10: 6d61 706e 616d 6520 2b20 275f 6174 6f6d  mapname + '_atom
-0002da20: 5f69 6e63 6c75 7369 6f6e 2e6a 736f 6e27  _inclusion.json'
-0002da30: 2c20 2777 272c 0a20 2020 2020 2020 2020  , 'w',.         
-0002da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002da50: 2020 2020 2020 2020 656e 636f 6469 6e67          encoding
-0002da60: 3d27 7574 662d 3827 2920 6173 2066 3a0a  ='utf-8') as f:.
-0002da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002da80: 2020 2020 6a73 6f6e 2e64 756d 7028 6174      json.dump(at
-0002da90: 6f6d 696e 6469 6374 2c20 6629 0a20 2020  omindict, f).   
-0002daa0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-0002dab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002dac0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-0002dad0: 6528 2753 6176 696e 6720 746f 2061 746f  e('Saving to ato
-0002dae0: 6d20 696e 636c 7573 696f 6e20 6a73 6f6e  m inclusion json
-0002daf0: 2065 7272 6f72 3a20 7b7d 2e5c 6e27 2e66   error: {}.\n'.f
-0002db00: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
-0002db10: 666f 2829 5b31 5d29 290a 0a20 2020 2020  fo()[1]))..     
-0002db20: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0002db30: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0002db40: 2063 6f64 6563 732e 6f70 656e 2873 656c   codecs.open(sel
-0002db50: 662e 776f 726b 6469 7220 2b20 7365 6c66  f.workdir + self
-0002db60: 2e6d 6170 6e61 6d65 202b 2027 5f72 6573  .mapname + '_res
-0002db70: 6964 7565 5f69 6e63 6c75 7369 6f6e 2e6a  idue_inclusion.j
-0002db80: 736f 6e27 2c20 2777 272c 0a20 2020 2020  son', 'w',.     
-0002db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dba0: 2020 2020 2020 2020 2020 2020 656e 636f              enco
-0002dbb0: 6469 6e67 3d27 7574 662d 3827 2920 6173  ding='utf-8') as
-0002dbc0: 2066 313a 0a20 2020 2020 2020 2020 2020   f1:.           
-0002dbd0: 2020 2020 2020 2020 206a 736f 6e2e 6475           json.du
-0002dbe0: 6d70 2872 6573 696e 6469 6374 2c20 6631  mp(resindict, f1
-0002dbf0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0002dc00: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-0002dc10: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-0002dc20: 2e77 7269 7465 2827 5361 7669 6e67 2074  .write('Saving t
-0002dc30: 6f20 7265 7369 6475 6520 696e 636c 7573  o residue inclus
-0002dc40: 696f 6e20 6a73 6f6e 2065 7272 6f72 3a20  ion json error: 
-0002dc50: 7b7d 2e5c 6e27 2e66 6f72 6d61 7428 7379  {}.\n'.format(sy
-0002dc60: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
-0002dc70: 290a 0a0a 0a20 2020 2020 2020 2020 2020  )....           
-0002dc80: 2065 6e64 203d 2074 696d 6569 742e 6465   end = timeit.de
-0002dc90: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
-0002dca0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0002dcb0: 2749 6e63 6c75 7369 6f6e 2074 696d 653a  'Inclusion time:
-0002dcc0: 2025 7327 2025 2028 656e 6420 2d20 7374   %s' % (end - st
-0002dcd0: 6172 7429 290a 2020 2020 2020 2020 2020  art)).          
-0002dce0: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
-0002dcf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0002dd00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
-0002dd10: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0002dd20: 6f6e 650a 0a20 2020 2023 2056 6f6c 756d  one..    # Volum
-0002dd30: 6563 6f6e 746f 7572 0a0a 2020 2020 2320  econtour..    # 
-0002dd40: 4070 726f 6669 6c65 0a20 2020 2064 6566  @profile.    def
-0002dd50: 2076 6f6c 756d 6563 6f6e 746f 7572 2873   volumecontour(s
-0002dd60: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0002dd70: 220a 0a20 2020 2020 2020 2020 2020 2047  "..            G
-0002dd80: 656e 6572 6174 6520 566f 6c75 6d65 2076  enerate Volume v
-0002dd90: 6572 7375 7320 636f 6e74 6f75 7220 6c65  ersus contour le
-0002dda0: 7665 6c20 706c 6f74 2e0a 2020 2020 2020  vel plot..      
-0002ddb0: 2020 2020 2020 5265 7375 6c74 2077 726f        Result wro
-0002ddc0: 7465 2074 6f20 6120 4a53 4f4e 2066 696c  te to a JSON fil
-0002ddd0: 652e 0a20 2020 2020 2020 2020 2020 2056  e..            V
-0002dde0: 6965 7720 696e 6469 6365 7320 6173 2073  iew indices as s
-0002ddf0: 6974 696e 6720 6f6e 2074 6865 2063 656e  iting on the cen
-0002de00: 7472 616c 206f 6620 6561 6368 2076 6f78  tral of each vox
-0002de10: 656c 2c20 6e6f 2069 6e74 6572 706f 6c61  el, no interpola
-0002de20: 7469 6f6e 206e 6565 6465 642e 0a0a 2020  tion needed...  
-0002de30: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
-0002de40: 6f6e 650a 0a20 2020 2020 2020 2022 2222  one..        """
-0002de50: 0a0a 2020 2020 2020 2020 7374 6172 7420  ..        start 
-0002de60: 3d20 7469 6d65 6974 2e64 6566 6175 6c74  = timeit.default
-0002de70: 5f74 696d 6572 2829 0a20 2020 2020 2020  _timer().       
-0002de80: 206d 6170 203d 2073 656c 662e 6d61 700a   map = self.map.
-0002de90: 2020 2020 2020 2020 2320 7465 6d70 7261          # tempra
-0002dea0: 7279 2073 6f6c 7574 696f 6e20 6173 2074  ry solution as t
-0002deb0: 6865 2074 656d 7079 2067 6976 6520 6170  he tempy give ap
-0002dec0: 6978 2061 7320 6f6e 6520 7661 6c75 6520  ix as one value 
-0002ded0: 6275 7420 6865 7265 2066 726f 6d20 6d72  but here from mr
-0002dee0: 6366 696c 6520 7765 2075 7365 2061 2074  cfile we use a t
-0002def0: 7570 6c65 0a20 2020 2020 2020 2023 2063  uple.        # c
-0002df00: 6865 636b 2066 756e 6374 696f 6e6e 2066  heck functionn f
-0002df10: 726f 6d6d 7263 5f74 6f74 656d 7079 2069  rommrc_totempy i
-0002df20: 6e20 7072 6570 6172 6174 696f 6e2e 7079  n preparation.py
-0002df30: 0a20 2020 2020 2020 2061 7069 7820 3d20  .        apix = 
-0002df40: 6d61 702e 766f 7865 6c5f 7369 7a65 2e74  map.voxel_size.t
-0002df50: 6f6c 6973 7428 290a 2020 2020 2020 2020  olist().        
-0002df60: 6d61 7064 6174 6120 3d20 6d61 702e 6461  mapdata = map.da
-0002df70: 7461 0a20 2020 2020 2020 2065 7272 6c69  ta.        errli
-0002df80: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-0002df90: 6461 7461 6469 6374 203d 2064 6963 7428  datadict = dict(
-0002dfa0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-0002dfb0: 2020 2020 2020 2020 2020 2062 696e 7320             bins 
-0002dfc0: 3d20 6e70 2e6c 696e 7370 6163 6528 6d61  = np.linspace(ma
-0002dfd0: 7064 6174 612e 6d69 6e28 292c 206d 6170  pdata.min(), map
-0002dfe0: 6461 7461 2e6d 6178 2829 2c20 3132 3929  data.max(), 129)
-0002dff0: 0a20 2020 2020 2020 2020 2020 2068 6973  .            his
-0002e000: 742c 2062 696e 5f65 6467 6573 203d 206e  t, bin_edges = n
-0002e010: 702e 6869 7374 6f67 7261 6d28 6d61 7064  p.histogram(mapd
-0002e020: 6174 612c 2062 696e 733d 6269 6e73 290a  ata, bins=bins).
-0002e030: 2020 2020 2020 2020 2020 2020 6d61 7073              maps
-0002e040: 697a 6520 3d20 6d61 702e 6865 6164 6572  ize = map.header
-0002e050: 2e6e 7820 2a20 6d61 702e 6865 6164 6572  .nx * map.header
-0002e060: 2e6e 7920 2a20 6d61 702e 6865 6164 6572  .ny * map.header
-0002e070: 2e6e 7a0a 2020 2020 2020 2020 2020 2020  .nz.            
-0002e080: 7072 6572 6573 756c 7420 3d20 6d61 7073  preresult = maps
-0002e090: 697a 6520 2d20 6e70 2e63 756d 7375 6d28  ize - np.cumsum(
-0002e0a0: 6869 7374 290a 2020 2020 2020 2020 2020  hist).          
-0002e0b0: 2020 6164 6465 6470 7265 203d 206e 702e    addedpre = np.
-0002e0c0: 696e 7365 7274 2870 7265 7265 7375 6c74  insert(preresult
-0002e0d0: 2c20 302c 206d 6170 7369 7a65 290a 2020  , 0, mapsize).  
-0002e0e0: 2020 2020 2020 2020 2020 2320 546f 646f            # Todo
-0002e0f0: 3a20 666f 7220 6e6f 6e2d 6f72 7468 6f67  : for non-orthog
-0002e100: 6f6e 616c 2076 6f6c 756d 6520 7468 6973  onal volume this
-0002e110: 2069 7320 6e6f 7420 7468 6520 7269 6768   is not the righ
-0002e120: 7420 666f 726d 756c 610a 2020 2020 2020  t formula.      
-0002e130: 2020 2020 2020 2320 4974 206e 6565 6473        # It needs
-0002e140: 2074 6865 2066 6f72 6d75 6c61 203a 2061   the formula : a
-0002e150: 6263 2a20 7371 7274 2831 202b 2032 2a63  bc* sqrt(1 + 2*c
-0002e160: 6f73 2861 292a 636f 7328 6229 2a62 6f73  os(a)*cos(b)*bos
-0002e170: 2863 2920 2d20 636f 7328 6129 2a2a 3220  (c) - cos(a)**2 
-0002e180: 2d20 636f 7328 6229 2a2a 3220 2d20 636f  - cos(b)**2 - co
-0002e190: 7328 6329 2a2a 3229 0a20 2020 2020 2020  s(c)**2).       
-0002e1a0: 2020 2020 2069 6620 7479 7065 2861 7069       if type(api
-0002e1b0: 7829 2069 7320 7475 706c 653a 0a20 2020  x) is tuple:.   
-0002e1c0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-0002e1d0: 6576 6f6c 756d 6520 3d20 2828 6170 6978  evolume = ((apix
-0002e1e0: 5b30 5d2a 6170 6978 5b31 5d2a 6170 6978  [0]*apix[1]*apix
-0002e1f0: 5b32 5d29 202f 2028 3130 202a 2a20 3329  [2]) / (10 ** 3)
-0002e200: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0002e210: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002e220: 2020 2020 6261 7365 766f 6c75 6d65 203d      basevolume =
-0002e230: 2028 2861 7069 782a 2a33 2920 2f20 2831   ((apix**3) / (1
-0002e240: 302a 2a33 2929 0a20 2020 2020 2020 2020  0**3)).         
-0002e250: 2020 2074 6d70 7265 7375 6c74 203d 2061     tmpresult = a
-0002e260: 6464 6564 7072 6520 2a20 6261 7365 766f  ddedpre * basevo
-0002e270: 6c75 6d65 0a20 2020 2020 2020 2020 2020  lume.           
-0002e280: 2069 6620 7365 6c66 2e63 6c3a 0a20 2020   if self.cl:.   
-0002e290: 2020 2020 2020 2020 2020 2020 2063 6c76               clv
-0002e2a0: 6f6c 756d 6520 3d20 286d 6170 6461 7461  olume = (mapdata
-0002e2b0: 203e 3d20 7365 6c66 2e63 6c29 2e73 756d   >= self.cl).sum
-0002e2c0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0002e2d0: 2020 2065 7374 766f 6c75 6d65 203d 2072     estvolume = r
-0002e2e0: 6f75 6e64 2863 6c76 6f6c 756d 6520 2a20  ound(clvolume * 
-0002e2f0: 6261 7365 766f 6c75 6d65 2c20 3229 0a20  basevolume, 2). 
-0002e300: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002e310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e320: 2065 7374 766f 6c75 6d65 203d 204e 6f6e   estvolume = Non
-0002e330: 650a 0a20 2020 2020 2020 2020 2020 2069  e..            i
-0002e340: 6620 6573 7476 6f6c 756d 653a 0a20 2020  f estvolume:.   
-0002e350: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0002e360: 6164 6963 7420 3d20 7b0a 2020 2020 2020  adict = {.      
-0002e370: 2020 2020 2020 2020 2020 2020 2020 2776                'v
-0002e380: 6f6c 756d 655f 6573 7469 6d61 7465 273a  olume_estimate':
-0002e390: 207b 2776 6f6c 756d 6527 3a20 6e70 2e72   {'volume': np.r
-0002e3a0: 6f75 6e64 2874 6d70 7265 7375 6c74 2c20  ound(tmpresult, 
-0002e3b0: 3130 292e 746f 6c69 7374 2829 2c0a 2020  10).tolist(),.  
-0002e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e3e0: 2020 2020 2020 276c 6576 656c 273a 206e        'level': n
-0002e3f0: 702e 726f 756e 6428 6269 6e73 2c20 3130  p.round(bins, 10
-0002e400: 292e 746f 6c69 7374 2829 2c0a 2020 2020  ).tolist(),.    
-0002e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e430: 2020 2020 2765 7374 766f 6c75 6d65 273a      'estvolume':
-0002e440: 2065 7374 766f 6c75 6d65 7d7d 0a20 2020   estvolume}}.   
-0002e450: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002e460: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0002e470: 6174 6164 6963 7420 3d20 7b0a 2020 2020  atadict = {.    
-0002e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e490: 2776 6f6c 756d 655f 6573 7469 6d61 7465  'volume_estimate
-0002e4a0: 273a 207b 2776 6f6c 756d 6527 3a20 6e70  ': {'volume': np
-0002e4b0: 2e72 6f75 6e64 2874 6d70 7265 7375 6c74  .round(tmpresult
-0002e4c0: 2c20 3130 292e 746f 6c69 7374 2829 2c0a  , 10).tolist(),.
-0002e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e4f0: 2020 2020 2020 2020 276c 6576 656c 273a          'level':
-0002e500: 206e 702e 726f 756e 6428 6269 6e73 2c20   np.round(bins, 
-0002e510: 3130 292e 746f 6c69 7374 2829 7d7d 0a20  10).tolist()}}. 
-0002e520: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-0002e530: 2020 2020 2020 2020 2020 2065 7272 203d             err =
-0002e540: 2027 566f 6c75 6d65 2065 7374 696d 6174   'Volume estimat
-0002e550: 6520 6361 6c63 756c 6174 696f 6e20 6572  e calculation er
-0002e560: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
-0002e570: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-0002e580: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-0002e590: 6572 726c 6973 742e 6170 7065 6e64 2865  errlist.append(e
-0002e5a0: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
-0002e5b0: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
-0002e5c0: 2865 7272 202b 2027 5c6e 2729 0a20 2020  (err + '\n').   
-0002e5d0: 2020 2020 2069 6620 6572 726c 6973 743a       if errlist:
-0002e5e0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-0002e5f0: 6164 6963 7420 3d20 7b27 766f 6c75 6d65  adict = {'volume
-0002e600: 5f65 7374 696d 6174 6527 3a20 7b27 6572  _estimate': {'er
-0002e610: 7227 3a20 7b27 766f 6c75 6d65 5f65 7374  r': {'volume_est
-0002e620: 696d 6174 655f 6572 726f 7227 3a20 6572  imate_error': er
-0002e630: 726c 6973 747d 7d7d 0a20 2020 2020 2020  rlist}}}.       
-0002e640: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0002e650: 2020 7769 7468 2063 6f64 6563 732e 6f70    with codecs.op
-0002e660: 656e 2873 656c 662e 776f 726b 6469 7220  en(self.workdir 
-0002e670: 2b20 7365 6c66 2e6d 6170 6e61 6d65 202b  + self.mapname +
-0002e680: 2027 5f76 6f6c 756d 655f 636f 6e74 6f75   '_volume_contou
-0002e690: 722e 6a73 6f6e 272c 2027 7727 2c0a 2020  r.json', 'w',.  
-0002e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e6b0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-0002e6c0: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
-0002e6d0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0002e6e0: 2020 206a 736f 6e2e 6475 6d70 2864 6174     json.dump(dat
-0002e6f0: 6164 6963 742c 2066 290a 2020 2020 2020  adict, f).      
-0002e700: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-0002e710: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-0002e720: 2e77 7269 7465 2827 5361 7669 6e67 2076  .write('Saving v
-0002e730: 6f6c 756d 6520 6573 7469 6d61 7465 2074  olume estimate t
-0002e740: 6f20 6a73 6f6e 2065 7272 6f72 3a7b 7d2e  o json error:{}.
-0002e750: 5c6e 272e 666f 726d 6174 2873 7973 2e65  \n'.format(sys.e
-0002e760: 7863 5f69 6e66 6f28 295b 315d 2929 0a0a  xc_info()[1]))..
-0002e770: 2020 2020 2020 2020 656e 6420 3d20 7469          end = ti
-0002e780: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-0002e790: 6572 2829 0a20 2020 2020 2020 2070 7269  er().        pri
-0002e7a0: 6e74 2827 566f 6c75 6d65 2063 6f6e 746f  nt('Volume conto
-0002e7b0: 7572 2074 696d 653a 2025 7327 2025 2028  ur time: %s' % (
-0002e7c0: 656e 6420 2d20 7374 6172 7429 290a 2020  end - start)).  
-0002e7d0: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
-0002e7e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0002e7f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0002e800: 2d27 290a 0a20 2020 2020 2020 2072 6574  -')..        ret
-0002e810: 7572 6e20 4e6f 6e65 0a0a 0a0a 0a0a 2020  urn None......  
-0002e820: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0002e830: 2323 2323 2320 7465 7374 0a0a 2020 2020  ##### test..    
-0002e840: 2320 6465 6620 7073 7375 6d28 7365 6c66  # def pssum(self
-0002e850: 2c69 2c20 6469 7374 2c20 696e 6469 6178  ,i, dist, indiax
-0002e860: 6973 293a 0a20 2020 2023 2020 2020 2069  is):.    #     i
-0002e870: 6620 6920 213d 206c 656e 2869 6e64 6961  f i != len(india
-0002e880: 7869 7329 202d 2031 3a0a 2020 2020 2320  xis) - 1:.    # 
-0002e890: 2020 2020 2020 2020 696e 6469 6365 7320          indices 
-0002e8a0: 3d20 6e70 2e61 7267 7768 6572 6528 2864  = np.argwhere((d
-0002e8b0: 6973 7420 3e20 696e 6469 6178 6973 745b  ist > indiaxist[
-0002e8c0: 695d 2920 2620 2864 6973 7420 3c3d 2069  i]) & (dist <= i
-0002e8d0: 6e64 6961 7869 7374 5b69 202b 2031 5d29  ndiaxist[i + 1])
-0002e8e0: 290a 2020 2020 2320 2020 2020 2020 2020  ).    #         
-0002e8f0: 7073 756d 203d 206c 6f67 3130 2870 736d  psum = log10(psm
-0002e900: 6170 2e66 756c 6c4d 6170 5b74 7570 6c65  ap.fullMap[tuple
-0002e910: 2869 6e64 6963 6573 2e54 295d 2e73 756d  (indices.T)].sum
-0002e920: 2829 202f 206c 656e 2869 6e64 6963 6573  () / len(indices
-0002e930: 2929 0a20 2020 2023 2020 2020 2020 2020  )).    #        
-0002e940: 2072 6574 7572 6e20 7073 756d 0a0a 2020   return psum..  
-0002e950: 2020 2320 6465 6620 7073 7375 6d28 7365    # def pssum(se
-0002e960: 6c66 2c69 6e64 6963 6573 293a 0a20 2020  lf,indices):.   
-0002e970: 2023 2020 2020 2023 2069 6620 6920 213d   #     # if i !=
-0002e980: 206c 656e 2869 6e64 6961 7869 7329 202d   len(indiaxis) -
-0002e990: 2031 3a0a 2020 2020 2320 2020 2020 2320   1:.    #     # 
-0002e9a0: 696e 6469 6365 7320 3d20 6e70 2e61 7267  indices = np.arg
-0002e9b0: 7768 6572 6528 2864 6973 7420 3e20 696e  where((dist > in
-0002e9c0: 6469 6178 6973 745b 695d 2920 2620 2864  diaxist[i]) & (d
-0002e9d0: 6973 7420 3c3d 2069 6e64 6961 7869 7374  ist <= indiaxist
-0002e9e0: 5b69 202b 2031 5d29 290a 2020 2020 2320  [i + 1])).    # 
-0002e9f0: 2020 2020 7073 756d 203d 206c 6f67 3130      psum = log10
-0002ea00: 2870 736d 6170 2e66 756c 6c4d 6170 5b74  (psmap.fullMap[t
-0002ea10: 7570 6c65 2869 6e64 6963 6573 2e54 295d  uple(indices.T)]
-0002ea20: 2e73 756d 2829 202f 206c 656e 2869 6e64  .sum() / len(ind
-0002ea30: 6963 6573 2929 0a20 2020 2023 2020 2020  ices)).    #    
-0002ea40: 2072 6574 7572 6e20 7073 756d 0a0a 0a20   return psum... 
-0002ea50: 2020 2064 6566 2070 6172 6172 6170 7328     def pararaps(
-0002ea60: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0002ea70: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-0002ea80: 4361 6c63 756c 6174 696f 6e20 6f66 2074  Calculation of t
-0002ea90: 6865 2072 6f74 6174 696f 6e61 6c6c 7920  he rotationally 
-0002eaa0: 6176 6572 6167 6520 706f 7765 7220 7370  average power sp
-0002eab0: 6563 7472 756d 2028 5241 5053 290a 2020  ectrum (RAPS).  
-0002eac0: 2020 2020 2020 2020 2020 5265 7375 6c74            Result
-0002ead0: 7320 7772 6f74 6520 746f 204a 534f 4e20  s wrote to JSON 
-0002eae0: 6669 6c65 0a0a 2020 2020 2020 2020 3a72  file..        :r
-0002eaf0: 6574 7572 6e3a 204e 6f6e 650a 0a20 2020  eturn: None..   
-0002eb00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0002eb10: 2069 6d70 6f72 7420 6d75 6c74 6970 726f   import multipro
-0002eb20: 6365 7373 696e 6720 6173 206d 700a 2020  cessing as mp.  
-0002eb30: 2020 2020 2020 696d 706f 7274 2069 7465        import ite
-0002eb40: 7274 6f6f 6c73 0a20 2020 2020 2020 2074  rtools.        t
-0002eb50: 6872 6561 6463 6f75 6e74 203d 2032 0a20  hreadcount = 2. 
-0002eb60: 2020 2020 2020 2070 6f6f 6c20 3d20 6d70         pool = mp
-0002eb70: 2e50 6f6f 6c28 7468 7265 6164 636f 756e  .Pool(threadcoun
-0002eb80: 7429 0a0a 2020 2020 2020 2020 6966 2073  t)..        if s
-0002eb90: 656c 662e 6d61 702e 785f 7369 7a65 2829  elf.map.x_size()
-0002eba0: 203d 3d20 7365 6c66 2e6d 6170 2e79 5f73   == self.map.y_s
-0002ebb0: 697a 6528 2920 3d3d 2073 656c 662e 6d61  ize() == self.ma
-0002ebc0: 702e 7a5f 7369 7a65 2829 3a0a 2020 2020  p.z_size():.    
-0002ebd0: 2020 2020 2020 2020 6572 726c 6973 7420          errlist 
-0002ebe0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0002ebf0: 2073 7461 7274 203d 2074 696d 6569 742e   start = timeit.
-0002ec00: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
-0002ec10: 2020 2020 2020 2020 2020 2020 6d61 7020              map 
-0002ec20: 3d20 7365 6c66 2e6d 6170 0a20 2020 2020  = self.map.     
-0002ec30: 2020 2020 2020 2061 7069 7820 3d20 6d61         apix = ma
-0002ec40: 702e 6170 6978 0a20 2020 2020 2020 2020  p.apix.         
-0002ec50: 2020 2066 6674 6d61 7020 3d20 6d61 702e     fftmap = map.
-0002ec60: 666f 7572 6965 725f 7472 616e 7366 6f72  fourier_transfor
-0002ec70: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
-0002ec80: 7073 6d61 7020 3d20 6666 746d 6170 2e63  psmap = fftmap.c
-0002ec90: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-0002eca0: 2020 7073 6d65 616e 203d 206e 702e 6d65    psmean = np.me
-0002ecb0: 616e 2870 736d 6170 2e66 756c 6c4d 6170  an(psmap.fullMap
-0002ecc0: 290a 2020 2020 2020 2020 2020 2020 7073  ).            ps
-0002ecd0: 7374 6420 3d20 6e70 2e73 7464 2870 736d  std = np.std(psm
-0002ece0: 6170 2e66 756c 6c4d 6170 290a 2020 2020  ap.fullMap).    
-0002ecf0: 2020 2020 2020 2020 7073 6d61 702e 6675          psmap.fu
-0002ed00: 6c6c 4d61 7020 3d20 6e70 2e61 6273 2828  llMap = np.abs((
-0002ed10: 7073 6d61 702e 6675 6c6c 4d61 7020 2d20  psmap.fullMap - 
-0002ed20: 7073 6d65 616e 2920 2f20 7073 7374 6429  psmean) / psstd)
-0002ed30: 202a 2a20 320a 0a20 2020 2020 2020 2020   ** 2..         
-0002ed40: 2020 206d 6964 7374 6172 7420 3d20 7469     midstart = ti
-0002ed50: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-0002ed60: 6572 2829 202d 2073 7461 7274 0a20 2020  er() - start.   
-0002ed70: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0002ed80: 202d 2d20 5241 5053 2046 6f75 7269 6572   -- RAPS Fourier
-0002ed90: 2d74 7261 6e73 666f 726d 6174 696f 6e20  -transformation 
-0002eda0: 7469 6d65 3a20 2573 2720 2520 6d69 6473  time: %s' % mids
-0002edb0: 7461 7274 290a 0a20 2020 2020 2020 2020  tart)..         
-0002edc0: 2020 207a 6772 6964 203d 206e 702e 6172     zgrid = np.ar
-0002edd0: 616e 6765 2866 6c6f 6f72 2870 736d 6170  ange(floor(psmap
-0002ede0: 2e7a 5f73 697a 6528 2920 2f20 322e 3029  .z_size() / 2.0)
-0002edf0: 202a 202d 312c 2063 6569 6c28 7073 6d61   * -1, ceil(psma
-0002ee00: 702e 7a5f 7369 7a65 2829 202f 2032 2e30  p.z_size() / 2.0
-0002ee10: 2929 202f 2066 6c6f 6174 2866 6c6f 6f72  )) / float(floor
-0002ee20: 2870 736d 6170 2e7a 5f73 697a 6528 2929  (psmap.z_size())
-0002ee30: 290a 2020 2020 2020 2020 2020 2020 7967  ).            yg
-0002ee40: 7269 6420 3d20 6e70 2e61 7261 6e67 6528  rid = np.arange(
-0002ee50: 666c 6f6f 7228 7073 6d61 702e 795f 7369  floor(psmap.y_si
-0002ee60: 7a65 2829 202f 2032 2e30 2920 2a20 2d31  ze() / 2.0) * -1
-0002ee70: 2c20 6365 696c 2870 736d 6170 2e79 5f73  , ceil(psmap.y_s
-0002ee80: 697a 6528 2920 2f20 322e 3029 2920 2f20  ize() / 2.0)) / 
-0002ee90: 666c 6f61 7428 666c 6f6f 7228 7073 6d61  float(floor(psma
-0002eea0: 702e 795f 7369 7a65 2829 2929 0a20 2020  p.y_size())).   
-0002eeb0: 2020 2020 2020 2020 2078 6772 6964 203d           xgrid =
-0002eec0: 206e 702e 6172 616e 6765 2866 6c6f 6f72   np.arange(floor
-0002eed0: 2870 736d 6170 2e78 5f73 697a 6528 2920  (psmap.x_size() 
-0002eee0: 2f20 322e 3029 202a 202d 312c 2063 6569  / 2.0) * -1, cei
-0002eef0: 6c28 7073 6d61 702e 785f 7369 7a65 2829  l(psmap.x_size()
-0002ef00: 202f 2032 2e30 2929 202f 2066 6c6f 6174   / 2.0)) / float
-0002ef10: 2866 6c6f 6f72 2870 736d 6170 2e78 5f73  (floor(psmap.x_s
-0002ef20: 697a 6528 2929 290a 2020 2020 2020 2020  ize())).        
-0002ef30: 2020 2020 7864 6973 203d 2078 6772 6964      xdis = xgrid
-0002ef40: 202a 2a20 320a 2020 2020 2020 2020 2020   ** 2.          
-0002ef50: 2020 7964 6973 203d 2079 6772 6964 202a    ydis = ygrid *
-0002ef60: 2a20 320a 2020 2020 2020 2020 2020 2020  * 2.            
-0002ef70: 7a64 6973 203d 207a 6772 6964 202a 2a20  zdis = zgrid ** 
-0002ef80: 320a 2020 2020 2020 2020 2020 2020 6469  2.            di
-0002ef90: 7374 203d 206e 702e 7371 7274 287a 6469  st = np.sqrt(zdi
-0002efa0: 735b 3a2c 204e 6f6e 652c 204e 6f6e 655d  s[:, None, None]
-0002efb0: 202b 2079 6469 735b 3a2c 204e 6f6e 655d   + ydis[:, None]
-0002efc0: 202b 2078 6469 7329 0a0a 2020 2020 2020   + xdis)..      
-0002efd0: 2020 2020 2020 616c 6c61 7869 7320 3d20        allaxis = 
-0002efe0: 5b7a 6772 6964 2c20 7967 7269 642c 2078  [zgrid, ygrid, x
-0002eff0: 6772 6964 5d0a 2020 2020 2020 2020 2020  grid].          
-0002f000: 2020 746d 7069 6e64 6961 7869 7320 3d20    tmpindiaxis = 
-0002f010: 6d61 7828 616c 6c61 7869 732c 206b 6579  max(allaxis, key
-0002f020: 3d6c 656e 290a 2020 2020 2020 2020 2020  =len).          
-0002f030: 2020 696e 6469 6178 6973 7420 3d20 746d    indiaxist = tm
-0002f040: 7069 6e64 6961 7869 735b 746d 7069 6e64  pindiaxis[tmpind
-0002f050: 6961 7869 7320 3e3d 2030 5d0a 2020 2020  iaxis >= 0].    
-0002f060: 2020 2020 2020 2020 696e 6469 6178 6973          indiaxis
-0002f070: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
-0002f080: 2c20 3120 2f20 2832 202a 2061 7069 7829  , 1 / (2 * apix)
-0002f090: 2c20 6c65 6e28 696e 6469 6178 6973 7429  , len(indiaxist)
-0002f0a0: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0002f0b0: 696e 7428 2764 6973 743a 2729 0a20 2020  int('dist:').   
-0002f0c0: 2020 2020 2020 2020 2070 7269 6e74 2861           print(a
-0002f0d0: 6c6c 6178 6973 290a 2020 2020 2020 2020  llaxis).        
-0002f0e0: 2020 2020 7072 696e 7428 6469 7374 2e73      print(dist.s
-0002f0f0: 6861 7065 290a 2020 2020 2020 2020 2020  hape).          
-0002f100: 2020 7072 696e 7428 696e 6469 6178 6973    print(indiaxis
-0002f110: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0002f120: 696e 7428 7073 6d61 702e 7a5f 7369 7a65  int(psmap.z_size
-0002f130: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-0002f140: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2729  print('-------')
-0002f150: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0002f160: 6e74 2864 6973 745b 3938 2c39 362c 3936  nt(dist[98,96,96
-0002f170: 5d29 0a0a 0a20 2020 2020 2020 2020 2020  ])...           
-0002f180: 2061 7073 203d 205b 5d0a 2020 2020 2020   aps = [].      
-0002f190: 2020 2020 2020 2320 666f 7220 6920 696e        # for i in
-0002f1a0: 2072 616e 6765 286c 656e 2869 6e64 6961   range(len(india
-0002f1b0: 7869 7329 293a 0a20 2020 2020 2020 2020  xis)):.         
-0002f1c0: 2020 2023 2020 2020 2069 6620 6920 213d     #     if i !=
-0002f1d0: 206c 656e 2869 6e64 6961 7869 7329 202d   len(indiaxis) -
-0002f1e0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0002f1f0: 2320 2020 2020 2020 2020 696e 6469 6365  #         indice
-0002f200: 7320 3d20 6e70 2e61 7267 7768 6572 6528  s = np.argwhere(
-0002f210: 2864 6973 7420 3e20 696e 6469 6178 6973  (dist > indiaxis
-0002f220: 745b 695d 2920 2620 2864 6973 7420 3c3d  t[i]) & (dist <=
-0002f230: 2069 6e64 6961 7869 7374 5b69 202b 2031   indiaxist[i + 1
-0002f240: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0002f250: 2320 2020 2020 2020 2020 7073 756d 203d  #         psum =
-0002f260: 206c 6f67 3130 2870 736d 6170 2e66 756c   log10(psmap.ful
-0002f270: 6c4d 6170 5b74 7570 6c65 2869 6e64 6963  lMap[tuple(indic
-0002f280: 6573 2e54 295d 2e73 756d 2829 202f 206c  es.T)].sum() / l
-0002f290: 656e 2869 6e64 6963 6573 2929 0a20 2020  en(indices)).   
-0002f2a0: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-0002f2b0: 2020 2061 7073 2e61 7070 656e 6428 7073     aps.append(ps
-0002f2c0: 756d 290a 0a20 2020 2020 2020 2020 2020  um)..           
-0002f2d0: 2061 6c6c 696e 6469 6365 7320 3d20 5b5d   allindices = []
-0002f2e0: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
-0002f2f0: 7073 6d61 7020 3d20 5b5d 0a20 2020 2020  psmap = [].     
-0002f300: 2020 2020 2020 2023 2066 6f72 2069 2069         # for i i
-0002f310: 6e20 7261 6e67 6528 6c65 6e28 696e 6469  n range(len(indi
-0002f320: 6178 6973 2929 3a0a 2020 2020 2020 2020  axis)):.        
-0002f330: 2020 2020 2320 2020 2020 6966 2069 2021      #     if i !
-0002f340: 3d20 6c65 6e28 696e 6469 6178 6973 2920  = len(indiaxis) 
-0002f350: 2d31 3a0a 2020 2020 2020 2020 2020 2020  -1:.            
-0002f360: 2320 2020 2020 2020 2020 696e 6469 6365  #         indice
-0002f370: 7320 3d20 6e70 2e61 7267 7768 6572 6528  s = np.argwhere(
-0002f380: 2864 6973 7420 3e20 696e 6469 6178 6973  (dist > indiaxis
-0002f390: 745b 695d 2920 2620 2864 6973 7420 3c3d  t[i]) & (dist <=
-0002f3a0: 2069 6e64 6961 7869 7374 5b69 202b 2031   indiaxist[i + 1
-0002f3b0: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-0002f3c0: 230a 2020 2020 2020 2020 2020 2020 2320  #.            # 
-0002f3d0: 2020 2020 2020 2020 7073 756d 203d 2070          psum = p
-0002f3e0: 736d 6170 2e66 756c 6c4d 6170 5b74 7570  smap.fullMap[tup
-0002f3f0: 6c65 2869 6e64 6963 6573 2e54 295d 2e73  le(indices.T)].s
-0002f400: 756d 2829 0a20 2020 2020 2020 2020 2020  um().           
-0002f410: 2023 2020 2020 2020 2020 2061 6c6c 696e   #         allin
-0002f420: 6469 6365 732e 6170 7065 6e64 2869 6e64  dices.append(ind
-0002f430: 6963 6573 290a 2020 2020 2020 2020 2020  ices).          
-0002f440: 2020 2320 2020 2020 2020 2020 616c 6c70    #         allp
-0002f450: 736d 6170 2e61 7070 656e 6428 7073 756d  smap.append(psum
-0002f460: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0002f470: 7072 696e 7428 616c 6c69 6e64 6963 6573  print(allindices
-0002f480: 290a 2020 2020 2020 2020 2020 2020 6f64  ).            od
-0002f490: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
-0002f4a0: 2020 2065 7665 6e20 3d5b 5d0a 2020 2020     even =[].    
-0002f4b0: 2020 2020 2020 2020 636f 756e 7465 7220          counter 
-0002f4c0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-0002f4d0: 726c 6973 7420 3d20 5b5d 0a20 2020 2020  rlist = [].     
-0002f4e0: 2020 2020 2020 2074 656d 706c 6973 7420         templist 
-0002f4f0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0002f500: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0002f510: 6c65 6e28 696e 6469 6178 6973 292d 3129  len(indiaxis)-1)
-0002f520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002f530: 2020 636f 756e 7465 7220 2b3d 2031 0a20    counter += 1. 
-0002f540: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002f550: 6620 6920 3d3d 2030 3a0a 2020 2020 2020  f i == 0:.      
-0002f560: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0002f570: 6d70 6c69 7374 2e61 7070 656e 6428 6929  mplist.append(i)
-0002f580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f590: 2065 6c69 6620 6920 2520 3430 203d 3d20   elif i % 40 == 
-0002f5a0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0002f5b0: 2020 2020 2020 2072 6c69 7374 2e61 7070         rlist.app
-0002f5c0: 656e 6428 7465 6d70 6c69 7374 290a 2020  end(templist).  
-0002f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f5e0: 2020 7465 6d70 6c69 7374 203d 205b 5d0a    templist = [].
-0002f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f600: 2020 2020 7465 6d70 6c69 7374 2e61 7070      templist.app
-0002f610: 656e 6428 6929 0a20 2020 2020 2020 2020  end(i).         
-0002f620: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f640: 2074 656d 706c 6973 742e 6170 7065 6e64   templist.append
-0002f650: 2869 290a 0a20 2020 2020 2020 2020 2020  (i)..           
-0002f660: 2072 6c69 7374 2e61 7070 656e 6428 7465   rlist.append(te
-0002f670: 6d70 6c69 7374 290a 0a20 2020 2020 2020  mplist)..       
-0002f680: 2020 2020 2064 6566 2073 706c 6974 5f6c       def split_l
-0002f690: 6973 7428 696e 705f 6c69 7374 2c20 6e72  ist(inp_list, nr
-0002f6a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0002f6b0: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
-0002f6c0: 2020 2020 2020 2053 706c 6974 7320 6576         Splits ev
-0002f6d0: 656e 6c79 2061 206c 6973 740a 2020 2020  enly a list.    
-0002f6e0: 2020 2020 2020 2020 2020 2020 3a70 6172              :par
-0002f6f0: 616d 2069 6e70 5f6c 6973 743a 206c 6973  am inp_list: lis
-0002f700: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0002f710: 2020 3a70 6172 616d 206e 723a 206e 756d    :param nr: num
-0002f720: 6265 7220 6f66 2070 6172 7473 0a20 2020  ber of parts.   
-0002f730: 2020 2020 2020 2020 2020 2020 203a 7265               :re
-0002f740: 7475 726e 3a20 6c69 7374 206f 6620 226e  turn: list of "n
-0002f750: 7222 206c 6973 7473 0a20 2020 2020 2020  r" lists.       
-0002f760: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
-0002f770: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0002f780: 5f6c 6973 7420 3d20 5b5d 0a20 2020 2020  _list = [].     
-0002f790: 2020 2020 2020 2020 2020 206e 725f 656c             nr_el
-0002f7a0: 203d 2031 2e30 202f 206e 7220 2a20 6c65   = 1.0 / nr * le
-0002f7b0: 6e28 696e 705f 6c69 7374 290a 2020 2020  n(inp_list).    
-0002f7c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0002f7d0: 6920 696e 2072 616e 6765 286e 7229 3a0a  i in range(nr):.
-0002f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f7f0: 2020 2020 7374 6172 7420 3d20 696e 7428      start = int(
-0002f800: 726f 756e 6428 6920 2a20 6e72 5f65 6c29  round(i * nr_el)
-0002f810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002f820: 2020 2020 2020 656e 6420 3d20 696e 7428        end = int(
-0002f830: 726f 756e 6428 2869 202b 2031 2920 2a20  round((i + 1) * 
-0002f840: 6e72 5f65 6c29 290a 2020 2020 2020 2020  nr_el)).        
-0002f850: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002f860: 6c69 7374 2e61 7070 656e 6428 696e 705f  list.append(inp_
-0002f870: 6c69 7374 5b73 7461 7274 3a65 6e64 5d29  list[start:end])
-0002f880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f890: 2072 6574 7572 6e20 6e65 775f 6c69 7374   return new_list
-0002f8a0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-0002f8b0: 7574 6c69 7374 203d 2072 616e 6765 2830  utlist = range(0
-0002f8c0: 2c20 6c65 6e28 696e 6469 6178 6973 292d  , len(indiaxis)-
-0002f8d0: 3129 0a20 2020 2020 2020 2020 2020 2072  1).            r
-0002f8e0: 6c69 7374 203d 2073 706c 6974 5f6c 6973  list = split_lis
-0002f8f0: 7428 696e 7075 746c 6973 742c 2074 6872  t(inputlist, thr
-0002f900: 6561 6463 6f75 6e74 290a 0a20 2020 2020  eadcount)..     
-0002f910: 2020 2020 2020 2023 2054 7279 2077 6974         # Try wit
-0002f920: 6820 7368 6172 6564 206f 626a 6563 740a  h shared object.
-0002f930: 2020 2020 2020 2020 2020 2020 696d 706f              impo
-0002f940: 7274 206d 756c 7469 7072 6f63 6573 7369  rt multiprocessi
-0002f950: 6e67 0a20 2020 2020 2020 2020 2020 2069  ng.            i
-0002f960: 6d70 6f72 7420 6374 7970 6573 0a20 2020  mport ctypes.   
-0002f970: 2020 2020 2020 2020 2078 2c20 792c 207a           x, y, z
-0002f980: 203d 2064 6973 742e 7368 6170 650a 0a20   = dist.shape.. 
-0002f990: 2020 2020 2020 2020 2020 2073 6861 7265             share
-0002f9a0: 645f 6172 7261 795f 6261 7365 203d 206d  d_array_base = m
-0002f9b0: 756c 7469 7072 6f63 6573 7369 6e67 2e41  ultiprocessing.A
-0002f9c0: 7272 6179 2863 7479 7065 732e 635f 646f  rray(ctypes.c_do
-0002f9d0: 7562 6c65 2c20 782a 792a 7a29 0a20 2020  uble, x*y*z).   
-0002f9e0: 2020 2020 2020 2020 2023 2073 6861 7265           # share
-0002f9f0: 645f 6172 7261 7920 3d20 6e70 2e63 7479  d_array = np.cty
-0002fa00: 7065 736c 6962 2e61 735f 6172 7261 7928  peslib.as_array(
-0002fa10: 7368 6172 6564 5f61 7272 6179 5f62 6173  shared_array_bas
-0002fa20: 652e 6765 745f 6f62 6a28 2929 0a20 2020  e.get_obj()).   
-0002fa30: 2020 2020 2020 2020 2073 6861 7265 645f           shared_
-0002fa40: 6172 7261 7920 3d20 6e70 2e66 726f 6d62  array = np.fromb
-0002fa50: 7566 6665 7228 7368 6172 6564 5f61 7272  uffer(shared_arr
-0002fa60: 6179 5f62 6173 652e 6765 745f 6f62 6a28  ay_base.get_obj(
-0002fa70: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
-0002fa80: 6861 7265 645f 6172 7261 7920 3d20 7368  hared_array = sh
-0002fa90: 6172 6564 5f61 7272 6179 2e72 6573 6861  ared_array.resha
-0002faa0: 7065 2864 6973 742e 7368 6170 6529 0a0a  pe(dist.shape)..
-0002fab0: 0a0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-0002fac0: 6172 6564 5f61 7272 6179 5b3a 5d20 3d20  ared_array[:] = 
-0002fad0: 6469 7374 5b3a 5d0a 2020 2020 2020 2020  dist[:].        
-0002fae0: 2020 2020 2320 6170 7320 3d20 5b70 6f6f      # aps = [poo
-0002faf0: 6c2e 6170 706c 7928 7063 616c 2c20 6172  l.apply(pcal, ar
-0002fb00: 6773 3d28 692c 2061 6c6c 696e 6469 6365  gs=(i, allindice
-0002fb10: 732c 2061 6c6c 7073 6d61 7029 2920 666f  s, allpsmap)) fo
-0002fb20: 7220 6920 696e 2072 6c69 7374 5d0a 2020  r i in rlist].  
-0002fb30: 2020 2020 2020 2020 2020 6170 7320 3d20            aps = 
-0002fb40: 5b70 6f6f 6c2e 6170 706c 7928 7073 7375  [pool.apply(pssu
-0002fb50: 6d2c 2061 7267 733d 2869 2c20 696e 6469  m, args=(i, indi
-0002fb60: 6178 6973 2c20 696e 6469 6178 6973 742c  axis, indiaxist,
-0002fb70: 2073 6861 7265 645f 6172 7261 7929 2920   shared_array)) 
-0002fb80: 666f 7220 6920 696e 2072 6c69 7374 5d0a  for i in rlist].
-0002fb90: 2020 2020 2020 2020 2020 2020 2320 6170              # ap
-0002fba0: 7320 3d20 6170 735b 3a2d 315d 0a20 2020  s = aps[:-1].   
-0002fbb0: 2020 2020 2020 2020 2023 2061 7073 203d           # aps =
-0002fbc0: 2070 6f6f 6c2e 6d61 7028 7365 6c66 2e70   pool.map(self.p
-0002fbd0: 7373 756d 2c20 5b20 6920 666f 7220 6920  ssum, [ i for i 
-0002fbe0: 696e 2061 6c6c 696e 6469 6365 735d 290a  in allindices]).
-0002fbf0: 2020 2020 2020 2020 2020 2020 6e65 7761              newa
-0002fc00: 7073 203d 206c 6973 7428 6974 6572 746f  ps = list(iterto
-0002fc10: 6f6c 732e 6368 6169 6e2e 6672 6f6d 5f69  ols.chain.from_i
-0002fc20: 7465 7261 626c 6528 6170 7329 290a 2020  terable(aps)).  
-0002fc30: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-0002fc40: 7428 6c65 6e28 6e65 7761 7073 2929 0a0a  t(len(newaps))..
-0002fc50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0002fc60: 6920 696e 2072 616e 6765 286c 656e 2869  i in range(len(i
-0002fc70: 6e64 6961 7869 7329 2d31 293a 0a20 2020  ndiaxis)-1):.   
-0002fc80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002fc90: 6920 213d 206c 656e 2869 6e64 6961 7869  i != len(indiaxi
-0002fca0: 7329 202d 313a 0a20 2020 2020 2020 2020  s) -1:.         
-0002fcb0: 2020 2020 2020 2020 2020 2070 7375 6d20             psum 
-0002fcc0: 3d20 6c6f 6731 3028 7073 6d61 702e 6675  = log10(psmap.fu
-0002fcd0: 6c6c 4d61 705b 7475 706c 6528 6e65 7761  llMap[tuple(newa
-0002fce0: 7073 5b69 5d2e 5429 5d2e 7375 6d28 2920  ps[i].T)].sum() 
-0002fcf0: 2f20 6c65 6e28 6e65 7761 7073 5b69 5d29  / len(newaps[i])
-0002fd00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002fd10: 2020 2020 2020 616c 6c70 736d 6170 2e61        allpsmap.a
-0002fd20: 7070 656e 6428 7073 756d 290a 0a20 2020  ppend(psum)..   
-0002fd30: 2020 2020 2020 2020 2070 7269 6e74 2861           print(a
-0002fd40: 6c6c 7073 6d61 7029 0a0a 2020 2020 2020  llpsmap)..      
-0002fd50: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
-0002fd60: 2323 2323 2323 2323 0a0a 2020 2020 2020  ########..      
-0002fd70: 2020 2020 2020 6461 7461 6469 6374 203d        datadict =
-0002fd80: 207b 2772 6f74 6174 696f 6e61 6c6c 795f   {'rotationally_
-0002fd90: 6176 6572 6167 6564 5f70 6f77 6572 5f73  averaged_power_s
-0002fda0: 7065 6374 7275 6d27 3a20 7b27 7927 3a20  pectrum': {'y': 
-0002fdb0: 6e70 2e72 6f75 6e64 2861 6c6c 7073 6d61  np.round(allpsma
-0002fdc0: 702c 2034 292e 746f 6c69 7374 2829 2c0a  p, 4).tolist(),.
-0002fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe10: 2027 7827 3a20 6e70 2e72 6f75 6e64 2869   'x': np.round(i
-0002fe20: 6e64 6961 7869 735b 3a2d 315d 2c20 3429  ndiaxis[:-1], 4)
-0002fe30: 2e74 6f6c 6973 7428 297d 7d0a 2020 2020  .tolist()}}.    
-0002fe40: 2020 2020 2020 2020 6572 7220 3d20 2752          err = 'R
-0002fe50: 4150 5320 6361 6c63 756c 6174 696f 6e20  APS calculation 
-0002fe60: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
-0002fe70: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-0002fe80: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-0002fe90: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-0002fea0: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
-0002feb0: 2020 6461 7461 6469 6374 203d 207b 2772    datadict = {'r
-0002fec0: 6f74 6174 696f 6e61 6c6c 795f 6176 6572  otationally_aver
-0002fed0: 6167 6564 5f70 6f77 6572 5f73 7065 6374  aged_power_spect
-0002fee0: 7275 6d27 3a20 7b27 6572 7227 3a20 7b27  rum': {'err': {'
-0002fef0: 7261 7073 5f65 7272 273a 2065 7272 6c69  raps_err': errli
-0002ff00: 7374 7d7d 7d0a 2020 2020 2020 2020 2020  st}}}.          
-0002ff10: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-0002ff20: 7465 2865 7272 202b 2027 5c6e 2729 0a0a  te(err + '\n')..
-0002ff30: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-0002ff40: 6f6f 6c28 6461 7461 6469 6374 293a 0a20  ool(datadict):. 
-0002ff50: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0002ff60: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0002ff70: 2020 2020 2020 2020 7769 7468 2063 6f64          with cod
-0002ff80: 6563 732e 6f70 656e 2873 656c 662e 776f  ecs.open(self.wo
-0002ff90: 726b 6469 7220 2b20 7365 6c66 2e6d 6170  rkdir + self.map
-0002ffa0: 6e61 6d65 202b 2027 5f72 6170 732e 6a73  name + '_raps.js
-0002ffb0: 6f6e 272c 2027 7727 2c20 656e 636f 6469  on', 'w', encodi
-0002ffc0: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
-0002ffd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002ffe0: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
-0002fff0: 756d 7028 6461 7461 6469 6374 2c20 6629  ump(datadict, f)
-00030000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030010: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00030020: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00030030: 2e73 7464 6572 722e 7772 6974 6528 2753  .stderr.write('S
-00030040: 6176 696e 6720 5241 5053 2074 6f20 6a73  aving RAPS to js
-00030050: 6f6e 2065 7272 6f72 3a20 7b7d 2e27 2e66  on error: {}.'.f
-00030060: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
-00030070: 666f 2829 5b31 5d29 290a 2020 2020 2020  fo()[1])).      
-00030080: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00030090: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-000300a0: 7374 6465 7272 2e77 7269 7465 2827 4e6f  stderr.write('No
-000300b0: 2072 6170 7320 6461 7461 2069 6e20 7468   raps data in th
-000300c0: 6520 6469 6374 696f 6e61 7279 2c20 6e6f  e dictionary, no
-000300d0: 2072 6170 7320 6a73 6f6e 2066 696c 652e   raps json file.
-000300e0: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
-000300f0: 2020 656e 6420 3d20 7469 6d65 6974 2e64    end = timeit.d
-00030100: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
-00030110: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00030120: 2827 5241 5053 2074 696d 653a 2025 7327  ('RAPS time: %s'
-00030130: 2025 2028 656e 6420 2d20 7374 6172 7429   % (end - start)
-00030140: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00030150: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
-00030160: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00030170: 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020 2020  ---------').    
-00030180: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00030190: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
-000301a0: 5241 5053 2063 616c 6375 6c61 7469 6f6e  RAPS calculation
-000301b0: 2066 6f72 206e 6f6e 2d63 7562 6963 206d   for non-cubic m
-000301c0: 6170 2e27 290a 2020 2020 2020 2020 2020  ap.').          
-000301d0: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
+0002cec0: 2020 2020 2020 2020 2020 2027 6174 6f6d             'atom
+0002ced0: 6f75 7473 6964 6527 3a20 6174 6f6d 6f75  outside': atomou
+0002cee0: 7473 6964 6562 6f78 2c0a 2020 2020 2020  tsidebox,.      
+0002cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf10: 2020 2020 2020 2020 2763 6861 696e 6169          'chainai
+0002cf20: 7363 6f72 6527 3a20 6368 6169 6e61 6973  score': chainais
+0002cf30: 636f 7265 2c0a 2020 2020 2020 2020 2020  core,.          
+0002cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf60: 2020 2020 2774 6f74 616c 4e75 6d62 6572      'totalNumber
+0002cf70: 4f66 4174 6f6d 7327 3a20 696e 7428 7265  OfAtoms': int(re
+0002cf80: 7375 6c74 5b33 5d29 2c0a 2020 2020 2020  sult[3]),.      
+0002cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cfb0: 2020 2020 2020 2020 2761 7665 7261 6765          'average
+0002cfc0: 5f61 695f 6d6f 6465 6c27 3a20 726f 756e  _ai_model': roun
+0002cfd0: 6428 7265 7375 6c74 5b32 5d2c 2033 292c  d(result[2], 3),
+0002cfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d000: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0002d010: 6176 6572 6167 655f 6169 5f63 6f6c 6f72  average_ai_color
+0002d020: 273a 2073 656c 662e 5f5f 666c 6f61 746f  ': self.__floato
+0002d030: 6865 7828 5b72 6f75 6e64 2872 6573 756c  hex([round(resul
+0002d040: 745b 325d 2c20 3629 5d29 5b30 5d2c 0a20  t[2], 6)])[0],. 
+0002d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d070: 2020 2020 2020 2020 2020 2020 2023 2027               # '
+0002d080: 6169 5f62 6172 273a 2061 6962 6172 0a20  ai_bar': aibar. 
+0002d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0b0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+0002d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0d0: 2020 2061 6c6c 6d6f 6465 6c73 5f6e 756d     allmodels_num
+0002d0e0: 6265 7261 746f 6d73 202b 3d20 696e 7428  beratoms += int(
+0002d0f0: 7265 7375 6c74 5b33 5d29 0a20 2020 2020  result[3]).     
+0002d100: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0002d110: 6c6c 6d6f 6465 6c73 5f61 746f 6d5f 696e  llmodels_atom_in
+0002d120: 636c 7573 696f 6e20 2b3d 2072 6573 756c  clusion += resul
+0002d130: 745b 335d 2a72 6573 756c 745b 325d 0a0a  t[3]*result[2]..
+0002d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d150: 2020 2020 6461 7461 5f6c 656e 203d 206c      data_len = l
+0002d160: 656e 286c 6576 656c 732e 746f 6c69 7374  en(levels.tolist
+0002d170: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0002d180: 2020 2020 2020 2020 706c 742e 706c 6f74          plt.plot
+0002d190: 285b 726f 756e 6428 656c 656d 2c20 3130  ([round(elem, 10
+0002d1a0: 2920 666f 7220 656c 656d 2069 6e20 6c65  ) for elem in le
+0002d1b0: 7665 6c73 2e74 6f6c 6973 7428 295d 2c20  vels.tolist()], 
+0002d1c0: 5b72 6f75 6e64 2865 6c65 6d2c 2031 3029  [round(elem, 10)
+0002d1d0: 2066 6f72 2065 6c65 6d20 696e 2072 6573   for elem in res
+0002d1e0: 756c 745b 305d 5d2c 2027 2d67 272c 206c  ult[0]], '-g', l
+0002d1f0: 6162 656c 3d27 4675 6c6c 2061 746f 6d27  abel='Full atom'
+0002d200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002d210: 2020 2020 2020 706c 742e 706c 6f74 285b        plt.plot([
+0002d220: 726f 756e 6428 656c 656d 2c20 3130 2920  round(elem, 10) 
+0002d230: 666f 7220 656c 656d 2069 6e20 6c65 7665  for elem in leve
+0002d240: 6c73 2e74 6f6c 6973 7428 295d 2c20 5b72  ls.tolist()], [r
+0002d250: 6f75 6e64 2865 6c65 6d2c 2031 3029 2066  ound(elem, 10) f
+0002d260: 6f72 2065 6c65 6d20 696e 2072 6573 756c  or elem in resul
+0002d270: 745b 315d 5d2c 2027 2d62 272c 206c 6162  t[1]], '-b', lab
+0002d280: 656c 3d27 4261 636b 626f 6e65 2729 0a20  el='Backbone'). 
+0002d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d2a0: 2020 2070 6c74 2e70 6c6f 7428 6461 7461     plt.plot(data
+0002d2b0: 5f6c 656e 202a 205b 7365 6c66 2e63 6c5d  _len * [self.cl]
+0002d2c0: 2c20 6e70 2e6c 696e 7370 6163 6528 302c  , np.linspace(0,
+0002d2d0: 2031 2c20 6461 7461 5f6c 656e 292c 2027   1, data_len), '
+0002d2e0: 2d72 272c 206c 6162 656c 3d27 5265 636f  -r', label='Reco
+0002d2f0: 6d6d 656e 6465 6420 636f 6e74 6f75 7220  mmended contour 
+0002d300: 6c65 7665 6c27 290a 2020 2020 2020 2020  level').        
+0002d310: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
+0002d320: 6c65 6765 6e64 286c 6f63 3d27 6c6f 7765  legend(loc='lowe
+0002d330: 7220 6c65 6674 2729 0a20 2020 2020 2020  r left').       
+0002d340: 2020 2020 2020 2020 2020 2020 2070 6c74               plt
+0002d350: 2e73 6176 6566 6967 2873 656c 662e 776f  .savefig(self.wo
+0002d360: 726b 6469 7220 2b20 7365 6c66 2e6d 6170  rkdir + self.map
+0002d370: 6e61 6d65 202b 2027 5f69 6e63 6c75 7369  name + '_inclusi
+0002d380: 6f6e 2e70 6e67 2729 0a20 2020 2020 2020  on.png').       
+0002d390: 2020 2020 2020 2020 2020 2020 2070 6c74               plt
+0002d3a0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+0002d3b0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+0002d3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d3d0: 2020 2020 2065 7272 203d 2027 4174 6f6d       err = 'Atom
+0002d3e0: 2069 6e63 6c75 7369 6f6e 2063 616c 6375   inclusion calcu
+0002d3f0: 6c61 7469 6f6e 2065 7272 6f72 284d 6f64  lation error(Mod
+0002d400: 656c 3a20 7b7d 293a 207b 7d2e 272e 666f  el: {}): {}.'.fo
+0002d410: 726d 6174 286b 6579 2c20 7379 732e 6578  rmat(key, sys.ex
+0002d420: 635f 696e 666f 2829 5b31 5d29 0a20 2020  c_info()[1]).   
+0002d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d440: 2065 7272 6c69 7374 2e61 7070 656e 6428   errlist.append(
+0002d450: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+0002d460: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0002d470: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
+0002d480: 275c 6e27 290a 2020 2020 2020 2020 2020  '\n').          
+0002d490: 2020 2020 2020 6966 2065 7272 6c69 7374        if errlist
+0002d4a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d4b0: 2020 2020 2020 6461 7461 6469 6374 5b73        datadict[s
+0002d4c0: 7472 2863 6f75 6e74 6572 295d 203d 207b  tr(counter)] = {
+0002d4d0: 2765 7272 273a 207b 2761 746f 6d5f 696e  'err': {'atom_in
+0002d4e0: 636c 7573 696f 6e5f 6572 7227 3a20 6572  clusion_err': er
+0002d4f0: 726c 6973 747d 7d0a 0a20 2020 2020 2020  rlist}}..       
+0002d500: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
+0002d510: 6469 6374 203d 204f 7264 6572 6564 4469  dict = OrderedDi
+0002d520: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
+0002d530: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0002d540: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0002d550: 7220 636f 6e74 6f75 722c 206b 6579 7376  r contour, keysv
+0002d560: 616c 7565 7320 696e 2061 6c6c 636f 6e74  alues in allcont
+0002d570: 6f75 7273 6469 6374 2e69 7465 6d73 2829  oursdict.items()
+0002d580: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d590: 2020 2020 2020 2020 2020 616c 6c76 616c            allval
+0002d5a0: 7565 7320 3d20 6b65 7973 7661 6c75 6573  ues = keysvalues
+0002d5b0: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+0002d5c0: 2020 2020 2020 2020 2020 2020 616c 6c6b              allk
+0002d5d0: 6579 7320 3d20 6b65 7973 7661 6c75 6573  eys = keysvalues
+0002d5e0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0002d5f0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+0002d600: 7572 7320 3d20 7365 6c66 2e5f 5f66 6c6f  urs = self.__flo
+0002d610: 6174 6f68 6578 2861 6c6c 7661 6c75 6573  atohex(allvalues
+0002d620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002d630: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
+0002d640: 726b 6579 203d 2073 7472 2872 6f75 6e64  rkey = str(round
+0002d650: 2866 6c6f 6174 2863 6f6e 746f 7572 292c  (float(contour),
+0002d660: 2036 2929 0a20 2020 2020 2020 2020 2020   6)).           
+0002d670: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0002d680: 746f 7572 6469 6374 5b63 6f6e 746f 7572  tourdict[contour
+0002d690: 6b65 795d 203d 204f 7264 6572 6564 4469  key] = OrderedDi
+0002d6a0: 6374 285b 2827 636f 6c6f 7227 2c20 636f  ct([('color', co
+0002d6b0: 6c6f 7572 7329 2c20 2827 696e 636c 7573  lours), ('inclus
+0002d6c0: 696f 6e27 2c20 616c 6c76 616c 7565 7329  ion', allvalues)
+0002d6d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d710: 2028 2772 6573 6964 7565 272c 2061 6c6c   ('residue', all
+0002d720: 6b65 7973 295d 290a 0a20 2020 2020 2020  keys)])..       
+0002d730: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0002d740: 746f 7572 6469 6374 5b27 6e61 6d65 275d  tourdict['name']
+0002d750: 203d 206b 6579 0a20 2020 2020 2020 2020   = key.         
+0002d760: 2020 2020 2020 2020 2020 2072 6573 6469             resdi
+0002d770: 6374 5b73 7472 2863 6f75 6e74 6572 295d  ct[str(counter)]
+0002d780: 203d 2063 6f6e 746f 7572 6469 6374 0a20   = contourdict. 
+0002d790: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002d7a0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+0002d7b0: 2020 2020 2020 2020 2020 2065 7272 203d             err =
+0002d7c0: 2027 5265 7369 6475 6520 696e 636c 7573   'Residue inclus
+0002d7d0: 696f 6e20 6361 6c63 756c 6174 696f 6e20  ion calculation 
+0002d7e0: 6572 726f 7228 4d6f 6465 6c3a 207b 7d29  error(Model: {})
+0002d7f0: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 6b65  : {}.'.format(ke
+0002d800: 792c 2073 7973 2e65 7863 5f69 6e66 6f28  y, sys.exc_info(
+0002d810: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+0002d820: 2020 2020 2020 2020 2020 7265 7365 7272            reserr
+0002d830: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
+0002d840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d850: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+0002d860: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
+0002d870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002d880: 2020 6966 2072 6573 6572 726c 6973 743a    if reserrlist:
+0002d890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d8a0: 2020 2020 2072 6573 6469 6374 5b73 7472       resdict[str
+0002d8b0: 2863 6f75 6e74 6572 295d 203d 207b 2765  (counter)] = {'e
+0002d8c0: 7272 273a 207b 2772 6573 6964 7565 5f69  rr': {'residue_i
+0002d8d0: 6e63 6c75 7369 6f6e 5f65 7272 273a 2072  nclusion_err': r
+0002d8e0: 6573 6572 726c 6973 747d 7d0a 2020 2020  eserrlist}}.    
+0002d8f0: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+0002d900: 7465 7220 2b3d 2031 0a0a 2020 2020 2020  ter += 1..      
+0002d910: 2020 2020 2020 6966 2061 6c6c 6d6f 6465        if allmode
+0002d920: 6c73 5f6e 756d 6265 7261 746f 6d73 2021  ls_numberatoms !
+0002d930: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0002d940: 2020 2020 2061 7665 7261 6765 5f61 695f       average_ai_
+0002d950: 616c 6c6d 6f64 656c 7320 3d20 616c 6c6d  allmodels = allm
+0002d960: 6f64 656c 735f 6174 6f6d 5f69 6e63 6c75  odels_atom_inclu
+0002d970: 7369 6f6e 202f 2061 6c6c 6d6f 6465 6c73  sion / allmodels
+0002d980: 5f6e 756d 6265 7261 746f 6d73 0a20 2020  _numberatoms.   
+0002d990: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0002d9a0: 6164 6963 745b 2761 7665 7261 6765 5f61  adict['average_a
+0002d9b0: 695f 616c 6c6d 6f64 656c 7327 5d20 3d20  i_allmodels'] = 
+0002d9c0: 726f 756e 6428 6176 6572 6167 655f 6169  round(average_ai
+0002d9d0: 5f61 6c6c 6d6f 6465 6c73 2c20 3329 0a20  _allmodels, 3). 
+0002d9e0: 2020 2020 2020 2020 2020 2061 746f 6d69             atomi
+0002d9f0: 6e64 6963 745b 2761 746f 6d5f 696e 636c  ndict['atom_incl
+0002da00: 7573 696f 6e5f 6279 5f6c 6576 656c 275d  usion_by_level']
+0002da10: 203d 2064 6174 6164 6963 740a 2020 2020   = datadict.    
+0002da20: 2020 2020 2020 2020 7265 7369 6e64 6963          resindic
+0002da30: 745b 2772 6573 6964 7565 5f69 6e63 6c75  t['residue_inclu
+0002da40: 7369 6f6e 275d 203d 2072 6573 6469 6374  sion'] = resdict
+0002da50: 0a0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+0002da60: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0002da70: 2020 2077 6974 6820 636f 6465 6373 2e6f     with codecs.o
+0002da80: 7065 6e28 7365 6c66 2e77 6f72 6b64 6972  pen(self.workdir
+0002da90: 202b 2073 656c 662e 6d61 706e 616d 6520   + self.mapname 
+0002daa0: 2b20 275f 6174 6f6d 5f69 6e63 6c75 7369  + '_atom_inclusi
+0002dab0: 6f6e 2e6a 736f 6e27 2c20 2777 272c 0a20  on.json', 'w',. 
+0002dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dae0: 656e 636f 6469 6e67 3d27 7574 662d 3827  encoding='utf-8'
+0002daf0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
+0002db00: 2020 2020 2020 2020 2020 2020 6a73 6f6e              json
+0002db10: 2e64 756d 7028 6174 6f6d 696e 6469 6374  .dump(atomindict
+0002db20: 2c20 6629 0a20 2020 2020 2020 2020 2020  , f).           
+0002db30: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+0002db40: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0002db50: 6572 722e 7772 6974 6528 2753 6176 696e  err.write('Savin
+0002db60: 6720 746f 2061 746f 6d20 696e 636c 7573  g to atom inclus
+0002db70: 696f 6e20 6a73 6f6e 2065 7272 6f72 3a20  ion json error: 
+0002db80: 7b7d 2e5c 6e27 2e66 6f72 6d61 7428 7379  {}.\n'.format(sy
+0002db90: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
+0002dba0: 290a 0a20 2020 2020 2020 2020 2020 2074  )..            t
+0002dbb0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0002dbc0: 2020 2020 7769 7468 2063 6f64 6563 732e      with codecs.
+0002dbd0: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
+0002dbe0: 7220 2b20 7365 6c66 2e6d 6170 6e61 6d65  r + self.mapname
+0002dbf0: 202b 2027 5f72 6573 6964 7565 5f69 6e63   + '_residue_inc
+0002dc00: 6c75 7369 6f6e 2e6a 736f 6e27 2c20 2777  lusion.json', 'w
+0002dc10: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0002dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc30: 2020 2020 656e 636f 6469 6e67 3d27 7574      encoding='ut
+0002dc40: 662d 3827 2920 6173 2066 313a 0a20 2020  f-8') as f1:.   
+0002dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc60: 206a 736f 6e2e 6475 6d70 2872 6573 696e   json.dump(resin
+0002dc70: 6469 6374 2c20 6631 290a 2020 2020 2020  dict, f1).      
+0002dc80: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0002dc90: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0002dca0: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
+0002dcb0: 5361 7669 6e67 2074 6f20 7265 7369 6475  Saving to residu
+0002dcc0: 6520 696e 636c 7573 696f 6e20 6a73 6f6e  e inclusion json
+0002dcd0: 2065 7272 6f72 3a20 7b7d 2e5c 6e27 2e66   error: {}.\n'.f
+0002dce0: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
+0002dcf0: 666f 2829 5b31 5d29 290a 0a0a 0a20 2020  fo()[1]))....   
+0002dd00: 2020 2020 2020 2020 2065 6e64 203d 2074           end = t
+0002dd10: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
+0002dd20: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
+0002dd30: 2020 7072 696e 7428 2749 6e63 6c75 7369    print('Inclusi
+0002dd40: 6f6e 2074 696d 653a 2025 7327 2025 2028  on time: %s' % (
+0002dd50: 656e 6420 2d20 7374 6172 7429 290a 2020  end - start)).  
+0002dd60: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0002dd70: 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '---------------
+0002dd80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002dd90: 2d2d 2d2d 2d27 290a 2020 2020 2020 2020  -----').        
+0002dda0: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+0002ddb0: 2023 2056 6f6c 756d 6563 6f6e 746f 7572   # Volumecontour
+0002ddc0: 0a0a 2020 2020 2320 4070 726f 6669 6c65  ..    # @profile
+0002ddd0: 0a20 2020 2064 6566 2076 6f6c 756d 6563  .    def volumec
+0002dde0: 6f6e 746f 7572 2873 656c 6629 3a0a 2020  ontour(self):.  
+0002ddf0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0002de00: 2020 2020 2020 2047 656e 6572 6174 6520         Generate 
+0002de10: 566f 6c75 6d65 2076 6572 7375 7320 636f  Volume versus co
+0002de20: 6e74 6f75 7220 6c65 7665 6c20 706c 6f74  ntour level plot
+0002de30: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
+0002de40: 7375 6c74 2077 726f 7465 2074 6f20 6120  sult wrote to a 
+0002de50: 4a53 4f4e 2066 696c 652e 0a20 2020 2020  JSON file..     
+0002de60: 2020 2020 2020 2056 6965 7720 696e 6469         View indi
+0002de70: 6365 7320 6173 2073 6974 696e 6720 6f6e  ces as siting on
+0002de80: 2074 6865 2063 656e 7472 616c 206f 6620   the central of 
+0002de90: 6561 6368 2076 6f78 656c 2c20 6e6f 2069  each voxel, no i
+0002dea0: 6e74 6572 706f 6c61 7469 6f6e 206e 6565  nterpolation nee
+0002deb0: 6465 642e 0a0a 2020 2020 2020 2020 3a72  ded...        :r
+0002dec0: 6574 7572 6e3a 204e 6f6e 650a 0a20 2020  eturn: None..   
+0002ded0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0002dee0: 2020 7374 6172 7420 3d20 7469 6d65 6974    start = timeit
+0002def0: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
+0002df00: 0a20 2020 2020 2020 206d 6170 203d 2073  .        map = s
+0002df10: 656c 662e 6d61 700a 2020 2020 2020 2020  elf.map.        
+0002df20: 2320 7465 6d70 7261 7279 2073 6f6c 7574  # temprary solut
+0002df30: 696f 6e20 6173 2074 6865 2074 656d 7079  ion as the tempy
+0002df40: 2067 6976 6520 6170 6978 2061 7320 6f6e   give apix as on
+0002df50: 6520 7661 6c75 6520 6275 7420 6865 7265  e value but here
+0002df60: 2066 726f 6d20 6d72 6366 696c 6520 7765   from mrcfile we
+0002df70: 2075 7365 2061 2074 7570 6c65 0a20 2020   use a tuple.   
+0002df80: 2020 2020 2023 2063 6865 636b 2066 756e       # check fun
+0002df90: 6374 696f 6e6e 2066 726f 6d6d 7263 5f74  ctionn frommrc_t
+0002dfa0: 6f74 656d 7079 2069 6e20 7072 6570 6172  otempy in prepar
+0002dfb0: 6174 696f 6e2e 7079 0a20 2020 2020 2020  ation.py.       
+0002dfc0: 2061 7069 7820 3d20 6d61 702e 766f 7865   apix = map.voxe
+0002dfd0: 6c5f 7369 7a65 2e74 6f6c 6973 7428 290a  l_size.tolist().
+0002dfe0: 2020 2020 2020 2020 6d61 7064 6174 6120          mapdata 
+0002dff0: 3d20 6d61 702e 6461 7461 0a20 2020 2020  = map.data.     
+0002e000: 2020 2065 7272 6c69 7374 203d 205b 5d0a     errlist = [].
+0002e010: 2020 2020 2020 2020 6461 7461 6469 6374          datadict
+0002e020: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+0002e030: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0002e040: 2020 2062 696e 7320 3d20 6e70 2e6c 696e     bins = np.lin
+0002e050: 7370 6163 6528 6d61 7064 6174 612e 6d69  space(mapdata.mi
+0002e060: 6e28 292c 206d 6170 6461 7461 2e6d 6178  n(), mapdata.max
+0002e070: 2829 2c20 3132 3929 0a20 2020 2020 2020  (), 129).       
+0002e080: 2020 2020 2068 6973 742c 2062 696e 5f65       hist, bin_e
+0002e090: 6467 6573 203d 206e 702e 6869 7374 6f67  dges = np.histog
+0002e0a0: 7261 6d28 6d61 7064 6174 612c 2062 696e  ram(mapdata, bin
+0002e0b0: 733d 6269 6e73 290a 2020 2020 2020 2020  s=bins).        
+0002e0c0: 2020 2020 6d61 7073 697a 6520 3d20 6d61      mapsize = ma
+0002e0d0: 702e 6865 6164 6572 2e6e 7820 2a20 6d61  p.header.nx * ma
+0002e0e0: 702e 6865 6164 6572 2e6e 7920 2a20 6d61  p.header.ny * ma
+0002e0f0: 702e 6865 6164 6572 2e6e 7a0a 2020 2020  p.header.nz.    
+0002e100: 2020 2020 2020 2020 7072 6572 6573 756c          preresul
+0002e110: 7420 3d20 6d61 7073 697a 6520 2d20 6e70  t = mapsize - np
+0002e120: 2e63 756d 7375 6d28 6869 7374 290a 2020  .cumsum(hist).  
+0002e130: 2020 2020 2020 2020 2020 6164 6465 6470            addedp
+0002e140: 7265 203d 206e 702e 696e 7365 7274 2870  re = np.insert(p
+0002e150: 7265 7265 7375 6c74 2c20 302c 206d 6170  reresult, 0, map
+0002e160: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+0002e170: 2020 2320 546f 646f 3a20 666f 7220 6e6f    # Todo: for no
+0002e180: 6e2d 6f72 7468 6f67 6f6e 616c 2076 6f6c  n-orthogonal vol
+0002e190: 756d 6520 7468 6973 2069 7320 6e6f 7420  ume this is not 
+0002e1a0: 7468 6520 7269 6768 7420 666f 726d 756c  the right formul
+0002e1b0: 610a 2020 2020 2020 2020 2020 2020 2320  a.            # 
+0002e1c0: 4974 206e 6565 6473 2074 6865 2066 6f72  It needs the for
+0002e1d0: 6d75 6c61 203a 2061 6263 2a20 7371 7274  mula : abc* sqrt
+0002e1e0: 2831 202b 2032 2a63 6f73 2861 292a 636f  (1 + 2*cos(a)*co
+0002e1f0: 7328 6229 2a62 6f73 2863 2920 2d20 636f  s(b)*bos(c) - co
+0002e200: 7328 6129 2a2a 3220 2d20 636f 7328 6229  s(a)**2 - cos(b)
+0002e210: 2a2a 3220 2d20 636f 7328 6329 2a2a 3229  **2 - cos(c)**2)
+0002e220: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002e230: 7479 7065 2861 7069 7829 2069 7320 7475  type(apix) is tu
+0002e240: 706c 653a 0a20 2020 2020 2020 2020 2020  ple:.           
+0002e250: 2020 2020 2062 6173 6576 6f6c 756d 6520       basevolume 
+0002e260: 3d20 2828 6170 6978 5b30 5d2a 6170 6978  = ((apix[0]*apix
+0002e270: 5b31 5d2a 6170 6978 5b32 5d29 202f 2028  [1]*apix[2]) / (
+0002e280: 3130 202a 2a20 3329 290a 2020 2020 2020  10 ** 3)).      
+0002e290: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002e2a0: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0002e2b0: 766f 6c75 6d65 203d 2028 2861 7069 782a  volume = ((apix*
+0002e2c0: 2a33 2920 2f20 2831 302a 2a33 2929 0a20  *3) / (10**3)). 
+0002e2d0: 2020 2020 2020 2020 2020 2074 6d70 7265             tmpre
+0002e2e0: 7375 6c74 203d 2061 6464 6564 7072 6520  sult = addedpre 
+0002e2f0: 2a20 6261 7365 766f 6c75 6d65 0a20 2020  * basevolume.   
+0002e300: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0002e310: 2e63 6c3a 0a20 2020 2020 2020 2020 2020  .cl:.           
+0002e320: 2020 2020 2063 6c76 6f6c 756d 6520 3d20       clvolume = 
+0002e330: 286d 6170 6461 7461 203e 3d20 7365 6c66  (mapdata >= self
+0002e340: 2e63 6c29 2e73 756d 2829 0a20 2020 2020  .cl).sum().     
+0002e350: 2020 2020 2020 2020 2020 2065 7374 766f             estvo
+0002e360: 6c75 6d65 203d 2072 6f75 6e64 2863 6c76  lume = round(clv
+0002e370: 6f6c 756d 6520 2a20 6261 7365 766f 6c75  olume * basevolu
+0002e380: 6d65 2c20 3229 0a20 2020 2020 2020 2020  me, 2).         
+0002e390: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002e3a0: 2020 2020 2020 2020 2065 7374 766f 6c75           estvolu
+0002e3b0: 6d65 203d 204e 6f6e 650a 0a20 2020 2020  me = None..     
+0002e3c0: 2020 2020 2020 2069 6620 6573 7476 6f6c         if estvol
+0002e3d0: 756d 653a 0a20 2020 2020 2020 2020 2020  ume:.           
+0002e3e0: 2020 2020 2064 6174 6164 6963 7420 3d20       datadict = 
+0002e3f0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0002e400: 2020 2020 2020 2776 6f6c 756d 655f 6573        'volume_es
+0002e410: 7469 6d61 7465 273a 207b 2776 6f6c 756d  timate': {'volum
+0002e420: 6527 3a20 6e70 2e72 6f75 6e64 2874 6d70  e': np.round(tmp
+0002e430: 7265 7375 6c74 2c20 3130 292e 746f 6c69  result, 10).toli
+0002e440: 7374 2829 2c0a 2020 2020 2020 2020 2020  st(),.          
+0002e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e460: 2020 2020 2020 2020 2020 2020 2020 276c                'l
+0002e470: 6576 656c 273a 206e 702e 726f 756e 6428  evel': np.round(
+0002e480: 6269 6e73 2c20 3130 292e 746f 6c69 7374  bins, 10).tolist
+0002e490: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+0002e4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e4b0: 2020 2020 2020 2020 2020 2020 2765 7374              'est
+0002e4c0: 766f 6c75 6d65 273a 2065 7374 766f 6c75  volume': estvolu
+0002e4d0: 6d65 7d7d 0a20 2020 2020 2020 2020 2020  me}}.           
+0002e4e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002e4f0: 2020 2020 2020 2064 6174 6164 6963 7420         datadict 
+0002e500: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+0002e510: 2020 2020 2020 2020 2776 6f6c 756d 655f          'volume_
+0002e520: 6573 7469 6d61 7465 273a 207b 2776 6f6c  estimate': {'vol
+0002e530: 756d 6527 3a20 6e70 2e72 6f75 6e64 2874  ume': np.round(t
+0002e540: 6d70 7265 7375 6c74 2c20 3130 292e 746f  mpresult, 10).to
+0002e550: 6c69 7374 2829 2c0a 2020 2020 2020 2020  list(),.        
+0002e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e580: 276c 6576 656c 273a 206e 702e 726f 756e  'level': np.roun
+0002e590: 6428 6269 6e73 2c20 3130 292e 746f 6c69  d(bins, 10).toli
+0002e5a0: 7374 2829 7d7d 0a20 2020 2020 2020 2065  st()}}.        e
+0002e5b0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+0002e5c0: 2020 2065 7272 203d 2027 566f 6c75 6d65     err = 'Volume
+0002e5d0: 2065 7374 696d 6174 6520 6361 6c63 756c   estimate calcul
+0002e5e0: 6174 696f 6e20 6572 726f 723a 207b 7d2e  ation error: {}.
+0002e5f0: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
+0002e600: 5f69 6e66 6f28 295b 315d 290a 2020 2020  _info()[1]).    
+0002e610: 2020 2020 2020 2020 6572 726c 6973 742e          errlist.
+0002e620: 6170 7065 6e64 2865 7272 290a 2020 2020  append(err).    
+0002e630: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+0002e640: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
+0002e650: 5c6e 2729 0a20 2020 2020 2020 2069 6620  \n').        if 
+0002e660: 6572 726c 6973 743a 0a20 2020 2020 2020  errlist:.       
+0002e670: 2020 2020 2064 6174 6164 6963 7420 3d20       datadict = 
+0002e680: 7b27 766f 6c75 6d65 5f65 7374 696d 6174  {'volume_estimat
+0002e690: 6527 3a20 7b27 6572 7227 3a20 7b27 766f  e': {'err': {'vo
+0002e6a0: 6c75 6d65 5f65 7374 696d 6174 655f 6572  lume_estimate_er
+0002e6b0: 726f 7227 3a20 6572 726c 6973 747d 7d7d  ror': errlist}}}
+0002e6c0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0002e6d0: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+0002e6e0: 6f64 6563 732e 6f70 656e 2873 656c 662e  odecs.open(self.
+0002e6f0: 776f 726b 6469 7220 2b20 7365 6c66 2e6d  workdir + self.m
+0002e700: 6170 6e61 6d65 202b 2027 5f76 6f6c 756d  apname + '_volum
+0002e710: 655f 636f 6e74 6f75 722e 6a73 6f6e 272c  e_contour.json',
+0002e720: 2027 7727 2c0a 2020 2020 2020 2020 2020   'w',.          
+0002e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e740: 2020 2065 6e63 6f64 696e 673d 2775 7466     encoding='utf
+0002e750: 2d38 2729 2061 7320 663a 0a20 2020 2020  -8') as f:.     
+0002e760: 2020 2020 2020 2020 2020 206a 736f 6e2e             json.
+0002e770: 6475 6d70 2864 6174 6164 6963 742c 2066  dump(datadict, f
+0002e780: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+0002e790: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+0002e7a0: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
+0002e7b0: 5361 7669 6e67 2076 6f6c 756d 6520 6573  Saving volume es
+0002e7c0: 7469 6d61 7465 2074 6f20 6a73 6f6e 2065  timate to json e
+0002e7d0: 7272 6f72 3a7b 7d2e 5c6e 272e 666f 726d  rror:{}.\n'.form
+0002e7e0: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
+0002e7f0: 295b 315d 2929 0a0a 2020 2020 2020 2020  )[1]))..        
+0002e800: 656e 6420 3d20 7469 6d65 6974 2e64 6566  end = timeit.def
+0002e810: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
+0002e820: 2020 2020 2070 7269 6e74 2827 566f 6c75       print('Volu
+0002e830: 6d65 2063 6f6e 746f 7572 2074 696d 653a  me contour time:
+0002e840: 2025 7327 2025 2028 656e 6420 2d20 7374   %s' % (end - st
+0002e850: 6172 7429 290a 2020 2020 2020 2020 7072  art)).        pr
+0002e860: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
+0002e870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0002e880: 2d2d 2d2d 2d2d 2d2d 2d27 290a 0a20 2020  ---------')..   
+0002e890: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0002e8a0: 0a0a 0a0a 0a0a 2020 2020 2323 2323 2323  ......    ######
+0002e8b0: 2323 2323 2323 2323 2323 2323 2320 7465  ############# te
+0002e8c0: 7374 0a0a 2020 2020 2320 6465 6620 7073  st..    # def ps
+0002e8d0: 7375 6d28 7365 6c66 2c69 2c20 6469 7374  sum(self,i, dist
+0002e8e0: 2c20 696e 6469 6178 6973 293a 0a20 2020  , indiaxis):.   
+0002e8f0: 2023 2020 2020 2069 6620 6920 213d 206c   #     if i != l
+0002e900: 656e 2869 6e64 6961 7869 7329 202d 2031  en(indiaxis) - 1
+0002e910: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+0002e920: 696e 6469 6365 7320 3d20 6e70 2e61 7267  indices = np.arg
+0002e930: 7768 6572 6528 2864 6973 7420 3e20 696e  where((dist > in
+0002e940: 6469 6178 6973 745b 695d 2920 2620 2864  diaxist[i]) & (d
+0002e950: 6973 7420 3c3d 2069 6e64 6961 7869 7374  ist <= indiaxist
+0002e960: 5b69 202b 2031 5d29 290a 2020 2020 2320  [i + 1])).    # 
+0002e970: 2020 2020 2020 2020 7073 756d 203d 206c          psum = l
+0002e980: 6f67 3130 2870 736d 6170 2e66 756c 6c4d  og10(psmap.fullM
+0002e990: 6170 5b74 7570 6c65 2869 6e64 6963 6573  ap[tuple(indices
+0002e9a0: 2e54 295d 2e73 756d 2829 202f 206c 656e  .T)].sum() / len
+0002e9b0: 2869 6e64 6963 6573 2929 0a20 2020 2023  (indices)).    #
+0002e9c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002e9d0: 7073 756d 0a0a 2020 2020 2320 6465 6620  psum..    # def 
+0002e9e0: 7073 7375 6d28 7365 6c66 2c69 6e64 6963  pssum(self,indic
+0002e9f0: 6573 293a 0a20 2020 2023 2020 2020 2023  es):.    #     #
+0002ea00: 2069 6620 6920 213d 206c 656e 2869 6e64   if i != len(ind
+0002ea10: 6961 7869 7329 202d 2031 3a0a 2020 2020  iaxis) - 1:.    
+0002ea20: 2320 2020 2020 2320 696e 6469 6365 7320  #     # indices 
+0002ea30: 3d20 6e70 2e61 7267 7768 6572 6528 2864  = np.argwhere((d
+0002ea40: 6973 7420 3e20 696e 6469 6178 6973 745b  ist > indiaxist[
+0002ea50: 695d 2920 2620 2864 6973 7420 3c3d 2069  i]) & (dist <= i
+0002ea60: 6e64 6961 7869 7374 5b69 202b 2031 5d29  ndiaxist[i + 1])
+0002ea70: 290a 2020 2020 2320 2020 2020 7073 756d  ).    #     psum
+0002ea80: 203d 206c 6f67 3130 2870 736d 6170 2e66   = log10(psmap.f
+0002ea90: 756c 6c4d 6170 5b74 7570 6c65 2869 6e64  ullMap[tuple(ind
+0002eaa0: 6963 6573 2e54 295d 2e73 756d 2829 202f  ices.T)].sum() /
+0002eab0: 206c 656e 2869 6e64 6963 6573 2929 0a20   len(indices)). 
+0002eac0: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+0002ead0: 7073 756d 0a0a 0a20 2020 2064 6566 2070  psum...    def p
+0002eae0: 6172 6172 6170 7328 7365 6c66 293a 0a20  araraps(self):. 
+0002eaf0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0002eb00: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
+0002eb10: 696f 6e20 6f66 2074 6865 2072 6f74 6174  ion of the rotat
+0002eb20: 696f 6e61 6c6c 7920 6176 6572 6167 6520  ionally average 
+0002eb30: 706f 7765 7220 7370 6563 7472 756d 2028  power spectrum (
+0002eb40: 5241 5053 290a 2020 2020 2020 2020 2020  RAPS).          
+0002eb50: 2020 5265 7375 6c74 7320 7772 6f74 6520    Results wrote 
+0002eb60: 746f 204a 534f 4e20 6669 6c65 0a0a 2020  to JSON file..  
+0002eb70: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
+0002eb80: 6f6e 650a 0a20 2020 2020 2020 2022 2222  one..        """
+0002eb90: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+0002eba0: 6d75 6c74 6970 726f 6365 7373 696e 6720  multiprocessing 
+0002ebb0: 6173 206d 700a 2020 2020 2020 2020 696d  as mp.        im
+0002ebc0: 706f 7274 2069 7465 7274 6f6f 6c73 0a20  port itertools. 
+0002ebd0: 2020 2020 2020 2074 6872 6561 6463 6f75         threadcou
+0002ebe0: 6e74 203d 2032 0a20 2020 2020 2020 2070  nt = 2.        p
+0002ebf0: 6f6f 6c20 3d20 6d70 2e50 6f6f 6c28 7468  ool = mp.Pool(th
+0002ec00: 7265 6164 636f 756e 7429 0a0a 2020 2020  readcount)..    
+0002ec10: 2020 2020 6966 2073 656c 662e 6d61 702e      if self.map.
+0002ec20: 785f 7369 7a65 2829 203d 3d20 7365 6c66  x_size() == self
+0002ec30: 2e6d 6170 2e79 5f73 697a 6528 2920 3d3d  .map.y_size() ==
+0002ec40: 2073 656c 662e 6d61 702e 7a5f 7369 7a65   self.map.z_size
+0002ec50: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0002ec60: 6572 726c 6973 7420 3d20 5b5d 0a20 2020  errlist = [].   
+0002ec70: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+0002ec80: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
+0002ec90: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
+0002eca0: 2020 2020 6d61 7020 3d20 7365 6c66 2e6d      map = self.m
+0002ecb0: 6170 0a20 2020 2020 2020 2020 2020 2061  ap.            a
+0002ecc0: 7069 7820 3d20 6d61 702e 6170 6978 0a20  pix = map.apix. 
+0002ecd0: 2020 2020 2020 2020 2020 2066 6674 6d61             fftma
+0002ece0: 7020 3d20 6d61 702e 666f 7572 6965 725f  p = map.fourier_
+0002ecf0: 7472 616e 7366 6f72 6d28 290a 2020 2020  transform().    
+0002ed00: 2020 2020 2020 2020 7073 6d61 7020 3d20          psmap = 
+0002ed10: 6666 746d 6170 2e63 6f70 7928 290a 2020  fftmap.copy().  
+0002ed20: 2020 2020 2020 2020 2020 7073 6d65 616e            psmean
+0002ed30: 203d 206e 702e 6d65 616e 2870 736d 6170   = np.mean(psmap
+0002ed40: 2e66 756c 6c4d 6170 290a 2020 2020 2020  .fullMap).      
+0002ed50: 2020 2020 2020 7073 7374 6420 3d20 6e70        psstd = np
+0002ed60: 2e73 7464 2870 736d 6170 2e66 756c 6c4d  .std(psmap.fullM
+0002ed70: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
+0002ed80: 7073 6d61 702e 6675 6c6c 4d61 7020 3d20  psmap.fullMap = 
+0002ed90: 6e70 2e61 6273 2828 7073 6d61 702e 6675  np.abs((psmap.fu
+0002eda0: 6c6c 4d61 7020 2d20 7073 6d65 616e 2920  llMap - psmean) 
+0002edb0: 2f20 7073 7374 6429 202a 2a20 320a 0a20  / psstd) ** 2.. 
+0002edc0: 2020 2020 2020 2020 2020 206d 6964 7374             midst
+0002edd0: 6172 7420 3d20 7469 6d65 6974 2e64 6566  art = timeit.def
+0002ede0: 6175 6c74 5f74 696d 6572 2829 202d 2073  ault_timer() - s
+0002edf0: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
+0002ee00: 2070 7269 6e74 2827 202d 2d20 5241 5053   print(' -- RAPS
+0002ee10: 2046 6f75 7269 6572 2d74 7261 6e73 666f   Fourier-transfo
+0002ee20: 726d 6174 696f 6e20 7469 6d65 3a20 2573  rmation time: %s
+0002ee30: 2720 2520 6d69 6473 7461 7274 290a 0a20  ' % midstart).. 
+0002ee40: 2020 2020 2020 2020 2020 207a 6772 6964             zgrid
+0002ee50: 203d 206e 702e 6172 616e 6765 2866 6c6f   = np.arange(flo
+0002ee60: 6f72 2870 736d 6170 2e7a 5f73 697a 6528  or(psmap.z_size(
+0002ee70: 2920 2f20 322e 3029 202a 202d 312c 2063  ) / 2.0) * -1, c
+0002ee80: 6569 6c28 7073 6d61 702e 7a5f 7369 7a65  eil(psmap.z_size
+0002ee90: 2829 202f 2032 2e30 2929 202f 2066 6c6f  () / 2.0)) / flo
+0002eea0: 6174 2866 6c6f 6f72 2870 736d 6170 2e7a  at(floor(psmap.z
+0002eeb0: 5f73 697a 6528 2929 290a 2020 2020 2020  _size())).      
+0002eec0: 2020 2020 2020 7967 7269 6420 3d20 6e70        ygrid = np
+0002eed0: 2e61 7261 6e67 6528 666c 6f6f 7228 7073  .arange(floor(ps
+0002eee0: 6d61 702e 795f 7369 7a65 2829 202f 2032  map.y_size() / 2
+0002eef0: 2e30 2920 2a20 2d31 2c20 6365 696c 2870  .0) * -1, ceil(p
+0002ef00: 736d 6170 2e79 5f73 697a 6528 2920 2f20  smap.y_size() / 
+0002ef10: 322e 3029 2920 2f20 666c 6f61 7428 666c  2.0)) / float(fl
+0002ef20: 6f6f 7228 7073 6d61 702e 795f 7369 7a65  oor(psmap.y_size
+0002ef30: 2829 2929 0a20 2020 2020 2020 2020 2020  ())).           
+0002ef40: 2078 6772 6964 203d 206e 702e 6172 616e   xgrid = np.aran
+0002ef50: 6765 2866 6c6f 6f72 2870 736d 6170 2e78  ge(floor(psmap.x
+0002ef60: 5f73 697a 6528 2920 2f20 322e 3029 202a  _size() / 2.0) *
+0002ef70: 202d 312c 2063 6569 6c28 7073 6d61 702e   -1, ceil(psmap.
+0002ef80: 785f 7369 7a65 2829 202f 2032 2e30 2929  x_size() / 2.0))
+0002ef90: 202f 2066 6c6f 6174 2866 6c6f 6f72 2870   / float(floor(p
+0002efa0: 736d 6170 2e78 5f73 697a 6528 2929 290a  smap.x_size())).
+0002efb0: 2020 2020 2020 2020 2020 2020 7864 6973              xdis
+0002efc0: 203d 2078 6772 6964 202a 2a20 320a 2020   = xgrid ** 2.  
+0002efd0: 2020 2020 2020 2020 2020 7964 6973 203d            ydis =
+0002efe0: 2079 6772 6964 202a 2a20 320a 2020 2020   ygrid ** 2.    
+0002eff0: 2020 2020 2020 2020 7a64 6973 203d 207a          zdis = z
+0002f000: 6772 6964 202a 2a20 320a 2020 2020 2020  grid ** 2.      
+0002f010: 2020 2020 2020 6469 7374 203d 206e 702e        dist = np.
+0002f020: 7371 7274 287a 6469 735b 3a2c 204e 6f6e  sqrt(zdis[:, Non
+0002f030: 652c 204e 6f6e 655d 202b 2079 6469 735b  e, None] + ydis[
+0002f040: 3a2c 204e 6f6e 655d 202b 2078 6469 7329  :, None] + xdis)
+0002f050: 0a0a 2020 2020 2020 2020 2020 2020 616c  ..            al
+0002f060: 6c61 7869 7320 3d20 5b7a 6772 6964 2c20  laxis = [zgrid, 
+0002f070: 7967 7269 642c 2078 6772 6964 5d0a 2020  ygrid, xgrid].  
+0002f080: 2020 2020 2020 2020 2020 746d 7069 6e64            tmpind
+0002f090: 6961 7869 7320 3d20 6d61 7828 616c 6c61  iaxis = max(alla
+0002f0a0: 7869 732c 206b 6579 3d6c 656e 290a 2020  xis, key=len).  
+0002f0b0: 2020 2020 2020 2020 2020 696e 6469 6178            indiax
+0002f0c0: 6973 7420 3d20 746d 7069 6e64 6961 7869  ist = tmpindiaxi
+0002f0d0: 735b 746d 7069 6e64 6961 7869 7320 3e3d  s[tmpindiaxis >=
+0002f0e0: 2030 5d0a 2020 2020 2020 2020 2020 2020   0].            
+0002f0f0: 696e 6469 6178 6973 203d 206e 702e 6c69  indiaxis = np.li
+0002f100: 6e73 7061 6365 2830 2c20 3120 2f20 2832  nspace(0, 1 / (2
+0002f110: 202a 2061 7069 7829 2c20 6c65 6e28 696e   * apix), len(in
+0002f120: 6469 6178 6973 7429 290a 2020 2020 2020  diaxist)).      
+0002f130: 2020 2020 2020 7072 696e 7428 2764 6973        print('dis
+0002f140: 743a 2729 0a20 2020 2020 2020 2020 2020  t:').           
+0002f150: 2070 7269 6e74 2861 6c6c 6178 6973 290a   print(allaxis).
+0002f160: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0002f170: 7428 6469 7374 2e73 6861 7065 290a 2020  t(dist.shape).  
+0002f180: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0002f190: 696e 6469 6178 6973 290a 2020 2020 2020  indiaxis).      
+0002f1a0: 2020 2020 2020 7072 696e 7428 7073 6d61        print(psma
+0002f1b0: 702e 7a5f 7369 7a65 2829 290a 2020 2020  p.z_size()).    
+0002f1c0: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+0002f1d0: 2d2d 2d2d 2d2d 2729 0a20 2020 2020 2020  ------').       
+0002f1e0: 2020 2020 2070 7269 6e74 2864 6973 745b       print(dist[
+0002f1f0: 3938 2c39 362c 3936 5d29 0a0a 0a20 2020  98,96,96])...   
+0002f200: 2020 2020 2020 2020 2061 7073 203d 205b           aps = [
+0002f210: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+0002f220: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+0002f230: 656e 2869 6e64 6961 7869 7329 293a 0a20  en(indiaxis)):. 
+0002f240: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0002f250: 2069 6620 6920 213d 206c 656e 2869 6e64   if i != len(ind
+0002f260: 6961 7869 7329 202d 2031 3a0a 2020 2020  iaxis) - 1:.    
+0002f270: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0002f280: 2020 696e 6469 6365 7320 3d20 6e70 2e61    indices = np.a
+0002f290: 7267 7768 6572 6528 2864 6973 7420 3e20  rgwhere((dist > 
+0002f2a0: 696e 6469 6178 6973 745b 695d 2920 2620  indiaxist[i]) & 
+0002f2b0: 2864 6973 7420 3c3d 2069 6e64 6961 7869  (dist <= indiaxi
+0002f2c0: 7374 5b69 202b 2031 5d29 290a 2020 2020  st[i + 1])).    
+0002f2d0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0002f2e0: 2020 7073 756d 203d 206c 6f67 3130 2870    psum = log10(p
+0002f2f0: 736d 6170 2e66 756c 6c4d 6170 5b74 7570  smap.fullMap[tup
+0002f300: 6c65 2869 6e64 6963 6573 2e54 295d 2e73  le(indices.T)].s
+0002f310: 756d 2829 202f 206c 656e 2869 6e64 6963  um() / len(indic
+0002f320: 6573 2929 0a20 2020 2020 2020 2020 2020  es)).           
+0002f330: 2023 2020 2020 2020 2020 2061 7073 2e61   #         aps.a
+0002f340: 7070 656e 6428 7073 756d 290a 0a20 2020  ppend(psum)..   
+0002f350: 2020 2020 2020 2020 2061 6c6c 696e 6469           allindi
+0002f360: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
+0002f370: 2020 2020 2061 6c6c 7073 6d61 7020 3d20       allpsmap = 
+0002f380: 5b5d 0a20 2020 2020 2020 2020 2020 2023  [].            #
+0002f390: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0002f3a0: 6c65 6e28 696e 6469 6178 6973 2929 3a0a  len(indiaxis)):.
+0002f3b0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0002f3c0: 2020 6966 2069 2021 3d20 6c65 6e28 696e    if i != len(in
+0002f3d0: 6469 6178 6973 2920 2d31 3a0a 2020 2020  diaxis) -1:.    
+0002f3e0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0002f3f0: 2020 696e 6469 6365 7320 3d20 6e70 2e61    indices = np.a
+0002f400: 7267 7768 6572 6528 2864 6973 7420 3e20  rgwhere((dist > 
+0002f410: 696e 6469 6178 6973 745b 695d 2920 2620  indiaxist[i]) & 
+0002f420: 2864 6973 7420 3c3d 2069 6e64 6961 7869  (dist <= indiaxi
+0002f430: 7374 5b69 202b 2031 5d29 290a 2020 2020  st[i + 1])).    
+0002f440: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+0002f450: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+0002f460: 7073 756d 203d 2070 736d 6170 2e66 756c  psum = psmap.ful
+0002f470: 6c4d 6170 5b74 7570 6c65 2869 6e64 6963  lMap[tuple(indic
+0002f480: 6573 2e54 295d 2e73 756d 2829 0a20 2020  es.T)].sum().   
+0002f490: 2020 2020 2020 2020 2023 2020 2020 2020           #      
+0002f4a0: 2020 2061 6c6c 696e 6469 6365 732e 6170     allindices.ap
+0002f4b0: 7065 6e64 2869 6e64 6963 6573 290a 2020  pend(indices).  
+0002f4c0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0002f4d0: 2020 2020 616c 6c70 736d 6170 2e61 7070      allpsmap.app
+0002f4e0: 656e 6428 7073 756d 290a 2020 2020 2020  end(psum).      
+0002f4f0: 2020 2020 2020 2320 7072 696e 7428 616c        # print(al
+0002f500: 6c69 6e64 6963 6573 290a 2020 2020 2020  lindices).      
+0002f510: 2020 2020 2020 6f64 6420 3d20 5b5d 0a20        odd = []. 
+0002f520: 2020 2020 2020 2020 2020 2065 7665 6e20             even 
+0002f530: 3d5b 5d0a 2020 2020 2020 2020 2020 2020  =[].            
+0002f540: 636f 756e 7465 7220 3d20 300a 2020 2020  counter = 0.    
+0002f550: 2020 2020 2020 2020 726c 6973 7420 3d20          rlist = 
+0002f560: 5b5d 0a20 2020 2020 2020 2020 2020 2074  [].            t
+0002f570: 656d 706c 6973 7420 3d20 5b5d 0a20 2020  emplist = [].   
+0002f580: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0002f590: 6e20 7261 6e67 6528 6c65 6e28 696e 6469  n range(len(indi
+0002f5a0: 6178 6973 292d 3129 3a0a 2020 2020 2020  axis)-1):.      
+0002f5b0: 2020 2020 2020 2020 2020 636f 756e 7465            counte
+0002f5c0: 7220 2b3d 2031 0a20 2020 2020 2020 2020  r += 1.         
+0002f5d0: 2020 2020 2020 2069 6620 6920 3d3d 2030         if i == 0
+0002f5e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002f5f0: 2020 2020 2020 7465 6d70 6c69 7374 2e61        templist.a
+0002f600: 7070 656e 6428 6929 0a20 2020 2020 2020  ppend(i).       
+0002f610: 2020 2020 2020 2020 2065 6c69 6620 6920           elif i 
+0002f620: 2520 3430 203d 3d20 303a 0a20 2020 2020  % 40 == 0:.     
+0002f630: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002f640: 6c69 7374 2e61 7070 656e 6428 7465 6d70  list.append(temp
+0002f650: 6c69 7374 290a 2020 2020 2020 2020 2020  list).          
+0002f660: 2020 2020 2020 2020 2020 7465 6d70 6c69            templi
+0002f670: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+0002f680: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0002f690: 6c69 7374 2e61 7070 656e 6428 6929 0a20  list.append(i). 
+0002f6a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002f6b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002f6c0: 2020 2020 2020 2020 2074 656d 706c 6973           templis
+0002f6d0: 742e 6170 7065 6e64 2869 290a 0a20 2020  t.append(i)..   
+0002f6e0: 2020 2020 2020 2020 2072 6c69 7374 2e61           rlist.a
+0002f6f0: 7070 656e 6428 7465 6d70 6c69 7374 290a  ppend(templist).
+0002f700: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+0002f710: 2073 706c 6974 5f6c 6973 7428 696e 705f   split_list(inp_
+0002f720: 6c69 7374 2c20 6e72 293a 0a20 2020 2020  list, nr):.     
+0002f730: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
+0002f740: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0002f750: 706c 6974 7320 6576 656e 6c79 2061 206c  plits evenly a l
+0002f760: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+0002f770: 2020 2020 3a70 6172 616d 2069 6e70 5f6c      :param inp_l
+0002f780: 6973 743a 206c 6973 740a 2020 2020 2020  ist: list.      
+0002f790: 2020 2020 2020 2020 2020 3a70 6172 616d            :param
+0002f7a0: 206e 723a 206e 756d 6265 7220 6f66 2070   nr: number of p
+0002f7b0: 6172 7473 0a20 2020 2020 2020 2020 2020  arts.           
+0002f7c0: 2020 2020 203a 7265 7475 726e 3a20 6c69       :return: li
+0002f7d0: 7374 206f 6620 226e 7222 206c 6973 7473  st of "nr" lists
+0002f7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f7f0: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+0002f800: 2020 2020 206e 6577 5f6c 6973 7420 3d20       new_list = 
+0002f810: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+0002f820: 2020 206e 725f 656c 203d 2031 2e30 202f     nr_el = 1.0 /
+0002f830: 206e 7220 2a20 6c65 6e28 696e 705f 6c69   nr * len(inp_li
+0002f840: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+0002f850: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0002f860: 6765 286e 7229 3a0a 2020 2020 2020 2020  ge(nr):.        
+0002f870: 2020 2020 2020 2020 2020 2020 7374 6172              star
+0002f880: 7420 3d20 696e 7428 726f 756e 6428 6920  t = int(round(i 
+0002f890: 2a20 6e72 5f65 6c29 290a 2020 2020 2020  * nr_el)).      
+0002f8a0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0002f8b0: 6420 3d20 696e 7428 726f 756e 6428 2869  d = int(round((i
+0002f8c0: 202b 2031 2920 2a20 6e72 5f65 6c29 290a   + 1) * nr_el)).
+0002f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f8e0: 2020 2020 6e65 775f 6c69 7374 2e61 7070      new_list.app
+0002f8f0: 656e 6428 696e 705f 6c69 7374 5b73 7461  end(inp_list[sta
+0002f900: 7274 3a65 6e64 5d29 0a20 2020 2020 2020  rt:end]).       
+0002f910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002f920: 6e65 775f 6c69 7374 0a20 2020 2020 2020  new_list.       
+0002f930: 2020 2020 2069 6e70 7574 6c69 7374 203d       inputlist =
+0002f940: 2072 616e 6765 2830 2c20 6c65 6e28 696e   range(0, len(in
+0002f950: 6469 6178 6973 292d 3129 0a20 2020 2020  diaxis)-1).     
+0002f960: 2020 2020 2020 2072 6c69 7374 203d 2073         rlist = s
+0002f970: 706c 6974 5f6c 6973 7428 696e 7075 746c  plit_list(inputl
+0002f980: 6973 742c 2074 6872 6561 6463 6f75 6e74  ist, threadcount
+0002f990: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0002f9a0: 2054 7279 2077 6974 6820 7368 6172 6564   Try with shared
+0002f9b0: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+0002f9c0: 2020 2020 696d 706f 7274 206d 756c 7469      import multi
+0002f9d0: 7072 6f63 6573 7369 6e67 0a20 2020 2020  processing.     
+0002f9e0: 2020 2020 2020 2069 6d70 6f72 7420 6374         import ct
+0002f9f0: 7970 6573 0a20 2020 2020 2020 2020 2020  ypes.           
+0002fa00: 2078 2c20 792c 207a 203d 2064 6973 742e   x, y, z = dist.
+0002fa10: 7368 6170 650a 0a20 2020 2020 2020 2020  shape..         
+0002fa20: 2020 2073 6861 7265 645f 6172 7261 795f     shared_array_
+0002fa30: 6261 7365 203d 206d 756c 7469 7072 6f63  base = multiproc
+0002fa40: 6573 7369 6e67 2e41 7272 6179 2863 7479  essing.Array(cty
+0002fa50: 7065 732e 635f 646f 7562 6c65 2c20 782a  pes.c_double, x*
+0002fa60: 792a 7a29 0a20 2020 2020 2020 2020 2020  y*z).           
+0002fa70: 2023 2073 6861 7265 645f 6172 7261 7920   # shared_array 
+0002fa80: 3d20 6e70 2e63 7479 7065 736c 6962 2e61  = np.ctypeslib.a
+0002fa90: 735f 6172 7261 7928 7368 6172 6564 5f61  s_array(shared_a
+0002faa0: 7272 6179 5f62 6173 652e 6765 745f 6f62  rray_base.get_ob
+0002fab0: 6a28 2929 0a20 2020 2020 2020 2020 2020  j()).           
+0002fac0: 2073 6861 7265 645f 6172 7261 7920 3d20   shared_array = 
+0002fad0: 6e70 2e66 726f 6d62 7566 6665 7228 7368  np.frombuffer(sh
+0002fae0: 6172 6564 5f61 7272 6179 5f62 6173 652e  ared_array_base.
+0002faf0: 6765 745f 6f62 6a28 2929 0a20 2020 2020  get_obj()).     
+0002fb00: 2020 2020 2020 2073 6861 7265 645f 6172         shared_ar
+0002fb10: 7261 7920 3d20 7368 6172 6564 5f61 7272  ray = shared_arr
+0002fb20: 6179 2e72 6573 6861 7065 2864 6973 742e  ay.reshape(dist.
+0002fb30: 7368 6170 6529 0a0a 0a0a 2020 2020 2020  shape)....      
+0002fb40: 2020 2020 2020 7368 6172 6564 5f61 7272        shared_arr
+0002fb50: 6179 5b3a 5d20 3d20 6469 7374 5b3a 5d0a  ay[:] = dist[:].
+0002fb60: 2020 2020 2020 2020 2020 2020 2320 6170              # ap
+0002fb70: 7320 3d20 5b70 6f6f 6c2e 6170 706c 7928  s = [pool.apply(
+0002fb80: 7063 616c 2c20 6172 6773 3d28 692c 2061  pcal, args=(i, a
+0002fb90: 6c6c 696e 6469 6365 732c 2061 6c6c 7073  llindices, allps
+0002fba0: 6d61 7029 2920 666f 7220 6920 696e 2072  map)) for i in r
+0002fbb0: 6c69 7374 5d0a 2020 2020 2020 2020 2020  list].          
+0002fbc0: 2020 6170 7320 3d20 5b70 6f6f 6c2e 6170    aps = [pool.ap
+0002fbd0: 706c 7928 7073 7375 6d2c 2061 7267 733d  ply(pssum, args=
+0002fbe0: 2869 2c20 696e 6469 6178 6973 2c20 696e  (i, indiaxis, in
+0002fbf0: 6469 6178 6973 742c 2073 6861 7265 645f  diaxist, shared_
+0002fc00: 6172 7261 7929 2920 666f 7220 6920 696e  array)) for i in
+0002fc10: 2072 6c69 7374 5d0a 2020 2020 2020 2020   rlist].        
+0002fc20: 2020 2020 2320 6170 7320 3d20 6170 735b      # aps = aps[
+0002fc30: 3a2d 315d 0a20 2020 2020 2020 2020 2020  :-1].           
+0002fc40: 2023 2061 7073 203d 2070 6f6f 6c2e 6d61   # aps = pool.ma
+0002fc50: 7028 7365 6c66 2e70 7373 756d 2c20 5b20  p(self.pssum, [ 
+0002fc60: 6920 666f 7220 6920 696e 2061 6c6c 696e  i for i in allin
+0002fc70: 6469 6365 735d 290a 2020 2020 2020 2020  dices]).        
+0002fc80: 2020 2020 6e65 7761 7073 203d 206c 6973      newaps = lis
+0002fc90: 7428 6974 6572 746f 6f6c 732e 6368 6169  t(itertools.chai
+0002fca0: 6e2e 6672 6f6d 5f69 7465 7261 626c 6528  n.from_iterable(
+0002fcb0: 6170 7329 290a 2020 2020 2020 2020 2020  aps)).          
+0002fcc0: 2020 2320 7072 696e 7428 6c65 6e28 6e65    # print(len(ne
+0002fcd0: 7761 7073 2929 0a0a 2020 2020 2020 2020  waps))..        
+0002fce0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0002fcf0: 6765 286c 656e 2869 6e64 6961 7869 7329  ge(len(indiaxis)
+0002fd00: 2d31 293a 0a20 2020 2020 2020 2020 2020  -1):.           
+0002fd10: 2020 2020 2069 6620 6920 213d 206c 656e       if i != len
+0002fd20: 2869 6e64 6961 7869 7329 202d 313a 0a20  (indiaxis) -1:. 
+0002fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fd40: 2020 2070 7375 6d20 3d20 6c6f 6731 3028     psum = log10(
+0002fd50: 7073 6d61 702e 6675 6c6c 4d61 705b 7475  psmap.fullMap[tu
+0002fd60: 706c 6528 6e65 7761 7073 5b69 5d2e 5429  ple(newaps[i].T)
+0002fd70: 5d2e 7375 6d28 2920 2f20 6c65 6e28 6e65  ].sum() / len(ne
+0002fd80: 7761 7073 5b69 5d29 290a 2020 2020 2020  waps[i])).      
+0002fd90: 2020 2020 2020 2020 2020 2020 2020 616c                al
+0002fda0: 6c70 736d 6170 2e61 7070 656e 6428 7073  lpsmap.append(ps
+0002fdb0: 756d 290a 0a20 2020 2020 2020 2020 2020  um)..           
+0002fdc0: 2070 7269 6e74 2861 6c6c 7073 6d61 7029   print(allpsmap)
+0002fdd0: 0a0a 2020 2020 2020 2020 2020 2020 2323  ..            ##
+0002fde0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002fdf0: 0a0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+0002fe00: 7461 6469 6374 203d 207b 2772 6f74 6174  tadict = {'rotat
+0002fe10: 696f 6e61 6c6c 795f 6176 6572 6167 6564  ionally_averaged
+0002fe20: 5f70 6f77 6572 5f73 7065 6374 7275 6d27  _power_spectrum'
+0002fe30: 3a20 7b27 7927 3a20 6e70 2e72 6f75 6e64  : {'y': np.round
+0002fe40: 2861 6c6c 7073 6d61 702c 2034 292e 746f  (allpsmap, 4).to
+0002fe50: 6c69 7374 2829 2c0a 2020 2020 2020 2020  list(),.        
+0002fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe90: 2020 2020 2020 2020 2027 7827 3a20 6e70           'x': np
+0002fea0: 2e72 6f75 6e64 2869 6e64 6961 7869 735b  .round(indiaxis[
+0002feb0: 3a2d 315d 2c20 3429 2e74 6f6c 6973 7428  :-1], 4).tolist(
+0002fec0: 297d 7d0a 2020 2020 2020 2020 2020 2020  )}}.            
+0002fed0: 6572 7220 3d20 2752 4150 5320 6361 6c63  err = 'RAPS calc
+0002fee0: 756c 6174 696f 6e20 6572 726f 723a 207b  ulation error: {
+0002fef0: 7d2e 272e 666f 726d 6174 2873 7973 2e65  }.'.format(sys.e
+0002ff00: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
+0002ff10: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
+0002ff20: 742e 6170 7065 6e64 2865 7272 290a 2020  t.append(err).  
+0002ff30: 2020 2020 2020 2020 2020 6461 7461 6469            datadi
+0002ff40: 6374 203d 207b 2772 6f74 6174 696f 6e61  ct = {'rotationa
+0002ff50: 6c6c 795f 6176 6572 6167 6564 5f70 6f77  lly_averaged_pow
+0002ff60: 6572 5f73 7065 6374 7275 6d27 3a20 7b27  er_spectrum': {'
+0002ff70: 6572 7227 3a20 7b27 7261 7073 5f65 7272  err': {'raps_err
+0002ff80: 273a 2065 7272 6c69 7374 7d7d 7d0a 2020  ': errlist}}}.  
+0002ff90: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+0002ffa0: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
+0002ffb0: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+0002ffc0: 2020 2020 6966 2062 6f6f 6c28 6461 7461      if bool(data
+0002ffd0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+0002ffe0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0002fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030000: 7769 7468 2063 6f64 6563 732e 6f70 656e  with codecs.open
+00030010: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
+00030020: 7365 6c66 2e6d 6170 6e61 6d65 202b 2027  self.mapname + '
+00030030: 5f72 6170 732e 6a73 6f6e 272c 2027 7727  _raps.json', 'w'
+00030040: 2c20 656e 636f 6469 6e67 3d27 7574 662d  , encoding='utf-
+00030050: 3827 2920 6173 2066 3a0a 2020 2020 2020  8') as f:.      
+00030060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030070: 2020 6a73 6f6e 2e64 756d 7028 6461 7461    json.dump(data
+00030080: 6469 6374 2c20 6629 0a20 2020 2020 2020  dict, f).       
+00030090: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+000300a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000300b0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+000300c0: 7772 6974 6528 2753 6176 696e 6720 5241  write('Saving RA
+000300d0: 5053 2074 6f20 6a73 6f6e 2065 7272 6f72  PS to json error
+000300e0: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 7379  : {}.'.format(sy
+000300f0: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
+00030100: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00030110: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00030120: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
+00030130: 7269 7465 2827 4e6f 2072 6170 7320 6461  rite('No raps da
+00030140: 7461 2069 6e20 7468 6520 6469 6374 696f  ta in the dictio
+00030150: 6e61 7279 2c20 6e6f 2072 6170 7320 6a73  nary, no raps js
+00030160: 6f6e 2066 696c 652e 5c6e 2729 0a0a 2020  on file.\n')..  
+00030170: 2020 2020 2020 2020 2020 656e 6420 3d20            end = 
+00030180: 7469 6d65 6974 2e64 6566 6175 6c74 5f74  timeit.default_t
+00030190: 696d 6572 2829 0a20 2020 2020 2020 2020  imer().         
+000301a0: 2020 2070 7269 6e74 2827 5241 5053 2074     print('RAPS t
+000301b0: 696d 653a 2025 7327 2025 2028 656e 6420  ime: %s' % (end 
+000301c0: 2d20 7374 6172 7429 290a 2020 2020 2020  - start)).      
+000301d0: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
 000301e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000301f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
-00030200: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00030210: 204e 6f6e 650a 0a0a 2020 2020 6465 6620   None...    def 
-00030220: 7261 7073 7328 7365 6c66 293a 0a20 2020  rapss(self):.   
-00030230: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00030240: 2020 2020 2063 616c 6375 6c61 7465 2062       calculate b
-00030250: 6f74 6820 7072 696d 6172 7920 6d61 7020  oth primary map 
-00030260: 7261 7073 2061 6e64 2072 6177 6d61 7020  raps and rawmap 
-00030270: 7261 7073 0a20 2020 2020 2020 203a 7265  raps.        :re
-00030280: 7475 726e 3a20 4e6f 6e65 0a20 2020 2020  turn: None.     
-00030290: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000302a0: 6620 7365 6c66 2e6d 6170 3a0a 2020 2020  f self.map:.    
-000302b0: 2020 2020 2020 2020 7374 6172 7472 6170          startrap
-000302c0: 7320 3d20 7469 6d65 6974 2e64 6566 6175  s = timeit.defau
-000302d0: 6c74 5f74 696d 6572 2829 0a20 2020 2020  lt_timer().     
-000302e0: 2020 2020 2020 2073 656c 662e 6e65 775f         self.new_
-000302f0: 7261 7073 2829 0a20 2020 2020 2020 2020  raps().         
-00030300: 2020 2073 746f 7072 6170 7320 3d20 7469     stopraps = ti
-00030310: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-00030320: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-00030330: 2070 7269 6e74 2827 5241 5053 3a20 2573   print('RAPS: %s
-00030340: 2720 2520 2873 746f 7072 6170 7320 2d20  ' % (stopraps - 
-00030350: 7374 6172 7472 6170 7329 290a 2020 2020  startraps)).    
-00030360: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
-00030370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00030380: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00030390: 2d2d 2d27 290a 2020 2020 2020 2020 656c  ---').        el
-000303a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000303b0: 7072 696e 7428 274e 6f20 7072 6f70 6572  print('No proper
-000303c0: 2070 7269 6d61 7279 206d 6170 2066 6f72   primary map for
-000303d0: 2052 4150 5320 6361 6c63 756c 6174 696f   RAPS calculatio
-000303e0: 6e2e 2729 0a0a 2020 2020 2020 2020 6966  n.')..        if
-000303f0: 2073 656c 662e 686d 6576 656e 2069 7320   self.hmeven is 
-00030400: 6e6f 7420 4e6f 6e65 2061 6e64 2073 656c  not None and sel
-00030410: 662e 686d 6f64 6420 6973 206e 6f74 204e  f.hmodd is not N
-00030420: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00030430: 2073 7461 7274 7261 7073 203d 2074 696d   startraps = tim
-00030440: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
-00030450: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-00030460: 2320 7365 6c66 2e66 7363 2873 656c 662e  # self.fsc(self.
-00030470: 686d 6576 656e 2c20 7365 6c66 2e68 6d6f  hmeven, self.hmo
-00030480: 6464 290a 2020 2020 2020 2020 2020 2020  dd).            
-00030490: 7365 6c66 2e72 6177 6d61 705f 7261 7073  self.rawmap_raps
-000304a0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-000304b0: 746f 7020 3d20 7469 6d65 6974 2e64 6566  top = timeit.def
-000304c0: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
-000304d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-000304e0: 5261 7720 6d61 7020 5241 5053 3a20 2573  Raw map RAPS: %s
-000304f0: 2720 2520 2873 746f 7020 2d20 7374 6172  ' % (stop - star
-00030500: 7472 6170 7329 290a 2020 2020 2020 2020  traps)).        
-00030510: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
-00030520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00030530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
-00030540: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00030550: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00030560: 7428 274e 6f20 7261 7720 6d61 7020 5241  t('No raw map RA
-00030570: 5053 3a20 4d69 7369 6e67 2068 616c 6620  PS: Mising half 
-00030580: 6d61 7028 7329 2e27 290a 2020 2020 2020  map(s).').      
-00030590: 2020 706c 742e 636c 6f73 6528 290a 0a20    plt.close().. 
-000305a0: 2020 2023 2040 7072 6f66 696c 650a 2020     # @profile.  
-000305b0: 2020 6465 6620 7261 776d 6170 5f72 6170    def rawmap_rap
-000305c0: 7328 7365 6c66 293a 0a0a 2020 2020 2020  s(self):..      
-000305d0: 2020 7261 776d 6170 203d 2073 656c 662e    rawmap = self.
-000305e0: 7261 776d 6170 0a20 2020 2020 2020 2069  rawmap.        i
-000305f0: 6620 7261 776d 6170 2069 7320 6e6f 7420  f rawmap is not 
-00030600: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00030610: 2020 6469 7220 3d20 7365 6c66 2e77 6f72    dir = self.wor
-00030620: 6b64 6972 0a20 2020 2020 2020 2020 2020  kdir.           
-00030630: 206c 6162 656c 203d 2027 7261 776d 6170   label = 'rawmap
-00030640: 5f27 0a20 2020 2020 2020 2020 2020 2073  _'.            s
-00030650: 656c 662e 6e65 775f 7261 7073 2872 6177  elf.new_raps(raw
-00030660: 6d61 702c 2064 6972 2c20 6c61 6265 6c29  map, dir, label)
-00030670: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00030680: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00030690: 2827 4e6f 2072 6177 206d 6170 2074 6f20  ('No raw map to 
-000306a0: 6361 6c63 756c 6174 6520 5241 5053 2e27  calculate RAPS.'
-000306b0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000306c0: 6e20 4e6f 6e65 0a0a 2020 2020 2340 7072  n None..    #@pr
-000306d0: 6f66 696c 650a 2020 2020 6465 6620 666f  ofile.    def fo
-000306e0: 7572 6965 725f 7472 616e 7366 6f72 6d28  urier_transform(
-000306f0: 7365 6c66 2c20 6d61 7064 6174 6129 3a0a  self, mapdata):.
-00030700: 0a0a 2020 2020 2020 2020 6e65 775f 6d61  ..        new_ma
-00030710: 7064 6174 6120 3d20 6666 7473 6869 6674  pdata = fftshift
-00030720: 2866 6674 6e28 6d61 7064 6174 6129 290a  (fftn(mapdata)).
-00030730: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00030740: 6577 5f6d 6170 6461 7461 0a0a 2020 2020  ew_mapdata..    
-00030750: 2340 7072 6f66 696c 650a 2020 2020 6465  #@profile.    de
-00030760: 6620 7261 7073 2873 656c 662c 206d 6170  f raps(self, map
-00030770: 696e 3d4e 6f6e 652c 2077 6f72 6b64 6972  in=None, workdir
-00030780: 3d4e 6f6e 652c 206c 6162 656c 3d27 2729  =None, label='')
-00030790: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
-000307a0: 2020 2020 2020 2020 2020 2043 616c 6375             Calcu
-000307b0: 6c61 7469 6f6e 206f 6620 7468 6520 726f  lation of the ro
-000307c0: 7461 7469 6f6e 616c 6c79 2061 7665 7261  tationally avera
-000307d0: 6765 2070 6f77 6572 2073 7065 6374 7275  ge power spectru
-000307e0: 6d20 2852 4150 5329 0a20 2020 2020 2020  m (RAPS).       
-000307f0: 2020 2020 2052 6573 756c 7473 2077 726f       Results wro
-00030800: 7465 2074 6f20 4a53 4f4e 2066 696c 650a  te to JSON file.
-00030810: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00030820: 3a20 4e6f 6e65 0a0a 2020 2020 2020 2020  : None..        
-00030830: 2222 220a 0a20 2020 2020 2020 206d 6170  """..        map
-00030840: 2c20 776f 726b 6469 7220 3d20 7365 6c66  , workdir = self
-00030850: 2e6d 6170 696e 6368 6563 6b28 6d61 7069  .mapincheck(mapi
-00030860: 6e2c 2077 6f72 6b64 6972 290a 2020 2020  n, workdir).    
-00030870: 2020 2020 6d61 706e 616d 6520 3d20 6f73      mapname = os
-00030880: 2e70 6174 682e 6261 7365 6e61 6d65 286d  .path.basename(m
-00030890: 6170 2e66 756c 6c6e 616d 6529 0a0a 2020  ap.fullname)..  
-000308a0: 2020 2020 2020 6d61 705f 7a73 697a 6520        map_zsize 
-000308b0: 3d20 6d61 702e 6865 6164 6572 2e6e 7a0a  = map.header.nz.
-000308c0: 2020 2020 2020 2020 6d61 705f 7973 697a          map_ysiz
-000308d0: 6520 3d20 6d61 702e 6865 6164 6572 2e6e  e = map.header.n
-000308e0: 790a 2020 2020 2020 2020 6d61 705f 7873  y.        map_xs
-000308f0: 697a 6520 3d20 6d61 702e 6865 6164 6572  ize = map.header
-00030900: 2e6e 780a 0a20 2020 2020 2020 2061 7069  .nx..        api
-00030910: 785f 6c69 7374 203d 206d 6170 2e76 6f78  x_list = map.vox
-00030920: 656c 5f73 697a 652e 746f 6c69 7374 2829  el_size.tolist()
-00030930: 0a20 2020 2020 2020 2061 7069 7873 203d  .        apixs =
-00030940: 2028 6170 6978 5f6c 6973 745b 305d 2c20   (apix_list[0], 
-00030950: 6170 6978 5f6c 6973 745b 315d 2c20 6170  apix_list[1], ap
-00030960: 6978 5f6c 6973 745b 325d 290a 0a20 2020  ix_list[2])..   
-00030970: 2020 2020 2069 6620 6d61 7020 6973 206e       if map is n
-00030980: 6f74 204e 6f6e 6520 616e 6420 776f 726b  ot None and work
-00030990: 6469 7220 6973 206e 6f74 204e 6f6e 653a  dir is not None:
-000309a0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-000309b0: 6620 6d61 702e 785f 7369 7a65 2829 203d  f map.x_size() =
-000309c0: 3d20 6d61 702e 795f 7369 7a65 2829 203d  = map.y_size() =
-000309d0: 3d20 6d61 702e 7a5f 7369 7a65 2829 3a0a  = map.z_size():.
-000309e0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-000309f0: 6170 2e68 6561 6465 722e 6e78 203d 3d20  ap.header.nx == 
-00030a00: 6d61 702e 6865 6164 6572 2e6e 7920 3d3d  map.header.ny ==
-00030a10: 206d 6170 2e68 6561 6465 722e 6e7a 3a0a   map.header.nz:.
-00030a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030a30: 6572 726c 6973 7420 3d20 5b5d 0a20 2020  errlist = [].   
-00030a40: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00030a50: 7274 203d 2074 696d 6569 742e 6465 6661  rt = timeit.defa
-00030a60: 756c 745f 7469 6d65 7228 290a 2020 2020  ult_timer().    
-00030a70: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00030a80: 6469 6374 203d 2064 6963 7428 290a 2020  dict = dict().  
-00030a90: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00030aa0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00030ab0: 2020 2020 2020 2023 206d 6170 203d 2073         # map = s
-00030ac0: 656c 662e 6d61 700a 2020 2020 2020 2020  elf.map.        
-00030ad0: 2020 2020 2020 2020 2020 2020 2320 7465              # te
-00030ae0: 6d70 7261 7279 2073 6f6c 7574 696f 6e20  mprary solution 
-00030af0: 6173 2074 6865 2074 656d 7079 2067 6976  as the tempy giv
-00030b00: 6520 6170 6978 2061 7320 6f6e 6520 7661  e apix as one va
-00030b10: 6c75 6520 6275 7420 6865 7265 2066 726f  lue but here fro
-00030b20: 6d20 6d72 6366 696c 6520 7765 2075 7365  m mrcfile we use
-00030b30: 2061 2074 7570 6c65 0a20 2020 2020 2020   a tuple.       
-00030b40: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00030b50: 6620 7479 7065 286d 6170 2e61 7069 7829  f type(map.apix)
-00030b60: 2069 7320 7475 706c 653a 0a20 2020 2020   is tuple:.     
-00030b70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00030b80: 6620 7479 7065 2861 7069 7873 2920 6973  f type(apixs) is
-00030b90: 2074 7570 6c65 3a0a 2020 2020 2020 2020   tuple:.        
-00030ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030bb0: 2320 6170 6978 203d 206d 6170 2e61 7069  # apix = map.api
-00030bc0: 785b 305d 0a20 2020 2020 2020 2020 2020  x[0].           
-00030bd0: 2020 2020 2020 2020 2020 2020 2061 7069               api
-00030be0: 7820 3d20 6170 6978 735b 305d 0a20 2020  x = apixs[0].   
-00030bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030c00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00030c10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00030c20: 2061 7069 7820 3d20 6d61 702e 6170 6978   apix = map.apix
-00030c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030c40: 2020 2020 2020 2020 2061 7069 7820 3d20           apix = 
-00030c50: 6170 6978 730a 2020 2020 2020 2020 2020  apixs.          
-00030c60: 2020 2020 2020 2020 2020 2320 6666 746d            # fftm
-00030c70: 6170 203d 206d 6170 2e66 6f75 7269 6572  ap = map.fourier
-00030c80: 5f74 7261 6e73 666f 726d 2829 0a20 2020  _transform().   
+000301f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00030200: 2d27 290a 2020 2020 2020 2020 656c 7365  -').        else
+00030210: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00030220: 696e 7428 274e 6f20 5241 5053 2063 616c  int('No RAPS cal
+00030230: 6375 6c61 7469 6f6e 2066 6f72 206e 6f6e  culation for non
+00030240: 2d63 7562 6963 206d 6170 2e27 290a 2020  -cubic map.').  
+00030250: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00030260: 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '---------------
+00030270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00030280: 2d2d 2d2d 2d27 290a 0a0a 2020 2020 2020  -----')...      
+00030290: 2020 7265 7475 726e 204e 6f6e 650a 0a0a    return None...
+000302a0: 2020 2020 6465 6620 7261 7073 7328 7365      def rapss(se
+000302b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+000302c0: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
+000302d0: 6375 6c61 7465 2062 6f74 6820 7072 696d  culate both prim
+000302e0: 6172 7920 6d61 7020 7261 7073 2061 6e64  ary map raps and
+000302f0: 2072 6177 6d61 7020 7261 7073 0a20 2020   rawmap raps.   
+00030300: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
+00030310: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
+00030320: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
+00030330: 6170 3a0a 2020 2020 2020 2020 2020 2020  ap:.            
+00030340: 7374 6172 7472 6170 7320 3d20 7469 6d65  startraps = time
+00030350: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
+00030360: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00030370: 656c 662e 6e65 775f 7261 7073 2829 0a20  elf.new_raps(). 
+00030380: 2020 2020 2020 2020 2020 2073 746f 7072             stopr
+00030390: 6170 7320 3d20 7469 6d65 6974 2e64 6566  aps = timeit.def
+000303a0: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
+000303b0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000303c0: 5241 5053 3a20 2573 2720 2520 2873 746f  RAPS: %s' % (sto
+000303d0: 7072 6170 7320 2d20 7374 6172 7472 6170  praps - startrap
+000303e0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+000303f0: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
+00030400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00030410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020  -----------').  
+00030420: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00030430: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
+00030440: 6f20 7072 6f70 6572 2070 7269 6d61 7279  o proper primary
+00030450: 206d 6170 2066 6f72 2052 4150 5320 6361   map for RAPS ca
+00030460: 6c63 756c 6174 696f 6e2e 2729 0a0a 2020  lculation.')..  
+00030470: 2020 2020 2020 6966 2073 656c 662e 686d        if self.hm
+00030480: 6576 656e 2069 7320 6e6f 7420 4e6f 6e65  even is not None
+00030490: 2061 6e64 2073 656c 662e 686d 6f64 6420   and self.hmodd 
+000304a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000304b0: 2020 2020 2020 2020 2073 7461 7274 7261           startra
+000304c0: 7073 203d 2074 696d 6569 742e 6465 6661  ps = timeit.defa
+000304d0: 756c 745f 7469 6d65 7228 290a 2020 2020  ult_timer().    
+000304e0: 2020 2020 2020 2020 2320 7365 6c66 2e66          # self.f
+000304f0: 7363 2873 656c 662e 686d 6576 656e 2c20  sc(self.hmeven, 
+00030500: 7365 6c66 2e68 6d6f 6464 290a 2020 2020  self.hmodd).    
+00030510: 2020 2020 2020 2020 7365 6c66 2e72 6177          self.raw
+00030520: 6d61 705f 7261 7073 2829 0a20 2020 2020  map_raps().     
+00030530: 2020 2020 2020 2073 746f 7020 3d20 7469         stop = ti
+00030540: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
+00030550: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+00030560: 2070 7269 6e74 2827 5261 7720 6d61 7020   print('Raw map 
+00030570: 5241 5053 3a20 2573 2720 2520 2873 746f  RAPS: %s' % (sto
+00030580: 7020 2d20 7374 6172 7472 6170 7329 290a  p - startraps)).
+00030590: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000305a0: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
+000305b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000305c0: 2d2d 2d2d 2d2d 2d27 290a 2020 2020 2020  -------').      
+000305d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000305e0: 2020 2020 7072 696e 7428 274e 6f20 7261      print('No ra
+000305f0: 7720 6d61 7020 5241 5053 3a20 4d69 7369  w map RAPS: Misi
+00030600: 6e67 2068 616c 6620 6d61 7028 7329 2e27  ng half map(s).'
+00030610: 290a 2020 2020 2020 2020 706c 742e 636c  ).        plt.cl
+00030620: 6f73 6528 290a 0a20 2020 2023 2040 7072  ose()..    # @pr
+00030630: 6f66 696c 650a 2020 2020 6465 6620 7261  ofile.    def ra
+00030640: 776d 6170 5f72 6170 7328 7365 6c66 293a  wmap_raps(self):
+00030650: 0a0a 2020 2020 2020 2020 7261 776d 6170  ..        rawmap
+00030660: 203d 2073 656c 662e 7261 776d 6170 0a20   = self.rawmap. 
+00030670: 2020 2020 2020 2069 6620 7261 776d 6170         if rawmap
+00030680: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00030690: 2020 2020 2020 2020 2020 6469 7220 3d20            dir = 
+000306a0: 7365 6c66 2e77 6f72 6b64 6972 0a20 2020  self.workdir.   
+000306b0: 2020 2020 2020 2020 206c 6162 656c 203d           label =
+000306c0: 2027 7261 776d 6170 5f27 0a20 2020 2020   'rawmap_'.     
+000306d0: 2020 2020 2020 2073 656c 662e 6e65 775f         self.new_
+000306e0: 7261 7073 2872 6177 6d61 702c 2064 6972  raps(rawmap, dir
+000306f0: 2c20 6c61 6265 6c29 0a20 2020 2020 2020  , label).       
+00030700: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00030710: 2020 2070 7269 6e74 2827 4e6f 2072 6177     print('No raw
+00030720: 206d 6170 2074 6f20 6361 6c63 756c 6174   map to calculat
+00030730: 6520 5241 5053 2e27 290a 0a20 2020 2020  e RAPS.')..     
+00030740: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+00030750: 2020 2020 2340 7072 6f66 696c 650a 2020      #@profile.  
+00030760: 2020 6465 6620 666f 7572 6965 725f 7472    def fourier_tr
+00030770: 616e 7366 6f72 6d28 7365 6c66 2c20 6d61  ansform(self, ma
+00030780: 7064 6174 6129 3a0a 0a0a 2020 2020 2020  pdata):...      
+00030790: 2020 6e65 775f 6d61 7064 6174 6120 3d20    new_mapdata = 
+000307a0: 6666 7473 6869 6674 2866 6674 6e28 6d61  fftshift(fftn(ma
+000307b0: 7064 6174 6129 290a 2020 2020 2020 2020  pdata)).        
+000307c0: 7265 7475 726e 206e 6577 5f6d 6170 6461  return new_mapda
+000307d0: 7461 0a0a 2020 2020 2340 7072 6f66 696c  ta..    #@profil
+000307e0: 650a 2020 2020 6465 6620 7261 7073 2873  e.    def raps(s
+000307f0: 656c 662c 206d 6170 696e 3d4e 6f6e 652c  elf, mapin=None,
+00030800: 2077 6f72 6b64 6972 3d4e 6f6e 652c 206c   workdir=None, l
+00030810: 6162 656c 3d27 2729 3a0a 2020 2020 2020  abel=''):.      
+00030820: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
+00030830: 2020 2043 616c 6375 6c61 7469 6f6e 206f     Calculation o
+00030840: 6620 7468 6520 726f 7461 7469 6f6e 616c  f the rotational
+00030850: 6c79 2061 7665 7261 6765 2070 6f77 6572  ly average power
+00030860: 2073 7065 6374 7275 6d20 2852 4150 5329   spectrum (RAPS)
+00030870: 0a20 2020 2020 2020 2020 2020 2052 6573  .            Res
+00030880: 756c 7473 2077 726f 7465 2074 6f20 4a53  ults wrote to JS
+00030890: 4f4e 2066 696c 650a 0a20 2020 2020 2020  ON file..       
+000308a0: 203a 7265 7475 726e 3a20 4e6f 6e65 0a0a   :return: None..
+000308b0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000308c0: 2020 2020 206d 6170 2c20 776f 726b 6469       map, workdi
+000308d0: 7220 3d20 7365 6c66 2e6d 6170 696e 6368  r = self.mapinch
+000308e0: 6563 6b28 6d61 7069 6e2c 2077 6f72 6b64  eck(mapin, workd
+000308f0: 6972 290a 2020 2020 2020 2020 6d61 706e  ir).        mapn
+00030900: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+00030910: 7365 6e61 6d65 286d 6170 2e66 756c 6c6e  sename(map.fulln
+00030920: 616d 6529 0a0a 2020 2020 2020 2020 6d61  ame)..        ma
+00030930: 705f 7a73 697a 6520 3d20 6d61 702e 6865  p_zsize = map.he
+00030940: 6164 6572 2e6e 7a0a 2020 2020 2020 2020  ader.nz.        
+00030950: 6d61 705f 7973 697a 6520 3d20 6d61 702e  map_ysize = map.
+00030960: 6865 6164 6572 2e6e 790a 2020 2020 2020  header.ny.      
+00030970: 2020 6d61 705f 7873 697a 6520 3d20 6d61    map_xsize = ma
+00030980: 702e 6865 6164 6572 2e6e 780a 0a20 2020  p.header.nx..   
+00030990: 2020 2020 2061 7069 785f 6c69 7374 203d       apix_list =
+000309a0: 206d 6170 2e76 6f78 656c 5f73 697a 652e   map.voxel_size.
+000309b0: 746f 6c69 7374 2829 0a20 2020 2020 2020  tolist().       
+000309c0: 2061 7069 7873 203d 2028 6170 6978 5f6c   apixs = (apix_l
+000309d0: 6973 745b 305d 2c20 6170 6978 5f6c 6973  ist[0], apix_lis
+000309e0: 745b 315d 2c20 6170 6978 5f6c 6973 745b  t[1], apix_list[
+000309f0: 325d 290a 0a20 2020 2020 2020 2069 6620  2])..        if 
+00030a00: 6d61 7020 6973 206e 6f74 204e 6f6e 6520  map is not None 
+00030a10: 616e 6420 776f 726b 6469 7220 6973 206e  and workdir is n
+00030a20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00030a30: 2020 2020 2023 2069 6620 6d61 702e 785f       # if map.x_
+00030a40: 7369 7a65 2829 203d 3d20 6d61 702e 795f  size() == map.y_
+00030a50: 7369 7a65 2829 203d 3d20 6d61 702e 7a5f  size() == map.z_
+00030a60: 7369 7a65 2829 3a0a 2020 2020 2020 2020  size():.        
+00030a70: 2020 2020 6966 206d 6170 2e68 6561 6465      if map.heade
+00030a80: 722e 6e78 203d 3d20 6d61 702e 6865 6164  r.nx == map.head
+00030a90: 6572 2e6e 7920 3d3d 206d 6170 2e68 6561  er.ny == map.hea
+00030aa0: 6465 722e 6e7a 3a0a 2020 2020 2020 2020  der.nz:.        
+00030ab0: 2020 2020 2020 2020 6572 726c 6973 7420          errlist 
+00030ac0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00030ad0: 2020 2020 2073 7461 7274 203d 2074 696d       start = tim
+00030ae0: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
+00030af0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+00030b00: 2020 2020 6461 7461 6469 6374 203d 2064      datadict = d
+00030b10: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
+00030b20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00030b30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00030b40: 206d 6170 203d 2073 656c 662e 6d61 700a   map = self.map.
+00030b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b60: 2020 2020 2320 7465 6d70 7261 7279 2073      # temprary s
+00030b70: 6f6c 7574 696f 6e20 6173 2074 6865 2074  olution as the t
+00030b80: 656d 7079 2067 6976 6520 6170 6978 2061  empy give apix a
+00030b90: 7320 6f6e 6520 7661 6c75 6520 6275 7420  s one value but 
+00030ba0: 6865 7265 2066 726f 6d20 6d72 6366 696c  here from mrcfil
+00030bb0: 6520 7765 2075 7365 2061 2074 7570 6c65  e we use a tuple
+00030bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030bd0: 2020 2020 2023 2069 6620 7479 7065 286d       # if type(m
+00030be0: 6170 2e61 7069 7829 2069 7320 7475 706c  ap.apix) is tupl
+00030bf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00030c00: 2020 2020 2020 2069 6620 7479 7065 2861         if type(a
+00030c10: 7069 7873 2920 6973 2074 7570 6c65 3a0a  pixs) is tuple:.
+00030c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c30: 2020 2020 2020 2020 2320 6170 6978 203d          # apix =
+00030c40: 206d 6170 2e61 7069 785b 305d 0a20 2020   map.apix[0].   
+00030c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c60: 2020 2020 2061 7069 7820 3d20 6170 6978       apix = apix
+00030c70: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+00030c80: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
 00030c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030ca0: 2066 6674 6d61 7020 3d20 6666 7473 6869   fftmap = fftshi
-00030cb0: 6674 2866 6674 6e28 6d61 702e 6461 7461  ft(fftn(map.data
-00030cc0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00030cd0: 2020 2020 2020 2023 2070 736d 6170 203d         # psmap =
-00030ce0: 2066 6674 6d61 702e 636f 7079 2829 0a20   fftmap.copy(). 
-00030cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030d00: 2020 2023 2070 736d 6561 6e20 3d20 6e70     # psmean = np
-00030d10: 2e6d 6561 6e28 7073 6d61 702e 6675 6c6c  .mean(psmap.full
-00030d20: 4d61 7029 0a20 2020 2020 2020 2020 2020  Map).           
-00030d30: 2020 2020 2020 2020 2023 2070 7373 7464           # psstd
-00030d40: 203d 206e 702e 7374 6428 7073 6d61 702e   = np.std(psmap.
-00030d50: 6675 6c6c 4d61 7029 0a20 2020 2020 2020  fullMap).       
-00030d60: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-00030d70: 736d 6170 2e66 756c 6c4d 6170 203d 206e  smap.fullMap = n
-00030d80: 702e 6162 7328 2870 736d 6170 2e66 756c  p.abs((psmap.ful
-00030d90: 6c4d 6170 202d 2070 736d 6561 6e29 202f  lMap - psmean) /
-00030da0: 2070 7373 7464 2920 2a2a 2032 0a20 2020   psstd) ** 2.   
+00030ca0: 2020 2020 2020 2023 2061 7069 7820 3d20         # apix = 
+00030cb0: 6d61 702e 6170 6978 0a20 2020 2020 2020  map.apix.       
+00030cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cd0: 2061 7069 7820 3d20 6170 6978 730a 2020   apix = apixs.  
+00030ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cf0: 2020 2320 6666 746d 6170 203d 206d 6170    # fftmap = map
+00030d00: 2e66 6f75 7269 6572 5f74 7261 6e73 666f  .fourier_transfo
+00030d10: 726d 2829 0a20 2020 2020 2020 2020 2020  rm().           
+00030d20: 2020 2020 2020 2020 2066 6674 6d61 7020           fftmap 
+00030d30: 3d20 6666 7473 6869 6674 2866 6674 6e28  = fftshift(fftn(
+00030d40: 6d61 702e 6461 7461 2929 0a20 2020 2020  map.data)).     
+00030d50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00030d60: 2070 736d 6170 203d 2066 6674 6d61 702e   psmap = fftmap.
+00030d70: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
+00030d80: 2020 2020 2020 2020 2020 2023 2070 736d             # psm
+00030d90: 6561 6e20 3d20 6e70 2e6d 6561 6e28 7073  ean = np.mean(ps
+00030da0: 6d61 702e 6675 6c6c 4d61 7029 0a20 2020  map.fullMap).   
 00030db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030dc0: 2070 736d 6561 6e20 3d20 6e70 2e6d 6561   psmean = np.mea
-00030dd0: 6e28 6666 746d 6170 290a 2020 2020 2020  n(fftmap).      
-00030de0: 2020 2020 2020 2020 2020 2020 2020 7073                ps
-00030df0: 7374 6420 3d20 6e70 2e73 7464 2866 6674  std = np.std(fft
-00030e00: 6d61 7029 0a20 2020 2020 2020 2020 2020  map).           
-00030e10: 2020 2020 2020 2020 2066 6674 6d61 7020           fftmap 
-00030e20: 3d20 6e70 2e61 6273 2828 6666 746d 6170  = np.abs((fftmap
-00030e30: 202d 2070 736d 6561 6e29 202f 2070 7373   - psmean) / pss
-00030e40: 7464 2920 2a2a 2032 0a0a 2020 2020 2020  td) ** 2..      
-00030e50: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-00030e60: 6473 7461 7274 203d 2074 696d 6569 742e  dstart = timeit.
-00030e70: 6465 6661 756c 745f 7469 6d65 7228 2920  default_timer() 
-00030e80: 2d20 7374 6172 740a 2020 2020 2020 2020  - start.        
-00030e90: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00030ea0: 7428 2720 2d2d 2052 4150 5320 466f 7572  t(' -- RAPS Four
-00030eb0: 6965 722d 7472 616e 7366 6f72 6d61 7469  ier-transformati
-00030ec0: 6f6e 2074 696d 653a 2025 7327 2025 206d  on time: %s' % m
-00030ed0: 6964 7374 6172 7429 0a0a 2020 2020 2020  idstart)..      
-00030ee0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00030ef0: 7a67 7269 6420 3d20 6e70 2e61 7261 6e67  zgrid = np.arang
-00030f00: 6528 666c 6f6f 7228 7073 6d61 702e 7a5f  e(floor(psmap.z_
-00030f10: 7369 7a65 2829 202f 2032 2e30 2920 2a20  size() / 2.0) * 
-00030f20: 2d31 2c20 6365 696c 2870 736d 6170 2e7a  -1, ceil(psmap.z
-00030f30: 5f73 697a 6528 2920 2f20 322e 3029 2920  _size() / 2.0)) 
-00030f40: 2f20 666c 6f61 7428 666c 6f6f 7228 7073  / float(floor(ps
-00030f50: 6d61 702e 7a5f 7369 7a65 2829 2929 0a20  map.z_size())). 
-00030f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030f70: 2020 2023 2079 6772 6964 203d 206e 702e     # ygrid = np.
-00030f80: 6172 616e 6765 2866 6c6f 6f72 2870 736d  arange(floor(psm
-00030f90: 6170 2e79 5f73 697a 6528 2920 2f20 322e  ap.y_size() / 2.
-00030fa0: 3029 202a 202d 312c 2063 6569 6c28 7073  0) * -1, ceil(ps
-00030fb0: 6d61 702e 795f 7369 7a65 2829 202f 2032  map.y_size() / 2
-00030fc0: 2e30 2929 202f 2066 6c6f 6174 2866 6c6f  .0)) / float(flo
-00030fd0: 6f72 2870 736d 6170 2e79 5f73 697a 6528  or(psmap.y_size(
-00030fe0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-00030ff0: 2020 2020 2020 2020 2320 7867 7269 6420          # xgrid 
-00031000: 3d20 6e70 2e61 7261 6e67 6528 666c 6f6f  = np.arange(floo
-00031010: 7228 7073 6d61 702e 785f 7369 7a65 2829  r(psmap.x_size()
-00031020: 202f 2032 2e30 2920 2a20 2d31 2c20 6365   / 2.0) * -1, ce
-00031030: 696c 2870 736d 6170 2e78 5f73 697a 6528  il(psmap.x_size(
-00031040: 2920 2f20 322e 3029 2920 2f20 666c 6f61  ) / 2.0)) / floa
-00031050: 7428 666c 6f6f 7228 7073 6d61 702e 785f  t(floor(psmap.x_
-00031060: 7369 7a65 2829 2929 0a20 2020 2020 2020  size())).       
-00031070: 2020 2020 2020 2020 2020 2020 207a 6772               zgr
-00031080: 6964 203d 206e 702e 6172 616e 6765 2866  id = np.arange(f
-00031090: 6c6f 6f72 286d 6170 5f7a 7369 7a65 202f  loor(map_zsize /
-000310a0: 2032 2e30 2920 2a20 2d31 2c20 6365 696c   2.0) * -1, ceil
-000310b0: 286d 6170 5f7a 7369 7a65 202f 2032 2e30  (map_zsize / 2.0
-000310c0: 2929 202f 2066 6c6f 6174 2866 6c6f 6f72  )) / float(floor
-000310d0: 286d 6170 5f7a 7369 7a65 2929 0a20 2020  (map_zsize)).   
-000310e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000310f0: 2079 6772 6964 203d 206e 702e 6172 616e   ygrid = np.aran
-00031100: 6765 2866 6c6f 6f72 286d 6170 5f79 7369  ge(floor(map_ysi
-00031110: 7a65 202f 2032 2e30 2920 2a20 2d31 2c20  ze / 2.0) * -1, 
-00031120: 6365 696c 286d 6170 5f79 7369 7a65 202f  ceil(map_ysize /
-00031130: 2032 2e30 2929 202f 2066 6c6f 6174 2866   2.0)) / float(f
-00031140: 6c6f 6f72 286d 6170 5f79 7369 7a65 2929  loor(map_ysize))
-00031150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031160: 2020 2020 2078 6772 6964 203d 206e 702e       xgrid = np.
-00031170: 6172 616e 6765 2866 6c6f 6f72 286d 6170  arange(floor(map
-00031180: 5f78 7369 7a65 202f 2032 2e30 2920 2a20  _xsize / 2.0) * 
-00031190: 2d31 2c20 6365 696c 286d 6170 5f78 7369  -1, ceil(map_xsi
-000311a0: 7a65 202f 2032 2e30 2929 202f 2066 6c6f  ze / 2.0)) / flo
-000311b0: 6174 2866 6c6f 6f72 286d 6170 5f78 7369  at(floor(map_xsi
-000311c0: 7a65 2929 0a20 2020 2020 2020 2020 2020  ze)).           
-000311d0: 2020 2020 2020 2020 2023 207a 6772 6964           # zgrid
-000311e0: 203d 206e 702e 6172 616e 6765 2866 6c6f   = np.arange(flo
-000311f0: 6f72 2870 736d 6170 2e7a 5f73 697a 6528  or(psmap.z_size(
-00031200: 292a 3220 2f20 322e 3029 202a 202d 312c  )*2 / 2.0) * -1,
-00031210: 2063 6569 6c28 7073 6d61 702e 7a5f 7369   ceil(psmap.z_si
-00031220: 7a65 2829 2a32 202f 2032 2e30 2929 202f  ze()*2 / 2.0)) /
-00031230: 2066 6c6f 6174 2866 6c6f 6f72 2870 736d   float(floor(psm
-00031240: 6170 2e7a 5f73 697a 6528 2929 290a 2020  ap.z_size())).  
+00030dc0: 2023 2070 7373 7464 203d 206e 702e 7374   # psstd = np.st
+00030dd0: 6428 7073 6d61 702e 6675 6c6c 4d61 7029  d(psmap.fullMap)
+00030de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030df0: 2020 2020 2023 2070 736d 6170 2e66 756c       # psmap.ful
+00030e00: 6c4d 6170 203d 206e 702e 6162 7328 2870  lMap = np.abs((p
+00030e10: 736d 6170 2e66 756c 6c4d 6170 202d 2070  smap.fullMap - p
+00030e20: 736d 6561 6e29 202f 2070 7373 7464 2920  smean) / psstd) 
+00030e30: 2a2a 2032 0a20 2020 2020 2020 2020 2020  ** 2.           
+00030e40: 2020 2020 2020 2020 2070 736d 6561 6e20           psmean 
+00030e50: 3d20 6e70 2e6d 6561 6e28 6666 746d 6170  = np.mean(fftmap
+00030e60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00030e70: 2020 2020 2020 7073 7374 6420 3d20 6e70        psstd = np
+00030e80: 2e73 7464 2866 6674 6d61 7029 0a20 2020  .std(fftmap).   
+00030e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ea0: 2066 6674 6d61 7020 3d20 6e70 2e61 6273   fftmap = np.abs
+00030eb0: 2828 6666 746d 6170 202d 2070 736d 6561  ((fftmap - psmea
+00030ec0: 6e29 202f 2070 7373 7464 2920 2a2a 2032  n) / psstd) ** 2
+00030ed0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030ee0: 2020 2020 2020 6d69 6473 7461 7274 203d        midstart =
+00030ef0: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
+00030f00: 7469 6d65 7228 2920 2d20 7374 6172 740a  timer() - start.
+00030f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030f20: 2020 2020 7072 696e 7428 2720 2d2d 2052      print(' -- R
+00030f30: 4150 5320 466f 7572 6965 722d 7472 616e  APS Fourier-tran
+00030f40: 7366 6f72 6d61 7469 6f6e 2074 696d 653a  sformation time:
+00030f50: 2025 7327 2025 206d 6964 7374 6172 7429   %s' % midstart)
+00030f60: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030f70: 2020 2020 2020 2320 7a67 7269 6420 3d20        # zgrid = 
+00030f80: 6e70 2e61 7261 6e67 6528 666c 6f6f 7228  np.arange(floor(
+00030f90: 7073 6d61 702e 7a5f 7369 7a65 2829 202f  psmap.z_size() /
+00030fa0: 2032 2e30 2920 2a20 2d31 2c20 6365 696c   2.0) * -1, ceil
+00030fb0: 2870 736d 6170 2e7a 5f73 697a 6528 2920  (psmap.z_size() 
+00030fc0: 2f20 322e 3029 2920 2f20 666c 6f61 7428  / 2.0)) / float(
+00030fd0: 666c 6f6f 7228 7073 6d61 702e 7a5f 7369  floor(psmap.z_si
+00030fe0: 7a65 2829 2929 0a20 2020 2020 2020 2020  ze())).         
+00030ff0: 2020 2020 2020 2020 2020 2023 2079 6772             # ygr
+00031000: 6964 203d 206e 702e 6172 616e 6765 2866  id = np.arange(f
+00031010: 6c6f 6f72 2870 736d 6170 2e79 5f73 697a  loor(psmap.y_siz
+00031020: 6528 2920 2f20 322e 3029 202a 202d 312c  e() / 2.0) * -1,
+00031030: 2063 6569 6c28 7073 6d61 702e 795f 7369   ceil(psmap.y_si
+00031040: 7a65 2829 202f 2032 2e30 2929 202f 2066  ze() / 2.0)) / f
+00031050: 6c6f 6174 2866 6c6f 6f72 2870 736d 6170  loat(floor(psmap
+00031060: 2e79 5f73 697a 6528 2929 290a 2020 2020  .y_size())).    
+00031070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031080: 2320 7867 7269 6420 3d20 6e70 2e61 7261  # xgrid = np.ara
+00031090: 6e67 6528 666c 6f6f 7228 7073 6d61 702e  nge(floor(psmap.
+000310a0: 785f 7369 7a65 2829 202f 2032 2e30 2920  x_size() / 2.0) 
+000310b0: 2a20 2d31 2c20 6365 696c 2870 736d 6170  * -1, ceil(psmap
+000310c0: 2e78 5f73 697a 6528 2920 2f20 322e 3029  .x_size() / 2.0)
+000310d0: 2920 2f20 666c 6f61 7428 666c 6f6f 7228  ) / float(floor(
+000310e0: 7073 6d61 702e 785f 7369 7a65 2829 2929  psmap.x_size()))
+000310f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031100: 2020 2020 207a 6772 6964 203d 206e 702e       zgrid = np.
+00031110: 6172 616e 6765 2866 6c6f 6f72 286d 6170  arange(floor(map
+00031120: 5f7a 7369 7a65 202f 2032 2e30 2920 2a20  _zsize / 2.0) * 
+00031130: 2d31 2c20 6365 696c 286d 6170 5f7a 7369  -1, ceil(map_zsi
+00031140: 7a65 202f 2032 2e30 2929 202f 2066 6c6f  ze / 2.0)) / flo
+00031150: 6174 2866 6c6f 6f72 286d 6170 5f7a 7369  at(floor(map_zsi
+00031160: 7a65 2929 0a20 2020 2020 2020 2020 2020  ze)).           
+00031170: 2020 2020 2020 2020 2079 6772 6964 203d           ygrid =
+00031180: 206e 702e 6172 616e 6765 2866 6c6f 6f72   np.arange(floor
+00031190: 286d 6170 5f79 7369 7a65 202f 2032 2e30  (map_ysize / 2.0
+000311a0: 2920 2a20 2d31 2c20 6365 696c 286d 6170  ) * -1, ceil(map
+000311b0: 5f79 7369 7a65 202f 2032 2e30 2929 202f  _ysize / 2.0)) /
+000311c0: 2066 6c6f 6174 2866 6c6f 6f72 286d 6170   float(floor(map
+000311d0: 5f79 7369 7a65 2929 0a20 2020 2020 2020  _ysize)).       
+000311e0: 2020 2020 2020 2020 2020 2020 2078 6772               xgr
+000311f0: 6964 203d 206e 702e 6172 616e 6765 2866  id = np.arange(f
+00031200: 6c6f 6f72 286d 6170 5f78 7369 7a65 202f  loor(map_xsize /
+00031210: 2032 2e30 2920 2a20 2d31 2c20 6365 696c   2.0) * -1, ceil
+00031220: 286d 6170 5f78 7369 7a65 202f 2032 2e30  (map_xsize / 2.0
+00031230: 2929 202f 2066 6c6f 6174 2866 6c6f 6f72  )) / float(floor
+00031240: 286d 6170 5f78 7369 7a65 2929 0a20 2020  (map_xsize)).   
 00031250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031260: 2020 2320 7967 7269 6420 3d20 6e70 2e61    # ygrid = np.a
-00031270: 7261 6e67 6528 666c 6f6f 7228 7073 6d61  range(floor(psma
-00031280: 702e 795f 7369 7a65 2829 2a32 202f 2032  p.y_size()*2 / 2
-00031290: 2e30 2920 2a20 2d31 2c20 6365 696c 2870  .0) * -1, ceil(p
-000312a0: 736d 6170 2e79 5f73 697a 6528 292a 3220  smap.y_size()*2 
-000312b0: 2f20 322e 3029 2920 2f20 666c 6f61 7428  / 2.0)) / float(
-000312c0: 666c 6f6f 7228 7073 6d61 702e 795f 7369  floor(psmap.y_si
-000312d0: 7a65 2829 2929 0a20 2020 2020 2020 2020  ze())).         
-000312e0: 2020 2020 2020 2020 2020 2023 2078 6772             # xgr
-000312f0: 6964 203d 206e 702e 6172 616e 6765 2866  id = np.arange(f
-00031300: 6c6f 6f72 2870 736d 6170 2e78 5f73 697a  loor(psmap.x_siz
-00031310: 6528 292a 3220 2f20 322e 3029 202a 202d  e()*2 / 2.0) * -
-00031320: 312c 2063 6569 6c28 7073 6d61 702e 785f  1, ceil(psmap.x_
-00031330: 7369 7a65 2829 2a32 202f 2032 2e30 2929  size()*2 / 2.0))
-00031340: 202f 2066 6c6f 6174 2866 6c6f 6f72 2870   / float(floor(p
-00031350: 736d 6170 2e78 5f73 697a 6528 2929 290a  smap.x_size())).
+00031260: 2023 207a 6772 6964 203d 206e 702e 6172   # zgrid = np.ar
+00031270: 616e 6765 2866 6c6f 6f72 2870 736d 6170  ange(floor(psmap
+00031280: 2e7a 5f73 697a 6528 292a 3220 2f20 322e  .z_size()*2 / 2.
+00031290: 3029 202a 202d 312c 2063 6569 6c28 7073  0) * -1, ceil(ps
+000312a0: 6d61 702e 7a5f 7369 7a65 2829 2a32 202f  map.z_size()*2 /
+000312b0: 2032 2e30 2929 202f 2066 6c6f 6174 2866   2.0)) / float(f
+000312c0: 6c6f 6f72 2870 736d 6170 2e7a 5f73 697a  loor(psmap.z_siz
+000312d0: 6528 2929 290a 2020 2020 2020 2020 2020  e())).          
+000312e0: 2020 2020 2020 2020 2020 2320 7967 7269            # ygri
+000312f0: 6420 3d20 6e70 2e61 7261 6e67 6528 666c  d = np.arange(fl
+00031300: 6f6f 7228 7073 6d61 702e 795f 7369 7a65  oor(psmap.y_size
+00031310: 2829 2a32 202f 2032 2e30 2920 2a20 2d31  ()*2 / 2.0) * -1
+00031320: 2c20 6365 696c 2870 736d 6170 2e79 5f73  , ceil(psmap.y_s
+00031330: 697a 6528 292a 3220 2f20 322e 3029 2920  ize()*2 / 2.0)) 
+00031340: 2f20 666c 6f61 7428 666c 6f6f 7228 7073  / float(floor(ps
+00031350: 6d61 702e 795f 7369 7a65 2829 2929 0a20  map.y_size())). 
 00031360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031370: 2020 2020 7864 6973 203d 2078 6772 6964      xdis = xgrid
-00031380: 202a 2a20 320a 2020 2020 2020 2020 2020   ** 2.          
-00031390: 2020 2020 2020 2020 2020 7964 6973 203d            ydis =
-000313a0: 2079 6772 6964 202a 2a20 320a 2020 2020   ygrid ** 2.    
-000313b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000313c0: 7a64 6973 203d 207a 6772 6964 202a 2a20  zdis = zgrid ** 
-000313d0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-000313e0: 2020 2020 2020 6469 7374 203d 206e 702e        dist = np.
-000313f0: 7371 7274 287a 6469 735b 3a2c 204e 6f6e  sqrt(zdis[:, Non
-00031400: 652c 204e 6f6e 655d 202b 2079 6469 735b  e, None] + ydis[
-00031410: 3a2c 204e 6f6e 655d 202b 2078 6469 7329  :, None] + xdis)
-00031420: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00031430: 2020 2020 2020 616c 6c61 7869 7320 3d20        allaxis = 
-00031440: 5b7a 6772 6964 2c20 7967 7269 642c 2078  [zgrid, ygrid, x
-00031450: 6772 6964 5d0a 2020 2020 2020 2020 2020  grid].          
-00031460: 2020 2020 2020 2020 2020 746d 7069 6e64            tmpind
-00031470: 6961 7869 7320 3d20 6d61 7828 616c 6c61  iaxis = max(alla
-00031480: 7869 732c 206b 6579 3d6c 656e 290a 2020  xis, key=len).  
-00031490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000314a0: 2020 696e 6469 6178 6973 7420 3d20 746d    indiaxist = tm
-000314b0: 7069 6e64 6961 7869 735b 746d 7069 6e64  pindiaxis[tmpind
-000314c0: 6961 7869 7320 3e3d 2030 5d0a 2020 2020  iaxis >= 0].    
-000314d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000314e0: 2320 696e 6469 6178 6973 7420 3d20 6e70  # indiaxist = np
-000314f0: 2e61 7261 6e67 6528 302c 206e 702e 616d  .arange(0, np.am
-00031500: 6178 2874 6d70 696e 6469 6178 6973 292c  ax(tmpindiaxis),
-00031510: 302e 3031 3034 2029 0a20 2020 2020 2020  0.0104 ).       
-00031520: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00031530: 6e64 6961 7869 7374 203d 206e 702e 6c69  ndiaxist = np.li
-00031540: 6e73 7061 6365 2830 2c20 6e70 2e61 6d61  nspace(0, np.ama
-00031550: 7828 746d 7069 6e64 6961 7869 7329 2c20  x(tmpindiaxis), 
-00031560: 3230 3020 290a 2020 2020 2020 2020 2020  200 ).          
-00031570: 2020 2020 2020 2020 2020 696e 6469 6178            indiax
-00031580: 6973 203d 206e 702e 6c69 6e73 7061 6365  is = np.linspace
-00031590: 2830 2c20 3120 2f20 2832 202a 2061 7069  (0, 1 / (2 * api
-000315a0: 7829 2c20 6c65 6e28 696e 6469 6178 6973  x), len(indiaxis
-000315b0: 7429 290a 0a20 2020 2020 2020 2020 2020  t))..           
-000315c0: 2020 2020 2020 2020 2061 7073 203d 205b           aps = [
-000315d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000315e0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-000315f0: 616e 6765 286c 656e 2869 6e64 6961 7869  ange(len(indiaxi
-00031600: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
-00031610: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00031620: 6920 3d3d 2030 3a0a 2020 2020 2020 2020  i == 0:.        
-00031630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031640: 2020 2020 696e 6469 6365 7320 3d20 6e70      indices = np
-00031650: 2e61 7267 7768 6572 6528 6469 7374 203d  .argwhere(dist =
-00031660: 3d20 696e 6469 6178 6973 745b 695d 290a  = indiaxist[i]).
-00031670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031680: 2020 2020 2020 2020 2020 2020 2320 7073              # ps
-00031690: 756d 203d 206c 6f67 3130 2870 736d 6170  um = log10(psmap
-000316a0: 2e66 756c 6c4d 6170 5b74 7570 6c65 2869  .fullMap[tuple(i
-000316b0: 6e64 6963 6573 2e54 295d 2e73 756d 2829  ndices.T)].sum()
-000316c0: 202f 206c 656e 2869 6e64 6963 6573 2929   / len(indices))
-000316d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000316e0: 2020 2020 2020 2020 2020 2020 2070 7375               psu
-000316f0: 6d20 3d20 6c6f 6731 3028 6666 746d 6170  m = log10(fftmap
-00031700: 5b74 7570 6c65 2869 6e64 6963 6573 2e54  [tuple(indices.T
-00031710: 295d 2e73 756d 2829 202f 206c 656e 2869  )].sum() / len(i
-00031720: 6e64 6963 6573 2929 0a20 2020 2020 2020  ndices)).       
-00031730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031740: 2020 2020 2061 7073 2e61 7070 656e 6428       aps.append(
-00031750: 7073 756d 290a 2020 2020 2020 2020 2020  psum).          
-00031760: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00031770: 2069 2021 3d20 6c65 6e28 696e 6469 6178   i != len(indiax
-00031780: 6973 2920 2d20 313a 0a20 2020 2020 2020  is) - 1:.       
-00031790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000317a0: 2020 2020 2069 6e64 6963 6573 203d 206e       indices = n
-000317b0: 702e 6172 6777 6865 7265 2828 6469 7374  p.argwhere((dist
-000317c0: 203e 2069 6e64 6961 7869 7374 5b69 5d29   > indiaxist[i])
-000317d0: 2026 2028 6469 7374 203c 3d20 696e 6469   & (dist <= indi
-000317e0: 6178 6973 745b 6920 2b20 315d 2929 0a20  axist[i + 1])). 
-000317f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031800: 2020 2020 2020 2020 2020 2023 2070 7375             # psu
-00031810: 6d20 3d20 6c6f 6731 3028 7073 6d61 702e  m = log10(psmap.
-00031820: 6675 6c6c 4d61 705b 7475 706c 6528 696e  fullMap[tuple(in
-00031830: 6469 6365 732e 5429 5d2e 7375 6d28 2920  dices.T)].sum() 
-00031840: 2f20 6c65 6e28 696e 6469 6365 7329 290a  / len(indices)).
-00031850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031860: 2020 2020 2020 2020 2020 2020 7073 756d              psum
-00031870: 203d 206c 6f67 3130 2866 6674 6d61 705b   = log10(fftmap[
-00031880: 7475 706c 6528 696e 6469 6365 732e 5429  tuple(indices.T)
-00031890: 5d2e 7375 6d28 2920 2f20 6c65 6e28 696e  ].sum() / len(in
-000318a0: 6469 6365 7329 290a 2020 2020 2020 2020  dices)).        
-000318b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000318c0: 2020 2020 6170 732e 6170 7065 6e64 2870      aps.append(p
-000318d0: 7375 6d29 0a20 2020 2020 2020 2020 2020  sum).           
-000318e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000318f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00031900: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00031910: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-00031920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031930: 2320 696e 6469 6365 7320 3d20 6e70 2e61  # indices = np.a
-00031940: 7267 7768 6572 6528 6469 7374 203d 3d20  rgwhere(dist == 
-00031950: 696e 6469 6178 6973 745b 695d 290a 2020  indiaxist[i]).  
+00031370: 2020 2023 2078 6772 6964 203d 206e 702e     # xgrid = np.
+00031380: 6172 616e 6765 2866 6c6f 6f72 2870 736d  arange(floor(psm
+00031390: 6170 2e78 5f73 697a 6528 292a 3220 2f20  ap.x_size()*2 / 
+000313a0: 322e 3029 202a 202d 312c 2063 6569 6c28  2.0) * -1, ceil(
+000313b0: 7073 6d61 702e 785f 7369 7a65 2829 2a32  psmap.x_size()*2
+000313c0: 202f 2032 2e30 2929 202f 2066 6c6f 6174   / 2.0)) / float
+000313d0: 2866 6c6f 6f72 2870 736d 6170 2e78 5f73  (floor(psmap.x_s
+000313e0: 697a 6528 2929 290a 2020 2020 2020 2020  ize())).        
+000313f0: 2020 2020 2020 2020 2020 2020 7864 6973              xdis
+00031400: 203d 2078 6772 6964 202a 2a20 320a 2020   = xgrid ** 2.  
+00031410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031420: 2020 7964 6973 203d 2079 6772 6964 202a    ydis = ygrid *
+00031430: 2a20 320a 2020 2020 2020 2020 2020 2020  * 2.            
+00031440: 2020 2020 2020 2020 7a64 6973 203d 207a          zdis = z
+00031450: 6772 6964 202a 2a20 320a 2020 2020 2020  grid ** 2.      
+00031460: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00031470: 7374 203d 206e 702e 7371 7274 287a 6469  st = np.sqrt(zdi
+00031480: 735b 3a2c 204e 6f6e 652c 204e 6f6e 655d  s[:, None, None]
+00031490: 202b 2079 6469 735b 3a2c 204e 6f6e 655d   + ydis[:, None]
+000314a0: 202b 2078 6469 7329 0a0a 2020 2020 2020   + xdis)..      
+000314b0: 2020 2020 2020 2020 2020 2020 2020 616c                al
+000314c0: 6c61 7869 7320 3d20 5b7a 6772 6964 2c20  laxis = [zgrid, 
+000314d0: 7967 7269 642c 2078 6772 6964 5d0a 2020  ygrid, xgrid].  
+000314e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000314f0: 2020 746d 7069 6e64 6961 7869 7320 3d20    tmpindiaxis = 
+00031500: 6d61 7828 616c 6c61 7869 732c 206b 6579  max(allaxis, key
+00031510: 3d6c 656e 290a 2020 2020 2020 2020 2020  =len).          
+00031520: 2020 2020 2020 2020 2020 696e 6469 6178            indiax
+00031530: 6973 7420 3d20 746d 7069 6e64 6961 7869  ist = tmpindiaxi
+00031540: 735b 746d 7069 6e64 6961 7869 7320 3e3d  s[tmpindiaxis >=
+00031550: 2030 5d0a 2020 2020 2020 2020 2020 2020   0].            
+00031560: 2020 2020 2020 2020 2320 696e 6469 6178          # indiax
+00031570: 6973 7420 3d20 6e70 2e61 7261 6e67 6528  ist = np.arange(
+00031580: 302c 206e 702e 616d 6178 2874 6d70 696e  0, np.amax(tmpin
+00031590: 6469 6178 6973 292c 302e 3031 3034 2029  diaxis),0.0104 )
+000315a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000315b0: 2020 2020 2023 2069 6e64 6961 7869 7374       # indiaxist
+000315c0: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
+000315d0: 2c20 6e70 2e61 6d61 7828 746d 7069 6e64  , np.amax(tmpind
+000315e0: 6961 7869 7329 2c20 3230 3020 290a 2020  iaxis), 200 ).  
+000315f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031600: 2020 696e 6469 6178 6973 203d 206e 702e    indiaxis = np.
+00031610: 6c69 6e73 7061 6365 2830 2c20 3120 2f20  linspace(0, 1 / 
+00031620: 2832 202a 2061 7069 7829 2c20 6c65 6e28  (2 * apix), len(
+00031630: 696e 6469 6178 6973 7429 290a 0a20 2020  indiaxist))..   
+00031640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031650: 2061 7073 203d 205b 5d0a 2020 2020 2020   aps = [].      
+00031660: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00031670: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+00031680: 2869 6e64 6961 7869 7329 293a 0a20 2020  (indiaxis)):.   
+00031690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316a0: 2020 2020 2069 6620 6920 3d3d 2030 3a0a       if i == 0:.
+000316b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316c0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+000316d0: 6365 7320 3d20 6e70 2e61 7267 7768 6572  ces = np.argwher
+000316e0: 6528 6469 7374 203d 3d20 696e 6469 6178  e(dist == indiax
+000316f0: 6973 745b 695d 290a 2020 2020 2020 2020  ist[i]).        
+00031700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031710: 2020 2020 2320 7073 756d 203d 206c 6f67      # psum = log
+00031720: 3130 2870 736d 6170 2e66 756c 6c4d 6170  10(psmap.fullMap
+00031730: 5b74 7570 6c65 2869 6e64 6963 6573 2e54  [tuple(indices.T
+00031740: 295d 2e73 756d 2829 202f 206c 656e 2869  )].sum() / len(i
+00031750: 6e64 6963 6573 2929 0a20 2020 2020 2020  ndices)).       
+00031760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031770: 2020 2020 2070 7375 6d20 3d20 6c6f 6731       psum = log1
+00031780: 3028 6666 746d 6170 5b74 7570 6c65 2869  0(fftmap[tuple(i
+00031790: 6e64 6963 6573 2e54 295d 2e73 756d 2829  ndices.T)].sum()
+000317a0: 202f 206c 656e 2869 6e64 6963 6573 2929   / len(indices))
+000317b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000317c0: 2020 2020 2020 2020 2020 2020 2061 7073               aps
+000317d0: 2e61 7070 656e 6428 7073 756d 290a 2020  .append(psum).  
+000317e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000317f0: 2020 2020 2020 6966 2069 2021 3d20 6c65        if i != le
+00031800: 6e28 696e 6469 6178 6973 2920 2d20 313a  n(indiaxis) - 1:
+00031810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031820: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00031830: 6963 6573 203d 206e 702e 6172 6777 6865  ices = np.argwhe
+00031840: 7265 2828 6469 7374 203e 2069 6e64 6961  re((dist > india
+00031850: 7869 7374 5b69 5d29 2026 2028 6469 7374  xist[i]) & (dist
+00031860: 203c 3d20 696e 6469 6178 6973 745b 6920   <= indiaxist[i 
+00031870: 2b20 315d 2929 0a20 2020 2020 2020 2020  + 1])).         
+00031880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031890: 2020 2023 2070 7375 6d20 3d20 6c6f 6731     # psum = log1
+000318a0: 3028 7073 6d61 702e 6675 6c6c 4d61 705b  0(psmap.fullMap[
+000318b0: 7475 706c 6528 696e 6469 6365 732e 5429  tuple(indices.T)
+000318c0: 5d2e 7375 6d28 2920 2f20 6c65 6e28 696e  ].sum() / len(in
+000318d0: 6469 6365 7329 290a 2020 2020 2020 2020  dices)).        
+000318e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000318f0: 2020 2020 7073 756d 203d 206c 6f67 3130      psum = log10
+00031900: 2866 6674 6d61 705b 7475 706c 6528 696e  (fftmap[tuple(in
+00031910: 6469 6365 732e 5429 5d2e 7375 6d28 2920  dices.T)].sum() 
+00031920: 2f20 6c65 6e28 696e 6469 6365 7329 290a  / len(indices)).
+00031930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031940: 2020 2020 2020 2020 2020 2020 6170 732e              aps.
+00031950: 6170 7065 6e64 2870 7375 6d29 0a20 2020  append(psum).   
 00031960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031970: 2020 2020 2020 2020 2020 2320 7073 756d            # psum
-00031980: 203d 206c 6f67 3130 2870 736d 6170 2e66   = log10(psmap.f
-00031990: 756c 6c4d 6170 5b74 7570 6c65 2869 6e64  ullMap[tuple(ind
-000319a0: 6963 6573 2e54 295d 2e73 756d 2829 202f  ices.T)].sum() /
-000319b0: 206c 656e 2869 6e64 6963 6573 2929 0a20   len(indices)). 
-000319c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000319d0: 2020 2020 2020 2020 2020 2023 2061 7073             # aps
-000319e0: 2e61 7070 656e 6428 7073 756d 290a 2020  .append(psum).  
+00031970: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00031980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031990: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+000319a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000319b0: 2020 2020 2020 2020 2320 696e 6469 6365          # indice
+000319c0: 7320 3d20 6e70 2e61 7267 7768 6572 6528  s = np.argwhere(
+000319d0: 6469 7374 203d 3d20 696e 6469 6178 6973  dist == indiaxis
+000319e0: 745b 695d 290a 2020 2020 2020 2020 2020  t[i]).          
 000319f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031a00: 2020 7072 696e 7428 6170 7329 0a20 2020    print(aps).   
-00031a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031a20: 2069 6620 6170 735b 305d 203c 2030 3a0a   if aps[0] < 0:.
-00031a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031a40: 2020 2020 2020 2020 6170 735b 305d 203d          aps[0] =
-00031a50: 2061 7073 5b31 5d0a 2020 2020 2020 2020   aps[1].        
-00031a60: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00031a70: 6469 6374 203d 207b 6c61 6265 6c20 2b20  dict = {label + 
-00031a80: 2772 6f74 6174 696f 6e61 6c6c 795f 6176  'rotationally_av
-00031a90: 6572 6167 6564 5f70 6f77 6572 5f73 7065  eraged_power_spe
-00031aa0: 6374 7275 6d27 3a20 207b 2779 273a 206e  ctrum':  {'y': n
-00031ab0: 702e 726f 756e 6428 6170 732c 2031 3029  p.round(aps, 10)
-00031ac0: 2e74 6f6c 6973 7428 292c 0a20 2020 2020  .tolist(),.     
-00031ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031a00: 2020 2320 7073 756d 203d 206c 6f67 3130    # psum = log10
+00031a10: 2870 736d 6170 2e66 756c 6c4d 6170 5b74  (psmap.fullMap[t
+00031a20: 7570 6c65 2869 6e64 6963 6573 2e54 295d  uple(indices.T)]
+00031a30: 2e73 756d 2829 202f 206c 656e 2869 6e64  .sum() / len(ind
+00031a40: 6963 6573 2929 0a20 2020 2020 2020 2020  ices)).         
+00031a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031a60: 2020 2023 2061 7073 2e61 7070 656e 6428     # aps.append(
+00031a70: 7073 756d 290a 2020 2020 2020 2020 2020  psum).          
+00031a80: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00031a90: 6170 7329 0a20 2020 2020 2020 2020 2020  aps).           
+00031aa0: 2020 2020 2020 2020 2069 6620 6170 735b           if aps[
+00031ab0: 305d 203c 2030 3a0a 2020 2020 2020 2020  0] < 0:.        
+00031ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031ad0: 6170 735b 305d 203d 2061 7073 5b31 5d0a  aps[0] = aps[1].
 00031ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031b10: 2020 2020 2778 273a 206e 702e 726f 756e      'x': np.roun
-00031b20: 6428 696e 6469 6178 6973 2c20 3130 292e  d(indiaxis, 10).
-00031b30: 746f 6c69 7374 2829 7d7d 0a20 2020 2020  tolist()}}.     
-00031b40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00031b50: 6c74 2e66 6967 7572 6528 6669 6773 697a  lt.figure(figsiz
-00031b60: 653d 2831 302c 2033 2929 0a20 2020 2020  e=(10, 3)).     
-00031b70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00031b80: 6c74 2e70 6c6f 7428 6e70 2e72 6f75 6e64  lt.plot(np.round
-00031b90: 2869 6e64 6961 7869 732c 2034 292e 746f  (indiaxis, 4).to
-00031ba0: 6c69 7374 2829 2c20 6e70 2e72 6f75 6e64  list(), np.round
-00031bb0: 2861 7073 2c20 3429 2e74 6f6c 6973 7428  (aps, 4).tolist(
-00031bc0: 292c 2029 0a20 2020 2020 2020 2020 2020  ), ).           
-00031bd0: 2020 2020 2020 2020 2070 6c74 2e73 6176           plt.sav
-00031be0: 6566 6967 2877 6f72 6b64 6972 202b 2073  efig(workdir + s
-00031bf0: 656c 662e 6d61 706e 616d 6520 2b20 275f  elf.mapname + '_
-00031c00: 7261 7073 2e70 6e67 2729 0a20 2020 2020  raps.png').     
-00031c10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00031c20: 6c74 2e63 6c6f 7365 2829 0a0a 2020 2020  lt.close()..    
-00031c30: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00031c40: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-00031c50: 2020 2020 2020 2020 6572 7220 3d20 2752          err = 'R
-00031c60: 4150 5320 6361 6c63 756c 6174 696f 6e20  APS calculation 
-00031c70: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
-00031c80: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-00031c90: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-00031ca0: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
-00031cb0: 742e 6170 7065 6e64 2865 7272 290a 2020  t.append(err).  
-00031cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031cd0: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-00031ce0: 7465 2865 7272 202b 2027 5c6e 2729 0a0a  te(err + '\n')..
-00031cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031d00: 6966 2065 7272 6c69 7374 3a0a 2020 2020  if errlist:.    
-00031d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031d20: 6461 7461 6469 6374 203d 207b 2772 6f74  datadict = {'rot
-00031d30: 6174 696f 6e61 6c6c 795f 6176 6572 6167  ationally_averag
-00031d40: 6564 5f70 6f77 6572 5f73 7065 6374 7275  ed_power_spectru
-00031d50: 6d27 3a20 7b27 6572 7227 3a20 7b27 7261  m': {'err': {'ra
-00031d60: 7073 5f65 7272 273a 2065 7272 6c69 7374  ps_err': errlist
-00031d70: 7d7d 7d0a 0a20 2020 2020 2020 2020 2020  }}}..           
-00031d80: 2020 2020 2069 6620 626f 6f6c 2864 6174       if bool(dat
-00031d90: 6164 6963 7429 3a0a 2020 2020 2020 2020  adict):.        
-00031da0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00031db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031dc0: 2020 2020 2020 2020 2077 6974 6820 636f           with co
-00031dd0: 6465 6373 2e6f 7065 6e28 776f 726b 6469  decs.open(workdi
-00031de0: 7220 2b20 6d61 706e 616d 6520 2b20 275f  r + mapname + '_
-00031df0: 7261 7073 2e6a 736f 6e27 2c20 2777 272c  raps.json', 'w',
-00031e00: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
-00031e10: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00031af0: 2020 2020 6461 7461 6469 6374 203d 207b      datadict = {
+00031b00: 6c61 6265 6c20 2b20 2772 6f74 6174 696f  label + 'rotatio
+00031b10: 6e61 6c6c 795f 6176 6572 6167 6564 5f70  nally_averaged_p
+00031b20: 6f77 6572 5f73 7065 6374 7275 6d27 3a20  ower_spectrum': 
+00031b30: 207b 2779 273a 206e 702e 726f 756e 6428   {'y': np.round(
+00031b40: 6170 732c 2031 3029 2e74 6f6c 6973 7428  aps, 10).tolist(
+00031b50: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00031b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031b90: 2020 2020 2020 2020 2020 2020 2778 273a              'x':
+00031ba0: 206e 702e 726f 756e 6428 696e 6469 6178   np.round(indiax
+00031bb0: 6973 2c20 3130 292e 746f 6c69 7374 2829  is, 10).tolist()
+00031bc0: 7d7d 0a20 2020 2020 2020 2020 2020 2020  }}.             
+00031bd0: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
+00031be0: 6528 6669 6773 697a 653d 2831 302c 2033  e(figsize=(10, 3
+00031bf0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00031c00: 2020 2020 2020 2070 6c74 2e70 6c6f 7428         plt.plot(
+00031c10: 6e70 2e72 6f75 6e64 2869 6e64 6961 7869  np.round(indiaxi
+00031c20: 732c 2034 292e 746f 6c69 7374 2829 2c20  s, 4).tolist(), 
+00031c30: 6e70 2e72 6f75 6e64 2861 7073 2c20 3429  np.round(aps, 4)
+00031c40: 2e74 6f6c 6973 7428 292c 2029 0a20 2020  .tolist(), ).   
+00031c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031c60: 2070 6c74 2e73 6176 6566 6967 2877 6f72   plt.savefig(wor
+00031c70: 6b64 6972 202b 2073 656c 662e 6d61 706e  kdir + self.mapn
+00031c80: 616d 6520 2b20 275f 7261 7073 2e70 6e67  ame + '_raps.png
+00031c90: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00031ca0: 2020 2020 2020 2070 6c74 2e63 6c6f 7365         plt.close
+00031cb0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00031cc0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+00031cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031ce0: 6572 7220 3d20 2752 4150 5320 6361 6c63  err = 'RAPS calc
+00031cf0: 756c 6174 696f 6e20 6572 726f 723a 207b  ulation error: {
+00031d00: 7d2e 272e 666f 726d 6174 2873 7973 2e65  }.'.format(sys.e
+00031d10: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
+00031d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031d30: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
+00031d40: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
+00031d50: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+00031d60: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
+00031d70: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+00031d80: 2020 2020 2020 2020 6966 2065 7272 6c69          if errli
+00031d90: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00031da0: 2020 2020 2020 2020 6461 7461 6469 6374          datadict
+00031db0: 203d 207b 2772 6f74 6174 696f 6e61 6c6c   = {'rotationall
+00031dc0: 795f 6176 6572 6167 6564 5f70 6f77 6572  y_averaged_power
+00031dd0: 5f73 7065 6374 7275 6d27 3a20 7b27 6572  _spectrum': {'er
+00031de0: 7227 3a20 7b27 7261 7073 5f65 7272 273a  r': {'raps_err':
+00031df0: 2065 7272 6c69 7374 7d7d 7d0a 0a20 2020   errlist}}}..   
+00031e00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00031e10: 626f 6f6c 2864 6174 6164 6963 7429 3a0a  bool(datadict):.
 00031e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031e30: 2020 2020 206a 736f 6e2e 6475 6d70 2864       json.dump(d
-00031e40: 6174 6164 6963 742c 2066 290a 2020 2020  atadict, f).    
-00031e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031e60: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00031e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031e80: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
-00031e90: 2827 5361 7669 6e67 2052 4150 5320 746f  ('Saving RAPS to
-00031ea0: 206a 736f 6e20 6572 726f 723a 207b 7d2e   json error: {}.
-00031eb0: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
-00031ec0: 5f69 6e66 6f28 295b 315d 2929 0a20 2020  _info()[1])).   
-00031ed0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00031ee0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00031ef0: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-00031f00: 722e 7772 6974 6528 274e 6f20 7261 7073  r.write('No raps
-00031f10: 2064 6174 6120 696e 2074 6865 2064 6963   data in the dic
-00031f20: 7469 6f6e 6172 792c 206e 6f20 7261 7073  tionary, no raps
-00031f30: 206a 736f 6e20 6669 6c65 2e5c 6e27 290a   json file.\n').
-00031f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031f50: 2065 6e64 203d 2074 696d 6569 742e 6465   end = timeit.de
-00031f60: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
-00031f70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00031f80: 696e 7428 2752 4150 5320 7469 6d65 2066  int('RAPS time f
-00031f90: 6f72 2025 733a 2025 7327 2025 2028 6d61  or %s: %s' % (ma
-00031fa0: 706e 616d 652c 2065 6e64 202d 2073 7461  pname, end - sta
-00031fb0: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
-00031fc0: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
-00031fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00031fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00031ff0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
-00032000: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00032010: 2020 2020 2070 7269 6e74 2827 4e6f 2052       print('No R
-00032020: 4150 5320 6361 6c63 756c 6174 696f 6e20  APS calculation 
-00032030: 666f 7220 6e6f 6e2d 6375 6269 6320 6d61  for non-cubic ma
-00032040: 702e 2729 0a20 2020 2020 2020 2020 2020  p.').           
-00032050: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+00031e30: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00031e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031e50: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
+00031e60: 6e28 776f 726b 6469 7220 2b20 6d61 706e  n(workdir + mapn
+00031e70: 616d 6520 2b20 275f 7261 7073 2e6a 736f  ame + '_raps.jso
+00031e80: 6e27 2c20 2777 272c 2065 6e63 6f64 696e  n', 'w', encodin
+00031e90: 673d 2775 7466 2d38 2729 2061 7320 663a  g='utf-8') as f:
+00031ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031eb0: 2020 2020 2020 2020 2020 2020 206a 736f               jso
+00031ec0: 6e2e 6475 6d70 2864 6174 6164 6963 742c  n.dump(datadict,
+00031ed0: 2066 290a 2020 2020 2020 2020 2020 2020   f).            
+00031ee0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+00031ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031f00: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+00031f10: 7272 2e77 7269 7465 2827 5361 7669 6e67  rr.write('Saving
+00031f20: 2052 4150 5320 746f 206a 736f 6e20 6572   RAPS to json er
+00031f30: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
+00031f40: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
+00031f50: 315d 2929 0a20 2020 2020 2020 2020 2020  1])).           
+00031f60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00031f70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00031f80: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+00031f90: 274e 6f20 7261 7073 2064 6174 6120 696e  'No raps data in
+00031fa0: 2074 6865 2064 6963 7469 6f6e 6172 792c   the dictionary,
+00031fb0: 206e 6f20 7261 7073 206a 736f 6e20 6669   no raps json fi
+00031fc0: 6c65 2e5c 6e27 290a 0a20 2020 2020 2020  le.\n')..       
+00031fd0: 2020 2020 2020 2020 2065 6e64 203d 2074           end = t
+00031fe0: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
+00031ff0: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
+00032000: 2020 2020 2020 7072 696e 7428 2752 4150        print('RAP
+00032010: 5320 7469 6d65 2066 6f72 2025 733a 2025  S time for %s: %
+00032020: 7327 2025 2028 6d61 706e 616d 652c 2065  s' % (mapname, e
+00032030: 6e64 202d 2073 7461 7274 2929 0a20 2020  nd - start)).   
+00032040: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00032050: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
 00032060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00032070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00032080: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-00032090: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-000320a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000320b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000320c0: 274e 6f20 5241 5053 2077 6974 686f 7574  'No RAPS without
-000320d0: 2070 726f 7065 7220 6d61 7020 696e 7075   proper map inpu
-000320e0: 7420 616e 6420 7468 6520 6f75 7470 7574  t and the output
-000320f0: 2064 6972 6563 746f 7279 2069 6e66 6f72   directory infor
-00032100: 6d61 7469 6f6e 2e27 290a 0a0a 2020 2020  mation.')...    
-00032110: 2320 4265 6c6f 7720 4865 7265 2069 7320  # Below Here is 
-00032120: 7468 6520 7465 7374 206e 6577 2072 6170  the test new rap
-00032130: 7320 6675 6e63 7469 6f6e 2061 7265 610a  s function area.
-00032140: 0a20 2020 2064 6566 2061 7070 6c79 5f33  .    def apply_3
-00032150: 645f 7379 6d6d 6574 7279 2873 656c 662c  d_symmetry(self,
-00032160: 2069 6e64 732c 206f 7269 6769 6e29 3a0a   inds, origin):.
-00032170: 2020 2020 2020 2020 4f20 3d20 6f72 6967          O = orig
-00032180: 696e 0a20 2020 2020 2020 206f 7065 7261  in.        opera
-00032190: 746f 7273 203d 205b 5b6e 702e 6172 7261  tors = [[np.arra
-000321a0: 7928 5b2d 312c 2031 2c20 315d 292c 205b  y([-1, 1, 1]), [
-000321b0: 4f5b 305d 202a 2032 2c20 302c 2030 5d5d  O[0] * 2, 0, 0]]
-000321c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000321d0: 2020 2020 2020 205b 6e70 2e61 7272 6179         [np.array
-000321e0: 285b 312c 2031 2c20 2d31 5d29 2c20 5b30  ([1, 1, -1]), [0
-000321f0: 2c20 302c 204f 5b32 5d20 2a20 325d 5d2c  , 0, O[2] * 2]],
-00032200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032210: 2020 2020 2020 2320 5b6e 702e 6172 7261        # [np.arra
-00032220: 7928 5b31 2c20 2d31 2c20 315d 292c 205b  y([1, -1, 1]), [
-00032230: 302c 204f 5b31 5d20 2a20 322c 2030 5d5d  0, O[1] * 2, 0]]
-00032240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00032250: 2020 2020 2020 2023 205b 6e70 2e61 7272         # [np.arr
-00032260: 6179 285b 2d31 2c20 2d31 2c20 315d 292c  ay([-1, -1, 1]),
-00032270: 205b 4f5b 305d 202a 2032 2c20 4f5b 315d   [O[0] * 2, O[1]
-00032280: 202a 2032 2c20 305d 5d2c 0a20 2020 2020   * 2, 0]],.     
-00032290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000322a0: 5b6e 702e 6172 7261 7928 5b2d 312c 2031  [np.array([-1, 1
-000322b0: 2c20 2d31 5d29 2c20 5b4f 5b30 5d20 2a20  , -1]), [O[0] * 
-000322c0: 322c 2030 2c20 4f5b 325d 202a 2032 5d5d  2, 0, O[2] * 2]]
-000322d0: 2c5d 0a20 2020 2020 2020 2020 2020 2020  ,].             
-000322e0: 2020 2020 2020 2020 2320 5b6e 702e 6172          # [np.ar
-000322f0: 7261 7928 5b31 2c20 2d31 2c20 2d31 5d29  ray([1, -1, -1])
-00032300: 2c20 5b30 2c20 4f5b 315d 202a 2032 2c20  , [0, O[1] * 2, 
-00032310: 4f5b 325d 202a 2032 5d5d 2c0a 2020 2020  O[2] * 2]],.    
-00032320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032330: 2023 205b 6e70 2e61 7272 6179 285b 2d31   # [np.array([-1
-00032340: 2c20 2d31 2c20 2d31 5d29 2c20 5b4f 5b30  , -1, -1]), [O[0
-00032350: 5d20 2a20 322c 204f 5b31 5d20 2a20 322c  ] * 2, O[1] * 2,
-00032360: 204f 5b32 5d20 2a20 325d 5d5d 0a20 2020   O[2] * 2]]].   
-00032370: 2020 2020 2069 6e64 203d 206e 702e 6172       ind = np.ar
-00032380: 7261 7928 696e 6473 290a 2020 2020 2020  ray(inds).      
-00032390: 2020 7265 7320 3d20 6e70 2e61 7272 6179    res = np.array
-000323a0: 2869 6e64 7329 0a20 2020 2020 2020 2023  (inds).        #
-000323b0: 2077 3120 3d20 6e70 2e77 6865 7265 2828   w1 = np.where((
-000323c0: 696e 645b 3a2c 2031 5d20 3d3d 204f 5b31  ind[:, 1] == O[1
-000323d0: 5d29 207c 2028 696e 645b 3a2c 2030 5d20  ]) | (ind[:, 0] 
-000323e0: 3d3d 204f 5b30 5d29 207c 2028 696e 645b  == O[0]) | (ind[
-000323f0: 3a2c 2032 5d20 3d3d 204f 5b32 5d29 2c20  :, 2] == O[2]), 
-00032400: 5472 7565 2c20 4661 6c73 6529 0a20 2020  True, False).   
-00032410: 2020 2020 2023 2077 3120 3d20 696e 645b       # w1 = ind[
-00032420: 7731 2c20 3a5d 0a20 2020 2020 2020 2023  w1, :].        #
-00032430: 2077 3220 3d20 6e70 2e77 6865 7265 2828   w2 = np.where((
-00032440: 696e 645b 3a2c 2031 5d20 213d 204f 5b31  ind[:, 1] != O[1
-00032450: 5d29 207c 2028 696e 645b 3a2c 2030 5d20  ]) | (ind[:, 0] 
-00032460: 213d 204f 5b30 5d29 207c 2028 696e 645b  != O[0]) | (ind[
-00032470: 3a2c 2032 5d20 213d 204f 5b32 5d29 2c20  :, 2] != O[2]), 
-00032480: 5472 7565 2c20 4661 6c73 6529 0a20 2020  True, False).   
-00032490: 2020 2020 2023 2077 3220 3d20 696e 645b       # w2 = ind[
-000324a0: 7732 2c20 3a5d 0a20 2020 2020 2020 2066  w2, :].        f
-000324b0: 6f72 206f 7020 696e 206f 7065 7261 746f  or op in operato
-000324c0: 7273 5b3a 5d3a 0a20 2020 2020 2020 2020  rs[:]:.         
-000324d0: 2020 2023 2074 6d70 203d 2077 3220 2a20     # tmp = w2 * 
-000324e0: 6f70 5b30 5d20 2b20 6e70 2e61 7272 6179  op[0] + np.array
-000324f0: 286f 705b 315d 290a 2020 2020 2020 2020  (op[1]).        
-00032500: 2020 2020 746d 7020 3d20 696e 6420 2a20      tmp = ind * 
-00032510: 6f70 5b30 5d20 2b20 6e70 2e61 7272 6179  op[0] + np.array
-00032520: 286f 705b 315d 290a 2020 2020 2020 2020  (op[1]).        
-00032530: 2020 2020 7265 7320 3d20 6e70 2e63 6f6e      res = np.con
-00032540: 6361 7465 6e61 7465 2828 7265 732c 2074  catenate((res, t
-00032550: 6d70 2929 0a20 2020 2020 2020 2023 206f  mp)).        # o
-00032560: 6e5f 6178 6973 5f72 6573 203d 206e 702e  n_axis_res = np.
-00032570: 636f 6e63 6174 656e 6174 6528 2877 3120  concatenate((w1 
-00032580: 2a20 6e70 2e61 7272 6179 285b 2d31 2c20  * np.array([-1, 
-00032590: 2d31 2c20 2d31 5d29 202b 206e 702e 6172  -1, -1]) + np.ar
-000325a0: 7261 7928 5b4f 5b30 5d20 2a20 322c 204f  ray([O[0] * 2, O
-000325b0: 5b31 5d20 2a20 322c 204f 5b32 5d20 2a20  [1] * 2, O[2] * 
-000325c0: 325d 292c 2077 3129 290a 2020 2020 2020  2]), w1)).      
-000325d0: 2020 2320 7265 7320 3d20 6e70 2e63 6f6e    # res = np.con
-000325e0: 6361 7465 6e61 7465 2828 7265 732c 206f  catenate((res, o
-000325f0: 6e5f 6178 6973 5f72 6573 2929 0a20 2020  n_axis_res)).   
-00032600: 2020 2020 2072 6574 7572 6e20 6e70 2e75       return np.u
-00032610: 6e69 7175 6528 7265 732c 2061 7869 733d  nique(res, axis=
-00032620: 3029 0a0a 2020 2020 6465 6620 6765 6e65  0)..    def gene
-00032630: 7261 7465 5f73 6865 6c6c 2873 656c 662c  rate_shell(self,
-00032640: 206e 312c 206e 322c 2073 6861 7065 293a   n1, n2, shape):
-00032650: 0a20 2020 2020 2020 2064 3120 3d20 6e31  .        d1 = n1
-00032660: 0a20 2020 2020 2020 2064 3220 3d20 6e32  .        d2 = n2
-00032670: 0a20 2020 2020 2020 2023 204f 3120 3d20  .        # O1 = 
-00032680: 5b73 6861 7065 5b30 5d2f 2f32 2c20 7368  [shape[0]//2, sh
-00032690: 6170 655b 315d 2f2f 322c 2073 6861 7065  ape[1]//2, shape
-000326a0: 5b32 5d2f 2f32 5d0a 2020 2020 2020 2020  [2]//2].        
-000326b0: 2320 6576 656e 206e 756d 6265 7220 666f  # even number fo
-000326c0: 7220 6772 6964 0a20 2020 2020 2020 2023  r grid.        #
-000326d0: 2062 6173 6564 206f 6e20 6666 740a 2020   based on fft.  
-000326e0: 2020 2020 2020 6966 206d 696e 2873 6861        if min(sha
-000326f0: 7065 2920 2520 3220 3d3d 2030 3a0a 2020  pe) % 2 == 0:.  
-00032700: 2020 2020 2020 2020 2020 4f31 203d 205b            O1 = [
-00032710: 7368 6170 655b 305d 202f 2032 2c20 7368  shape[0] / 2, sh
-00032720: 6170 655b 315d 202f 2032 2c20 7368 6170  ape[1] / 2, shap
-00032730: 655b 325d 202f 2032 5d0a 2020 2020 2020  e[2] / 2].      
-00032740: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00032750: 2020 2020 4f31 203d 205b 2873 6861 7065      O1 = [(shape
-00032760: 5b30 5d20 2d20 3129 202f 2032 2c20 2873  [0] - 1) / 2, (s
-00032770: 6861 7065 5b31 5d20 2d20 3129 202f 2032  hape[1] - 1) / 2
-00032780: 2c20 2873 6861 7065 5b32 5d20 2d20 3129  , (shape[2] - 1)
-00032790: 202f 2032 5d0a 2020 2020 2020 2020 696e   / 2].        in
-000327a0: 6469 6365 7320 3d20 5b5d 0a20 2020 2020  dices = [].     
-000327b0: 2020 2023 206d 616b 6520 7375 7265 0a20     # make sure. 
-000327c0: 2020 2020 2020 2078 5f6d 6178 203d 2069         x_max = i
-000327d0: 6e74 2864 3229 202b 2069 6e74 284f 315b  nt(d2) + int(O1[
-000327e0: 305d 2920 2b20 3120 6966 2069 6e74 2864  0]) + 1 if int(d
-000327f0: 3229 202b 2069 6e74 284f 315b 305d 2920  2) + int(O1[0]) 
-00032800: 3c20 7368 6170 655b 305d 2065 6c73 6520  < shape[0] else 
-00032810: 696e 7428 6432 2920 2b20 696e 7428 4f31  int(d2) + int(O1
-00032820: 5b30 5d29 0a20 2020 2020 2020 2079 5f6d  [0]).        y_m
-00032830: 6178 203d 2069 6e74 2864 3229 202b 2069  ax = int(d2) + i
-00032840: 6e74 284f 315b 315d 2920 2b20 3120 6966  nt(O1[1]) + 1 if
-00032850: 2069 6e74 2864 3229 202b 2069 6e74 284f   int(d2) + int(O
-00032860: 315b 315d 2920 3c20 7368 6170 655b 315d  1[1]) < shape[1]
-00032870: 2065 6c73 6520 696e 7428 6432 2920 2b20   else int(d2) + 
-00032880: 696e 7428 4f31 5b31 5d29 0a20 2020 2020  int(O1[1]).     
-00032890: 2020 2066 6f72 2078 2069 6e20 7261 6e67     for x in rang
-000328a0: 6528 726f 756e 6428 4f31 5b30 5d20 2b20  e(round(O1[0] + 
-000328b0: 302e 3129 2c20 785f 6d61 7829 3a0a 2020  0.1), x_max):.  
-000328c0: 2020 2020 2020 2020 2020 666f 7220 7920            for y 
-000328d0: 696e 2072 616e 6765 2872 6f75 6e64 284f  in range(round(O
-000328e0: 315b 315d 202b 2030 2e31 292c 2079 5f6d  1[1] + 0.1), y_m
-000328f0: 6178 293a 0a20 2020 2020 2020 2020 2020  ax):.           
-00032900: 2020 2020 2078 795f 6469 7374 203d 206d       xy_dist = m
-00032910: 6174 682e 7371 7274 2828 7820 2d20 4f31  ath.sqrt((x - O1
-00032920: 5b30 5d29 202a 2a20 3220 2b20 2879 202d  [0]) ** 2 + (y -
-00032930: 204f 315b 315d 2920 2a2a 2032 290a 2020   O1[1]) ** 2).  
-00032940: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00032950: 2078 795f 6469 7374 203c 3d20 6432 3a0a   xy_dist <= d2:.
-00032960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032970: 2020 2020 6966 2078 795f 6469 7374 203d      if xy_dist =
-00032980: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00032990: 2020 2020 2020 2020 2020 2020 207a 5f6d               z_m
-000329a0: 696e 203d 2069 6e74 284f 315b 325d 202b  in = int(O1[2] +
-000329b0: 2064 3129 0a20 2020 2020 2020 2020 2020   d1).           
-000329c0: 2020 2020 2020 2020 2020 2020 207a 5f6d               z_m
-000329d0: 6178 203d 2069 6e74 284f 315b 325d 202b  ax = int(O1[2] +
-000329e0: 2064 3229 0a20 2020 2020 2020 2020 2020   d2).           
-000329f0: 2020 2020 2020 2020 2065 6c69 6620 7879           elif xy
-00032a00: 5f64 6973 7420 3c20 6431 3a0a 2020 2020  _dist < d1:.    
+00032070: 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020 2020  --------').     
+00032080: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00032090: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+000320a0: 6e74 2827 4e6f 2052 4150 5320 6361 6c63  nt('No RAPS calc
+000320b0: 756c 6174 696f 6e20 666f 7220 6e6f 6e2d  ulation for non-
+000320c0: 6375 6269 6320 6d61 702e 2729 0a20 2020  cubic map.').   
+000320d0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+000320e0: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
+000320f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00032100: 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020 2020  --------')..    
+00032110: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00032120: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+00032130: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00032140: 2020 7072 696e 7428 274e 6f20 5241 5053    print('No RAPS
+00032150: 2077 6974 686f 7574 2070 726f 7065 7220   without proper 
+00032160: 6d61 7020 696e 7075 7420 616e 6420 7468  map input and th
+00032170: 6520 6f75 7470 7574 2064 6972 6563 746f  e output directo
+00032180: 7279 2069 6e66 6f72 6d61 7469 6f6e 2e27  ry information.'
+00032190: 290a 0a0a 2020 2020 2320 4265 6c6f 7720  )...    # Below 
+000321a0: 4865 7265 2069 7320 7468 6520 7465 7374  Here is the test
+000321b0: 206e 6577 2072 6170 7320 6675 6e63 7469   new raps functi
+000321c0: 6f6e 2061 7265 610a 0a20 2020 2064 6566  on area..    def
+000321d0: 2061 7070 6c79 5f33 645f 7379 6d6d 6574   apply_3d_symmet
+000321e0: 7279 2873 656c 662c 2069 6e64 732c 206f  ry(self, inds, o
+000321f0: 7269 6769 6e29 3a0a 2020 2020 2020 2020  rigin):.        
+00032200: 4f20 3d20 6f72 6967 696e 0a20 2020 2020  O = origin.     
+00032210: 2020 206f 7065 7261 746f 7273 203d 205b     operators = [
+00032220: 5b6e 702e 6172 7261 7928 5b2d 312c 2031  [np.array([-1, 1
+00032230: 2c20 315d 292c 205b 4f5b 305d 202a 2032  , 1]), [O[0] * 2
+00032240: 2c20 302c 2030 5d5d 2c0a 2020 2020 2020  , 0, 0]],.      
+00032250: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00032260: 6e70 2e61 7272 6179 285b 312c 2031 2c20  np.array([1, 1, 
+00032270: 2d31 5d29 2c20 5b30 2c20 302c 204f 5b32  -1]), [0, 0, O[2
+00032280: 5d20 2a20 325d 5d2c 0a20 2020 2020 2020  ] * 2]],.       
+00032290: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000322a0: 5b6e 702e 6172 7261 7928 5b31 2c20 2d31  [np.array([1, -1
+000322b0: 2c20 315d 292c 205b 302c 204f 5b31 5d20  , 1]), [0, O[1] 
+000322c0: 2a20 322c 2030 5d5d 2c0a 2020 2020 2020  * 2, 0]],.      
+000322d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000322e0: 205b 6e70 2e61 7272 6179 285b 2d31 2c20   [np.array([-1, 
+000322f0: 2d31 2c20 315d 292c 205b 4f5b 305d 202a  -1, 1]), [O[0] *
+00032300: 2032 2c20 4f5b 315d 202a 2032 2c20 305d   2, O[1] * 2, 0]
+00032310: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00032320: 2020 2020 2020 2020 5b6e 702e 6172 7261          [np.arra
+00032330: 7928 5b2d 312c 2031 2c20 2d31 5d29 2c20  y([-1, 1, -1]), 
+00032340: 5b4f 5b30 5d20 2a20 322c 2030 2c20 4f5b  [O[0] * 2, 0, O[
+00032350: 325d 202a 2032 5d5d 2c5d 0a20 2020 2020  2] * 2]],].     
+00032360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032370: 2320 5b6e 702e 6172 7261 7928 5b31 2c20  # [np.array([1, 
+00032380: 2d31 2c20 2d31 5d29 2c20 5b30 2c20 4f5b  -1, -1]), [0, O[
+00032390: 315d 202a 2032 2c20 4f5b 325d 202a 2032  1] * 2, O[2] * 2
+000323a0: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+000323b0: 2020 2020 2020 2020 2023 205b 6e70 2e61           # [np.a
+000323c0: 7272 6179 285b 2d31 2c20 2d31 2c20 2d31  rray([-1, -1, -1
+000323d0: 5d29 2c20 5b4f 5b30 5d20 2a20 322c 204f  ]), [O[0] * 2, O
+000323e0: 5b31 5d20 2a20 322c 204f 5b32 5d20 2a20  [1] * 2, O[2] * 
+000323f0: 325d 5d5d 0a20 2020 2020 2020 2069 6e64  2]]].        ind
+00032400: 203d 206e 702e 6172 7261 7928 696e 6473   = np.array(inds
+00032410: 290a 2020 2020 2020 2020 7265 7320 3d20  ).        res = 
+00032420: 6e70 2e61 7272 6179 2869 6e64 7329 0a20  np.array(inds). 
+00032430: 2020 2020 2020 2023 2077 3120 3d20 6e70         # w1 = np
+00032440: 2e77 6865 7265 2828 696e 645b 3a2c 2031  .where((ind[:, 1
+00032450: 5d20 3d3d 204f 5b31 5d29 207c 2028 696e  ] == O[1]) | (in
+00032460: 645b 3a2c 2030 5d20 3d3d 204f 5b30 5d29  d[:, 0] == O[0])
+00032470: 207c 2028 696e 645b 3a2c 2032 5d20 3d3d   | (ind[:, 2] ==
+00032480: 204f 5b32 5d29 2c20 5472 7565 2c20 4661   O[2]), True, Fa
+00032490: 6c73 6529 0a20 2020 2020 2020 2023 2077  lse).        # w
+000324a0: 3120 3d20 696e 645b 7731 2c20 3a5d 0a20  1 = ind[w1, :]. 
+000324b0: 2020 2020 2020 2023 2077 3220 3d20 6e70         # w2 = np
+000324c0: 2e77 6865 7265 2828 696e 645b 3a2c 2031  .where((ind[:, 1
+000324d0: 5d20 213d 204f 5b31 5d29 207c 2028 696e  ] != O[1]) | (in
+000324e0: 645b 3a2c 2030 5d20 213d 204f 5b30 5d29  d[:, 0] != O[0])
+000324f0: 207c 2028 696e 645b 3a2c 2032 5d20 213d   | (ind[:, 2] !=
+00032500: 204f 5b32 5d29 2c20 5472 7565 2c20 4661   O[2]), True, Fa
+00032510: 6c73 6529 0a20 2020 2020 2020 2023 2077  lse).        # w
+00032520: 3220 3d20 696e 645b 7732 2c20 3a5d 0a20  2 = ind[w2, :]. 
+00032530: 2020 2020 2020 2066 6f72 206f 7020 696e         for op in
+00032540: 206f 7065 7261 746f 7273 5b3a 5d3a 0a20   operators[:]:. 
+00032550: 2020 2020 2020 2020 2020 2023 2074 6d70             # tmp
+00032560: 203d 2077 3220 2a20 6f70 5b30 5d20 2b20   = w2 * op[0] + 
+00032570: 6e70 2e61 7272 6179 286f 705b 315d 290a  np.array(op[1]).
+00032580: 2020 2020 2020 2020 2020 2020 746d 7020              tmp 
+00032590: 3d20 696e 6420 2a20 6f70 5b30 5d20 2b20  = ind * op[0] + 
+000325a0: 6e70 2e61 7272 6179 286f 705b 315d 290a  np.array(op[1]).
+000325b0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+000325c0: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+000325d0: 2828 7265 732c 2074 6d70 2929 0a20 2020  ((res, tmp)).   
+000325e0: 2020 2020 2023 206f 6e5f 6178 6973 5f72       # on_axis_r
+000325f0: 6573 203d 206e 702e 636f 6e63 6174 656e  es = np.concaten
+00032600: 6174 6528 2877 3120 2a20 6e70 2e61 7272  ate((w1 * np.arr
+00032610: 6179 285b 2d31 2c20 2d31 2c20 2d31 5d29  ay([-1, -1, -1])
+00032620: 202b 206e 702e 6172 7261 7928 5b4f 5b30   + np.array([O[0
+00032630: 5d20 2a20 322c 204f 5b31 5d20 2a20 322c  ] * 2, O[1] * 2,
+00032640: 204f 5b32 5d20 2a20 325d 292c 2077 3129   O[2] * 2]), w1)
+00032650: 290a 2020 2020 2020 2020 2320 7265 7320  ).        # res 
+00032660: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00032670: 2828 7265 732c 206f 6e5f 6178 6973 5f72  ((res, on_axis_r
+00032680: 6573 2929 0a20 2020 2020 2020 2072 6574  es)).        ret
+00032690: 7572 6e20 6e70 2e75 6e69 7175 6528 7265  urn np.unique(re
+000326a0: 732c 2061 7869 733d 3029 0a0a 2020 2020  s, axis=0)..    
+000326b0: 6465 6620 6765 6e65 7261 7465 5f73 6865  def generate_she
+000326c0: 6c6c 2873 656c 662c 206e 312c 206e 322c  ll(self, n1, n2,
+000326d0: 2073 6861 7065 293a 0a20 2020 2020 2020   shape):.       
+000326e0: 2064 3120 3d20 6e31 0a20 2020 2020 2020   d1 = n1.       
+000326f0: 2064 3220 3d20 6e32 0a20 2020 2020 2020   d2 = n2.       
+00032700: 2023 204f 3120 3d20 5b73 6861 7065 5b30   # O1 = [shape[0
+00032710: 5d2f 2f32 2c20 7368 6170 655b 315d 2f2f  ]//2, shape[1]//
+00032720: 322c 2073 6861 7065 5b32 5d2f 2f32 5d0a  2, shape[2]//2].
+00032730: 2020 2020 2020 2020 2320 6576 656e 206e          # even n
+00032740: 756d 6265 7220 666f 7220 6772 6964 0a20  umber for grid. 
+00032750: 2020 2020 2020 2023 2062 6173 6564 206f         # based o
+00032760: 6e20 6666 740a 2020 2020 2020 2020 6966  n fft.        if
+00032770: 206d 696e 2873 6861 7065 2920 2520 3220   min(shape) % 2 
+00032780: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00032790: 2020 4f31 203d 205b 7368 6170 655b 305d    O1 = [shape[0]
+000327a0: 202f 2032 2c20 7368 6170 655b 315d 202f   / 2, shape[1] /
+000327b0: 2032 2c20 7368 6170 655b 325d 202f 2032   2, shape[2] / 2
+000327c0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+000327d0: 2020 2020 2020 2020 2020 2020 4f31 203d              O1 =
+000327e0: 205b 2873 6861 7065 5b30 5d20 2d20 3129   [(shape[0] - 1)
+000327f0: 202f 2032 2c20 2873 6861 7065 5b31 5d20   / 2, (shape[1] 
+00032800: 2d20 3129 202f 2032 2c20 2873 6861 7065  - 1) / 2, (shape
+00032810: 5b32 5d20 2d20 3129 202f 2032 5d0a 2020  [2] - 1) / 2].  
+00032820: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
+00032830: 5b5d 0a20 2020 2020 2020 2023 206d 616b  [].        # mak
+00032840: 6520 7375 7265 0a20 2020 2020 2020 2078  e sure.        x
+00032850: 5f6d 6178 203d 2069 6e74 2864 3229 202b  _max = int(d2) +
+00032860: 2069 6e74 284f 315b 305d 2920 2b20 3120   int(O1[0]) + 1 
+00032870: 6966 2069 6e74 2864 3229 202b 2069 6e74  if int(d2) + int
+00032880: 284f 315b 305d 2920 3c20 7368 6170 655b  (O1[0]) < shape[
+00032890: 305d 2065 6c73 6520 696e 7428 6432 2920  0] else int(d2) 
+000328a0: 2b20 696e 7428 4f31 5b30 5d29 0a20 2020  + int(O1[0]).   
+000328b0: 2020 2020 2079 5f6d 6178 203d 2069 6e74       y_max = int
+000328c0: 2864 3229 202b 2069 6e74 284f 315b 315d  (d2) + int(O1[1]
+000328d0: 2920 2b20 3120 6966 2069 6e74 2864 3229  ) + 1 if int(d2)
+000328e0: 202b 2069 6e74 284f 315b 315d 2920 3c20   + int(O1[1]) < 
+000328f0: 7368 6170 655b 315d 2065 6c73 6520 696e  shape[1] else in
+00032900: 7428 6432 2920 2b20 696e 7428 4f31 5b31  t(d2) + int(O1[1
+00032910: 5d29 0a20 2020 2020 2020 2066 6f72 2078  ]).        for x
+00032920: 2069 6e20 7261 6e67 6528 726f 756e 6428   in range(round(
+00032930: 4f31 5b30 5d20 2b20 302e 3129 2c20 785f  O1[0] + 0.1), x_
+00032940: 6d61 7829 3a0a 2020 2020 2020 2020 2020  max):.          
+00032950: 2020 666f 7220 7920 696e 2072 616e 6765    for y in range
+00032960: 2872 6f75 6e64 284f 315b 315d 202b 2030  (round(O1[1] + 0
+00032970: 2e31 292c 2079 5f6d 6178 293a 0a20 2020  .1), y_max):.   
+00032980: 2020 2020 2020 2020 2020 2020 2078 795f               xy_
+00032990: 6469 7374 203d 206d 6174 682e 7371 7274  dist = math.sqrt
+000329a0: 2828 7820 2d20 4f31 5b30 5d29 202a 2a20  ((x - O1[0]) ** 
+000329b0: 3220 2b20 2879 202d 204f 315b 315d 2920  2 + (y - O1[1]) 
+000329c0: 2a2a 2032 290a 2020 2020 2020 2020 2020  ** 2).          
+000329d0: 2020 2020 2020 6966 2078 795f 6469 7374        if xy_dist
+000329e0: 203c 3d20 6432 3a0a 2020 2020 2020 2020   <= d2:.        
+000329f0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+00032a00: 795f 6469 7374 203d 3d20 303a 0a20 2020  y_dist == 0:.   
 00032a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032a20: 2020 2020 7a5f 6d69 6e20 3d20 6d61 7468      z_min = math
-00032a30: 2e73 7172 7428 6431 202a 2a20 3220 2d20  .sqrt(d1 ** 2 - 
-00032a40: 7879 5f64 6973 7420 2a2a 2032 2920 2b20  xy_dist ** 2) + 
-00032a50: 4f31 5b32 5d0a 2020 2020 2020 2020 2020  O1[2].          
-00032a60: 2020 2020 2020 2020 2020 2020 2020 7a5f                z_
-00032a70: 6d69 6e20 3d20 696e 7428 7a5f 6d69 6e29  min = int(z_min)
-00032a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032a90: 2020 2020 2020 2020 207a 5f6d 6178 203d           z_max =
-00032aa0: 206d 6174 682e 7371 7274 2864 3220 2a2a   math.sqrt(d2 **
-00032ab0: 2032 202d 2078 795f 6469 7374 202a 2a20   2 - xy_dist ** 
-00032ac0: 3229 202b 204f 315b 325d 0a20 2020 2020  2) + O1[2].     
-00032ad0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00032ae0: 6c69 6620 6431 203c 3d20 7879 5f64 6973  lif d1 <= xy_dis
-00032af0: 7420 3c3d 2064 323a 0a20 2020 2020 2020  t <= d2:.       
-00032b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032b10: 207a 5f6d 696e 203d 204f 315b 325d 0a20   z_min = O1[2]. 
-00032b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032b30: 2020 2020 2020 207a 5f6d 6178 203d 206d         z_max = m
-00032b40: 6174 682e 7371 7274 2864 3220 2a2a 2032  ath.sqrt(d2 ** 2
-00032b50: 202d 2078 795f 6469 7374 202a 2a20 3229   - xy_dist ** 2)
-00032b60: 202b 204f 315b 325d 0a20 2020 2020 2020   + O1[2].       
-00032b70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00032b80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00032b90: 2020 2020 2020 2020 2020 207a 5f6d 696e             z_min
-00032ba0: 203d 204f 315b 325d 0a20 2020 2020 2020   = O1[2].       
-00032bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032bc0: 207a 5f6d 6178 203d 204f 315b 325d 0a20   z_max = O1[2]. 
-00032bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032be0: 2020 2069 6620 696e 7428 7a5f 6d69 6e29     if int(z_min)
-00032bf0: 203c 204f 315b 325d 3a0a 2020 2020 2020   < O1[2]:.      
-00032c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c10: 2020 7a5f 6d69 6e20 3d20 726f 756e 6428    z_min = round(
-00032c20: 4f31 5b32 5d20 2b20 302e 3129 0a20 2020  O1[2] + 0.1).   
-00032c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c40: 207a 5f6d 6178 203d 2069 6e74 287a 5f6d   z_max = int(z_m
-00032c50: 6178 2920 2b20 3120 6966 2069 6e74 287a  ax) + 1 if int(z
-00032c60: 5f6d 6178 2920 3c20 7368 6170 655b 325d  _max) < shape[2]
-00032c70: 2065 6c73 6520 696e 7428 7a5f 6d61 7829   else int(z_max)
-00032c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032c90: 2020 2020 2066 6f72 207a 2069 6e20 7261       for z in ra
-00032ca0: 6e67 6528 696e 7428 7a5f 6d69 6e29 2c20  nge(int(z_min), 
-00032cb0: 7a5f 6d61 7829 3a0a 2020 2020 2020 2020  z_max):.        
-00032cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032cd0: 2320 7072 696e 7428 782c 2079 2c20 7a29  # print(x, y, z)
-00032ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032cf0: 2020 2020 2020 2020 2064 203d 206d 6174           d = mat
-00032d00: 682e 7371 7274 2878 795f 6469 7374 202a  h.sqrt(xy_dist *
-00032d10: 2a20 3220 2b20 2828 7a20 2d20 4f31 5b32  * 2 + ((z - O1[2
-00032d20: 5d29 202a 2a20 3229 290a 2020 2020 2020  ]) ** 2)).      
-00032d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d40: 2020 6966 2064 3120 3c20 6420 3c3d 2064    if d1 < d <= d
-00032d50: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00032d60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00032d70: 6e64 6963 6573 2e61 7070 656e 6428 5b78  ndices.append([x
-00032d80: 2c20 792c 207a 5d29 0a20 2020 2020 2020  , y, z]).       
-00032d90: 2061 6c6c 5f69 6e64 203d 2073 656c 662e   all_ind = self.
-00032da0: 6170 706c 795f 3364 5f73 796d 6d65 7472  apply_3d_symmetr
-00032db0: 7928 696e 6469 6365 732c 204f 3129 2e61  y(indices, O1).a
-00032dc0: 7374 7970 6528 696e 7429 0a20 2020 2020  stype(int).     
-00032dd0: 2020 2072 6574 7572 6e20 616c 6c5f 696e     return all_in
-00032de0: 640a 0a20 2020 2023 2040 7072 6f66 696c  d..    # @profil
-00032df0: 650a 2020 2020 6465 6620 6e65 775f 7261  e.    def new_ra
-00032e00: 7073 2873 656c 662c 206d 6170 696e 3d4e  ps(self, mapin=N
-00032e10: 6f6e 652c 2077 6f72 6b64 6972 3d4e 6f6e  one, workdir=Non
-00032e20: 652c 206c 6162 656c 3d27 2729 3a0a 2020  e, label=''):.  
-00032e30: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00032e40: 2020 2020 2020 2043 616c 6375 6c61 7469         Calculati
-00032e50: 6f6e 206f 6620 7468 6520 726f 7461 7469  on of the rotati
-00032e60: 6f6e 616c 6c79 2061 7665 7261 6765 2070  onally average p
-00032e70: 6f77 6572 2073 7065 6374 7275 6d20 2852  ower spectrum (R
-00032e80: 4150 5329 0a20 2020 2020 2020 2020 2020  APS).           
-00032e90: 2052 6573 756c 7473 2077 726f 7465 2074   Results wrote t
-00032ea0: 6f20 4a53 4f4e 2066 696c 650a 0a20 2020  o JSON file..   
-00032eb0: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
-00032ec0: 6e65 0a0a 2020 2020 2020 2020 2222 220a  ne..        """.
-00032ed0: 0a20 2020 2020 2020 206d 6170 2c20 776f  .        map, wo
-00032ee0: 726b 6469 7220 3d20 7365 6c66 2e6d 6170  rkdir = self.map
-00032ef0: 696e 6368 6563 6b28 6d61 7069 6e2c 2077  incheck(mapin, w
-00032f00: 6f72 6b64 6972 290a 2020 2020 2020 2020  orkdir).        
-00032f10: 6d61 706e 616d 6520 3d20 6f73 2e70 6174  mapname = os.pat
-00032f20: 682e 6261 7365 6e61 6d65 286d 6170 2e66  h.basename(map.f
-00032f30: 756c 6c6e 616d 6529 0a20 2020 2020 2020  ullname).       
-00032f40: 2061 7069 785f 6c69 7374 203d 206d 6170   apix_list = map
-00032f50: 2e76 6f78 656c 5f73 697a 652e 746f 6c69  .voxel_size.toli
-00032f60: 7374 2829 0a20 2020 2020 2020 2061 7069  st().        api
-00032f70: 7873 203d 2028 6170 6978 5f6c 6973 745b  xs = (apix_list[
-00032f80: 305d 2c20 6170 6978 5f6c 6973 745b 315d  0], apix_list[1]
-00032f90: 2c20 6170 6978 5f6c 6973 745b 325d 290a  , apix_list[2]).
-00032fa0: 0a20 2020 2020 2020 2069 6620 6d61 7020  .        if map 
-00032fb0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00032fc0: 776f 726b 6469 7220 6973 206e 6f74 204e  workdir is not N
-00032fd0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00032fe0: 2023 2069 6620 6d61 702e 785f 7369 7a65   # if map.x_size
-00032ff0: 2829 203d 3d20 6d61 702e 795f 7369 7a65  () == map.y_size
-00033000: 2829 203d 3d20 6d61 702e 7a5f 7369 7a65  () == map.z_size
-00033010: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00033020: 6966 206d 6170 2e68 6561 6465 722e 6e78  if map.header.nx
-00033030: 203d 3d20 6d61 702e 6865 6164 6572 2e6e   == map.header.n
-00033040: 7920 3d3d 206d 6170 2e68 6561 6465 722e  y == map.header.
-00033050: 6e7a 3a0a 2020 2020 2020 2020 2020 2020  nz:.            
-00033060: 2020 2020 6572 726c 6973 7420 3d20 5b5d      errlist = []
-00033070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033080: 2073 7461 7274 203d 2074 696d 6569 742e   start = timeit.
-00033090: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
-000330a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000330b0: 6461 7461 6469 6374 203d 2064 6963 7428  datadict = dict(
-000330c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000330d0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000330e0: 2020 2020 2020 2020 2020 2023 206d 6170             # map
-000330f0: 203d 2073 656c 662e 6d61 700a 2020 2020   = self.map.    
-00033100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033110: 2320 7465 6d70 7261 7279 2073 6f6c 7574  # temprary solut
-00033120: 696f 6e20 6173 2074 6865 2074 656d 7079  ion as the tempy
-00033130: 2067 6976 6520 6170 6978 2061 7320 6f6e   give apix as on
-00033140: 6520 7661 6c75 6520 6275 7420 6865 7265  e value but here
-00033150: 2066 726f 6d20 6d72 6366 696c 6520 7765   from mrcfile we
-00033160: 2075 7365 2061 2074 7570 6c65 0a20 2020   use a tuple.   
-00033170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033180: 2023 2069 6620 7479 7065 286d 6170 2e61   # if type(map.a
-00033190: 7069 7829 2069 7320 7475 706c 653a 0a20  pix) is tuple:. 
-000331a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000331b0: 2020 2069 6620 7479 7065 2861 7069 7873     if type(apixs
-000331c0: 2920 6973 2074 7570 6c65 3a0a 2020 2020  ) is tuple:.    
-000331d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000331e0: 2020 2020 6170 6978 203d 2061 7069 7873      apix = apixs
-000331f0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00033200: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00033210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033220: 2020 2020 2020 6170 6978 203d 2061 7069        apix = api
-00033230: 7873 0a20 2020 2020 2020 2020 2020 2020  xs.             
-00033240: 2020 2020 2020 2066 6674 6d61 7020 3d20         fftmap = 
-00033250: 6666 7473 6869 6674 2866 6674 6e28 6d61  fftshift(fftn(ma
-00033260: 702e 6461 7461 2929 0a20 2020 2020 2020  p.data)).       
-00033270: 2020 2020 2020 2020 2020 2020 2070 736d               psm
-00033280: 6561 6e20 3d20 6e70 2e6d 6561 6e28 6666  ean = np.mean(ff
-00033290: 746d 6170 290a 2020 2020 2020 2020 2020  tmap).          
-000332a0: 2020 2020 2020 2020 2020 7073 7374 6420            psstd 
-000332b0: 3d20 6e70 2e73 7464 2866 6674 6d61 7029  = np.std(fftmap)
-000332c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000332d0: 2020 2020 2066 6674 6d61 7020 3d20 6e70       fftmap = np
-000332e0: 2e61 6273 2828 6666 746d 6170 202d 2070  .abs((fftmap - p
-000332f0: 736d 6561 6e29 202f 2070 7373 7464 2920  smean) / psstd) 
-00033300: 2a2a 2032 0a0a 2020 2020 2020 2020 2020  ** 2..          
-00033310: 2020 2020 2020 2020 2020 6d69 6473 7461            midsta
-00033320: 7274 203d 2074 696d 6569 742e 6465 6661  rt = timeit.defa
-00033330: 756c 745f 7469 6d65 7228 2920 2d20 7374  ult_timer() - st
-00033340: 6172 740a 2020 2020 2020 2020 2020 2020  art.            
-00033350: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-00033360: 2d2d 2052 4150 5320 466f 7572 6965 722d  -- RAPS Fourier-
-00033370: 7472 616e 7366 6f72 6d61 7469 6f6e 2074  transformation t
-00033380: 696d 653a 2025 7327 2025 206d 6964 7374  ime: %s' % midst
-00033390: 6172 7429 0a0a 2020 2020 2020 2020 2020  art)..          
-000333a0: 2020 2020 2020 2020 2020 2323 2061 7070            ## app
-000333b0: 6c79 696e 6720 6e65 7720 696e 6469 6365  lying new indice
-000333c0: 7320 6675 6e63 7469 6f6e 0a20 2020 2020  s function.     
-000333d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000333e0: 6170 5f73 6861 7065 203d 2066 6674 6d61  ap_shape = fftma
-000333f0: 702e 7368 6170 650a 2020 2020 2020 2020  p.shape.        
-00033400: 2020 2020 2020 2020 2020 2020 6170 7320              aps 
-00033410: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00033420: 2020 2020 2020 2020 2069 6620 6d61 705f           if map_
-00033430: 7368 6170 655b 305d 2025 2032 203d 3d20  shape[0] % 2 == 
-00033440: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00033450: 2020 2020 2020 2020 2020 206f 7267 203d             org =
-00033460: 205b 6d61 705f 7368 6170 655b 305d 202f   [map_shape[0] /
-00033470: 2032 2c20 6d61 705f 7368 6170 655b 315d   2, map_shape[1]
-00033480: 202f 2032 2c20 6d61 705f 7368 6170 655b   / 2, map_shape[
-00033490: 325d 202f 2032 5d0a 2020 2020 2020 2020  2] / 2].        
-000334a0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000334b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000334c0: 2020 2020 2020 2020 2020 6f72 6720 3d20            org = 
-000334d0: 5b28 6d61 705f 7368 6170 655b 305d 202d  [(map_shape[0] -
-000334e0: 2031 2920 2f20 322c 2028 6d61 705f 7368   1) / 2, (map_sh
-000334f0: 6170 655b 315d 202d 2031 2920 2f20 322c  ape[1] - 1) / 2,
-00033500: 2028 6d61 705f 7368 6170 655b 325d 202d   (map_shape[2] -
-00033510: 2031 2920 2f20 325d 0a20 2020 2020 2020   1) / 2].       
-00033520: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00033530: 6961 7869 7320 3d20 6e70 2e6c 696e 7370  iaxis = np.linsp
-00033540: 6163 6528 302c 2069 6e74 286f 7267 5b30  ace(0, int(org[0
-00033550: 5d29 2c20 696e 7428 6f72 675b 305d 2920  ]), int(org[0]) 
-00033560: 2b20 3129 202f 2028 6d61 705f 7368 6170  + 1) / (map_shap
-00033570: 655b 305d 202a 2061 7069 7829 0a0a 2020  e[0] * apix)..  
-00033580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033590: 2020 7368 656c 6c5f 7261 6e67 6520 3d20    shell_range = 
-000335a0: 696e 7428 6d61 7828 6d61 705f 7368 6170  int(max(map_shap
-000335b0: 6529 202d 206d 6178 286f 7267 2929 0a20  e) - max(org)). 
-000335c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000335d0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000335e0: 6528 302c 2073 6865 6c6c 5f72 616e 6765  e(0, shell_range
-000335f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00033600: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
-00033610: 6573 203d 2073 656c 662e 6765 6e65 7261  es = self.genera
-00033620: 7465 5f73 6865 6c6c 2869 2c20 692b 312c  te_shell(i, i+1,
-00033630: 206d 6170 5f73 6861 7065 290a 2020 2020   map_shape).    
-00033640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033650: 2020 2020 7073 756d 203d 206c 6f67 3130      psum = log10
-00033660: 2866 6674 6d61 705b 7475 706c 6528 696e  (fftmap[tuple(in
-00033670: 6469 6365 732e 5429 5d2e 7375 6d28 2920  dices.T)].sum() 
-00033680: 2f20 6c65 6e28 696e 6469 6365 7329 290a  / len(indices)).
-00033690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000336a0: 2020 2020 2020 2020 6170 732e 6170 7065          aps.appe
-000336b0: 6e64 2870 7375 6d29 0a20 2020 2020 2020  nd(psum).       
-000336c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000336d0: 6170 735b 305d 203c 2030 3a0a 2020 2020  aps[0] < 0:.    
-000336e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000336f0: 2020 2020 6170 735b 305d 203d 2061 7073      aps[0] = aps
-00033700: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00033710: 2020 2020 2020 2020 6966 206d 6170 5f73          if map_s
-00033720: 6861 7065 5b30 5d20 2520 3220 3d3d 2030  hape[0] % 2 == 0
-00033730: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00033740: 2020 2020 2020 2020 2020 6170 732e 696e            aps.in
-00033750: 7365 7274 2830 2c20 6170 735b 305d 290a  sert(0, aps[0]).
-00033760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033770: 2020 2020 2064 6174 6164 6963 7420 3d20       datadict = 
-00033780: 7b6c 6162 656c 202b 2027 726f 7461 7469  {label + 'rotati
-00033790: 6f6e 616c 6c79 5f61 7665 7261 6765 645f  onally_averaged_
-000337a0: 706f 7765 725f 7370 6563 7472 756d 273a  power_spectrum':
-000337b0: 2020 7b27 7927 3a20 6e70 2e72 6f75 6e64    {'y': np.round
-000337c0: 2861 7073 2c20 3130 292e 746f 6c69 7374  (aps, 10).tolist
-000337d0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-000337e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000337f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033810: 2020 2020 2020 2020 2020 2020 2027 7827               'x'
-00033820: 3a20 6e70 2e72 6f75 6e64 2869 6e64 6961  : np.round(india
-00033830: 7869 732c 2031 3029 2e74 6f6c 6973 7428  xis, 10).tolist(
-00033840: 297d 7d0a 2020 2020 2020 2020 2020 2020  )}}.            
-00033850: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
-00033860: 6162 656c 3a0a 2020 2020 2020 2020 2020  abel:.          
-00033870: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-00033880: 742e 706c 6f74 286e 702e 726f 756e 6428  t.plot(np.round(
-00033890: 696e 6469 6178 6973 2c20 3429 2e74 6f6c  indiaxis, 4).tol
-000338a0: 6973 7428 292c 206e 702e 726f 756e 6428  ist(), np.round(
-000338b0: 6170 732c 2034 292e 746f 6c69 7374 2829  aps, 4).tolist()
-000338c0: 2c20 6c61 6265 6c3d 2752 4150 5327 290a  , label='RAPS').
+00032a20: 2020 2020 207a 5f6d 696e 203d 2069 6e74       z_min = int
+00032a30: 284f 315b 325d 202b 2064 3129 0a20 2020  (O1[2] + d1).   
+00032a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032a50: 2020 2020 207a 5f6d 6178 203d 2069 6e74       z_max = int
+00032a60: 284f 315b 325d 202b 2064 3229 0a20 2020  (O1[2] + d2).   
+00032a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032a80: 2065 6c69 6620 7879 5f64 6973 7420 3c20   elif xy_dist < 
+00032a90: 6431 3a0a 2020 2020 2020 2020 2020 2020  d1:.            
+00032aa0: 2020 2020 2020 2020 2020 2020 7a5f 6d69              z_mi
+00032ab0: 6e20 3d20 6d61 7468 2e73 7172 7428 6431  n = math.sqrt(d1
+00032ac0: 202a 2a20 3220 2d20 7879 5f64 6973 7420   ** 2 - xy_dist 
+00032ad0: 2a2a 2032 2920 2b20 4f31 5b32 5d0a 2020  ** 2) + O1[2].  
+00032ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032af0: 2020 2020 2020 7a5f 6d69 6e20 3d20 696e        z_min = in
+00032b00: 7428 7a5f 6d69 6e29 0a20 2020 2020 2020  t(z_min).       
+00032b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032b20: 207a 5f6d 6178 203d 206d 6174 682e 7371   z_max = math.sq
+00032b30: 7274 2864 3220 2a2a 2032 202d 2078 795f  rt(d2 ** 2 - xy_
+00032b40: 6469 7374 202a 2a20 3229 202b 204f 315b  dist ** 2) + O1[
+00032b50: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
+00032b60: 2020 2020 2020 2065 6c69 6620 6431 203c         elif d1 <
+00032b70: 3d20 7879 5f64 6973 7420 3c3d 2064 323a  = xy_dist <= d2:
+00032b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032b90: 2020 2020 2020 2020 207a 5f6d 696e 203d           z_min =
+00032ba0: 204f 315b 325d 0a20 2020 2020 2020 2020   O1[2].         
+00032bb0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+00032bc0: 5f6d 6178 203d 206d 6174 682e 7371 7274  _max = math.sqrt
+00032bd0: 2864 3220 2a2a 2032 202d 2078 795f 6469  (d2 ** 2 - xy_di
+00032be0: 7374 202a 2a20 3229 202b 204f 315b 325d  st ** 2) + O1[2]
+00032bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032c00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00032c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c20: 2020 207a 5f6d 696e 203d 204f 315b 325d     z_min = O1[2]
+00032c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032c40: 2020 2020 2020 2020 207a 5f6d 6178 203d           z_max =
+00032c50: 204f 315b 325d 0a20 2020 2020 2020 2020   O1[2].         
+00032c60: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00032c70: 7428 7a5f 6d69 6e29 203c 204f 315b 325d  t(z_min) < O1[2]
+00032c80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00032c90: 2020 2020 2020 2020 2020 7a5f 6d69 6e20            z_min 
+00032ca0: 3d20 726f 756e 6428 4f31 5b32 5d20 2b20  = round(O1[2] + 
+00032cb0: 302e 3129 0a20 2020 2020 2020 2020 2020  0.1).           
+00032cc0: 2020 2020 2020 2020 207a 5f6d 6178 203d           z_max =
+00032cd0: 2069 6e74 287a 5f6d 6178 2920 2b20 3120   int(z_max) + 1 
+00032ce0: 6966 2069 6e74 287a 5f6d 6178 2920 3c20  if int(z_max) < 
+00032cf0: 7368 6170 655b 325d 2065 6c73 6520 696e  shape[2] else in
+00032d00: 7428 7a5f 6d61 7829 0a20 2020 2020 2020  t(z_max).       
+00032d10: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00032d20: 207a 2069 6e20 7261 6e67 6528 696e 7428   z in range(int(
+00032d30: 7a5f 6d69 6e29 2c20 7a5f 6d61 7829 3a0a  z_min), z_max):.
+00032d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032d50: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00032d60: 782c 2079 2c20 7a29 0a20 2020 2020 2020  x, y, z).       
+00032d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032d80: 2064 203d 206d 6174 682e 7371 7274 2878   d = math.sqrt(x
+00032d90: 795f 6469 7374 202a 2a20 3220 2b20 2828  y_dist ** 2 + ((
+00032da0: 7a20 2d20 4f31 5b32 5d29 202a 2a20 3229  z - O1[2]) ** 2)
+00032db0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00032dc0: 2020 2020 2020 2020 2020 6966 2064 3120            if d1 
+00032dd0: 3c20 6420 3c3d 2064 323a 0a20 2020 2020  < d <= d2:.     
+00032de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032df0: 2020 2020 2020 2069 6e64 6963 6573 2e61         indices.a
+00032e00: 7070 656e 6428 5b78 2c20 792c 207a 5d29  ppend([x, y, z])
+00032e10: 0a20 2020 2020 2020 2061 6c6c 5f69 6e64  .        all_ind
+00032e20: 203d 2073 656c 662e 6170 706c 795f 3364   = self.apply_3d
+00032e30: 5f73 796d 6d65 7472 7928 696e 6469 6365  _symmetry(indice
+00032e40: 732c 204f 3129 2e61 7374 7970 6528 696e  s, O1).astype(in
+00032e50: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
+00032e60: 6e20 616c 6c5f 696e 640a 0a20 2020 2023  n all_ind..    #
+00032e70: 2040 7072 6f66 696c 650a 2020 2020 6465   @profile.    de
+00032e80: 6620 6e65 775f 7261 7073 2873 656c 662c  f new_raps(self,
+00032e90: 206d 6170 696e 3d4e 6f6e 652c 2077 6f72   mapin=None, wor
+00032ea0: 6b64 6972 3d4e 6f6e 652c 206c 6162 656c  kdir=None, label
+00032eb0: 3d27 2729 3a0a 2020 2020 2020 2020 2222  =''):.        ""
+00032ec0: 220a 0a20 2020 2020 2020 2020 2020 2043  "..            C
+00032ed0: 616c 6375 6c61 7469 6f6e 206f 6620 7468  alculation of th
+00032ee0: 6520 726f 7461 7469 6f6e 616c 6c79 2061  e rotationally a
+00032ef0: 7665 7261 6765 2070 6f77 6572 2073 7065  verage power spe
+00032f00: 6374 7275 6d20 2852 4150 5329 0a20 2020  ctrum (RAPS).   
+00032f10: 2020 2020 2020 2020 2052 6573 756c 7473           Results
+00032f20: 2077 726f 7465 2074 6f20 4a53 4f4e 2066   wrote to JSON f
+00032f30: 696c 650a 0a20 2020 2020 2020 203a 7265  ile..        :re
+00032f40: 7475 726e 3a20 4e6f 6e65 0a0a 2020 2020  turn: None..    
+00032f50: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00032f60: 206d 6170 2c20 776f 726b 6469 7220 3d20   map, workdir = 
+00032f70: 7365 6c66 2e6d 6170 696e 6368 6563 6b28  self.mapincheck(
+00032f80: 6d61 7069 6e2c 2077 6f72 6b64 6972 290a  mapin, workdir).
+00032f90: 2020 2020 2020 2020 6d61 706e 616d 6520          mapname 
+00032fa0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+00032fb0: 6d65 286d 6170 2e66 756c 6c6e 616d 6529  me(map.fullname)
+00032fc0: 0a20 2020 2020 2020 2061 7069 785f 6c69  .        apix_li
+00032fd0: 7374 203d 206d 6170 2e76 6f78 656c 5f73  st = map.voxel_s
+00032fe0: 697a 652e 746f 6c69 7374 2829 0a20 2020  ize.tolist().   
+00032ff0: 2020 2020 2061 7069 7873 203d 2028 6170       apixs = (ap
+00033000: 6978 5f6c 6973 745b 305d 2c20 6170 6978  ix_list[0], apix
+00033010: 5f6c 6973 745b 315d 2c20 6170 6978 5f6c  _list[1], apix_l
+00033020: 6973 745b 325d 290a 0a20 2020 2020 2020  ist[2])..       
+00033030: 2069 6620 6d61 7020 6973 206e 6f74 204e   if map is not N
+00033040: 6f6e 6520 616e 6420 776f 726b 6469 7220  one and workdir 
+00033050: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00033060: 2020 2020 2020 2020 2023 2069 6620 6d61           # if ma
+00033070: 702e 785f 7369 7a65 2829 203d 3d20 6d61  p.x_size() == ma
+00033080: 702e 795f 7369 7a65 2829 203d 3d20 6d61  p.y_size() == ma
+00033090: 702e 7a5f 7369 7a65 2829 3a0a 2020 2020  p.z_size():.    
+000330a0: 2020 2020 2020 2020 6966 206d 6170 2e68          if map.h
+000330b0: 6561 6465 722e 6e78 203d 3d20 6d61 702e  eader.nx == map.
+000330c0: 6865 6164 6572 2e6e 7920 3d3d 206d 6170  header.ny == map
+000330d0: 2e68 6561 6465 722e 6e7a 3a0a 2020 2020  .header.nz:.    
+000330e0: 2020 2020 2020 2020 2020 2020 6572 726c              errl
+000330f0: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00033100: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+00033110: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
+00033120: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
+00033130: 2020 2020 2020 2020 6461 7461 6469 6374          datadict
+00033140: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+00033150: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00033160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033170: 2020 2023 206d 6170 203d 2073 656c 662e     # map = self.
+00033180: 6d61 700a 2020 2020 2020 2020 2020 2020  map.            
+00033190: 2020 2020 2020 2020 2320 7465 6d70 7261          # tempra
+000331a0: 7279 2073 6f6c 7574 696f 6e20 6173 2074  ry solution as t
+000331b0: 6865 2074 656d 7079 2067 6976 6520 6170  he tempy give ap
+000331c0: 6978 2061 7320 6f6e 6520 7661 6c75 6520  ix as one value 
+000331d0: 6275 7420 6865 7265 2066 726f 6d20 6d72  but here from mr
+000331e0: 6366 696c 6520 7765 2075 7365 2061 2074  cfile we use a t
+000331f0: 7570 6c65 0a20 2020 2020 2020 2020 2020  uple.           
+00033200: 2020 2020 2020 2020 2023 2069 6620 7479           # if ty
+00033210: 7065 286d 6170 2e61 7069 7829 2069 7320  pe(map.apix) is 
+00033220: 7475 706c 653a 0a20 2020 2020 2020 2020  tuple:.         
+00033230: 2020 2020 2020 2020 2020 2069 6620 7479             if ty
+00033240: 7065 2861 7069 7873 2920 6973 2074 7570  pe(apixs) is tup
+00033250: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00033260: 2020 2020 2020 2020 2020 2020 6170 6978              apix
+00033270: 203d 2061 7069 7873 5b30 5d0a 2020 2020   = apixs[0].    
+00033280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033290: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000332a0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+000332b0: 6978 203d 2061 7069 7873 0a20 2020 2020  ix = apixs.     
+000332c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000332d0: 6674 6d61 7020 3d20 6666 7473 6869 6674  ftmap = fftshift
+000332e0: 2866 6674 6e28 6d61 702e 6461 7461 2929  (fftn(map.data))
+000332f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033300: 2020 2020 2070 736d 6561 6e20 3d20 6e70       psmean = np
+00033310: 2e6d 6561 6e28 6666 746d 6170 290a 2020  .mean(fftmap).  
+00033320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033330: 2020 7073 7374 6420 3d20 6e70 2e73 7464    psstd = np.std
+00033340: 2866 6674 6d61 7029 0a20 2020 2020 2020  (fftmap).       
+00033350: 2020 2020 2020 2020 2020 2020 2066 6674               fft
+00033360: 6d61 7020 3d20 6e70 2e61 6273 2828 6666  map = np.abs((ff
+00033370: 746d 6170 202d 2070 736d 6561 6e29 202f  tmap - psmean) /
+00033380: 2070 7373 7464 2920 2a2a 2032 0a0a 2020   psstd) ** 2..  
+00033390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000333a0: 2020 6d69 6473 7461 7274 203d 2074 696d    midstart = tim
+000333b0: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
+000333c0: 7228 2920 2d20 7374 6172 740a 2020 2020  r() - start.    
+000333d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000333e0: 7072 696e 7428 2720 2d2d 2052 4150 5320  print(' -- RAPS 
+000333f0: 466f 7572 6965 722d 7472 616e 7366 6f72  Fourier-transfor
+00033400: 6d61 7469 6f6e 2074 696d 653a 2025 7327  mation time: %s'
+00033410: 2025 206d 6964 7374 6172 7429 0a0a 2020   % midstart)..  
+00033420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033430: 2020 2323 2061 7070 6c79 696e 6720 6e65    ## applying ne
+00033440: 7720 696e 6469 6365 7320 6675 6e63 7469  w indices functi
+00033450: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00033460: 2020 2020 2020 206d 6170 5f73 6861 7065         map_shape
+00033470: 203d 2066 6674 6d61 702e 7368 6170 650a   = fftmap.shape.
+00033480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033490: 2020 2020 6170 7320 3d20 5b5d 0a20 2020      aps = [].   
+000334a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000334b0: 2069 6620 6d61 705f 7368 6170 655b 305d   if map_shape[0]
+000334c0: 2025 2032 203d 3d20 303a 0a20 2020 2020   % 2 == 0:.     
+000334d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000334e0: 2020 206f 7267 203d 205b 6d61 705f 7368     org = [map_sh
+000334f0: 6170 655b 305d 202f 2032 2c20 6d61 705f  ape[0] / 2, map_
+00033500: 7368 6170 655b 315d 202f 2032 2c20 6d61  shape[1] / 2, ma
+00033510: 705f 7368 6170 655b 325d 202f 2032 5d0a  p_shape[2] / 2].
+00033520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033530: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00033540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033550: 2020 6f72 6720 3d20 5b28 6d61 705f 7368    org = [(map_sh
+00033560: 6170 655b 305d 202d 2031 2920 2f20 322c  ape[0] - 1) / 2,
+00033570: 2028 6d61 705f 7368 6170 655b 315d 202d   (map_shape[1] -
+00033580: 2031 2920 2f20 322c 2028 6d61 705f 7368   1) / 2, (map_sh
+00033590: 6170 655b 325d 202d 2031 2920 2f20 325d  ape[2] - 1) / 2]
+000335a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000335b0: 2020 2020 2069 6e64 6961 7869 7320 3d20       indiaxis = 
+000335c0: 6e70 2e6c 696e 7370 6163 6528 302c 2069  np.linspace(0, i
+000335d0: 6e74 286f 7267 5b30 5d29 2c20 696e 7428  nt(org[0]), int(
+000335e0: 6f72 675b 305d 2920 2b20 3129 202f 2028  org[0]) + 1) / (
+000335f0: 6d61 705f 7368 6170 655b 305d 202a 2061  map_shape[0] * a
+00033600: 7069 7829 0a0a 2020 2020 2020 2020 2020  pix)..          
+00033610: 2020 2020 2020 2020 2020 7368 656c 6c5f            shell_
+00033620: 7261 6e67 6520 3d20 696e 7428 6d61 7828  range = int(max(
+00033630: 6d61 705f 7368 6170 6529 202d 206d 6178  map_shape) - max
+00033640: 286f 7267 2929 0a20 2020 2020 2020 2020  (org)).         
+00033650: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00033660: 2069 6e20 7261 6e67 6528 302c 2073 6865   in range(0, she
+00033670: 6c6c 5f72 616e 6765 293a 0a20 2020 2020  ll_range):.     
+00033680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033690: 2020 2069 6e64 6963 6573 203d 2073 656c     indices = sel
+000336a0: 662e 6765 6e65 7261 7465 5f73 6865 6c6c  f.generate_shell
+000336b0: 2869 2c20 692b 312c 206d 6170 5f73 6861  (i, i+1, map_sha
+000336c0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+000336d0: 2020 2020 2020 2020 2020 2020 7073 756d              psum
+000336e0: 203d 206c 6f67 3130 2866 6674 6d61 705b   = log10(fftmap[
+000336f0: 7475 706c 6528 696e 6469 6365 732e 5429  tuple(indices.T)
+00033700: 5d2e 7375 6d28 2920 2f20 6c65 6e28 696e  ].sum() / len(in
+00033710: 6469 6365 7329 290a 2020 2020 2020 2020  dices)).        
+00033720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033730: 6170 732e 6170 7065 6e64 2870 7375 6d29  aps.append(psum)
+00033740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033750: 2020 2020 2069 6620 6170 735b 305d 203c       if aps[0] <
+00033760: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00033770: 2020 2020 2020 2020 2020 2020 6170 735b              aps[
+00033780: 305d 203d 2061 7073 5b31 5d0a 2020 2020  0] = aps[1].    
+00033790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000337a0: 6966 206d 6170 5f73 6861 7065 5b30 5d20  if map_shape[0] 
+000337b0: 2520 3220 3d3d 2030 3a0a 2020 2020 2020  % 2 == 0:.      
+000337c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000337d0: 2020 6170 732e 696e 7365 7274 2830 2c20    aps.insert(0, 
+000337e0: 6170 735b 305d 290a 0a20 2020 2020 2020  aps[0])..       
+000337f0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00033800: 6164 6963 7420 3d20 7b6c 6162 656c 202b  adict = {label +
+00033810: 2027 726f 7461 7469 6f6e 616c 6c79 5f61   'rotationally_a
+00033820: 7665 7261 6765 645f 706f 7765 725f 7370  veraged_power_sp
+00033830: 6563 7472 756d 273a 2020 7b27 7927 3a20  ectrum':  {'y': 
+00033840: 6e70 2e72 6f75 6e64 2861 7073 2c20 3130  np.round(aps, 10
+00033850: 292e 746f 6c69 7374 2829 2c0a 2020 2020  ).tolist(),.    
+00033860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000338a0: 2020 2020 2027 7827 3a20 6e70 2e72 6f75       'x': np.rou
+000338b0: 6e64 2869 6e64 6961 7869 732c 2031 3029  nd(indiaxis, 10)
+000338c0: 2e74 6f6c 6973 7428 297d 7d0a 2020 2020  .tolist()}}.    
 000338d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000338e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000338e0: 6966 206e 6f74 206c 6162 656c 3a0a 2020  if not label:.  
 000338f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033900: 2020 706c 742e 706c 6f74 286e 702e 726f    plt.plot(np.ro
-00033910: 756e 6428 696e 6469 6178 6973 2c20 3429  und(indiaxis, 4)
-00033920: 2e74 6f6c 6973 7428 292c 206e 702e 726f  .tolist(), np.ro
-00033930: 756e 6428 6170 732c 2034 292e 746f 6c69  und(aps, 4).toli
-00033940: 7374 2829 2c20 6c61 6265 6c3d 2752 6177  st(), label='Raw
-00033950: 206d 6170 2052 4150 5327 290a 2020 2020   map RAPS').    
-00033960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033970: 706c 742e 6c65 6765 6e64 2829 0a20 2020  plt.legend().   
-00033980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033990: 2070 6c74 2e73 6176 6566 6967 2877 6f72   plt.savefig(wor
-000339a0: 6b64 6972 202b 2073 656c 662e 6d61 706e  kdir + self.mapn
-000339b0: 616d 6520 2b20 275f 7261 7073 2e70 6e67  ame + '_raps.png
-000339c0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-000339d0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-000339e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000339f0: 6572 7220 3d20 2752 4150 5320 6361 6c63  err = 'RAPS calc
-00033a00: 756c 6174 696f 6e20 6572 726f 723a 207b  ulation error: {
-00033a10: 7d2e 272e 666f 726d 6174 2873 7973 2e65  }.'.format(sys.e
-00033a20: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-00033a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033a40: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-00033a50: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
-00033a60: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-00033a70: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
-00033a80: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
-00033a90: 2020 2020 2020 2020 6966 2065 7272 6c69          if errli
-00033aa0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00033ab0: 2020 2020 2020 2020 6461 7461 6469 6374          datadict
-00033ac0: 203d 207b 2772 6f74 6174 696f 6e61 6c6c   = {'rotationall
-00033ad0: 795f 6176 6572 6167 6564 5f70 6f77 6572  y_averaged_power
-00033ae0: 5f73 7065 6374 7275 6d27 3a20 7b27 6572  _spectrum': {'er
-00033af0: 7227 3a20 7b27 7261 7073 5f65 7272 273a  r': {'raps_err':
-00033b00: 2065 7272 6c69 7374 7d7d 7d0a 0a20 2020   errlist}}}..   
-00033b10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00033b20: 626f 6f6c 2864 6174 6164 6963 7429 3a0a  bool(datadict):.
+00033900: 2020 2020 2020 706c 742e 706c 6f74 286e        plt.plot(n
+00033910: 702e 726f 756e 6428 696e 6469 6178 6973  p.round(indiaxis
+00033920: 2c20 3429 2e74 6f6c 6973 7428 292c 206e  , 4).tolist(), n
+00033930: 702e 726f 756e 6428 6170 732c 2034 292e  p.round(aps, 4).
+00033940: 746f 6c69 7374 2829 2c20 6c61 6265 6c3d  tolist(), label=
+00033950: 2752 4150 5327 290a 2020 2020 2020 2020  'RAPS').        
+00033960: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00033970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00033980: 2020 2020 2020 2020 2020 706c 742e 706c            plt.pl
+00033990: 6f74 286e 702e 726f 756e 6428 696e 6469  ot(np.round(indi
+000339a0: 6178 6973 2c20 3429 2e74 6f6c 6973 7428  axis, 4).tolist(
+000339b0: 292c 206e 702e 726f 756e 6428 6170 732c  ), np.round(aps,
+000339c0: 2034 292e 746f 6c69 7374 2829 2c20 6c61   4).tolist(), la
+000339d0: 6265 6c3d 2752 6177 206d 6170 2052 4150  bel='Raw map RAP
+000339e0: 5327 290a 2020 2020 2020 2020 2020 2020  S').            
+000339f0: 2020 2020 2020 2020 706c 742e 6c65 6765          plt.lege
+00033a00: 6e64 2829 0a20 2020 2020 2020 2020 2020  nd().           
+00033a10: 2020 2020 2020 2020 2070 6c74 2e73 6176           plt.sav
+00033a20: 6566 6967 2877 6f72 6b64 6972 202b 2073  efig(workdir + s
+00033a30: 656c 662e 6d61 706e 616d 6520 2b20 275f  elf.mapname + '_
+00033a40: 7261 7073 2e70 6e67 2729 0a0a 2020 2020  raps.png')..    
+00033a50: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00033a60: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00033a70: 2020 2020 2020 2020 6572 7220 3d20 2752          err = 'R
+00033a80: 4150 5320 6361 6c63 756c 6174 696f 6e20  APS calculation 
+00033a90: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
+00033aa0: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
+00033ab0: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+00033ac0: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
+00033ad0: 742e 6170 7065 6e64 2865 7272 290a 2020  t.append(err).  
+00033ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033af0: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
+00033b00: 7465 2865 7272 202b 2027 5c6e 2729 0a0a  te(err + '\n')..
+00033b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033b20: 6966 2065 7272 6c69 7374 3a0a 2020 2020  if errlist:.    
 00033b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033b40: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00033b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033b60: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
-00033b70: 6e28 776f 726b 6469 7220 2b20 6d61 706e  n(workdir + mapn
-00033b80: 616d 6520 2b20 275f 7261 7073 2e6a 736f  ame + '_raps.jso
-00033b90: 6e27 2c20 2777 272c 2065 6e63 6f64 696e  n', 'w', encodin
-00033ba0: 673d 2775 7466 2d38 2729 2061 7320 663a  g='utf-8') as f:
-00033bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033bc0: 2020 2020 2020 2020 2020 2020 206a 736f               jso
-00033bd0: 6e2e 6475 6d70 2864 6174 6164 6963 742c  n.dump(datadict,
-00033be0: 2066 290a 2020 2020 2020 2020 2020 2020   f).            
-00033bf0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00033c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033c10: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
-00033c20: 7272 2e77 7269 7465 2827 5361 7669 6e67  rr.write('Saving
-00033c30: 2052 4150 5320 746f 206a 736f 6e20 6572   RAPS to json er
-00033c40: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
-00033c50: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-00033c60: 315d 2929 0a20 2020 2020 2020 2020 2020  1])).           
-00033c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00033c80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00033c90: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00033ca0: 274e 6f20 7261 7073 2064 6174 6120 696e  'No raps data in
-00033cb0: 2074 6865 2064 6963 7469 6f6e 6172 792c   the dictionary,
-00033cc0: 206e 6f20 7261 7073 206a 736f 6e20 6669   no raps json fi
-00033cd0: 6c65 2e5c 6e27 290a 0a20 2020 2020 2020  le.\n')..       
-00033ce0: 2020 2020 2020 2020 2065 6e64 203d 2074           end = t
-00033cf0: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
-00033d00: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
-00033d10: 2020 2020 2020 7072 696e 7428 2752 4150        print('RAP
-00033d20: 5320 7469 6d65 2066 6f72 2025 733a 2025  S time for %s: %
-00033d30: 7327 2025 2028 6d61 706e 616d 652c 2065  s' % (mapname, e
-00033d40: 6e64 202d 2073 7461 7274 2929 0a20 2020  nd - start)).   
-00033d50: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00033d60: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
-00033d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00033d80: 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020 2020  --------').     
-00033d90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00033da0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00033db0: 6e74 2827 4e6f 2052 4150 5320 6361 6c63  nt('No RAPS calc
-00033dc0: 756c 6174 696f 6e20 666f 7220 6e6f 6e2d  ulation for non-
-00033dd0: 6375 6269 6320 6d61 702e 2729 0a20 2020  cubic map.').   
-00033de0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00033df0: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
+00033b40: 6461 7461 6469 6374 203d 207b 2772 6f74  datadict = {'rot
+00033b50: 6174 696f 6e61 6c6c 795f 6176 6572 6167  ationally_averag
+00033b60: 6564 5f70 6f77 6572 5f73 7065 6374 7275  ed_power_spectru
+00033b70: 6d27 3a20 7b27 6572 7227 3a20 7b27 7261  m': {'err': {'ra
+00033b80: 7073 5f65 7272 273a 2065 7272 6c69 7374  ps_err': errlist
+00033b90: 7d7d 7d0a 0a20 2020 2020 2020 2020 2020  }}}..           
+00033ba0: 2020 2020 2069 6620 626f 6f6c 2864 6174       if bool(dat
+00033bb0: 6164 6963 7429 3a0a 2020 2020 2020 2020  adict):.        
+00033bc0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00033bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033be0: 2020 2020 2020 2020 2077 6974 6820 636f           with co
+00033bf0: 6465 6373 2e6f 7065 6e28 776f 726b 6469  decs.open(workdi
+00033c00: 7220 2b20 6d61 706e 616d 6520 2b20 275f  r + mapname + '_
+00033c10: 7261 7073 2e6a 736f 6e27 2c20 2777 272c  raps.json', 'w',
+00033c20: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
+00033c30: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00033c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033c50: 2020 2020 206a 736f 6e2e 6475 6d70 2864       json.dump(d
+00033c60: 6174 6164 6963 742c 2066 290a 2020 2020  atadict, f).    
+00033c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033c80: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00033c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ca0: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00033cb0: 2827 5361 7669 6e67 2052 4150 5320 746f  ('Saving RAPS to
+00033cc0: 206a 736f 6e20 6572 726f 723a 207b 7d2e   json error: {}.
+00033cd0: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
+00033ce0: 5f69 6e66 6f28 295b 315d 2929 0a20 2020  _info()[1])).   
+00033cf0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00033d00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00033d10: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
+00033d20: 722e 7772 6974 6528 274e 6f20 7261 7073  r.write('No raps
+00033d30: 2064 6174 6120 696e 2074 6865 2064 6963   data in the dic
+00033d40: 7469 6f6e 6172 792c 206e 6f20 7261 7073  tionary, no raps
+00033d50: 206a 736f 6e20 6669 6c65 2e5c 6e27 290a   json file.\n').
+00033d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033d70: 2065 6e64 203d 2074 696d 6569 742e 6465   end = timeit.de
+00033d80: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
+00033d90: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00033da0: 696e 7428 2752 4150 5320 7469 6d65 2066  int('RAPS time f
+00033db0: 6f72 2025 733a 2025 7327 2025 2028 6d61  or %s: %s' % (ma
+00033dc0: 706e 616d 652c 2065 6e64 202d 2073 7461  pname, end - sta
+00033dd0: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
+00033de0: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+00033df0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00033e00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00033e10: 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020 2020  --------')..    
-00033e20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00033e30: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-00033e40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00033e50: 2020 7072 696e 7428 274e 6f20 5241 5053    print('No RAPS
-00033e60: 2077 6974 686f 7574 2070 726f 7065 7220   without proper 
-00033e70: 6d61 7020 696e 7075 7420 616e 6420 7468  map input and th
-00033e80: 6520 6f75 7470 7574 2064 6972 6563 746f  e output directo
-00033e90: 7279 2069 6e66 6f72 6d61 7469 6f6e 2e27  ry information.'
-00033ea0: 290a 0a20 2020 2023 2041 626f 7665 2048  )..    # Above H
-00033eb0: 6572 6520 6973 2074 6865 2074 6573 7420  ere is the test 
-00033ec0: 6e65 7720 7261 7073 2066 756e 6374 696f  new raps functio
-00033ed0: 6e20 6172 6561 0a0a 0a20 2020 2023 204e  n area...    # N
-00033ee0: 6577 2063 7572 7665 2069 6e74 6572 7365  ew curve interse
-00033ef0: 6374 696f 6e20 6675 6e63 7469 6f6e 730a  ction functions.
-00033f00: 2020 2020 6465 6620 5f72 6563 745f 696e      def _rect_in
-00033f10: 7465 725f 696e 6e65 7228 7365 6c66 2c20  ter_inner(self, 
-00033f20: 7831 2c20 7832 293a 0a20 2020 2020 2020  x1, x2):.       
-00033f30: 206e 3120 3d20 7831 2e73 6861 7065 5b30   n1 = x1.shape[0
-00033f40: 5d20 2d20 310a 2020 2020 2020 2020 6e32  ] - 1.        n2
-00033f50: 203d 2078 322e 7368 6170 655b 305d 202d   = x2.shape[0] -
-00033f60: 2031 0a20 2020 2020 2020 2058 3120 3d20   1.        X1 = 
-00033f70: 6e70 2e63 5f5b 7831 5b3a 2d31 5d2c 2078  np.c_[x1[:-1], x
-00033f80: 315b 313a 5d5d 0a20 2020 2020 2020 2058  1[1:]].        X
-00033f90: 3220 3d20 6e70 2e63 5f5b 7832 5b3a 2d31  2 = np.c_[x2[:-1
-00033fa0: 5d2c 2078 325b 313a 5d5d 0a20 2020 2020  ], x2[1:]].     
-00033fb0: 2020 2053 3120 3d20 6e70 2e74 696c 6528     S1 = np.tile(
-00033fc0: 5831 2e6d 696e 2861 7869 733d 3129 2c20  X1.min(axis=1), 
-00033fd0: 286e 322c 2031 2929 2e54 0a20 2020 2020  (n2, 1)).T.     
-00033fe0: 2020 2053 3220 3d20 6e70 2e74 696c 6528     S2 = np.tile(
-00033ff0: 5832 2e6d 6178 2861 7869 733d 3129 2c20  X2.max(axis=1), 
-00034000: 286e 312c 2031 2929 0a20 2020 2020 2020  (n1, 1)).       
-00034010: 2053 3320 3d20 6e70 2e74 696c 6528 5831   S3 = np.tile(X1
-00034020: 2e6d 6178 2861 7869 733d 3129 2c20 286e  .max(axis=1), (n
-00034030: 322c 2031 2929 2e54 0a20 2020 2020 2020  2, 1)).T.       
-00034040: 2053 3420 3d20 6e70 2e74 696c 6528 5832   S4 = np.tile(X2
-00034050: 2e6d 696e 2861 7869 733d 3129 2c20 286e  .min(axis=1), (n
-00034060: 312c 2031 2929 0a0a 2020 2020 2020 2020  1, 1))..        
-00034070: 7265 7475 726e 2053 312c 2053 322c 2053  return S1, S2, S
-00034080: 332c 2053 340a 0a20 2020 2064 6566 205f  3, S4..    def _
-00034090: 7265 6374 616e 676c 655f 696e 7465 7273  rectangle_inters
-000340a0: 6563 7469 6f6e 2873 656c 662c 2078 312c  ection(self, x1,
-000340b0: 2079 312c 2078 322c 2079 3229 3a0a 2020   y1, x2, y2):.  
-000340c0: 2020 2020 2020 5331 2c20 5332 2c20 5333        S1, S2, S3
-000340d0: 2c20 5334 203d 2073 656c 662e 5f72 6563  , S4 = self._rec
-000340e0: 745f 696e 7465 725f 696e 6e65 7228 7831  t_inter_inner(x1
-000340f0: 2c20 7832 290a 2020 2020 2020 2020 5335  , x2).        S5
-00034100: 2c20 5336 2c20 5337 2c20 5338 203d 2073  , S6, S7, S8 = s
-00034110: 656c 662e 5f72 6563 745f 696e 7465 725f  elf._rect_inter_
-00034120: 696e 6e65 7228 7931 2c20 7932 290a 0a20  inner(y1, y2).. 
-00034130: 2020 2020 2020 2043 3120 3d20 6e70 2e6c         C1 = np.l
-00034140: 6573 735f 6571 7561 6c28 5331 2c20 5332  ess_equal(S1, S2
-00034150: 290a 2020 2020 2020 2020 4332 203d 206e  ).        C2 = n
-00034160: 702e 6772 6561 7465 725f 6571 7561 6c28  p.greater_equal(
-00034170: 5333 2c20 5334 290a 2020 2020 2020 2020  S3, S4).        
-00034180: 4333 203d 206e 702e 6c65 7373 5f65 7175  C3 = np.less_equ
-00034190: 616c 2853 352c 2053 3629 0a20 2020 2020  al(S5, S6).     
-000341a0: 2020 2043 3420 3d20 6e70 2e67 7265 6174     C4 = np.great
-000341b0: 6572 5f65 7175 616c 2853 372c 2053 3829  er_equal(S7, S8)
-000341c0: 0a0a 2020 2020 2020 2020 6969 2c20 6a6a  ..        ii, jj
-000341d0: 203d 206e 702e 6e6f 6e7a 6572 6f28 4331   = np.nonzero(C1
-000341e0: 2026 2043 3220 2620 4333 2026 2043 3429   & C2 & C3 & C4)
-000341f0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00034200: 2069 692c 206a 6a0a 0a20 2020 2064 6566   ii, jj..    def
-00034210: 2063 7572 7665 735f 696e 7465 7273 6563   curves_intersec
-00034220: 7469 6f6e 2873 656c 662c 2078 312c 2079  tion(self, x1, y
-00034230: 312c 2078 322c 2079 3229 3a0a 2020 2020  1, x2, y2):.    
-00034240: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00034250: 4765 7420 7468 6520 696e 7465 7273 6365  Get the intersce
-00034260: 7469 6f6e 206f 6620 7477 6f20 6375 7276  tion of two curv
-00034270: 6573 0a20 2020 2020 2020 2072 6574 7572  es.        retur
-00034280: 6e3a 206c 6973 7420 6f66 206f 6620 7475  n: list of of tu
-00034290: 706c 6520 636f 6e74 6169 6e73 205b 2878  ple contains [(x
-000342a0: 312c 2079 3129 2c20 2878 322c 2079 3229  1, y1), (x2, y2)
-000342b0: 2c20 2e2e 2e5d 2028 6e6f 2064 7570 6c69  , ...] (no dupli
-000342c0: 6361 7465 6420 706f 696e 7473 290a 2020  cated points).  
-000342d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000342e0: 2020 7831 203d 206e 702e 6173 6172 7261    x1 = np.asarra
-000342f0: 7928 7831 290a 2020 2020 2020 2020 7832  y(x1).        x2
-00034300: 203d 206e 702e 6173 6172 7261 7928 7832   = np.asarray(x2
-00034310: 290a 2020 2020 2020 2020 7931 203d 206e  ).        y1 = n
-00034320: 702e 6173 6172 7261 7928 7931 290a 2020  p.asarray(y1).  
-00034330: 2020 2020 2020 7932 203d 206e 702e 6173        y2 = np.as
-00034340: 6172 7261 7928 7932 290a 0a20 2020 2020  array(y2)..     
-00034350: 2020 2069 692c 206a 6a20 3d20 7365 6c66     ii, jj = self
-00034360: 2e5f 7265 6374 616e 676c 655f 696e 7465  ._rectangle_inte
-00034370: 7273 6563 7469 6f6e 2878 312c 2079 312c  rsection(x1, y1,
-00034380: 2078 322c 2079 3229 0a20 2020 2020 2020   x2, y2).       
-00034390: 2069 6620 3020 696e 2069 693a 0a20 2020   if 0 in ii:.   
-000343a0: 2020 2020 2020 2020 207a 6572 6f5f 696e           zero_in
-000343b0: 6420 3d20 6e70 2e77 6865 7265 2869 6920  d = np.where(ii 
-000343c0: 3d3d 2030 290a 2020 2020 2020 2020 2020  == 0).          
-000343d0: 2020 6969 203d 206e 702e 6465 6c65 7465    ii = np.delete
-000343e0: 2869 692c 207a 6572 6f5f 696e 6429 0a20  (ii, zero_ind). 
-000343f0: 2020 2020 2020 2020 2020 206a 6a20 3d20             jj = 
-00034400: 6e70 2e64 656c 6574 6528 6a6a 2c20 7a65  np.delete(jj, ze
-00034410: 726f 5f69 6e64 290a 2020 2020 2020 2020  ro_ind).        
-00034420: 6966 2031 2069 6e20 6969 3a0a 2020 2020  if 1 in ii:.    
-00034430: 2020 2020 2020 2020 6f6e 655f 696e 6420          one_ind 
-00034440: 3d20 6e70 2e77 6865 7265 2869 6920 3d3d  = np.where(ii ==
-00034450: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-00034460: 6969 203d 206e 702e 6465 6c65 7465 2869  ii = np.delete(i
-00034470: 692c 206f 6e65 5f69 6e64 290a 2020 2020  i, one_ind).    
-00034480: 2020 2020 2020 2020 6a6a 203d 206e 702e          jj = np.
-00034490: 6465 6c65 7465 286a 6a2c 206f 6e65 5f69  delete(jj, one_i
-000344a0: 6e64 290a 2020 2020 2020 2020 6e20 3d20  nd).        n = 
-000344b0: 6c65 6e28 6969 290a 0a20 2020 2020 2020  len(ii)..       
-000344c0: 2064 7879 3120 3d20 6e70 2e64 6966 6628   dxy1 = np.diff(
-000344d0: 6e70 2e63 5f5b 7831 2c20 7931 5d2c 2061  np.c_[x1, y1], a
-000344e0: 7869 733d 3029 0a20 2020 2020 2020 2064  xis=0).        d
-000344f0: 7879 3220 3d20 6e70 2e64 6966 6628 6e70  xy2 = np.diff(np
-00034500: 2e63 5f5b 7832 2c20 7932 5d2c 2061 7869  .c_[x2, y2], axi
-00034510: 733d 3029 0a0a 2020 2020 2020 2020 5420  s=0)..        T 
-00034520: 3d20 6e70 2e7a 6572 6f73 2828 342c 206e  = np.zeros((4, n
-00034530: 2929 0a20 2020 2020 2020 2041 4120 3d20  )).        AA = 
-00034540: 6e70 2e7a 6572 6f73 2828 342c 2034 2c20  np.zeros((4, 4, 
-00034550: 6e29 290a 2020 2020 2020 2020 4141 5b30  n)).        AA[0
-00034560: 3a32 2c20 322c 203a 5d20 3d20 2d31 0a20  :2, 2, :] = -1. 
-00034570: 2020 2020 2020 2041 415b 323a 342c 2033         AA[2:4, 3
-00034580: 2c20 3a5d 203d 202d 310a 2020 2020 2020  , :] = -1.      
-00034590: 2020 4141 5b30 3a3a 322c 2030 2c20 3a5d    AA[0::2, 0, :]
-000345a0: 203d 2064 7879 315b 6969 2c20 3a5d 2e54   = dxy1[ii, :].T
-000345b0: 0a20 2020 2020 2020 2041 415b 313a 3a32  .        AA[1::2
-000345c0: 2c20 312c 203a 5d20 3d20 6478 7932 5b6a  , 1, :] = dxy2[j
-000345d0: 6a2c 203a 5d2e 540a 0a20 2020 2020 2020  j, :].T..       
-000345e0: 2042 4220 3d20 6e70 2e7a 6572 6f73 2828   BB = np.zeros((
-000345f0: 342c 206e 2929 0a20 2020 2020 2020 2042  4, n)).        B
-00034600: 425b 302c 203a 5d20 3d20 2d78 315b 6969  B[0, :] = -x1[ii
-00034610: 5d2e 7261 7665 6c28 290a 2020 2020 2020  ].ravel().      
-00034620: 2020 4242 5b31 2c20 3a5d 203d 202d 7832    BB[1, :] = -x2
-00034630: 5b6a 6a5d 2e72 6176 656c 2829 0a20 2020  [jj].ravel().   
-00034640: 2020 2020 2042 425b 322c 203a 5d20 3d20       BB[2, :] = 
-00034650: 2d79 315b 6969 5d2e 7261 7665 6c28 290a  -y1[ii].ravel().
-00034660: 2020 2020 2020 2020 4242 5b33 2c20 3a5d          BB[3, :]
-00034670: 203d 202d 7932 5b6a 6a5d 2e72 6176 656c   = -y2[jj].ravel
-00034680: 2829 0a0a 2020 2020 2020 2020 666f 7220  ()..        for 
-00034690: 6920 696e 2072 616e 6765 286e 293a 0a20  i in range(n):. 
-000346a0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000346b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000346c0: 545b 3a2c 2069 5d20 3d20 6e70 2e6c 696e  T[:, i] = np.lin
-000346d0: 616c 672e 736f 6c76 6528 4141 5b3a 2c20  alg.solve(AA[:, 
-000346e0: 3a2c 2069 5d2c 2042 425b 3a2c 2069 5d29  :, i], BB[:, i])
-000346f0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00034700: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00034710: 2020 2020 2054 5b3a 2c20 695d 203d 206e       T[:, i] = n
-00034720: 702e 496e 660a 0a20 2020 2020 2020 2069  p.Inf..        i
-00034730: 6e5f 7261 6e67 6520 3d20 2854 5b30 2c20  n_range = (T[0, 
-00034740: 3a5d 203e 3d20 3029 2026 2028 545b 312c  :] >= 0) & (T[1,
-00034750: 203a 5d20 3e3d 2030 2920 2620 280a 2020   :] >= 0) & (.  
-00034760: 2020 2020 2020 2020 2020 2020 2020 545b                T[
-00034770: 302c 203a 5d20 3c3d 2031 2920 2620 2854  0, :] <= 1) & (T
-00034780: 5b31 2c20 3a5d 203c 3d20 3129 0a0a 2020  [1, :] <= 1)..  
-00034790: 2020 2020 2020 7879 3020 3d20 545b 323a        xy0 = T[2:
-000347a0: 2c20 696e 5f72 616e 6765 5d0a 2020 2020  , in_range].    
-000347b0: 2020 2020 7879 3020 3d20 7879 302e 540a      xy0 = xy0.T.
-000347c0: 2020 2020 2020 2020 6e65 776c 6973 7420          newlist 
-000347d0: 3d20 5b5d 0a20 2020 2020 2020 2070 7269  = [].        pri
-000347e0: 6e74 2878 7930 290a 2020 2020 2020 2020  nt(xy0).        
-000347f0: 666f 7220 6920 696e 2078 7930 3a0a 2020  for i in xy0:.  
-00034800: 2020 2020 2020 2020 2020 6120 3d20 7475            a = tu
-00034810: 706c 6528 6929 0a20 2020 2020 2020 2020  ple(i).         
-00034820: 2020 206e 6577 6c69 7374 2e61 7070 656e     newlist.appen
-00034830: 6428 6129 0a20 2020 2020 2020 2072 6573  d(a).        res
-00034840: 203d 206c 6973 7428 7365 7428 6e65 776c   = list(set(newl
-00034850: 6973 7429 290a 2020 2020 2020 2020 7265  ist)).        re
-00034860: 732e 736f 7274 286b 6579 3d6e 6577 6c69  s.sort(key=newli
-00034870: 7374 2e69 6e64 6578 290a 2020 2020 2020  st.index).      
-00034880: 2020 6e6c 6973 7420 3d20 5b5d 0a20 2020    nlist = [].   
-00034890: 2020 2020 2066 6f72 2062 2069 6e20 7265       for b in re
-000348a0: 733a 0a20 2020 2020 2020 2020 2020 206e  s:.            n
-000348b0: 6c69 7374 2e61 7070 656e 6428 6c69 7374  list.append(list
-000348c0: 2862 2929 0a20 2020 2020 2020 206c 7265  (b)).        lre
-000348d0: 7320 3d20 6e70 2e61 7272 6179 286e 6c69  s = np.array(nli
-000348e0: 7374 290a 2020 2020 2020 2020 7072 696e  st).        prin
-000348f0: 7428 6e70 2e61 7272 6179 286e 6c69 7374  t(np.array(nlist
-00034900: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-00034910: 286e 702e 6172 7261 7928 6e6c 6973 7429  (np.array(nlist)
-00034920: 5b3a 2c20 305d 290a 2020 2020 2020 2020  [:, 0]).        
-00034930: 7072 696e 7428 6e70 2e61 7272 6179 286e  print(np.array(n
-00034940: 6c69 7374 295b 3a2c 2031 5d29 0a20 2020  list)[:, 1]).   
-00034950: 2020 2020 2072 6574 7572 6e20 6c72 6573       return lres
-00034960: 5b3a 2c20 305d 2c20 6c72 6573 5b3a 2c20  [:, 0], lres[:, 
-00034970: 315d 0a0a 2020 2020 2320 456e 6420 6f66  1]..    # End of
-00034980: 206e 6577 2063 7572 7665 2069 6e74 6572   new curve inter
-00034990: 7365 6374 696f 6e20 6675 6e63 7469 6f6e  section function
-000349a0: 730a 0a20 2020 2064 6566 205f 5f69 6e74  s..    def __int
-000349b0: 6572 706f 6c61 7465 645f 696e 7465 7263  erpolated_interc
-000349c0: 6570 7428 7365 6c66 2c20 782c 2079 312c  ept(self, x, y1,
-000349d0: 2079 3229 3a0a 2020 2020 2020 2020 2222   y2):.        ""
-000349e0: 220a 0a20 2020 2020 2020 2020 2020 2046  "..            F
-000349f0: 696e 6420 7468 6520 696e 7465 7263 6570  ind the intercep
-00034a00: 7420 6f66 2074 776f 2063 7572 7665 732c  t of two curves,
-00034a10: 2067 6976 656e 2062 7920 7468 6520 7361   given by the sa
-00034a20: 6d65 2078 2064 6174 610a 0a20 2020 2020  me x data..     
-00034a30: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00034a40: 6465 6620 696e 7465 7263 6570 7428 706f  def intercept(po
-00034a50: 696e 7431 2c20 706f 696e 7432 2c20 706f  int1, point2, po
-00034a60: 696e 7433 2c20 706f 696e 7434 293a 0a20  int3, point4):. 
-00034a70: 2020 2020 2020 2020 2020 2022 2222 0a0a             """..
-00034a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034a90: 4669 6e64 2074 6865 2069 6e74 6572 7365  Find the interse
-00034aa0: 6374 696f 6e20 6265 7477 6565 6e20 7477  ction between tw
-00034ab0: 6f20 6c69 6e65 730a 2020 2020 2020 2020  o lines.        
-00034ac0: 2020 2020 2020 2020 7468 6520 6669 7273          the firs
-00034ad0: 7420 6c69 6e65 2069 7320 6465 6669 6e65  t line is define
-00034ae0: 6420 6279 2074 6865 206c 696e 6520 6265  d by the line be
-00034af0: 7477 6565 6e20 706f 696e 7431 2061 6e64  tween point1 and
-00034b00: 2070 6f69 6e74 320a 2020 2020 2020 2020   point2.        
-00034b10: 2020 2020 2020 2020 7468 6520 7365 636f          the seco
-00034b20: 6e64 206c 696e 6520 6973 2064 6566 696e  nd line is defin
-00034b30: 6564 2062 7920 7468 6520 6c69 6e65 2062  ed by the line b
-00034b40: 6574 7765 656e 2070 6f69 6e74 3320 616e  etween point3 an
-00034b50: 6420 706f 696e 7434 0a20 2020 2020 2020  d point4.       
-00034b60: 2020 2020 2020 2020 2065 6163 6820 706f           each po
-00034b70: 696e 7420 6973 2061 6e20 2878 2c79 2920  int is an (x,y) 
-00034b80: 7475 706c 652e 0a0a 2020 2020 2020 2020  tuple...        
-00034b90: 2020 2020 2020 2020 536f 2c20 666f 7220          So, for 
-00034ba0: 6578 616d 706c 652c 2079 6f75 2063 616e  example, you can
-00034bb0: 2066 696e 6420 7468 6520 696e 7465 7273   find the inters
-00034bc0: 6563 7469 6f6e 2062 6574 7765 656e 0a20  ection between. 
-00034bd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00034be0: 6e74 6572 6365 7074 2828 302c 3029 2c20  ntercept((0,0), 
-00034bf0: 2831 2c31 292c 2028 302c 3129 2c20 2831  (1,1), (0,1), (1
-00034c00: 2c30 2929 203d 2028 302e 352c 2030 2e35  ,0)) = (0.5, 0.5
-00034c10: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00034c20: 2020 203a 7265 7475 726e 3a20 496e 7465     :return: Inte
-00034c30: 7263 6570 742c 2069 6e20 2878 2c79 2920  rcept, in (x,y) 
-00034c40: 666f 726d 6174 0a0a 2020 2020 2020 2020  format..        
-00034c50: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00034c60: 2020 2020 2064 6566 206c 696e 6528 7031       def line(p1
-00034c70: 2c20 7032 293a 0a20 2020 2020 2020 2020  , p2):.         
-00034c80: 2020 2020 2020 2041 203d 2028 7031 5b31         A = (p1[1
-00034c90: 5d20 2d20 7032 5b31 5d29 0a20 2020 2020  ] - p2[1]).     
-00034ca0: 2020 2020 2020 2020 2020 2042 203d 2028             B = (
-00034cb0: 7032 5b30 5d20 2d20 7031 5b30 5d29 0a20  p2[0] - p1[0]). 
-00034cc0: 2020 2020 2020 2020 2020 2020 2020 2043                 C
-00034cd0: 203d 2028 7031 5b30 5d20 2a20 7032 5b31   = (p1[0] * p2[1
-00034ce0: 5d20 2d20 7032 5b30 5d20 2a20 7031 5b31  ] - p2[0] * p1[1
-00034cf0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
-00034d00: 2020 2020 7265 7475 726e 2041 2c20 422c      return A, B,
-00034d10: 202d 430a 0a20 2020 2020 2020 2020 2020   -C..           
-00034d20: 2064 6566 2069 6e74 6572 7365 6374 696f   def intersectio
-00034d30: 6e28 4c31 2c20 4c32 293a 0a20 2020 2020  n(L1, L2):.     
-00034d40: 2020 2020 2020 2020 2020 2044 203d 204c             D = L
-00034d50: 315b 305d 202a 204c 325b 315d 202d 204c  1[0] * L2[1] - L
-00034d60: 315b 315d 202a 204c 325b 305d 0a20 2020  1[1] * L2[0].   
-00034d70: 2020 2020 2020 2020 2020 2020 2044 7820               Dx 
-00034d80: 3d20 4c31 5b32 5d20 2a20 4c32 5b31 5d20  = L1[2] * L2[1] 
-00034d90: 2d20 4c31 5b31 5d20 2a20 4c32 5b32 5d0a  - L1[1] * L2[2].
-00034da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034db0: 4479 203d 204c 315b 305d 202a 204c 325b  Dy = L1[0] * L2[
-00034dc0: 325d 202d 204c 315b 325d 202a 204c 325b  2] - L1[2] * L2[
-00034dd0: 305d 0a0a 2020 2020 2020 2020 2020 2020  0]..            
-00034de0: 2020 2020 7820 3d20 4478 202f 2044 0a20      x = Dx / D. 
-00034df0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00034e00: 203d 2044 7920 2f20 440a 0a20 2020 2020   = Dy / D..     
-00034e10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00034e20: 6e20 782c 2079 0a0a 2020 2020 2020 2020  n x, y..        
-00034e30: 2020 2020 4c31 203d 206c 696e 6528 5b70      L1 = line([p
-00034e40: 6f69 6e74 315b 305d 2c20 706f 696e 7431  oint1[0], point1
-00034e50: 5b31 5d5d 2c20 5b70 6f69 6e74 325b 305d  [1]], [point2[0]
-00034e60: 2c20 706f 696e 7432 5b31 5d5d 290a 2020  , point2[1]]).  
-00034e70: 2020 2020 2020 2020 2020 4c32 203d 206c            L2 = l
-00034e80: 696e 6528 5b70 6f69 6e74 335b 305d 2c20  ine([point3[0], 
-00034e90: 706f 696e 7433 5b31 5d5d 2c20 5b70 6f69  point3[1]], [poi
-00034ea0: 6e74 345b 305d 2c20 706f 696e 7434 5b31  nt4[0], point4[1
-00034eb0: 5d5d 290a 0a20 2020 2020 2020 2020 2020  ]])..           
-00034ec0: 2052 203d 2069 6e74 6572 7365 6374 696f   R = intersectio
-00034ed0: 6e28 4c31 2c20 4c32 290a 0a20 2020 2020  n(L1, L2)..     
-00034ee0: 2020 2020 2020 2072 6574 7572 6e20 520a         return R.
-00034ef0: 0a20 2020 2020 2020 2069 6478 203d 206e  .        idx = n
-00034f00: 702e 6172 6777 6865 7265 286e 702e 6469  p.argwhere(np.di
-00034f10: 6666 286e 702e 7369 676e 2879 3120 2d20  ff(np.sign(y1 - 
-00034f20: 7932 2929 2021 3d20 3029 0a20 2020 2020  y2)) != 0).     
-00034f30: 2020 2023 2052 656d 6f76 6520 7468 6520     # Remove the 
-00034f40: 6669 7273 7420 706f 696e 7420 7573 7561  first point usua
-00034f50: 6c6c 7920 2830 2c20 3129 2074 6f20 6176  lly (0, 1) to av
-00034f60: 6f69 6420 616c 6c20 6375 7276 6573 2073  oid all curves s
-00034f70: 7461 7274 696e 6720 6672 6f6d 2028 302c  tarting from (0,
-00034f80: 2031 2920 7768 6963 6820 7069 636b 2061   1) which pick a
-00034f90: 7320 6f6e 6520 696e 7465 7273 6563 7469  s one intersecti
-00034fa0: 6f6e 0a20 2020 2020 2020 2069 6620 6964  on.        if id
-00034fb0: 782e 7369 7a65 2021 3d20 303a 0a20 2020  x.size != 0:.   
-00034fc0: 2020 2020 2020 2020 2069 6620 6964 785b           if idx[
-00034fd0: 305d 5b30 5d20 3d3d 2030 3a0a 2020 2020  0][0] == 0:.    
-00034fe0: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
-00034ff0: 3d20 6e70 2e64 656c 6574 6528 6964 782c  = np.delete(idx,
-00035000: 2030 2c20 3029 0a20 2020 2020 2020 2020   0, 0).         
-00035010: 2020 2078 632c 2079 6320 3d20 696e 7465     xc, yc = inte
-00035020: 7263 6570 7428 2878 5b69 6478 5d2c 2079  rcept((x[idx], y
-00035030: 315b 6964 785d 292c 2028 2878 5b69 6478  1[idx]), ((x[idx
-00035040: 202b 2031 5d2c 2079 315b 6964 7820 2b20   + 1], y1[idx + 
-00035050: 315d 2929 2c20 2828 785b 6964 785d 2c20  1])), ((x[idx], 
-00035060: 7932 5b69 6478 5d29 292c 0a20 2020 2020  y2[idx])),.     
-00035070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035080: 2020 2020 2020 2020 2020 2828 785b 6964            ((x[id
-00035090: 7820 2b20 315d 2c20 7932 5b69 6478 202b  x + 1], y2[idx +
-000350a0: 2031 5d29 2929 0a20 2020 2020 2020 2020   1]))).         
-000350b0: 2020 2072 6574 7572 6e20 7863 2c20 7963     return xc, yc
-000350c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000350d0: 2020 2020 2020 2020 2020 206e 756c 6c61             nulla
-000350e0: 7272 203d 206e 702e 656d 7074 7928 7368  rr = np.empty(sh
-000350f0: 6170 653d 2830 2c20 3029 290a 2020 2020  ape=(0, 0)).    
-00035100: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00035110: 756c 6c61 7272 2c20 6e75 6c6c 6172 720a  ullarr, nullarr.
-00035120: 0a0a 2020 2020 6465 6620 6d6d 6673 6328  ..    def mmfsc(
-00035130: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00035140: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-00035150: 4361 6c63 756c 6174 6520 4d6f 6465 6c2d  Calculate Model-
-00035160: 6d61 7020 4653 4320 6261 7365 6420 6f6e  map FSC based on
-00035170: 2073 696d 756c 6174 6564 2064 656e 7369   simulated densi
-00035180: 7479 206d 6170 2066 726f 6d20 6d6f 6465  ty map from mode
-00035190: 6c0a 0a20 2020 2020 2020 203a 7265 7475  l..        :retu
-000351a0: 726e 3a0a 2020 2020 2020 2020 2222 220a  rn:.        """.
-000351b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000351c0: 2e70 6c61 7466 6f72 6d20 3d3d 2027 656d  .platform == 'em
-000351d0: 6462 273a 0a20 2020 2020 2020 2020 2020  db':.           
-000351e0: 2073 7461 7274 203d 2074 696d 6569 742e   start = timeit.
-000351f0: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
-00035200: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00035210: 6c73 6d61 7073 203d 2073 656c 662e 6d6f  lsmaps = self.mo
-00035220: 6465 6c73 6d61 7073 0a20 2020 2020 2020  delsmaps.       
-00035230: 2020 2020 2023 2320 546f 646f 3a20 436f       ## Todo: Co
-00035240: 6e73 6964 6572 2070 7574 7469 6e67 2074  nsider putting t
-00035250: 6869 7320 6572 7220 696e 666f 726d 6174  his err informat
-00035260: 696f 6e20 696e 746f 2074 6865 2066 696e  ion into the fin
-00035270: 616c 2066 7363 206a 736f 6e20 6669 6c65  al fsc json file
-00035280: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00035290: 656c 6d61 7073 6469 6374 203d 207b 7d0a  elmapsdict = {}.
-000352a0: 2020 2020 2020 2020 2020 2020 6f6c 6466              oldf
-000352b0: 696c 6573 203d 205b 5d0a 2020 2020 2020  iles = [].      
-000352c0: 2020 2020 2020 6966 2073 656c 662e 6d65        if self.me
-000352d0: 7420 213d 2027 746f 6d6f 2720 616e 6420  t != 'tomo' and 
-000352e0: 7365 6c66 2e6d 6574 2021 3d20 2763 7279  self.met != 'cry
-000352f0: 7327 2061 6e64 2028 6d6f 6465 6c73 6d61  s' and (modelsma
-00035300: 7073 2069 7320 6e6f 7420 4e6f 6e65 293a  ps is not None):
-00035310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035320: 2066 6f72 206d 6f64 656c 6d61 7020 696e   for modelmap in
-00035330: 206d 6f64 656c 736d 6170 733a 0a20 2020   modelsmaps:.   
-00035340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035350: 2023 2072 6561 6420 6d6f 6465 6c20 6d61   # read model ma
-00035360: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00035370: 2020 2020 2020 6d6f 6465 6c6e 616d 6520        modelname 
-00035380: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00035390: 6d65 286d 6f64 656c 6d61 7029 2e73 706c  me(modelmap).spl
-000353a0: 6974 2827 5f27 295b 305d 0a20 2020 2020  it('_')[0].     
-000353b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000353c0: 206f 626a 6d6f 6465 6c6d 6170 203d 2073   objmodelmap = s
-000353d0: 656c 662e 6672 6f6d 6d72 635f 746f 7465  elf.frommrc_tote
-000353e0: 6d70 7928 6d6f 6465 6c6d 6170 290a 2020  mpy(modelmap).  
-000353f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035400: 2020 6f62 6a6d 6f64 656c 6d61 7020 3d20    objmodelmap = 
-00035410: 6d72 6366 696c 652e 6d6d 6170 286d 6f64  mrcfile.mmap(mod
-00035420: 656c 6d61 702c 206d 6f64 653d 2772 2729  elmap, mode='r')
-00035430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035440: 2020 2020 2023 2073 656c 662e 6673 6328       # self.fsc(
-00035450: 7365 6c66 2e6d 6170 2c20 6f62 6a6d 6f64  self.map, objmod
-00035460: 656c 6d61 702c 206c 6162 656c 3d27 7b7d  elmap, label='{}
-00035470: 5f6d 6d27 2e66 6f72 6d61 7428 6d6f 6465  _mm'.format(mode
-00035480: 6c6e 616d 6529 290a 2020 2020 2020 2020  lname)).        
-00035490: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000354a0: 2e6e 6577 5f66 7363 2873 656c 662e 6d61  .new_fsc(self.ma
-000354b0: 702c 206f 626a 6d6f 6465 6c6d 6170 2c20  p, objmodelmap, 
-000354c0: 6c61 6265 6c3d 277b 7d5f 6d6d 272e 666f  label='{}_mm'.fo
-000354d0: 726d 6174 286d 6f64 656c 6e61 6d65 2929  rmat(modelname))
-000354e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000354f0: 2020 2020 206f 6c64 6e61 6d65 203d 2027       oldname = '
-00035500: 7b7d 7b7d 5f7b 7d5f 6d6d 6673 632e 6a73  {}{}_{}_mmfsc.js
-00035510: 6f6e 272e 666f 726d 6174 2873 656c 662e  on'.format(self.
-00035520: 776f 726b 6469 722c 2073 656c 662e 6d61  workdir, self.ma
-00035530: 706e 616d 652c 206d 6f64 656c 6e61 6d65  pname, modelname
-00035540: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00035550: 2020 2020 2020 6e65 776e 616d 6520 3d20        newname = 
-00035560: 277b 7d7b 7d27 2e66 6f72 6d61 7428 7365  '{}{}'.format(se
-00035570: 6c66 2e77 6f72 6b64 6972 2c20 7365 6c66  lf.workdir, self
-00035580: 2e6d 6170 6e61 6d65 202b 2027 5f27 202b  .mapname + '_' +
-00035590: 206d 6f64 656c 6e61 6d65 202b 2027 5f6d   modelname + '_m
-000355a0: 6d66 7363 2e6a 736f 6e27 290a 2020 2020  mfsc.json').    
-000355b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000355c0: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
-000355d0: 6528 6f6c 646e 616d 6529 3a0a 2020 2020  e(oldname):.    
-000355e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000355f0: 2020 2020 6f6c 6466 696c 6573 2e61 7070      oldfiles.app
-00035600: 656e 6428 6f6c 646e 616d 6529 0a20 2020  end(oldname).   
-00035610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035620: 2020 2020 206f 732e 7265 6e61 6d65 286f       os.rename(o
-00035630: 6c64 6e61 6d65 2c20 6e65 776e 616d 6529  ldname, newname)
-00035640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00035650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00035660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035670: 2020 2070 7269 6e74 2827 7b7d 2064 6f65     print('{} doe
-00035680: 7320 6e6f 7420 6578 6973 742c 2070 6c65  s not exist, ple
-00035690: 6173 6520 6368 6563 6b2e 272e 666f 726d  ase check.'.form
-000356a0: 6174 286f 6c64 6e61 6d65 2929 0a20 2020  at(oldname)).   
-000356b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000356c0: 206d 6f64 656c 6d61 7073 6469 6374 5b6d   modelmapsdict[m
-000356d0: 6f64 656c 6e61 6d65 5d20 3d20 6e65 776e  odelname] = newn
-000356e0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-000356f0: 2020 2020 7365 6c66 2e6d 6572 6765 6d6d      self.mergemm
-00035700: 6673 6328 6d6f 6465 6c6d 6170 7364 6963  fsc(modelmapsdic
-00035710: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00035720: 2020 2073 656c 662e 6465 6c6f 6c64 6d6d     self.deloldmm
-00035730: 6673 6328 6f6c 6466 696c 6573 290a 2020  fsc(oldfiles).  
-00035740: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00035750: 6420 3d20 7469 6d65 6974 2e64 6566 6175  d = timeit.defau
-00035760: 6c74 5f74 696d 6572 2829 0a0a 2020 2020  lt_timer()..    
-00035770: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00035780: 7428 276d 6d66 7363 2074 696d 653a 2025  t('mmfsc time: %
-00035790: 7327 2025 2028 656e 6420 2d20 7374 6172  s' % (end - star
-000357a0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-000357b0: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
-000357c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000357d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
-000357e0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000357f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00035800: 2020 2020 2070 7269 6e74 2827 4d6f 6465       print('Mode
-00035810: 6c2d 6d61 7020 4653 4320 6f6e 6c79 2063  l-map FSC only c
-00035820: 616c 6375 6c61 7465 6420 666f 7220 7369  alculated for si
-00035830: 6e67 6c65 2070 6172 7469 636c 6520 6461  ngle particle da
-00035840: 7461 2077 6865 7265 2074 6865 7265 2069  ta where there i
-00035850: 7320 6120 6669 7474 6564 206d 6f64 656c  s a fitted model
-00035860: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
-00035870: 2020 2020 2020 2020 2027 2850 6c65 6173           '(Pleas
-00035880: 6520 7573 6520 2d6d 2073 7020 616e 6420  e use -m sp and 
-00035890: 2d66 2920 6f72 206e 6f20 6d6f 6465 6c20  -f) or no model 
-000358a0: 6d61 7020 6973 2063 616c 6375 6c61 7465  map is calculate
-000358b0: 6420 7573 202d 6920 742f 6620 746f 2073  d us -i t/f to s
-000358c0: 7769 7463 6820 6966 206f 6e20 6f72 206f  witch if on or o
-000358d0: 6666 2e27 290a 0a20 2020 2020 2020 2072  ff.')..        r
-000358e0: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-000358f0: 6465 6620 6465 6c6f 6c64 6d6d 6673 6328  def deloldmmfsc(
-00035900: 7365 6c66 2c20 6f6c 6466 696c 6573 293a  self, oldfiles):
-00035910: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00035920: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
-00035930: 2073 6570 6172 6174 6520 6d6d 6673 6320   separate mmfsc 
-00035940: 6669 6c65 7320 746f 2061 766f 6964 206d  files to avoid m
-00035950: 6572 6765 6420 696e 746f 2074 6865 2066  erged into the f
-00035960: 696e 616c 206a 736f 6e0a 0a20 2020 2020  inal json..     
-00035970: 2020 203a 7061 7261 6d20 6f6c 6466 696c     :param oldfil
-00035980: 6573 3a0a 2020 2020 2020 2020 3a72 6574  es:.        :ret
-00035990: 7572 6e3a 204e 6f6e 650a 2020 2020 2020  urn: None.      
-000359a0: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
-000359b0: 6620 6f6c 6466 696c 6573 3a0a 2020 2020  f oldfiles:.    
-000359c0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-000359d0: 2069 6e20 6f6c 6466 696c 6573 3a0a 2020   in oldfiles:.  
-000359e0: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-000359f0: 2e72 656d 6f76 6528 6669 6c65 290a 2020  .remove(file).  
-00035a00: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00035a10: 2753 6570 6172 6174 6520 6d6d 6673 6320  'Separate mmfsc 
-00035a20: 6669 6c65 7320 7765 7265 2064 656c 6574  files were delet
-00035a30: 6564 2e27 290a 2020 2020 2020 2020 656c  ed.').        el
-00035a40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00035a50: 7072 696e 7428 274e 6f20 6d6d 6673 6320  print('No mmfsc 
-00035a60: 6578 6973 742c 206e 6f20 6d6d 6673 6320  exist, no mmfsc 
-00035a70: 6669 6c65 2063 616e 2062 6520 6465 6c65  file can be dele
-00035a80: 7465 6427 290a 0a0a 2020 2020 6465 6620  ted')...    def 
-00035a90: 6d65 7267 656d 6d66 7363 2873 656c 662c  mergemmfsc(self,
-00035aa0: 206d 6d66 7363 6469 6374 293a 0a20 2020   mmfscdict):.   
-00035ab0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00035ac0: 2020 2020 2020 4d65 7267 6520 616c 6c20        Merge all 
-00035ad0: 2a5f 6d6d 6673 632e 6a73 6f6e 2066 696c  *_mmfsc.json fil
-00035ae0: 6573 206f 6620 6469 6666 6572 656e 7420  es of different 
-00035af0: 6d6f 6465 6c73 0a0a 2020 2020 2020 2020  models..        
-00035b00: 3a72 6574 7572 6e3a 0a20 2020 2020 2020  :return:.       
-00035b10: 2022 2222 0a0a 2020 2020 2020 2020 6e66   """..        nf
-00035b20: 696c 6573 203d 206c 656e 286c 6973 7428  iles = len(list(
-00035b30: 6d6d 6673 6364 6963 7429 290a 2020 2020  mmfscdict)).    
-00035b40: 2020 2020 6675 6c6c 6461 7461 203d 207b      fulldata = {
-00035b50: 7d0a 2020 2020 2020 2020 666f 7220 692c  }.        for i,
-00035b60: 206d 6f64 656c 6e61 6d65 2069 6e20 7a69   modelname in zi
-00035b70: 7028 7261 6e67 6528 302c 206e 6669 6c65  p(range(0, nfile
-00035b80: 7329 2c20 6c69 7374 286d 6d66 7363 6469  s), list(mmfscdi
-00035b90: 6374 2929 3a0a 2020 2020 2020 2020 2020  ct)):.          
-00035ba0: 2020 6669 6c65 203d 206d 6d66 7363 6469    file = mmfscdi
-00035bb0: 6374 5b6d 6f64 656c 6e61 6d65 5d0a 2020  ct[modelname].  
-00035bc0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-00035bd0: 7061 7468 2e67 6574 7369 7a65 2866 696c  path.getsize(fil
-00035be0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00035bf0: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
-00035c00: 6c65 2c20 2772 2729 2061 7320 663a 0a20  le, 'r') as f:. 
-00035c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035c20: 2020 2069 6620 6620 6973 206e 6f74 204e     if f is not N
-00035c30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00035c40: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00035c50: 7465 6e74 203d 206a 736f 6e2e 6c6f 6164  tent = json.load
-00035c60: 2866 290a 2020 2020 2020 2020 2020 2020  (f).            
-00035c70: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00035c80: 6572 7227 206e 6f74 2069 6e20 636f 6e74  err' not in cont
-00035c90: 656e 742e 6b65 7973 2829 3a0a 2020 2020  ent.keys():.    
-00035ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035cb0: 2020 2020 2020 2020 6675 6c6c 6461 7461          fulldata
-00035cc0: 5b73 7472 2869 295d 203d 206c 6973 7428  [str(i)] = list(
-00035cd0: 636f 6e74 656e 742e 7661 6c75 6573 2829  content.values()
-00035ce0: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
+00033e10: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
+00033e20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00033e30: 2020 2020 2070 7269 6e74 2827 4e6f 2052       print('No R
+00033e40: 4150 5320 6361 6c63 756c 6174 696f 6e20  APS calculation 
+00033e50: 666f 7220 6e6f 6e2d 6375 6269 6320 6d61  for non-cubic ma
+00033e60: 702e 2729 0a20 2020 2020 2020 2020 2020  p.').           
+00033e70: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+00033e80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00033e90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00033ea0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+00033eb0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00033ec0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00033ed0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00033ee0: 274e 6f20 5241 5053 2077 6974 686f 7574  'No RAPS without
+00033ef0: 2070 726f 7065 7220 6d61 7020 696e 7075   proper map inpu
+00033f00: 7420 616e 6420 7468 6520 6f75 7470 7574  t and the output
+00033f10: 2064 6972 6563 746f 7279 2069 6e66 6f72   directory infor
+00033f20: 6d61 7469 6f6e 2e27 290a 0a20 2020 2023  mation.')..    #
+00033f30: 2041 626f 7665 2048 6572 6520 6973 2074   Above Here is t
+00033f40: 6865 2074 6573 7420 6e65 7720 7261 7073  he test new raps
+00033f50: 2066 756e 6374 696f 6e20 6172 6561 0a0a   function area..
+00033f60: 0a20 2020 2023 204e 6577 2063 7572 7665  .    # New curve
+00033f70: 2069 6e74 6572 7365 6374 696f 6e20 6675   intersection fu
+00033f80: 6e63 7469 6f6e 730a 2020 2020 6465 6620  nctions.    def 
+00033f90: 5f72 6563 745f 696e 7465 725f 696e 6e65  _rect_inter_inne
+00033fa0: 7228 7365 6c66 2c20 7831 2c20 7832 293a  r(self, x1, x2):
+00033fb0: 0a20 2020 2020 2020 206e 3120 3d20 7831  .        n1 = x1
+00033fc0: 2e73 6861 7065 5b30 5d20 2d20 310a 2020  .shape[0] - 1.  
+00033fd0: 2020 2020 2020 6e32 203d 2078 322e 7368        n2 = x2.sh
+00033fe0: 6170 655b 305d 202d 2031 0a20 2020 2020  ape[0] - 1.     
+00033ff0: 2020 2058 3120 3d20 6e70 2e63 5f5b 7831     X1 = np.c_[x1
+00034000: 5b3a 2d31 5d2c 2078 315b 313a 5d5d 0a20  [:-1], x1[1:]]. 
+00034010: 2020 2020 2020 2058 3220 3d20 6e70 2e63         X2 = np.c
+00034020: 5f5b 7832 5b3a 2d31 5d2c 2078 325b 313a  _[x2[:-1], x2[1:
+00034030: 5d5d 0a20 2020 2020 2020 2053 3120 3d20  ]].        S1 = 
+00034040: 6e70 2e74 696c 6528 5831 2e6d 696e 2861  np.tile(X1.min(a
+00034050: 7869 733d 3129 2c20 286e 322c 2031 2929  xis=1), (n2, 1))
+00034060: 2e54 0a20 2020 2020 2020 2053 3220 3d20  .T.        S2 = 
+00034070: 6e70 2e74 696c 6528 5832 2e6d 6178 2861  np.tile(X2.max(a
+00034080: 7869 733d 3129 2c20 286e 312c 2031 2929  xis=1), (n1, 1))
+00034090: 0a20 2020 2020 2020 2053 3320 3d20 6e70  .        S3 = np
+000340a0: 2e74 696c 6528 5831 2e6d 6178 2861 7869  .tile(X1.max(axi
+000340b0: 733d 3129 2c20 286e 322c 2031 2929 2e54  s=1), (n2, 1)).T
+000340c0: 0a20 2020 2020 2020 2053 3420 3d20 6e70  .        S4 = np
+000340d0: 2e74 696c 6528 5832 2e6d 696e 2861 7869  .tile(X2.min(axi
+000340e0: 733d 3129 2c20 286e 312c 2031 2929 0a0a  s=1), (n1, 1))..
+000340f0: 2020 2020 2020 2020 7265 7475 726e 2053          return S
+00034100: 312c 2053 322c 2053 332c 2053 340a 0a20  1, S2, S3, S4.. 
+00034110: 2020 2064 6566 205f 7265 6374 616e 676c     def _rectangl
+00034120: 655f 696e 7465 7273 6563 7469 6f6e 2873  e_intersection(s
+00034130: 656c 662c 2078 312c 2079 312c 2078 322c  elf, x1, y1, x2,
+00034140: 2079 3229 3a0a 2020 2020 2020 2020 5331   y2):.        S1
+00034150: 2c20 5332 2c20 5333 2c20 5334 203d 2073  , S2, S3, S4 = s
+00034160: 656c 662e 5f72 6563 745f 696e 7465 725f  elf._rect_inter_
+00034170: 696e 6e65 7228 7831 2c20 7832 290a 2020  inner(x1, x2).  
+00034180: 2020 2020 2020 5335 2c20 5336 2c20 5337        S5, S6, S7
+00034190: 2c20 5338 203d 2073 656c 662e 5f72 6563  , S8 = self._rec
+000341a0: 745f 696e 7465 725f 696e 6e65 7228 7931  t_inter_inner(y1
+000341b0: 2c20 7932 290a 0a20 2020 2020 2020 2043  , y2)..        C
+000341c0: 3120 3d20 6e70 2e6c 6573 735f 6571 7561  1 = np.less_equa
+000341d0: 6c28 5331 2c20 5332 290a 2020 2020 2020  l(S1, S2).      
+000341e0: 2020 4332 203d 206e 702e 6772 6561 7465    C2 = np.greate
+000341f0: 725f 6571 7561 6c28 5333 2c20 5334 290a  r_equal(S3, S4).
+00034200: 2020 2020 2020 2020 4333 203d 206e 702e          C3 = np.
+00034210: 6c65 7373 5f65 7175 616c 2853 352c 2053  less_equal(S5, S
+00034220: 3629 0a20 2020 2020 2020 2043 3420 3d20  6).        C4 = 
+00034230: 6e70 2e67 7265 6174 6572 5f65 7175 616c  np.greater_equal
+00034240: 2853 372c 2053 3829 0a0a 2020 2020 2020  (S7, S8)..      
+00034250: 2020 6969 2c20 6a6a 203d 206e 702e 6e6f    ii, jj = np.no
+00034260: 6e7a 6572 6f28 4331 2026 2043 3220 2620  nzero(C1 & C2 & 
+00034270: 4333 2026 2043 3429 0a0a 2020 2020 2020  C3 & C4)..      
+00034280: 2020 7265 7475 726e 2069 692c 206a 6a0a    return ii, jj.
+00034290: 0a20 2020 2064 6566 2063 7572 7665 735f  .    def curves_
+000342a0: 696e 7465 7273 6563 7469 6f6e 2873 656c  intersection(sel
+000342b0: 662c 2078 312c 2079 312c 2078 322c 2079  f, x1, y1, x2, y
+000342c0: 3229 3a0a 2020 2020 2020 2020 2222 220a  2):.        """.
+000342d0: 2020 2020 2020 2020 4765 7420 7468 6520          Get the 
+000342e0: 696e 7465 7273 6365 7469 6f6e 206f 6620  interscetion of 
+000342f0: 7477 6f20 6375 7276 6573 0a20 2020 2020  two curves.     
+00034300: 2020 2072 6574 7572 6e3a 206c 6973 7420     return: list 
+00034310: 6f66 206f 6620 7475 706c 6520 636f 6e74  of of tuple cont
+00034320: 6169 6e73 205b 2878 312c 2079 3129 2c20  ains [(x1, y1), 
+00034330: 2878 322c 2079 3229 2c20 2e2e 2e5d 2028  (x2, y2), ...] (
+00034340: 6e6f 2064 7570 6c69 6361 7465 6420 706f  no duplicated po
+00034350: 696e 7473 290a 2020 2020 2020 2020 2222  ints).        ""
+00034360: 220a 2020 2020 2020 2020 7831 203d 206e  ".        x1 = n
+00034370: 702e 6173 6172 7261 7928 7831 290a 2020  p.asarray(x1).  
+00034380: 2020 2020 2020 7832 203d 206e 702e 6173        x2 = np.as
+00034390: 6172 7261 7928 7832 290a 2020 2020 2020  array(x2).      
+000343a0: 2020 7931 203d 206e 702e 6173 6172 7261    y1 = np.asarra
+000343b0: 7928 7931 290a 2020 2020 2020 2020 7932  y(y1).        y2
+000343c0: 203d 206e 702e 6173 6172 7261 7928 7932   = np.asarray(y2
+000343d0: 290a 0a20 2020 2020 2020 2069 692c 206a  )..        ii, j
+000343e0: 6a20 3d20 7365 6c66 2e5f 7265 6374 616e  j = self._rectan
+000343f0: 676c 655f 696e 7465 7273 6563 7469 6f6e  gle_intersection
+00034400: 2878 312c 2079 312c 2078 322c 2079 3229  (x1, y1, x2, y2)
+00034410: 0a20 2020 2020 2020 2069 6620 3020 696e  .        if 0 in
+00034420: 2069 693a 0a20 2020 2020 2020 2020 2020   ii:.           
+00034430: 207a 6572 6f5f 696e 6420 3d20 6e70 2e77   zero_ind = np.w
+00034440: 6865 7265 2869 6920 3d3d 2030 290a 2020  here(ii == 0).  
+00034450: 2020 2020 2020 2020 2020 6969 203d 206e            ii = n
+00034460: 702e 6465 6c65 7465 2869 692c 207a 6572  p.delete(ii, zer
+00034470: 6f5f 696e 6429 0a20 2020 2020 2020 2020  o_ind).         
+00034480: 2020 206a 6a20 3d20 6e70 2e64 656c 6574     jj = np.delet
+00034490: 6528 6a6a 2c20 7a65 726f 5f69 6e64 290a  e(jj, zero_ind).
+000344a0: 2020 2020 2020 2020 6966 2031 2069 6e20          if 1 in 
+000344b0: 6969 3a0a 2020 2020 2020 2020 2020 2020  ii:.            
+000344c0: 6f6e 655f 696e 6420 3d20 6e70 2e77 6865  one_ind = np.whe
+000344d0: 7265 2869 6920 3d3d 2031 290a 2020 2020  re(ii == 1).    
+000344e0: 2020 2020 2020 2020 6969 203d 206e 702e          ii = np.
+000344f0: 6465 6c65 7465 2869 692c 206f 6e65 5f69  delete(ii, one_i
+00034500: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
+00034510: 6a6a 203d 206e 702e 6465 6c65 7465 286a  jj = np.delete(j
+00034520: 6a2c 206f 6e65 5f69 6e64 290a 2020 2020  j, one_ind).    
+00034530: 2020 2020 6e20 3d20 6c65 6e28 6969 290a      n = len(ii).
+00034540: 0a20 2020 2020 2020 2064 7879 3120 3d20  .        dxy1 = 
+00034550: 6e70 2e64 6966 6628 6e70 2e63 5f5b 7831  np.diff(np.c_[x1
+00034560: 2c20 7931 5d2c 2061 7869 733d 3029 0a20  , y1], axis=0). 
+00034570: 2020 2020 2020 2064 7879 3220 3d20 6e70         dxy2 = np
+00034580: 2e64 6966 6628 6e70 2e63 5f5b 7832 2c20  .diff(np.c_[x2, 
+00034590: 7932 5d2c 2061 7869 733d 3029 0a0a 2020  y2], axis=0)..  
+000345a0: 2020 2020 2020 5420 3d20 6e70 2e7a 6572        T = np.zer
+000345b0: 6f73 2828 342c 206e 2929 0a20 2020 2020  os((4, n)).     
+000345c0: 2020 2041 4120 3d20 6e70 2e7a 6572 6f73     AA = np.zeros
+000345d0: 2828 342c 2034 2c20 6e29 290a 2020 2020  ((4, 4, n)).    
+000345e0: 2020 2020 4141 5b30 3a32 2c20 322c 203a      AA[0:2, 2, :
+000345f0: 5d20 3d20 2d31 0a20 2020 2020 2020 2041  ] = -1.        A
+00034600: 415b 323a 342c 2033 2c20 3a5d 203d 202d  A[2:4, 3, :] = -
+00034610: 310a 2020 2020 2020 2020 4141 5b30 3a3a  1.        AA[0::
+00034620: 322c 2030 2c20 3a5d 203d 2064 7879 315b  2, 0, :] = dxy1[
+00034630: 6969 2c20 3a5d 2e54 0a20 2020 2020 2020  ii, :].T.       
+00034640: 2041 415b 313a 3a32 2c20 312c 203a 5d20   AA[1::2, 1, :] 
+00034650: 3d20 6478 7932 5b6a 6a2c 203a 5d2e 540a  = dxy2[jj, :].T.
+00034660: 0a20 2020 2020 2020 2042 4220 3d20 6e70  .        BB = np
+00034670: 2e7a 6572 6f73 2828 342c 206e 2929 0a20  .zeros((4, n)). 
+00034680: 2020 2020 2020 2042 425b 302c 203a 5d20         BB[0, :] 
+00034690: 3d20 2d78 315b 6969 5d2e 7261 7665 6c28  = -x1[ii].ravel(
+000346a0: 290a 2020 2020 2020 2020 4242 5b31 2c20  ).        BB[1, 
+000346b0: 3a5d 203d 202d 7832 5b6a 6a5d 2e72 6176  :] = -x2[jj].rav
+000346c0: 656c 2829 0a20 2020 2020 2020 2042 425b  el().        BB[
+000346d0: 322c 203a 5d20 3d20 2d79 315b 6969 5d2e  2, :] = -y1[ii].
+000346e0: 7261 7665 6c28 290a 2020 2020 2020 2020  ravel().        
+000346f0: 4242 5b33 2c20 3a5d 203d 202d 7932 5b6a  BB[3, :] = -y2[j
+00034700: 6a5d 2e72 6176 656c 2829 0a0a 2020 2020  j].ravel()..    
+00034710: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00034720: 6765 286e 293a 0a20 2020 2020 2020 2020  ge(n):.         
+00034730: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00034740: 2020 2020 2020 2020 545b 3a2c 2069 5d20          T[:, i] 
+00034750: 3d20 6e70 2e6c 696e 616c 672e 736f 6c76  = np.linalg.solv
+00034760: 6528 4141 5b3a 2c20 3a2c 2069 5d2c 2042  e(AA[:, :, i], B
+00034770: 425b 3a2c 2069 5d29 0a20 2020 2020 2020  B[:, i]).       
+00034780: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00034790: 2020 2020 2020 2020 2020 2020 2054 5b3a               T[:
+000347a0: 2c20 695d 203d 206e 702e 496e 660a 0a20  , i] = np.Inf.. 
+000347b0: 2020 2020 2020 2069 6e5f 7261 6e67 6520         in_range 
+000347c0: 3d20 2854 5b30 2c20 3a5d 203e 3d20 3029  = (T[0, :] >= 0)
+000347d0: 2026 2028 545b 312c 203a 5d20 3e3d 2030   & (T[1, :] >= 0
+000347e0: 2920 2620 280a 2020 2020 2020 2020 2020  ) & (.          
+000347f0: 2020 2020 2020 545b 302c 203a 5d20 3c3d        T[0, :] <=
+00034800: 2031 2920 2620 2854 5b31 2c20 3a5d 203c   1) & (T[1, :] <
+00034810: 3d20 3129 0a0a 2020 2020 2020 2020 7879  = 1)..        xy
+00034820: 3020 3d20 545b 323a 2c20 696e 5f72 616e  0 = T[2:, in_ran
+00034830: 6765 5d0a 2020 2020 2020 2020 7879 3020  ge].        xy0 
+00034840: 3d20 7879 302e 540a 2020 2020 2020 2020  = xy0.T.        
+00034850: 6e65 776c 6973 7420 3d20 5b5d 0a20 2020  newlist = [].   
+00034860: 2020 2020 2070 7269 6e74 2878 7930 290a       print(xy0).
+00034870: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00034880: 2078 7930 3a0a 2020 2020 2020 2020 2020   xy0:.          
+00034890: 2020 6120 3d20 7475 706c 6528 6929 0a20    a = tuple(i). 
+000348a0: 2020 2020 2020 2020 2020 206e 6577 6c69             newli
+000348b0: 7374 2e61 7070 656e 6428 6129 0a20 2020  st.append(a).   
+000348c0: 2020 2020 2072 6573 203d 206c 6973 7428       res = list(
+000348d0: 7365 7428 6e65 776c 6973 7429 290a 2020  set(newlist)).  
+000348e0: 2020 2020 2020 7265 732e 736f 7274 286b        res.sort(k
+000348f0: 6579 3d6e 6577 6c69 7374 2e69 6e64 6578  ey=newlist.index
+00034900: 290a 2020 2020 2020 2020 6e6c 6973 7420  ).        nlist 
+00034910: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00034920: 2062 2069 6e20 7265 733a 0a20 2020 2020   b in res:.     
+00034930: 2020 2020 2020 206e 6c69 7374 2e61 7070         nlist.app
+00034940: 656e 6428 6c69 7374 2862 2929 0a20 2020  end(list(b)).   
+00034950: 2020 2020 206c 7265 7320 3d20 6e70 2e61       lres = np.a
+00034960: 7272 6179 286e 6c69 7374 290a 2020 2020  rray(nlist).    
+00034970: 2020 2020 7072 696e 7428 6e70 2e61 7272      print(np.arr
+00034980: 6179 286e 6c69 7374 2929 0a20 2020 2020  ay(nlist)).     
+00034990: 2020 2070 7269 6e74 286e 702e 6172 7261     print(np.arra
+000349a0: 7928 6e6c 6973 7429 5b3a 2c20 305d 290a  y(nlist)[:, 0]).
+000349b0: 2020 2020 2020 2020 7072 696e 7428 6e70          print(np
+000349c0: 2e61 7272 6179 286e 6c69 7374 295b 3a2c  .array(nlist)[:,
+000349d0: 2031 5d29 0a20 2020 2020 2020 2072 6574   1]).        ret
+000349e0: 7572 6e20 6c72 6573 5b3a 2c20 305d 2c20  urn lres[:, 0], 
+000349f0: 6c72 6573 5b3a 2c20 315d 0a0a 2020 2020  lres[:, 1]..    
+00034a00: 2320 456e 6420 6f66 206e 6577 2063 7572  # End of new cur
+00034a10: 7665 2069 6e74 6572 7365 6374 696f 6e20  ve intersection 
+00034a20: 6675 6e63 7469 6f6e 730a 0a20 2020 2064  functions..    d
+00034a30: 6566 205f 5f69 6e74 6572 706f 6c61 7465  ef __interpolate
+00034a40: 645f 696e 7465 7263 6570 7428 7365 6c66  d_intercept(self
+00034a50: 2c20 782c 2079 312c 2079 3229 3a0a 2020  , x, y1, y2):.  
+00034a60: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00034a70: 2020 2020 2020 2046 696e 6420 7468 6520         Find the 
+00034a80: 696e 7465 7263 6570 7420 6f66 2074 776f  intercept of two
+00034a90: 2063 7572 7665 732c 2067 6976 656e 2062   curves, given b
+00034aa0: 7920 7468 6520 7361 6d65 2078 2064 6174  y the same x dat
+00034ab0: 610a 0a20 2020 2020 2020 2022 2222 0a0a  a..        """..
+00034ac0: 2020 2020 2020 2020 6465 6620 696e 7465          def inte
+00034ad0: 7263 6570 7428 706f 696e 7431 2c20 706f  rcept(point1, po
+00034ae0: 696e 7432 2c20 706f 696e 7433 2c20 706f  int2, point3, po
+00034af0: 696e 7434 293a 0a20 2020 2020 2020 2020  int4):.         
+00034b00: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00034b10: 2020 2020 2020 2020 4669 6e64 2074 6865          Find the
+00034b20: 2069 6e74 6572 7365 6374 696f 6e20 6265   intersection be
+00034b30: 7477 6565 6e20 7477 6f20 6c69 6e65 730a  tween two lines.
+00034b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034b50: 7468 6520 6669 7273 7420 6c69 6e65 2069  the first line i
+00034b60: 7320 6465 6669 6e65 6420 6279 2074 6865  s defined by the
+00034b70: 206c 696e 6520 6265 7477 6565 6e20 706f   line between po
+00034b80: 696e 7431 2061 6e64 2070 6f69 6e74 320a  int1 and point2.
+00034b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034ba0: 7468 6520 7365 636f 6e64 206c 696e 6520  the second line 
+00034bb0: 6973 2064 6566 696e 6564 2062 7920 7468  is defined by th
+00034bc0: 6520 6c69 6e65 2062 6574 7765 656e 2070  e line between p
+00034bd0: 6f69 6e74 3320 616e 6420 706f 696e 7434  oint3 and point4
+00034be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034bf0: 2065 6163 6820 706f 696e 7420 6973 2061   each point is a
+00034c00: 6e20 2878 2c79 2920 7475 706c 652e 0a0a  n (x,y) tuple...
+00034c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034c20: 536f 2c20 666f 7220 6578 616d 706c 652c  So, for example,
+00034c30: 2079 6f75 2063 616e 2066 696e 6420 7468   you can find th
+00034c40: 6520 696e 7465 7273 6563 7469 6f6e 2062  e intersection b
+00034c50: 6574 7765 656e 0a20 2020 2020 2020 2020  etween.         
+00034c60: 2020 2020 2020 2069 6e74 6572 6365 7074         intercept
+00034c70: 2828 302c 3029 2c20 2831 2c31 292c 2028  ((0,0), (1,1), (
+00034c80: 302c 3129 2c20 2831 2c30 2929 203d 2028  0,1), (1,0)) = (
+00034c90: 302e 352c 2030 2e35 290a 0a20 2020 2020  0.5, 0.5)..     
+00034ca0: 2020 2020 2020 2020 2020 203a 7265 7475             :retu
+00034cb0: 726e 3a20 496e 7465 7263 6570 742c 2069  rn: Intercept, i
+00034cc0: 6e20 2878 2c79 2920 666f 726d 6174 0a0a  n (x,y) format..
+00034cd0: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+00034ce0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00034cf0: 206c 696e 6528 7031 2c20 7032 293a 0a20   line(p1, p2):. 
+00034d00: 2020 2020 2020 2020 2020 2020 2020 2041                 A
+00034d10: 203d 2028 7031 5b31 5d20 2d20 7032 5b31   = (p1[1] - p2[1
+00034d20: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00034d30: 2020 2042 203d 2028 7032 5b30 5d20 2d20     B = (p2[0] - 
+00034d40: 7031 5b30 5d29 0a20 2020 2020 2020 2020  p1[0]).         
+00034d50: 2020 2020 2020 2043 203d 2028 7031 5b30         C = (p1[0
+00034d60: 5d20 2a20 7032 5b31 5d20 2d20 7032 5b30  ] * p2[1] - p2[0
+00034d70: 5d20 2a20 7031 5b31 5d29 0a0a 2020 2020  ] * p1[1])..    
+00034d80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00034d90: 726e 2041 2c20 422c 202d 430a 0a20 2020  rn A, B, -C..   
+00034da0: 2020 2020 2020 2020 2064 6566 2069 6e74           def int
+00034db0: 6572 7365 6374 696f 6e28 4c31 2c20 4c32  ersection(L1, L2
+00034dc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00034dd0: 2020 2044 203d 204c 315b 305d 202a 204c     D = L1[0] * L
+00034de0: 325b 315d 202d 204c 315b 315d 202a 204c  2[1] - L1[1] * L
+00034df0: 325b 305d 0a20 2020 2020 2020 2020 2020  2[0].           
+00034e00: 2020 2020 2044 7820 3d20 4c31 5b32 5d20       Dx = L1[2] 
+00034e10: 2a20 4c32 5b31 5d20 2d20 4c31 5b31 5d20  * L2[1] - L1[1] 
+00034e20: 2a20 4c32 5b32 5d0a 2020 2020 2020 2020  * L2[2].        
+00034e30: 2020 2020 2020 2020 4479 203d 204c 315b          Dy = L1[
+00034e40: 305d 202a 204c 325b 325d 202d 204c 315b  0] * L2[2] - L1[
+00034e50: 325d 202a 204c 325b 305d 0a0a 2020 2020  2] * L2[0]..    
+00034e60: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00034e70: 4478 202f 2044 0a20 2020 2020 2020 2020  Dx / D.         
+00034e80: 2020 2020 2020 2079 203d 2044 7920 2f20         y = Dy / 
+00034e90: 440a 0a20 2020 2020 2020 2020 2020 2020  D..             
+00034ea0: 2020 2072 6574 7572 6e20 782c 2079 0a0a     return x, y..
+00034eb0: 2020 2020 2020 2020 2020 2020 4c31 203d              L1 =
+00034ec0: 206c 696e 6528 5b70 6f69 6e74 315b 305d   line([point1[0]
+00034ed0: 2c20 706f 696e 7431 5b31 5d5d 2c20 5b70  , point1[1]], [p
+00034ee0: 6f69 6e74 325b 305d 2c20 706f 696e 7432  oint2[0], point2
+00034ef0: 5b31 5d5d 290a 2020 2020 2020 2020 2020  [1]]).          
+00034f00: 2020 4c32 203d 206c 696e 6528 5b70 6f69    L2 = line([poi
+00034f10: 6e74 335b 305d 2c20 706f 696e 7433 5b31  nt3[0], point3[1
+00034f20: 5d5d 2c20 5b70 6f69 6e74 345b 305d 2c20  ]], [point4[0], 
+00034f30: 706f 696e 7434 5b31 5d5d 290a 0a20 2020  point4[1]])..   
+00034f40: 2020 2020 2020 2020 2052 203d 2069 6e74           R = int
+00034f50: 6572 7365 6374 696f 6e28 4c31 2c20 4c32  ersection(L1, L2
+00034f60: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00034f70: 6574 7572 6e20 520a 0a20 2020 2020 2020  eturn R..       
+00034f80: 2069 6478 203d 206e 702e 6172 6777 6865   idx = np.argwhe
+00034f90: 7265 286e 702e 6469 6666 286e 702e 7369  re(np.diff(np.si
+00034fa0: 676e 2879 3120 2d20 7932 2929 2021 3d20  gn(y1 - y2)) != 
+00034fb0: 3029 0a20 2020 2020 2020 2023 2052 656d  0).        # Rem
+00034fc0: 6f76 6520 7468 6520 6669 7273 7420 706f  ove the first po
+00034fd0: 696e 7420 7573 7561 6c6c 7920 2830 2c20  int usually (0, 
+00034fe0: 3129 2074 6f20 6176 6f69 6420 616c 6c20  1) to avoid all 
+00034ff0: 6375 7276 6573 2073 7461 7274 696e 6720  curves starting 
+00035000: 6672 6f6d 2028 302c 2031 2920 7768 6963  from (0, 1) whic
+00035010: 6820 7069 636b 2061 7320 6f6e 6520 696e  h pick as one in
+00035020: 7465 7273 6563 7469 6f6e 0a20 2020 2020  tersection.     
+00035030: 2020 2069 6620 6964 782e 7369 7a65 2021     if idx.size !
+00035040: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00035050: 2069 6620 6964 785b 305d 5b30 5d20 3d3d   if idx[0][0] ==
+00035060: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00035070: 2020 2020 6964 7820 3d20 6e70 2e64 656c      idx = np.del
+00035080: 6574 6528 6964 782c 2030 2c20 3029 0a20  ete(idx, 0, 0). 
+00035090: 2020 2020 2020 2020 2020 2078 632c 2079             xc, y
+000350a0: 6320 3d20 696e 7465 7263 6570 7428 2878  c = intercept((x
+000350b0: 5b69 6478 5d2c 2079 315b 6964 785d 292c  [idx], y1[idx]),
+000350c0: 2028 2878 5b69 6478 202b 2031 5d2c 2079   ((x[idx + 1], y
+000350d0: 315b 6964 7820 2b20 315d 2929 2c20 2828  1[idx + 1])), ((
+000350e0: 785b 6964 785d 2c20 7932 5b69 6478 5d29  x[idx], y2[idx])
+000350f0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00035100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035110: 2020 2828 785b 6964 7820 2b20 315d 2c20    ((x[idx + 1], 
+00035120: 7932 5b69 6478 202b 2031 5d29 2929 0a20  y2[idx + 1]))). 
+00035130: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00035140: 6e20 7863 2c20 7963 0a20 2020 2020 2020  n xc, yc.       
+00035150: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00035160: 2020 206e 756c 6c61 7272 203d 206e 702e     nullarr = np.
+00035170: 656d 7074 7928 7368 6170 653d 2830 2c20  empty(shape=(0, 
+00035180: 3029 290a 2020 2020 2020 2020 2020 2020  0)).            
+00035190: 7265 7475 726e 206e 756c 6c61 7272 2c20  return nullarr, 
+000351a0: 6e75 6c6c 6172 720a 0a0a 2020 2020 6465  nullarr...    de
+000351b0: 6620 6d6d 6673 6328 7365 6c66 293a 0a20  f mmfsc(self):. 
+000351c0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000351d0: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
+000351e0: 6520 4d6f 6465 6c2d 6d61 7020 4653 4320  e Model-map FSC 
+000351f0: 6261 7365 6420 6f6e 2073 696d 756c 6174  based on simulat
+00035200: 6564 2064 656e 7369 7479 206d 6170 2066  ed density map f
+00035210: 726f 6d20 6d6f 6465 6c0a 0a20 2020 2020  rom model..     
+00035220: 2020 203a 7265 7475 726e 3a0a 2020 2020     :return:.    
+00035230: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00035240: 2069 6620 7365 6c66 2e70 6c61 7466 6f72   if self.platfor
+00035250: 6d20 3d3d 2027 656d 6462 273a 0a20 2020  m == 'emdb':.   
+00035260: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+00035270: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
+00035280: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
+00035290: 2020 2020 6d6f 6465 6c73 6d61 7073 203d      modelsmaps =
+000352a0: 2073 656c 662e 6d6f 6465 6c73 6d61 7073   self.modelsmaps
+000352b0: 0a20 2020 2020 2020 2020 2020 2023 2320  .            ## 
+000352c0: 546f 646f 3a20 436f 6e73 6964 6572 2070  Todo: Consider p
+000352d0: 7574 7469 6e67 2074 6869 7320 6572 7220  utting this err 
+000352e0: 696e 666f 726d 6174 696f 6e20 696e 746f  information into
+000352f0: 2074 6865 2066 696e 616c 2066 7363 206a   the final fsc j
+00035300: 736f 6e20 6669 6c65 0a20 2020 2020 2020  son file.       
+00035310: 2020 2020 206d 6f64 656c 6d61 7073 6469       modelmapsdi
+00035320: 6374 203d 207b 7d0a 2020 2020 2020 2020  ct = {}.        
+00035330: 2020 2020 6f6c 6466 696c 6573 203d 205b      oldfiles = [
+00035340: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00035350: 2073 656c 662e 6d65 7420 213d 2027 746f   self.met != 'to
+00035360: 6d6f 2720 616e 6420 7365 6c66 2e6d 6574  mo' and self.met
+00035370: 2021 3d20 2763 7279 7327 2061 6e64 2028   != 'crys' and (
+00035380: 6d6f 6465 6c73 6d61 7073 2069 7320 6e6f  modelsmaps is no
+00035390: 7420 4e6f 6e65 293a 0a20 2020 2020 2020  t None):.       
+000353a0: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
+000353b0: 656c 6d61 7020 696e 206d 6f64 656c 736d  elmap in modelsm
+000353c0: 6170 733a 0a20 2020 2020 2020 2020 2020  aps:.           
+000353d0: 2020 2020 2020 2020 2023 2072 6561 6420           # read 
+000353e0: 6d6f 6465 6c20 6d61 700a 2020 2020 2020  model map.      
+000353f0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+00035400: 6465 6c6e 616d 6520 3d20 6f73 2e70 6174  delname = os.pat
+00035410: 682e 6261 7365 6e61 6d65 286d 6f64 656c  h.basename(model
+00035420: 6d61 7029 2e73 706c 6974 2827 5f27 295b  map).split('_')[
+00035430: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00035440: 2020 2020 2020 2023 206f 626a 6d6f 6465         # objmode
+00035450: 6c6d 6170 203d 2073 656c 662e 6672 6f6d  lmap = self.from
+00035460: 6d72 635f 746f 7465 6d70 7928 6d6f 6465  mrc_totempy(mode
+00035470: 6c6d 6170 290a 2020 2020 2020 2020 2020  lmap).          
+00035480: 2020 2020 2020 2020 2020 6f62 6a6d 6f64            objmod
+00035490: 656c 6d61 7020 3d20 6d72 6366 696c 652e  elmap = mrcfile.
+000354a0: 6d6d 6170 286d 6f64 656c 6d61 702c 206d  mmap(modelmap, m
+000354b0: 6f64 653d 2772 2729 0a20 2020 2020 2020  ode='r').       
+000354c0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+000354d0: 656c 662e 6673 6328 7365 6c66 2e6d 6170  elf.fsc(self.map
+000354e0: 2c20 6f62 6a6d 6f64 656c 6d61 702c 206c  , objmodelmap, l
+000354f0: 6162 656c 3d27 7b7d 5f6d 6d27 2e66 6f72  abel='{}_mm'.for
+00035500: 6d61 7428 6d6f 6465 6c6e 616d 6529 290a  mat(modelname)).
+00035510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035520: 2020 2020 7365 6c66 2e6e 6577 5f66 7363      self.new_fsc
+00035530: 2873 656c 662e 6d61 702c 206f 626a 6d6f  (self.map, objmo
+00035540: 6465 6c6d 6170 2c20 6c61 6265 6c3d 277b  delmap, label='{
+00035550: 7d5f 6d6d 272e 666f 726d 6174 286d 6f64  }_mm'.format(mod
+00035560: 656c 6e61 6d65 2929 0a20 2020 2020 2020  elname)).       
+00035570: 2020 2020 2020 2020 2020 2020 206f 6c64               old
+00035580: 6e61 6d65 203d 2027 7b7d 7b7d 5f7b 7d5f  name = '{}{}_{}_
+00035590: 6d6d 6673 632e 6a73 6f6e 272e 666f 726d  mmfsc.json'.form
+000355a0: 6174 2873 656c 662e 776f 726b 6469 722c  at(self.workdir,
+000355b0: 2073 656c 662e 6d61 706e 616d 652c 206d   self.mapname, m
+000355c0: 6f64 656c 6e61 6d65 290a 2020 2020 2020  odelname).      
+000355d0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000355e0: 776e 616d 6520 3d20 277b 7d7b 7d27 2e66  wname = '{}{}'.f
+000355f0: 6f72 6d61 7428 7365 6c66 2e77 6f72 6b64  ormat(self.workd
+00035600: 6972 2c20 7365 6c66 2e6d 6170 6e61 6d65  ir, self.mapname
+00035610: 202b 2027 5f27 202b 206d 6f64 656c 6e61   + '_' + modelna
+00035620: 6d65 202b 2027 5f6d 6d66 7363 2e6a 736f  me + '_mmfsc.jso
+00035630: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+00035640: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00035650: 7468 2e69 7366 696c 6528 6f6c 646e 616d  th.isfile(oldnam
+00035660: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00035670: 2020 2020 2020 2020 2020 2020 6f6c 6466              oldf
+00035680: 696c 6573 2e61 7070 656e 6428 6f6c 646e  iles.append(oldn
+00035690: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+000356a0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+000356b0: 7265 6e61 6d65 286f 6c64 6e61 6d65 2c20  rename(oldname, 
+000356c0: 6e65 776e 616d 6529 0a20 2020 2020 2020  newname).       
+000356d0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000356e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000356f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00035700: 2827 7b7d 2064 6f65 7320 6e6f 7420 6578  ('{} does not ex
+00035710: 6973 742c 2070 6c65 6173 6520 6368 6563  ist, please chec
+00035720: 6b2e 272e 666f 726d 6174 286f 6c64 6e61  k.'.format(oldna
+00035730: 6d65 2929 0a20 2020 2020 2020 2020 2020  me)).           
+00035740: 2020 2020 2020 2020 206d 6f64 656c 6d61           modelma
+00035750: 7073 6469 6374 5b6d 6f64 656c 6e61 6d65  psdict[modelname
+00035760: 5d20 3d20 6e65 776e 616d 650a 2020 2020  ] = newname.    
+00035770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00035780: 2e6d 6572 6765 6d6d 6673 6328 6d6f 6465  .mergemmfsc(mode
+00035790: 6c6d 6170 7364 6963 7429 0a20 2020 2020  lmapsdict).     
+000357a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000357b0: 6465 6c6f 6c64 6d6d 6673 6328 6f6c 6466  deloldmmfsc(oldf
+000357c0: 696c 6573 290a 2020 2020 2020 2020 2020  iles).          
+000357d0: 2020 2020 2020 656e 6420 3d20 7469 6d65        end = time
+000357e0: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
+000357f0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00035800: 2020 2020 7072 696e 7428 276d 6d66 7363      print('mmfsc
+00035810: 2074 696d 653a 2025 7327 2025 2028 656e   time: %s' % (en
+00035820: 6420 2d20 7374 6172 7429 290a 2020 2020  d - start)).    
+00035830: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00035840: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
+00035850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00035860: 2d2d 2d2d 2d2d 2d27 290a 0a20 2020 2020  -------')..     
+00035870: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00035880: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00035890: 6e74 2827 4d6f 6465 6c2d 6d61 7020 4653  nt('Model-map FS
+000358a0: 4320 6f6e 6c79 2063 616c 6375 6c61 7465  C only calculate
+000358b0: 6420 666f 7220 7369 6e67 6c65 2070 6172  d for single par
+000358c0: 7469 636c 6520 6461 7461 2077 6865 7265  ticle data where
+000358d0: 2074 6865 7265 2069 7320 6120 6669 7474   there is a fitt
+000358e0: 6564 206d 6f64 656c 2027 0a20 2020 2020  ed model '.     
+000358f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035900: 2027 2850 6c65 6173 6520 7573 6520 2d6d   '(Please use -m
+00035910: 2073 7020 616e 6420 2d66 2920 6f72 206e   sp and -f) or n
+00035920: 6f20 6d6f 6465 6c20 6d61 7020 6973 2063  o model map is c
+00035930: 616c 6375 6c61 7465 6420 7573 202d 6920  alculated us -i 
+00035940: 742f 6620 746f 2073 7769 7463 6820 6966  t/f to switch if
+00035950: 206f 6e20 6f72 206f 6666 2e27 290a 0a20   on or off.').. 
+00035960: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00035970: 6e65 0a0a 2020 2020 6465 6620 6465 6c6f  ne..    def delo
+00035980: 6c64 6d6d 6673 6328 7365 6c66 2c20 6f6c  ldmmfsc(self, ol
+00035990: 6466 696c 6573 293a 0a20 2020 2020 2020  dfiles):.       
+000359a0: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+000359b0: 2020 6465 6c65 7465 2073 6570 6172 6174    delete separat
+000359c0: 6520 6d6d 6673 6320 6669 6c65 7320 746f  e mmfsc files to
+000359d0: 2061 766f 6964 206d 6572 6765 6420 696e   avoid merged in
+000359e0: 746f 2074 6865 2066 696e 616c 206a 736f  to the final jso
+000359f0: 6e0a 0a20 2020 2020 2020 203a 7061 7261  n..        :para
+00035a00: 6d20 6f6c 6466 696c 6573 3a0a 2020 2020  m oldfiles:.    
+00035a10: 2020 2020 3a72 6574 7572 6e3a 204e 6f6e      :return: Non
+00035a20: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
+00035a30: 2020 2020 2020 2069 6620 6f6c 6466 696c         if oldfil
+00035a40: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00035a50: 666f 7220 6669 6c65 2069 6e20 6f6c 6466  for file in oldf
+00035a60: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+00035a70: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
+00035a80: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+00035a90: 2020 7072 696e 7428 2753 6570 6172 6174    print('Separat
+00035aa0: 6520 6d6d 6673 6320 6669 6c65 7320 7765  e mmfsc files we
+00035ab0: 7265 2064 656c 6574 6564 2e27 290a 2020  re deleted.').  
+00035ac0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00035ad0: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
+00035ae0: 6f20 6d6d 6673 6320 6578 6973 742c 206e  o mmfsc exist, n
+00035af0: 6f20 6d6d 6673 6320 6669 6c65 2063 616e  o mmfsc file can
+00035b00: 2062 6520 6465 6c65 7465 6427 290a 0a0a   be deleted')...
+00035b10: 2020 2020 6465 6620 6d65 7267 656d 6d66      def mergemmf
+00035b20: 7363 2873 656c 662c 206d 6d66 7363 6469  sc(self, mmfscdi
+00035b30: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
+00035b40: 0a0a 2020 2020 2020 2020 2020 2020 4d65  ..            Me
+00035b50: 7267 6520 616c 6c20 2a5f 6d6d 6673 632e  rge all *_mmfsc.
+00035b60: 6a73 6f6e 2066 696c 6573 206f 6620 6469  json files of di
+00035b70: 6666 6572 656e 7420 6d6f 6465 6c73 0a0a  fferent models..
+00035b80: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00035b90: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00035ba0: 2020 2020 2020 6e66 696c 6573 203d 206c        nfiles = l
+00035bb0: 656e 286c 6973 7428 6d6d 6673 6364 6963  en(list(mmfscdic
+00035bc0: 7429 290a 2020 2020 2020 2020 6675 6c6c  t)).        full
+00035bd0: 6461 7461 203d 207b 7d0a 2020 2020 2020  data = {}.      
+00035be0: 2020 666f 7220 692c 206d 6f64 656c 6e61    for i, modelna
+00035bf0: 6d65 2069 6e20 7a69 7028 7261 6e67 6528  me in zip(range(
+00035c00: 302c 206e 6669 6c65 7329 2c20 6c69 7374  0, nfiles), list
+00035c10: 286d 6d66 7363 6469 6374 2929 3a0a 2020  (mmfscdict)):.  
+00035c20: 2020 2020 2020 2020 2020 6669 6c65 203d            file =
+00035c30: 206d 6d66 7363 6469 6374 5b6d 6f64 656c   mmfscdict[model
+00035c40: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
+00035c50: 2020 6966 206f 732e 7061 7468 2e67 6574    if os.path.get
+00035c60: 7369 7a65 2866 696c 6529 3a0a 2020 2020  size(file):.    
+00035c70: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00035c80: 206f 7065 6e28 6669 6c65 2c20 2772 2729   open(file, 'r')
+00035c90: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+00035ca0: 2020 2020 2020 2020 2020 2069 6620 6620             if f 
+00035cb0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00035cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035cd0: 2020 2020 2063 6f6e 7465 6e74 203d 206a       content = j
+00035ce0: 736f 6e2e 6c6f 6164 2866 290a 2020 2020  son.load(f).    
 00035cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035d00: 2066 756c 6c64 6174 615b 7374 7228 6929   fulldata[str(i)
-00035d10: 5d5b 276e 616d 6527 5d20 3d20 6d6f 6465  ]['name'] = mode
-00035d20: 6c6e 616d 650a 2020 2020 2020 2020 2020  lname.          
-00035d30: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00035d40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00035d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035d60: 6375 7265 7272 203d 2063 6f6e 7465 6e74  curerr = content
-00035d70: 2e76 616c 7565 7328 295b 305d 5b27 6572  .values()[0]['er
-00035d80: 7227 5d0a 2020 2020 2020 2020 2020 2020  r'].            
-00035d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035da0: 6675 6c6c 6461 7461 5b73 7472 2869 295d  fulldata[str(i)]
-00035db0: 5b27 6572 7227 5d20 3d20 6375 7265 7272  ['err'] = curerr
-00035dc0: 0a0a 0a20 2020 2020 2020 206f 7574 7075  ...        outpu
-00035dd0: 7420 3d20 277b 7d7b 7d5f 6d6d 6673 632e  t = '{}{}_mmfsc.
-00035de0: 6a73 6f6e 272e 666f 726d 6174 2873 656c  json'.format(sel
-00035df0: 662e 776f 726b 6469 722c 2073 656c 662e  f.workdir, self.
-00035e00: 6d61 706e 616d 652c 2029 0a20 2020 2020  mapname, ).     
-00035e10: 2020 2066 696e 616c 6461 7461 203d 207b     finaldata = {
-00035e20: 7d0a 2020 2020 2020 2020 6669 6e61 6c64  }.        finald
-00035e30: 6174 615b 276d 6d66 7363 275d 203d 2066  ata['mmfsc'] = f
-00035e40: 756c 6c64 6174 610a 2020 2020 2020 2020  ulldata.        
-00035e50: 7769 7468 206f 7065 6e28 6f75 7470 7574  with open(output
-00035e60: 2c20 2777 2729 2061 7320 6f75 743a 0a20  , 'w') as out:. 
-00035e70: 2020 2020 2020 2020 2020 206a 736f 6e2e             json.
-00035e80: 6475 6d70 2866 696e 616c 6461 7461 2c20  dump(finaldata, 
-00035e90: 6f75 7429 0a0a 2020 2020 2020 2020 7265  out)..        re
-00035ea0: 7475 726e 204e 6f6e 650a 0a20 2020 2064  turn None..    d
-00035eb0: 6566 2066 726f 6d6d 7263 5f74 6f74 656d  ef frommrc_totem
-00035ec0: 7079 2873 656c 662c 2066 756c 6c6d 6170  py(self, fullmap
-00035ed0: 6e61 6d65 293a 0a20 2020 2020 2020 2022  name):.        "
-00035ee0: 2222 0a20 2020 2020 2020 2020 2020 2054  "".            T
-00035ef0: 7261 6e73 6665 7220 7468 6520 6d72 6366  ransfer the mrcf
-00035f00: 696c 6520 6d61 7020 6f62 6a65 6374 2074  ile map object t
-00035f10: 6f20 5445 4d50 7920 6d61 7020 6f62 6a65  o TEMPy map obje
-00035f20: 6374 0a0a 2020 2020 2020 2020 3a70 6172  ct..        :par
-00035f30: 616d 2066 756c 6c6d 6170 6e61 6d65 3a0a  am fullmapname:.
-00035f40: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00035f50: 2054 454d 5079 206d 6170 206f 626a 6563   TEMPy map objec
-00035f60: 740a 2020 2020 2020 2020 2222 220a 0a0a  t.        """...
-00035f70: 2020 2020 2020 2020 6d72 636d 6170 203d          mrcmap =
-00035f80: 206d 7263 6669 6c65 2e6d 6d61 7028 6675   mrcfile.mmap(fu
-00035f90: 6c6c 6d61 706e 616d 652c 206d 6f64 653d  llmapname, mode=
-00035fa0: 2772 2729 0a20 2020 2020 2020 206d 7263  'r').        mrc
-00035fb0: 6865 6164 6572 203d 206d 7263 6d61 702e  header = mrcmap.
-00035fc0: 6865 6164 6572 0a20 2020 2020 2020 206d  header.        m
-00035fd0: 6170 6461 7461 203d 206d 7263 6d61 702e  apdata = mrcmap.
-00035fe0: 6461 7461 2e61 7374 7970 6528 2766 6c6f  data.astype('flo
-00035ff0: 6174 2729 0a20 2020 2020 2020 2063 7273  at').        crs
-00036000: 203d 2028 6d72 6368 6561 6465 722e 6d61   = (mrcheader.ma
-00036010: 7063 2c20 6d72 6368 6561 6465 722e 6d61  pc, mrcheader.ma
-00036020: 7072 2c20 6d72 6368 6561 6465 722e 6d61  pr, mrcheader.ma
-00036030: 7073 290a 2020 2020 2020 2020 7265 7665  ps).        reve
-00036040: 7273 6563 7273 203d 2063 7273 5b3a 3a2d  rsecrs = crs[::-
-00036050: 315d 0a20 2020 2020 2020 206e 7374 6172  1].        nstar
-00036060: 7473 203d 2028 6d72 6368 6561 6465 722e  ts = (mrcheader.
-00036070: 6e78 7374 6172 742c 206d 7263 6865 6164  nxstart, mrchead
-00036080: 6572 2e6e 7973 7461 7274 2c20 6d72 6368  er.nystart, mrch
-00036090: 6561 6465 722e 6e7a 7374 6172 7429 0a20  eader.nzstart). 
-000360a0: 2020 2020 2020 2073 7464 6372 7320 3d20         stdcrs = 
-000360b0: 2833 2c20 322c 2031 290a 2020 2020 2020  (3, 2, 1).      
-000360c0: 2020 6469 6666 6372 7320 3d20 7475 706c    diffcrs = tupl
-000360d0: 6528 782d 7920 666f 7220 782c 7920 696e  e(x-y for x,y in
-000360e0: 207a 6970 2872 6576 6572 7365 6372 732c   zip(reversecrs,
-000360f0: 2073 7464 6372 7329 290a 2020 2020 2020   stdcrs)).      
-00036100: 2020 6966 2064 6966 6663 7273 2021 3d20    if diffcrs != 
-00036110: 2830 2c20 302c 2030 293a 0a20 2020 2020  (0, 0, 0):.     
-00036120: 2020 2020 2020 2069 6620 3120 696e 2064         if 1 in d
-00036130: 6966 6663 7273 2061 6e64 202d 3120 696e  iffcrs and -1 in
-00036140: 2064 6966 6663 7273 3a0a 2020 2020 2020   diffcrs:.      
-00036150: 2020 2020 2020 2020 2020 6d61 7064 6174            mapdat
-00036160: 6120 3d20 6e70 2e73 7761 7061 7865 7328  a = np.swapaxes(
-00036170: 6d61 7064 6174 612c 2064 6966 6663 7273  mapdata, diffcrs
-00036180: 2e69 6e64 6578 282d 3129 2c20 6469 6666  .index(-1), diff
-00036190: 6372 732e 696e 6465 7828 3129 290a 2020  crs.index(1)).  
-000361a0: 2020 2020 2020 2020 2020 6966 202d 3220            if -2 
-000361b0: 696e 2064 6966 6663 7273 2061 6e64 2032  in diffcrs and 2
-000361c0: 2069 6e20 6469 6666 6372 733a 0a20 2020   in diffcrs:.   
-000361d0: 2020 2020 2020 2020 2020 2020 206d 6170               map
-000361e0: 6461 7461 203d 206e 702e 7377 6170 6178  data = np.swapax
-000361f0: 6573 286d 6170 6461 7461 2c20 6469 6666  es(mapdata, diff
-00036200: 6372 732e 696e 6465 7828 2d32 292c 2064  crs.index(-2), d
-00036210: 6966 6663 7273 2e69 6e64 6578 2832 2929  iffcrs.index(2))
-00036220: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00036230: 3120 696e 2064 6966 6663 7273 2061 6e64  1 in diffcrs and
-00036240: 202d 3220 696e 2064 6966 6663 7273 3a0a   -2 in diffcrs:.
-00036250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036260: 6d61 7064 6174 6120 3d20 6e70 2e73 7761  mapdata = np.swa
-00036270: 7061 7865 7328 6e70 2e73 7761 7061 7865  paxes(np.swapaxe
-00036280: 7328 6d61 7064 6174 612c 2030 2c20 3129  s(mapdata, 0, 1)
-00036290: 2c20 312c 2032 290a 2020 2020 2020 2020  , 1, 2).        
-000362a0: 2020 2020 6966 202d 3120 696e 2064 6966      if -1 in dif
-000362b0: 6663 7273 2061 6e64 2032 2069 6e20 6469  fcrs and 2 in di
-000362c0: 6666 6372 733a 0a20 2020 2020 2020 2020  ffcrs:.         
-000362d0: 2020 2020 2020 206d 6170 6461 7461 203d         mapdata =
-000362e0: 206e 702e 7377 6170 6178 6573 286e 702e   np.swapaxes(np.
-000362f0: 7377 6170 6178 6573 286d 6170 6461 7461  swapaxes(mapdata
-00036300: 2c20 312c 2032 292c 2030 2c20 3129 0a20  , 1, 2), 0, 1). 
-00036310: 2020 2020 2020 2020 2020 2023 206d 6170             # map
-00036320: 6461 7461 203d 206e 702e 7377 6170 6178  data = np.swapax
-00036330: 6573 286d 6170 6461 7461 2c20 302c 2032  es(mapdata, 0, 2
-00036340: 290a 0a20 2020 2020 2020 2023 206d 6170  )..        # map
-00036350: 6461 7461 203d 206e 702e 7377 6170 6178  data = np.swapax
-00036360: 6573 286e 702e 7377 6170 6178 6573 286d  es(np.swapaxes(m
-00036370: 6170 6461 7461 2c20 302c 2032 292c 2031  apdata, 0, 2), 1
-00036380: 2c20 3229 0a20 2020 2020 2020 2074 656d  , 2).        tem
-00036390: 7079 6865 6164 6572 203d 204d 6170 5061  pyheader = MapPa
-000363a0: 7273 6572 2e72 6561 644d 5243 4865 6164  rser.readMRCHead
-000363b0: 6572 2866 756c 6c6d 6170 6e61 6d65 290a  er(fullmapname).
-000363c0: 0a20 2020 2020 2020 2023 206e 782c 206e  .        # nx, n
-000363d0: 792c 206e 7a20 616e 6420 6e78 7374 6172  y, nz and nxstar
-000363e0: 742c 206e 7973 7461 7274 2c20 6e7a 7374  t, nystart, nzst
-000363f0: 6172 7420 6861 7665 7220 746f 2062 6520  art haver to be 
-00036400: 6368 616e 6765 6420 6163 636f 7264 696e  changed accordin
-00036410: 676c 7920 746f 2074 6865 2064 6174 610a  gly to the data.
-00036420: 2020 2020 2020 2020 7465 6d70 7968 6561          tempyhea
-00036430: 6465 7220 3d20 6c69 7374 2874 656d 7079  der = list(tempy
-00036440: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-00036450: 7465 6d70 7968 6561 6465 725b 305d 203d  tempyheader[0] =
-00036460: 206d 6170 6461 7461 2e73 6861 7065 5b32   mapdata.shape[2
-00036470: 5d0a 2020 2020 2020 2020 7465 6d70 7968  ].        tempyh
-00036480: 6561 6465 725b 315d 203d 206d 6170 6461  eader[1] = mapda
-00036490: 7461 2e73 6861 7065 5b31 5d0a 2020 2020  ta.shape[1].    
-000364a0: 2020 2020 7465 6d70 7968 6561 6465 725b      tempyheader[
-000364b0: 325d 203d 206d 6170 6461 7461 2e73 6861  2] = mapdata.sha
-000364c0: 7065 5b30 5d0a 2020 2020 2020 2020 7465  pe[0].        te
-000364d0: 6d70 7968 6561 6465 725b 335d 203d 206d  mpyheader[3] = m
-000364e0: 7263 6865 6164 6572 2e6d 6f64 652e 6974  rcheader.mode.it
-000364f0: 656d 2830 290a 2020 2020 2020 2020 7465  em(0).        te
-00036500: 6d70 7968 6561 6465 725b 345d 203d 206e  mpyheader[4] = n
-00036510: 7374 6172 7473 5b30 5d2e 6974 656d 2830  starts[0].item(0
-00036520: 290a 2020 2020 2020 2020 7465 6d70 7968  ).        tempyh
-00036530: 6561 6465 725b 355d 203d 206e 7374 6172  eader[5] = nstar
-00036540: 7473 5b31 5d2e 6974 656d 2830 290a 2020  ts[1].item(0).  
+00035d00: 2020 2020 6966 2027 6572 7227 206e 6f74      if 'err' not
+00035d10: 2069 6e20 636f 6e74 656e 742e 6b65 7973   in content.keys
+00035d20: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00035d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035d40: 6675 6c6c 6461 7461 5b73 7472 2869 295d  fulldata[str(i)]
+00035d50: 203d 206c 6973 7428 636f 6e74 656e 742e   = list(content.
+00035d60: 7661 6c75 6573 2829 295b 305d 0a20 2020  values())[0].   
+00035d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035d80: 2020 2020 2020 2020 2066 756c 6c64 6174           fulldat
+00035d90: 615b 7374 7228 6929 5d5b 276e 616d 6527  a[str(i)]['name'
+00035da0: 5d20 3d20 6d6f 6465 6c6e 616d 650a 2020  ] = modelname.  
+00035db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035dc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00035dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035de0: 2020 2020 2020 2020 6375 7265 7272 203d          curerr =
+00035df0: 2063 6f6e 7465 6e74 2e76 616c 7565 7328   content.values(
+00035e00: 295b 305d 5b27 6572 7227 5d0a 2020 2020  )[0]['err'].    
+00035e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035e20: 2020 2020 2020 2020 6675 6c6c 6461 7461          fulldata
+00035e30: 5b73 7472 2869 295d 5b27 6572 7227 5d20  [str(i)]['err'] 
+00035e40: 3d20 6375 7265 7272 0a0a 0a20 2020 2020  = curerr...     
+00035e50: 2020 206f 7574 7075 7420 3d20 277b 7d7b     output = '{}{
+00035e60: 7d5f 6d6d 6673 632e 6a73 6f6e 272e 666f  }_mmfsc.json'.fo
+00035e70: 726d 6174 2873 656c 662e 776f 726b 6469  rmat(self.workdi
+00035e80: 722c 2073 656c 662e 6d61 706e 616d 652c  r, self.mapname,
+00035e90: 2029 0a20 2020 2020 2020 2066 696e 616c   ).        final
+00035ea0: 6461 7461 203d 207b 7d0a 2020 2020 2020  data = {}.      
+00035eb0: 2020 6669 6e61 6c64 6174 615b 276d 6d66    finaldata['mmf
+00035ec0: 7363 275d 203d 2066 756c 6c64 6174 610a  sc'] = fulldata.
+00035ed0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+00035ee0: 6e28 6f75 7470 7574 2c20 2777 2729 2061  n(output, 'w') a
+00035ef0: 7320 6f75 743a 0a20 2020 2020 2020 2020  s out:.         
+00035f00: 2020 206a 736f 6e2e 6475 6d70 2866 696e     json.dump(fin
+00035f10: 616c 6461 7461 2c20 6f75 7429 0a0a 2020  aldata, out)..  
+00035f20: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00035f30: 650a 0a20 2020 2064 6566 2066 726f 6d6d  e..    def fromm
+00035f40: 7263 5f74 6f74 656d 7079 2873 656c 662c  rc_totempy(self,
+00035f50: 2066 756c 6c6d 6170 6e61 6d65 293a 0a20   fullmapname):. 
+00035f60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00035f70: 2020 2020 2020 2054 7261 6e73 6665 7220         Transfer 
+00035f80: 7468 6520 6d72 6366 696c 6520 6d61 7020  the mrcfile map 
+00035f90: 6f62 6a65 6374 2074 6f20 5445 4d50 7920  object to TEMPy 
+00035fa0: 6d61 7020 6f62 6a65 6374 0a0a 2020 2020  map object..    
+00035fb0: 2020 2020 3a70 6172 616d 2066 756c 6c6d      :param fullm
+00035fc0: 6170 6e61 6d65 3a0a 2020 2020 2020 2020  apname:.        
+00035fd0: 3a72 6574 7572 6e3a 2054 454d 5079 206d  :return: TEMPy m
+00035fe0: 6170 206f 626a 6563 740a 2020 2020 2020  ap object.      
+00035ff0: 2020 2222 220a 0a0a 2020 2020 2020 2020    """...        
+00036000: 6d72 636d 6170 203d 206d 7263 6669 6c65  mrcmap = mrcfile
+00036010: 2e6d 6d61 7028 6675 6c6c 6d61 706e 616d  .mmap(fullmapnam
+00036020: 652c 206d 6f64 653d 2772 2729 0a20 2020  e, mode='r').   
+00036030: 2020 2020 206d 7263 6865 6164 6572 203d       mrcheader =
+00036040: 206d 7263 6d61 702e 6865 6164 6572 0a20   mrcmap.header. 
+00036050: 2020 2020 2020 206d 6170 6461 7461 203d         mapdata =
+00036060: 206d 7263 6d61 702e 6461 7461 2e61 7374   mrcmap.data.ast
+00036070: 7970 6528 2766 6c6f 6174 2729 0a20 2020  ype('float').   
+00036080: 2020 2020 2063 7273 203d 2028 6d72 6368       crs = (mrch
+00036090: 6561 6465 722e 6d61 7063 2c20 6d72 6368  eader.mapc, mrch
+000360a0: 6561 6465 722e 6d61 7072 2c20 6d72 6368  eader.mapr, mrch
+000360b0: 6561 6465 722e 6d61 7073 290a 2020 2020  eader.maps).    
+000360c0: 2020 2020 7265 7665 7273 6563 7273 203d      reversecrs =
+000360d0: 2063 7273 5b3a 3a2d 315d 0a20 2020 2020   crs[::-1].     
+000360e0: 2020 206e 7374 6172 7473 203d 2028 6d72     nstarts = (mr
+000360f0: 6368 6561 6465 722e 6e78 7374 6172 742c  cheader.nxstart,
+00036100: 206d 7263 6865 6164 6572 2e6e 7973 7461   mrcheader.nysta
+00036110: 7274 2c20 6d72 6368 6561 6465 722e 6e7a  rt, mrcheader.nz
+00036120: 7374 6172 7429 0a20 2020 2020 2020 2073  start).        s
+00036130: 7464 6372 7320 3d20 2833 2c20 322c 2031  tdcrs = (3, 2, 1
+00036140: 290a 2020 2020 2020 2020 6469 6666 6372  ).        diffcr
+00036150: 7320 3d20 7475 706c 6528 782d 7920 666f  s = tuple(x-y fo
+00036160: 7220 782c 7920 696e 207a 6970 2872 6576  r x,y in zip(rev
+00036170: 6572 7365 6372 732c 2073 7464 6372 7329  ersecrs, stdcrs)
+00036180: 290a 2020 2020 2020 2020 6966 2064 6966  ).        if dif
+00036190: 6663 7273 2021 3d20 2830 2c20 302c 2030  fcrs != (0, 0, 0
+000361a0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+000361b0: 6620 3120 696e 2064 6966 6663 7273 2061  f 1 in diffcrs a
+000361c0: 6e64 202d 3120 696e 2064 6966 6663 7273  nd -1 in diffcrs
+000361d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000361e0: 2020 6d61 7064 6174 6120 3d20 6e70 2e73    mapdata = np.s
+000361f0: 7761 7061 7865 7328 6d61 7064 6174 612c  wapaxes(mapdata,
+00036200: 2064 6966 6663 7273 2e69 6e64 6578 282d   diffcrs.index(-
+00036210: 3129 2c20 6469 6666 6372 732e 696e 6465  1), diffcrs.inde
+00036220: 7828 3129 290a 2020 2020 2020 2020 2020  x(1)).          
+00036230: 2020 6966 202d 3220 696e 2064 6966 6663    if -2 in diffc
+00036240: 7273 2061 6e64 2032 2069 6e20 6469 6666  rs and 2 in diff
+00036250: 6372 733a 0a20 2020 2020 2020 2020 2020  crs:.           
+00036260: 2020 2020 206d 6170 6461 7461 203d 206e       mapdata = n
+00036270: 702e 7377 6170 6178 6573 286d 6170 6461  p.swapaxes(mapda
+00036280: 7461 2c20 6469 6666 6372 732e 696e 6465  ta, diffcrs.inde
+00036290: 7828 2d32 292c 2064 6966 6663 7273 2e69  x(-2), diffcrs.i
+000362a0: 6e64 6578 2832 2929 0a20 2020 2020 2020  ndex(2)).       
+000362b0: 2020 2020 2069 6620 3120 696e 2064 6966       if 1 in dif
+000362c0: 6663 7273 2061 6e64 202d 3220 696e 2064  fcrs and -2 in d
+000362d0: 6966 6663 7273 3a0a 2020 2020 2020 2020  iffcrs:.        
+000362e0: 2020 2020 2020 2020 6d61 7064 6174 6120          mapdata 
+000362f0: 3d20 6e70 2e73 7761 7061 7865 7328 6e70  = np.swapaxes(np
+00036300: 2e73 7761 7061 7865 7328 6d61 7064 6174  .swapaxes(mapdat
+00036310: 612c 2030 2c20 3129 2c20 312c 2032 290a  a, 0, 1), 1, 2).
+00036320: 2020 2020 2020 2020 2020 2020 6966 202d              if -
+00036330: 3120 696e 2064 6966 6663 7273 2061 6e64  1 in diffcrs and
+00036340: 2032 2069 6e20 6469 6666 6372 733a 0a20   2 in diffcrs:. 
+00036350: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00036360: 6170 6461 7461 203d 206e 702e 7377 6170  apdata = np.swap
+00036370: 6178 6573 286e 702e 7377 6170 6178 6573  axes(np.swapaxes
+00036380: 286d 6170 6461 7461 2c20 312c 2032 292c  (mapdata, 1, 2),
+00036390: 2030 2c20 3129 0a20 2020 2020 2020 2020   0, 1).         
+000363a0: 2020 2023 206d 6170 6461 7461 203d 206e     # mapdata = n
+000363b0: 702e 7377 6170 6178 6573 286d 6170 6461  p.swapaxes(mapda
+000363c0: 7461 2c20 302c 2032 290a 0a20 2020 2020  ta, 0, 2)..     
+000363d0: 2020 2023 206d 6170 6461 7461 203d 206e     # mapdata = n
+000363e0: 702e 7377 6170 6178 6573 286e 702e 7377  p.swapaxes(np.sw
+000363f0: 6170 6178 6573 286d 6170 6461 7461 2c20  apaxes(mapdata, 
+00036400: 302c 2032 292c 2031 2c20 3229 0a20 2020  0, 2), 1, 2).   
+00036410: 2020 2020 2074 656d 7079 6865 6164 6572       tempyheader
+00036420: 203d 204d 6170 5061 7273 6572 2e72 6561   = MapParser.rea
+00036430: 644d 5243 4865 6164 6572 2866 756c 6c6d  dMRCHeader(fullm
+00036440: 6170 6e61 6d65 290a 0a20 2020 2020 2020  apname)..       
+00036450: 2023 206e 782c 206e 792c 206e 7a20 616e   # nx, ny, nz an
+00036460: 6420 6e78 7374 6172 742c 206e 7973 7461  d nxstart, nysta
+00036470: 7274 2c20 6e7a 7374 6172 7420 6861 7665  rt, nzstart have
+00036480: 7220 746f 2062 6520 6368 616e 6765 6420  r to be changed 
+00036490: 6163 636f 7264 696e 676c 7920 746f 2074  accordingly to t
+000364a0: 6865 2064 6174 610a 2020 2020 2020 2020  he data.        
+000364b0: 7465 6d70 7968 6561 6465 7220 3d20 6c69  tempyheader = li
+000364c0: 7374 2874 656d 7079 6865 6164 6572 290a  st(tempyheader).
+000364d0: 2020 2020 2020 2020 7465 6d70 7968 6561          tempyhea
+000364e0: 6465 725b 305d 203d 206d 6170 6461 7461  der[0] = mapdata
+000364f0: 2e73 6861 7065 5b32 5d0a 2020 2020 2020  .shape[2].      
+00036500: 2020 7465 6d70 7968 6561 6465 725b 315d    tempyheader[1]
+00036510: 203d 206d 6170 6461 7461 2e73 6861 7065   = mapdata.shape
+00036520: 5b31 5d0a 2020 2020 2020 2020 7465 6d70  [1].        temp
+00036530: 7968 6561 6465 725b 325d 203d 206d 6170  yheader[2] = map
+00036540: 6461 7461 2e73 6861 7065 5b30 5d0a 2020  data.shape[0].  
 00036550: 2020 2020 2020 7465 6d70 7968 6561 6465        tempyheade
-00036560: 725b 365d 203d 206e 7374 6172 7473 5b32  r[6] = nstarts[2
-00036570: 5d2e 6974 656d 2830 290a 2020 2020 2020  ].item(0).      
-00036580: 2020 7465 6d70 7968 6561 6465 725b 375d    tempyheader[7]
-00036590: 203d 206d 7263 6865 6164 6572 2e6d 782e   = mrcheader.mx.
-000365a0: 6974 656d 2830 290a 2020 2020 2020 2020  item(0).        
-000365b0: 7465 6d70 7968 6561 6465 725b 385d 203d  tempyheader[8] =
-000365c0: 206d 7263 6865 6164 6572 2e6d 792e 6974   mrcheader.my.it
+00036560: 725b 335d 203d 206d 7263 6865 6164 6572  r[3] = mrcheader
+00036570: 2e6d 6f64 652e 6974 656d 2830 290a 2020  .mode.item(0).  
+00036580: 2020 2020 2020 7465 6d70 7968 6561 6465        tempyheade
+00036590: 725b 345d 203d 206e 7374 6172 7473 5b30  r[4] = nstarts[0
+000365a0: 5d2e 6974 656d 2830 290a 2020 2020 2020  ].item(0).      
+000365b0: 2020 7465 6d70 7968 6561 6465 725b 355d    tempyheader[5]
+000365c0: 203d 206e 7374 6172 7473 5b31 5d2e 6974   = nstarts[1].it
 000365d0: 656d 2830 290a 2020 2020 2020 2020 7465  em(0).        te
-000365e0: 6d70 7968 6561 6465 725b 395d 203d 206d  mpyheader[9] = m
-000365f0: 7263 6865 6164 6572 2e6d 7a2e 6974 656d  rcheader.mz.item
-00036600: 2830 290a 2020 2020 2020 2020 7465 6d70  (0).        temp
-00036610: 7968 6561 6465 725b 3130 5d20 3d20 6d72  yheader[10] = mr
-00036620: 6368 6561 6465 722e 6365 6c6c 612e 782e  cheader.cella.x.
-00036630: 6974 656d 2830 290a 2020 2020 2020 2020  item(0).        
-00036640: 7465 6d70 7968 6561 6465 725b 3131 5d20  tempyheader[11] 
-00036650: 3d20 6d72 6368 6561 6465 722e 6365 6c6c  = mrcheader.cell
-00036660: 612e 792e 6974 656d 2830 290a 2020 2020  a.y.item(0).    
-00036670: 2020 2020 7465 6d70 7968 6561 6465 725b      tempyheader[
-00036680: 3132 5d20 3d20 6d72 6368 6561 6465 722e  12] = mrcheader.
-00036690: 6365 6c6c 612e 7a2e 6974 656d 2830 290a  cella.z.item(0).
-000366a0: 2020 2020 2020 2020 7465 6d70 7968 6561          tempyhea
-000366b0: 6465 725b 3133 3a31 365d 203d 206d 7263  der[13:16] = mrc
-000366c0: 6865 6164 6572 2e63 656c 6c62 2e74 6f6c  header.cellb.tol
-000366d0: 6973 7428 290a 2020 2020 2020 2020 7465  ist().        te
-000366e0: 6d70 7968 6561 6465 725b 3136 5d20 3d20  mpyheader[16] = 
-000366f0: 6372 735b 305d 2e69 7465 6d28 3029 0a20  crs[0].item(0). 
-00036700: 2020 2020 2020 2074 656d 7079 6865 6164         tempyhead
-00036710: 6572 5b31 375d 203d 2063 7273 5b31 5d2e  er[17] = crs[1].
+000365e0: 6d70 7968 6561 6465 725b 365d 203d 206e  mpyheader[6] = n
+000365f0: 7374 6172 7473 5b32 5d2e 6974 656d 2830  starts[2].item(0
+00036600: 290a 2020 2020 2020 2020 7465 6d70 7968  ).        tempyh
+00036610: 6561 6465 725b 375d 203d 206d 7263 6865  eader[7] = mrche
+00036620: 6164 6572 2e6d 782e 6974 656d 2830 290a  ader.mx.item(0).
+00036630: 2020 2020 2020 2020 7465 6d70 7968 6561          tempyhea
+00036640: 6465 725b 385d 203d 206d 7263 6865 6164  der[8] = mrchead
+00036650: 6572 2e6d 792e 6974 656d 2830 290a 2020  er.my.item(0).  
+00036660: 2020 2020 2020 7465 6d70 7968 6561 6465        tempyheade
+00036670: 725b 395d 203d 206d 7263 6865 6164 6572  r[9] = mrcheader
+00036680: 2e6d 7a2e 6974 656d 2830 290a 2020 2020  .mz.item(0).    
+00036690: 2020 2020 7465 6d70 7968 6561 6465 725b      tempyheader[
+000366a0: 3130 5d20 3d20 6d72 6368 6561 6465 722e  10] = mrcheader.
+000366b0: 6365 6c6c 612e 782e 6974 656d 2830 290a  cella.x.item(0).
+000366c0: 2020 2020 2020 2020 7465 6d70 7968 6561          tempyhea
+000366d0: 6465 725b 3131 5d20 3d20 6d72 6368 6561  der[11] = mrchea
+000366e0: 6465 722e 6365 6c6c 612e 792e 6974 656d  der.cella.y.item
+000366f0: 2830 290a 2020 2020 2020 2020 7465 6d70  (0).        temp
+00036700: 7968 6561 6465 725b 3132 5d20 3d20 6d72  yheader[12] = mr
+00036710: 6368 6561 6465 722e 6365 6c6c 612e 7a2e  cheader.cella.z.
 00036720: 6974 656d 2830 290a 2020 2020 2020 2020  item(0).        
-00036730: 7465 6d70 7968 6561 6465 725b 3138 5d20  tempyheader[18] 
-00036740: 3d20 6372 735b 325d 2e69 7465 6d28 3029  = crs[2].item(0)
-00036750: 0a20 2020 2020 2020 2074 656d 7079 6865  .        tempyhe
-00036760: 6164 6572 5b31 395d 203d 206d 7263 6865  ader[19] = mrche
-00036770: 6164 6572 2e64 6d69 6e2e 6974 656d 2830  ader.dmin.item(0
-00036780: 290a 2020 2020 2020 2020 7465 6d70 7968  ).        tempyh
-00036790: 6561 6465 725b 3230 5d20 3d20 6d72 6368  eader[20] = mrch
-000367a0: 6561 6465 722e 646d 6178 2e69 7465 6d28  eader.dmax.item(
-000367b0: 3029 0a20 2020 2020 2020 2074 656d 7079  0).        tempy
-000367c0: 6865 6164 6572 5b32 315d 203d 206d 7263  header[21] = mrc
-000367d0: 6865 6164 6572 2e64 6d65 616e 2e69 7465  header.dmean.ite
-000367e0: 6d28 3029 0a20 2020 2020 2020 2074 656d  m(0).        tem
-000367f0: 7079 6865 6164 6572 5b32 325d 203d 206d  pyheader[22] = m
-00036800: 7263 6865 6164 6572 2e69 7370 672e 6974  rcheader.ispg.it
-00036810: 656d 2830 290a 2020 2020 2020 2020 7465  em(0).        te
-00036820: 6d70 7968 6561 6465 725b 3233 5d20 3d20  mpyheader[23] = 
-00036830: 6d72 6368 6561 6465 722e 6e73 796d 6274  mrcheader.nsymbt
-00036840: 2e69 7465 6d28 3029 0a0a 2020 2020 2020  .item(0)..      
-00036850: 2020 7465 6d70 7968 6561 6465 725b 3439    tempyheader[49
-00036860: 5d20 3d20 6d72 6368 6561 6465 722e 6f72  ] = mrcheader.or
-00036870: 6967 696e 2e78 2e69 7465 6d28 3029 0a20  igin.x.item(0). 
-00036880: 2020 2020 2020 2074 656d 7079 6865 6164         tempyhead
-00036890: 6572 5b35 305d 203d 206d 7263 6865 6164  er[50] = mrchead
-000368a0: 6572 2e6f 7269 6769 6e2e 792e 6974 656d  er.origin.y.item
-000368b0: 2830 290a 2020 2020 2020 2020 7465 6d70  (0).        temp
-000368c0: 7968 6561 6465 725b 3531 5d20 3d20 6d72  yheader[51] = mr
-000368d0: 6368 6561 6465 722e 6f72 6967 696e 2e7a  cheader.origin.z
-000368e0: 2e69 7465 6d28 3029 0a20 2020 2020 2020  .item(0).       
-000368f0: 2074 656d 7079 6865 6164 6572 5b35 323a   tempyheader[52:
-00036900: 3535 5d20 3d20 5b27 4d27 2c20 2741 272c  55] = ['M', 'A',
-00036910: 2027 5027 5d0a 0a20 2020 2020 2020 2074   'P']..        t
-00036920: 656d 7079 6865 6164 6572 5b35 365d 203d  empyheader[56] =
-00036930: 206d 7263 6865 6164 6572 2e6d 6163 6873   mrcheader.machs
-00036940: 740a 2020 2020 2020 2020 7465 6d70 7968  t.        tempyh
-00036950: 6561 6465 725b 3537 5d20 3d20 6d72 6368  eader[57] = mrch
-00036960: 6561 6465 722e 726d 732e 6974 656d 2830  eader.rms.item(0
-00036970: 290a 2020 2020 2020 2020 7465 6d70 7968  ).        tempyh
-00036980: 6561 6465 7220 3d20 7475 706c 6528 7465  eader = tuple(te
-00036990: 6d70 7968 6561 6465 7229 0a20 2020 2020  mpyheader).     
-000369a0: 2020 206f 7269 6769 6e20 3d20 2866 6c6f     origin = (flo
-000369b0: 6174 286d 7263 6865 6164 6572 2e6f 7269  at(mrcheader.ori
-000369c0: 6769 6e2e 7829 2c20 666c 6f61 7428 6d72  gin.x), float(mr
-000369d0: 6368 6561 6465 722e 6f72 6967 696e 2e79  cheader.origin.y
-000369e0: 292c 2066 6c6f 6174 286d 7263 6865 6164  ), float(mrchead
-000369f0: 6572 2e6f 7269 6769 6e2e 7a29 290a 2020  er.origin.z)).  
-00036a00: 2020 2020 2020 6170 6978 203d 2028 6d72        apix = (mr
-00036a10: 6368 6561 6465 722e 6365 6c6c 612e 782f  cheader.cella.x/
-00036a20: 6d72 6368 6561 6465 722e 6d78 2c20 6d72  mrcheader.mx, mr
-00036a30: 6368 6561 6465 722e 6365 6c6c 612e 792f  cheader.cella.y/
-00036a40: 6d72 6368 6561 6465 722e 6d79 2c20 6d72  mrcheader.my, mr
-00036a50: 6368 6561 6465 722e 6365 6c6c 612e 7a2f  cheader.cella.z/
-00036a60: 6d72 6368 6561 6465 722e 6d7a 295b 305d  mrcheader.mz)[0]
-00036a70: 0a0a 2020 2020 2020 2020 6669 6e61 6c6d  ..        finalm
-00036a80: 6170 203d 204d 6170 286d 6170 6461 7461  ap = Map(mapdata
-00036a90: 2c20 6f72 6967 696e 2c20 6170 6978 2c20  , origin, apix, 
-00036aa0: 6675 6c6c 6d61 706e 616d 652c 2068 6561  fullmapname, hea
-00036ab0: 6465 723d 7465 6d70 7968 6561 6465 7229  der=tempyheader)
-00036ac0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00036ad0: 2066 696e 616c 6d61 700a 0a0a 2020 2020   finalmap...    
-00036ae0: 6465 6620 6673 635f 7265 6c69 6f6e 2873  def fsc_relion(s
-00036af0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00036b00: 220a 2020 2020 2020 2020 5573 696e 6720  ".        Using 
-00036b10: 5265 6c69 6f6e 2074 6f20 6361 6c63 756c  Relion to calcul
-00036b20: 6174 6520 6673 630a 2020 2020 2020 2020  ate fsc.        
-00036b30: 2222 220a 0a20 2020 2020 2020 2074 7279  """..        try
-00036b40: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-00036b50: 6172 5f66 696c 6520 3d20 7265 6c69 6f6e  ar_file = relion
-00036b60: 5f66 7363 5f63 616c 6375 6c61 7469 6f6e  _fsc_calculation
-00036b70: 2873 656c 662e 686d 6f64 642e 6675 6c6c  (self.hmodd.full
-00036b80: 6e61 6d65 2c20 7365 6c66 2e68 6d65 7665  name, self.hmeve
-00036b90: 6e2e 6675 6c6c 6e61 6d65 2c20 7365 6c66  n.fullname, self
-00036ba0: 2e77 6f72 6b64 6972 2c20 7365 6c66 2e6d  .workdir, self.m
-00036bb0: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
-00036bc0: 2020 2020 2320 7374 6172 5f66 696c 6520      # star_file 
-00036bd0: 3d20 272f 5573 6572 732f 7a68 652f 446f  = '/Users/zhe/Do
-00036be0: 776e 6c6f 6164 732f 7465 7374 732f 5641  wnloads/tests/VA
-00036bf0: 2f6e 6673 2f6d 7364 2f77 6f72 6b32 2f65  /nfs/msd/work2/e
-00036c00: 6d64 622f 6465 7665 6c6f 706d 656e 742f  mdb/development/
-00036c10: 7374 6167 696e 672f 656d 2f38 312f 3831  staging/em/81/81
-00036c20: 3137 2f76 612f 656d 645f 3831 3137 2e6d  17/va/emd_8117.m
-00036c30: 6170 5f72 656c 696f 6e2f 6673 632f 6673  ap_relion/fsc/fs
-00036c40: 632e 7374 6172 270a 2020 2020 2020 2020  c.star'.        
-00036c50: 2020 2020 7374 6172 203d 2047 6574 5374      star = GetSt
-00036c60: 6172 7328 7374 6172 5f66 696c 6529 0a20  ars(star_file). 
-00036c70: 2020 2020 2020 2020 2020 2069 6e69 7469             initi
-00036c80: 616c 5f66 7363 5f62 6c6f 636b 203d 2073  al_fsc_block = s
-00036c90: 7461 722e 6461 7461 5f66 7363 5f62 6c6f  tar.data_fsc_blo
-00036ca0: 636b 2829 0a20 2020 2020 2020 2020 2020  ck().           
-00036cb0: 2064 6174 615f 6673 635f 626c 6f63 6b20   data_fsc_block 
-00036cc0: 3d20 7374 6172 2e64 6174 615f 6578 7472  = star.data_extr
-00036cd0: 6128 696e 6974 6961 6c5f 6673 635f 626c  a(initial_fsc_bl
-00036ce0: 6f63 6b29 0a20 2020 2020 2020 2020 2020  ock).           
-00036cf0: 2064 6174 615f 6375 7276 6573 203d 2073   data_curves = s
-00036d00: 7461 722e 616c 6c5f 6375 7276 6573 2864  tar.all_curves(d
-00036d10: 6174 615f 6673 635f 626c 6f63 6b29 0a20  ata_fsc_block). 
-00036d20: 2020 2020 2020 2020 2020 2064 6174 615f             data_
-00036d30: 696e 7465 7273 6563 7469 6f6e 7320 3d20  intersections = 
-00036d40: 7374 6172 2e61 6c6c 5f69 6e74 6572 7365  star.all_interse
-00036d50: 6374 696f 6e28 6461 7461 5f66 7363 5f62  ction(data_fsc_b
-00036d60: 6c6f 636b 290a 0a20 2020 2020 2020 2020  lock)..         
-00036d70: 2020 2066 7363 5f64 6963 7420 3d20 7b2a     fsc_dict = {*
-00036d80: 2a64 6174 615f 6375 7276 6573 2c20 2a2a  *data_curves, **
-00036d90: 6461 7461 5f69 6e74 6572 7365 6374 696f  data_intersectio
-00036da0: 6e73 7d0a 2020 2020 2020 2020 2020 2020  ns}.            
-00036db0: 6f75 745f 6469 6374 203d 207b 7d0a 2020  out_dict = {}.  
-00036dc0: 2020 2020 2020 2020 2020 6f75 745f 6469            out_di
-00036dd0: 6374 5b27 7265 6c69 6f6e 5f66 7363 275d  ct['relion_fsc']
-00036de0: 203d 2066 7363 5f64 6963 740a 2020 2020   = fsc_dict.    
-00036df0: 2020 2020 2020 2020 6f75 745f 6673 635f          out_fsc_
-00036e00: 6a73 6f6e 203d 2066 277b 7365 6c66 2e77  json = f'{self.w
-00036e10: 6f72 6b64 6972 7d7b 7365 6c66 2e6d 6170  orkdir}{self.map
-00036e20: 6e61 6d65 7d5f 6673 635f 7265 6c69 6f6e  name}_fsc_relion
-00036e30: 2e6a 736f 6e27 0a20 2020 2020 2020 2020  .json'.         
-00036e40: 2020 206f 7574 5f6a 736f 6e28 6f75 745f     out_json(out_
-00036e50: 6469 6374 2c20 6f75 745f 6673 635f 6a73  dict, out_fsc_js
-00036e60: 6f6e 290a 2020 2020 2020 2020 6578 6365  on).        exce
-00036e70: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-00036e80: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00036e90: 7269 6e74 2865 290a 0a0a 0a20 2020 2023  rint(e)....    #
-00036ea0: 2040 7072 6f66 696c 650a 2020 2020 6465   @profile.    de
-00036eb0: 6620 6673 6373 2873 656c 6629 3a0a 2020  f fscs(self):.  
-00036ec0: 2020 2020 2020 2222 220a 0a0a 0a20 2020        """....   
-00036ed0: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
-00036ee0: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-00036ef0: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
-00036f00: 6d65 7665 6e20 6973 206e 6f74 204e 6f6e  meven is not Non
-00036f10: 6520 616e 6420 7365 6c66 2e68 6d6f 6464  e and self.hmodd
-00036f20: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00036f30: 2020 2020 2020 2020 2020 7374 6172 7466            startf
-00036f40: 7363 203d 2074 696d 6569 742e 6465 6661  sc = timeit.defa
-00036f50: 756c 745f 7469 6d65 7228 290a 2020 2020  ult_timer().    
-00036f60: 2020 2020 2020 2020 2320 7365 6c66 2e66          # self.f
-00036f70: 7363 2873 656c 662e 686d 6576 656e 2c20  sc(self.hmeven, 
-00036f80: 7365 6c66 2e68 6d6f 6464 290a 2020 2020  self.hmodd).    
-00036f90: 2020 2020 2020 2020 7365 6c66 2e66 7363          self.fsc
-00036fa0: 5f72 656c 696f 6e28 290a 2020 2020 2020  _relion().      
-00036fb0: 2020 2020 2020 7365 6c66 2e6e 6577 5f66        self.new_f
-00036fc0: 7363 2873 656c 662e 686d 6576 656e 2c20  sc(self.hmeven, 
-00036fd0: 7365 6c66 2e68 6d6f 6464 290a 2020 2020  self.hmodd).    
-00036fe0: 2020 2020 2020 2020 7374 6f70 203d 2074          stop = t
-00036ff0: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
-00037000: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
-00037010: 2020 7072 696e 7428 2746 5343 3a20 2573    print('FSC: %s
-00037020: 2720 2520 2873 746f 7020 2d20 7374 6172  ' % (stop - star
-00037030: 7466 7363 2929 0a20 2020 2020 2020 2020  tfsc)).         
-00037040: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
-00037050: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00037060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-00037070: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00037080: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00037090: 2827 4d69 7369 6e67 2068 616c 6620 6d61  ('Mising half ma
-000370a0: 7028 7329 2e27 290a 0a20 2020 2020 2020  p(s).')..       
-000370b0: 2066 7363 786d 6c72 6520 3d20 272a 5f66   fscxmlre = '*_f
-000370c0: 7363 2e78 6d6c 270a 2020 2020 2020 2020  sc.xml'.        
-000370d0: 6673 6378 6d6c 6172 7220 3d20 676c 6f62  fscxmlarr = glob
-000370e0: 2e67 6c6f 6228 7365 6c66 2e77 6f72 6b64  .glob(self.workd
-000370f0: 6972 202b 2066 7363 786d 6c72 6529 0a20  ir + fscxmlre). 
-00037100: 2020 2020 2020 2069 6620 6673 6378 6d6c         if fscxml
-00037110: 6172 7220 6f72 2073 656c 662e 6673 6366  arr or self.fscf
-00037120: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00037130: 2073 7461 7274 6673 6320 3d20 7469 6d65   startfsc = time
-00037140: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
-00037150: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00037160: 656c 662e 7265 6164 6673 6328 290a 2020  elf.readfsc().  
-00037170: 2020 2020 2020 2020 2020 7374 6f70 203d            stop =
-00037180: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-00037190: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
-000371a0: 2020 2020 7072 696e 7428 274c 6f61 6420      print('Load 
-000371b0: 4653 433a 2025 7327 2025 2028 7374 6f70  FSC: %s' % (stop
-000371c0: 202d 2073 7461 7274 6673 6329 290a 2020   - startfsc)).  
-000371d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000371e0: 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '---------------
-000371f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00037200: 2d2d 2d2d 2d27 290a 2020 2020 2020 2020  -----').        
-00037210: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00037220: 2020 7072 696e 7428 274e 6f20 6769 7665    print('No give
-00037230: 6e20 4653 4320 6461 7461 2074 6f20 6265  n FSC data to be
-00037240: 206c 6f61 6465 642e 2729 0a0a 2020 2020   loaded.')..    
-00037250: 6465 6620 7265 6164 6673 6328 7365 6c66  def readfsc(self
-00037260: 2c20 6173 796d 3d31 2e30 293a 0a20 2020  , asym=1.0):.   
-00037270: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00037280: 2020 3a72 6574 7572 6e3a 0a20 2020 2020    :return:.     
-00037290: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000372a0: 6d70 6f72 7420 786d 6c2e 6574 7265 652e  mport xml.etree.
-000372b0: 456c 656d 656e 7454 7265 6520 6173 2045  ElementTree as E
-000372c0: 540a 0a20 2020 2020 2020 2065 7272 6c69  T..        errli
-000372d0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-000372e0: 6669 6e61 6c64 6963 7420 3d20 6469 6374  finaldict = dict
-000372f0: 2829 0a0a 2020 2020 2020 2020 6966 2073  ()..        if s
-00037300: 656c 662e 6673 6366 696c 6520 6973 206e  elf.fscfile is n
-00037310: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00037320: 2020 2020 2078 6c69 7374 203d 205b 5d0a       xlist = [].
-00037330: 2020 2020 2020 2020 2020 2020 796c 6973              ylis
-00037340: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-00037350: 2020 206d 6170 5f7a 7369 7a65 203d 2073     map_zsize = s
-00037360: 656c 662e 6d61 702e 6865 6164 6572 2e6e  elf.map.header.n
-00037370: 7a0a 2020 2020 2020 2020 2020 2020 6d61  z.            ma
-00037380: 705f 7973 697a 6520 3d20 7365 6c66 2e6d  p_ysize = self.m
-00037390: 6170 2e68 6561 6465 722e 6e79 0a20 2020  ap.header.ny.   
-000373a0: 2020 2020 2020 2020 206d 6170 5f78 7369           map_xsi
-000373b0: 7a65 203d 2073 656c 662e 6d61 702e 6865  ze = self.map.he
-000373c0: 6164 6572 2e6e 780a 2020 2020 2020 2020  ader.nx.        
-000373d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000373e0: 2020 2020 2020 2020 2066 696c 6566 7363           filefsc
-000373f0: 203d 2073 656c 662e 776f 726b 6469 7220   = self.workdir 
-00037400: 2b20 7365 6c66 2e66 7363 6669 6c65 0a20  + self.fscfile. 
-00037410: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00037420: 7265 6520 3d20 4554 2e70 6172 7365 2866  ree = ET.parse(f
-00037430: 696c 6566 7363 290a 2020 2020 2020 2020  ilefsc).        
-00037440: 2020 2020 2020 2020 726f 6f74 203d 2074          root = t
-00037450: 7265 652e 6765 7472 6f6f 7428 290a 2020  ree.getroot().  
-00037460: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00037470: 7220 6368 696c 6420 696e 2072 6f6f 743a  r child in root:
-00037480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037490: 2020 2020 2078 203d 2066 6c6f 6174 2863       x = float(c
-000374a0: 6869 6c64 2e66 696e 6428 2778 2729 2e74  hild.find('x').t
-000374b0: 6578 7429 0a20 2020 2020 2020 2020 2020  ext).           
-000374c0: 2020 2020 2020 2020 2079 203d 2066 6c6f           y = flo
-000374d0: 6174 2863 6869 6c64 2e66 696e 6428 2779  at(child.find('y
-000374e0: 2729 2e74 6578 7429 0a20 2020 2020 2020  ').text).       
-000374f0: 2020 2020 2020 2020 2020 2020 2078 6c69               xli
-00037500: 7374 2e61 7070 656e 6428 7829 0a20 2020  st.append(x).   
-00037510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037520: 2079 6c69 7374 2e61 7070 656e 6428 7929   ylist.append(y)
-00037530: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00037540: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00037550: 2020 2020 2065 7272 203d 2027 5265 6164       err = 'Read
-00037560: 2046 5343 2066 726f 6d20 584d 4c20 6572   FSC from XML er
-00037570: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
-00037580: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-00037590: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-000375a0: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
-000375b0: 6e64 2865 7272 290a 2020 2020 2020 2020  nd(err).        
-000375c0: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
-000375d0: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
-000375e0: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
-000375f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00037600: 2020 2020 2020 2023 2047 7269 6420 6865         # Grid he
-00037610: 7265 2074 6f20 6765 6e65 7261 7465 2066  re to generate f
-00037620: 6f72 2074 7261 6369 6e67 2074 6865 2069  or tracing the i
-00037630: 6e64 6963 6573 206f 6620 6772 6964 7320  ndices of grids 
-00037640: 7769 7468 2069 6e20 7468 6520 7368 656c  with in the shel
-00037650: 6c73 2e0a 2020 2020 2020 2020 2020 2020  ls..            
-00037660: 2020 2020 7a67 7269 6420 3d20 6e70 2e61      zgrid = np.a
-00037670: 7261 6e67 6528 666c 6f6f 7228 6d61 705f  range(floor(map_
-00037680: 7a73 697a 6520 2f20 322e 3029 202a 202d  zsize / 2.0) * -
-00037690: 312c 2063 6569 6c28 6d61 705f 7a73 697a  1, ceil(map_zsiz
-000376a0: 6520 2f20 322e 3029 2920 2f20 666c 6f61  e / 2.0)) / floa
-000376b0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000376c0: 2020 2020 2020 2066 6c6f 6f72 286d 6170         floor(map
-000376d0: 5f7a 7369 7a65 2929 0a20 2020 2020 2020  _zsize)).       
-000376e0: 2020 2020 2020 2020 2079 6772 6964 203d           ygrid =
-000376f0: 206e 702e 6172 616e 6765 2866 6c6f 6f72   np.arange(floor
-00037700: 286d 6170 5f79 7369 7a65 202f 2032 2e30  (map_ysize / 2.0
-00037710: 2920 2a20 2d31 2c20 6365 696c 286d 6170  ) * -1, ceil(map
-00037720: 5f79 7369 7a65 202f 2032 2e30 2929 202f  _ysize / 2.0)) /
-00037730: 2066 6c6f 6174 280a 2020 2020 2020 2020   float(.        
-00037740: 2020 2020 2020 2020 2020 2020 666c 6f6f              floo
-00037750: 7228 6d61 705f 7973 697a 6529 290a 2020  r(map_ysize)).  
-00037760: 2020 2020 2020 2020 2020 2020 2020 7867                xg
-00037770: 7269 6420 3d20 6e70 2e61 7261 6e67 6528  rid = np.arange(
-00037780: 666c 6f6f 7228 6d61 705f 7873 697a 6520  floor(map_xsize 
-00037790: 2f20 322e 3029 202a 202d 312c 2063 6569  / 2.0) * -1, cei
-000377a0: 6c28 6d61 705f 7873 697a 6520 2f20 322e  l(map_xsize / 2.
-000377b0: 3029 2920 2f20 666c 6f61 7428 0a20 2020  0)) / float(.   
+00036730: 7465 6d70 7968 6561 6465 725b 3133 3a31  tempyheader[13:1
+00036740: 365d 203d 206d 7263 6865 6164 6572 2e63  6] = mrcheader.c
+00036750: 656c 6c62 2e74 6f6c 6973 7428 290a 2020  ellb.tolist().  
+00036760: 2020 2020 2020 7465 6d70 7968 6561 6465        tempyheade
+00036770: 725b 3136 5d20 3d20 6372 735b 305d 2e69  r[16] = crs[0].i
+00036780: 7465 6d28 3029 0a20 2020 2020 2020 2074  tem(0).        t
+00036790: 656d 7079 6865 6164 6572 5b31 375d 203d  empyheader[17] =
+000367a0: 2063 7273 5b31 5d2e 6974 656d 2830 290a   crs[1].item(0).
+000367b0: 2020 2020 2020 2020 7465 6d70 7968 6561          tempyhea
+000367c0: 6465 725b 3138 5d20 3d20 6372 735b 325d  der[18] = crs[2]
+000367d0: 2e69 7465 6d28 3029 0a20 2020 2020 2020  .item(0).       
+000367e0: 2074 656d 7079 6865 6164 6572 5b31 395d   tempyheader[19]
+000367f0: 203d 206d 7263 6865 6164 6572 2e64 6d69   = mrcheader.dmi
+00036800: 6e2e 6974 656d 2830 290a 2020 2020 2020  n.item(0).      
+00036810: 2020 7465 6d70 7968 6561 6465 725b 3230    tempyheader[20
+00036820: 5d20 3d20 6d72 6368 6561 6465 722e 646d  ] = mrcheader.dm
+00036830: 6178 2e69 7465 6d28 3029 0a20 2020 2020  ax.item(0).     
+00036840: 2020 2074 656d 7079 6865 6164 6572 5b32     tempyheader[2
+00036850: 315d 203d 206d 7263 6865 6164 6572 2e64  1] = mrcheader.d
+00036860: 6d65 616e 2e69 7465 6d28 3029 0a20 2020  mean.item(0).   
+00036870: 2020 2020 2074 656d 7079 6865 6164 6572       tempyheader
+00036880: 5b32 325d 203d 206d 7263 6865 6164 6572  [22] = mrcheader
+00036890: 2e69 7370 672e 6974 656d 2830 290a 2020  .ispg.item(0).  
+000368a0: 2020 2020 2020 7465 6d70 7968 6561 6465        tempyheade
+000368b0: 725b 3233 5d20 3d20 6d72 6368 6561 6465  r[23] = mrcheade
+000368c0: 722e 6e73 796d 6274 2e69 7465 6d28 3029  r.nsymbt.item(0)
+000368d0: 0a0a 2020 2020 2020 2020 7465 6d70 7968  ..        tempyh
+000368e0: 6561 6465 725b 3439 5d20 3d20 6d72 6368  eader[49] = mrch
+000368f0: 6561 6465 722e 6f72 6967 696e 2e78 2e69  eader.origin.x.i
+00036900: 7465 6d28 3029 0a20 2020 2020 2020 2074  tem(0).        t
+00036910: 656d 7079 6865 6164 6572 5b35 305d 203d  empyheader[50] =
+00036920: 206d 7263 6865 6164 6572 2e6f 7269 6769   mrcheader.origi
+00036930: 6e2e 792e 6974 656d 2830 290a 2020 2020  n.y.item(0).    
+00036940: 2020 2020 7465 6d70 7968 6561 6465 725b      tempyheader[
+00036950: 3531 5d20 3d20 6d72 6368 6561 6465 722e  51] = mrcheader.
+00036960: 6f72 6967 696e 2e7a 2e69 7465 6d28 3029  origin.z.item(0)
+00036970: 0a20 2020 2020 2020 2074 656d 7079 6865  .        tempyhe
+00036980: 6164 6572 5b35 323a 3535 5d20 3d20 5b27  ader[52:55] = ['
+00036990: 4d27 2c20 2741 272c 2027 5027 5d0a 0a20  M', 'A', 'P'].. 
+000369a0: 2020 2020 2020 2074 656d 7079 6865 6164         tempyhead
+000369b0: 6572 5b35 365d 203d 206d 7263 6865 6164  er[56] = mrchead
+000369c0: 6572 2e6d 6163 6873 740a 2020 2020 2020  er.machst.      
+000369d0: 2020 7465 6d70 7968 6561 6465 725b 3537    tempyheader[57
+000369e0: 5d20 3d20 6d72 6368 6561 6465 722e 726d  ] = mrcheader.rm
+000369f0: 732e 6974 656d 2830 290a 2020 2020 2020  s.item(0).      
+00036a00: 2020 7465 6d70 7968 6561 6465 7220 3d20    tempyheader = 
+00036a10: 7475 706c 6528 7465 6d70 7968 6561 6465  tuple(tempyheade
+00036a20: 7229 0a20 2020 2020 2020 206f 7269 6769  r).        origi
+00036a30: 6e20 3d20 2866 6c6f 6174 286d 7263 6865  n = (float(mrche
+00036a40: 6164 6572 2e6f 7269 6769 6e2e 7829 2c20  ader.origin.x), 
+00036a50: 666c 6f61 7428 6d72 6368 6561 6465 722e  float(mrcheader.
+00036a60: 6f72 6967 696e 2e79 292c 2066 6c6f 6174  origin.y), float
+00036a70: 286d 7263 6865 6164 6572 2e6f 7269 6769  (mrcheader.origi
+00036a80: 6e2e 7a29 290a 2020 2020 2020 2020 6170  n.z)).        ap
+00036a90: 6978 203d 2028 6d72 6368 6561 6465 722e  ix = (mrcheader.
+00036aa0: 6365 6c6c 612e 782f 6d72 6368 6561 6465  cella.x/mrcheade
+00036ab0: 722e 6d78 2c20 6d72 6368 6561 6465 722e  r.mx, mrcheader.
+00036ac0: 6365 6c6c 612e 792f 6d72 6368 6561 6465  cella.y/mrcheade
+00036ad0: 722e 6d79 2c20 6d72 6368 6561 6465 722e  r.my, mrcheader.
+00036ae0: 6365 6c6c 612e 7a2f 6d72 6368 6561 6465  cella.z/mrcheade
+00036af0: 722e 6d7a 295b 305d 0a0a 2020 2020 2020  r.mz)[0]..      
+00036b00: 2020 6669 6e61 6c6d 6170 203d 204d 6170    finalmap = Map
+00036b10: 286d 6170 6461 7461 2c20 6f72 6967 696e  (mapdata, origin
+00036b20: 2c20 6170 6978 2c20 6675 6c6c 6d61 706e  , apix, fullmapn
+00036b30: 616d 652c 2068 6561 6465 723d 7465 6d70  ame, header=temp
+00036b40: 7968 6561 6465 7229 0a0a 2020 2020 2020  yheader)..      
+00036b50: 2020 7265 7475 726e 2066 696e 616c 6d61    return finalma
+00036b60: 700a 0a0a 2020 2020 6465 6620 6673 635f  p...    def fsc_
+00036b70: 7265 6c69 6f6e 2873 656c 6629 3a0a 2020  relion(self):.  
+00036b80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00036b90: 2020 5573 696e 6720 5265 6c69 6f6e 2074    Using Relion t
+00036ba0: 6f20 6361 6c63 756c 6174 6520 6673 630a  o calculate fsc.
+00036bb0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00036bc0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00036bd0: 2020 2020 2020 7374 6172 5f66 696c 6520        star_file 
+00036be0: 3d20 7265 6c69 6f6e 5f66 7363 5f63 616c  = relion_fsc_cal
+00036bf0: 6375 6c61 7469 6f6e 2873 656c 662e 686d  culation(self.hm
+00036c00: 6f64 642e 6675 6c6c 6e61 6d65 2c20 7365  odd.fullname, se
+00036c10: 6c66 2e68 6d65 7665 6e2e 6675 6c6c 6e61  lf.hmeven.fullna
+00036c20: 6d65 2c20 7365 6c66 2e77 6f72 6b64 6972  me, self.workdir
+00036c30: 2c20 7365 6c66 2e6d 6170 6e61 6d65 290a  , self.mapname).
+00036c40: 2020 2020 2020 2020 2020 2020 2320 7374              # st
+00036c50: 6172 5f66 696c 6520 3d20 272f 5573 6572  ar_file = '/User
+00036c60: 732f 7a68 652f 446f 776e 6c6f 6164 732f  s/zhe/Downloads/
+00036c70: 7465 7374 732f 5641 2f6e 6673 2f6d 7364  tests/VA/nfs/msd
+00036c80: 2f77 6f72 6b32 2f65 6d64 622f 6465 7665  /work2/emdb/deve
+00036c90: 6c6f 706d 656e 742f 7374 6167 696e 672f  lopment/staging/
+00036ca0: 656d 2f38 312f 3831 3137 2f76 612f 656d  em/81/8117/va/em
+00036cb0: 645f 3831 3137 2e6d 6170 5f72 656c 696f  d_8117.map_relio
+00036cc0: 6e2f 6673 632f 6673 632e 7374 6172 270a  n/fsc/fsc.star'.
+00036cd0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00036ce0: 203d 2047 6574 5374 6172 7328 7374 6172   = GetStars(star
+00036cf0: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
+00036d00: 2020 2069 6e69 7469 616c 5f66 7363 5f62     initial_fsc_b
+00036d10: 6c6f 636b 203d 2073 7461 722e 6461 7461  lock = star.data
+00036d20: 5f66 7363 5f62 6c6f 636b 2829 0a20 2020  _fsc_block().   
+00036d30: 2020 2020 2020 2020 2064 6174 615f 6673           data_fs
+00036d40: 635f 626c 6f63 6b20 3d20 7374 6172 2e64  c_block = star.d
+00036d50: 6174 615f 6578 7472 6128 696e 6974 6961  ata_extra(initia
+00036d60: 6c5f 6673 635f 626c 6f63 6b29 0a20 2020  l_fsc_block).   
+00036d70: 2020 2020 2020 2020 2064 6174 615f 6375           data_cu
+00036d80: 7276 6573 203d 2073 7461 722e 616c 6c5f  rves = star.all_
+00036d90: 6375 7276 6573 2864 6174 615f 6673 635f  curves(data_fsc_
+00036da0: 626c 6f63 6b29 0a20 2020 2020 2020 2020  block).         
+00036db0: 2020 2064 6174 615f 696e 7465 7273 6563     data_intersec
+00036dc0: 7469 6f6e 7320 3d20 7374 6172 2e61 6c6c  tions = star.all
+00036dd0: 5f69 6e74 6572 7365 6374 696f 6e28 6461  _intersection(da
+00036de0: 7461 5f66 7363 5f62 6c6f 636b 290a 0a20  ta_fsc_block).. 
+00036df0: 2020 2020 2020 2020 2020 2066 7363 5f64             fsc_d
+00036e00: 6963 7420 3d20 7b2a 2a64 6174 615f 6375  ict = {**data_cu
+00036e10: 7276 6573 2c20 2a2a 6461 7461 5f69 6e74  rves, **data_int
+00036e20: 6572 7365 6374 696f 6e73 7d0a 2020 2020  ersections}.    
+00036e30: 2020 2020 2020 2020 6f75 745f 6469 6374          out_dict
+00036e40: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+00036e50: 2020 6f75 745f 6469 6374 5b27 7265 6c69    out_dict['reli
+00036e60: 6f6e 5f66 7363 275d 203d 2066 7363 5f64  on_fsc'] = fsc_d
+00036e70: 6963 740a 2020 2020 2020 2020 2020 2020  ict.            
+00036e80: 6f75 745f 6673 635f 6a73 6f6e 203d 2066  out_fsc_json = f
+00036e90: 277b 7365 6c66 2e77 6f72 6b64 6972 7d7b  '{self.workdir}{
+00036ea0: 7365 6c66 2e6d 6170 6e61 6d65 7d5f 6673  self.mapname}_fs
+00036eb0: 635f 7265 6c69 6f6e 2e6a 736f 6e27 0a20  c_relion.json'. 
+00036ec0: 2020 2020 2020 2020 2020 206f 7574 5f6a             out_j
+00036ed0: 736f 6e28 6f75 745f 6469 6374 2c20 6f75  son(out_dict, ou
+00036ee0: 745f 6673 635f 6a73 6f6e 290a 2020 2020  t_fsc_json).    
+00036ef0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00036f00: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00036f10: 2020 2020 2020 2070 7269 6e74 2865 290a         print(e).
+00036f20: 0a0a 0a20 2020 2023 2040 7072 6f66 696c  ...    # @profil
+00036f30: 650a 2020 2020 6465 6620 6673 6373 2873  e.    def fscs(s
+00036f40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00036f50: 220a 0a0a 0a20 2020 2020 2020 203a 7265  "....        :re
+00036f60: 7475 726e 3a20 4e6f 6e65 0a20 2020 2020  turn: None.     
+00036f70: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00036f80: 6620 7365 6c66 2e68 6d65 7665 6e20 6973  f self.hmeven is
+00036f90: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
+00036fa0: 6c66 2e68 6d6f 6464 2069 7320 6e6f 7420  lf.hmodd is not 
+00036fb0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00036fc0: 2020 7374 6172 7466 7363 203d 2074 696d    startfsc = tim
+00036fd0: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
+00036fe0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+00036ff0: 2320 7365 6c66 2e66 7363 2873 656c 662e  # self.fsc(self.
+00037000: 686d 6576 656e 2c20 7365 6c66 2e68 6d6f  hmeven, self.hmo
+00037010: 6464 290a 2020 2020 2020 2020 2020 2020  dd).            
+00037020: 7365 6c66 2e66 7363 5f72 656c 696f 6e28  self.fsc_relion(
+00037030: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00037040: 6c66 2e6e 6577 5f66 7363 2873 656c 662e  lf.new_fsc(self.
+00037050: 686d 6576 656e 2c20 7365 6c66 2e68 6d6f  hmeven, self.hmo
+00037060: 6464 290a 2020 2020 2020 2020 2020 2020  dd).            
+00037070: 7374 6f70 203d 2074 696d 6569 742e 6465  stop = timeit.de
+00037080: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
+00037090: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000370a0: 2746 5343 3a20 2573 2720 2520 2873 746f  'FSC: %s' % (sto
+000370b0: 7020 2d20 7374 6172 7466 7363 2929 0a20  p - startfsc)). 
+000370c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000370d0: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
+000370e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000370f0: 2d2d 2d2d 2d2d 2729 0a20 2020 2020 2020  ------').       
+00037100: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00037110: 2020 2070 7269 6e74 2827 4d69 7369 6e67     print('Mising
+00037120: 2068 616c 6620 6d61 7028 7329 2e27 290a   half map(s).').
+00037130: 0a20 2020 2020 2020 2066 7363 786d 6c72  .        fscxmlr
+00037140: 6520 3d20 272a 5f66 7363 2e78 6d6c 270a  e = '*_fsc.xml'.
+00037150: 2020 2020 2020 2020 6673 6378 6d6c 6172          fscxmlar
+00037160: 7220 3d20 676c 6f62 2e67 6c6f 6228 7365  r = glob.glob(se
+00037170: 6c66 2e77 6f72 6b64 6972 202b 2066 7363  lf.workdir + fsc
+00037180: 786d 6c72 6529 0a20 2020 2020 2020 2069  xmlre).        i
+00037190: 6620 6673 6378 6d6c 6172 7220 6f72 2073  f fscxmlarr or s
+000371a0: 656c 662e 6673 6366 696c 653a 0a20 2020  elf.fscfile:.   
+000371b0: 2020 2020 2020 2020 2073 7461 7274 6673           startfs
+000371c0: 6320 3d20 7469 6d65 6974 2e64 6566 6175  c = timeit.defau
+000371d0: 6c74 5f74 696d 6572 2829 0a20 2020 2020  lt_timer().     
+000371e0: 2020 2020 2020 2073 656c 662e 7265 6164         self.read
+000371f0: 6673 6328 290a 2020 2020 2020 2020 2020  fsc().          
+00037200: 2020 7374 6f70 203d 2074 696d 6569 742e    stop = timeit.
+00037210: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
+00037220: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00037230: 7428 274c 6f61 6420 4653 433a 2025 7327  t('Load FSC: %s'
+00037240: 2025 2028 7374 6f70 202d 2073 7461 7274   % (stop - start
+00037250: 6673 6329 290a 2020 2020 2020 2020 2020  fsc)).          
+00037260: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
+00037270: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00037280: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
+00037290: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000372a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000372b0: 274e 6f20 6769 7665 6e20 4653 4320 6461  'No given FSC da
+000372c0: 7461 2074 6f20 6265 206c 6f61 6465 642e  ta to be loaded.
+000372d0: 2729 0a0a 2020 2020 6465 6620 7265 6164  ')..    def read
+000372e0: 6673 6328 7365 6c66 2c20 6173 796d 3d31  fsc(self, asym=1
+000372f0: 2e30 293a 0a20 2020 2020 2020 2022 2222  .0):.        """
+00037300: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00037310: 6e3a 0a20 2020 2020 2020 2022 2222 0a20  n:.        """. 
+00037320: 2020 2020 2020 2069 6d70 6f72 7420 786d         import xm
+00037330: 6c2e 6574 7265 652e 456c 656d 656e 7454  l.etree.ElementT
+00037340: 7265 6520 6173 2045 540a 0a20 2020 2020  ree as ET..     
+00037350: 2020 2065 7272 6c69 7374 203d 205b 5d0a     errlist = [].
+00037360: 2020 2020 2020 2020 6669 6e61 6c64 6963          finaldic
+00037370: 7420 3d20 6469 6374 2829 0a0a 2020 2020  t = dict()..    
+00037380: 2020 2020 6966 2073 656c 662e 6673 6366      if self.fscf
+00037390: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
+000373a0: 0a20 2020 2020 2020 2020 2020 2078 6c69  .            xli
+000373b0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+000373c0: 2020 2020 796c 6973 7420 3d20 5b5d 0a20      ylist = []. 
+000373d0: 2020 2020 2020 2020 2020 206d 6170 5f7a             map_z
+000373e0: 7369 7a65 203d 2073 656c 662e 6d61 702e  size = self.map.
+000373f0: 6865 6164 6572 2e6e 7a0a 2020 2020 2020  header.nz.      
+00037400: 2020 2020 2020 6d61 705f 7973 697a 6520        map_ysize 
+00037410: 3d20 7365 6c66 2e6d 6170 2e68 6561 6465  = self.map.heade
+00037420: 722e 6e79 0a20 2020 2020 2020 2020 2020  r.ny.           
+00037430: 206d 6170 5f78 7369 7a65 203d 2073 656c   map_xsize = sel
+00037440: 662e 6d61 702e 6865 6164 6572 2e6e 780a  f.map.header.nx.
+00037450: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00037460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037470: 2066 696c 6566 7363 203d 2073 656c 662e   filefsc = self.
+00037480: 776f 726b 6469 7220 2b20 7365 6c66 2e66  workdir + self.f
+00037490: 7363 6669 6c65 0a20 2020 2020 2020 2020  scfile.         
+000374a0: 2020 2020 2020 2074 7265 6520 3d20 4554         tree = ET
+000374b0: 2e70 6172 7365 2866 696c 6566 7363 290a  .parse(filefsc).
+000374c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000374d0: 726f 6f74 203d 2074 7265 652e 6765 7472  root = tree.getr
+000374e0: 6f6f 7428 290a 2020 2020 2020 2020 2020  oot().          
+000374f0: 2020 2020 2020 666f 7220 6368 696c 6420        for child 
+00037500: 696e 2072 6f6f 743a 0a20 2020 2020 2020  in root:.       
+00037510: 2020 2020 2020 2020 2020 2020 2078 203d               x =
+00037520: 2066 6c6f 6174 2863 6869 6c64 2e66 696e   float(child.fin
+00037530: 6428 2778 2729 2e74 6578 7429 0a20 2020  d('x').text).   
+00037540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037550: 2079 203d 2066 6c6f 6174 2863 6869 6c64   y = float(child
+00037560: 2e66 696e 6428 2779 2729 2e74 6578 7429  .find('y').text)
+00037570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037580: 2020 2020 2078 6c69 7374 2e61 7070 656e       xlist.appen
+00037590: 6428 7829 0a20 2020 2020 2020 2020 2020  d(x).           
+000375a0: 2020 2020 2020 2020 2079 6c69 7374 2e61           ylist.a
+000375b0: 7070 656e 6428 7929 0a20 2020 2020 2020  ppend(y).       
+000375c0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+000375d0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+000375e0: 203d 2027 5265 6164 2046 5343 2066 726f   = 'Read FSC fro
+000375f0: 6d20 584d 4c20 6572 726f 723a 207b 7d2e  m XML error: {}.
+00037600: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
+00037610: 5f69 6e66 6f28 295b 315d 290a 2020 2020  _info()[1]).    
+00037620: 2020 2020 2020 2020 2020 2020 6572 726c              errl
+00037630: 6973 742e 6170 7065 6e64 2865 7272 290a  ist.append(err).
+00037640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037650: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00037660: 2865 7272 202b 2027 5c6e 2729 0a0a 2020  (err + '\n')..  
+00037670: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00037680: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00037690: 2047 7269 6420 6865 7265 2074 6f20 6765   Grid here to ge
+000376a0: 6e65 7261 7465 2066 6f72 2074 7261 6369  nerate for traci
+000376b0: 6e67 2074 6865 2069 6e64 6963 6573 206f  ng the indices o
+000376c0: 6620 6772 6964 7320 7769 7468 2069 6e20  f grids with in 
+000376d0: 7468 6520 7368 656c 6c73 2e0a 2020 2020  the shells..    
+000376e0: 2020 2020 2020 2020 2020 2020 7a67 7269              zgri
+000376f0: 6420 3d20 6e70 2e61 7261 6e67 6528 666c  d = np.arange(fl
+00037700: 6f6f 7228 6d61 705f 7a73 697a 6520 2f20  oor(map_zsize / 
+00037710: 322e 3029 202a 202d 312c 2063 6569 6c28  2.0) * -1, ceil(
+00037720: 6d61 705f 7a73 697a 6520 2f20 322e 3029  map_zsize / 2.0)
+00037730: 2920 2f20 666c 6f61 7428 0a20 2020 2020  ) / float(.     
+00037740: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00037750: 6c6f 6f72 286d 6170 5f7a 7369 7a65 2929  loor(map_zsize))
+00037760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037770: 2079 6772 6964 203d 206e 702e 6172 616e   ygrid = np.aran
+00037780: 6765 2866 6c6f 6f72 286d 6170 5f79 7369  ge(floor(map_ysi
+00037790: 7a65 202f 2032 2e30 2920 2a20 2d31 2c20  ze / 2.0) * -1, 
+000377a0: 6365 696c 286d 6170 5f79 7369 7a65 202f  ceil(map_ysize /
+000377b0: 2032 2e30 2929 202f 2066 6c6f 6174 280a   2.0)) / float(.
 000377c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000377d0: 2066 6c6f 6f72 286d 6170 5f78 7369 7a65   floor(map_xsize
-000377e0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000377f0: 2020 2078 6469 7320 3d20 7867 7269 6420     xdis = xgrid 
-00037800: 2a2a 2032 0a20 2020 2020 2020 2020 2020  ** 2.           
-00037810: 2020 2020 2079 6469 7320 3d20 7967 7269       ydis = ygri
-00037820: 6420 2a2a 2032 0a20 2020 2020 2020 2020  d ** 2.         
-00037830: 2020 2020 2020 207a 6469 7320 3d20 7a67         zdis = zg
-00037840: 7269 6420 2a2a 2032 0a20 2020 2020 2020  rid ** 2.       
-00037850: 2020 2020 2020 2020 2023 2064 6973 7420           # dist 
-00037860: 3d20 6e70 2e73 7172 7428 7a64 6973 5b3a  = np.sqrt(zdis[:
-00037870: 2c20 4e6f 6e65 2c20 4e6f 6e65 5d20 2b20  , None, None] + 
-00037880: 7964 6973 5b3a 2c20 4e6f 6e65 5d20 2b20  ydis[:, None] + 
-00037890: 7864 6973 290a 0a20 2020 2020 2020 2020  xdis)..         
-000378a0: 2020 2020 2020 2061 6c6c 6178 6973 203d         allaxis =
-000378b0: 206e 702e 6172 7261 7928 5b7a 6772 6964   np.array([zgrid
-000378c0: 2c20 7967 7269 642c 2078 6772 6964 5d29  , ygrid, xgrid])
+000377d0: 2020 2020 666c 6f6f 7228 6d61 705f 7973      floor(map_ys
+000377e0: 697a 6529 290a 2020 2020 2020 2020 2020  ize)).          
+000377f0: 2020 2020 2020 7867 7269 6420 3d20 6e70        xgrid = np
+00037800: 2e61 7261 6e67 6528 666c 6f6f 7228 6d61  .arange(floor(ma
+00037810: 705f 7873 697a 6520 2f20 322e 3029 202a  p_xsize / 2.0) *
+00037820: 202d 312c 2063 6569 6c28 6d61 705f 7873   -1, ceil(map_xs
+00037830: 697a 6520 2f20 322e 3029 2920 2f20 666c  ize / 2.0)) / fl
+00037840: 6f61 7428 0a20 2020 2020 2020 2020 2020  oat(.           
+00037850: 2020 2020 2020 2020 2066 6c6f 6f72 286d           floor(m
+00037860: 6170 5f78 7369 7a65 2929 0a20 2020 2020  ap_xsize)).     
+00037870: 2020 2020 2020 2020 2020 2078 6469 7320             xdis 
+00037880: 3d20 7867 7269 6420 2a2a 2032 0a20 2020  = xgrid ** 2.   
+00037890: 2020 2020 2020 2020 2020 2020 2079 6469               ydi
+000378a0: 7320 3d20 7967 7269 6420 2a2a 2032 0a20  s = ygrid ** 2. 
+000378b0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+000378c0: 6469 7320 3d20 7a67 7269 6420 2a2a 2032  dis = zgrid ** 2
 000378d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000378e0: 2074 6d70 696e 6469 6178 6973 203d 206d   tmpindiaxis = m
-000378f0: 6178 2861 6c6c 6178 6973 2c20 6b65 793d  ax(allaxis, key=
-00037900: 6c65 6e29 0a20 2020 2020 2020 2020 2020  len).           
-00037910: 2020 2020 2069 6e64 6961 7869 7374 203d       indiaxist =
-00037920: 2074 6d70 696e 6469 6178 6973 5b74 6d70   tmpindiaxis[tmp
-00037930: 696e 6469 6178 6973 203e 3d20 305d 0a20  indiaxis >= 0]. 
-00037940: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00037950: 696e 6469 203d 206c 656e 2869 6e64 6961  indi = len(india
-00037960: 7869 7374 290a 2020 2020 2020 2020 2020  xist).          
-00037970: 2020 2020 2020 2320 696e 6469 6178 6973        # indiaxis
-00037980: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
-00037990: 2c20 3120 2f20 2832 202a 2063 706d 6170  , 1 / (2 * cpmap
-000379a0: 2e61 7069 7829 2c20 6c69 6e64 6929 0a0a  .apix), lindi)..
-000379b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000379c0: 2320 4c6f 6f70 696e 6720 7468 726f 7567  # Looping throug
-000379d0: 6820 616c 6c20 7368 656c 6c73 0a20 2020  h all shells.   
-000379e0: 2020 2020 2020 2020 2020 2020 2074 6872               thr
-000379f0: 6565 7369 6720 3d20 5b5d 0a20 2020 2020  eesig = [].     
-00037a00: 2020 2020 2020 2020 2020 2068 616c 6662             halfb
-00037a10: 6974 203d 205b 5d0a 2020 2020 2020 2020  it = [].        
-00037a20: 2020 2020 2020 2020 6f6e 6562 6974 203d          onebit =
-00037a30: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00037a40: 2020 2020 2320 666f 7220 6920 696e 2072      # for i in r
-00037a50: 616e 6765 286c 656e 2869 6e64 6961 7869  ange(len(indiaxi
-00037a60: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
-00037a70: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00037a80: 6e67 6528 6c65 6e28 786c 6973 7429 293a  nge(len(xlist)):
-00037a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037aa0: 2020 2020 2023 2069 6620 6920 3c20 6c65       # if i < le
-00037ab0: 6e28 696e 6469 6178 6973 2920 2d20 313a  n(indiaxis) - 1:
-00037ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037ad0: 2020 2020 2020 2020 2023 2069 6e64 6963           # indic
-00037ae0: 6573 203d 206e 702e 6172 6777 6865 7265  es = np.argwhere
-00037af0: 2828 6469 7374 203e 3d20 696e 6469 6178  ((dist >= indiax
-00037b00: 6973 745b 695d 2920 2620 2864 6973 7420  ist[i]) & (dist 
-00037b10: 3c20 696e 6469 6178 6973 745b 6920 2b20  < indiaxist[i + 
-00037b20: 315d 2929 0a0a 2020 2020 2020 2020 2020  1]))..          
-00037b30: 2020 2020 2020 2020 2020 766f 6c75 6d65            volume
-00037b40: 6469 6666 203d 2028 342e 3020 2f20 332e  diff = (4.0 / 3.
-00037b50: 3029 202a 2070 6920 2a20 2828 6920 2b20  0) * pi * ((i + 
-00037b60: 3129 202a 2a20 3320 2d20 6920 2a2a 2033  1) ** 3 - i ** 3
-00037b70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00037b80: 2020 2020 2020 6e76 6f78 7269 6e67 203d        nvoxring =
-00037b90: 2076 6f6c 756d 6564 6966 6620 2f20 2831   volumediff / (1
-00037ba0: 202a 2a20 3329 0a20 2020 2020 2020 2020   ** 3).         
-00037bb0: 2020 2020 2020 2020 2020 2065 6666 6e76             effnv
-00037bc0: 6f78 203d 2028 6e76 6f78 7269 6e67 202a  ox = (nvoxring *
-00037bd0: 2028 2831 2e35 202a 2030 2e36 3629 202a   ((1.5 * 0.66) *
-00037be0: 2a20 3229 2920 2f20 2832 202a 2061 7379  * 2)) / (2 * asy
-00037bf0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
-00037c00: 2020 2020 2020 2069 6620 6566 666e 766f         if effnvo
-00037c10: 7820 3c20 312e 303a 2065 6666 6e76 6f78  x < 1.0: effnvox
-00037c20: 203d 2031 2e30 0a20 2020 2020 2020 2020   = 1.0.         
-00037c30: 2020 2020 2020 2020 2020 2073 7172 6566             sqref
-00037c40: 666e 766f 7820 3d20 6e70 2e73 7172 7428  fnvox = np.sqrt(
-00037c50: 6566 666e 766f 7829 0a0a 2020 2020 2020  effnvox)..      
-00037c60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00037c70: 332d 7369 676d 6120 6375 7276 650a 2020  3-sigma curve.  
-00037c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037c90: 2020 6966 2069 2021 3d20 303a 0a20 2020    if i != 0:.   
-00037ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037cb0: 2020 2020 2073 6967 7661 6c75 6520 3d20       sigvalue = 
-00037cc0: 3320 2f20 2873 7172 6566 666e 766f 7820  3 / (sqreffnvox 
-00037cd0: 2b20 332e 3020 2d20 312e 3029 0a20 2020  + 3.0 - 1.0).   
-00037ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037cf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00037d00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00037d10: 6967 7661 6c75 6520 3d20 310a 2020 2020  igvalue = 1.    
-00037d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037d30: 7468 7265 6573 6967 2e61 7070 656e 6428  threesig.append(
-00037d40: 7369 6776 616c 7565 290a 0a20 2020 2020  sigvalue)..     
-00037d50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00037d60: 2048 616c 6620 6269 7420 6375 7276 650a   Half bit curve.
-00037d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037d80: 2020 2020 6966 2069 2021 3d20 303a 0a20      if i != 0:. 
-00037d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037da0: 2020 2020 2020 2062 6974 7661 6c75 6520         bitvalue 
-00037db0: 3d20 2830 2e32 3037 3120 2b20 312e 3931  = (0.2071 + 1.91
-00037dc0: 3032 202f 2073 7172 6566 666e 766f 7829  02 / sqreffnvox)
-00037dd0: 202f 2028 312e 3230 3731 202b 2030 2e39   / (1.2071 + 0.9
-00037de0: 3130 3220 2f20 7371 7265 6666 6e76 6f78  102 / sqreffnvox
-00037df0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00037e00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00037e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e20: 2020 2020 6269 7476 616c 7565 203d 2031      bitvalue = 1
-00037e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037e40: 2020 2020 2068 616c 6662 6974 2e61 7070       halfbit.app
-00037e50: 656e 6428 6269 7476 616c 7565 290a 0a20  end(bitvalue).. 
-00037e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e70: 2020 2069 6620 6920 213d 2030 3a0a 2020     if i != 0:.  
-00037e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e90: 2020 2020 2020 6f6e 6562 6974 7661 6c75        onebitvalu
-00037ea0: 6520 3d20 2830 2e35 202b 2032 2e34 3134  e = (0.5 + 2.414
-00037eb0: 3220 2f20 7371 7265 6666 6e76 6f78 2920  2 / sqreffnvox) 
-00037ec0: 2f20 2831 2e35 202b 2031 2e34 3134 3220  / (1.5 + 1.4142 
-00037ed0: 2f20 7371 7265 6666 6e76 6f78 290a 2020  / sqreffnvox).  
-00037ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ef0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00037f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037f10: 6f6e 6562 6974 7661 6c75 6520 3d20 310a  onebitvalue = 1.
-00037f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037f30: 2020 2020 6f6e 6562 6974 2e61 7070 656e      onebit.appen
-00037f40: 6428 6f6e 6562 6974 7661 6c75 6529 0a0a  d(onebitvalue)..
-00037f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037f60: 6966 2079 6c69 7374 5b30 5d20 3c3d 2030  if ylist[0] <= 0
-00037f70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00037f80: 2020 2020 2020 796c 6973 745b 305d 203d        ylist[0] =
-00037f90: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
-00037fa0: 2020 2020 6120 3d20 6e70 2e61 7361 7272      a = np.asarr
-00037fb0: 6179 2878 6c69 7374 290a 2020 2020 2020  ay(xlist).      
-00037fc0: 2020 2020 2020 2020 2020 6220 3d20 6e70            b = np
-00037fd0: 2e61 7361 7272 6179 2879 6c69 7374 290a  .asarray(ylist).
-00037fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ff0: 6320 3d20 6e70 2e61 7361 7272 6179 2874  c = np.asarray(t
-00038000: 6872 6565 7369 6729 0a20 2020 2020 2020  hreesig).       
-00038010: 2020 2020 2020 2020 2064 203d 206e 702e           d = np.
-00038020: 6173 6172 7261 7928 6861 6c66 6269 7429  asarray(halfbit)
-00038030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038040: 2065 203d 206e 702e 6173 6172 7261 7928   e = np.asarray(
-00038050: 6f6e 6562 6974 290a 2020 2020 2020 2020  onebit).        
-00038060: 2020 2020 2020 2020 6620 3d20 6e70 2e66          f = np.f
-00038070: 756c 6c28 286c 656e 2878 6c69 7374 2929  ull((len(xlist))
-00038080: 2c20 302e 3529 0a20 2020 2020 2020 2020  , 0.5).         
-00038090: 2020 2020 2020 2067 203d 206e 702e 6675         g = np.fu
-000380a0: 6c6c 2828 6c65 6e28 786c 6973 7429 292c  ll((len(xlist)),
-000380b0: 2030 2e33 3333 290a 2020 2020 2020 2020   0.333).        
-000380c0: 2020 2020 2020 2020 6820 3d20 6e70 2e66          h = np.f
-000380d0: 756c 6c28 286c 656e 2878 6c69 7374 2929  ull((len(xlist))
-000380e0: 2c20 302e 3134 3329 0a0a 2020 2020 2020  , 0.143)..      
-000380f0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00038100: 2863 2920 3c20 6c65 6e28 6229 3a0a 2020  (c) < len(b):.  
-00038110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038120: 2020 6220 3d20 625b 3a6c 656e 2863 295d    b = b[:len(c)]
-00038130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038140: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00038150: 2020 2020 2020 2020 2020 2063 203d 2063             c = c
-00038160: 5b3a 6c65 6e28 6229 5d0a 0a20 2020 2020  [:len(b)]..     
-00038170: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00038180: 6e28 6429 203c 206c 656e 2862 293a 0a20  n(d) < len(b):. 
-00038190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000381a0: 2020 2062 203d 2062 5b3a 6c65 6e28 6429     b = b[:len(d)
-000381b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000381c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000381d0: 2020 2020 2020 2020 2020 2020 6420 3d20              d = 
-000381e0: 645b 3a6c 656e 2862 295d 0a0a 0a20 2020  d[:len(b)]...   
-000381f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00038200: 6c65 6e28 6529 203c 206c 656e 2862 293a  len(e) < len(b):
-00038210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038220: 2020 2020 2062 203d 2062 5b3a 6c65 6e28       b = b[:len(
-00038230: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
-00038240: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00038250: 2020 2020 2020 2020 2020 2020 2020 6520                e 
-00038260: 3d20 655b 3a6c 656e 2862 295d 0a0a 0a20  = e[:len(b)]... 
-00038270: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00038280: 6620 6c65 6e28 6629 203c 206c 656e 2862  f len(f) < len(b
-00038290: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000382a0: 2020 2020 2020 2062 203d 2062 5b3a 6c65         b = b[:le
-000382b0: 6e28 6629 5d0a 2020 2020 2020 2020 2020  n(f)].          
-000382c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000382d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000382e0: 6620 3d20 665b 3a6c 656e 2862 295d 0a0a  f = f[:len(b)]..
-000382f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038300: 2069 6620 6c65 6e28 6729 203c 206c 656e   if len(g) < len
-00038310: 2862 293a 0a20 2020 2020 2020 2020 2020  (b):.           
-00038320: 2020 2020 2020 2020 2062 203d 2062 5b3a           b = b[:
-00038330: 6c65 6e28 6729 5d0a 2020 2020 2020 2020  len(g)].        
-00038340: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00038350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038360: 2020 6720 3d20 675b 3a6c 656e 2862 295d    g = g[:len(b)]
-00038370: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00038380: 2020 6966 206c 656e 2868 2920 3c20 6c65    if len(h) < le
-00038390: 6e28 6229 3a0a 2020 2020 2020 2020 2020  n(b):.          
-000383a0: 2020 2020 2020 2020 2020 6220 3d20 625b            b = b[
-000383b0: 3a6c 656e 2868 295d 0a20 2020 2020 2020  :len(h)].       
-000383c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000383d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000383e0: 2020 2068 203d 2068 5b3a 6c65 6e28 6229     h = h[:len(b)
-000383f0: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00038400: 2020 2078 7468 7265 6573 6967 2c20 7974     xthreesig, yt
-00038410: 6872 6565 7369 6720 3d20 7365 6c66 2e5f  hreesig = self._
-00038420: 5f69 6e74 6572 706f 6c61 7465 645f 696e  _interpolated_in
-00038430: 7465 7263 6570 7428 612c 2062 2c20 6329  tercept(a, b, c)
+000378e0: 2023 2064 6973 7420 3d20 6e70 2e73 7172   # dist = np.sqr
+000378f0: 7428 7a64 6973 5b3a 2c20 4e6f 6e65 2c20  t(zdis[:, None, 
+00037900: 4e6f 6e65 5d20 2b20 7964 6973 5b3a 2c20  None] + ydis[:, 
+00037910: 4e6f 6e65 5d20 2b20 7864 6973 290a 0a20  None] + xdis).. 
+00037920: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00037930: 6c6c 6178 6973 203d 206e 702e 6172 7261  llaxis = np.arra
+00037940: 7928 5b7a 6772 6964 2c20 7967 7269 642c  y([zgrid, ygrid,
+00037950: 2078 6772 6964 5d29 0a20 2020 2020 2020   xgrid]).       
+00037960: 2020 2020 2020 2020 2074 6d70 696e 6469           tmpindi
+00037970: 6178 6973 203d 206d 6178 2861 6c6c 6178  axis = max(allax
+00037980: 6973 2c20 6b65 793d 6c65 6e29 0a20 2020  is, key=len).   
+00037990: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+000379a0: 6961 7869 7374 203d 2074 6d70 696e 6469  iaxist = tmpindi
+000379b0: 6178 6973 5b74 6d70 696e 6469 6178 6973  axis[tmpindiaxis
+000379c0: 203e 3d20 305d 0a20 2020 2020 2020 2020   >= 0].         
+000379d0: 2020 2020 2020 206c 696e 6469 203d 206c         lindi = l
+000379e0: 656e 2869 6e64 6961 7869 7374 290a 2020  en(indiaxist).  
+000379f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00037a00: 696e 6469 6178 6973 203d 206e 702e 6c69  indiaxis = np.li
+00037a10: 6e73 7061 6365 2830 2c20 3120 2f20 2832  nspace(0, 1 / (2
+00037a20: 202a 2063 706d 6170 2e61 7069 7829 2c20   * cpmap.apix), 
+00037a30: 6c69 6e64 6929 0a0a 2020 2020 2020 2020  lindi)..        
+00037a40: 2020 2020 2020 2020 2320 4c6f 6f70 696e          # Loopin
+00037a50: 6720 7468 726f 7567 6820 616c 6c20 7368  g through all sh
+00037a60: 656c 6c73 0a20 2020 2020 2020 2020 2020  ells.           
+00037a70: 2020 2020 2074 6872 6565 7369 6720 3d20       threesig = 
+00037a80: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+00037a90: 2020 2068 616c 6662 6974 203d 205b 5d0a     halfbit = [].
+00037aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037ab0: 6f6e 6562 6974 203d 205b 5d0a 2020 2020  onebit = [].    
+00037ac0: 2020 2020 2020 2020 2020 2020 2320 666f              # fo
+00037ad0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+00037ae0: 2869 6e64 6961 7869 7329 293a 0a20 2020  (indiaxis)):.   
+00037af0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00037b00: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+00037b10: 786c 6973 7429 293a 0a20 2020 2020 2020  xlist)):.       
+00037b20: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00037b30: 6620 6920 3c20 6c65 6e28 696e 6469 6178  f i < len(indiax
+00037b40: 6973 2920 2d20 313a 0a20 2020 2020 2020  is) - 1:.       
+00037b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037b60: 2023 2069 6e64 6963 6573 203d 206e 702e   # indices = np.
+00037b70: 6172 6777 6865 7265 2828 6469 7374 203e  argwhere((dist >
+00037b80: 3d20 696e 6469 6178 6973 745b 695d 2920  = indiaxist[i]) 
+00037b90: 2620 2864 6973 7420 3c20 696e 6469 6178  & (dist < indiax
+00037ba0: 6973 745b 6920 2b20 315d 2929 0a0a 2020  ist[i + 1]))..  
+00037bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037bc0: 2020 766f 6c75 6d65 6469 6666 203d 2028    volumediff = (
+00037bd0: 342e 3020 2f20 332e 3029 202a 2070 6920  4.0 / 3.0) * pi 
+00037be0: 2a20 2828 6920 2b20 3129 202a 2a20 3320  * ((i + 1) ** 3 
+00037bf0: 2d20 6920 2a2a 2033 290a 2020 2020 2020  - i ** 3).      
+00037c00: 2020 2020 2020 2020 2020 2020 2020 6e76                nv
+00037c10: 6f78 7269 6e67 203d 2076 6f6c 756d 6564  oxring = volumed
+00037c20: 6966 6620 2f20 2831 202a 2a20 3329 0a20  iff / (1 ** 3). 
+00037c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037c40: 2020 2065 6666 6e76 6f78 203d 2028 6e76     effnvox = (nv
+00037c50: 6f78 7269 6e67 202a 2028 2831 2e35 202a  oxring * ((1.5 *
+00037c60: 2030 2e36 3629 202a 2a20 3229 2920 2f20   0.66) ** 2)) / 
+00037c70: 2832 202a 2061 7379 6d29 0a20 2020 2020  (2 * asym).     
+00037c80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00037c90: 6620 6566 666e 766f 7820 3c20 312e 303a  f effnvox < 1.0:
+00037ca0: 2065 6666 6e76 6f78 203d 2031 2e30 0a20   effnvox = 1.0. 
+00037cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037cc0: 2020 2073 7172 6566 666e 766f 7820 3d20     sqreffnvox = 
+00037cd0: 6e70 2e73 7172 7428 6566 666e 766f 7829  np.sqrt(effnvox)
+00037ce0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00037cf0: 2020 2020 2020 2320 332d 7369 676d 6120        # 3-sigma 
+00037d00: 6375 7276 650a 2020 2020 2020 2020 2020  curve.          
+00037d10: 2020 2020 2020 2020 2020 6966 2069 2021            if i !
+00037d20: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00037d30: 2020 2020 2020 2020 2020 2020 2073 6967               sig
+00037d40: 7661 6c75 6520 3d20 3320 2f20 2873 7172  value = 3 / (sqr
+00037d50: 6566 666e 766f 7820 2b20 332e 3020 2d20  effnvox + 3.0 - 
+00037d60: 312e 3029 0a20 2020 2020 2020 2020 2020  1.0).           
+00037d70: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00037d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037d90: 2020 2020 2020 2073 6967 7661 6c75 6520         sigvalue 
+00037da0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00037db0: 2020 2020 2020 2020 7468 7265 6573 6967          threesig
+00037dc0: 2e61 7070 656e 6428 7369 6776 616c 7565  .append(sigvalue
+00037dd0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00037de0: 2020 2020 2020 2023 2048 616c 6620 6269         # Half bi
+00037df0: 7420 6375 7276 650a 2020 2020 2020 2020  t curve.        
+00037e00: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00037e10: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
+00037e20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00037e30: 6974 7661 6c75 6520 3d20 2830 2e32 3037  itvalue = (0.207
+00037e40: 3120 2b20 312e 3931 3032 202f 2073 7172  1 + 1.9102 / sqr
+00037e50: 6566 666e 766f 7829 202f 2028 312e 3230  effnvox) / (1.20
+00037e60: 3731 202b 2030 2e39 3130 3220 2f20 7371  71 + 0.9102 / sq
+00037e70: 7265 6666 6e76 6f78 290a 2020 2020 2020  reffnvox).      
+00037e80: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00037e90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00037ea0: 2020 2020 2020 2020 2020 2020 6269 7476              bitv
+00037eb0: 616c 7565 203d 2031 0a20 2020 2020 2020  alue = 1.       
+00037ec0: 2020 2020 2020 2020 2020 2020 2068 616c               hal
+00037ed0: 6662 6974 2e61 7070 656e 6428 6269 7476  fbit.append(bitv
+00037ee0: 616c 7565 290a 0a20 2020 2020 2020 2020  alue)..         
+00037ef0: 2020 2020 2020 2020 2020 2069 6620 6920             if i 
+00037f00: 213d 2030 3a0a 2020 2020 2020 2020 2020  != 0:.          
+00037f10: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+00037f20: 6562 6974 7661 6c75 6520 3d20 2830 2e35  ebitvalue = (0.5
+00037f30: 202b 2032 2e34 3134 3220 2f20 7371 7265   + 2.4142 / sqre
+00037f40: 6666 6e76 6f78 2920 2f20 2831 2e35 202b  ffnvox) / (1.5 +
+00037f50: 2031 2e34 3134 3220 2f20 7371 7265 6666   1.4142 / sqreff
+00037f60: 6e76 6f78 290a 2020 2020 2020 2020 2020  nvox).          
+00037f70: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00037f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037f90: 2020 2020 2020 2020 6f6e 6562 6974 7661          onebitva
+00037fa0: 6c75 6520 3d20 310a 2020 2020 2020 2020  lue = 1.        
+00037fb0: 2020 2020 2020 2020 2020 2020 6f6e 6562              oneb
+00037fc0: 6974 2e61 7070 656e 6428 6f6e 6562 6974  it.append(onebit
+00037fd0: 7661 6c75 6529 0a0a 2020 2020 2020 2020  value)..        
+00037fe0: 2020 2020 2020 2020 6966 2079 6c69 7374          if ylist
+00037ff0: 5b30 5d20 3c3d 2030 3a0a 2020 2020 2020  [0] <= 0:.      
+00038000: 2020 2020 2020 2020 2020 2020 2020 796c                yl
+00038010: 6973 745b 305d 203d 2031 0a0a 2020 2020  ist[0] = 1..    
+00038020: 2020 2020 2020 2020 2020 2020 6120 3d20              a = 
+00038030: 6e70 2e61 7361 7272 6179 2878 6c69 7374  np.asarray(xlist
+00038040: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00038050: 2020 6220 3d20 6e70 2e61 7361 7272 6179    b = np.asarray
+00038060: 2879 6c69 7374 290a 2020 2020 2020 2020  (ylist).        
+00038070: 2020 2020 2020 2020 6320 3d20 6e70 2e61          c = np.a
+00038080: 7361 7272 6179 2874 6872 6565 7369 6729  sarray(threesig)
+00038090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000380a0: 2064 203d 206e 702e 6173 6172 7261 7928   d = np.asarray(
+000380b0: 6861 6c66 6269 7429 0a20 2020 2020 2020  halfbit).       
+000380c0: 2020 2020 2020 2020 2065 203d 206e 702e           e = np.
+000380d0: 6173 6172 7261 7928 6f6e 6562 6974 290a  asarray(onebit).
+000380e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000380f0: 6620 3d20 6e70 2e66 756c 6c28 286c 656e  f = np.full((len
+00038100: 2878 6c69 7374 2929 2c20 302e 3529 0a20  (xlist)), 0.5). 
+00038110: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00038120: 203d 206e 702e 6675 6c6c 2828 6c65 6e28   = np.full((len(
+00038130: 786c 6973 7429 292c 2030 2e33 3333 290a  xlist)), 0.333).
+00038140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038150: 6820 3d20 6e70 2e66 756c 6c28 286c 656e  h = np.full((len
+00038160: 2878 6c69 7374 2929 2c20 302e 3134 3329  (xlist)), 0.143)
+00038170: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00038180: 2020 6966 206c 656e 2863 2920 3c20 6c65    if len(c) < le
+00038190: 6e28 6229 3a0a 2020 2020 2020 2020 2020  n(b):.          
+000381a0: 2020 2020 2020 2020 2020 6220 3d20 625b            b = b[
+000381b0: 3a6c 656e 2863 295d 0a20 2020 2020 2020  :len(c)].       
+000381c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000381d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000381e0: 2020 2063 203d 2063 5b3a 6c65 6e28 6229     c = c[:len(b)
+000381f0: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00038200: 2020 2069 6620 6c65 6e28 6429 203c 206c     if len(d) < l
+00038210: 656e 2862 293a 0a20 2020 2020 2020 2020  en(b):.         
+00038220: 2020 2020 2020 2020 2020 2062 203d 2062             b = b
+00038230: 5b3a 6c65 6e28 6429 5d0a 2020 2020 2020  [:len(d)].      
+00038240: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00038250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038260: 2020 2020 6420 3d20 645b 3a6c 656e 2862      d = d[:len(b
+00038270: 295d 0a0a 0a20 2020 2020 2020 2020 2020  )]...           
+00038280: 2020 2020 2069 6620 6c65 6e28 6529 203c       if len(e) <
+00038290: 206c 656e 2862 293a 0a20 2020 2020 2020   len(b):.       
+000382a0: 2020 2020 2020 2020 2020 2020 2062 203d               b =
+000382b0: 2062 5b3a 6c65 6e28 6529 5d0a 2020 2020   b[:len(e)].    
+000382c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000382d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000382e0: 2020 2020 2020 6520 3d20 655b 3a6c 656e        e = e[:len
+000382f0: 2862 295d 0a0a 0a20 2020 2020 2020 2020  (b)]...         
+00038300: 2020 2020 2020 2069 6620 6c65 6e28 6629         if len(f)
+00038310: 203c 206c 656e 2862 293a 0a20 2020 2020   < len(b):.     
+00038320: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00038330: 203d 2062 5b3a 6c65 6e28 6629 5d0a 2020   = b[:len(f)].  
+00038340: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00038350: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00038360: 2020 2020 2020 2020 6620 3d20 665b 3a6c          f = f[:l
+00038370: 656e 2862 295d 0a0a 0a20 2020 2020 2020  en(b)]...       
+00038380: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00038390: 6729 203c 206c 656e 2862 293a 0a20 2020  g) < len(b):.   
+000383a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000383b0: 2062 203d 2062 5b3a 6c65 6e28 6729 5d0a   b = b[:len(g)].
+000383c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000383d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000383e0: 2020 2020 2020 2020 2020 6720 3d20 675b            g = g[
+000383f0: 3a6c 656e 2862 295d 0a0a 2020 2020 2020  :len(b)]..      
+00038400: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00038410: 2868 2920 3c20 6c65 6e28 6229 3a0a 2020  (h) < len(b):.  
+00038420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038430: 2020 6220 3d20 625b 3a6c 656e 2868 295d    b = b[:len(h)]
 00038440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038450: 2078 6861 6c66 6269 742c 2079 6861 6c66   xhalfbit, yhalf
-00038460: 6269 7420 3d20 7365 6c66 2e5f 5f69 6e74  bit = self.__int
-00038470: 6572 706f 6c61 7465 645f 696e 7465 7263  erpolated_interc
-00038480: 6570 7428 612c 2062 2c20 6429 0a20 2020  ept(a, b, d).   
-00038490: 2020 2020 2020 2020 2020 2020 2078 6f6e               xon
-000384a0: 6562 6974 2c20 796f 6e65 6269 7420 3d20  ebit, yonebit = 
-000384b0: 7365 6c66 2e5f 5f69 6e74 6572 706f 6c61  self.__interpola
-000384c0: 7465 645f 696e 7465 7263 6570 7428 612c  ted_intercept(a,
-000384d0: 2062 2c20 6529 0a20 2020 2020 2020 2020   b, e).         
-000384e0: 2020 2020 2020 2078 6861 6c66 2c20 7968         xhalf, yh
-000384f0: 616c 6620 3d20 7365 6c66 2e5f 5f69 6e74  alf = self.__int
-00038500: 6572 706f 6c61 7465 645f 696e 7465 7263  erpolated_interc
-00038510: 6570 7428 612c 2062 2c20 6629 0a20 2020  ept(a, b, f).   
-00038520: 2020 2020 2020 2020 2020 2020 2078 6f6e               xon
-00038530: 6574 6872 6565 2c20 796f 6e65 7468 7265  ethree, yonethre
-00038540: 6520 3d20 7365 6c66 2e5f 5f69 6e74 6572  e = self.__inter
-00038550: 706f 6c61 7465 645f 696e 7465 7263 6570  polated_intercep
-00038560: 7428 612c 2062 2c20 6729 0a20 2020 2020  t(a, b, g).     
-00038570: 2020 2020 2020 2020 2020 2078 676f 6c64             xgold
-00038580: 2c20 7967 6f6c 6420 3d20 7365 6c66 2e5f  , ygold = self._
-00038590: 5f69 6e74 6572 706f 6c61 7465 645f 696e  _interpolated_in
-000385a0: 7465 7263 6570 7428 612c 2062 2c20 6829  tercept(a, b, h)
-000385b0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000385c0: 2020 6966 2078 7468 7265 6573 6967 2e73    if xthreesig.s
-000385d0: 697a 6520 3d3d 2030 2061 6e64 2079 7468  ize == 0 and yth
-000385e0: 7265 6573 6967 2e73 697a 6520 3d3d 2030  reesig.size == 0
-000385f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00038600: 2020 2020 2020 7478 7468 7265 6573 6967        txthreesig
-00038610: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00038620: 2020 2020 2020 2020 2020 2020 7479 7468              tyth
-00038630: 7265 6573 6967 203d 204e 6f6e 650a 2020  reesig = None.  
-00038640: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00038650: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00038660: 2020 2020 2020 2020 7478 7468 7265 6573          txthrees
-00038670: 6967 203d 206e 702e 726f 756e 6428 7874  ig = np.round(xt
-00038680: 6872 6565 7369 675b 305d 5b30 5d2c 2034  hreesig[0][0], 4
-00038690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000386a0: 2020 2020 2020 7479 7468 7265 6573 6967        tythreesig
-000386b0: 203d 206e 702e 726f 756e 6428 7974 6872   = np.round(ythr
-000386c0: 6565 7369 675b 305d 5b30 5d2c 2034 290a  eesig[0][0], 4).
-000386d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000386e0: 2069 6620 7868 616c 6662 6974 2e73 697a   if xhalfbit.siz
-000386f0: 6520 3d3d 2030 2061 6e64 2079 6861 6c66  e == 0 and yhalf
-00038700: 6269 742e 7369 7a65 203d 3d20 303a 0a20  bit.size == 0:. 
-00038710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038720: 2020 2074 7868 616c 6662 6974 203d 204e     txhalfbit = N
-00038730: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00038740: 2020 2020 2020 2020 7479 6861 6c66 6269          tyhalfbi
-00038750: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-00038760: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00038770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038780: 2020 2069 6620 6e70 2e69 736e 616e 2878     if np.isnan(x
-00038790: 6861 6c66 6269 745b 305d 5b30 5d29 3a0a  halfbit[0][0]):.
-000387a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000387b0: 2020 2020 2020 2020 7478 6861 6c66 6269          txhalfbi
-000387c0: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-000387d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000387e0: 2074 7968 616c 6662 6974 203d 204e 6f6e   tyhalfbit = Non
-000387f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00038800: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00038810: 2721 2121 2054 6865 206c 6f61 6465 6420  '!!! The loaded 
-00038820: 6673 6320 6861 7320 6e6f 2069 6e74 6572  fsc has no inter
-00038830: 7365 6374 696f 6e20 7769 7468 2074 6865  section with the
-00038840: 2068 616c 6620 6269 7420 6375 7276 6520   half bit curve 
-00038850: 2121 2127 290a 2020 2020 2020 2020 2020  !!!').          
-00038860: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00038870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038880: 2020 2020 2020 2020 7478 6861 6c66 6269          txhalfbi
-00038890: 7420 3d20 6e70 2e72 6f75 6e64 2878 6861  t = np.round(xha
-000388a0: 6c66 6269 745b 305d 5b30 5d2c 2034 290a  lfbit[0][0], 4).
-000388b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388c0: 2020 2020 2020 2020 7479 6861 6c66 6269          tyhalfbi
-000388d0: 7420 3d20 6e70 2e72 6f75 6e64 2879 6861  t = np.round(yha
-000388e0: 6c66 6269 745b 305d 5b30 5d2c 2034 290a  lfbit[0][0], 4).
-000388f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038900: 2069 6620 786f 6e65 6269 742e 7369 7a65   if xonebit.size
-00038910: 203d 3d20 3020 616e 6420 796f 6e65 6269   == 0 and yonebi
-00038920: 742e 7369 7a65 203d 3d20 303a 0a20 2020  t.size == 0:.   
-00038930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038940: 2074 786f 6e65 6269 7420 3d20 4e6f 6e65   txonebit = None
-00038950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038960: 2020 2020 2074 796f 6e65 6269 7420 3d20       tyonebit = 
-00038970: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00038980: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00038990: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000389a0: 786f 6e65 6269 7420 3d20 6e70 2e72 6f75  xonebit = np.rou
-000389b0: 6e64 2878 6f6e 6562 6974 5b30 5d5b 305d  nd(xonebit[0][0]
-000389c0: 2c20 3429 0a20 2020 2020 2020 2020 2020  , 4).           
-000389d0: 2020 2020 2020 2020 2074 796f 6e65 6269           tyonebi
-000389e0: 7420 3d20 6e70 2e72 6f75 6e64 2879 6f6e  t = np.round(yon
-000389f0: 6562 6974 5b30 5d5b 305d 2c20 3429 0a0a  ebit[0][0], 4)..
-00038a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038a10: 6966 2078 6861 6c66 2e73 697a 6520 3d3d  if xhalf.size ==
-00038a20: 2030 2061 6e64 2079 6861 6c66 2e73 697a   0 and yhalf.siz
-00038a30: 6520 3d3d 2030 3a0a 2020 2020 2020 2020  e == 0:.        
-00038a40: 2020 2020 2020 2020 2020 2020 7478 6861              txha
-00038a50: 6c66 203d 204e 6f6e 650a 2020 2020 2020  lf = None.      
-00038a60: 2020 2020 2020 2020 2020 2020 2020 7479                ty
-00038a70: 6861 6c66 203d 204e 6f6e 650a 2020 2020  half = None.    
-00038a80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00038a90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00038aa0: 2020 2020 2020 7478 6861 6c66 203d 206e        txhalf = n
-00038ab0: 702e 726f 756e 6428 7868 616c 665b 305d  p.round(xhalf[0]
-00038ac0: 5b30 5d2c 2034 290a 2020 2020 2020 2020  [0], 4).        
-00038ad0: 2020 2020 2020 2020 2020 2020 7479 6861              tyha
-00038ae0: 6c66 203d 206e 702e 726f 756e 6428 7968  lf = np.round(yh
-00038af0: 616c 665b 305d 5b30 5d2c 2034 290a 0a20  alf[0][0], 4).. 
-00038b00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00038b10: 6620 786f 6e65 7468 7265 652e 7369 7a65  f xonethree.size
-00038b20: 203d 3d20 3020 616e 6420 796f 6e65 7468   == 0 and yoneth
-00038b30: 7265 652e 7369 7a65 203d 3d20 303a 0a20  ree.size == 0:. 
-00038b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038b50: 2020 2074 786f 6e65 7468 7265 6520 3d20     txonethree = 
-00038b60: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00038b70: 2020 2020 2020 2020 2074 796f 6e65 7468           tyoneth
-00038b80: 7265 6520 3d20 4e6f 6e65 0a20 2020 2020  ree = None.     
-00038b90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00038ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038bb0: 2020 2020 2074 786f 6e65 7468 7265 6520       txonethree 
-00038bc0: 3d20 6e70 2e72 6f75 6e64 2878 6f6e 6574  = np.round(xonet
-00038bd0: 6872 6565 5b30 5d5b 305d 2c20 3429 0a20  hree[0][0], 4). 
-00038be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038bf0: 2020 2074 796f 6e65 7468 7265 6520 3d20     tyonethree = 
-00038c00: 6e70 2e72 6f75 6e64 2879 6f6e 6574 6872  np.round(yonethr
-00038c10: 6565 5b30 5d5b 305d 2c20 3429 0a0a 2020  ee[0][0], 4)..  
-00038c20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00038c30: 2078 676f 6c64 2e73 697a 6520 3d3d 2030   xgold.size == 0
-00038c40: 2061 6e64 2079 676f 6c64 2e73 697a 6520   and ygold.size 
-00038c50: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00038c60: 2020 2020 2020 2020 2020 7478 676f 6c64            txgold
-00038c70: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00038c80: 2020 2020 2020 2020 2020 2020 7479 676f              tygo
-00038c90: 6c64 203d 204e 6f6e 650a 2020 2020 2020  ld = None.      
-00038ca0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00038cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038cc0: 2020 2020 7478 676f 6c64 203d 206e 702e      txgold = np.
-00038cd0: 726f 756e 6428 7867 6f6c 645b 305d 5b30  round(xgold[0][0
-00038ce0: 5d2c 2034 290a 2020 2020 2020 2020 2020  ], 4).          
-00038cf0: 2020 2020 2020 2020 2020 7479 676f 6c64            tygold
-00038d00: 203d 206e 702e 726f 756e 6428 7967 6f6c   = np.round(ygol
-00038d10: 645b 305d 5b30 5d2c 2034 290a 0a20 2020  d[0][0], 4)..   
-00038d20: 2020 2020 2020 2020 2020 2020 2078 6c65               xle
-00038d30: 6e20 3d20 6c65 6e28 786c 6973 7429 0a0a  n = len(xlist)..
-00038d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038d50: 6461 7461 6469 6374 203d 207b 0a20 2020  datadict = {.   
-00038d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038d70: 2027 6375 7276 6573 273a 207b 2766 7363   'curves': {'fsc
-00038d80: 7927 3a20 6e70 2e72 6f75 6e64 286e 702e  y': np.round(np.
-00038d90: 7265 616c 2879 6c69 7374 292c 2034 292e  real(ylist), 4).
-00038da0: 746f 6c69 7374 2829 2c20 2774 6872 6565  tolist(), 'three
-00038db0: 7369 676d 6127 3a20 6e70 2e72 6f75 6e64  sigma': np.round
-00038dc0: 2874 6872 6565 7369 672c 2034 292e 746f  (threesig, 4).to
-00038dd0: 6c69 7374 2829 5b3a 786c 656e 5d2c 0a20  list()[:xlen],. 
-00038de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038df0: 2020 2020 2020 2020 2020 2020 2020 2768                'h
-00038e00: 616c 6662 6974 273a 206e 702e 726f 756e  alfbit': np.roun
-00038e10: 6428 6861 6c66 6269 742c 2034 292e 746f  d(halfbit, 4).to
-00038e20: 6c69 7374 2829 5b3a 786c 656e 5d2c 0a20  list()[:xlen],. 
-00038e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038e40: 2020 2020 2020 2020 2020 2020 2020 276f                'o
-00038e50: 6e65 6269 7427 3a20 6e70 2e72 6f75 6e64  nebit': np.round
-00038e60: 286f 6e65 6269 742c 2034 292e 746f 6c69  (onebit, 4).toli
-00038e70: 7374 2829 5b3a 786c 656e 5d2c 2027 302e  st()[:xlen], '0.
-00038e80: 3527 3a20 662e 746f 6c69 7374 2829 5b3a  5': f.tolist()[:
-00038e90: 786c 656e 5d2c 2027 302e 3333 3327 3a20  xlen], '0.333': 
-00038ea0: 672e 746f 6c69 7374 2829 5b3a 786c 656e  g.tolist()[:xlen
-00038eb0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00038450: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00038460: 2020 2020 2020 2020 2020 2068 203d 2068             h = h
+00038470: 5b3a 6c65 6e28 6229 5d0a 0a20 2020 2020  [:len(b)]..     
+00038480: 2020 2020 2020 2020 2020 2078 7468 7265             xthre
+00038490: 6573 6967 2c20 7974 6872 6565 7369 6720  esig, ythreesig 
+000384a0: 3d20 7365 6c66 2e5f 5f69 6e74 6572 706f  = self.__interpo
+000384b0: 6c61 7465 645f 696e 7465 7263 6570 7428  lated_intercept(
+000384c0: 612c 2062 2c20 6329 0a20 2020 2020 2020  a, b, c).       
+000384d0: 2020 2020 2020 2020 2078 6861 6c66 6269           xhalfbi
+000384e0: 742c 2079 6861 6c66 6269 7420 3d20 7365  t, yhalfbit = se
+000384f0: 6c66 2e5f 5f69 6e74 6572 706f 6c61 7465  lf.__interpolate
+00038500: 645f 696e 7465 7263 6570 7428 612c 2062  d_intercept(a, b
+00038510: 2c20 6429 0a20 2020 2020 2020 2020 2020  , d).           
+00038520: 2020 2020 2078 6f6e 6562 6974 2c20 796f       xonebit, yo
+00038530: 6e65 6269 7420 3d20 7365 6c66 2e5f 5f69  nebit = self.__i
+00038540: 6e74 6572 706f 6c61 7465 645f 696e 7465  nterpolated_inte
+00038550: 7263 6570 7428 612c 2062 2c20 6529 0a20  rcept(a, b, e). 
+00038560: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00038570: 6861 6c66 2c20 7968 616c 6620 3d20 7365  half, yhalf = se
+00038580: 6c66 2e5f 5f69 6e74 6572 706f 6c61 7465  lf.__interpolate
+00038590: 645f 696e 7465 7263 6570 7428 612c 2062  d_intercept(a, b
+000385a0: 2c20 6629 0a20 2020 2020 2020 2020 2020  , f).           
+000385b0: 2020 2020 2078 6f6e 6574 6872 6565 2c20       xonethree, 
+000385c0: 796f 6e65 7468 7265 6520 3d20 7365 6c66  yonethree = self
+000385d0: 2e5f 5f69 6e74 6572 706f 6c61 7465 645f  .__interpolated_
+000385e0: 696e 7465 7263 6570 7428 612c 2062 2c20  intercept(a, b, 
+000385f0: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+00038600: 2020 2078 676f 6c64 2c20 7967 6f6c 6420     xgold, ygold 
+00038610: 3d20 7365 6c66 2e5f 5f69 6e74 6572 706f  = self.__interpo
+00038620: 6c61 7465 645f 696e 7465 7263 6570 7428  lated_intercept(
+00038630: 612c 2062 2c20 6829 0a0a 2020 2020 2020  a, b, h)..      
+00038640: 2020 2020 2020 2020 2020 6966 2078 7468            if xth
+00038650: 7265 6573 6967 2e73 697a 6520 3d3d 2030  reesig.size == 0
+00038660: 2061 6e64 2079 7468 7265 6573 6967 2e73   and ythreesig.s
+00038670: 697a 6520 3d3d 2030 3a0a 2020 2020 2020  ize == 0:.      
+00038680: 2020 2020 2020 2020 2020 2020 2020 7478                tx
+00038690: 7468 7265 6573 6967 203d 204e 6f6e 650a  threesig = None.
+000386a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000386b0: 2020 2020 7479 7468 7265 6573 6967 203d      tythreesig =
+000386c0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+000386d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000386e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000386f0: 7478 7468 7265 6573 6967 203d 206e 702e  txthreesig = np.
+00038700: 726f 756e 6428 7874 6872 6565 7369 675b  round(xthreesig[
+00038710: 305d 5b30 5d2c 2034 290a 2020 2020 2020  0][0], 4).      
+00038720: 2020 2020 2020 2020 2020 2020 2020 7479                ty
+00038730: 7468 7265 6573 6967 203d 206e 702e 726f  threesig = np.ro
+00038740: 756e 6428 7974 6872 6565 7369 675b 305d  und(ythreesig[0]
+00038750: 5b30 5d2c 2034 290a 0a20 2020 2020 2020  [0], 4)..       
+00038760: 2020 2020 2020 2020 2069 6620 7868 616c           if xhal
+00038770: 6662 6974 2e73 697a 6520 3d3d 2030 2061  fbit.size == 0 a
+00038780: 6e64 2079 6861 6c66 6269 742e 7369 7a65  nd yhalfbit.size
+00038790: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000387a0: 2020 2020 2020 2020 2020 2074 7868 616c             txhal
+000387b0: 6662 6974 203d 204e 6f6e 650a 2020 2020  fbit = None.    
+000387c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000387d0: 7479 6861 6c66 6269 7420 3d20 4e6f 6e65  tyhalfbit = None
+000387e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000387f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00038800: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
+00038810: 2e69 736e 616e 2878 6861 6c66 6269 745b  .isnan(xhalfbit[
+00038820: 305d 5b30 5d29 3a0a 2020 2020 2020 2020  0][0]):.        
+00038830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038840: 7478 6861 6c66 6269 7420 3d20 4e6f 6e65  txhalfbit = None
+00038850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00038860: 2020 2020 2020 2020 2074 7968 616c 6662           tyhalfb
+00038870: 6974 203d 204e 6f6e 650a 2020 2020 2020  it = None.      
+00038880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038890: 2020 7072 696e 7428 2721 2121 2054 6865    print('!!! The
+000388a0: 206c 6f61 6465 6420 6673 6320 6861 7320   loaded fsc has 
+000388b0: 6e6f 2069 6e74 6572 7365 6374 696f 6e20  no intersection 
+000388c0: 7769 7468 2074 6865 2068 616c 6620 6269  with the half bi
+000388d0: 7420 6375 7276 6520 2121 2127 290a 2020  t curve !!!').  
+000388e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000388f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00038900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038910: 7478 6861 6c66 6269 7420 3d20 6e70 2e72  txhalfbit = np.r
+00038920: 6f75 6e64 2878 6861 6c66 6269 745b 305d  ound(xhalfbit[0]
+00038930: 5b30 5d2c 2034 290a 2020 2020 2020 2020  [0], 4).        
+00038940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038950: 7479 6861 6c66 6269 7420 3d20 6e70 2e72  tyhalfbit = np.r
+00038960: 6f75 6e64 2879 6861 6c66 6269 745b 305d  ound(yhalfbit[0]
+00038970: 5b30 5d2c 2034 290a 0a20 2020 2020 2020  [0], 4)..       
+00038980: 2020 2020 2020 2020 2069 6620 786f 6e65           if xone
+00038990: 6269 742e 7369 7a65 203d 3d20 3020 616e  bit.size == 0 an
+000389a0: 6420 796f 6e65 6269 742e 7369 7a65 203d  d yonebit.size =
+000389b0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+000389c0: 2020 2020 2020 2020 2074 786f 6e65 6269           txonebi
+000389d0: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
+000389e0: 2020 2020 2020 2020 2020 2020 2074 796f               tyo
+000389f0: 6e65 6269 7420 3d20 4e6f 6e65 0a20 2020  nebit = None.   
+00038a00: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00038a10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00038a20: 2020 2020 2020 2074 786f 6e65 6269 7420         txonebit 
+00038a30: 3d20 6e70 2e72 6f75 6e64 2878 6f6e 6562  = np.round(xoneb
+00038a40: 6974 5b30 5d5b 305d 2c20 3429 0a20 2020  it[0][0], 4).   
+00038a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038a60: 2074 796f 6e65 6269 7420 3d20 6e70 2e72   tyonebit = np.r
+00038a70: 6f75 6e64 2879 6f6e 6562 6974 5b30 5d5b  ound(yonebit[0][
+00038a80: 305d 2c20 3429 0a0a 2020 2020 2020 2020  0], 4)..        
+00038a90: 2020 2020 2020 2020 6966 2078 6861 6c66          if xhalf
+00038aa0: 2e73 697a 6520 3d3d 2030 2061 6e64 2079  .size == 0 and y
+00038ab0: 6861 6c66 2e73 697a 6520 3d3d 2030 3a0a  half.size == 0:.
+00038ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038ad0: 2020 2020 7478 6861 6c66 203d 204e 6f6e      txhalf = Non
+00038ae0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00038af0: 2020 2020 2020 7479 6861 6c66 203d 204e        tyhalf = N
+00038b00: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00038b10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00038b20: 2020 2020 2020 2020 2020 2020 2020 7478                tx
+00038b30: 6861 6c66 203d 206e 702e 726f 756e 6428  half = np.round(
+00038b40: 7868 616c 665b 305d 5b30 5d2c 2034 290a  xhalf[0][0], 4).
+00038b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038b60: 2020 2020 7479 6861 6c66 203d 206e 702e      tyhalf = np.
+00038b70: 726f 756e 6428 7968 616c 665b 305d 5b30  round(yhalf[0][0
+00038b80: 5d2c 2034 290a 0a20 2020 2020 2020 2020  ], 4)..         
+00038b90: 2020 2020 2020 2069 6620 786f 6e65 7468         if xoneth
+00038ba0: 7265 652e 7369 7a65 203d 3d20 3020 616e  ree.size == 0 an
+00038bb0: 6420 796f 6e65 7468 7265 652e 7369 7a65  d yonethree.size
+00038bc0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00038bd0: 2020 2020 2020 2020 2020 2074 786f 6e65             txone
+00038be0: 7468 7265 6520 3d20 4e6f 6e65 0a20 2020  three = None.   
+00038bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c00: 2074 796f 6e65 7468 7265 6520 3d20 4e6f   tyonethree = No
+00038c10: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00038c20: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00038c30: 2020 2020 2020 2020 2020 2020 2074 786f               txo
+00038c40: 6e65 7468 7265 6520 3d20 6e70 2e72 6f75  nethree = np.rou
+00038c50: 6e64 2878 6f6e 6574 6872 6565 5b30 5d5b  nd(xonethree[0][
+00038c60: 305d 2c20 3429 0a20 2020 2020 2020 2020  0], 4).         
+00038c70: 2020 2020 2020 2020 2020 2074 796f 6e65             tyone
+00038c80: 7468 7265 6520 3d20 6e70 2e72 6f75 6e64  three = np.round
+00038c90: 2879 6f6e 6574 6872 6565 5b30 5d5b 305d  (yonethree[0][0]
+00038ca0: 2c20 3429 0a0a 2020 2020 2020 2020 2020  , 4)..          
+00038cb0: 2020 2020 2020 6966 2078 676f 6c64 2e73        if xgold.s
+00038cc0: 697a 6520 3d3d 2030 2061 6e64 2079 676f  ize == 0 and ygo
+00038cd0: 6c64 2e73 697a 6520 3d3d 2030 3a0a 2020  ld.size == 0:.  
+00038ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038cf0: 2020 7478 676f 6c64 203d 204e 6f6e 650a    txgold = None.
+00038d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038d10: 2020 2020 7479 676f 6c64 203d 204e 6f6e      tygold = Non
+00038d20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00038d30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00038d40: 2020 2020 2020 2020 2020 2020 7478 676f              txgo
+00038d50: 6c64 203d 206e 702e 726f 756e 6428 7867  ld = np.round(xg
+00038d60: 6f6c 645b 305d 5b30 5d2c 2034 290a 2020  old[0][0], 4).  
+00038d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038d80: 2020 7479 676f 6c64 203d 206e 702e 726f    tygold = np.ro
+00038d90: 756e 6428 7967 6f6c 645b 305d 5b30 5d2c  und(ygold[0][0],
+00038da0: 2034 290a 0a20 2020 2020 2020 2020 2020   4)..           
+00038db0: 2020 2020 2078 6c65 6e20 3d20 6c65 6e28       xlen = len(
+00038dc0: 786c 6973 7429 0a0a 2020 2020 2020 2020  xlist)..        
+00038dd0: 2020 2020 2020 2020 6461 7461 6469 6374          datadict
+00038de0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00038df0: 2020 2020 2020 2020 2027 6375 7276 6573           'curves
+00038e00: 273a 207b 2766 7363 7927 3a20 6e70 2e72  ': {'fscy': np.r
+00038e10: 6f75 6e64 286e 702e 7265 616c 2879 6c69  ound(np.real(yli
+00038e20: 7374 292c 2034 292e 746f 6c69 7374 2829  st), 4).tolist()
+00038e30: 2c20 2774 6872 6565 7369 676d 6127 3a20  , 'threesigma': 
+00038e40: 6e70 2e72 6f75 6e64 2874 6872 6565 7369  np.round(threesi
+00038e50: 672c 2034 292e 746f 6c69 7374 2829 5b3a  g, 4).tolist()[:
+00038e60: 786c 656e 5d2c 0a20 2020 2020 2020 2020  xlen],.         
+00038e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038e80: 2020 2020 2020 2768 616c 6662 6974 273a        'halfbit':
+00038e90: 206e 702e 726f 756e 6428 6861 6c66 6269   np.round(halfbi
+00038ea0: 742c 2034 292e 746f 6c69 7374 2829 5b3a  t, 4).tolist()[:
+00038eb0: 786c 656e 5d2c 0a20 2020 2020 2020 2020  xlen],.         
 00038ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038ed0: 2020 2730 2e31 3433 273a 2068 2e74 6f6c    '0.143': h.tol
-00038ee0: 6973 7428 295b 3a78 6c65 6e5d 2c0a 2020  ist()[:xlen],.  
-00038ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038f00: 2020 2020 2020 2020 2020 2020 2027 6c65               'le
-00038f10: 7665 6c27 3a20 6e70 2e72 6f75 6e64 286e  vel': np.round(n
-00038f20: 702e 7265 616c 2878 6c69 7374 292c 2034  p.real(xlist), 4
-00038f30: 292e 746f 6c69 7374 2829 2c0a 2020 2020  ).tolist(),.    
+00038ed0: 2020 2020 2020 276f 6e65 6269 7427 3a20        'onebit': 
+00038ee0: 6e70 2e72 6f75 6e64 286f 6e65 6269 742c  np.round(onebit,
+00038ef0: 2034 292e 746f 6c69 7374 2829 5b3a 786c   4).tolist()[:xl
+00038f00: 656e 5d2c 2027 302e 3527 3a20 662e 746f  en], '0.5': f.to
+00038f10: 6c69 7374 2829 5b3a 786c 656e 5d2c 2027  list()[:xlen], '
+00038f20: 302e 3333 3327 3a20 672e 746f 6c69 7374  0.333': g.tolist
+00038f30: 2829 5b3a 786c 656e 5d2c 0a20 2020 2020  ()[:xlen],.     
 00038f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038f50: 2020 2020 2020 2020 2020 2027 6673 6378             'fscx
-00038f60: 273a 206e 702e 726f 756e 6428 6e70 2e72  ': np.round(np.r
-00038f70: 6561 6c28 786c 6973 7429 2c20 3429 2e74  eal(xlist), 4).t
-00038f80: 6f6c 6973 7428 297d 2c0a 2020 2020 2020  olist()},.      
-00038f90: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-00038fa0: 6e74 6572 7365 6374 696f 6e73 273a 207b  ntersections': {
-00038fb0: 2774 6872 6565 7369 6727 3a20 7b27 7827  'threesig': {'x'
-00038fc0: 3a20 7478 7468 7265 6573 6967 2c20 2779  : txthreesig, 'y
-00038fd0: 273a 2074 7974 6872 6565 7369 677d 2c0a  ': tythreesig},.
-00038fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039000: 2020 2020 2020 2768 616c 6662 6974 273a        'halfbit':
-00039010: 207b 2778 273a 2074 7868 616c 6662 6974   {'x': txhalfbit
-00039020: 2c20 2779 273a 2074 7968 616c 6662 6974  , 'y': tyhalfbit
-00039030: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-00039040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039050: 2020 2020 2020 2020 2027 6f6e 6562 6974           'onebit
-00039060: 273a 207b 2778 273a 2074 786f 6e65 6269  ': {'x': txonebi
-00039070: 742c 2027 7927 3a20 7479 6f6e 6562 6974  t, 'y': tyonebit
-00039080: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-00039090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000390a0: 2020 2020 2020 2020 2027 302e 3527 3a20           '0.5': 
-000390b0: 7b27 7827 3a20 7478 6861 6c66 2c20 2779  {'x': txhalf, 'y
-000390c0: 273a 2074 7968 616c 667d 2c0a 2020 2020  ': tyhalf},.    
+00038f50: 2020 2020 2020 2020 2020 2730 2e31 3433            '0.143
+00038f60: 273a 2068 2e74 6f6c 6973 7428 295b 3a78  ': h.tolist()[:x
+00038f70: 6c65 6e5d 2c0a 2020 2020 2020 2020 2020  len],.          
+00038f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038f90: 2020 2020 2027 6c65 7665 6c27 3a20 6e70       'level': np
+00038fa0: 2e72 6f75 6e64 286e 702e 7265 616c 2878  .round(np.real(x
+00038fb0: 6c69 7374 292c 2034 292e 746f 6c69 7374  list), 4).tolist
+00038fc0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+00038fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038fe0: 2020 2027 6673 6378 273a 206e 702e 726f     'fscx': np.ro
+00038ff0: 756e 6428 6e70 2e72 6561 6c28 786c 6973  und(np.real(xlis
+00039000: 7429 2c20 3429 2e74 6f6c 6973 7428 297d  t), 4).tolist()}
+00039010: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00039020: 2020 2020 2020 2769 6e74 6572 7365 6374        'intersect
+00039030: 696f 6e73 273a 207b 2774 6872 6565 7369  ions': {'threesi
+00039040: 6727 3a20 7b27 7827 3a20 7478 7468 7265  g': {'x': txthre
+00039050: 6573 6967 2c20 2779 273a 2074 7974 6872  esig, 'y': tythr
+00039060: 6565 7369 677d 2c0a 2020 2020 2020 2020  eesig},.        
+00039070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039080: 2020 2020 2020 2020 2020 2020 2020 2768                'h
+00039090: 616c 6662 6974 273a 207b 2778 273a 2074  alfbit': {'x': t
+000390a0: 7868 616c 6662 6974 2c20 2779 273a 2074  xhalfbit, 'y': t
+000390b0: 7968 616c 6662 6974 7d2c 0a20 2020 2020  yhalfbit},.     
+000390c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000390d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000390e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000390f0: 2020 2730 2e33 3333 273a 207b 2778 273a    '0.333': {'x':
-00039100: 2074 786f 6e65 7468 7265 652c 2027 7927   txonethree, 'y'
-00039110: 3a20 7479 6f6e 6574 6872 6565 7d2c 0a20  : tyonethree},. 
+000390e0: 2027 6f6e 6562 6974 273a 207b 2778 273a   'onebit': {'x':
+000390f0: 2074 786f 6e65 6269 742c 2027 7927 3a20   txonebit, 'y': 
+00039100: 7479 6f6e 6562 6974 7d2c 0a20 2020 2020  tyonebit},.     
+00039110: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00039120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039140: 2020 2020 2027 302e 3134 3327 3a20 7b27       '0.143': {'
-00039150: 7827 3a20 7478 676f 6c64 2c20 2779 273a  x': txgold, 'y':
-00039160: 2074 7967 6f6c 647d 7d7d 0a0a 2020 2020   tygold}}}..    
-00039170: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-00039180: 6c64 6963 745b 276c 6f61 645f 6673 6327  ldict['load_fsc'
-00039190: 5d20 3d20 6461 7461 6469 6374 0a0a 2020  ] = datadict..  
-000391a0: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-000391b0: 742e 706c 6f74 2878 6c69 7374 2c20 796c  t.plot(xlist, yl
-000391c0: 6973 742c 206c 6162 656c 3d27 5072 6f76  ist, label='Prov
-000391d0: 6964 6564 2046 5343 2729 0a20 2020 2020  ided FSC').     
-000391e0: 2020 2020 2020 2020 2020 2023 706c 742e             #plt.
-000391f0: 706c 6f74 2869 6e64 6961 7869 732c 2074  plot(indiaxis, t
-00039200: 6872 6565 7369 672c 206c 6162 656c 3d27  hreesig, label='
-00039210: 3320 7369 676d 6127 290a 2020 2020 2020  3 sigma').      
-00039220: 2020 2020 2020 2020 2020 2370 6c74 2e70            #plt.p
-00039230: 6c6f 7428 696e 6469 6178 6973 2c20 6861  lot(indiaxis, ha
-00039240: 6c66 6269 742c 206c 6162 656c 3d27 312f  lfbit, label='1/
-00039250: 3220 6269 7427 290a 2020 2020 2020 2020  2 bit').        
-00039260: 2020 2020 2020 2020 2370 6c74 2e70 6c6f          #plt.plo
-00039270: 7428 696e 6469 6178 6973 2c20 6f6e 6562  t(indiaxis, oneb
-00039280: 6974 2c20 6c61 6265 6c3d 2731 2062 6974  it, label='1 bit
-00039290: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000392a0: 2020 2070 6c74 2e70 6c6f 7428 786c 6973     plt.plot(xlis
-000392b0: 745b 3a2d 315d 2c20 6c65 6e28 786c 6973  t[:-1], len(xlis
-000392c0: 745b 3a2d 315d 292a 5b30 2e35 5d2c 206c  t[:-1])*[0.5], l
-000392d0: 696e 6573 7479 6c65 3d27 3a27 2c20 6c61  inestyle=':', la
-000392e0: 6265 6c3d 275f 6e6f 6c65 6765 6e64 5f27  bel='_nolegend_'
-000392f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00039300: 2020 2370 6c74 2e70 6c6f 7428 696e 6469    #plt.plot(indi
-00039310: 6178 6973 2c20 672c 206c 6162 656c 3d27  axis, g, label='
-00039320: 302e 3333 3327 2c20 6c69 6e65 7374 796c  0.333', linestyl
-00039330: 653d 272d 2d27 290a 2020 2020 2020 2020  e='--').        
-00039340: 2020 2020 2020 2020 706c 742e 706c 6f74          plt.plot
-00039350: 2878 6c69 7374 5b3a 2d31 5d2c 206c 656e  (xlist[:-1], len
-00039360: 2878 6c69 7374 5b3a 2d31 5d29 2a5b 302e  (xlist[:-1])*[0.
-00039370: 3134 335d 2c20 6c69 6e65 7374 796c 653d  143], linestyle=
-00039380: 272d 2e27 2c20 6c61 6265 6c3d 275f 6e6f  '-.', label='_no
-00039390: 6c65 6765 6e64 5f27 290a 2020 2020 2020  legend_').      
-000393a0: 2020 2020 2020 2020 2020 706c 742e 6c65            plt.le
-000393b0: 6765 6e64 2829 0a20 2020 2020 2020 2020  gend().         
-000393c0: 2020 2020 2020 2070 6c74 2e73 6176 6566         plt.savef
-000393d0: 6967 2873 656c 662e 776f 726b 6469 7220  ig(self.workdir 
-000393e0: 2b20 7365 6c66 2e6d 6170 6e61 6d65 202b  + self.mapname +
-000393f0: 2027 5f66 7363 2e70 6e67 2729 0a20 2020   '_fsc.png').   
-00039400: 2020 2020 2020 2020 2020 2020 2070 6c74               plt
-00039410: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-00039420: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00039430: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00039440: 203d 2027 4653 4320 7265 6164 696e 6720   = 'FSC reading 
-00039450: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
-00039460: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-00039470: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-00039480: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
-00039490: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
-000394a0: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-000394b0: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
-000394c0: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
-000394d0: 2020 2020 6966 2065 7272 6c69 7374 3a0a      if errlist:.
-000394e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000394f0: 6669 6e61 6c64 6963 745b 276c 6f61 645f  finaldict['load_
-00039500: 6673 6327 5d20 3d20 7b27 6572 7227 3a20  fsc'] = {'err': 
-00039510: 7b27 6c6f 6164 5f66 7363 5f65 7272 273a  {'load_fsc_err':
-00039520: 2065 7272 6c69 7374 7d7d 0a0a 2020 2020   errlist}}..    
-00039530: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00039540: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-00039550: 6820 636f 6465 6373 2e6f 7065 6e28 7365  h codecs.open(se
-00039560: 6c66 2e77 6f72 6b64 6972 202b 2073 656c  lf.workdir + sel
-00039570: 662e 6d61 706e 616d 6520 2b20 275f 6c6f  f.mapname + '_lo
-00039580: 6164 6673 632e 6a73 6f6e 272c 2027 7727  adfsc.json', 'w'
-00039590: 2c20 656e 636f 6469 6e67 3d27 7574 662d  , encoding='utf-
-000395a0: 3827 2920 6173 2066 3a0a 2020 2020 2020  8') as f:.      
-000395b0: 2020 2020 2020 2020 2020 2020 2020 6a73                js
-000395c0: 6f6e 2e64 756d 7028 6669 6e61 6c64 6963  on.dump(finaldic
-000395d0: 742c 2066 290a 0a20 2020 2020 2020 2020  t, f)..         
-000395e0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000395f0: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-00039600: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-00039610: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-00039620: 722e 7772 6974 6528 2753 6176 696e 6720  r.write('Saving 
-00039630: 6c6f 6164 6564 2046 5343 2074 6f20 6a73  loaded FSC to js
-00039640: 6f6e 2065 7272 6f72 3a7b 7d2e 5c6e 272e  on error:{}.\n'.
-00039650: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
-00039660: 6e66 6f28 295b 315d 2929 0a20 2020 2020  nfo()[1])).     
-00039670: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00039680: 2020 2020 2070 7269 6e74 2827 4e6f 2066       print('No f
-00039690: 7363 2e78 6d6c 2066 696c 6520 6361 6e20  sc.xml file can 
-000396a0: 6265 2072 6561 6420 666f 7220 4653 4320  be read for FSC 
-000396b0: 696e 666f 726d 6174 696f 6e2e 2729 0a0a  information.')..
-000396c0: 0a20 2020 2023 2040 7072 6f66 696c 650a  .    # @profile.
-000396d0: 2020 2020 6465 6620 6673 6328 7365 6c66      def fsc(self
-000396e0: 2c20 6d61 706f 6464 2c20 6d61 7065 7665  , mapodd, mapeve
-000396f0: 6e2c 2061 7379 6d3d 312e 302c 206c 6162  n, asym=1.0, lab
-00039700: 656c 3d27 2729 3a0a 2020 2020 2020 2020  el=''):.        
-00039710: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
-00039720: 2043 616c 6375 6c61 7465 2046 5343 2062   Calculate FSC b
-00039730: 6173 6564 206f 6e20 7468 6520 7477 6f20  ased on the two 
-00039740: 696e 7075 7420 6861 6c66 206d 6170 730a  input half maps.
-00039750: 2020 2020 2020 2020 2020 2020 5265 7375              Resu
-00039760: 6c74 7320 7772 6f74 6520 746f 204a 534f  lts wrote to JSO
-00039770: 4e20 6669 6c65 2069 6e63 6c75 6469 6e67  N file including
-00039780: 2072 6573 6f6c 7574 696f 6e20 6174 2030   resolution at 0
-00039790: 2e31 3433 2c20 302e 3333 332c 2030 2e35  .143, 0.333, 0.5
-000397a0: 2061 6e64 206e 6f69 7365 0a20 2020 2020   and noise.     
-000397b0: 2020 2020 2020 206c 6576 656c 2061 7420         level at 
-000397c0: 302e 352d 6269 742c 2031 2d62 6974 2c20  0.5-bit, 1-bit, 
-000397d0: 332d 7369 676d 612e 2041 2063 6f72 7265  3-sigma. A corre
-000397e0: 7370 6f6e 6469 6e67 2070 6c6f 7420 6973  sponding plot is
-000397f0: 2061 6c73 6f20 7361 7665 2061 7320 504e   also save as PN
-00039800: 4720 6669 6c65 2e0a 0a20 2020 2020 2020  G file...       
-00039810: 203a 7061 7261 6d20 6d61 706f 6464 3a20   :param mapodd: 
-00039820: 5445 4d50 7920 6d61 7020 696e 7374 616e  TEMPy map instan
-00039830: 6365 0a20 2020 2020 2020 203a 7061 7261  ce.        :para
-00039840: 6d20 6d61 7065 7665 6e3a 2054 454d 5079  m mapeven: TEMPy
-00039850: 206d 6170 2069 6e73 7461 6e63 650a 2020   map instance.  
-00039860: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
-00039870: 6f6e 650a 0a20 2020 2020 2020 2022 2222  one..        """
-00039880: 0a0a 2020 2020 2020 2020 7374 6172 7420  ..        start 
-00039890: 3d20 7469 6d65 6974 2e64 6566 6175 6c74  = timeit.default
-000398a0: 5f74 696d 6572 2829 0a20 2020 2020 2020  _timer().       
-000398b0: 2065 7272 6c69 7374 203d 205b 5d0a 2020   errlist = [].  
-000398c0: 2020 2020 2020 6461 7461 6469 6374 203d        datadict =
-000398d0: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-000398e0: 6669 6e61 6c64 6963 7420 3d20 6469 6374  finaldict = dict
-000398f0: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
-00039900: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00039910: 7274 206d 6170 6f64 642e 6461 7461 2e73  rt mapodd.data.s
-00039920: 6861 7065 203d 3d20 6d61 7065 7665 6e2e  hape == mapeven.
-00039930: 6461 7461 2e73 6861 7065 2c20 2754 6865  data.shape, 'The
-00039940: 2074 776f 2068 616c 6620 6d61 7073 2064   two half maps d
-00039950: 6f20 6e6f 7420 6861 7665 2073 616d 6520  o not have same 
-00039960: 7369 7a65 2e27 0a20 2020 2020 2020 2020  size.'.         
-00039970: 2020 2061 7373 6572 7420 6d61 706f 6464     assert mapodd
-00039980: 2e76 6f78 656c 5f73 697a 6520 3d3d 206d  .voxel_size == m
-00039990: 6170 6576 656e 2e76 6f78 656c 5f73 697a  apeven.voxel_siz
-000399a0: 652c 2027 5468 6520 7477 6f20 6861 6c66  e, 'The two half
-000399b0: 206d 6170 7320 646f 206e 6f74 2068 6176   maps do not hav
-000399c0: 6520 7361 6d65 2061 7069 782e 270a 2020  e same apix.'.  
-000399d0: 2020 2020 2020 2020 2020 6f64 646e 616e            oddnan
-000399e0: 203d 206e 702e 6973 6e61 6e28 6d61 706f   = np.isnan(mapo
-000399f0: 6464 2e64 6174 6129 2e61 6e79 2829 0a20  dd.data).any(). 
-00039a00: 2020 2020 2020 2020 2020 2065 7665 6e6e             evenn
-00039a10: 616e 203d 206e 702e 6973 6e61 6e28 6d61  an = np.isnan(ma
-00039a20: 7065 7665 6e2e 6461 7461 292e 616e 7928  peven.data).any(
-00039a30: 290a 2020 2020 2020 2020 2020 2020 6e61  ).            na
-00039a40: 6e63 6865 636b 203d 206f 6464 6e61 6e20  ncheck = oddnan 
-00039a50: 7c20 6576 656e 6e61 6e0a 2020 2020 2020  | evennan.      
-00039a60: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-00039a70: 206e 616e 6368 6563 6b2c 2027 5468 6572   nancheck, 'Ther
-00039a80: 6520 6973 204e 614e 2076 616c 7565 2069  e is NaN value i
-00039a90: 6e20 6861 6c66 206d 6170 2e27 0a0a 2020  n half map.'..  
-00039aa0: 2020 2020 2020 2020 2020 6d61 705f 7a73            map_zs
-00039ab0: 697a 6520 3d20 6d61 706f 6464 2e68 6561  ize = mapodd.hea
-00039ac0: 6465 722e 6e7a 0a20 2020 2020 2020 2020  der.nz.         
-00039ad0: 2020 206d 6170 5f79 7369 7a65 203d 206d     map_ysize = m
-00039ae0: 6170 6f64 642e 6865 6164 6572 2e6e 790a  apodd.header.ny.
-00039af0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-00039b00: 7873 697a 6520 3d20 6d61 706f 6464 2e68  xsize = mapodd.h
-00039b10: 6561 6465 722e 6e78 0a0a 2020 2020 2020  eader.nx..      
-00039b20: 2020 2020 2020 6170 6978 7320 3d20 7475        apixs = tu
-00039b30: 706c 6528 6d61 706f 6464 2e76 6f78 656c  ple(mapodd.voxel
-00039b40: 5f73 697a 652e 746f 6c69 7374 2829 290a  _size.tolist()).
-00039b50: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00039b60: 6f64 645f 6461 7461 203d 2066 6674 7368  odd_data = fftsh
-00039b70: 6966 7428 6666 746e 286d 6170 6f64 642e  ift(fftn(mapodd.
-00039b80: 6461 7461 2929 0a20 2020 2020 2020 2020  data)).         
-00039b90: 2020 206d 6170 6576 656e 5f64 6174 6120     mapeven_data 
-00039ba0: 3d20 6666 7473 6869 6674 2866 6674 6e28  = fftshift(fftn(
-00039bb0: 6d61 7065 7665 6e2e 6461 7461 2929 0a0a  mapeven.data))..
-00039bc0: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00039bd0: 7420 3d20 7469 6d65 6974 2e64 6566 6175  t = timeit.defau
-00039be0: 6c74 5f74 696d 6572 2829 202d 2073 7461  lt_timer() - sta
-00039bf0: 7274 0a20 2020 2020 2020 2020 2020 2070  rt.            p
-00039c00: 7269 6e74 2827 202d 2d20 4653 4320 466f  rint(' -- FSC Fo
-00039c10: 7572 6965 722d 7472 616e 7366 6f72 6d61  urier-transforma
-00039c20: 7469 6f6e 2074 696d 653a 2025 7327 2025  tion time: %s' %
-00039c30: 2073 7461 7274 290a 0a20 2020 2020 2020   start)..       
-00039c40: 2020 2020 2023 2047 7269 6420 6865 7265       # Grid here
-00039c50: 2074 6f20 6765 6e65 7261 7465 2066 6f72   to generate for
-00039c60: 2074 7261 6369 6e67 2074 6865 2069 6e64   tracing the ind
-00039c70: 6963 6573 206f 6620 6772 6964 7320 7769  ices of grids wi
-00039c80: 7468 2069 6e20 7468 6520 7368 656c 6c73  th in the shells
-00039c90: 2e0a 2020 2020 2020 2020 2020 2020 7a67  ..            zg
-00039ca0: 7269 6420 3d20 6e70 2e61 7261 6e67 6528  rid = np.arange(
-00039cb0: 666c 6f6f 7228 6d61 705f 7a73 697a 6520  floor(map_zsize 
-00039cc0: 2f20 322e 3029 202a 202d 312c 2063 6569  / 2.0) * -1, cei
-00039cd0: 6c28 6d61 705f 7a73 697a 6520 2f20 322e  l(map_zsize / 2.
-00039ce0: 3029 2920 2f20 666c 6f61 7428 0a20 2020  0)) / float(.   
-00039cf0: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
-00039d00: 6f72 286d 6170 5f7a 7369 7a65 2929 0a20  or(map_zsize)). 
-00039d10: 2020 2020 2020 2020 2020 2079 6772 6964             ygrid
-00039d20: 203d 206e 702e 6172 616e 6765 2866 6c6f   = np.arange(flo
-00039d30: 6f72 286d 6170 5f79 7369 7a65 202f 2032  or(map_ysize / 2
-00039d40: 2e30 2920 2a20 2d31 2c20 6365 696c 286d  .0) * -1, ceil(m
-00039d50: 6170 5f79 7369 7a65 202f 2032 2e30 2929  ap_ysize / 2.0))
-00039d60: 202f 2066 6c6f 6174 280a 2020 2020 2020   / float(.      
-00039d70: 2020 2020 2020 2020 2020 666c 6f6f 7228            floor(
-00039d80: 6d61 705f 7973 697a 6529 290a 2020 2020  map_ysize)).    
-00039d90: 2020 2020 2020 2020 7867 7269 6420 3d20          xgrid = 
-00039da0: 6e70 2e61 7261 6e67 6528 666c 6f6f 7228  np.arange(floor(
-00039db0: 6d61 705f 7873 697a 6520 2f20 322e 3029  map_xsize / 2.0)
-00039dc0: 202a 202d 312c 2063 6569 6c28 6d61 705f   * -1, ceil(map_
-00039dd0: 7873 697a 6520 2f20 322e 3029 2920 2f20  xsize / 2.0)) / 
-00039de0: 666c 6f61 7428 0a20 2020 2020 2020 2020  float(.         
-00039df0: 2020 2020 2020 2066 6c6f 6f72 286d 6170         floor(map
-00039e00: 5f78 7369 7a65 2929 0a20 2020 2020 2020  _xsize)).       
-00039e10: 2020 2020 2078 6469 7320 3d20 7867 7269       xdis = xgri
-00039e20: 6420 2a2a 2032 0a20 2020 2020 2020 2020  d ** 2.         
-00039e30: 2020 2079 6469 7320 3d20 7967 7269 6420     ydis = ygrid 
-00039e40: 2a2a 2032 0a20 2020 2020 2020 2020 2020  ** 2.           
-00039e50: 207a 6469 7320 3d20 7a67 7269 6420 2a2a   zdis = zgrid **
-00039e60: 2032 0a20 2020 2020 2020 2020 2020 2064   2.            d
-00039e70: 6973 7420 3d20 6e70 2e73 7172 7428 7a64  ist = np.sqrt(zd
-00039e80: 6973 5b3a 2c20 4e6f 6e65 2c20 4e6f 6e65  is[:, None, None
-00039e90: 5d20 2b20 7964 6973 5b3a 2c20 4e6f 6e65  ] + ydis[:, None
-00039ea0: 5d20 2b20 7864 6973 290a 0a20 2020 2020  ] + xdis)..     
-00039eb0: 2020 2020 2020 2061 6c6c 6178 6973 203d         allaxis =
-00039ec0: 206e 702e 6172 7261 7928 5b7a 6772 6964   np.array([zgrid
-00039ed0: 2c20 7967 7269 642c 2078 6772 6964 5d29  , ygrid, xgrid])
-00039ee0: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
-00039ef0: 696e 6469 6178 6973 203d 206d 6178 2861  indiaxis = max(a
-00039f00: 6c6c 6178 6973 2c20 6b65 793d 6c65 6e29  llaxis, key=len)
-00039f10: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00039f20: 6961 7869 7374 203d 2074 6d70 696e 6469  iaxist = tmpindi
-00039f30: 6178 6973 5b74 6d70 696e 6469 6178 6973  axis[tmpindiaxis
-00039f40: 203e 3d20 305d 0a20 2020 2020 2020 2020   >= 0].         
-00039f50: 2020 206c 696e 6469 203d 206c 656e 2869     lindi = len(i
-00039f60: 6e64 6961 7869 7374 290a 2020 2020 2020  ndiaxist).      
-00039f70: 2020 2020 2020 6966 2074 7970 6528 6170        if type(ap
-00039f80: 6978 7329 2069 7320 7475 706c 653a 0a20  ixs) is tuple:. 
-00039f90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00039fa0: 6170 6978 203d 2061 7069 7873 5b30 5d0a  apix = apixs[0].
-00039fb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00039fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00039fd0: 2020 7461 7069 7820 3d20 6170 6978 730a    tapix = apixs.
-00039fe0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00039ff0: 6178 6973 203d 206e 702e 6c69 6e73 7061  axis = np.linspa
-0003a000: 6365 2830 2c20 3120 2f20 2832 202a 2074  ce(0, 1 / (2 * t
-0003a010: 6170 6978 292c 206c 696e 6469 290a 0a20  apix), lindi).. 
-0003a020: 2020 2020 2020 2020 2020 2023 204c 6f6f             # Loo
-0003a030: 7069 6e67 2074 6872 6f75 6768 2061 6c6c  ping through all
-0003a040: 2073 6865 6c6c 730a 2020 2020 2020 2020   shells.        
-0003a050: 2020 2020 636f 7272 6c69 7374 203d 205b      corrlist = [
-0003a060: 5d0a 2020 2020 2020 2020 2020 2020 7468  ].            th
-0003a070: 7265 6573 6967 203d 205b 5d0a 2020 2020  reesig = [].    
-0003a080: 2020 2020 2020 2020 6861 6c66 6269 7420          halfbit 
-0003a090: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0003a0a0: 206f 6e65 6269 7420 3d20 5b5d 0a20 2020   onebit = [].   
-0003a0b0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-0003a0c0: 6e20 7261 6e67 6528 6c65 6e28 696e 6469  n range(len(indi
-0003a0d0: 6178 6973 2929 3a0a 2020 2020 2020 2020  axis)):.        
-0003a0e0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
-0003a0f0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0003a100: 2020 2020 2020 2069 6e64 6963 6573 203d         indices =
-0003a110: 206e 702e 6172 6777 6865 7265 2864 6973   np.argwhere(dis
-0003a120: 7420 3d3d 2069 6e64 6961 7869 735b 695d  t == indiaxis[i]
-0003a130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003a140: 2020 2020 2020 6f64 6472 696e 6720 3d20        oddring = 
-0003a150: 6d61 706f 6464 5f64 6174 615b 7475 706c  mapodd_data[tupl
-0003a160: 6528 696e 6469 6365 732e 5429 5d0a 2020  e(indices.T)].  
-0003a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a180: 2020 6576 656e 7269 6e67 203d 206d 6170    evenring = map
-0003a190: 6576 656e 5f64 6174 615b 7475 706c 6528  even_data[tuple(
-0003a1a0: 696e 6469 6365 732e 5429 5d0a 0a20 2020  indices.T)]..   
-0003a1b0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0003a1c0: 6620 6920 213d 206c 656e 2869 6e64 6961  f i != len(india
-0003a1d0: 7869 7329 202d 2031 3a0a 2020 2020 2020  xis) - 1:.      
-0003a1e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0003a1f0: 6469 6365 7320 3d20 6e70 2e61 7267 7768  dices = np.argwh
-0003a200: 6572 6528 2864 6973 7420 3e20 696e 6469  ere((dist > indi
-0003a210: 6178 6973 745b 695d 2920 2620 2864 6973  axist[i]) & (dis
-0003a220: 7420 3c3d 2069 6e64 6961 7869 7374 5b69  t <= indiaxist[i
-0003a230: 202b 2031 5d29 290a 2020 2020 2020 2020   + 1])).        
-0003a240: 2020 2020 2020 2020 2020 2020 6f64 6472              oddr
-0003a250: 696e 6720 3d20 6d61 706f 6464 5f64 6174  ing = mapodd_dat
-0003a260: 615b 7475 706c 6528 696e 6469 6365 732e  a[tuple(indices.
-0003a270: 5429 5d0a 2020 2020 2020 2020 2020 2020  T)].            
-0003a280: 2020 2020 2020 2020 6576 656e 7269 6e67          evenring
-0003a290: 203d 206d 6170 6576 656e 5f64 6174 615b   = mapeven_data[
-0003a2a0: 7475 706c 6528 696e 6469 6365 732e 5429  tuple(indices.T)
-0003a2b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0003a2c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0003a2d0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-0003a2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a2f0: 2063 6f72 7220 3d20 286f 6464 7269 6e67   corr = (oddring
-0003a300: 202a 206e 702e 636f 6e6a 2865 7665 6e72   * np.conj(evenr
-0003a310: 696e 6729 292e 7375 6d28 290a 2020 2020  ing)).sum().    
-0003a320: 2020 2020 2020 2020 2020 2020 636f 7272              corr
-0003a330: 5f64 656e 6f20 3d20 6e70 2e73 7172 7428  _deno = np.sqrt(
-0003a340: 286e 702e 6162 7328 6f64 6472 696e 6729  (np.abs(oddring)
-0003a350: 202a 2a20 3229 2e73 756d 2829 202a 2028   ** 2).sum() * (
-0003a360: 6e70 2e61 6273 2865 7665 6e72 696e 6729  np.abs(evenring)
-0003a370: 202a 2a20 3229 2e73 756d 2829 290a 2020   ** 2).sum()).  
-0003a380: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0003a390: 2063 6f72 725f 6465 6e6f 203d 3d20 302e   corr_deno == 0.
-0003a3a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a3b0: 2020 2020 2020 6e6f 7263 6f72 7220 3d20        norcorr = 
-0003a3c0: 302e 0a20 2020 2020 2020 2020 2020 2020  0..             
-0003a3d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003a3e0: 2020 2020 2020 2020 2020 2020 206e 6f72               nor
-0003a3f0: 636f 7272 203d 206e 702e 7265 616c 2863  corr = np.real(c
-0003a400: 6f72 7220 2f20 636f 7272 5f64 656e 6f29  orr / corr_deno)
-0003a410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a420: 2063 6f72 726c 6973 742e 6170 7065 6e64   corrlist.append
-0003a430: 286e 6f72 636f 7272 290a 0a20 2020 2020  (norcorr)..     
-0003a440: 2020 2020 2020 2020 2020 2076 6f6c 756d             volum
-0003a450: 6564 6966 6620 3d20 2834 2e30 202f 2033  ediff = (4.0 / 3
-0003a460: 2e30 2920 2a20 7069 202a 2028 2869 202b  .0) * pi * ((i +
-0003a470: 2031 2920 2a2a 2033 202d 2069 202a 2a20   1) ** 3 - i ** 
-0003a480: 3329 0a20 2020 2020 2020 2020 2020 2020  3).             
-0003a490: 2020 206e 766f 7872 696e 6720 3d20 766f     nvoxring = vo
-0003a4a0: 6c75 6d65 6469 6666 202f 2028 3120 2a2a  lumediff / (1 **
-0003a4b0: 2033 290a 2020 2020 2020 2020 2020 2020   3).            
-0003a4c0: 2020 2020 6566 666e 766f 7820 3d20 286e      effnvox = (n
-0003a4d0: 766f 7872 696e 6720 2a20 2828 312e 3520  voxring * ((1.5 
-0003a4e0: 2a20 302e 3636 2920 2a2a 2032 2929 202f  * 0.66) ** 2)) /
-0003a4f0: 2028 3220 2a20 6173 796d 290a 2020 2020   (2 * asym).    
-0003a500: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0003a510: 6666 6e76 6f78 203c 2031 2e30 3a20 6566  ffnvox < 1.0: ef
-0003a520: 666e 766f 7820 3d20 312e 300a 2020 2020  fnvox = 1.0.    
-0003a530: 2020 2020 2020 2020 2020 2020 7371 7265              sqre
-0003a540: 6666 6e76 6f78 203d 206e 702e 7371 7274  ffnvox = np.sqrt
-0003a550: 2865 6666 6e76 6f78 290a 0a0a 2020 2020  (effnvox)...    
-0003a560: 2020 2020 2020 2020 2020 2020 2320 332d              # 3-
-0003a570: 7369 676d 6120 6375 7276 650a 2020 2020  sigma curve.    
-0003a580: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0003a590: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-0003a5a0: 2020 2020 2020 2020 2020 2073 6967 7661             sigva
-0003a5b0: 6c75 6520 3d20 3320 2f20 2873 7172 6566  lue = 3 / (sqref
-0003a5c0: 666e 766f 7820 2b20 332e 3020 2d20 312e  fnvox + 3.0 - 1.
-0003a5d0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0003a5e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003a5f0: 2020 2020 2020 2020 2020 2020 2073 6967               sig
-0003a600: 7661 6c75 6520 3d20 310a 2020 2020 2020  value = 1.      
-0003a610: 2020 2020 2020 2020 2020 7468 7265 6573            threes
-0003a620: 6967 2e61 7070 656e 6428 7369 6776 616c  ig.append(sigval
-0003a630: 7565 290a 0a20 2020 2020 2020 2020 2020  ue)..           
-0003a640: 2020 2020 2023 2048 616c 6620 6269 7420       # Half bit 
-0003a650: 6375 7276 650a 2020 2020 2020 2020 2020  curve.          
-0003a660: 2020 2020 2020 6966 2069 2021 3d20 303a        if i != 0:
+00039130: 2027 302e 3527 3a20 7b27 7827 3a20 7478   '0.5': {'x': tx
+00039140: 6861 6c66 2c20 2779 273a 2074 7968 616c  half, 'y': tyhal
+00039150: 667d 2c0a 2020 2020 2020 2020 2020 2020  f},.            
+00039160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039170: 2020 2020 2020 2020 2020 2730 2e33 3333            '0.333
+00039180: 273a 207b 2778 273a 2074 786f 6e65 7468  ': {'x': txoneth
+00039190: 7265 652c 2027 7927 3a20 7479 6f6e 6574  ree, 'y': tyonet
+000391a0: 6872 6565 7d2c 0a20 2020 2020 2020 2020  hree},.         
+000391b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000391c0: 2020 2020 2020 2020 2020 2020 2027 302e               '0.
+000391d0: 3134 3327 3a20 7b27 7827 3a20 7478 676f  143': {'x': txgo
+000391e0: 6c64 2c20 2779 273a 2074 7967 6f6c 647d  ld, 'y': tygold}
+000391f0: 7d7d 0a0a 2020 2020 2020 2020 2020 2020  }}..            
+00039200: 2020 2020 6669 6e61 6c64 6963 745b 276c      finaldict['l
+00039210: 6f61 645f 6673 6327 5d20 3d20 6461 7461  oad_fsc'] = data
+00039220: 6469 6374 0a0a 2020 2020 2020 2020 2020  dict..          
+00039230: 2020 2020 2020 706c 742e 706c 6f74 2878        plt.plot(x
+00039240: 6c69 7374 2c20 796c 6973 742c 206c 6162  list, ylist, lab
+00039250: 656c 3d27 5072 6f76 6964 6564 2046 5343  el='Provided FSC
+00039260: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00039270: 2020 2023 706c 742e 706c 6f74 2869 6e64     #plt.plot(ind
+00039280: 6961 7869 732c 2074 6872 6565 7369 672c  iaxis, threesig,
+00039290: 206c 6162 656c 3d27 3320 7369 676d 6127   label='3 sigma'
+000392a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000392b0: 2020 2370 6c74 2e70 6c6f 7428 696e 6469    #plt.plot(indi
+000392c0: 6178 6973 2c20 6861 6c66 6269 742c 206c  axis, halfbit, l
+000392d0: 6162 656c 3d27 312f 3220 6269 7427 290a  abel='1/2 bit').
+000392e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000392f0: 2370 6c74 2e70 6c6f 7428 696e 6469 6178  #plt.plot(indiax
+00039300: 6973 2c20 6f6e 6562 6974 2c20 6c61 6265  is, onebit, labe
+00039310: 6c3d 2731 2062 6974 2729 0a20 2020 2020  l='1 bit').     
+00039320: 2020 2020 2020 2020 2020 2070 6c74 2e70             plt.p
+00039330: 6c6f 7428 786c 6973 745b 3a2d 315d 2c20  lot(xlist[:-1], 
+00039340: 6c65 6e28 786c 6973 745b 3a2d 315d 292a  len(xlist[:-1])*
+00039350: 5b30 2e35 5d2c 206c 696e 6573 7479 6c65  [0.5], linestyle
+00039360: 3d27 3a27 2c20 6c61 6265 6c3d 275f 6e6f  =':', label='_no
+00039370: 6c65 6765 6e64 5f27 290a 2020 2020 2020  legend_').      
+00039380: 2020 2020 2020 2020 2020 2370 6c74 2e70            #plt.p
+00039390: 6c6f 7428 696e 6469 6178 6973 2c20 672c  lot(indiaxis, g,
+000393a0: 206c 6162 656c 3d27 302e 3333 3327 2c20   label='0.333', 
+000393b0: 6c69 6e65 7374 796c 653d 272d 2d27 290a  linestyle='--').
+000393c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000393d0: 706c 742e 706c 6f74 2878 6c69 7374 5b3a  plt.plot(xlist[:
+000393e0: 2d31 5d2c 206c 656e 2878 6c69 7374 5b3a  -1], len(xlist[:
+000393f0: 2d31 5d29 2a5b 302e 3134 335d 2c20 6c69  -1])*[0.143], li
+00039400: 6e65 7374 796c 653d 272d 2e27 2c20 6c61  nestyle='-.', la
+00039410: 6265 6c3d 275f 6e6f 6c65 6765 6e64 5f27  bel='_nolegend_'
+00039420: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00039430: 2020 706c 742e 6c65 6765 6e64 2829 0a20    plt.legend(). 
+00039440: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00039450: 6c74 2e73 6176 6566 6967 2873 656c 662e  lt.savefig(self.
+00039460: 776f 726b 6469 7220 2b20 7365 6c66 2e6d  workdir + self.m
+00039470: 6170 6e61 6d65 202b 2027 5f66 7363 2e70  apname + '_fsc.p
+00039480: 6e67 2729 0a20 2020 2020 2020 2020 2020  ng').           
+00039490: 2020 2020 2070 6c74 2e63 6c6f 7365 2829       plt.close()
+000394a0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+000394b0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+000394c0: 2020 2020 2065 7272 203d 2027 4653 4320       err = 'FSC 
+000394d0: 7265 6164 696e 6720 6572 726f 723a 207b  reading error: {
+000394e0: 7d2e 272e 666f 726d 6174 2873 7973 2e65  }.'.format(sys.e
+000394f0: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
+00039500: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00039510: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
+00039520: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00039530: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
+00039540: 7465 2865 7272 202b 2027 5c6e 2729 0a0a  te(err + '\n')..
+00039550: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00039560: 7272 6c69 7374 3a0a 2020 2020 2020 2020  rrlist:.        
+00039570: 2020 2020 2020 2020 6669 6e61 6c64 6963          finaldic
+00039580: 745b 276c 6f61 645f 6673 6327 5d20 3d20  t['load_fsc'] = 
+00039590: 7b27 6572 7227 3a20 7b27 6c6f 6164 5f66  {'err': {'load_f
+000395a0: 7363 5f65 7272 273a 2065 7272 6c69 7374  sc_err': errlist
+000395b0: 7d7d 0a0a 2020 2020 2020 2020 2020 2020  }}..            
+000395c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000395d0: 2020 2020 2077 6974 6820 636f 6465 6373       with codecs
+000395e0: 2e6f 7065 6e28 7365 6c66 2e77 6f72 6b64  .open(self.workd
+000395f0: 6972 202b 2073 656c 662e 6d61 706e 616d  ir + self.mapnam
+00039600: 6520 2b20 275f 6c6f 6164 6673 632e 6a73  e + '_loadfsc.js
+00039610: 6f6e 272c 2027 7727 2c20 656e 636f 6469  on', 'w', encodi
+00039620: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
+00039630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00039640: 2020 2020 2020 6a73 6f6e 2e64 756d 7028        json.dump(
+00039650: 6669 6e61 6c64 6963 742c 2066 290a 0a20  finaldict, f).. 
+00039660: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00039670: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+00039680: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+00039690: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000396a0: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+000396b0: 2753 6176 696e 6720 6c6f 6164 6564 2046  'Saving loaded F
+000396c0: 5343 2074 6f20 6a73 6f6e 2065 7272 6f72  SC to json error
+000396d0: 3a7b 7d2e 5c6e 272e 666f 726d 6174 2873  :{}.\n'.format(s
+000396e0: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+000396f0: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
+00039700: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00039710: 6e74 2827 4e6f 2066 7363 2e78 6d6c 2066  nt('No fsc.xml f
+00039720: 696c 6520 6361 6e20 6265 2072 6561 6420  ile can be read 
+00039730: 666f 7220 4653 4320 696e 666f 726d 6174  for FSC informat
+00039740: 696f 6e2e 2729 0a0a 0a20 2020 2023 2040  ion.')...    # @
+00039750: 7072 6f66 696c 650a 2020 2020 6465 6620  profile.    def 
+00039760: 6673 6328 7365 6c66 2c20 6d61 706f 6464  fsc(self, mapodd
+00039770: 2c20 6d61 7065 7665 6e2c 2061 7379 6d3d  , mapeven, asym=
+00039780: 312e 302c 206c 6162 656c 3d27 2729 3a0a  1.0, label=''):.
+00039790: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000397a0: 2020 2020 2020 2020 2043 616c 6375 6c61           Calcula
+000397b0: 7465 2046 5343 2062 6173 6564 206f 6e20  te FSC based on 
+000397c0: 7468 6520 7477 6f20 696e 7075 7420 6861  the two input ha
+000397d0: 6c66 206d 6170 730a 2020 2020 2020 2020  lf maps.        
+000397e0: 2020 2020 5265 7375 6c74 7320 7772 6f74      Results wrot
+000397f0: 6520 746f 204a 534f 4e20 6669 6c65 2069  e to JSON file i
+00039800: 6e63 6c75 6469 6e67 2072 6573 6f6c 7574  ncluding resolut
+00039810: 696f 6e20 6174 2030 2e31 3433 2c20 302e  ion at 0.143, 0.
+00039820: 3333 332c 2030 2e35 2061 6e64 206e 6f69  333, 0.5 and noi
+00039830: 7365 0a20 2020 2020 2020 2020 2020 206c  se.            l
+00039840: 6576 656c 2061 7420 302e 352d 6269 742c  evel at 0.5-bit,
+00039850: 2031 2d62 6974 2c20 332d 7369 676d 612e   1-bit, 3-sigma.
+00039860: 2041 2063 6f72 7265 7370 6f6e 6469 6e67   A corresponding
+00039870: 2070 6c6f 7420 6973 2061 6c73 6f20 7361   plot is also sa
+00039880: 7665 2061 7320 504e 4720 6669 6c65 2e0a  ve as PNG file..
+00039890: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000398a0: 6d61 706f 6464 3a20 5445 4d50 7920 6d61  mapodd: TEMPy ma
+000398b0: 7020 696e 7374 616e 6365 0a20 2020 2020  p instance.     
+000398c0: 2020 203a 7061 7261 6d20 6d61 7065 7665     :param mapeve
+000398d0: 6e3a 2054 454d 5079 206d 6170 2069 6e73  n: TEMPy map ins
+000398e0: 7461 6e63 650a 2020 2020 2020 2020 3a72  tance.        :r
+000398f0: 6574 7572 6e3a 204e 6f6e 650a 0a20 2020  eturn: None..   
+00039900: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00039910: 2020 7374 6172 7420 3d20 7469 6d65 6974    start = timeit
+00039920: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
+00039930: 0a20 2020 2020 2020 2065 7272 6c69 7374  .        errlist
+00039940: 203d 205b 5d0a 2020 2020 2020 2020 6461   = [].        da
+00039950: 7461 6469 6374 203d 2064 6963 7428 290a  tadict = dict().
+00039960: 2020 2020 2020 2020 6669 6e61 6c64 6963          finaldic
+00039970: 7420 3d20 6469 6374 2829 0a20 2020 2020  t = dict().     
+00039980: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00039990: 2020 2020 6173 7365 7274 206d 6170 6f64      assert mapod
+000399a0: 642e 6461 7461 2e73 6861 7065 203d 3d20  d.data.shape == 
+000399b0: 6d61 7065 7665 6e2e 6461 7461 2e73 6861  mapeven.data.sha
+000399c0: 7065 2c20 2754 6865 2074 776f 2068 616c  pe, 'The two hal
+000399d0: 6620 6d61 7073 2064 6f20 6e6f 7420 6861  f maps do not ha
+000399e0: 7665 2073 616d 6520 7369 7a65 2e27 0a20  ve same size.'. 
+000399f0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00039a00: 7420 6d61 706f 6464 2e76 6f78 656c 5f73  t mapodd.voxel_s
+00039a10: 697a 6520 3d3d 206d 6170 6576 656e 2e76  ize == mapeven.v
+00039a20: 6f78 656c 5f73 697a 652c 2027 5468 6520  oxel_size, 'The 
+00039a30: 7477 6f20 6861 6c66 206d 6170 7320 646f  two half maps do
+00039a40: 206e 6f74 2068 6176 6520 7361 6d65 2061   not have same a
+00039a50: 7069 782e 270a 2020 2020 2020 2020 2020  pix.'.          
+00039a60: 2020 6f64 646e 616e 203d 206e 702e 6973    oddnan = np.is
+00039a70: 6e61 6e28 6d61 706f 6464 2e64 6174 6129  nan(mapodd.data)
+00039a80: 2e61 6e79 2829 0a20 2020 2020 2020 2020  .any().         
+00039a90: 2020 2065 7665 6e6e 616e 203d 206e 702e     evennan = np.
+00039aa0: 6973 6e61 6e28 6d61 7065 7665 6e2e 6461  isnan(mapeven.da
+00039ab0: 7461 292e 616e 7928 290a 2020 2020 2020  ta).any().      
+00039ac0: 2020 2020 2020 6e61 6e63 6865 636b 203d        nancheck =
+00039ad0: 206f 6464 6e61 6e20 7c20 6576 656e 6e61   oddnan | evenna
+00039ae0: 6e0a 2020 2020 2020 2020 2020 2020 6173  n.            as
+00039af0: 7365 7274 206e 6f74 206e 616e 6368 6563  sert not nanchec
+00039b00: 6b2c 2027 5468 6572 6520 6973 204e 614e  k, 'There is NaN
+00039b10: 2076 616c 7565 2069 6e20 6861 6c66 206d   value in half m
+00039b20: 6170 2e27 0a0a 2020 2020 2020 2020 2020  ap.'..          
+00039b30: 2020 6d61 705f 7a73 697a 6520 3d20 6d61    map_zsize = ma
+00039b40: 706f 6464 2e68 6561 6465 722e 6e7a 0a20  podd.header.nz. 
+00039b50: 2020 2020 2020 2020 2020 206d 6170 5f79             map_y
+00039b60: 7369 7a65 203d 206d 6170 6f64 642e 6865  size = mapodd.he
+00039b70: 6164 6572 2e6e 790a 2020 2020 2020 2020  ader.ny.        
+00039b80: 2020 2020 6d61 705f 7873 697a 6520 3d20      map_xsize = 
+00039b90: 6d61 706f 6464 2e68 6561 6465 722e 6e78  mapodd.header.nx
+00039ba0: 0a0a 2020 2020 2020 2020 2020 2020 6170  ..            ap
+00039bb0: 6978 7320 3d20 7475 706c 6528 6d61 706f  ixs = tuple(mapo
+00039bc0: 6464 2e76 6f78 656c 5f73 697a 652e 746f  dd.voxel_size.to
+00039bd0: 6c69 7374 2829 290a 0a20 2020 2020 2020  list())..       
+00039be0: 2020 2020 206d 6170 6f64 645f 6461 7461       mapodd_data
+00039bf0: 203d 2066 6674 7368 6966 7428 6666 746e   = fftshift(fftn
+00039c00: 286d 6170 6f64 642e 6461 7461 2929 0a20  (mapodd.data)). 
+00039c10: 2020 2020 2020 2020 2020 206d 6170 6576             mapev
+00039c20: 656e 5f64 6174 6120 3d20 6666 7473 6869  en_data = fftshi
+00039c30: 6674 2866 6674 6e28 6d61 7065 7665 6e2e  ft(fftn(mapeven.
+00039c40: 6461 7461 2929 0a0a 2020 2020 2020 2020  data))..        
+00039c50: 2020 2020 7374 6172 7420 3d20 7469 6d65      start = time
+00039c60: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
+00039c70: 2829 202d 2073 7461 7274 0a20 2020 2020  () - start.     
+00039c80: 2020 2020 2020 2070 7269 6e74 2827 202d         print(' -
+00039c90: 2d20 4653 4320 466f 7572 6965 722d 7472  - FSC Fourier-tr
+00039ca0: 616e 7366 6f72 6d61 7469 6f6e 2074 696d  ansformation tim
+00039cb0: 653a 2025 7327 2025 2073 7461 7274 290a  e: %s' % start).
+00039cc0: 0a20 2020 2020 2020 2020 2020 2023 2047  .            # G
+00039cd0: 7269 6420 6865 7265 2074 6f20 6765 6e65  rid here to gene
+00039ce0: 7261 7465 2066 6f72 2074 7261 6369 6e67  rate for tracing
+00039cf0: 2074 6865 2069 6e64 6963 6573 206f 6620   the indices of 
+00039d00: 6772 6964 7320 7769 7468 2069 6e20 7468  grids with in th
+00039d10: 6520 7368 656c 6c73 2e0a 2020 2020 2020  e shells..      
+00039d20: 2020 2020 2020 7a67 7269 6420 3d20 6e70        zgrid = np
+00039d30: 2e61 7261 6e67 6528 666c 6f6f 7228 6d61  .arange(floor(ma
+00039d40: 705f 7a73 697a 6520 2f20 322e 3029 202a  p_zsize / 2.0) *
+00039d50: 202d 312c 2063 6569 6c28 6d61 705f 7a73   -1, ceil(map_zs
+00039d60: 697a 6520 2f20 322e 3029 2920 2f20 666c  ize / 2.0)) / fl
+00039d70: 6f61 7428 0a20 2020 2020 2020 2020 2020  oat(.           
+00039d80: 2020 2020 2066 6c6f 6f72 286d 6170 5f7a       floor(map_z
+00039d90: 7369 7a65 2929 0a20 2020 2020 2020 2020  size)).         
+00039da0: 2020 2079 6772 6964 203d 206e 702e 6172     ygrid = np.ar
+00039db0: 616e 6765 2866 6c6f 6f72 286d 6170 5f79  ange(floor(map_y
+00039dc0: 7369 7a65 202f 2032 2e30 2920 2a20 2d31  size / 2.0) * -1
+00039dd0: 2c20 6365 696c 286d 6170 5f79 7369 7a65  , ceil(map_ysize
+00039de0: 202f 2032 2e30 2929 202f 2066 6c6f 6174   / 2.0)) / float
+00039df0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00039e00: 2020 666c 6f6f 7228 6d61 705f 7973 697a    floor(map_ysiz
+00039e10: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
+00039e20: 7867 7269 6420 3d20 6e70 2e61 7261 6e67  xgrid = np.arang
+00039e30: 6528 666c 6f6f 7228 6d61 705f 7873 697a  e(floor(map_xsiz
+00039e40: 6520 2f20 322e 3029 202a 202d 312c 2063  e / 2.0) * -1, c
+00039e50: 6569 6c28 6d61 705f 7873 697a 6520 2f20  eil(map_xsize / 
+00039e60: 322e 3029 2920 2f20 666c 6f61 7428 0a20  2.0)) / float(. 
+00039e70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00039e80: 6c6f 6f72 286d 6170 5f78 7369 7a65 2929  loor(map_xsize))
+00039e90: 0a20 2020 2020 2020 2020 2020 2078 6469  .            xdi
+00039ea0: 7320 3d20 7867 7269 6420 2a2a 2032 0a20  s = xgrid ** 2. 
+00039eb0: 2020 2020 2020 2020 2020 2079 6469 7320             ydis 
+00039ec0: 3d20 7967 7269 6420 2a2a 2032 0a20 2020  = ygrid ** 2.   
+00039ed0: 2020 2020 2020 2020 207a 6469 7320 3d20           zdis = 
+00039ee0: 7a67 7269 6420 2a2a 2032 0a20 2020 2020  zgrid ** 2.     
+00039ef0: 2020 2020 2020 2064 6973 7420 3d20 6e70         dist = np
+00039f00: 2e73 7172 7428 7a64 6973 5b3a 2c20 4e6f  .sqrt(zdis[:, No
+00039f10: 6e65 2c20 4e6f 6e65 5d20 2b20 7964 6973  ne, None] + ydis
+00039f20: 5b3a 2c20 4e6f 6e65 5d20 2b20 7864 6973  [:, None] + xdis
+00039f30: 290a 0a20 2020 2020 2020 2020 2020 2061  )..            a
+00039f40: 6c6c 6178 6973 203d 206e 702e 6172 7261  llaxis = np.arra
+00039f50: 7928 5b7a 6772 6964 2c20 7967 7269 642c  y([zgrid, ygrid,
+00039f60: 2078 6772 6964 5d29 0a20 2020 2020 2020   xgrid]).       
+00039f70: 2020 2020 2074 6d70 696e 6469 6178 6973       tmpindiaxis
+00039f80: 203d 206d 6178 2861 6c6c 6178 6973 2c20   = max(allaxis, 
+00039f90: 6b65 793d 6c65 6e29 0a20 2020 2020 2020  key=len).       
+00039fa0: 2020 2020 2069 6e64 6961 7869 7374 203d       indiaxist =
+00039fb0: 2074 6d70 696e 6469 6178 6973 5b74 6d70   tmpindiaxis[tmp
+00039fc0: 696e 6469 6178 6973 203e 3d20 305d 0a20  indiaxis >= 0]. 
+00039fd0: 2020 2020 2020 2020 2020 206c 696e 6469             lindi
+00039fe0: 203d 206c 656e 2869 6e64 6961 7869 7374   = len(indiaxist
+00039ff0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0003a000: 2074 7970 6528 6170 6978 7329 2069 7320   type(apixs) is 
+0003a010: 7475 706c 653a 0a20 2020 2020 2020 2020  tuple:.         
+0003a020: 2020 2020 2020 2074 6170 6978 203d 2061         tapix = a
+0003a030: 7069 7873 5b30 5d0a 2020 2020 2020 2020  pixs[0].        
+0003a040: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003a050: 2020 2020 2020 2020 2020 7461 7069 7820            tapix 
+0003a060: 3d20 6170 6978 730a 2020 2020 2020 2020  = apixs.        
+0003a070: 2020 2020 696e 6469 6178 6973 203d 206e      indiaxis = n
+0003a080: 702e 6c69 6e73 7061 6365 2830 2c20 3120  p.linspace(0, 1 
+0003a090: 2f20 2832 202a 2074 6170 6978 292c 206c  / (2 * tapix), l
+0003a0a0: 696e 6469 290a 0a20 2020 2020 2020 2020  indi)..         
+0003a0b0: 2020 2023 204c 6f6f 7069 6e67 2074 6872     # Looping thr
+0003a0c0: 6f75 6768 2061 6c6c 2073 6865 6c6c 730a  ough all shells.
+0003a0d0: 2020 2020 2020 2020 2020 2020 636f 7272              corr
+0003a0e0: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
+0003a0f0: 2020 2020 2020 7468 7265 6573 6967 203d        threesig =
+0003a100: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0003a110: 6861 6c66 6269 7420 3d20 5b5d 0a20 2020  halfbit = [].   
+0003a120: 2020 2020 2020 2020 206f 6e65 6269 7420           onebit 
+0003a130: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0003a140: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0003a150: 6c65 6e28 696e 6469 6178 6973 2929 3a0a  len(indiaxis)):.
+0003a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a170: 6966 2069 203d 3d20 303a 0a20 2020 2020  if i == 0:.     
+0003a180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003a190: 6e64 6963 6573 203d 206e 702e 6172 6777  ndices = np.argw
+0003a1a0: 6865 7265 2864 6973 7420 3d3d 2069 6e64  here(dist == ind
+0003a1b0: 6961 7869 735b 695d 290a 2020 2020 2020  iaxis[i]).      
+0003a1c0: 2020 2020 2020 2020 2020 2020 2020 6f64                od
+0003a1d0: 6472 696e 6720 3d20 6d61 706f 6464 5f64  dring = mapodd_d
+0003a1e0: 6174 615b 7475 706c 6528 696e 6469 6365  ata[tuple(indice
+0003a1f0: 732e 5429 5d0a 2020 2020 2020 2020 2020  s.T)].          
+0003a200: 2020 2020 2020 2020 2020 6576 656e 7269            evenri
+0003a210: 6e67 203d 206d 6170 6576 656e 5f64 6174  ng = mapeven_dat
+0003a220: 615b 7475 706c 6528 696e 6469 6365 732e  a[tuple(indices.
+0003a230: 5429 5d0a 0a20 2020 2020 2020 2020 2020  T)]..           
+0003a240: 2020 2020 2065 6c69 6620 6920 213d 206c       elif i != l
+0003a250: 656e 2869 6e64 6961 7869 7329 202d 2031  en(indiaxis) - 1
+0003a260: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a270: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
+0003a280: 6e70 2e61 7267 7768 6572 6528 2864 6973  np.argwhere((dis
+0003a290: 7420 3e20 696e 6469 6178 6973 745b 695d  t > indiaxist[i]
+0003a2a0: 2920 2620 2864 6973 7420 3c3d 2069 6e64  ) & (dist <= ind
+0003a2b0: 6961 7869 7374 5b69 202b 2031 5d29 290a  iaxist[i + 1])).
+0003a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a2d0: 2020 2020 6f64 6472 696e 6720 3d20 6d61      oddring = ma
+0003a2e0: 706f 6464 5f64 6174 615b 7475 706c 6528  podd_data[tuple(
+0003a2f0: 696e 6469 6365 732e 5429 5d0a 2020 2020  indices.T)].    
+0003a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a310: 6576 656e 7269 6e67 203d 206d 6170 6576  evenring = mapev
+0003a320: 656e 5f64 6174 615b 7475 706c 6528 696e  en_data[tuple(in
+0003a330: 6469 6365 732e 5429 5d0a 2020 2020 2020  dices.T)].      
+0003a340: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0003a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a360: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0003a370: 2020 2020 2020 2020 2063 6f72 7220 3d20           corr = 
+0003a380: 286f 6464 7269 6e67 202a 206e 702e 636f  (oddring * np.co
+0003a390: 6e6a 2865 7665 6e72 696e 6729 292e 7375  nj(evenring)).su
+0003a3a0: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
+0003a3b0: 2020 2020 636f 7272 5f64 656e 6f20 3d20      corr_deno = 
+0003a3c0: 6e70 2e73 7172 7428 286e 702e 6162 7328  np.sqrt((np.abs(
+0003a3d0: 6f64 6472 696e 6729 202a 2a20 3229 2e73  oddring) ** 2).s
+0003a3e0: 756d 2829 202a 2028 6e70 2e61 6273 2865  um() * (np.abs(e
+0003a3f0: 7665 6e72 696e 6729 202a 2a20 3229 2e73  venring) ** 2).s
+0003a400: 756d 2829 290a 2020 2020 2020 2020 2020  um()).          
+0003a410: 2020 2020 2020 6966 2063 6f72 725f 6465        if corr_de
+0003a420: 6e6f 203d 3d20 302e 3a0a 2020 2020 2020  no == 0.:.      
+0003a430: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0003a440: 7263 6f72 7220 3d20 302e 0a20 2020 2020  rcorr = 0..     
+0003a450: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0003a460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a470: 2020 2020 206e 6f72 636f 7272 203d 206e       norcorr = n
+0003a480: 702e 7265 616c 2863 6f72 7220 2f20 636f  p.real(corr / co
+0003a490: 7272 5f64 656e 6f29 0a20 2020 2020 2020  rr_deno).       
+0003a4a0: 2020 2020 2020 2020 2063 6f72 726c 6973           corrlis
+0003a4b0: 742e 6170 7065 6e64 286e 6f72 636f 7272  t.append(norcorr
+0003a4c0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0003a4d0: 2020 2076 6f6c 756d 6564 6966 6620 3d20     volumediff = 
+0003a4e0: 2834 2e30 202f 2033 2e30 2920 2a20 7069  (4.0 / 3.0) * pi
+0003a4f0: 202a 2028 2869 202b 2031 2920 2a2a 2033   * ((i + 1) ** 3
+0003a500: 202d 2069 202a 2a20 3329 0a20 2020 2020   - i ** 3).     
+0003a510: 2020 2020 2020 2020 2020 206e 766f 7872             nvoxr
+0003a520: 696e 6720 3d20 766f 6c75 6d65 6469 6666  ing = volumediff
+0003a530: 202f 2028 3120 2a2a 2033 290a 2020 2020   / (1 ** 3).    
+0003a540: 2020 2020 2020 2020 2020 2020 6566 666e              effn
+0003a550: 766f 7820 3d20 286e 766f 7872 696e 6720  vox = (nvoxring 
+0003a560: 2a20 2828 312e 3520 2a20 302e 3636 2920  * ((1.5 * 0.66) 
+0003a570: 2a2a 2032 2929 202f 2028 3220 2a20 6173  ** 2)) / (2 * as
+0003a580: 796d 290a 2020 2020 2020 2020 2020 2020  ym).            
+0003a590: 2020 2020 6966 2065 6666 6e76 6f78 203c      if effnvox <
+0003a5a0: 2031 2e30 3a20 6566 666e 766f 7820 3d20   1.0: effnvox = 
+0003a5b0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
+0003a5c0: 2020 2020 7371 7265 6666 6e76 6f78 203d      sqreffnvox =
+0003a5d0: 206e 702e 7371 7274 2865 6666 6e76 6f78   np.sqrt(effnvox
+0003a5e0: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
+0003a5f0: 2020 2020 2320 332d 7369 676d 6120 6375      # 3-sigma cu
+0003a600: 7276 650a 2020 2020 2020 2020 2020 2020  rve.            
+0003a610: 2020 2020 6966 2069 2021 3d20 303a 0a20      if i != 0:. 
+0003a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a630: 2020 2073 6967 7661 6c75 6520 3d20 3320     sigvalue = 3 
+0003a640: 2f20 2873 7172 6566 666e 766f 7820 2b20  / (sqreffnvox + 
+0003a650: 332e 3020 2d20 312e 3029 0a20 2020 2020  3.0 - 1.0).     
+0003a660: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
 0003a670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a680: 2020 2020 2062 6974 7661 6c75 6520 3d20       bitvalue = 
-0003a690: 2830 2e32 3037 3120 2b20 312e 3931 3032  (0.2071 + 1.9102
-0003a6a0: 202f 2073 7172 6566 666e 766f 7829 202f   / sqreffnvox) /
-0003a6b0: 2028 312e 3230 3731 202b 2030 2e39 3130   (1.2071 + 0.910
-0003a6c0: 3220 2f20 7371 7265 6666 6e76 6f78 290a  2 / sqreffnvox).
-0003a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a6e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003a6f0: 2020 2020 2020 2020 2020 6269 7476 616c            bitval
-0003a700: 7565 203d 2031 0a20 2020 2020 2020 2020  ue = 1.         
-0003a710: 2020 2020 2020 2068 616c 6662 6974 2e61         halfbit.a
-0003a720: 7070 656e 6428 6269 7476 616c 7565 290a  ppend(bitvalue).
-0003a730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a740: 2069 6620 6920 213d 2030 3a0a 2020 2020   if i != 0:.    
-0003a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a760: 6f6e 6562 6974 7661 6c75 6520 3d20 2830  onebitvalue = (0
-0003a770: 2e35 202b 2032 2e34 3134 3220 2f20 7371  .5 + 2.4142 / sq
-0003a780: 7265 6666 6e76 6f78 2920 2f20 2831 2e35  reffnvox) / (1.5
-0003a790: 202b 2031 2e34 3134 3220 2f20 7371 7265   + 1.4142 / sqre
-0003a7a0: 6666 6e76 6f78 290a 2020 2020 2020 2020  ffnvox).        
-0003a7b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a7d0: 2020 6f6e 6562 6974 7661 6c75 6520 3d20    onebitvalue = 
-0003a7e0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-0003a7f0: 2020 6f6e 6562 6974 2e61 7070 656e 6428    onebit.append(
-0003a800: 6f6e 6562 6974 7661 6c75 6529 0a20 2020  onebitvalue).   
-0003a810: 2020 2020 2020 2020 2070 7269 6e74 2863           print(c
-0003a820: 6f72 726c 6973 7429 0a0a 2020 2020 2020  orrlist)..      
-0003a830: 2020 2020 2020 6966 2063 6f72 726c 6973        if corrlis
-0003a840: 745b 305d 203c 3d20 303a 0a20 2020 2020  t[0] <= 0:.     
-0003a850: 2020 2020 2020 2020 2020 2063 6f72 726c             corrl
-0003a860: 6973 745b 305d 203d 2031 0a20 2020 2020  ist[0] = 1.     
-0003a870: 2020 2020 2020 2061 203d 206e 702e 6173         a = np.as
-0003a880: 6172 7261 7928 696e 6469 6178 6973 290a  array(indiaxis).
-0003a890: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
-0003a8a0: 6e70 2e61 7361 7272 6179 2863 6f72 726c  np.asarray(corrl
-0003a8b0: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
-0003a8c0: 2063 203d 206e 702e 6173 6172 7261 7928   c = np.asarray(
-0003a8d0: 7468 7265 6573 6967 290a 2020 2020 2020  threesig).      
-0003a8e0: 2020 2020 2020 6420 3d20 6e70 2e61 7361        d = np.asa
-0003a8f0: 7272 6179 2868 616c 6662 6974 290a 2020  rray(halfbit).  
-0003a900: 2020 2020 2020 2020 2020 6520 3d20 6e70            e = np
-0003a910: 2e61 7361 7272 6179 286f 6e65 6269 7429  .asarray(onebit)
-0003a920: 0a20 2020 2020 2020 2020 2020 2066 203d  .            f =
-0003a930: 206e 702e 6675 6c6c 2828 6c65 6e28 696e   np.full((len(in
-0003a940: 6469 6178 6973 2929 2c20 302e 3529 0a20  diaxis)), 0.5). 
-0003a950: 2020 2020 2020 2020 2020 2067 203d 206e             g = n
-0003a960: 702e 6675 6c6c 2828 6c65 6e28 696e 6469  p.full((len(indi
-0003a970: 6178 6973 2929 2c20 302e 3333 3329 0a20  axis)), 0.333). 
-0003a980: 2020 2020 2020 2020 2020 2068 203d 206e             h = n
-0003a990: 702e 6675 6c6c 2828 6c65 6e28 696e 6469  p.full((len(indi
-0003a9a0: 6178 6973 2929 2c20 302e 3134 3329 0a20  axis)), 0.143). 
-0003a9b0: 2020 2020 2020 2020 2020 2023 2075 7365             # use
-0003a9c0: 205b 3a31 5d20 746f 2069 676e 6f72 6520   [:1] to ignore 
-0003a9d0: 616c 6c20 7468 6520 6375 7276 6573 2073  all the curves s
-0003a9e0: 7461 7274 2066 726f 6d20 302c 310a 2020  tart from 0,1.  
-0003a9f0: 2020 2020 2020 2020 2020 7874 6872 6565            xthree
-0003aa00: 7369 672c 2079 7468 7265 6573 6967 203d  sig, ythreesig =
-0003aa10: 2073 656c 662e 5f5f 696e 7465 7270 6f6c   self.__interpol
-0003aa20: 6174 6564 5f69 6e74 6572 6365 7074 2861  ated_intercept(a
-0003aa30: 2c20 622c 2063 290a 2020 2020 2020 2020  , b, c).        
-0003aa40: 2020 2020 7868 616c 6662 6974 2c20 7968      xhalfbit, yh
-0003aa50: 616c 6662 6974 203d 2073 656c 662e 5f5f  alfbit = self.__
-0003aa60: 696e 7465 7270 6f6c 6174 6564 5f69 6e74  interpolated_int
-0003aa70: 6572 6365 7074 2861 2c20 622c 2064 290a  ercept(a, b, d).
-0003aa80: 2020 2020 2020 2020 2020 2020 786f 6e65              xone
-0003aa90: 6269 742c 2079 6f6e 6562 6974 203d 2073  bit, yonebit = s
-0003aaa0: 656c 662e 5f5f 696e 7465 7270 6f6c 6174  elf.__interpolat
-0003aab0: 6564 5f69 6e74 6572 6365 7074 2861 2c20  ed_intercept(a, 
-0003aac0: 622c 2065 290a 2020 2020 2020 2020 2020  b, e).          
-0003aad0: 2020 7868 616c 662c 2079 6861 6c66 203d    xhalf, yhalf =
+0003a680: 2020 2020 2073 6967 7661 6c75 6520 3d20       sigvalue = 
+0003a690: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0003a6a0: 2020 7468 7265 6573 6967 2e61 7070 656e    threesig.appen
+0003a6b0: 6428 7369 6776 616c 7565 290a 0a20 2020  d(sigvalue)..   
+0003a6c0: 2020 2020 2020 2020 2020 2020 2023 2048               # H
+0003a6d0: 616c 6620 6269 7420 6375 7276 650a 2020  alf bit curve.  
+0003a6e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003a6f0: 2069 2021 3d20 303a 0a20 2020 2020 2020   i != 0:.       
+0003a700: 2020 2020 2020 2020 2020 2020 2062 6974               bit
+0003a710: 7661 6c75 6520 3d20 2830 2e32 3037 3120  value = (0.2071 
+0003a720: 2b20 312e 3931 3032 202f 2073 7172 6566  + 1.9102 / sqref
+0003a730: 666e 766f 7829 202f 2028 312e 3230 3731  fnvox) / (1.2071
+0003a740: 202b 2030 2e39 3130 3220 2f20 7371 7265   + 0.9102 / sqre
+0003a750: 6666 6e76 6f78 290a 2020 2020 2020 2020  ffnvox).        
+0003a760: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a780: 2020 6269 7476 616c 7565 203d 2031 0a20    bitvalue = 1. 
+0003a790: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0003a7a0: 616c 6662 6974 2e61 7070 656e 6428 6269  alfbit.append(bi
+0003a7b0: 7476 616c 7565 290a 0a20 2020 2020 2020  tvalue)..       
+0003a7c0: 2020 2020 2020 2020 2069 6620 6920 213d           if i !=
+0003a7d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0003a7e0: 2020 2020 2020 2020 6f6e 6562 6974 7661          onebitva
+0003a7f0: 6c75 6520 3d20 2830 2e35 202b 2032 2e34  lue = (0.5 + 2.4
+0003a800: 3134 3220 2f20 7371 7265 6666 6e76 6f78  142 / sqreffnvox
+0003a810: 2920 2f20 2831 2e35 202b 2031 2e34 3134  ) / (1.5 + 1.414
+0003a820: 3220 2f20 7371 7265 6666 6e76 6f78 290a  2 / sqreffnvox).
+0003a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a840: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0003a850: 2020 2020 2020 2020 2020 6f6e 6562 6974            onebit
+0003a860: 7661 6c75 6520 3d20 310a 2020 2020 2020  value = 1.      
+0003a870: 2020 2020 2020 2020 2020 6f6e 6562 6974            onebit
+0003a880: 2e61 7070 656e 6428 6f6e 6562 6974 7661  .append(onebitva
+0003a890: 6c75 6529 0a20 2020 2020 2020 2020 2020  lue).           
+0003a8a0: 2070 7269 6e74 2863 6f72 726c 6973 7429   print(corrlist)
+0003a8b0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0003a8c0: 2063 6f72 726c 6973 745b 305d 203c 3d20   corrlist[0] <= 
+0003a8d0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0003a8e0: 2020 2063 6f72 726c 6973 745b 305d 203d     corrlist[0] =
+0003a8f0: 2031 0a20 2020 2020 2020 2020 2020 2061   1.            a
+0003a900: 203d 206e 702e 6173 6172 7261 7928 696e   = np.asarray(in
+0003a910: 6469 6178 6973 290a 2020 2020 2020 2020  diaxis).        
+0003a920: 2020 2020 6220 3d20 6e70 2e61 7361 7272      b = np.asarr
+0003a930: 6179 2863 6f72 726c 6973 7429 0a20 2020  ay(corrlist).   
+0003a940: 2020 2020 2020 2020 2063 203d 206e 702e           c = np.
+0003a950: 6173 6172 7261 7928 7468 7265 6573 6967  asarray(threesig
+0003a960: 290a 2020 2020 2020 2020 2020 2020 6420  ).            d 
+0003a970: 3d20 6e70 2e61 7361 7272 6179 2868 616c  = np.asarray(hal
+0003a980: 6662 6974 290a 2020 2020 2020 2020 2020  fbit).          
+0003a990: 2020 6520 3d20 6e70 2e61 7361 7272 6179    e = np.asarray
+0003a9a0: 286f 6e65 6269 7429 0a20 2020 2020 2020  (onebit).       
+0003a9b0: 2020 2020 2066 203d 206e 702e 6675 6c6c       f = np.full
+0003a9c0: 2828 6c65 6e28 696e 6469 6178 6973 2929  ((len(indiaxis))
+0003a9d0: 2c20 302e 3529 0a20 2020 2020 2020 2020  , 0.5).         
+0003a9e0: 2020 2067 203d 206e 702e 6675 6c6c 2828     g = np.full((
+0003a9f0: 6c65 6e28 696e 6469 6178 6973 2929 2c20  len(indiaxis)), 
+0003aa00: 302e 3333 3329 0a20 2020 2020 2020 2020  0.333).         
+0003aa10: 2020 2068 203d 206e 702e 6675 6c6c 2828     h = np.full((
+0003aa20: 6c65 6e28 696e 6469 6178 6973 2929 2c20  len(indiaxis)), 
+0003aa30: 302e 3134 3329 0a20 2020 2020 2020 2020  0.143).         
+0003aa40: 2020 2023 2075 7365 205b 3a31 5d20 746f     # use [:1] to
+0003aa50: 2069 676e 6f72 6520 616c 6c20 7468 6520   ignore all the 
+0003aa60: 6375 7276 6573 2073 7461 7274 2066 726f  curves start fro
+0003aa70: 6d20 302c 310a 2020 2020 2020 2020 2020  m 0,1.          
+0003aa80: 2020 7874 6872 6565 7369 672c 2079 7468    xthreesig, yth
+0003aa90: 7265 6573 6967 203d 2073 656c 662e 5f5f  reesig = self.__
+0003aaa0: 696e 7465 7270 6f6c 6174 6564 5f69 6e74  interpolated_int
+0003aab0: 6572 6365 7074 2861 2c20 622c 2063 290a  ercept(a, b, c).
+0003aac0: 2020 2020 2020 2020 2020 2020 7868 616c              xhal
+0003aad0: 6662 6974 2c20 7968 616c 6662 6974 203d  fbit, yhalfbit =
 0003aae0: 2073 656c 662e 5f5f 696e 7465 7270 6f6c   self.__interpol
 0003aaf0: 6174 6564 5f69 6e74 6572 6365 7074 2861  ated_intercept(a
-0003ab00: 2c20 622c 2066 290a 0a20 2020 2020 2020  , b, f)..       
-0003ab10: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
-0003ab20: 6d6d 2069 6e20 6c61 6265 6c20 7468 656e  mm in label then
-0003ab30: 2c20 7365 6520 7768 6963 6820 696e 7465  , see which inte
-0003ab40: 7273 6563 696f 6e20 6973 2074 6865 206d  rsecion is the m
-0003ab50: 6f73 7420 636c 6f73 6573 7420 746f 2074  ost closest to t
-0003ab60: 6865 2067 6976 656e 2072 6573 6f6c 7574  he given resolut
-0003ab70: 696f 6e28 546f 646f 290a 2020 2020 2020  ion(Todo).      
-0003ab80: 2020 2020 2020 6966 2027 6d6d 2720 696e        if 'mm' in
-0003ab90: 206c 6162 656c 3a0a 2020 2020 2020 2020   label:.        
-0003aba0: 2020 2020 2020 2020 6966 2078 6861 6c66          if xhalf
-0003abb0: 2e73 697a 6520 213d 2030 3a0a 2020 2020  .size != 0:.    
-0003abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abd0: 6e65 7778 6861 6c66 203d 2061 6273 2878  newxhalf = abs(x
-0003abe0: 6861 6c66 202d 2031 202f 2066 6c6f 6174  half - 1 / float
-0003abf0: 2873 656c 662e 7265 736f 6c75 7469 6f6e  (self.resolution
-0003ac00: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0003ac10: 2020 2020 2020 2069 6e64 6d69 6e20 3d20         indmin = 
-0003ac20: 6e70 2e61 7267 6d69 6e28 6e65 7778 6861  np.argmin(newxha
-0003ac30: 6c66 290a 2020 2020 2020 2020 2020 2020  lf).            
-0003ac40: 2020 2020 2020 2020 7868 616c 6620 3d20          xhalf = 
-0003ac50: 6e70 2e61 7272 6179 285b 7868 616c 665b  np.array([xhalf[
-0003ac60: 696e 646d 696e 5d5d 290a 2020 2020 2020  indmin]]).      
-0003ac70: 2020 2020 2020 2020 2020 2020 2020 7968                yh
-0003ac80: 616c 6620 3d20 6e70 2e61 7272 6179 285b  alf = np.array([
-0003ac90: 7968 616c 665b 696e 646d 696e 5d5d 290a  yhalf[indmin]]).
-0003aca0: 0a20 2020 2020 2020 2020 2020 2078 6f6e  .            xon
-0003acb0: 6574 6872 6565 2c20 796f 6e65 7468 7265  ethree, yonethre
-0003acc0: 6520 3d20 7365 6c66 2e5f 5f69 6e74 6572  e = self.__inter
-0003acd0: 706f 6c61 7465 645f 696e 7465 7263 6570  polated_intercep
-0003ace0: 7428 612c 2062 2c20 6729 0a20 2020 2020  t(a, b, g).     
-0003acf0: 2020 2020 2020 2078 676f 6c64 2c20 7967         xgold, yg
-0003ad00: 6f6c 6420 3d20 7365 6c66 2e5f 5f69 6e74  old = self.__int
-0003ad10: 6572 706f 6c61 7465 645f 696e 7465 7263  erpolated_interc
-0003ad20: 6570 7428 612c 2062 2c20 6829 0a0a 2020  ept(a, b, h)..  
-0003ad30: 2020 2020 2020 2020 2020 2320 4173 7369            # Assi
-0003ad40: 676e 2069 6e74 6572 7365 6374 696f 6e20  gn intersection 
-0003ad50: 7661 6c75 6520 6173 204e 6f6e 6520 7768  value as None wh
-0003ad60: 656e 2074 6865 7265 2069 7320 6e6f 2069  en there is no i
-0003ad70: 6e74 6572 7365 6374 696f 6e0a 2020 2020  ntersection.    
-0003ad80: 2020 2020 2020 2020 6966 2078 7468 7265          if xthre
-0003ad90: 6573 6967 2e73 697a 6520 3d3d 2030 2061  esig.size == 0 a
-0003ada0: 6e64 2079 7468 7265 6573 6967 2e73 697a  nd ythreesig.siz
-0003adb0: 6520 3d3d 2030 3a0a 2020 2020 2020 2020  e == 0:.        
-0003adc0: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
-0003add0: 6f20 696e 7465 7273 6563 7469 6f6e 2062  o intersection b
-0003ade0: 6574 7765 656e 2046 5343 2061 6e64 2033  etween FSC and 3
-0003adf0: 2d73 6967 6d61 2063 7572 7665 732e 2048  -sigma curves. H
-0003ae00: 6572 6520 7573 6520 7468 6520 6c61 7374  ere use the last
-0003ae10: 2070 6f69 6e74 2e27 290a 2020 2020 2020   point.').      
-0003ae20: 2020 2020 2020 2020 2020 7874 6872 6565            xthree
-0003ae30: 7369 672c 2079 7468 7265 6573 6967 203d  sig, ythreesig =
-0003ae40: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
-0003ae50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003ae60: 2020 2020 2020 2020 2020 2020 2020 7874                xt
-0003ae70: 6872 6565 7369 6720 3d20 6e70 2e72 6f75  hreesig = np.rou
-0003ae80: 6e64 2878 7468 7265 6573 6967 5b30 5d5b  nd(xthreesig[0][
-0003ae90: 305d 2c20 3429 0a20 2020 2020 2020 2020  0], 4).         
-0003aea0: 2020 2020 2020 2079 7468 7265 6573 6967         ythreesig
-0003aeb0: 203d 206e 702e 726f 756e 6428 7974 6872   = np.round(ythr
-0003aec0: 6565 7369 675b 305d 5b30 5d2c 2034 290a  eesig[0][0], 4).
-0003aed0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003aee0: 7868 616c 6662 6974 2e73 697a 6520 3d3d  xhalfbit.size ==
-0003aef0: 2030 2061 6e64 2079 6861 6c66 6269 742e   0 and yhalfbit.
-0003af00: 7369 7a65 203d 3d20 303a 0a20 2020 2020  size == 0:.     
-0003af10: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0003af20: 2827 4e6f 2069 6e74 6572 7365 6374 696f  ('No intersectio
-0003af30: 6e20 6265 7477 6565 6e20 4653 4320 616e  n between FSC an
-0003af40: 6420 312f 322d 6269 7420 6375 7276 6573  d 1/2-bit curves
-0003af50: 2e20 4865 7265 2075 7365 2074 6865 206c  . Here use the l
-0003af60: 6173 7420 706f 696e 742e 2729 0a20 2020  ast point.').   
-0003af70: 2020 2020 2020 2020 2020 2020 2078 6861               xha
-0003af80: 6c66 6269 742c 2079 6861 6c66 6269 7420  lfbit, yhalfbit 
-0003af90: 3d20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  = None, None.   
-0003afa0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0003afb0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0003afc0: 6861 6c66 6269 7420 3d20 6e70 2e72 6f75  halfbit = np.rou
-0003afd0: 6e64 2878 6861 6c66 6269 745b 305d 5b30  nd(xhalfbit[0][0
-0003afe0: 5d2c 2034 290a 2020 2020 2020 2020 2020  ], 4).          
-0003aff0: 2020 2020 2020 7968 616c 6662 6974 203d        yhalfbit =
-0003b000: 206e 702e 726f 756e 6428 7968 616c 6662   np.round(yhalfb
-0003b010: 6974 5b30 5d5b 305d 2c20 3429 0a0a 2020  it[0][0], 4)..  
-0003b020: 2020 2020 2020 2020 2020 6966 2078 6f6e            if xon
-0003b030: 6562 6974 2e73 697a 6520 3d3d 2030 2061  ebit.size == 0 a
-0003b040: 6e64 2079 6f6e 6562 6974 2e73 697a 6520  nd yonebit.size 
-0003b050: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0003b060: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
-0003b070: 696e 7465 7273 6563 7469 6f6e 2062 6574  intersection bet
-0003b080: 7765 656e 2046 5343 2061 6e64 2031 2d62  ween FSC and 1-b
-0003b090: 6974 2063 7572 7665 732e 2048 6572 6520  it curves. Here 
-0003b0a0: 7573 6520 7468 6520 6c61 7374 2070 6f69  use the last poi
-0003b0b0: 6e74 2e27 290a 2020 2020 2020 2020 2020  nt.').          
-0003b0c0: 2020 2020 2020 786f 6e65 6269 742c 2079        xonebit, y
-0003b0d0: 6f6e 6562 6974 203d 204e 6f6e 652c 204e  onebit = None, N
-0003b0e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0003b0f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003b100: 2020 2020 2020 786f 6e65 6269 7420 3d20        xonebit = 
-0003b110: 6e70 2e72 6f75 6e64 2878 6f6e 6562 6974  np.round(xonebit
-0003b120: 5b30 5d5b 305d 2c20 3429 0a20 2020 2020  [0][0], 4).     
-0003b130: 2020 2020 2020 2020 2020 2079 6f6e 6562             yoneb
-0003b140: 6974 203d 206e 702e 726f 756e 6428 796f  it = np.round(yo
-0003b150: 6e65 6269 745b 305d 5b30 5d2c 2034 290a  nebit[0][0], 4).
-0003b160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003b170: 786f 6e65 7468 7265 652e 7369 7a65 203d  xonethree.size =
-0003b180: 3d20 3020 616e 6420 796f 6e65 7468 7265  = 0 and yonethre
-0003b190: 652e 7369 7a65 203d 3d20 303a 0a20 2020  e.size == 0:.   
-0003b1a0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0003b1b0: 6e74 2827 4e6f 2069 6e74 6572 7365 6374  nt('No intersect
-0003b1c0: 696f 6e20 6265 7477 6565 6e20 4653 4320  ion between FSC 
-0003b1d0: 616e 6420 302e 3333 3320 6375 7276 6573  and 0.333 curves
-0003b1e0: 2e20 4865 7265 2075 7365 2074 6865 206c  . Here use the l
-0003b1f0: 6173 7420 706f 696e 7427 290a 2020 2020  ast point').    
-0003b200: 2020 2020 2020 2020 2020 2020 786f 6e65              xone
-0003b210: 7468 7265 652c 2079 6f6e 6574 6872 6565  three, yonethree
-0003b220: 203d 204e 6f6e 652c 204e 6f6e 650a 2020   = None, None.  
-0003b230: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0003b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b250: 786f 6e65 7468 7265 6520 3d20 6e70 2e72  xonethree = np.r
-0003b260: 6f75 6e64 2878 6f6e 6574 6872 6565 5b30  ound(xonethree[0
-0003b270: 5d5b 305d 2c20 3429 0a20 2020 2020 2020  ][0], 4).       
-0003b280: 2020 2020 2020 2020 2079 6f6e 6574 6872           yonethr
-0003b290: 6565 203d 206e 702e 726f 756e 6428 796f  ee = np.round(yo
-0003b2a0: 6e65 7468 7265 655b 305d 5b30 5d2c 2034  nethree[0][0], 4
-0003b2b0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0003b2c0: 6620 7868 616c 662e 7369 7a65 203d 3d20  f xhalf.size == 
-0003b2d0: 3020 616e 6420 7968 616c 662e 7369 7a65  0 and yhalf.size
-0003b2e0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0003b2f0: 2020 2020 2020 2070 7269 6e74 2827 2121         print('!!
-0003b300: 2120 4e6f 2069 6e74 6572 7365 6374 696f  ! No intersectio
-0003b310: 6e20 6265 7477 6565 6e20 4653 4320 616e  n between FSC an
-0003b320: 6420 302e 3520 6375 7276 6573 2e20 4865  d 0.5 curves. He
-0003b330: 7265 2075 7365 2074 6865 206c 6173 7420  re use the last 
-0003b340: 706f 696e 7427 290a 2020 2020 2020 2020  point').        
-0003b350: 2020 2020 2020 2020 7868 616c 662c 2079          xhalf, y
-0003b360: 6861 6c66 203d 204e 6f6e 652c 204e 6f6e  half = None, Non
-0003b370: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-0003b380: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0003b390: 2020 2020 7868 616c 6620 3d20 6e70 2e72      xhalf = np.r
-0003b3a0: 6f75 6e64 2878 6861 6c66 5b30 5d5b 305d  ound(xhalf[0][0]
-0003b3b0: 2c20 3429 0a20 2020 2020 2020 2020 2020  , 4).           
-0003b3c0: 2020 2020 2079 6861 6c66 203d 206e 702e       yhalf = np.
-0003b3d0: 726f 756e 6428 7968 616c 665b 305d 5b30  round(yhalf[0][0
-0003b3e0: 5d2c 2034 290a 2020 2020 2020 2020 2020  ], 4).          
-0003b3f0: 2020 6966 2078 676f 6c64 2e73 697a 6520    if xgold.size 
-0003b400: 3d3d 2030 2061 6e64 2079 676f 6c64 2e73  == 0 and ygold.s
-0003b410: 697a 6520 3d3d 2030 3a0a 2020 2020 2020  ize == 0:.      
-0003b420: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0003b430: 2721 2121 204e 6f20 696e 7465 7273 6563  '!!! No intersec
-0003b440: 7469 6f6e 2062 6574 7765 656e 2046 5343  tion between FSC
-0003b450: 2061 6e64 2030 2e31 3433 2063 7572 7665   and 0.143 curve
-0003b460: 732e 2048 6572 6520 7573 6520 7468 6520  s. Here use the 
-0003b470: 6c61 7374 2070 6f69 6e74 2729 0a20 2020  last point').   
-0003b480: 2020 2020 2020 2020 2020 2020 2078 676f               xgo
-0003b490: 6c64 2c20 7967 6f6c 6420 3d20 4e6f 6e65  ld, ygold = None
-0003b4a0: 2c20 4e6f 6e65 0a20 2020 2020 2020 2020  , None.         
-0003b4b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003b4c0: 2020 2020 2020 2020 2078 676f 6c64 203d           xgold =
-0003b4d0: 206e 702e 726f 756e 6428 7867 6f6c 645b   np.round(xgold[
-0003b4e0: 305d 5b30 5d2c 2034 290a 2020 2020 2020  0][0], 4).      
-0003b4f0: 2020 2020 2020 2020 2020 7967 6f6c 6420            ygold 
-0003b500: 3d20 6e70 2e72 6f75 6e64 2879 676f 6c64  = np.round(ygold
-0003b510: 5b30 5d5b 305d 2c20 3429 0a0a 0a20 2020  [0][0], 4)...   
-0003b520: 2020 2020 2020 2020 2064 6174 6164 6963           datadic
-0003b530: 7420 3d20 7b0a 2020 2020 2020 2020 2020  t = {.          
-0003b540: 2020 2020 2020 2763 7572 7665 7327 3a20        'curves': 
-0003b550: 7b27 6673 6327 3a20 6e70 2e72 6f75 6e64  {'fsc': np.round
-0003b560: 286e 702e 7265 616c 2863 6f72 726c 6973  (np.real(corrlis
-0003b570: 7429 2c20 3429 2e74 6f6c 6973 7428 292c  t), 4).tolist(),
-0003b580: 2027 7468 7265 6573 6967 6d61 273a 206e   'threesigma': n
-0003b590: 702e 726f 756e 6428 7468 7265 6573 6967  p.round(threesig
-0003b5a0: 2c20 3429 2e74 6f6c 6973 7428 292c 0a20  , 4).tolist(),. 
-0003b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b5c0: 2020 2020 2020 2020 2020 2768 616c 6662            'halfb
-0003b5d0: 6974 273a 206e 702e 726f 756e 6428 6861  it': np.round(ha
-0003b5e0: 6c66 6269 742c 2034 292e 746f 6c69 7374  lfbit, 4).tolist
-0003b5f0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0003b600: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0003b610: 6f6e 6562 6974 273a 206e 702e 726f 756e  onebit': np.roun
-0003b620: 6428 6f6e 6562 6974 2c20 3429 2e74 6f6c  d(onebit, 4).tol
-0003b630: 6973 7428 292c 2027 302e 3527 3a20 662e  ist(), '0.5': f.
-0003b640: 746f 6c69 7374 2829 2c20 2730 2e33 3333  tolist(), '0.333
-0003b650: 273a 2067 2e74 6f6c 6973 7428 292c 0a20  ': g.tolist(),. 
-0003b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b670: 2020 2020 2020 2020 2020 2730 2e31 3433            '0.143
-0003b680: 273a 2068 2e74 6f6c 6973 7428 292c 0a20  ': h.tolist(),. 
-0003b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b6a0: 2020 2020 2020 2020 2020 276c 6576 656c            'level
-0003b6b0: 273a 206e 702e 726f 756e 6428 696e 6469  ': np.round(indi
-0003b6c0: 6178 6973 2c20 3429 2e74 6f6c 6973 7428  axis, 4).tolist(
-0003b6d0: 297d 2c0a 2020 2020 2020 2020 2020 2020  )},.            
-0003b6e0: 2020 2020 2769 6e74 6572 7365 6374 696f      'intersectio
-0003b6f0: 6e73 273a 207b 2774 6872 6565 7369 6727  ns': {'threesig'
-0003b700: 3a20 7b27 7827 3a20 7874 6872 6565 7369  : {'x': xthreesi
-0003b710: 672c 2027 7927 3a20 7974 6872 6565 7369  g, 'y': ythreesi
-0003b720: 677d 2c0a 2020 2020 2020 2020 2020 2020  g},.            
-0003b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b740: 2020 2020 2020 2768 616c 6662 6974 273a        'halfbit':
-0003b750: 207b 2778 273a 2078 6861 6c66 6269 742c   {'x': xhalfbit,
-0003b760: 2027 7927 3a20 7968 616c 6662 6974 7d2c   'y': yhalfbit},
-0003b770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b790: 2020 2027 6f6e 6562 6974 273a 207b 2778     'onebit': {'x
-0003b7a0: 273a 2078 6f6e 6562 6974 2c20 2779 273a  ': xonebit, 'y':
-0003b7b0: 2079 6f6e 6562 6974 7d2c 0a20 2020 2020   yonebit},.     
-0003b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b7d0: 2020 2020 2020 2020 2020 2020 2027 302e               '0.
-0003b7e0: 3527 3a20 7b27 7827 3a20 7868 616c 662c  5': {'x': xhalf,
-0003b7f0: 2027 7927 3a20 7968 616c 667d 2c0a 2020   'y': yhalf},.  
+0003ab00: 2c20 622c 2064 290a 2020 2020 2020 2020  , b, d).        
+0003ab10: 2020 2020 786f 6e65 6269 742c 2079 6f6e      xonebit, yon
+0003ab20: 6562 6974 203d 2073 656c 662e 5f5f 696e  ebit = self.__in
+0003ab30: 7465 7270 6f6c 6174 6564 5f69 6e74 6572  terpolated_inter
+0003ab40: 6365 7074 2861 2c20 622c 2065 290a 2020  cept(a, b, e).  
+0003ab50: 2020 2020 2020 2020 2020 7868 616c 662c            xhalf,
+0003ab60: 2079 6861 6c66 203d 2073 656c 662e 5f5f   yhalf = self.__
+0003ab70: 696e 7465 7270 6f6c 6174 6564 5f69 6e74  interpolated_int
+0003ab80: 6572 6365 7074 2861 2c20 622c 2066 290a  ercept(a, b, f).
+0003ab90: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0003aba0: 6865 636b 2069 6620 6d6d 2069 6e20 6c61  heck if mm in la
+0003abb0: 6265 6c20 7468 656e 2c20 7365 6520 7768  bel then, see wh
+0003abc0: 6963 6820 696e 7465 7273 6563 696f 6e20  ich intersecion 
+0003abd0: 6973 2074 6865 206d 6f73 7420 636c 6f73  is the most clos
+0003abe0: 6573 7420 746f 2074 6865 2067 6976 656e  est to the given
+0003abf0: 2072 6573 6f6c 7574 696f 6e28 546f 646f   resolution(Todo
+0003ac00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0003ac10: 2027 6d6d 2720 696e 206c 6162 656c 3a0a   'mm' in label:.
+0003ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac30: 6966 2078 6861 6c66 2e73 697a 6520 213d  if xhalf.size !=
+0003ac40: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0003ac50: 2020 2020 2020 2020 6e65 7778 6861 6c66          newxhalf
+0003ac60: 203d 2061 6273 2878 6861 6c66 202d 2031   = abs(xhalf - 1
+0003ac70: 202f 2066 6c6f 6174 2873 656c 662e 7265   / float(self.re
+0003ac80: 736f 6c75 7469 6f6e 2929 0a20 2020 2020  solution)).     
+0003ac90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003aca0: 6e64 6d69 6e20 3d20 6e70 2e61 7267 6d69  ndmin = np.argmi
+0003acb0: 6e28 6e65 7778 6861 6c66 290a 2020 2020  n(newxhalf).    
+0003acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003acd0: 7868 616c 6620 3d20 6e70 2e61 7272 6179  xhalf = np.array
+0003ace0: 285b 7868 616c 665b 696e 646d 696e 5d5d  ([xhalf[indmin]]
+0003acf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003ad00: 2020 2020 2020 7968 616c 6620 3d20 6e70        yhalf = np
+0003ad10: 2e61 7272 6179 285b 7968 616c 665b 696e  .array([yhalf[in
+0003ad20: 646d 696e 5d5d 290a 0a20 2020 2020 2020  dmin]])..       
+0003ad30: 2020 2020 2078 6f6e 6574 6872 6565 2c20       xonethree, 
+0003ad40: 796f 6e65 7468 7265 6520 3d20 7365 6c66  yonethree = self
+0003ad50: 2e5f 5f69 6e74 6572 706f 6c61 7465 645f  .__interpolated_
+0003ad60: 696e 7465 7263 6570 7428 612c 2062 2c20  intercept(a, b, 
+0003ad70: 6729 0a20 2020 2020 2020 2020 2020 2078  g).            x
+0003ad80: 676f 6c64 2c20 7967 6f6c 6420 3d20 7365  gold, ygold = se
+0003ad90: 6c66 2e5f 5f69 6e74 6572 706f 6c61 7465  lf.__interpolate
+0003ada0: 645f 696e 7465 7263 6570 7428 612c 2062  d_intercept(a, b
+0003adb0: 2c20 6829 0a0a 2020 2020 2020 2020 2020  , h)..          
+0003adc0: 2020 2320 4173 7369 676e 2069 6e74 6572    # Assign inter
+0003add0: 7365 6374 696f 6e20 7661 6c75 6520 6173  section value as
+0003ade0: 204e 6f6e 6520 7768 656e 2074 6865 7265   None when there
+0003adf0: 2069 7320 6e6f 2069 6e74 6572 7365 6374   is no intersect
+0003ae00: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+0003ae10: 6966 2078 7468 7265 6573 6967 2e73 697a  if xthreesig.siz
+0003ae20: 6520 3d3d 2030 2061 6e64 2079 7468 7265  e == 0 and ythre
+0003ae30: 6573 6967 2e73 697a 6520 3d3d 2030 3a0a  esig.size == 0:.
+0003ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ae50: 7072 696e 7428 274e 6f20 696e 7465 7273  print('No inters
+0003ae60: 6563 7469 6f6e 2062 6574 7765 656e 2046  ection between F
+0003ae70: 5343 2061 6e64 2033 2d73 6967 6d61 2063  SC and 3-sigma c
+0003ae80: 7572 7665 732e 2048 6572 6520 7573 6520  urves. Here use 
+0003ae90: 7468 6520 6c61 7374 2070 6f69 6e74 2e27  the last point.'
+0003aea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003aeb0: 2020 7874 6872 6565 7369 672c 2079 7468    xthreesig, yth
+0003aec0: 7265 6573 6967 203d 204e 6f6e 652c 204e  reesig = None, N
+0003aed0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0003aee0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0003aef0: 2020 2020 2020 7874 6872 6565 7369 6720        xthreesig 
+0003af00: 3d20 6e70 2e72 6f75 6e64 2878 7468 7265  = np.round(xthre
+0003af10: 6573 6967 5b30 5d5b 305d 2c20 3429 0a20  esig[0][0], 4). 
+0003af20: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0003af30: 7468 7265 6573 6967 203d 206e 702e 726f  threesig = np.ro
+0003af40: 756e 6428 7974 6872 6565 7369 675b 305d  und(ythreesig[0]
+0003af50: 5b30 5d2c 2034 290a 0a20 2020 2020 2020  [0], 4)..       
+0003af60: 2020 2020 2069 6620 7868 616c 6662 6974       if xhalfbit
+0003af70: 2e73 697a 6520 3d3d 2030 2061 6e64 2079  .size == 0 and y
+0003af80: 6861 6c66 6269 742e 7369 7a65 203d 3d20  halfbit.size == 
+0003af90: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0003afa0: 2020 2070 7269 6e74 2827 4e6f 2069 6e74     print('No int
+0003afb0: 6572 7365 6374 696f 6e20 6265 7477 6565  ersection betwee
+0003afc0: 6e20 4653 4320 616e 6420 312f 322d 6269  n FSC and 1/2-bi
+0003afd0: 7420 6375 7276 6573 2e20 4865 7265 2075  t curves. Here u
+0003afe0: 7365 2074 6865 206c 6173 7420 706f 696e  se the last poin
+0003aff0: 742e 2729 0a20 2020 2020 2020 2020 2020  t.').           
+0003b000: 2020 2020 2078 6861 6c66 6269 742c 2079       xhalfbit, y
+0003b010: 6861 6c66 6269 7420 3d20 4e6f 6e65 2c20  halfbit = None, 
+0003b020: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0003b030: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003b040: 2020 2020 2020 2078 6861 6c66 6269 7420         xhalfbit 
+0003b050: 3d20 6e70 2e72 6f75 6e64 2878 6861 6c66  = np.round(xhalf
+0003b060: 6269 745b 305d 5b30 5d2c 2034 290a 2020  bit[0][0], 4).  
+0003b070: 2020 2020 2020 2020 2020 2020 2020 7968                yh
+0003b080: 616c 6662 6974 203d 206e 702e 726f 756e  alfbit = np.roun
+0003b090: 6428 7968 616c 6662 6974 5b30 5d5b 305d  d(yhalfbit[0][0]
+0003b0a0: 2c20 3429 0a0a 2020 2020 2020 2020 2020  , 4)..          
+0003b0b0: 2020 6966 2078 6f6e 6562 6974 2e73 697a    if xonebit.siz
+0003b0c0: 6520 3d3d 2030 2061 6e64 2079 6f6e 6562  e == 0 and yoneb
+0003b0d0: 6974 2e73 697a 6520 3d3d 2030 3a0a 2020  it.size == 0:.  
+0003b0e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003b0f0: 696e 7428 274e 6f20 696e 7465 7273 6563  int('No intersec
+0003b100: 7469 6f6e 2062 6574 7765 656e 2046 5343  tion between FSC
+0003b110: 2061 6e64 2031 2d62 6974 2063 7572 7665   and 1-bit curve
+0003b120: 732e 2048 6572 6520 7573 6520 7468 6520  s. Here use the 
+0003b130: 6c61 7374 2070 6f69 6e74 2e27 290a 2020  last point.').  
+0003b140: 2020 2020 2020 2020 2020 2020 2020 786f                xo
+0003b150: 6e65 6269 742c 2079 6f6e 6562 6974 203d  nebit, yonebit =
+0003b160: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
+0003b170: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003b180: 2020 2020 2020 2020 2020 2020 2020 786f                xo
+0003b190: 6e65 6269 7420 3d20 6e70 2e72 6f75 6e64  nebit = np.round
+0003b1a0: 2878 6f6e 6562 6974 5b30 5d5b 305d 2c20  (xonebit[0][0], 
+0003b1b0: 3429 0a20 2020 2020 2020 2020 2020 2020  4).             
+0003b1c0: 2020 2079 6f6e 6562 6974 203d 206e 702e     yonebit = np.
+0003b1d0: 726f 756e 6428 796f 6e65 6269 745b 305d  round(yonebit[0]
+0003b1e0: 5b30 5d2c 2034 290a 0a20 2020 2020 2020  [0], 4)..       
+0003b1f0: 2020 2020 2069 6620 786f 6e65 7468 7265       if xonethre
+0003b200: 652e 7369 7a65 203d 3d20 3020 616e 6420  e.size == 0 and 
+0003b210: 796f 6e65 7468 7265 652e 7369 7a65 203d  yonethree.size =
+0003b220: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0003b230: 2020 2020 2070 7269 6e74 2827 4e6f 2069       print('No i
+0003b240: 6e74 6572 7365 6374 696f 6e20 6265 7477  ntersection betw
+0003b250: 6565 6e20 4653 4320 616e 6420 302e 3333  een FSC and 0.33
+0003b260: 3320 6375 7276 6573 2e20 4865 7265 2075  3 curves. Here u
+0003b270: 7365 2074 6865 206c 6173 7420 706f 696e  se the last poin
+0003b280: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+0003b290: 2020 2020 786f 6e65 7468 7265 652c 2079      xonethree, y
+0003b2a0: 6f6e 6574 6872 6565 203d 204e 6f6e 652c  onethree = None,
+0003b2b0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0003b2c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003b2d0: 2020 2020 2020 2020 786f 6e65 7468 7265          xonethre
+0003b2e0: 6520 3d20 6e70 2e72 6f75 6e64 2878 6f6e  e = np.round(xon
+0003b2f0: 6574 6872 6565 5b30 5d5b 305d 2c20 3429  ethree[0][0], 4)
+0003b300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b310: 2079 6f6e 6574 6872 6565 203d 206e 702e   yonethree = np.
+0003b320: 726f 756e 6428 796f 6e65 7468 7265 655b  round(yonethree[
+0003b330: 305d 5b30 5d2c 2034 290a 0a20 2020 2020  0][0], 4)..     
+0003b340: 2020 2020 2020 2069 6620 7868 616c 662e         if xhalf.
+0003b350: 7369 7a65 203d 3d20 3020 616e 6420 7968  size == 0 and yh
+0003b360: 616c 662e 7369 7a65 203d 3d20 303a 0a20  alf.size == 0:. 
+0003b370: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0003b380: 7269 6e74 2827 2121 2120 4e6f 2069 6e74  rint('!!! No int
+0003b390: 6572 7365 6374 696f 6e20 6265 7477 6565  ersection betwee
+0003b3a0: 6e20 4653 4320 616e 6420 302e 3520 6375  n FSC and 0.5 cu
+0003b3b0: 7276 6573 2e20 4865 7265 2075 7365 2074  rves. Here use t
+0003b3c0: 6865 206c 6173 7420 706f 696e 7427 290a  he last point').
+0003b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b3e0: 7868 616c 662c 2079 6861 6c66 203d 204e  xhalf, yhalf = N
+0003b3f0: 6f6e 652c 204e 6f6e 650a 2020 2020 2020  one, None.      
+0003b400: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0003b410: 2020 2020 2020 2020 2020 2020 7868 616c              xhal
+0003b420: 6620 3d20 6e70 2e72 6f75 6e64 2878 6861  f = np.round(xha
+0003b430: 6c66 5b30 5d5b 305d 2c20 3429 0a20 2020  lf[0][0], 4).   
+0003b440: 2020 2020 2020 2020 2020 2020 2079 6861               yha
+0003b450: 6c66 203d 206e 702e 726f 756e 6428 7968  lf = np.round(yh
+0003b460: 616c 665b 305d 5b30 5d2c 2034 290a 2020  alf[0][0], 4).  
+0003b470: 2020 2020 2020 2020 2020 6966 2078 676f            if xgo
+0003b480: 6c64 2e73 697a 6520 3d3d 2030 2061 6e64  ld.size == 0 and
+0003b490: 2079 676f 6c64 2e73 697a 6520 3d3d 2030   ygold.size == 0
+0003b4a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003b4b0: 2020 7072 696e 7428 2721 2121 204e 6f20    print('!!! No 
+0003b4c0: 696e 7465 7273 6563 7469 6f6e 2062 6574  intersection bet
+0003b4d0: 7765 656e 2046 5343 2061 6e64 2030 2e31  ween FSC and 0.1
+0003b4e0: 3433 2063 7572 7665 732e 2048 6572 6520  43 curves. Here 
+0003b4f0: 7573 6520 7468 6520 6c61 7374 2070 6f69  use the last poi
+0003b500: 6e74 2729 0a20 2020 2020 2020 2020 2020  nt').           
+0003b510: 2020 2020 2078 676f 6c64 2c20 7967 6f6c       xgold, ygol
+0003b520: 6420 3d20 4e6f 6e65 2c20 4e6f 6e65 0a20  d = None, None. 
+0003b530: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0003b540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b550: 2078 676f 6c64 203d 206e 702e 726f 756e   xgold = np.roun
+0003b560: 6428 7867 6f6c 645b 305d 5b30 5d2c 2034  d(xgold[0][0], 4
+0003b570: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003b580: 2020 7967 6f6c 6420 3d20 6e70 2e72 6f75    ygold = np.rou
+0003b590: 6e64 2879 676f 6c64 5b30 5d5b 305d 2c20  nd(ygold[0][0], 
+0003b5a0: 3429 0a0a 0a20 2020 2020 2020 2020 2020  4)...           
+0003b5b0: 2064 6174 6164 6963 7420 3d20 7b0a 2020   datadict = {.  
+0003b5c0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0003b5d0: 7572 7665 7327 3a20 7b27 6673 6327 3a20  urves': {'fsc': 
+0003b5e0: 6e70 2e72 6f75 6e64 286e 702e 7265 616c  np.round(np.real
+0003b5f0: 2863 6f72 726c 6973 7429 2c20 3429 2e74  (corrlist), 4).t
+0003b600: 6f6c 6973 7428 292c 2027 7468 7265 6573  olist(), 'threes
+0003b610: 6967 6d61 273a 206e 702e 726f 756e 6428  igma': np.round(
+0003b620: 7468 7265 6573 6967 2c20 3429 2e74 6f6c  threesig, 4).tol
+0003b630: 6973 7428 292c 0a20 2020 2020 2020 2020  ist(),.         
+0003b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b650: 2020 2768 616c 6662 6974 273a 206e 702e    'halfbit': np.
+0003b660: 726f 756e 6428 6861 6c66 6269 742c 2034  round(halfbit, 4
+0003b670: 292e 746f 6c69 7374 2829 2c0a 2020 2020  ).tolist(),.    
+0003b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b690: 2020 2020 2020 2027 6f6e 6562 6974 273a         'onebit':
+0003b6a0: 206e 702e 726f 756e 6428 6f6e 6562 6974   np.round(onebit
+0003b6b0: 2c20 3429 2e74 6f6c 6973 7428 292c 2027  , 4).tolist(), '
+0003b6c0: 302e 3527 3a20 662e 746f 6c69 7374 2829  0.5': f.tolist()
+0003b6d0: 2c20 2730 2e33 3333 273a 2067 2e74 6f6c  , '0.333': g.tol
+0003b6e0: 6973 7428 292c 0a20 2020 2020 2020 2020  ist(),.         
+0003b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b700: 2020 2730 2e31 3433 273a 2068 2e74 6f6c    '0.143': h.tol
+0003b710: 6973 7428 292c 0a20 2020 2020 2020 2020  ist(),.         
+0003b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b730: 2020 276c 6576 656c 273a 206e 702e 726f    'level': np.ro
+0003b740: 756e 6428 696e 6469 6178 6973 2c20 3429  und(indiaxis, 4)
+0003b750: 2e74 6f6c 6973 7428 297d 2c0a 2020 2020  .tolist()},.    
+0003b760: 2020 2020 2020 2020 2020 2020 2769 6e74              'int
+0003b770: 6572 7365 6374 696f 6e73 273a 207b 2774  ersections': {'t
+0003b780: 6872 6565 7369 6727 3a20 7b27 7827 3a20  hreesig': {'x': 
+0003b790: 7874 6872 6565 7369 672c 2027 7927 3a20  xthreesig, 'y': 
+0003b7a0: 7974 6872 6565 7369 677d 2c0a 2020 2020  ythreesig},.    
+0003b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b7c0: 2020 2020 2020 2020 2020 2020 2020 2768                'h
+0003b7d0: 616c 6662 6974 273a 207b 2778 273a 2078  alfbit': {'x': x
+0003b7e0: 6861 6c66 6269 742c 2027 7927 3a20 7968  halfbit, 'y': yh
+0003b7f0: 616c 6662 6974 7d2c 0a20 2020 2020 2020  alfbit},.       
 0003b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b820: 2730 2e33 3333 273a 207b 2778 273a 2078  '0.333': {'x': x
-0003b830: 6f6e 6574 6872 6565 2c20 2779 273a 2079  onethree, 'y': y
-0003b840: 6f6e 6574 6872 6565 7d2c 0a20 2020 2020  onethree},.     
+0003b810: 2020 2020 2020 2020 2020 2027 6f6e 6562             'oneb
+0003b820: 6974 273a 207b 2778 273a 2078 6f6e 6562  it': {'x': xoneb
+0003b830: 6974 2c20 2779 273a 2079 6f6e 6562 6974  it, 'y': yonebit
+0003b840: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
 0003b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b860: 2020 2020 2020 2020 2020 2020 2027 302e               '0.
-0003b870: 3134 3327 3a20 7b27 7827 3a20 7867 6f6c  143': {'x': xgol
-0003b880: 642c 2027 7927 3a20 7967 6f6c 647d 7d7d  d, 'y': ygold}}}
-0003b890: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
-0003b8a0: 616c 6469 6374 203d 2064 6963 7428 290a  aldict = dict().
-0003b8b0: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-0003b8c0: 6c64 6963 745b 6c61 6265 6c20 2b20 2766  ldict[label + 'f
-0003b8d0: 7363 275d 203d 2064 6174 6164 6963 740a  sc'] = datadict.
-0003b8e0: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
-0003b8f0: 2e70 6c6f 7428 696e 6469 6178 6973 2c20  .plot(indiaxis, 
-0003b900: 636f 7272 6c69 7374 2c20 6c61 6265 6c3d  corrlist, label=
-0003b910: 6c61 6265 6c20 2b20 2746 5343 2729 0a20  label + 'FSC'). 
-0003b920: 2020 2020 2020 2020 2020 2023 2070 6c74             # plt
-0003b930: 2e70 6c6f 7428 696e 6469 6178 6973 2c20  .plot(indiaxis, 
-0003b940: 7468 7265 6573 6967 2c20 6c61 6265 6c3d  threesig, label=
-0003b950: 2733 2073 6967 6d61 2729 0a20 2020 2020  '3 sigma').     
-0003b960: 2020 2020 2020 2070 6c74 2e70 6c6f 7428         plt.plot(
-0003b970: 696e 6469 6178 6973 2c20 6861 6c66 6269  indiaxis, halfbi
-0003b980: 742c 206c 6162 656c 3d27 312f 3220 6269  t, label='1/2 bi
-0003b990: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-0003b9a0: 2320 706c 742e 706c 6f74 2869 6e64 6961  # plt.plot(india
-0003b9b0: 7869 732c 206f 6e65 6269 742c 206c 6162  xis, onebit, lab
-0003b9c0: 656c 3d27 3120 6269 7427 290a 2020 2020  el='1 bit').    
-0003b9d0: 2020 2020 2020 2020 706c 742e 706c 6f74          plt.plot
-0003b9e0: 2869 6e64 6961 7869 732c 2066 2c20 6c61  (indiaxis, f, la
-0003b9f0: 6265 6c3d 2730 2e35 272c 206c 696e 6573  bel='0.5', lines
-0003ba00: 7479 6c65 3d27 3a27 290a 2020 2020 2020  tyle=':').      
-0003ba10: 2020 2020 2020 2320 706c 742e 706c 6f74        # plt.plot
-0003ba20: 2869 6e64 6961 7869 732c 2067 2c20 6c61  (indiaxis, g, la
-0003ba30: 6265 6c3d 2730 2e33 3333 272c 206c 696e  bel='0.333', lin
-0003ba40: 6573 7479 6c65 3d27 2d2d 2729 0a20 2020  estyle='--').   
-0003ba50: 2020 2020 2020 2020 2070 6c74 2e70 6c6f           plt.plo
-0003ba60: 7428 696e 6469 6178 6973 2c20 682c 206c  t(indiaxis, h, l
-0003ba70: 6162 656c 3d27 302e 3134 3327 2c20 6c69  abel='0.143', li
-0003ba80: 6e65 7374 796c 653d 272d 2e27 290a 2020  nestyle='-.').  
-0003ba90: 2020 2020 2020 2020 2020 706c 742e 6c65            plt.le
-0003baa0: 6765 6e64 2829 0a20 2020 2020 2020 2020  gend().         
-0003bab0: 2020 2069 6620 6c61 6265 6c3a 0a20 2020     if label:.   
-0003bac0: 2020 2020 2020 2020 2020 2020 2070 6c74               plt
-0003bad0: 2e73 6176 6566 6967 2873 656c 662e 776f  .savefig(self.wo
-0003bae0: 726b 6469 7220 2b20 7365 6c66 2e6d 6170  rkdir + self.map
-0003baf0: 6e61 6d65 202b 2027 5f27 202b 206c 6162  name + '_' + lab
-0003bb00: 656c 202b 2027 5f66 7363 2e70 6e67 2729  el + '_fsc.png')
-0003bb10: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0003bb20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0003bb30: 2020 2070 6c74 2e73 6176 6566 6967 2873     plt.savefig(s
-0003bb40: 656c 662e 776f 726b 6469 7220 2b20 7365  elf.workdir + se
-0003bb50: 6c66 2e6d 6170 6e61 6d65 202b 2027 5f66  lf.mapname + '_f
-0003bb60: 7363 2e70 6e67 2729 0a20 2020 2020 2020  sc.png').       
-0003bb70: 2020 2020 2070 6c74 2e63 6c6f 7365 2829       plt.close()
-0003bb80: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0003bb90: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
-0003bba0: 7220 3d20 2746 5343 2063 616c 6375 6c61  r = 'FSC calcula
-0003bbb0: 7469 6f6e 2065 7272 6f72 3a20 7b7d 272e  tion error: {}'.
-0003bbc0: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
-0003bbd0: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
-0003bbe0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
-0003bbf0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
-0003bc00: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-0003bc10: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
-0003bc20: 2729 0a0a 2020 2020 2020 2020 6966 2065  ')..        if e
-0003bc30: 7272 6c69 7374 3a0a 2020 2020 2020 2020  rrlist:.        
-0003bc40: 2020 2020 6461 7461 6469 6374 203d 207b      datadict = {
-0003bc50: 2765 7272 273a 207b 6c61 6265 6c20 2b20  'err': {label + 
-0003bc60: 2766 7363 5f65 7272 6f72 273a 2065 7272  'fsc_error': err
-0003bc70: 6c69 7374 7d7d 0a20 2020 2020 2020 2020  list}}.         
-0003bc80: 2020 2066 696e 616c 6469 6374 5b6c 6162     finaldict[lab
-0003bc90: 656c 202b 2027 6673 6327 5d20 3d20 6461  el + 'fsc'] = da
-0003bca0: 7461 6469 6374 0a20 2020 2020 2020 2065  tadict.        e
-0003bcb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0003bcc0: 2070 7269 6e74 2827 4e6f 2065 7272 6f72   print('No error
-0003bcd0: 2069 6e20 4653 4320 6361 6c63 756c 6174   in FSC calculat
-0003bce0: 696f 6e2e 2729 0a0a 2020 2020 2020 2020  ion.')..        
-0003bcf0: 6966 2062 6f6f 6c28 6461 7461 6469 6374  if bool(datadict
-0003bd00: 2920 616e 6420 626f 6f6c 2866 696e 616c  ) and bool(final
-0003bd10: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-0003bd20: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0003bd30: 2020 2020 2020 2020 7769 7468 2063 6f64          with cod
-0003bd40: 6563 732e 6f70 656e 2873 656c 662e 776f  ecs.open(self.wo
-0003bd50: 726b 6469 7220 2b20 7365 6c66 2e6d 6170  rkdir + self.map
-0003bd60: 6e61 6d65 202b 2027 5f27 202b 206c 6162  name + '_' + lab
-0003bd70: 656c 202b 2027 6673 632e 6a73 6f6e 272c  el + 'fsc.json',
-0003bd80: 2027 7727 2c20 656e 636f 6469 6e67 3d27   'w', encoding='
-0003bd90: 7574 662d 3827 2920 6173 2066 3a0a 2020  utf-8') as f:.  
-0003bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bdb0: 2020 6a73 6f6e 2e64 756d 7028 6669 6e61    json.dump(fina
-0003bdc0: 6c64 6963 742c 2066 290a 2020 2020 2020  ldict, f).      
-0003bdd0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0003bde0: 2746 5343 2070 726f 6475 6365 6420 6279  'FSC produced by
-0003bdf0: 2074 776f 2068 616c 6620 6d61 7073 2e27   two half maps.'
-0003be00: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0003be10: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-0003be20: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-0003be30: 2e77 7269 7465 2827 5772 6974 696e 6720  .write('Writing 
-0003be40: 4653 4320 6461 7461 2074 6f20 6a73 6f6e  FSC data to json
-0003be50: 2066 696c 6520 6572 726f 723a 207b 7d2e   file error: {}.
-0003be60: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
-0003be70: 5f69 6e66 6f28 295b 315d 2929 0a20 2020  _info()[1])).   
-0003be80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003be90: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-0003bea0: 722e 7772 6974 6528 2746 5343 2063 616c  r.write('FSC cal
-0003beb0: 6375 6c61 7469 6f6e 2067 6574 206e 6f6e  culation get non
-0003bec0: 6520 2729 0a0a 2020 2020 2020 2020 7265  e ')..        re
-0003bed0: 7475 726e 204e 6f6e 650a 0a0a 2020 2020  turn None...    
-0003bee0: 2320 4070 726f 6669 6c65 0a20 2020 2064  # @profile.    d
-0003bef0: 6566 206e 6577 5f66 7363 2873 656c 662c  ef new_fsc(self,
-0003bf00: 206d 6170 6f64 642c 206d 6170 6576 656e   mapodd, mapeven
-0003bf10: 2c20 6173 796d 3d31 2e30 2c20 6c61 6265  , asym=1.0, labe
-0003bf20: 6c3d 2727 293a 0a20 2020 2020 2020 2022  l=''):.        "
-0003bf30: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-0003bf40: 4361 6c63 756c 6174 6520 4653 4320 6261  Calculate FSC ba
-0003bf50: 7365 6420 6f6e 2074 6865 2074 776f 2069  sed on the two i
-0003bf60: 6e70 7574 2068 616c 6620 6d61 7073 0a20  nput half maps. 
-0003bf70: 2020 2020 2020 2020 2020 2052 6573 756c             Resul
-0003bf80: 7473 2077 726f 7465 2074 6f20 4a53 4f4e  ts wrote to JSON
-0003bf90: 2066 696c 6520 696e 636c 7564 696e 6720   file including 
-0003bfa0: 7265 736f 6c75 7469 6f6e 2061 7420 302e  resolution at 0.
-0003bfb0: 3134 332c 2030 2e33 3333 2c20 302e 3520  143, 0.333, 0.5 
-0003bfc0: 616e 6420 6e6f 6973 650a 2020 2020 2020  and noise.      
-0003bfd0: 2020 2020 2020 6c65 7665 6c20 6174 2030        level at 0
-0003bfe0: 2e35 2d62 6974 2c20 312d 6269 742c 2033  .5-bit, 1-bit, 3
-0003bff0: 2d73 6967 6d61 2e20 4120 636f 7272 6573  -sigma. A corres
-0003c000: 706f 6e64 696e 6720 706c 6f74 2069 7320  ponding plot is 
-0003c010: 616c 736f 2073 6176 6520 6173 2050 4e47  also save as PNG
-0003c020: 2066 696c 652e 0a0a 2020 2020 2020 2020   file...        
-0003c030: 3a70 6172 616d 206d 6170 6f64 643a 2054  :param mapodd: T
-0003c040: 454d 5079 206d 6170 2069 6e73 7461 6e63  EMPy map instanc
-0003c050: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
-0003c060: 206d 6170 6576 656e 3a20 5445 4d50 7920   mapeven: TEMPy 
-0003c070: 6d61 7020 696e 7374 616e 6365 0a20 2020  map instance.   
-0003c080: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
-0003c090: 6e65 0a0a 2020 2020 2020 2020 2222 220a  ne..        """.
-0003c0a0: 0a20 2020 2020 2020 2073 7461 7274 203d  .        start =
-0003c0b0: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-0003c0c0: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
-0003c0d0: 6572 726c 6973 7420 3d20 5b5d 0a20 2020  errlist = [].   
-0003c0e0: 2020 2020 2064 6174 6164 6963 7420 3d20       datadict = 
-0003c0f0: 6469 6374 2829 0a20 2020 2020 2020 2066  dict().        f
-0003c100: 696e 616c 6469 6374 203d 2064 6963 7428  inaldict = dict(
-0003c110: 290a 2020 2020 2020 2020 2320 6576 656e  ).        # even
-0003c120: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-0003c130: 6173 656e 616d 6528 6d61 7065 7665 6e2e  asename(mapeven.
-0003c140: 6675 6c6c 6e61 6d65 290a 2020 2020 2020  fullname).      
-0003c150: 2020 2320 6f64 646e 616d 6520 3d20 6f73    # oddname = os
-0003c160: 2e70 6174 682e 6261 7365 6e61 6d65 286d  .path.basename(m
-0003c170: 6170 6f64 642e 6675 6c6c 6e61 6d65 290a  apodd.fullname).
-0003c180: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0003c190: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0003c1a0: 6d61 706f 6464 2e64 6174 612e 7368 6170  mapodd.data.shap
-0003c1b0: 6520 3d3d 206d 6170 6576 656e 2e64 6174  e == mapeven.dat
-0003c1c0: 612e 7368 6170 652c 2027 5468 6520 7477  a.shape, 'The tw
-0003c1d0: 6f20 6861 6c66 206d 6170 7320 646f 206e  o half maps do n
-0003c1e0: 6f74 2068 6176 6520 7361 6d65 2073 697a  ot have same siz
-0003c1f0: 652e 270a 2020 2020 2020 2020 2020 2020  e.'.            
-0003c200: 6173 7365 7274 206d 6170 6f64 642e 766f  assert mapodd.vo
-0003c210: 7865 6c5f 7369 7a65 203d 3d20 6d61 7065  xel_size == mape
-0003c220: 7665 6e2e 766f 7865 6c5f 7369 7a65 2c20  ven.voxel_size, 
-0003c230: 2754 6865 2074 776f 2068 616c 6620 6d61  'The two half ma
-0003c240: 7073 2064 6f20 6e6f 7420 6861 7665 2073  ps do not have s
-0003c250: 616d 6520 6170 6978 2e27 0a20 2020 2020  ame apix.'.     
-0003c260: 2020 2020 2020 206f 6464 6e61 6e20 3d20         oddnan = 
-0003c270: 6e70 2e69 736e 616e 286d 6170 6f64 642e  np.isnan(mapodd.
-0003c280: 6461 7461 292e 616e 7928 290a 2020 2020  data).any().    
-0003c290: 2020 2020 2020 2020 6576 656e 6e61 6e20          evennan 
-0003c2a0: 3d20 6e70 2e69 736e 616e 286d 6170 6576  = np.isnan(mapev
-0003c2b0: 656e 2e64 6174 6129 2e61 6e79 2829 0a20  en.data).any(). 
-0003c2c0: 2020 2020 2020 2020 2020 206e 616e 6368             nanch
-0003c2d0: 6563 6b20 3d20 6f64 646e 616e 207c 2065  eck = oddnan | e
-0003c2e0: 7665 6e6e 616e 0a20 2020 2020 2020 2020  vennan.         
-0003c2f0: 2020 2061 7373 6572 7420 6e6f 7420 6e61     assert not na
-0003c300: 6e63 6865 636b 2c20 2754 6865 7265 2069  ncheck, 'There i
-0003c310: 7320 4e61 4e20 7661 6c75 6520 696e 2068  s NaN value in h
-0003c320: 616c 6620 6d61 702e 270a 2020 2020 2020  alf map.'.      
-0003c330: 2020 2020 2020 2320 4173 7375 6d65 2061        # Assume a
-0003c340: 6c6c 2064 696d 656e 7369 6f6e 2061 7265  ll dimension are
-0003c350: 2074 6865 2073 616d 6520 7369 7a65 0a0a   the same size..
-0003c360: 2020 2020 2020 2020 2020 2020 6170 6978              apix
-0003c370: 7320 3d20 7475 706c 6528 6d61 706f 6464  s = tuple(mapodd
-0003c380: 2e76 6f78 656c 5f73 697a 652e 746f 6c69  .voxel_size.toli
-0003c390: 7374 2829 290a 0a20 2020 2020 2020 2020  st())..         
-0003c3a0: 2020 206d 6170 6f64 645f 6461 7461 203d     mapodd_data =
-0003c3b0: 2066 6674 7368 6966 7428 6666 746e 286d   fftshift(fftn(m
-0003c3c0: 6170 6f64 642e 6461 7461 2929 0a20 2020  apodd.data)).   
-0003c3d0: 2020 2020 2020 2020 206d 6170 6f64 642e           mapodd.
-0003c3e0: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-0003c3f0: 2020 2020 6d61 7065 7665 6e5f 6461 7461      mapeven_data
-0003c400: 203d 2066 6674 7368 6966 7428 6666 746e   = fftshift(fftn
-0003c410: 286d 6170 6576 656e 2e64 6174 6129 290a  (mapeven.data)).
-0003c420: 2020 2020 2020 2020 2020 2020 6d61 7065              mape
-0003c430: 7665 6e2e 636c 6f73 6528 290a 0a20 2020  ven.close()..   
-0003c440: 2020 2020 2020 2020 2073 7461 7274 203d           start =
-0003c450: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-0003c460: 7469 6d65 7228 2920 2d20 7374 6172 740a  timer() - start.
-0003c470: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0003c480: 7428 2720 2d2d 2046 5343 2046 6f75 7269  t(' -- FSC Fouri
-0003c490: 6572 2d74 7261 6e73 666f 726d 6174 696f  er-transformatio
-0003c4a0: 6e20 7469 6d65 3a20 2573 2720 2520 7374  n time: %s' % st
-0003c4b0: 6172 7429 0a0a 2020 2020 2020 2020 2020  art)..          
-0003c4c0: 2020 6966 2074 7970 6528 6170 6978 7329    if type(apixs)
-0003c4d0: 2069 7320 7475 706c 653a 0a20 2020 2020   is tuple:.     
-0003c4e0: 2020 2020 2020 2020 2020 2074 6170 6978             tapix
-0003c4f0: 203d 2061 7069 7873 5b30 5d0a 2020 2020   = apixs[0].    
-0003c500: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0003c510: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-0003c520: 7069 7820 3d20 6170 6978 730a 0a20 2020  pix = apixs..   
-0003c530: 2020 2020 2020 2020 2023 204c 6f6f 7069           # Loopi
-0003c540: 6e67 2074 6872 6f75 6768 2061 6c6c 2073  ng through all s
-0003c550: 6865 6c6c 730a 2020 2020 2020 2020 2020  hells.          
-0003c560: 2020 636f 7272 6c69 7374 203d 205b 5d0a    corrlist = [].
-0003c570: 2020 2020 2020 2020 2020 2020 7468 7265              thre
-0003c580: 6573 6967 203d 205b 5d0a 2020 2020 2020  esig = [].      
-0003c590: 2020 2020 2020 6861 6c66 6269 7420 3d20        halfbit = 
-0003c5a0: 5b5d 0a20 2020 2020 2020 2020 2020 206f  [].            o
-0003c5b0: 6e65 6269 7420 3d20 5b5d 0a0a 2020 2020  nebit = []..    
-0003c5c0: 2020 2020 2020 2020 2323 2061 7070 6c79          ## apply
-0003c5d0: 696e 6720 6e65 7720 696e 6469 6365 7320  ing new indices 
-0003c5e0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-0003c5f0: 2020 2020 206d 6170 5f73 6861 7065 203d       map_shape =
-0003c600: 206d 6170 6f64 645f 6461 7461 2e73 6861   mapodd_data.sha
-0003c610: 7065 0a20 2020 2020 2020 2020 2020 2069  pe.            i
-0003c620: 6620 6d69 6e28 6d61 705f 7368 6170 6529  f min(map_shape)
-0003c630: 2025 2032 203d 3d20 303a 0a20 2020 2020   % 2 == 0:.     
-0003c640: 2020 2020 2020 2020 2020 206f 7267 203d             org =
-0003c650: 205b 6d61 705f 7368 6170 655b 305d 202f   [map_shape[0] /
-0003c660: 2032 2c20 6d61 705f 7368 6170 655b 315d   2, map_shape[1]
-0003c670: 202f 2032 2c20 6d61 705f 7368 6170 655b   / 2, map_shape[
-0003c680: 325d 202f 2032 5d0a 2020 2020 2020 2020  2] / 2].        
-0003c690: 2020 2020 2020 2020 696e 6469 6178 6973          indiaxis
-0003c6a0: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
-0003c6b0: 2c20 696e 7428 6d69 6e28 6f72 6729 292c  , int(min(org)),
-0003c6c0: 2069 6e74 286d 696e 286f 7267 2929 202b   int(min(org)) +
-0003c6d0: 2031 2920 2f20 286d 696e 286d 6170 5f73   1) / (min(map_s
-0003c6e0: 6861 7065 2920 2a20 7461 7069 7829 0a20  hape) * tapix). 
-0003c6f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0003c700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003c710: 206f 7267 203d 205b 286d 6170 5f73 6861   org = [(map_sha
-0003c720: 7065 5b30 5d20 2d20 3129 202f 2032 2c20  pe[0] - 1) / 2, 
-0003c730: 286d 6170 5f73 6861 7065 5b31 5d20 2d20  (map_shape[1] - 
-0003c740: 3129 202f 2032 2c20 286d 6170 5f73 6861  1) / 2, (map_sha
-0003c750: 7065 5b32 5d20 2d20 3129 202f 2032 5d0a  pe[2] - 1) / 2].
-0003c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c770: 696e 6469 6178 6973 203d 206e 702e 6c69  indiaxis = np.li
-0003c780: 6e73 7061 6365 2830 2c20 696e 7428 6d69  nspace(0, int(mi
-0003c790: 6e28 6f72 6729 292c 2069 6e74 286d 696e  n(org)), int(min
-0003c7a0: 286f 7267 2929 202b 2031 2920 2f20 286d  (org)) + 1) / (m
-0003c7b0: 696e 286d 6170 5f73 6861 7065 2920 2a20  in(map_shape) * 
-0003c7c0: 7461 7069 7829 0a20 2020 2020 2020 2020  tapix).         
-0003c7d0: 2020 2020 2020 2069 6e64 6961 7869 7320         indiaxis 
-0003c7e0: 3d20 6e70 2e61 7070 656e 6428 696e 6469  = np.append(indi
-0003c7f0: 6178 6973 2c20 312f 2832 202a 2074 6170  axis, 1/(2 * tap
-0003c800: 6978 2929 0a20 2020 2020 2020 2020 2020  ix)).           
-0003c810: 2023 2069 6e64 6961 7869 7320 3d20 6e70   # indiaxis = np
-0003c820: 2e6c 696e 7370 6163 6528 302c 2069 6e74  .linspace(0, int
-0003c830: 286f 7267 5b30 5d29 2c20 696e 7428 6f72  (org[0]), int(or
-0003c840: 675b 305d 2920 2b20 3129 202f 2028 6d61  g[0]) + 1) / (ma
-0003c850: 705f 7368 6170 655b 305d 202a 2074 6170  p_shape[0] * tap
-0003c860: 6978 290a 2020 2020 2020 2020 2020 2020  ix).            
-0003c870: 7368 656c 6c5f 7261 6e67 6520 3d20 696e  shell_range = in
-0003c880: 7428 6d69 6e28 6d61 705f 7368 6170 6529  t(min(map_shape)
-0003c890: 202d 206d 696e 286f 7267 2929 0a20 2020   - min(org)).   
-0003c8a0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-0003c8b0: 6e20 7261 6e67 6528 302c 2073 6865 6c6c  n range(0, shell
-0003c8c0: 5f72 616e 6765 293a 0a20 2020 2020 2020  _range):.       
-0003c8d0: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
-0003c8e0: 203d 2073 656c 662e 6765 6e65 7261 7465   = self.generate
-0003c8f0: 5f73 6865 6c6c 2869 2c20 6920 2b20 312c  _shell(i, i + 1,
-0003c900: 206d 6170 5f73 6861 7065 290a 2020 2020   map_shape).    
-0003c910: 2020 2020 2020 2020 2020 2020 6f64 6472              oddr
-0003c920: 696e 6720 3d20 6d61 706f 6464 5f64 6174  ing = mapodd_dat
-0003c930: 615b 7475 706c 6528 696e 6469 6365 732e  a[tuple(indices.
-0003c940: 5429 5d0a 2020 2020 2020 2020 2020 2020  T)].            
-0003c950: 2020 2020 6576 656e 7269 6e67 203d 206d      evenring = m
-0003c960: 6170 6576 656e 5f64 6174 615b 7475 706c  apeven_data[tupl
-0003c970: 6528 696e 6469 6365 732e 5429 5d0a 2020  e(indices.T)].  
-0003c980: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0003c990: 7272 203d 2028 6f64 6472 696e 6720 2a20  rr = (oddring * 
-0003c9a0: 6e70 2e63 6f6e 6a28 6576 656e 7269 6e67  np.conj(evenring
-0003c9b0: 2929 2e73 756d 2829 0a20 2020 2020 2020  )).sum().       
-0003c9c0: 2020 2020 2020 2020 2063 6f72 725f 6465           corr_de
-0003c9d0: 6e6f 203d 206e 702e 7371 7274 2828 6e70  no = np.sqrt((np
-0003c9e0: 2e61 6273 286f 6464 7269 6e67 2920 2a2a  .abs(oddring) **
-0003c9f0: 2032 292e 7375 6d28 2920 2a20 286e 702e   2).sum() * (np.
-0003ca00: 6162 7328 6576 656e 7269 6e67 2920 2a2a  abs(evenring) **
-0003ca10: 2032 292e 7375 6d28 2929 0a20 2020 2020   2).sum()).     
-0003ca20: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0003ca30: 7272 5f64 656e 6f20 3d3d 2030 2e3a 0a20  rr_deno == 0.:. 
-0003ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ca50: 2020 206e 6f72 636f 7272 203d 2030 2e0a     norcorr = 0..
-0003ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ca70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003ca80: 2020 2020 2020 2020 2020 6e6f 7263 6f72            norcor
-0003ca90: 7220 3d20 6e70 2e72 6561 6c28 636f 7272  r = np.real(corr
-0003caa0: 202f 2063 6f72 725f 6465 6e6f 290a 2020   / corr_deno).  
-0003cab0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0003cac0: 7272 6c69 7374 2e61 7070 656e 6428 6e6f  rrlist.append(no
-0003cad0: 7263 6f72 7229 0a0a 2020 2020 2020 2020  rcorr)..        
-0003cae0: 2020 2020 2020 2020 766f 6c75 6d65 6469          volumedi
-0003caf0: 6666 203d 2028 342e 3020 2f20 332e 3029  ff = (4.0 / 3.0)
-0003cb00: 202a 2070 6920 2a20 2828 6920 2b20 3129   * pi * ((i + 1)
-0003cb10: 202a 2a20 3320 2d20 6920 2a2a 2033 290a   ** 3 - i ** 3).
-0003cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb30: 6e76 6f78 7269 6e67 203d 2076 6f6c 756d  nvoxring = volum
-0003cb40: 6564 6966 6620 2f20 2831 202a 2a20 3329  ediff / (1 ** 3)
-0003cb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003cb60: 2065 6666 6e76 6f78 203d 2028 6e76 6f78   effnvox = (nvox
-0003cb70: 7269 6e67 202a 2028 2831 2e35 202a 2030  ring * ((1.5 * 0
-0003cb80: 2e36 3629 202a 2a20 3229 2920 2f20 2832  .66) ** 2)) / (2
-0003cb90: 202a 2061 7379 6d29 0a20 2020 2020 2020   * asym).       
-0003cba0: 2020 2020 2020 2020 2069 6620 6566 666e           if effn
-0003cbb0: 766f 7820 3c20 312e 303a 2065 6666 6e76  vox < 1.0: effnv
-0003cbc0: 6f78 203d 2031 2e30 0a20 2020 2020 2020  ox = 1.0.       
-0003cbd0: 2020 2020 2020 2020 2073 7172 6566 666e           sqreffn
-0003cbe0: 766f 7820 3d20 6e70 2e73 7172 7428 6566  vox = np.sqrt(ef
-0003cbf0: 666e 766f 7829 0a0a 2020 2020 2020 2020  fnvox)..        
-0003cc00: 2020 2020 2020 2020 7369 6776 616c 7565          sigvalue
-0003cc10: 203d 2033 202f 2028 7371 7265 6666 6e76   = 3 / (sqreffnv
-0003cc20: 6f78 202b 2033 2e30 202d 2031 2e30 290a  ox + 3.0 - 1.0).
-0003cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cc40: 7468 7265 6573 6967 2e61 7070 656e 6428  threesig.append(
-0003cc50: 7369 6776 616c 7565 290a 2020 2020 2020  sigvalue).      
-0003cc60: 2020 2020 2020 2020 2020 6269 7476 616c            bitval
-0003cc70: 7565 203d 2028 302e 3230 3731 202b 2031  ue = (0.2071 + 1
-0003cc80: 2e39 3130 3220 2f20 7371 7265 6666 6e76  .9102 / sqreffnv
-0003cc90: 6f78 2920 2f20 2831 2e32 3037 3120 2b20  ox) / (1.2071 + 
-0003cca0: 302e 3931 3032 202f 2073 7172 6566 666e  0.9102 / sqreffn
-0003ccb0: 766f 7829 0a20 2020 2020 2020 2020 2020  vox).           
-0003ccc0: 2020 2020 2068 616c 6662 6974 2e61 7070       halfbit.app
-0003ccd0: 656e 6428 6269 7476 616c 7565 290a 2020  end(bitvalue).  
-0003cce0: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-0003ccf0: 6562 6974 7661 6c75 6520 3d20 2830 2e35  ebitvalue = (0.5
-0003cd00: 202b 2032 2e34 3134 3220 2f20 7371 7265   + 2.4142 / sqre
-0003cd10: 6666 6e76 6f78 2920 2f20 2831 2e35 202b  ffnvox) / (1.5 +
-0003cd20: 2031 2e34 3134 3220 2f20 7371 7265 6666   1.4142 / sqreff
-0003cd30: 6e76 6f78 290a 2020 2020 2020 2020 2020  nvox).          
-0003cd40: 2020 2020 2020 6f6e 6562 6974 2e61 7070        onebit.app
-0003cd50: 656e 6428 6f6e 6562 6974 7661 6c75 6529  end(onebitvalue)
-0003cd60: 0a0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0003cd70: 7272 6c69 7374 2e69 6e73 6572 7428 302c  rrlist.insert(0,
-0003cd80: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-0003cd90: 7468 7265 6573 6967 2e69 6e73 6572 7428  threesig.insert(
-0003cda0: 302c 2031 290a 2020 2020 2020 2020 2020  0, 1).          
-0003cdb0: 2020 6861 6c66 6269 742e 696e 7365 7274    halfbit.insert
-0003cdc0: 2830 2c20 3129 0a20 2020 2020 2020 2020  (0, 1).         
-0003cdd0: 2020 206f 6e65 6269 742e 696e 7365 7274     onebit.insert
-0003cde0: 2830 2c20 3129 0a20 2020 2020 2020 2020  (0, 1).         
-0003cdf0: 2020 2064 656c 206d 6170 6f64 645f 6461     del mapodd_da
-0003ce00: 7461 0a20 2020 2020 2020 2020 2020 2064  ta.            d
-0003ce10: 656c 206d 6170 6576 656e 5f64 6174 610a  el mapeven_data.
-0003ce20: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-0003ce30: 6620 616e 7920 6f66 2074 6865 2066 6972  f any of the fir
-0003ce40: 7374 2035 2076 616c 7565 7320 6973 206e  st 5 values is n
-0003ce50: 6567 6174 6976 652c 206d 616b 6520 6974  egative, make it
-0003ce60: 2074 6f20 310a 2020 2020 2020 2020 2020   to 1.          
-0003ce70: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0003ce80: 2830 2c20 3529 3a0a 2020 2020 2020 2020  (0, 5):.        
-0003ce90: 2020 2020 2020 2020 6966 2063 6f72 726c          if corrl
-0003cea0: 6973 745b 695d 203c 3d20 303a 0a20 2020  ist[i] <= 0:.   
-0003ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cec0: 2063 6f72 726c 6973 745b 695d 203d 2031   corrlist[i] = 1
-0003ced0: 0a0a 2020 2020 2020 2020 2020 2020 6120  ..            a 
-0003cee0: 3d20 6e70 2e61 7361 7272 6179 2869 6e64  = np.asarray(ind
-0003cef0: 6961 7869 7329 0a20 2020 2020 2020 2020  iaxis).         
-0003cf00: 2020 2062 203d 206e 702e 6173 6172 7261     b = np.asarra
-0003cf10: 7928 636f 7272 6c69 7374 290a 2020 2020  y(corrlist).    
-0003cf20: 2020 2020 2020 2020 6320 3d20 6e70 2e61          c = np.a
-0003cf30: 7361 7272 6179 2874 6872 6565 7369 6729  sarray(threesig)
-0003cf40: 0a20 2020 2020 2020 2020 2020 2064 203d  .            d =
-0003cf50: 206e 702e 6173 6172 7261 7928 6861 6c66   np.asarray(half
-0003cf60: 6269 7429 0a20 2020 2020 2020 2020 2020  bit).           
-0003cf70: 2065 203d 206e 702e 6173 6172 7261 7928   e = np.asarray(
-0003cf80: 6f6e 6562 6974 290a 2020 2020 2020 2020  onebit).        
-0003cf90: 2020 2020 6620 3d20 6e70 2e66 756c 6c28      f = np.full(
-0003cfa0: 286c 656e 2869 6e64 6961 7869 7329 292c  (len(indiaxis)),
-0003cfb0: 2030 2e35 290a 2020 2020 2020 2020 2020   0.5).          
-0003cfc0: 2020 6720 3d20 6e70 2e66 756c 6c28 286c    g = np.full((l
-0003cfd0: 656e 2869 6e64 6961 7869 7329 292c 2030  en(indiaxis)), 0
-0003cfe0: 2e33 3333 290a 2020 2020 2020 2020 2020  .333).          
-0003cff0: 2020 6820 3d20 6e70 2e66 756c 6c28 286c    h = np.full((l
-0003d000: 656e 2869 6e64 6961 7869 7329 292c 2030  en(indiaxis)), 0
-0003d010: 2e31 3433 290a 2020 2020 2020 2020 2020  .143).          
-0003d020: 2020 2320 7573 6520 5b3a 315d 2074 6f20    # use [:1] to 
-0003d030: 6967 6e6f 7265 2061 6c6c 2074 6865 2063  ignore all the c
-0003d040: 7572 7665 7320 7374 6172 7420 6672 6f6d  urves start from
-0003d050: 2030 2c31 0a20 2020 2020 2020 2020 2020   0,1.           
-0003d060: 2078 7468 7265 6573 6967 2c20 7974 6872   xthreesig, ythr
-0003d070: 6565 7369 6720 3d20 7365 6c66 2e5f 5f69  eesig = self.__i
-0003d080: 6e74 6572 706f 6c61 7465 645f 696e 7465  nterpolated_inte
-0003d090: 7263 6570 7428 612c 2062 2c20 6329 0a20  rcept(a, b, c). 
-0003d0a0: 2020 2020 2020 2020 2020 2078 6861 6c66             xhalf
-0003d0b0: 6269 742c 2079 6861 6c66 6269 7420 3d20  bit, yhalfbit = 
-0003d0c0: 7365 6c66 2e5f 5f69 6e74 6572 706f 6c61  self.__interpola
-0003d0d0: 7465 645f 696e 7465 7263 6570 7428 612c  ted_intercept(a,
-0003d0e0: 2062 2c20 6429 0a20 2020 2020 2020 2020   b, d).         
-0003d0f0: 2020 2078 6f6e 6562 6974 2c20 796f 6e65     xonebit, yone
-0003d100: 6269 7420 3d20 7365 6c66 2e5f 5f69 6e74  bit = self.__int
-0003d110: 6572 706f 6c61 7465 645f 696e 7465 7263  erpolated_interc
-0003d120: 6570 7428 612c 2062 2c20 6529 0a20 2020  ept(a, b, e).   
-0003d130: 2020 2020 2020 2020 2078 6861 6c66 2c20           xhalf, 
-0003d140: 7968 616c 6620 3d20 7365 6c66 2e5f 5f69  yhalf = self.__i
+0003b860: 2020 2020 2027 302e 3527 3a20 7b27 7827       '0.5': {'x'
+0003b870: 3a20 7868 616c 662c 2027 7927 3a20 7968  : xhalf, 'y': yh
+0003b880: 616c 667d 2c0a 2020 2020 2020 2020 2020  alf},.          
+0003b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b8a0: 2020 2020 2020 2020 2730 2e33 3333 273a          '0.333':
+0003b8b0: 207b 2778 273a 2078 6f6e 6574 6872 6565   {'x': xonethree
+0003b8c0: 2c20 2779 273a 2079 6f6e 6574 6872 6565  , 'y': yonethree
+0003b8d0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+0003b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b8f0: 2020 2020 2027 302e 3134 3327 3a20 7b27       '0.143': {'
+0003b900: 7827 3a20 7867 6f6c 642c 2027 7927 3a20  x': xgold, 'y': 
+0003b910: 7967 6f6c 647d 7d7d 0a20 2020 2020 2020  ygold}}}.       
+0003b920: 2020 2020 2066 696e 616c 6469 6374 203d       finaldict =
+0003b930: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
+0003b940: 2020 2020 6669 6e61 6c64 6963 745b 6c61      finaldict[la
+0003b950: 6265 6c20 2b20 2766 7363 275d 203d 2064  bel + 'fsc'] = d
+0003b960: 6174 6164 6963 740a 0a20 2020 2020 2020  atadict..       
+0003b970: 2020 2020 2070 6c74 2e70 6c6f 7428 696e       plt.plot(in
+0003b980: 6469 6178 6973 2c20 636f 7272 6c69 7374  diaxis, corrlist
+0003b990: 2c20 6c61 6265 6c3d 6c61 6265 6c20 2b20  , label=label + 
+0003b9a0: 2746 5343 2729 0a20 2020 2020 2020 2020  'FSC').         
+0003b9b0: 2020 2023 2070 6c74 2e70 6c6f 7428 696e     # plt.plot(in
+0003b9c0: 6469 6178 6973 2c20 7468 7265 6573 6967  diaxis, threesig
+0003b9d0: 2c20 6c61 6265 6c3d 2733 2073 6967 6d61  , label='3 sigma
+0003b9e0: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+0003b9f0: 6c74 2e70 6c6f 7428 696e 6469 6178 6973  lt.plot(indiaxis
+0003ba00: 2c20 6861 6c66 6269 742c 206c 6162 656c  , halfbit, label
+0003ba10: 3d27 312f 3220 6269 7427 290a 2020 2020  ='1/2 bit').    
+0003ba20: 2020 2020 2020 2020 2320 706c 742e 706c          # plt.pl
+0003ba30: 6f74 2869 6e64 6961 7869 732c 206f 6e65  ot(indiaxis, one
+0003ba40: 6269 742c 206c 6162 656c 3d27 3120 6269  bit, label='1 bi
+0003ba50: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+0003ba60: 706c 742e 706c 6f74 2869 6e64 6961 7869  plt.plot(indiaxi
+0003ba70: 732c 2066 2c20 6c61 6265 6c3d 2730 2e35  s, f, label='0.5
+0003ba80: 272c 206c 696e 6573 7479 6c65 3d27 3a27  ', linestyle=':'
+0003ba90: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0003baa0: 706c 742e 706c 6f74 2869 6e64 6961 7869  plt.plot(indiaxi
+0003bab0: 732c 2067 2c20 6c61 6265 6c3d 2730 2e33  s, g, label='0.3
+0003bac0: 3333 272c 206c 696e 6573 7479 6c65 3d27  33', linestyle='
+0003bad0: 2d2d 2729 0a20 2020 2020 2020 2020 2020  --').           
+0003bae0: 2070 6c74 2e70 6c6f 7428 696e 6469 6178   plt.plot(indiax
+0003baf0: 6973 2c20 682c 206c 6162 656c 3d27 302e  is, h, label='0.
+0003bb00: 3134 3327 2c20 6c69 6e65 7374 796c 653d  143', linestyle=
+0003bb10: 272d 2e27 290a 2020 2020 2020 2020 2020  '-.').          
+0003bb20: 2020 706c 742e 6c65 6765 6e64 2829 0a20    plt.legend(). 
+0003bb30: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
+0003bb40: 6265 6c3a 0a20 2020 2020 2020 2020 2020  bel:.           
+0003bb50: 2020 2020 2070 6c74 2e73 6176 6566 6967       plt.savefig
+0003bb60: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
+0003bb70: 7365 6c66 2e6d 6170 6e61 6d65 202b 2027  self.mapname + '
+0003bb80: 5f27 202b 206c 6162 656c 202b 2027 5f66  _' + label + '_f
+0003bb90: 7363 2e70 6e67 2729 0a20 2020 2020 2020  sc.png').       
+0003bba0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003bbb0: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
+0003bbc0: 6176 6566 6967 2873 656c 662e 776f 726b  avefig(self.work
+0003bbd0: 6469 7220 2b20 7365 6c66 2e6d 6170 6e61  dir + self.mapna
+0003bbe0: 6d65 202b 2027 5f66 7363 2e70 6e67 2729  me + '_fsc.png')
+0003bbf0: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
+0003bc00: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
+0003bc10: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0003bc20: 2020 2020 2020 6572 7220 3d20 2746 5343        err = 'FSC
+0003bc30: 2063 616c 6375 6c61 7469 6f6e 2065 7272   calculation err
+0003bc40: 6f72 3a20 7b7d 272e 666f 726d 6174 2873  or: {}'.format(s
+0003bc50: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+0003bc60: 290a 2020 2020 2020 2020 2020 2020 6572  ).            er
+0003bc70: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
+0003bc80: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
+0003bc90: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
+0003bca0: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
+0003bcb0: 2020 2020 6966 2065 7272 6c69 7374 3a0a      if errlist:.
+0003bcc0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0003bcd0: 6469 6374 203d 207b 2765 7272 273a 207b  dict = {'err': {
+0003bce0: 6c61 6265 6c20 2b20 2766 7363 5f65 7272  label + 'fsc_err
+0003bcf0: 6f72 273a 2065 7272 6c69 7374 7d7d 0a20  or': errlist}}. 
+0003bd00: 2020 2020 2020 2020 2020 2066 696e 616c             final
+0003bd10: 6469 6374 5b6c 6162 656c 202b 2027 6673  dict[label + 'fs
+0003bd20: 6327 5d20 3d20 6461 7461 6469 6374 0a20  c'] = datadict. 
+0003bd30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003bd40: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0003bd50: 4e6f 2065 7272 6f72 2069 6e20 4653 4320  No error in FSC 
+0003bd60: 6361 6c63 756c 6174 696f 6e2e 2729 0a0a  calculation.')..
+0003bd70: 2020 2020 2020 2020 6966 2062 6f6f 6c28          if bool(
+0003bd80: 6461 7461 6469 6374 2920 616e 6420 626f  datadict) and bo
+0003bd90: 6f6c 2866 696e 616c 6469 6374 293a 0a20  ol(finaldict):. 
+0003bda0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0003bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bdc0: 7769 7468 2063 6f64 6563 732e 6f70 656e  with codecs.open
+0003bdd0: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
+0003bde0: 7365 6c66 2e6d 6170 6e61 6d65 202b 2027  self.mapname + '
+0003bdf0: 5f27 202b 206c 6162 656c 202b 2027 6673  _' + label + 'fs
+0003be00: 632e 6a73 6f6e 272c 2027 7727 2c20 656e  c.json', 'w', en
+0003be10: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
+0003be20: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0003be30: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
+0003be40: 756d 7028 6669 6e61 6c64 6963 742c 2066  ump(finaldict, f
+0003be50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003be60: 2020 7072 696e 7428 2746 5343 2070 726f    print('FSC pro
+0003be70: 6475 6365 6420 6279 2074 776f 2068 616c  duced by two hal
+0003be80: 6620 6d61 7073 2e27 290a 2020 2020 2020  f maps.').      
+0003be90: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0003bea0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0003beb0: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
+0003bec0: 5772 6974 696e 6720 4653 4320 6461 7461  Writing FSC data
+0003bed0: 2074 6f20 6a73 6f6e 2066 696c 6520 6572   to json file er
+0003bee0: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
+0003bef0: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
+0003bf00: 315d 2929 0a20 2020 2020 2020 2065 6c73  1])).        els
+0003bf10: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+0003bf20: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+0003bf30: 2746 5343 2063 616c 6375 6c61 7469 6f6e  'FSC calculation
+0003bf40: 2067 6574 206e 6f6e 6520 2729 0a0a 2020   get none ')..  
+0003bf50: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0003bf60: 650a 0a0a 2020 2020 2320 4070 726f 6669  e...    # @profi
+0003bf70: 6c65 0a20 2020 2064 6566 206e 6577 5f66  le.    def new_f
+0003bf80: 7363 2873 656c 662c 206d 6170 6f64 642c  sc(self, mapodd,
+0003bf90: 206d 6170 6576 656e 2c20 6173 796d 3d31   mapeven, asym=1
+0003bfa0: 2e30 2c20 6c61 6265 6c3d 2727 293a 0a20  .0, label=''):. 
+0003bfb0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0003bfc0: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
+0003bfd0: 6520 4653 4320 6261 7365 6420 6f6e 2074  e FSC based on t
+0003bfe0: 6865 2074 776f 2069 6e70 7574 2068 616c  he two input hal
+0003bff0: 6620 6d61 7073 0a20 2020 2020 2020 2020  f maps.         
+0003c000: 2020 2052 6573 756c 7473 2077 726f 7465     Results wrote
+0003c010: 2074 6f20 4a53 4f4e 2066 696c 6520 696e   to JSON file in
+0003c020: 636c 7564 696e 6720 7265 736f 6c75 7469  cluding resoluti
+0003c030: 6f6e 2061 7420 302e 3134 332c 2030 2e33  on at 0.143, 0.3
+0003c040: 3333 2c20 302e 3520 616e 6420 6e6f 6973  33, 0.5 and nois
+0003c050: 650a 2020 2020 2020 2020 2020 2020 6c65  e.            le
+0003c060: 7665 6c20 6174 2030 2e35 2d62 6974 2c20  vel at 0.5-bit, 
+0003c070: 312d 6269 742c 2033 2d73 6967 6d61 2e20  1-bit, 3-sigma. 
+0003c080: 4120 636f 7272 6573 706f 6e64 696e 6720  A corresponding 
+0003c090: 706c 6f74 2069 7320 616c 736f 2073 6176  plot is also sav
+0003c0a0: 6520 6173 2050 4e47 2066 696c 652e 0a0a  e as PNG file...
+0003c0b0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+0003c0c0: 6170 6f64 643a 2054 454d 5079 206d 6170  apodd: TEMPy map
+0003c0d0: 2069 6e73 7461 6e63 650a 2020 2020 2020   instance.      
+0003c0e0: 2020 3a70 6172 616d 206d 6170 6576 656e    :param mapeven
+0003c0f0: 3a20 5445 4d50 7920 6d61 7020 696e 7374  : TEMPy map inst
+0003c100: 616e 6365 0a20 2020 2020 2020 203a 7265  ance.        :re
+0003c110: 7475 726e 3a20 4e6f 6e65 0a0a 2020 2020  turn: None..    
+0003c120: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0003c130: 2073 7461 7274 203d 2074 696d 6569 742e   start = timeit.
+0003c140: 6465 6661 756c 745f 7469 6d65 7228 290a  default_timer().
+0003c150: 2020 2020 2020 2020 6572 726c 6973 7420          errlist 
+0003c160: 3d20 5b5d 0a20 2020 2020 2020 2064 6174  = [].        dat
+0003c170: 6164 6963 7420 3d20 6469 6374 2829 0a20  adict = dict(). 
+0003c180: 2020 2020 2020 2066 696e 616c 6469 6374         finaldict
+0003c190: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+0003c1a0: 2020 2320 6576 656e 6e61 6d65 203d 206f    # evenname = o
+0003c1b0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0003c1c0: 6d61 7065 7665 6e2e 6675 6c6c 6e61 6d65  mapeven.fullname
+0003c1d0: 290a 2020 2020 2020 2020 2320 6f64 646e  ).        # oddn
+0003c1e0: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+0003c1f0: 7365 6e61 6d65 286d 6170 6f64 642e 6675  sename(mapodd.fu
+0003c200: 6c6c 6e61 6d65 290a 2020 2020 2020 2020  llname).        
+0003c210: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0003c220: 2061 7373 6572 7420 6d61 706f 6464 2e64   assert mapodd.d
+0003c230: 6174 612e 7368 6170 6520 3d3d 206d 6170  ata.shape == map
+0003c240: 6576 656e 2e64 6174 612e 7368 6170 652c  even.data.shape,
+0003c250: 2027 5468 6520 7477 6f20 6861 6c66 206d   'The two half m
+0003c260: 6170 7320 646f 206e 6f74 2068 6176 6520  aps do not have 
+0003c270: 7361 6d65 2073 697a 652e 270a 2020 2020  same size.'.    
+0003c280: 2020 2020 2020 2020 6173 7365 7274 206d          assert m
+0003c290: 6170 6f64 642e 766f 7865 6c5f 7369 7a65  apodd.voxel_size
+0003c2a0: 203d 3d20 6d61 7065 7665 6e2e 766f 7865   == mapeven.voxe
+0003c2b0: 6c5f 7369 7a65 2c20 2754 6865 2074 776f  l_size, 'The two
+0003c2c0: 2068 616c 6620 6d61 7073 2064 6f20 6e6f   half maps do no
+0003c2d0: 7420 6861 7665 2073 616d 6520 6170 6978  t have same apix
+0003c2e0: 2e27 0a20 2020 2020 2020 2020 2020 206f  .'.            o
+0003c2f0: 6464 6e61 6e20 3d20 6e70 2e69 736e 616e  ddnan = np.isnan
+0003c300: 286d 6170 6f64 642e 6461 7461 292e 616e  (mapodd.data).an
+0003c310: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+0003c320: 6576 656e 6e61 6e20 3d20 6e70 2e69 736e  evennan = np.isn
+0003c330: 616e 286d 6170 6576 656e 2e64 6174 6129  an(mapeven.data)
+0003c340: 2e61 6e79 2829 0a20 2020 2020 2020 2020  .any().         
+0003c350: 2020 206e 616e 6368 6563 6b20 3d20 6f64     nancheck = od
+0003c360: 646e 616e 207c 2065 7665 6e6e 616e 0a20  dnan | evennan. 
+0003c370: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0003c380: 7420 6e6f 7420 6e61 6e63 6865 636b 2c20  t not nancheck, 
+0003c390: 2754 6865 7265 2069 7320 4e61 4e20 7661  'There is NaN va
+0003c3a0: 6c75 6520 696e 2068 616c 6620 6d61 702e  lue in half map.
+0003c3b0: 270a 2020 2020 2020 2020 2020 2020 2320  '.            # 
+0003c3c0: 4173 7375 6d65 2061 6c6c 2064 696d 656e  Assume all dimen
+0003c3d0: 7369 6f6e 2061 7265 2074 6865 2073 616d  sion are the sam
+0003c3e0: 6520 7369 7a65 0a0a 2020 2020 2020 2020  e size..        
+0003c3f0: 2020 2020 6170 6978 7320 3d20 7475 706c      apixs = tupl
+0003c400: 6528 6d61 706f 6464 2e76 6f78 656c 5f73  e(mapodd.voxel_s
+0003c410: 697a 652e 746f 6c69 7374 2829 290a 0a20  ize.tolist()).. 
+0003c420: 2020 2020 2020 2020 2020 206d 6170 6f64             mapod
+0003c430: 645f 6461 7461 203d 2066 6674 7368 6966  d_data = fftshif
+0003c440: 7428 6666 746e 286d 6170 6f64 642e 6461  t(fftn(mapodd.da
+0003c450: 7461 2929 0a20 2020 2020 2020 2020 2020  ta)).           
+0003c460: 206d 6170 6f64 642e 636c 6f73 6528 290a   mapodd.close().
+0003c470: 2020 2020 2020 2020 2020 2020 6d61 7065              mape
+0003c480: 7665 6e5f 6461 7461 203d 2066 6674 7368  ven_data = fftsh
+0003c490: 6966 7428 6666 746e 286d 6170 6576 656e  ift(fftn(mapeven
+0003c4a0: 2e64 6174 6129 290a 2020 2020 2020 2020  .data)).        
+0003c4b0: 2020 2020 6d61 7065 7665 6e2e 636c 6f73      mapeven.clos
+0003c4c0: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
+0003c4d0: 2073 7461 7274 203d 2074 696d 6569 742e   start = timeit.
+0003c4e0: 6465 6661 756c 745f 7469 6d65 7228 2920  default_timer() 
+0003c4f0: 2d20 7374 6172 740a 2020 2020 2020 2020  - start.        
+0003c500: 2020 2020 7072 696e 7428 2720 2d2d 2046      print(' -- F
+0003c510: 5343 2046 6f75 7269 6572 2d74 7261 6e73  SC Fourier-trans
+0003c520: 666f 726d 6174 696f 6e20 7469 6d65 3a20  formation time: 
+0003c530: 2573 2720 2520 7374 6172 7429 0a0a 2020  %s' % start)..  
+0003c540: 2020 2020 2020 2020 2020 6966 2074 7970            if typ
+0003c550: 6528 6170 6978 7329 2069 7320 7475 706c  e(apixs) is tupl
+0003c560: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003c570: 2020 2074 6170 6978 203d 2061 7069 7873     tapix = apixs
+0003c580: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0003c590: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0003c5a0: 2020 2020 2020 7461 7069 7820 3d20 6170        tapix = ap
+0003c5b0: 6978 730a 0a20 2020 2020 2020 2020 2020  ixs..           
+0003c5c0: 2023 204c 6f6f 7069 6e67 2074 6872 6f75   # Looping throu
+0003c5d0: 6768 2061 6c6c 2073 6865 6c6c 730a 2020  gh all shells.  
+0003c5e0: 2020 2020 2020 2020 2020 636f 7272 6c69            corrli
+0003c5f0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+0003c600: 2020 2020 7468 7265 6573 6967 203d 205b      threesig = [
+0003c610: 5d0a 2020 2020 2020 2020 2020 2020 6861  ].            ha
+0003c620: 6c66 6269 7420 3d20 5b5d 0a20 2020 2020  lfbit = [].     
+0003c630: 2020 2020 2020 206f 6e65 6269 7420 3d20         onebit = 
+0003c640: 5b5d 0a0a 2020 2020 2020 2020 2020 2020  []..            
+0003c650: 2323 2061 7070 6c79 696e 6720 6e65 7720  ## applying new 
+0003c660: 696e 6469 6365 7320 6675 6e63 7469 6f6e  indices function
+0003c670: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+0003c680: 5f73 6861 7065 203d 206d 6170 6f64 645f  _shape = mapodd_
+0003c690: 6461 7461 2e73 6861 7065 0a20 2020 2020  data.shape.     
+0003c6a0: 2020 2020 2020 2069 6620 6d69 6e28 6d61         if min(ma
+0003c6b0: 705f 7368 6170 6529 2025 2032 203d 3d20  p_shape) % 2 == 
+0003c6c0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0003c6d0: 2020 206f 7267 203d 205b 6d61 705f 7368     org = [map_sh
+0003c6e0: 6170 655b 305d 202f 2032 2c20 6d61 705f  ape[0] / 2, map_
+0003c6f0: 7368 6170 655b 315d 202f 2032 2c20 6d61  shape[1] / 2, ma
+0003c700: 705f 7368 6170 655b 325d 202f 2032 5d0a  p_shape[2] / 2].
+0003c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c720: 696e 6469 6178 6973 203d 206e 702e 6c69  indiaxis = np.li
+0003c730: 6e73 7061 6365 2830 2c20 696e 7428 6d69  nspace(0, int(mi
+0003c740: 6e28 6f72 6729 292c 2069 6e74 286d 696e  n(org)), int(min
+0003c750: 286f 7267 2929 202b 2031 2920 2f20 286d  (org)) + 1) / (m
+0003c760: 696e 286d 6170 5f73 6861 7065 2920 2a20  in(map_shape) * 
+0003c770: 7461 7069 7829 0a20 2020 2020 2020 2020  tapix).         
+0003c780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003c790: 2020 2020 2020 2020 206f 7267 203d 205b           org = [
+0003c7a0: 286d 6170 5f73 6861 7065 5b30 5d20 2d20  (map_shape[0] - 
+0003c7b0: 3129 202f 2032 2c20 286d 6170 5f73 6861  1) / 2, (map_sha
+0003c7c0: 7065 5b31 5d20 2d20 3129 202f 2032 2c20  pe[1] - 1) / 2, 
+0003c7d0: 286d 6170 5f73 6861 7065 5b32 5d20 2d20  (map_shape[2] - 
+0003c7e0: 3129 202f 2032 5d0a 2020 2020 2020 2020  1) / 2].        
+0003c7f0: 2020 2020 2020 2020 696e 6469 6178 6973          indiaxis
+0003c800: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
+0003c810: 2c20 696e 7428 6d69 6e28 6f72 6729 292c  , int(min(org)),
+0003c820: 2069 6e74 286d 696e 286f 7267 2929 202b   int(min(org)) +
+0003c830: 2031 2920 2f20 286d 696e 286d 6170 5f73   1) / (min(map_s
+0003c840: 6861 7065 2920 2a20 7461 7069 7829 0a20  hape) * tapix). 
+0003c850: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003c860: 6e64 6961 7869 7320 3d20 6e70 2e61 7070  ndiaxis = np.app
+0003c870: 656e 6428 696e 6469 6178 6973 2c20 312f  end(indiaxis, 1/
+0003c880: 2832 202a 2074 6170 6978 2929 0a20 2020  (2 * tapix)).   
+0003c890: 2020 2020 2020 2020 2023 2069 6e64 6961           # india
+0003c8a0: 7869 7320 3d20 6e70 2e6c 696e 7370 6163  xis = np.linspac
+0003c8b0: 6528 302c 2069 6e74 286f 7267 5b30 5d29  e(0, int(org[0])
+0003c8c0: 2c20 696e 7428 6f72 675b 305d 2920 2b20  , int(org[0]) + 
+0003c8d0: 3129 202f 2028 6d61 705f 7368 6170 655b  1) / (map_shape[
+0003c8e0: 305d 202a 2074 6170 6978 290a 2020 2020  0] * tapix).    
+0003c8f0: 2020 2020 2020 2020 7368 656c 6c5f 7261          shell_ra
+0003c900: 6e67 6520 3d20 696e 7428 6d69 6e28 6d61  nge = int(min(ma
+0003c910: 705f 7368 6170 6529 202d 206d 696e 286f  p_shape) - min(o
+0003c920: 7267 2929 0a20 2020 2020 2020 2020 2020  rg)).           
+0003c930: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0003c940: 302c 2073 6865 6c6c 5f72 616e 6765 293a  0, shell_range):
+0003c950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c960: 2069 6e64 6963 6573 203d 2073 656c 662e   indices = self.
+0003c970: 6765 6e65 7261 7465 5f73 6865 6c6c 2869  generate_shell(i
+0003c980: 2c20 6920 2b20 312c 206d 6170 5f73 6861  , i + 1, map_sha
+0003c990: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+0003c9a0: 2020 2020 6f64 6472 696e 6720 3d20 6d61      oddring = ma
+0003c9b0: 706f 6464 5f64 6174 615b 7475 706c 6528  podd_data[tuple(
+0003c9c0: 696e 6469 6365 732e 5429 5d0a 2020 2020  indices.T)].    
+0003c9d0: 2020 2020 2020 2020 2020 2020 6576 656e              even
+0003c9e0: 7269 6e67 203d 206d 6170 6576 656e 5f64  ring = mapeven_d
+0003c9f0: 6174 615b 7475 706c 6528 696e 6469 6365  ata[tuple(indice
+0003ca00: 732e 5429 5d0a 2020 2020 2020 2020 2020  s.T)].          
+0003ca10: 2020 2020 2020 636f 7272 203d 2028 6f64        corr = (od
+0003ca20: 6472 696e 6720 2a20 6e70 2e63 6f6e 6a28  dring * np.conj(
+0003ca30: 6576 656e 7269 6e67 2929 2e73 756d 2829  evenring)).sum()
+0003ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ca50: 2063 6f72 725f 6465 6e6f 203d 206e 702e   corr_deno = np.
+0003ca60: 7371 7274 2828 6e70 2e61 6273 286f 6464  sqrt((np.abs(odd
+0003ca70: 7269 6e67 2920 2a2a 2032 292e 7375 6d28  ring) ** 2).sum(
+0003ca80: 2920 2a20 286e 702e 6162 7328 6576 656e  ) * (np.abs(even
+0003ca90: 7269 6e67 2920 2a2a 2032 292e 7375 6d28  ring) ** 2).sum(
+0003caa0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0003cab0: 2020 2069 6620 636f 7272 5f64 656e 6f20     if corr_deno 
+0003cac0: 3d3d 2030 2e3a 0a20 2020 2020 2020 2020  == 0.:.         
+0003cad0: 2020 2020 2020 2020 2020 206e 6f72 636f             norco
+0003cae0: 7272 203d 2030 2e0a 2020 2020 2020 2020  rr = 0..        
+0003caf0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cb10: 2020 6e6f 7263 6f72 7220 3d20 6e70 2e72    norcorr = np.r
+0003cb20: 6561 6c28 636f 7272 202f 2063 6f72 725f  eal(corr / corr_
+0003cb30: 6465 6e6f 290a 2020 2020 2020 2020 2020  deno).          
+0003cb40: 2020 2020 2020 636f 7272 6c69 7374 2e61        corrlist.a
+0003cb50: 7070 656e 6428 6e6f 7263 6f72 7229 0a0a  ppend(norcorr)..
+0003cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cb70: 766f 6c75 6d65 6469 6666 203d 2028 342e  volumediff = (4.
+0003cb80: 3020 2f20 332e 3029 202a 2070 6920 2a20  0 / 3.0) * pi * 
+0003cb90: 2828 6920 2b20 3129 202a 2a20 3320 2d20  ((i + 1) ** 3 - 
+0003cba0: 6920 2a2a 2033 290a 2020 2020 2020 2020  i ** 3).        
+0003cbb0: 2020 2020 2020 2020 6e76 6f78 7269 6e67          nvoxring
+0003cbc0: 203d 2076 6f6c 756d 6564 6966 6620 2f20   = volumediff / 
+0003cbd0: 2831 202a 2a20 3329 0a20 2020 2020 2020  (1 ** 3).       
+0003cbe0: 2020 2020 2020 2020 2065 6666 6e76 6f78           effnvox
+0003cbf0: 203d 2028 6e76 6f78 7269 6e67 202a 2028   = (nvoxring * (
+0003cc00: 2831 2e35 202a 2030 2e36 3629 202a 2a20  (1.5 * 0.66) ** 
+0003cc10: 3229 2920 2f20 2832 202a 2061 7379 6d29  2)) / (2 * asym)
+0003cc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003cc30: 2069 6620 6566 666e 766f 7820 3c20 312e   if effnvox < 1.
+0003cc40: 303a 2065 6666 6e76 6f78 203d 2031 2e30  0: effnvox = 1.0
+0003cc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003cc60: 2073 7172 6566 666e 766f 7820 3d20 6e70   sqreffnvox = np
+0003cc70: 2e73 7172 7428 6566 666e 766f 7829 0a0a  .sqrt(effnvox)..
+0003cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cc90: 7369 6776 616c 7565 203d 2033 202f 2028  sigvalue = 3 / (
+0003cca0: 7371 7265 6666 6e76 6f78 202b 2033 2e30  sqreffnvox + 3.0
+0003ccb0: 202d 2031 2e30 290a 2020 2020 2020 2020   - 1.0).        
+0003ccc0: 2020 2020 2020 2020 7468 7265 6573 6967          threesig
+0003ccd0: 2e61 7070 656e 6428 7369 6776 616c 7565  .append(sigvalue
+0003cce0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003ccf0: 2020 6269 7476 616c 7565 203d 2028 302e    bitvalue = (0.
+0003cd00: 3230 3731 202b 2031 2e39 3130 3220 2f20  2071 + 1.9102 / 
+0003cd10: 7371 7265 6666 6e76 6f78 2920 2f20 2831  sqreffnvox) / (1
+0003cd20: 2e32 3037 3120 2b20 302e 3931 3032 202f  .2071 + 0.9102 /
+0003cd30: 2073 7172 6566 666e 766f 7829 0a20 2020   sqreffnvox).   
+0003cd40: 2020 2020 2020 2020 2020 2020 2068 616c               hal
+0003cd50: 6662 6974 2e61 7070 656e 6428 6269 7476  fbit.append(bitv
+0003cd60: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
+0003cd70: 2020 2020 2020 6f6e 6562 6974 7661 6c75        onebitvalu
+0003cd80: 6520 3d20 2830 2e35 202b 2032 2e34 3134  e = (0.5 + 2.414
+0003cd90: 3220 2f20 7371 7265 6666 6e76 6f78 2920  2 / sqreffnvox) 
+0003cda0: 2f20 2831 2e35 202b 2031 2e34 3134 3220  / (1.5 + 1.4142 
+0003cdb0: 2f20 7371 7265 6666 6e76 6f78 290a 2020  / sqreffnvox).  
+0003cdc0: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
+0003cdd0: 6562 6974 2e61 7070 656e 6428 6f6e 6562  ebit.append(oneb
+0003cde0: 6974 7661 6c75 6529 0a0a 2020 2020 2020  itvalue)..      
+0003cdf0: 2020 2020 2020 636f 7272 6c69 7374 2e69        corrlist.i
+0003ce00: 6e73 6572 7428 302c 2031 290a 2020 2020  nsert(0, 1).    
+0003ce10: 2020 2020 2020 2020 7468 7265 6573 6967          threesig
+0003ce20: 2e69 6e73 6572 7428 302c 2031 290a 2020  .insert(0, 1).  
+0003ce30: 2020 2020 2020 2020 2020 6861 6c66 6269            halfbi
+0003ce40: 742e 696e 7365 7274 2830 2c20 3129 0a20  t.insert(0, 1). 
+0003ce50: 2020 2020 2020 2020 2020 206f 6e65 6269             onebi
+0003ce60: 742e 696e 7365 7274 2830 2c20 3129 0a20  t.insert(0, 1). 
+0003ce70: 2020 2020 2020 2020 2020 2064 656c 206d             del m
+0003ce80: 6170 6f64 645f 6461 7461 0a20 2020 2020  apodd_data.     
+0003ce90: 2020 2020 2020 2064 656c 206d 6170 6576         del mapev
+0003cea0: 656e 5f64 6174 610a 0a20 2020 2020 2020  en_data..       
+0003ceb0: 2020 2020 2023 2049 6620 616e 7920 6f66       # If any of
+0003cec0: 2074 6865 2066 6972 7374 2035 2076 616c   the first 5 val
+0003ced0: 7565 7320 6973 206e 6567 6174 6976 652c  ues is negative,
+0003cee0: 206d 616b 6520 6974 2074 6f20 310a 2020   make it to 1.  
+0003cef0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+0003cf00: 696e 2072 616e 6765 2830 2c20 3529 3a0a  in range(0, 5):.
+0003cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cf20: 6966 2063 6f72 726c 6973 745b 695d 203c  if corrlist[i] <
+0003cf30: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0003cf40: 2020 2020 2020 2020 2063 6f72 726c 6973           corrlis
+0003cf50: 745b 695d 203d 2031 0a0a 2020 2020 2020  t[i] = 1..      
+0003cf60: 2020 2020 2020 6120 3d20 6e70 2e61 7361        a = np.asa
+0003cf70: 7272 6179 2869 6e64 6961 7869 7329 0a20  rray(indiaxis). 
+0003cf80: 2020 2020 2020 2020 2020 2062 203d 206e             b = n
+0003cf90: 702e 6173 6172 7261 7928 636f 7272 6c69  p.asarray(corrli
+0003cfa0: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
+0003cfb0: 6320 3d20 6e70 2e61 7361 7272 6179 2874  c = np.asarray(t
+0003cfc0: 6872 6565 7369 6729 0a20 2020 2020 2020  hreesig).       
+0003cfd0: 2020 2020 2064 203d 206e 702e 6173 6172       d = np.asar
+0003cfe0: 7261 7928 6861 6c66 6269 7429 0a20 2020  ray(halfbit).   
+0003cff0: 2020 2020 2020 2020 2065 203d 206e 702e           e = np.
+0003d000: 6173 6172 7261 7928 6f6e 6562 6974 290a  asarray(onebit).
+0003d010: 2020 2020 2020 2020 2020 2020 6620 3d20              f = 
+0003d020: 6e70 2e66 756c 6c28 286c 656e 2869 6e64  np.full((len(ind
+0003d030: 6961 7869 7329 292c 2030 2e35 290a 2020  iaxis)), 0.5).  
+0003d040: 2020 2020 2020 2020 2020 6720 3d20 6e70            g = np
+0003d050: 2e66 756c 6c28 286c 656e 2869 6e64 6961  .full((len(india
+0003d060: 7869 7329 292c 2030 2e33 3333 290a 2020  xis)), 0.333).  
+0003d070: 2020 2020 2020 2020 2020 6820 3d20 6e70            h = np
+0003d080: 2e66 756c 6c28 286c 656e 2869 6e64 6961  .full((len(india
+0003d090: 7869 7329 292c 2030 2e31 3433 290a 2020  xis)), 0.143).  
+0003d0a0: 2020 2020 2020 2020 2020 2320 7573 6520            # use 
+0003d0b0: 5b3a 315d 2074 6f20 6967 6e6f 7265 2061  [:1] to ignore a
+0003d0c0: 6c6c 2074 6865 2063 7572 7665 7320 7374  ll the curves st
+0003d0d0: 6172 7420 6672 6f6d 2030 2c31 0a20 2020  art from 0,1.   
+0003d0e0: 2020 2020 2020 2020 2078 7468 7265 6573           xthrees
+0003d0f0: 6967 2c20 7974 6872 6565 7369 6720 3d20  ig, ythreesig = 
+0003d100: 7365 6c66 2e5f 5f69 6e74 6572 706f 6c61  self.__interpola
+0003d110: 7465 645f 696e 7465 7263 6570 7428 612c  ted_intercept(a,
+0003d120: 2062 2c20 6329 0a20 2020 2020 2020 2020   b, c).         
+0003d130: 2020 2078 6861 6c66 6269 742c 2079 6861     xhalfbit, yha
+0003d140: 6c66 6269 7420 3d20 7365 6c66 2e5f 5f69  lfbit = self.__i
 0003d150: 6e74 6572 706f 6c61 7465 645f 696e 7465  nterpolated_inte
-0003d160: 7263 6570 7428 612c 2062 2c20 6629 0a0a  rcept(a, b, f)..
-0003d170: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0003d180: 6563 6b20 6966 206d 6d20 696e 206c 6162  eck if mm in lab
-0003d190: 656c 2074 6865 6e2c 2073 6565 2077 6869  el then, see whi
-0003d1a0: 6368 2069 6e74 6572 7365 6369 6f6e 2069  ch intersecion i
-0003d1b0: 7320 7468 6520 6d6f 7374 2063 6c6f 7365  s the most close
-0003d1c0: 7374 2074 6f20 7468 6520 6769 7665 6e20  st to the given 
-0003d1d0: 7265 736f 6c75 7469 6f6e 2854 6f64 6f29  resolution(Todo)
-0003d1e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003d1f0: 276d 6d27 2069 6e20 6c61 6265 6c3a 0a20  'mm' in label:. 
-0003d200: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003d210: 6620 7868 616c 662e 7369 7a65 2021 3d20  f xhalf.size != 
-0003d220: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0003d230: 2020 2020 2020 206e 6577 7868 616c 6620         newxhalf 
-0003d240: 3d20 6162 7328 7868 616c 6620 2d20 3120  = abs(xhalf - 1 
-0003d250: 2f20 666c 6f61 7428 7365 6c66 2e72 6573  / float(self.res
-0003d260: 6f6c 7574 696f 6e29 290a 2020 2020 2020  olution)).      
-0003d270: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0003d280: 646d 696e 203d 206e 702e 6172 676d 696e  dmin = np.argmin
-0003d290: 286e 6577 7868 616c 6629 0a20 2020 2020  (newxhalf).     
-0003d2a0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0003d2b0: 6861 6c66 203d 206e 702e 6172 7261 7928  half = np.array(
-0003d2c0: 5b78 6861 6c66 5b69 6e64 6d69 6e5d 5d29  [xhalf[indmin]])
-0003d2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d2e0: 2020 2020 2079 6861 6c66 203d 206e 702e       yhalf = np.
-0003d2f0: 6172 7261 7928 5b79 6861 6c66 5b69 6e64  array([yhalf[ind
-0003d300: 6d69 6e5d 5d29 0a0a 2020 2020 2020 2020  min]])..        
-0003d310: 2020 2020 786f 6e65 7468 7265 652c 2079      xonethree, y
-0003d320: 6f6e 6574 6872 6565 203d 2073 656c 662e  onethree = self.
-0003d330: 5f5f 696e 7465 7270 6f6c 6174 6564 5f69  __interpolated_i
-0003d340: 6e74 6572 6365 7074 2861 2c20 622c 2067  ntercept(a, b, g
-0003d350: 290a 2020 2020 2020 2020 2020 2020 7867  ).            xg
-0003d360: 6f6c 642c 2079 676f 6c64 203d 2073 656c  old, ygold = sel
-0003d370: 662e 5f5f 696e 7465 7270 6f6c 6174 6564  f.__interpolated
-0003d380: 5f69 6e74 6572 6365 7074 2861 2c20 622c  _intercept(a, b,
-0003d390: 2068 290a 0a20 2020 2020 2020 2020 2020   h)..           
-0003d3a0: 2023 2041 7373 6967 6e20 696e 7465 7273   # Assign inters
-0003d3b0: 6563 7469 6f6e 2076 616c 7565 2061 7320  ection value as 
-0003d3c0: 4e6f 6e65 2077 6865 6e20 7468 6572 6520  None when there 
-0003d3d0: 6973 206e 6f20 696e 7465 7273 6563 7469  is no intersecti
-0003d3e0: 6f6e 0a20 2020 2020 2020 2020 2020 2069  on.            i
-0003d3f0: 6620 7874 6872 6565 7369 672e 7369 7a65  f xthreesig.size
-0003d400: 203d 3d20 3020 616e 6420 7974 6872 6565   == 0 and ythree
-0003d410: 7369 672e 7369 7a65 203d 3d20 303a 0a20  sig.size == 0:. 
-0003d420: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0003d430: 7269 6e74 2827 4e6f 2069 6e74 6572 7365  rint('No interse
-0003d440: 6374 696f 6e20 6265 7477 6565 6e20 4653  ction between FS
-0003d450: 4320 616e 6420 332d 7369 676d 6120 6375  C and 3-sigma cu
-0003d460: 7276 6573 2e20 4865 7265 2075 7365 2074  rves. Here use t
-0003d470: 6865 206c 6173 7420 706f 696e 742e 2729  he last point.')
-0003d480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d490: 2078 7468 7265 6573 6967 2c20 7974 6872   xthreesig, ythr
-0003d4a0: 6565 7369 6720 3d20 4e6f 6e65 2c20 4e6f  eesig = None, No
-0003d4b0: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-0003d4c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0003d4d0: 2020 2020 2078 7468 7265 6573 6967 203d       xthreesig =
-0003d4e0: 206e 702e 726f 756e 6428 7874 6872 6565   np.round(xthree
-0003d4f0: 7369 675b 305d 5b30 5d2c 2034 290a 2020  sig[0][0], 4).  
-0003d500: 2020 2020 2020 2020 2020 2020 2020 7974                yt
-0003d510: 6872 6565 7369 6720 3d20 6e70 2e72 6f75  hreesig = np.rou
-0003d520: 6e64 2879 7468 7265 6573 6967 5b30 5d5b  nd(ythreesig[0][
-0003d530: 305d 2c20 3429 0a0a 2020 2020 2020 2020  0], 4)..        
-0003d540: 2020 2020 6966 2078 6861 6c66 6269 742e      if xhalfbit.
-0003d550: 7369 7a65 203d 3d20 3020 616e 6420 7968  size == 0 and yh
-0003d560: 616c 6662 6974 2e73 697a 6520 3d3d 2030  alfbit.size == 0
-0003d570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003d580: 2020 7072 696e 7428 274e 6f20 696e 7465    print('No inte
-0003d590: 7273 6563 7469 6f6e 2062 6574 7765 656e  rsection between
-0003d5a0: 2046 5343 2061 6e64 2031 2f32 2d62 6974   FSC and 1/2-bit
-0003d5b0: 2063 7572 7665 732e 2048 6572 6520 7573   curves. Here us
-0003d5c0: 6520 7468 6520 6c61 7374 2070 6f69 6e74  e the last point
-0003d5d0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-0003d5e0: 2020 2020 7868 616c 6662 6974 2c20 7968      xhalfbit, yh
-0003d5f0: 616c 6662 6974 203d 204e 6f6e 652c 204e  alfbit = None, N
-0003d600: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0003d610: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003d620: 2020 2020 2020 7868 616c 6662 6974 203d        xhalfbit =
-0003d630: 206e 702e 726f 756e 6428 7868 616c 6662   np.round(xhalfb
-0003d640: 6974 5b30 5d5b 305d 2c20 3429 0a20 2020  it[0][0], 4).   
-0003d650: 2020 2020 2020 2020 2020 2020 2079 6861               yha
-0003d660: 6c66 6269 7420 3d20 6e70 2e72 6f75 6e64  lfbit = np.round
-0003d670: 2879 6861 6c66 6269 745b 305d 5b30 5d2c  (yhalfbit[0][0],
-0003d680: 2034 290a 0a20 2020 2020 2020 2020 2020   4)..           
-0003d690: 2069 6620 786f 6e65 6269 742e 7369 7a65   if xonebit.size
-0003d6a0: 203d 3d20 3020 616e 6420 796f 6e65 6269   == 0 and yonebi
-0003d6b0: 742e 7369 7a65 203d 3d20 303a 0a20 2020  t.size == 0:.   
-0003d6c0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0003d6d0: 6e74 2827 4e6f 2069 6e74 6572 7365 6374  nt('No intersect
-0003d6e0: 696f 6e20 6265 7477 6565 6e20 4653 4320  ion between FSC 
-0003d6f0: 616e 6420 312d 6269 7420 6375 7276 6573  and 1-bit curves
-0003d700: 2e20 4865 7265 2075 7365 2074 6865 206c  . Here use the l
-0003d710: 6173 7420 706f 696e 742e 2729 0a20 2020  ast point.').   
-0003d720: 2020 2020 2020 2020 2020 2020 2078 6f6e               xon
-0003d730: 6562 6974 2c20 796f 6e65 6269 7420 3d20  ebit, yonebit = 
-0003d740: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
-0003d750: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003d760: 2020 2020 2020 2020 2020 2020 2078 6f6e               xon
-0003d770: 6562 6974 203d 206e 702e 726f 756e 6428  ebit = np.round(
-0003d780: 786f 6e65 6269 745b 305d 5b30 5d2c 2034  xonebit[0][0], 4
-0003d790: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003d7a0: 2020 796f 6e65 6269 7420 3d20 6e70 2e72    yonebit = np.r
-0003d7b0: 6f75 6e64 2879 6f6e 6562 6974 5b30 5d5b  ound(yonebit[0][
-0003d7c0: 305d 2c20 3429 0a0a 2020 2020 2020 2020  0], 4)..        
-0003d7d0: 2020 2020 6966 2078 6f6e 6574 6872 6565      if xonethree
-0003d7e0: 2e73 697a 6520 3d3d 2030 2061 6e64 2079  .size == 0 and y
-0003d7f0: 6f6e 6574 6872 6565 2e73 697a 6520 3d3d  onethree.size ==
-0003d800: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0003d810: 2020 2020 7072 696e 7428 274e 6f20 696e      print('No in
-0003d820: 7465 7273 6563 7469 6f6e 2062 6574 7765  tersection betwe
-0003d830: 656e 2046 5343 2061 6e64 2030 2e33 3333  en FSC and 0.333
-0003d840: 2063 7572 7665 732e 2048 6572 6520 7573   curves. Here us
-0003d850: 6520 7468 6520 6c61 7374 2070 6f69 6e74  e the last point
-0003d860: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0003d870: 2020 2078 6f6e 6574 6872 6565 2c20 796f     xonethree, yo
-0003d880: 6e65 7468 7265 6520 3d20 4e6f 6e65 2c20  nethree = None, 
-0003d890: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0003d8a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0003d8b0: 2020 2020 2020 2078 6f6e 6574 6872 6565         xonethree
-0003d8c0: 203d 206e 702e 726f 756e 6428 786f 6e65   = np.round(xone
-0003d8d0: 7468 7265 655b 305d 5b30 5d2c 2034 290a  three[0][0], 4).
-0003d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d8f0: 796f 6e65 7468 7265 6520 3d20 6e70 2e72  yonethree = np.r
-0003d900: 6f75 6e64 2879 6f6e 6574 6872 6565 5b30  ound(yonethree[0
-0003d910: 5d5b 305d 2c20 3429 0a0a 2020 2020 2020  ][0], 4)..      
-0003d920: 2020 2020 2020 6966 2078 6861 6c66 2e73        if xhalf.s
-0003d930: 697a 6520 3d3d 2030 2061 6e64 2079 6861  ize == 0 and yha
-0003d940: 6c66 2e73 697a 6520 3d3d 2030 3a0a 2020  lf.size == 0:.  
-0003d950: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0003d960: 696e 7428 2721 2121 204e 6f20 696e 7465  int('!!! No inte
-0003d970: 7273 6563 7469 6f6e 2062 6574 7765 656e  rsection between
-0003d980: 2046 5343 2061 6e64 2030 2e35 2063 7572   FSC and 0.5 cur
-0003d990: 7665 732e 2048 6572 6520 7573 6520 7468  ves. Here use th
-0003d9a0: 6520 6c61 7374 2070 6f69 6e74 2729 0a20  e last point'). 
-0003d9b0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0003d9c0: 6861 6c66 2c20 7968 616c 6620 3d20 4e6f  half, yhalf = No
-0003d9d0: 6e65 2c20 4e6f 6e65 0a20 2020 2020 2020  ne, None.       
-0003d9e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003d9f0: 2020 2020 2020 2020 2020 2078 6861 6c66             xhalf
-0003da00: 203d 206e 702e 726f 756e 6428 7868 616c   = np.round(xhal
-0003da10: 665b 305d 5b30 5d2c 2034 290a 2020 2020  f[0][0], 4).    
-0003da20: 2020 2020 2020 2020 2020 2020 7968 616c              yhal
-0003da30: 6620 3d20 6e70 2e72 6f75 6e64 2879 6861  f = np.round(yha
-0003da40: 6c66 5b30 5d5b 305d 2c20 3429 0a20 2020  lf[0][0], 4).   
-0003da50: 2020 2020 2020 2020 2069 6620 7867 6f6c           if xgol
-0003da60: 642e 7369 7a65 203d 3d20 3020 616e 6420  d.size == 0 and 
-0003da70: 7967 6f6c 642e 7369 7a65 203d 3d20 303a  ygold.size == 0:
-0003da80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003da90: 2070 7269 6e74 2827 2121 2120 4e6f 2069   print('!!! No i
-0003daa0: 6e74 6572 7365 6374 696f 6e20 6265 7477  ntersection betw
-0003dab0: 6565 6e20 4653 4320 616e 6420 302e 3134  een FSC and 0.14
-0003dac0: 3320 6375 7276 6573 2e20 4865 7265 2075  3 curves. Here u
-0003dad0: 7365 2074 6865 206c 6173 7420 706f 696e  se the last poin
-0003dae0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-0003daf0: 2020 2020 7867 6f6c 642c 2079 676f 6c64      xgold, ygold
-0003db00: 203d 204e 6f6e 652c 204e 6f6e 650a 2020   = None, None.  
-0003db10: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0003db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003db30: 7867 6f6c 6420 3d20 6e70 2e72 6f75 6e64  xgold = np.round
-0003db40: 2878 676f 6c64 5b30 5d5b 305d 2c20 3429  (xgold[0][0], 4)
-0003db50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003db60: 2079 676f 6c64 203d 206e 702e 726f 756e   ygold = np.roun
-0003db70: 6428 7967 6f6c 645b 305d 5b30 5d2c 2034  d(ygold[0][0], 4
-0003db80: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
-0003db90: 6461 7461 6469 6374 203d 207b 0a20 2020  datadict = {.   
-0003dba0: 2020 2020 2020 2020 2020 2020 2027 6375               'cu
-0003dbb0: 7276 6573 273a 207b 2766 7363 273a 206e  rves': {'fsc': n
-0003dbc0: 702e 726f 756e 6428 6e70 2e72 6561 6c28  p.round(np.real(
-0003dbd0: 636f 7272 6c69 7374 292c 2034 292e 746f  corrlist), 4).to
-0003dbe0: 6c69 7374 2829 2c20 2774 6872 6565 7369  list(), 'threesi
-0003dbf0: 676d 6127 3a20 6e70 2e72 6f75 6e64 2874  gma': np.round(t
-0003dc00: 6872 6565 7369 672c 2034 292e 746f 6c69  hreesig, 4).toli
-0003dc10: 7374 2829 2c0a 2020 2020 2020 2020 2020  st(),.          
-0003dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dc30: 2027 6861 6c66 6269 7427 3a20 6e70 2e72   'halfbit': np.r
-0003dc40: 6f75 6e64 2868 616c 6662 6974 2c20 3429  ound(halfbit, 4)
-0003dc50: 2e74 6f6c 6973 7428 292c 0a20 2020 2020  .tolist(),.     
-0003dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dc70: 2020 2020 2020 276f 6e65 6269 7427 3a20        'onebit': 
-0003dc80: 6e70 2e72 6f75 6e64 286f 6e65 6269 742c  np.round(onebit,
-0003dc90: 2034 292e 746f 6c69 7374 2829 2c20 2730   4).tolist(), '0
-0003dca0: 2e35 273a 2066 2e74 6f6c 6973 7428 292c  .5': f.tolist(),
-0003dcb0: 2027 302e 3333 3327 3a20 672e 746f 6c69   '0.333': g.toli
-0003dcc0: 7374 2829 2c0a 2020 2020 2020 2020 2020  st(),.          
-0003dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dce0: 2027 302e 3134 3327 3a20 682e 746f 6c69   '0.143': h.toli
-0003dcf0: 7374 2829 2c0a 2020 2020 2020 2020 2020  st(),.          
-0003dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dd10: 2027 6c65 7665 6c27 3a20 6e70 2e72 6f75   'level': np.rou
-0003dd20: 6e64 2869 6e64 6961 7869 732c 2034 292e  nd(indiaxis, 4).
-0003dd30: 746f 6c69 7374 2829 7d2c 0a20 2020 2020  tolist()},.     
-0003dd40: 2020 2020 2020 2020 2020 2027 696e 7465             'inte
-0003dd50: 7273 6563 7469 6f6e 7327 3a20 7b27 7468  rsections': {'th
-0003dd60: 7265 6573 6967 273a 207b 2778 273a 2078  reesig': {'x': x
-0003dd70: 7468 7265 6573 6967 2c20 2779 273a 2079  threesig, 'y': y
-0003dd80: 7468 7265 6573 6967 7d2c 0a20 2020 2020  threesig},.     
-0003dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dda0: 2020 2020 2020 2020 2020 2020 2027 6861               'ha
-0003ddb0: 6c66 6269 7427 3a20 7b27 7827 3a20 7868  lfbit': {'x': xh
-0003ddc0: 616c 6662 6974 2c20 2779 273a 2079 6861  alfbit, 'y': yha
-0003ddd0: 6c66 6269 747d 2c0a 2020 2020 2020 2020  lfbit},.        
-0003dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ddf0: 2020 2020 2020 2020 2020 276f 6e65 6269            'onebi
-0003de00: 7427 3a20 7b27 7827 3a20 786f 6e65 6269  t': {'x': xonebi
-0003de10: 742c 2027 7927 3a20 796f 6e65 6269 747d  t, 'y': yonebit}
-0003de20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0003de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003de40: 2020 2020 2730 2e35 273a 207b 2778 273a      '0.5': {'x':
-0003de50: 2078 6861 6c66 2c20 2779 273a 2079 6861   xhalf, 'y': yha
-0003de60: 6c66 7d2c 0a20 2020 2020 2020 2020 2020  lf},.           
+0003d160: 7263 6570 7428 612c 2062 2c20 6429 0a20  rcept(a, b, d). 
+0003d170: 2020 2020 2020 2020 2020 2078 6f6e 6562             xoneb
+0003d180: 6974 2c20 796f 6e65 6269 7420 3d20 7365  it, yonebit = se
+0003d190: 6c66 2e5f 5f69 6e74 6572 706f 6c61 7465  lf.__interpolate
+0003d1a0: 645f 696e 7465 7263 6570 7428 612c 2062  d_intercept(a, b
+0003d1b0: 2c20 6529 0a20 2020 2020 2020 2020 2020  , e).           
+0003d1c0: 2078 6861 6c66 2c20 7968 616c 6620 3d20   xhalf, yhalf = 
+0003d1d0: 7365 6c66 2e5f 5f69 6e74 6572 706f 6c61  self.__interpola
+0003d1e0: 7465 645f 696e 7465 7263 6570 7428 612c  ted_intercept(a,
+0003d1f0: 2062 2c20 6629 0a0a 2020 2020 2020 2020   b, f)..        
+0003d200: 2020 2020 2320 4368 6563 6b20 6966 206d      # Check if m
+0003d210: 6d20 696e 206c 6162 656c 2074 6865 6e2c  m in label then,
+0003d220: 2073 6565 2077 6869 6368 2069 6e74 6572   see which inter
+0003d230: 7365 6369 6f6e 2069 7320 7468 6520 6d6f  secion is the mo
+0003d240: 7374 2063 6c6f 7365 7374 2074 6f20 7468  st closest to th
+0003d250: 6520 6769 7665 6e20 7265 736f 6c75 7469  e given resoluti
+0003d260: 6f6e 2854 6f64 6f29 0a20 2020 2020 2020  on(Todo).       
+0003d270: 2020 2020 2069 6620 276d 6d27 2069 6e20       if 'mm' in 
+0003d280: 6c61 6265 6c3a 0a20 2020 2020 2020 2020  label:.         
+0003d290: 2020 2020 2020 2069 6620 7868 616c 662e         if xhalf.
+0003d2a0: 7369 7a65 2021 3d20 303a 0a20 2020 2020  size != 0:.     
+0003d2b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0003d2c0: 6577 7868 616c 6620 3d20 6162 7328 7868  ewxhalf = abs(xh
+0003d2d0: 616c 6620 2d20 3120 2f20 666c 6f61 7428  alf - 1 / float(
+0003d2e0: 7365 6c66 2e72 6573 6f6c 7574 696f 6e29  self.resolution)
+0003d2f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0003d300: 2020 2020 2020 696e 646d 696e 203d 206e        indmin = n
+0003d310: 702e 6172 676d 696e 286e 6577 7868 616c  p.argmin(newxhal
+0003d320: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
+0003d330: 2020 2020 2020 2078 6861 6c66 203d 206e         xhalf = n
+0003d340: 702e 6172 7261 7928 5b78 6861 6c66 5b69  p.array([xhalf[i
+0003d350: 6e64 6d69 6e5d 5d29 0a20 2020 2020 2020  ndmin]]).       
+0003d360: 2020 2020 2020 2020 2020 2020 2079 6861               yha
+0003d370: 6c66 203d 206e 702e 6172 7261 7928 5b79  lf = np.array([y
+0003d380: 6861 6c66 5b69 6e64 6d69 6e5d 5d29 0a0a  half[indmin]])..
+0003d390: 2020 2020 2020 2020 2020 2020 786f 6e65              xone
+0003d3a0: 7468 7265 652c 2079 6f6e 6574 6872 6565  three, yonethree
+0003d3b0: 203d 2073 656c 662e 5f5f 696e 7465 7270   = self.__interp
+0003d3c0: 6f6c 6174 6564 5f69 6e74 6572 6365 7074  olated_intercept
+0003d3d0: 2861 2c20 622c 2067 290a 2020 2020 2020  (a, b, g).      
+0003d3e0: 2020 2020 2020 7867 6f6c 642c 2079 676f        xgold, ygo
+0003d3f0: 6c64 203d 2073 656c 662e 5f5f 696e 7465  ld = self.__inte
+0003d400: 7270 6f6c 6174 6564 5f69 6e74 6572 6365  rpolated_interce
+0003d410: 7074 2861 2c20 622c 2068 290a 0a20 2020  pt(a, b, h)..   
+0003d420: 2020 2020 2020 2020 2023 2041 7373 6967           # Assig
+0003d430: 6e20 696e 7465 7273 6563 7469 6f6e 2076  n intersection v
+0003d440: 616c 7565 2061 7320 4e6f 6e65 2077 6865  alue as None whe
+0003d450: 6e20 7468 6572 6520 6973 206e 6f20 696e  n there is no in
+0003d460: 7465 7273 6563 7469 6f6e 0a20 2020 2020  tersection.     
+0003d470: 2020 2020 2020 2069 6620 7874 6872 6565         if xthree
+0003d480: 7369 672e 7369 7a65 203d 3d20 3020 616e  sig.size == 0 an
+0003d490: 6420 7974 6872 6565 7369 672e 7369 7a65  d ythreesig.size
+0003d4a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0003d4b0: 2020 2020 2020 2070 7269 6e74 2827 4e6f         print('No
+0003d4c0: 2069 6e74 6572 7365 6374 696f 6e20 6265   intersection be
+0003d4d0: 7477 6565 6e20 4653 4320 616e 6420 332d  tween FSC and 3-
+0003d4e0: 7369 676d 6120 6375 7276 6573 2e20 4865  sigma curves. He
+0003d4f0: 7265 2075 7365 2074 6865 206c 6173 7420  re use the last 
+0003d500: 706f 696e 742e 2729 0a20 2020 2020 2020  point.').       
+0003d510: 2020 2020 2020 2020 2078 7468 7265 6573           xthrees
+0003d520: 6967 2c20 7974 6872 6565 7369 6720 3d20  ig, ythreesig = 
+0003d530: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+0003d540: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003d550: 2020 2020 2020 2020 2020 2020 2078 7468               xth
+0003d560: 7265 6573 6967 203d 206e 702e 726f 756e  reesig = np.roun
+0003d570: 6428 7874 6872 6565 7369 675b 305d 5b30  d(xthreesig[0][0
+0003d580: 5d2c 2034 290a 2020 2020 2020 2020 2020  ], 4).          
+0003d590: 2020 2020 2020 7974 6872 6565 7369 6720        ythreesig 
+0003d5a0: 3d20 6e70 2e72 6f75 6e64 2879 7468 7265  = np.round(ythre
+0003d5b0: 6573 6967 5b30 5d5b 305d 2c20 3429 0a0a  esig[0][0], 4)..
+0003d5c0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+0003d5d0: 6861 6c66 6269 742e 7369 7a65 203d 3d20  halfbit.size == 
+0003d5e0: 3020 616e 6420 7968 616c 6662 6974 2e73  0 and yhalfbit.s
+0003d5f0: 697a 6520 3d3d 2030 3a0a 2020 2020 2020  ize == 0:.      
+0003d600: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0003d610: 274e 6f20 696e 7465 7273 6563 7469 6f6e  'No intersection
+0003d620: 2062 6574 7765 656e 2046 5343 2061 6e64   between FSC and
+0003d630: 2031 2f32 2d62 6974 2063 7572 7665 732e   1/2-bit curves.
+0003d640: 2048 6572 6520 7573 6520 7468 6520 6c61   Here use the la
+0003d650: 7374 2070 6f69 6e74 2e27 290a 2020 2020  st point.').    
+0003d660: 2020 2020 2020 2020 2020 2020 7868 616c              xhal
+0003d670: 6662 6974 2c20 7968 616c 6662 6974 203d  fbit, yhalfbit =
+0003d680: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
+0003d690: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003d6a0: 2020 2020 2020 2020 2020 2020 2020 7868                xh
+0003d6b0: 616c 6662 6974 203d 206e 702e 726f 756e  alfbit = np.roun
+0003d6c0: 6428 7868 616c 6662 6974 5b30 5d5b 305d  d(xhalfbit[0][0]
+0003d6d0: 2c20 3429 0a20 2020 2020 2020 2020 2020  , 4).           
+0003d6e0: 2020 2020 2079 6861 6c66 6269 7420 3d20       yhalfbit = 
+0003d6f0: 6e70 2e72 6f75 6e64 2879 6861 6c66 6269  np.round(yhalfbi
+0003d700: 745b 305d 5b30 5d2c 2034 290a 0a20 2020  t[0][0], 4)..   
+0003d710: 2020 2020 2020 2020 2069 6620 786f 6e65           if xone
+0003d720: 6269 742e 7369 7a65 203d 3d20 3020 616e  bit.size == 0 an
+0003d730: 6420 796f 6e65 6269 742e 7369 7a65 203d  d yonebit.size =
+0003d740: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0003d750: 2020 2020 2070 7269 6e74 2827 4e6f 2069       print('No i
+0003d760: 6e74 6572 7365 6374 696f 6e20 6265 7477  ntersection betw
+0003d770: 6565 6e20 4653 4320 616e 6420 312d 6269  een FSC and 1-bi
+0003d780: 7420 6375 7276 6573 2e20 4865 7265 2075  t curves. Here u
+0003d790: 7365 2074 6865 206c 6173 7420 706f 696e  se the last poin
+0003d7a0: 742e 2729 0a20 2020 2020 2020 2020 2020  t.').           
+0003d7b0: 2020 2020 2078 6f6e 6562 6974 2c20 796f       xonebit, yo
+0003d7c0: 6e65 6269 7420 3d20 4e6f 6e65 2c20 4e6f  nebit = None, No
+0003d7d0: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
+0003d7e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0003d7f0: 2020 2020 2078 6f6e 6562 6974 203d 206e       xonebit = n
+0003d800: 702e 726f 756e 6428 786f 6e65 6269 745b  p.round(xonebit[
+0003d810: 305d 5b30 5d2c 2034 290a 2020 2020 2020  0][0], 4).      
+0003d820: 2020 2020 2020 2020 2020 796f 6e65 6269            yonebi
+0003d830: 7420 3d20 6e70 2e72 6f75 6e64 2879 6f6e  t = np.round(yon
+0003d840: 6562 6974 5b30 5d5b 305d 2c20 3429 0a0a  ebit[0][0], 4)..
+0003d850: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+0003d860: 6f6e 6574 6872 6565 2e73 697a 6520 3d3d  onethree.size ==
+0003d870: 2030 2061 6e64 2079 6f6e 6574 6872 6565   0 and yonethree
+0003d880: 2e73 697a 6520 3d3d 2030 3a0a 2020 2020  .size == 0:.    
+0003d890: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0003d8a0: 7428 274e 6f20 696e 7465 7273 6563 7469  t('No intersecti
+0003d8b0: 6f6e 2062 6574 7765 656e 2046 5343 2061  on between FSC a
+0003d8c0: 6e64 2030 2e33 3333 2063 7572 7665 732e  nd 0.333 curves.
+0003d8d0: 2048 6572 6520 7573 6520 7468 6520 6c61   Here use the la
+0003d8e0: 7374 2070 6f69 6e74 2729 0a20 2020 2020  st point').     
+0003d8f0: 2020 2020 2020 2020 2020 2078 6f6e 6574             xonet
+0003d900: 6872 6565 2c20 796f 6e65 7468 7265 6520  hree, yonethree 
+0003d910: 3d20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  = None, None.   
+0003d920: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0003d930: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+0003d940: 6f6e 6574 6872 6565 203d 206e 702e 726f  onethree = np.ro
+0003d950: 756e 6428 786f 6e65 7468 7265 655b 305d  und(xonethree[0]
+0003d960: 5b30 5d2c 2034 290a 2020 2020 2020 2020  [0], 4).        
+0003d970: 2020 2020 2020 2020 796f 6e65 7468 7265          yonethre
+0003d980: 6520 3d20 6e70 2e72 6f75 6e64 2879 6f6e  e = np.round(yon
+0003d990: 6574 6872 6565 5b30 5d5b 305d 2c20 3429  ethree[0][0], 4)
+0003d9a0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0003d9b0: 2078 6861 6c66 2e73 697a 6520 3d3d 2030   xhalf.size == 0
+0003d9c0: 2061 6e64 2079 6861 6c66 2e73 697a 6520   and yhalf.size 
+0003d9d0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0003d9e0: 2020 2020 2020 7072 696e 7428 2721 2121        print('!!!
+0003d9f0: 204e 6f20 696e 7465 7273 6563 7469 6f6e   No intersection
+0003da00: 2062 6574 7765 656e 2046 5343 2061 6e64   between FSC and
+0003da10: 2030 2e35 2063 7572 7665 732e 2048 6572   0.5 curves. Her
+0003da20: 6520 7573 6520 7468 6520 6c61 7374 2070  e use the last p
+0003da30: 6f69 6e74 2729 0a20 2020 2020 2020 2020  oint').         
+0003da40: 2020 2020 2020 2078 6861 6c66 2c20 7968         xhalf, yh
+0003da50: 616c 6620 3d20 4e6f 6e65 2c20 4e6f 6e65  alf = None, None
+0003da60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0003da70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003da80: 2020 2078 6861 6c66 203d 206e 702e 726f     xhalf = np.ro
+0003da90: 756e 6428 7868 616c 665b 305d 5b30 5d2c  und(xhalf[0][0],
+0003daa0: 2034 290a 2020 2020 2020 2020 2020 2020   4).            
+0003dab0: 2020 2020 7968 616c 6620 3d20 6e70 2e72      yhalf = np.r
+0003dac0: 6f75 6e64 2879 6861 6c66 5b30 5d5b 305d  ound(yhalf[0][0]
+0003dad0: 2c20 3429 0a20 2020 2020 2020 2020 2020  , 4).           
+0003dae0: 2069 6620 7867 6f6c 642e 7369 7a65 203d   if xgold.size =
+0003daf0: 3d20 3020 616e 6420 7967 6f6c 642e 7369  = 0 and ygold.si
+0003db00: 7a65 203d 3d20 303a 0a20 2020 2020 2020  ze == 0:.       
+0003db10: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0003db20: 2121 2120 4e6f 2069 6e74 6572 7365 6374  !!! No intersect
+0003db30: 696f 6e20 6265 7477 6565 6e20 4653 4320  ion between FSC 
+0003db40: 616e 6420 302e 3134 3320 6375 7276 6573  and 0.143 curves
+0003db50: 2e20 4865 7265 2075 7365 2074 6865 206c  . Here use the l
+0003db60: 6173 7420 706f 696e 7427 290a 2020 2020  ast point').    
+0003db70: 2020 2020 2020 2020 2020 2020 7867 6f6c              xgol
+0003db80: 642c 2079 676f 6c64 203d 204e 6f6e 652c  d, ygold = None,
+0003db90: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0003dba0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003dbb0: 2020 2020 2020 2020 7867 6f6c 6420 3d20          xgold = 
+0003dbc0: 6e70 2e72 6f75 6e64 2878 676f 6c64 5b30  np.round(xgold[0
+0003dbd0: 5d5b 305d 2c20 3429 0a20 2020 2020 2020  ][0], 4).       
+0003dbe0: 2020 2020 2020 2020 2079 676f 6c64 203d           ygold =
+0003dbf0: 206e 702e 726f 756e 6428 7967 6f6c 645b   np.round(ygold[
+0003dc00: 305d 5b30 5d2c 2034 290a 0a0a 2020 2020  0][0], 4)...    
+0003dc10: 2020 2020 2020 2020 6461 7461 6469 6374          datadict
+0003dc20: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0003dc30: 2020 2020 2027 6375 7276 6573 273a 207b       'curves': {
+0003dc40: 2766 7363 273a 206e 702e 726f 756e 6428  'fsc': np.round(
+0003dc50: 6e70 2e72 6561 6c28 636f 7272 6c69 7374  np.real(corrlist
+0003dc60: 292c 2034 292e 746f 6c69 7374 2829 2c20  ), 4).tolist(), 
+0003dc70: 2774 6872 6565 7369 676d 6127 3a20 6e70  'threesigma': np
+0003dc80: 2e72 6f75 6e64 2874 6872 6565 7369 672c  .round(threesig,
+0003dc90: 2034 292e 746f 6c69 7374 2829 2c0a 2020   4).tolist(),.  
+0003dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dcb0: 2020 2020 2020 2020 2027 6861 6c66 6269           'halfbi
+0003dcc0: 7427 3a20 6e70 2e72 6f75 6e64 2868 616c  t': np.round(hal
+0003dcd0: 6662 6974 2c20 3429 2e74 6f6c 6973 7428  fbit, 4).tolist(
+0003dce0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0003dcf0: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+0003dd00: 6e65 6269 7427 3a20 6e70 2e72 6f75 6e64  nebit': np.round
+0003dd10: 286f 6e65 6269 742c 2034 292e 746f 6c69  (onebit, 4).toli
+0003dd20: 7374 2829 2c20 2730 2e35 273a 2066 2e74  st(), '0.5': f.t
+0003dd30: 6f6c 6973 7428 292c 2027 302e 3333 3327  olist(), '0.333'
+0003dd40: 3a20 672e 746f 6c69 7374 2829 2c0a 2020  : g.tolist(),.  
+0003dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dd60: 2020 2020 2020 2020 2027 302e 3134 3327           '0.143'
+0003dd70: 3a20 682e 746f 6c69 7374 2829 2c0a 2020  : h.tolist(),.  
+0003dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dd90: 2020 2020 2020 2020 2027 6c65 7665 6c27           'level'
+0003dda0: 3a20 6e70 2e72 6f75 6e64 2869 6e64 6961  : np.round(india
+0003ddb0: 7869 732c 2034 292e 746f 6c69 7374 2829  xis, 4).tolist()
+0003ddc0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+0003ddd0: 2020 2027 696e 7465 7273 6563 7469 6f6e     'intersection
+0003dde0: 7327 3a20 7b27 7468 7265 6573 6967 273a  s': {'threesig':
+0003ddf0: 207b 2778 273a 2078 7468 7265 6573 6967   {'x': xthreesig
+0003de00: 2c20 2779 273a 2079 7468 7265 6573 6967  , 'y': ythreesig
+0003de10: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+0003de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003de30: 2020 2020 2027 6861 6c66 6269 7427 3a20       'halfbit': 
+0003de40: 7b27 7827 3a20 7868 616c 6662 6974 2c20  {'x': xhalfbit, 
+0003de50: 2779 273a 2079 6861 6c66 6269 747d 2c0a  'y': yhalfbit},.
+0003de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003de80: 2020 2020 2020 2027 302e 3333 3327 3a20         '0.333': 
-0003de90: 7b27 7827 3a20 786f 6e65 7468 7265 652c  {'x': xonethree,
-0003dea0: 2027 7927 3a20 796f 6e65 7468 7265 657d   'y': yonethree}
-0003deb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0003dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ded0: 2020 2020 2730 2e31 3433 273a 207b 2778      '0.143': {'x
-0003dee0: 273a 2078 676f 6c64 2c20 2779 273a 2079  ': xgold, 'y': y
-0003def0: 676f 6c64 7d7d 7d0a 2020 2020 2020 2020  gold}}}.        
-0003df00: 2020 2020 6669 6e61 6c64 6963 7420 3d20      finaldict = 
-0003df10: 6469 6374 2829 0a20 2020 2020 2020 2020  dict().         
-0003df20: 2020 2066 696e 616c 6469 6374 5b6c 6162     finaldict[lab
-0003df30: 656c 202b 2027 6673 6327 5d20 3d20 6461  el + 'fsc'] = da
-0003df40: 7461 6469 6374 0a0a 2020 2020 2020 2020  tadict..        
-0003df50: 2020 2020 706c 742e 706c 6f74 2869 6e64      plt.plot(ind
-0003df60: 6961 7869 732c 2063 6f72 726c 6973 742c  iaxis, corrlist,
-0003df70: 206c 6162 656c 3d6c 6162 656c 202b 2027   label=label + '
-0003df80: 4653 4327 290a 2020 2020 2020 2020 2020  FSC').          
-0003df90: 2020 2320 706c 742e 706c 6f74 2869 6e64    # plt.plot(ind
-0003dfa0: 6961 7869 732c 2074 6872 6565 7369 672c  iaxis, threesig,
-0003dfb0: 206c 6162 656c 3d27 3320 7369 676d 6127   label='3 sigma'
-0003dfc0: 290a 2020 2020 2020 2020 2020 2020 706c  ).            pl
-0003dfd0: 742e 706c 6f74 2869 6e64 6961 7869 732c  t.plot(indiaxis,
-0003dfe0: 2068 616c 6662 6974 2c20 6c61 6265 6c3d   halfbit, label=
-0003dff0: 2731 2f32 2062 6974 2729 0a20 2020 2020  '1/2 bit').     
-0003e000: 2020 2020 2020 2023 2070 6c74 2e70 6c6f         # plt.plo
-0003e010: 7428 696e 6469 6178 6973 2c20 6f6e 6562  t(indiaxis, oneb
-0003e020: 6974 2c20 6c61 6265 6c3d 2731 2062 6974  it, label='1 bit
-0003e030: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
-0003e040: 6c74 2e70 6c6f 7428 696e 6469 6178 6973  lt.plot(indiaxis
-0003e050: 2c20 662c 206c 6162 656c 3d27 302e 3527  , f, label='0.5'
-0003e060: 2c20 6c69 6e65 7374 796c 653d 273a 2729  , linestyle=':')
-0003e070: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-0003e080: 6c74 2e70 6c6f 7428 696e 6469 6178 6973  lt.plot(indiaxis
-0003e090: 2c20 672c 206c 6162 656c 3d27 302e 3333  , g, label='0.33
-0003e0a0: 3327 2c20 6c69 6e65 7374 796c 653d 272d  3', linestyle='-
-0003e0b0: 2d27 290a 2020 2020 2020 2020 2020 2020  -').            
-0003e0c0: 706c 742e 706c 6f74 2869 6e64 6961 7869  plt.plot(indiaxi
-0003e0d0: 732c 2068 2c20 6c61 6265 6c3d 2730 2e31  s, h, label='0.1
-0003e0e0: 3433 272c 206c 696e 6573 7479 6c65 3d27  43', linestyle='
-0003e0f0: 2d2e 2729 0a20 2020 2020 2020 2020 2020  -.').           
-0003e100: 2069 6620 7365 6c66 2e72 6573 6f6c 7574   if self.resolut
-0003e110: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-0003e120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e130: 2070 6c74 2e70 6c6f 7428 5b31 2f66 6c6f   plt.plot([1/flo
-0003e140: 6174 2873 656c 662e 7265 736f 6c75 7469  at(self.resoluti
-0003e150: 6f6e 295d 202a 2031 3030 2c20 6e70 2e6c  on)] * 100, np.l
-0003e160: 696e 7370 6163 6528 302c 2031 2c20 3130  inspace(0, 1, 10
-0003e170: 3029 2c20 636f 6c6f 723d 2772 6564 2729  0), color='red')
-0003e180: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
-0003e190: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
-0003e1a0: 2020 2020 2020 6966 206c 6162 656c 3a0a        if label:.
-0003e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e1c0: 706c 742e 7361 7665 6669 6728 7365 6c66  plt.savefig(self
-0003e1d0: 2e77 6f72 6b64 6972 202b 2073 656c 662e  .workdir + self.
-0003e1e0: 6d61 706e 616d 6520 2b20 275f 2720 2b20  mapname + '_' + 
-0003e1f0: 6c61 6265 6c20 2b20 275f 6673 632e 706e  label + '_fsc.pn
-0003e200: 6727 290a 2020 2020 2020 2020 2020 2020  g').            
-0003e210: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003e220: 2020 2020 2020 706c 742e 7361 7665 6669        plt.savefi
-0003e230: 6728 7365 6c66 2e77 6f72 6b64 6972 202b  g(self.workdir +
-0003e240: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
-0003e250: 275f 6673 632e 706e 6727 290a 0a20 2020  '_fsc.png')..   
-0003e260: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-0003e270: 2020 2020 2020 2020 2065 7272 203d 2027           err = '
-0003e280: 4653 4320 6361 6c63 756c 6174 696f 6e20  FSC calculation 
-0003e290: 6572 726f 723a 207b 7d27 2e66 6f72 6d61  error: {}'.forma
-0003e2a0: 7428 7379 732e 6578 635f 696e 666f 2829  t(sys.exc_info()
-0003e2b0: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-0003e2c0: 2065 7272 6c69 7374 2e61 7070 656e 6428   errlist.append(
-0003e2d0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
-0003e2e0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-0003e2f0: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
-0003e300: 2020 2020 2020 2069 6620 6572 726c 6973         if errlis
-0003e310: 743a 0a20 2020 2020 2020 2020 2020 2064  t:.            d
-0003e320: 6174 6164 6963 7420 3d20 7b27 6572 7227  atadict = {'err'
-0003e330: 3a20 7b6c 6162 656c 202b 2027 6673 635f  : {label + 'fsc_
-0003e340: 6572 726f 7227 3a20 6572 726c 6973 747d  error': errlist}
-0003e350: 7d0a 2020 2020 2020 2020 2020 2020 6669  }.            fi
-0003e360: 6e61 6c64 6963 745b 6c61 6265 6c20 2b20  naldict[label + 
-0003e370: 2766 7363 275d 203d 2064 6174 6164 6963  'fsc'] = datadic
-0003e380: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
-0003e390: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0003e3a0: 7428 274e 6f20 6572 726f 7220 696e 2046  t('No error in F
-0003e3b0: 5343 2063 616c 6375 6c61 7469 6f6e 2e27  SC calculation.'
-0003e3c0: 290a 0a20 2020 2020 2020 2069 6620 626f  )..        if bo
-0003e3d0: 6f6c 2864 6174 6164 6963 7429 2061 6e64  ol(datadict) and
-0003e3e0: 2062 6f6f 6c28 6669 6e61 6c64 6963 7429   bool(finaldict)
-0003e3f0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-0003e400: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0003e410: 2020 2077 6974 6820 636f 6465 6373 2e6f     with codecs.o
-0003e420: 7065 6e28 7365 6c66 2e77 6f72 6b64 6972  pen(self.workdir
-0003e430: 202b 2073 656c 662e 6d61 706e 616d 6520   + self.mapname 
-0003e440: 2b20 275f 2720 2b20 6c61 6265 6c20 2b20  + '_' + label + 
-0003e450: 2766 7363 2e6a 736f 6e27 2c20 2777 272c  'fsc.json', 'w',
-0003e460: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
-0003e470: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
-0003e480: 2020 2020 2020 2020 2020 2020 206a 736f               jso
-0003e490: 6e2e 6475 6d70 2866 696e 616c 6469 6374  n.dump(finaldict
-0003e4a0: 2c20 6629 0a20 2020 2020 2020 2020 2020  , f).           
-0003e4b0: 2020 2020 2070 7269 6e74 2827 4653 4320       print('FSC 
-0003e4c0: 7072 6f64 7563 6564 2062 7920 7477 6f20  produced by two 
-0003e4d0: 6861 6c66 206d 6170 732e 2729 0a20 2020  half maps.').   
-0003e4e0: 2020 2020 2020 2020 2020 2020 2023 2077               # w
-0003e4f0: 6974 6820 636f 6465 6373 2e6f 7065 6e28  ith codecs.open(
-0003e500: 7365 6c66 2e77 6f72 6b64 6972 202b 206f  self.workdir + o
-0003e510: 6464 6e61 6d65 202b 2027 5f27 202b 2065  ddname + '_' + e
-0003e520: 7665 6e6e 616d 6520 2b20 275f 2720 2b20  venname + '_' + 
-0003e530: 6c61 6265 6c20 2b20 2766 7363 2e6a 736f  label + 'fsc.jso
-0003e540: 6e27 2c20 2777 272c 2065 6e63 6f64 696e  n', 'w', encodin
-0003e550: 673d 2775 7466 2d38 2729 2061 7320 6e66  g='utf-8') as nf
-0003e560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003e570: 2020 2320 2020 2020 6a73 6f6e 2e64 756d    #     json.dum
-0003e580: 7028 6669 6e61 6c64 6963 742c 206e 6629  p(finaldict, nf)
-0003e590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e5a0: 2023 2070 7269 6e74 2827 326e 6420 6673   # print('2nd fs
-0003e5b0: 6320 7361 7665 6427 290a 2020 2020 2020  c saved').      
-0003e5c0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-0003e5d0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0003e5e0: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-0003e5f0: 5772 6974 696e 6720 4653 4320 6461 7461  Writing FSC data
-0003e600: 2074 6f20 6a73 6f6e 2066 696c 6520 6572   to json file er
-0003e610: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
-0003e620: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-0003e630: 315d 2929 0a20 2020 2020 2020 2065 6c73  1])).        els
-0003e640: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0003e650: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-0003e660: 2746 5343 2063 616c 6375 6c61 7469 6f6e  'FSC calculation
-0003e670: 2067 6574 206e 6f6e 6520 2729 0a0a 2020   get none ')..  
-0003e680: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0003e690: 650a 0a20 2020 2040 7374 6174 6963 6d65  e..    @staticme
-0003e6a0: 7468 6f64 0a20 2020 2064 6566 206d 656d  thod.    def mem
-0003e6b0: 7072 6564 2872 6573 756c 7466 696c 652c  pred(resultfile,
-0003e6c0: 2069 6e70 7574 6669 6c65 7369 7a65 293a   inputfilesize):
-0003e6d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0003e6e0: 2020 2020 2020 2020 2020 5072 6f64 7563            Produc
-0003e6f0: 6520 6d65 6d6f 7279 2070 7265 6469 6374  e memory predict
-0003e700: 696f 6e20 7265 7375 6c74 7320 7573 696e  ion results usin
-0003e710: 6720 6c69 6e65 6172 2072 6567 7265 7373  g linear regress
-0003e720: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-0003e730: 6261 7365 6420 6f6e 2074 6865 2064 6174  based on the dat
-0003e740: 6120 6672 6f6d 2070 7265 7669 6f75 7320  a from previous 
-0003e750: 656e 7472 6965 732e 0a0a 0a20 2020 2020  entries....     
-0003e760: 2020 203a 7061 7261 6d20 7265 7375 6c74     :param result
-0003e770: 6669 6c65 3a20 5072 6576 696f 7573 206d  file: Previous m
-0003e780: 656d 6f72 7920 7573 6167 6520 696e 666f  emory usage info
-0003e790: 726d 6174 696f 6e20 696e 2043 5356 2066  rmation in CSV f
-0003e7a0: 696c 650a 2020 2020 2020 2020 3a70 6172  ile.        :par
-0003e7b0: 616d 2069 6e70 7574 6669 6c65 7369 7a65  am inputfilesize
-0003e7c0: 3a20 5468 6520 696e 7075 7420 6465 6e73  : The input dens
-0003e7d0: 6974 7920 6d61 7020 7369 7a65 0a20 2020  ity map size.   
-0003e7e0: 2020 2020 203a 7265 7475 726e 3a20 3020       :return: 0 
-0003e7f0: 6f72 2079 5f70 7265 6420 2874 6865 2070  or y_pred (the p
-0003e800: 7265 6469 6374 6564 206d 656d 6f72 7920  redicted memory 
-0003e810: 7573 6167 6529 0a20 2020 2020 2020 2022  usage).        "
-0003e820: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-0003e830: 736b 6c65 6172 6e2e 6c69 6e65 6172 5f6d  sklearn.linear_m
-0003e840: 6f64 656c 2069 6d70 6f72 7420 4c69 6e65  odel import Line
-0003e850: 6172 5265 6772 6573 7369 6f6e 0a20 2020  arRegression.   
-0003e860: 2020 2020 2066 726f 6d20 736b 6c65 6172       from sklear
-0003e870: 6e2e 6d65 7472 6963 7320 696d 706f 7274  n.metrics import
-0003e880: 206d 6561 6e5f 7371 7561 7265 645f 6572   mean_squared_er
-0003e890: 726f 722c 2072 325f 7363 6f72 650a 2020  ror, r2_score.  
-0003e8a0: 2020 2020 2020 6672 6f6d 2073 6b6c 6561        from sklea
-0003e8b0: 726e 2e6d 6f64 656c 5f73 656c 6563 7469  rn.model_selecti
-0003e8c0: 6f6e 2069 6d70 6f72 7420 7472 6169 6e5f  on import train_
-0003e8d0: 7465 7374 5f73 706c 6974 0a20 2020 2020  test_split.     
-0003e8e0: 2020 2066 726f 6d20 736b 6c65 6172 6e2e     from sklearn.
-0003e8f0: 6d6f 6465 6c5f 7365 6c65 6374 696f 6e20  model_selection 
-0003e900: 696d 706f 7274 2063 726f 7373 5f76 616c  import cross_val
-0003e910: 5f73 636f 7265 2c20 6372 6f73 735f 7661  _score, cross_va
-0003e920: 6c5f 7072 6564 6963 740a 0a20 2020 2020  l_predict..     
-0003e930: 2020 2064 6174 6120 3d20 7064 2e72 6561     data = pd.rea
-0003e940: 645f 6373 7628 7265 7375 6c74 6669 6c65  d_csv(resultfile
-0003e950: 2c20 6865 6164 6572 3d30 290a 2020 2020  , header=0).    
-0003e960: 2020 2020 6461 7461 203d 2064 6174 612e      data = data.
-0003e970: 6472 6f70 6e61 2829 0a20 2020 2020 2020  dropna().       
-0003e980: 2069 6620 6461 7461 2e65 6d70 7479 3a0a   if data.empty:.
-0003e990: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0003e9a0: 7428 274e 6f20 7573 6566 756c 2064 6174  t('No useful dat
-0003e9b0: 6120 696e 2074 6865 2064 6174 6166 7261  a in the datafra
-0003e9c0: 6d65 2e27 290a 2020 2020 2020 2020 2020  me.').          
-0003e9d0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-0003e9e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0003e9f0: 2020 2020 2020 2020 6e65 7764 6174 6120          newdata 
-0003ea00: 3d20 6461 7461 2e69 6c6f 635b 3a2c 2031  = data.iloc[:, 1
-0003ea10: 3a5d 0a20 2020 2020 2020 2020 2020 2073  :].            s
-0003ea20: 6f72 7464 6174 6120 3d20 6e65 7764 6174  ortdata = newdat
-0003ea30: 612e 736f 7274 5f76 616c 7565 7328 6e65  a.sort_values(ne
-0003ea40: 7764 6174 612e 636f 6c75 6d6e 735b 305d  wdata.columns[0]
-0003ea50: 290a 2020 2020 2020 2020 2020 2020 6d65  ).            me
-0003ea60: 7264 6174 6120 3d20 736f 7274 6461 7461  rdata = sortdata
-0003ea70: 2e67 726f 7570 6279 2873 6f72 7464 6174  .groupby(sortdat
-0003ea80: 612e 636f 6c75 6d6e 735b 305d 2c20 6173  a.columns[0], as
-0003ea90: 5f69 6e64 6578 3d46 616c 7365 292e 6d65  _index=False).me
-0003eaa0: 616e 2829 0a20 2020 2020 2020 2020 2020  an().           
-0003eab0: 2078 203d 206d 6572 6461 7461 5b27 6d61   x = merdata['ma
-0003eac0: 7072 6561 6c73 697a 6527 5d0a 2020 2020  prealsize'].    
-0003ead0: 2020 2020 2020 2020 7920 3d20 6d65 7264          y = merd
-0003eae0: 6174 615b 276d 656d 275d 0a20 2020 2020  ata['mem'].     
-0003eaf0: 2020 2020 2020 2069 6620 782e 7368 6170         if x.shap
-0003eb00: 655b 305d 203c 3d20 313a 0a20 2020 2020  e[0] <= 1:.     
-0003eb10: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0003eb20: 2827 5361 6d70 6c65 2069 7320 746f 6f20  ('Sample is too 
-0003eb30: 6c69 7474 6c65 2074 6f20 7370 6c69 742e  little to split.
-0003eb40: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0003eb50: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-0003eb60: 2020 2020 2020 2020 2020 2058 5f74 7261             X_tra
-0003eb70: 696e 2c20 585f 7465 7374 2c20 795f 7472  in, X_test, y_tr
-0003eb80: 6169 6e2c 2079 5f74 6573 7420 3d20 7472  ain, y_test = tr
-0003eb90: 6169 6e5f 7465 7374 5f73 706c 6974 2878  ain_test_split(x
-0003eba0: 2c20 792c 2074 6573 745f 7369 7a65 3d30  , y, test_size=0
-0003ebb0: 2e32 2c20 7261 6e64 6f6d 5f73 7461 7465  .2, random_state
-0003ebc0: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
-0003ebd0: 6966 2058 5f74 7261 696e 2e65 6d70 7479  if X_train.empty
-0003ebe0: 206f 7220 585f 7465 7374 2e65 6d70 7479   or X_test.empty
-0003ebf0: 206f 7220 795f 7472 6169 6e2e 656d 7074   or y_train.empt
-0003ec00: 7920 6f72 2079 5f74 6573 742e 656d 7074  y or y_test.empt
-0003ec10: 7920 6f72 206c 656e 2878 2e69 6e64 6578  y or len(x.index
-0003ec20: 2920 3c20 3330 3a0a 2020 2020 2020 2020  ) < 30:.        
-0003ec30: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-0003ec40: 7061 7273 6520 6461 7461 2066 6f72 206d  parse data for m
-0003ec50: 656d 6f72 7920 7072 6564 6963 7469 6f6e  emory prediction
-0003ec60: 2c20 7265 7375 6c74 206d 6179 206e 6f74  , result may not
-0003ec70: 2061 6363 7572 6174 652e 2729 0a20 2020   accurate.').   
-0003ec80: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0003ec90: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0003eca0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003ecb0: 2020 2020 2020 2020 2020 206c 726d 6f64             lrmod
-0003ecc0: 656c 203d 204c 696e 6561 7252 6567 7265  el = LinearRegre
-0003ecd0: 7373 696f 6e28 6669 745f 696e 7465 7263  ssion(fit_interc
-0003ece0: 6570 743d 4661 6c73 6529 0a20 2020 2020  ept=False).     
-0003ecf0: 2020 2020 2020 2020 2020 2023 2050 6572             # Per
-0003ed00: 666f 726d 2043 560a 2020 2020 2020 2020  form CV.        
-0003ed10: 2020 2020 2020 2020 7363 6f72 6573 203d          scores =
-0003ed20: 2063 726f 7373 5f76 616c 5f73 636f 7265   cross_val_score
-0003ed30: 286c 726d 6f64 656c 2c20 782e 7661 6c75  (lrmodel, x.valu
-0003ed40: 6573 2e72 6573 6861 7065 282d 312c 2031  es.reshape(-1, 1
-0003ed50: 292c 2079 2c20 6376 3d36 290a 2020 2020  ), y, cv=6).    
-0003ed60: 2020 2020 2020 2020 2020 2020 7072 6564              pred
-0003ed70: 6963 7469 6f6e 7320 3d20 6372 6f73 735f  ictions = cross_
-0003ed80: 7661 6c5f 7072 6564 6963 7428 6c72 6d6f  val_predict(lrmo
-0003ed90: 6465 6c2c 2078 2e76 616c 7565 732e 7265  del, x.values.re
-0003eda0: 7368 6170 6528 2d31 2c20 3129 2c20 792c  shape(-1, 1), y,
-0003edb0: 2063 763d 3629 0a0a 2020 2020 2020 2020   cv=6)..        
-0003edc0: 2020 2020 2020 2020 6c72 6d6f 6465 6c2e          lrmodel.
-0003edd0: 6669 7428 585f 7472 6169 6e2e 7661 6c75  fit(X_train.valu
-0003ede0: 6573 2e72 6573 6861 7065 282d 312c 2031  es.reshape(-1, 1
-0003edf0: 292c 2079 5f74 7261 696e 290a 2020 2020  ), y_train).    
-0003ee00: 2020 2020 2020 2020 2020 2020 6c72 7072              lrpr
-0003ee10: 6564 6963 7420 3d20 6c72 6d6f 6465 6c2e  edict = lrmodel.
-0003ee20: 7072 6564 6963 7428 585f 7465 7374 2e76  predict(X_test.v
-0003ee30: 616c 7565 732e 7265 7368 6170 6528 2d31  alues.reshape(-1
-0003ee40: 2c20 3129 290a 2020 2020 2020 2020 2020  , 1)).          
-0003ee50: 2020 2020 2020 7072 696e 7428 2736 2d46        print('6-F
-0003ee60: 6f6c 6420 4356 2073 636f 7265 733a 2573  old CV scores:%s
-0003ee70: 2720 2520 7363 6f72 6573 290a 2020 2020  ' % scores).    
-0003ee80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0003ee90: 7428 2743 5620 6163 6375 7261 6379 3a20  t('CV accuracy: 
-0003eea0: 2573 2720 2520 2872 325f 7363 6f72 6528  %s' % (r2_score(
-0003eeb0: 792c 2070 7265 6469 6374 696f 6e73 2929  y, predictions))
-0003eec0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003eed0: 2020 2320 7072 696e 7420 2753 636f 7265    # print 'Score
-0003eee0: 3a25 7327 2025 2028 6c72 6d6f 6465 6c2e  :%s' % (lrmodel.
-0003eef0: 7363 6f72 6528 585f 7465 7374 2e76 616c  score(X_test.val
-0003ef00: 7565 732e 7265 7368 6170 6528 2d31 2c31  ues.reshape(-1,1
-0003ef10: 292c 2079 5f74 6573 7429 290a 2020 2020  ), y_test)).    
-0003ef20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0003ef30: 7428 274c 696e 6561 7220 6d6f 6465 6c20  t('Linear model 
-0003ef40: 636f 6566 6669 6369 656e 7473 3a20 2573  coefficients: %s
-0003ef50: 2720 2520 286c 726d 6f64 656c 2e63 6f65  ' % (lrmodel.coe
-0003ef60: 665f 2929 0a20 2020 2020 2020 2020 2020  f_)).           
-0003ef70: 2020 2020 2070 7269 6e74 2827 4d53 453a       print('MSE:
-0003ef80: 2025 7327 2025 2028 6d65 616e 5f73 7175   %s' % (mean_squ
-0003ef90: 6172 6564 5f65 7272 6f72 2879 5f74 6573  ared_error(y_tes
-0003efa0: 742c 206c 7270 7265 6469 6374 2929 290a  t, lrpredict))).
-0003efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003efc0: 7072 696e 7428 2756 6172 6961 6e63 6520  print('Variance 
-0003efd0: 7363 6f72 6528 7465 7374 2061 6363 7572  score(test accur
-0003efe0: 6163 7929 3a20 2573 2720 2520 2872 325f  acy): %s' % (r2_
-0003eff0: 7363 6f72 6528 795f 7465 7374 2c20 6c72  score(y_test, lr
-0003f000: 7072 6564 6963 7429 2929 0a20 2020 2020  predict))).     
-0003f010: 2020 2020 2020 2020 2020 2079 5f70 7265             y_pre
-0003f020: 6420 3d20 6c72 6d6f 6465 6c2e 7072 6564  d = lrmodel.pred
-0003f030: 6963 7428 5b5b 696e 7075 7466 696c 6573  ict([[inputfiles
-0003f040: 697a 655d 5d29 0a0a 2020 2020 2020 2020  ize]])..        
-0003f050: 2020 2020 2020 2020 7265 7475 726e 2079          return y
-0003f060: 5f70 7265 640a 0a20 2020 2040 7374 6174  _pred..    @stat
-0003f070: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-0003f080: 2073 6176 6570 6561 6b6d 656d 6f72 7928   savepeakmemory(
-0003f090: 6669 6c65 6e61 6d65 2c20 6d61 786d 656d  filename, maxmem
-0003f0a0: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
-0003f0b0: 2020 2020 2020 2020 2020 2020 4461 7461              Data
-0003f0c0: 2063 6f6c 6c65 6374 6564 2061 6e64 2074   collected and t
-0003f0d0: 6f20 6265 2075 7365 6420 666f 7220 7072  o be used for pr
-0003f0e0: 6564 6963 7469 6f6e 2066 6f72 206d 656d  ediction for mem
-0003f0f0: 6f72 7920 7573 6167 650a 2020 2020 2020  ory usage.      
-0003f100: 2020 2020 2020 4d65 6d6f 7279 2073 6176        Memory sav
-0003f110: 6564 2061 7320 6120 636f 6d6d 6120 7365  ed as a comma se
-0003f120: 7061 7261 7465 2043 5356 2066 696c 652e  parate CSV file.
-0003f130: 0a0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0003f140: 6d20 6669 6c65 6e61 6d65 3a20 5374 7269  m filename: Stri
-0003f150: 6e67 2066 6f72 2066 696c 6520 7768 6963  ng for file whic
-0003f160: 6820 7573 6564 2074 6f20 636f 6c6c 6563  h used to collec
-0003f170: 7420 6461 7461 0a20 2020 2020 2020 203a  t data.        :
-0003f180: 7061 7261 6d20 6d61 786d 656d 3a20 466c  param maxmem: Fl
-0003f190: 6f61 7420 6e75 6d62 6572 2077 6869 6368  oat number which
-0003f1a0: 2067 6976 6573 2070 6561 6b20 6d65 6d6f   gives peak memo
-0003f1b0: 7279 2075 7361 6765 206f 6620 7468 6520  ry usage of the 
-0003f1c0: 6669 6e69 7368 6564 206a 6f62 0a20 2020  finished job.   
-0003f1d0: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
-0003f1e0: 6e65 0a0a 2020 2020 2020 2020 2222 220a  ne..        """.
-0003f1f0: 0a20 2020 2020 2020 2063 6f6c 756d 6e6e  .        columnn
-0003f200: 616d 6520 3d20 276d 656d 270a 2020 2020  ame = 'mem'.    
-0003f210: 2020 2020 2320 6469 7220 3d20 4d41 505f      # dir = MAP_
-0003f220: 5345 5256 4552 5f50 4154 4820 6966 2073  SERVER_PATH if s
-0003f230: 656c 662e 656d 6469 6420 6973 206e 6f74  elf.emdid is not
-0003f240: 204e 6f6e 6520 656c 7365 206f 732e 7061   None else os.pa
-0003f250: 7468 2e64 6972 6e61 6d65 286f 732e 7061  th.dirname(os.pa
-0003f260: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
-0003f270: 776f 726b 6469 7229 290a 2020 2020 2020  workdir)).      
-0003f280: 2020 2320 6669 6c65 6e61 6d65 203d 2064    # filename = d
-0003f290: 6972 202b 2027 696e 7075 742e 6373 7627  ir + 'input.csv'
-0003f2a0: 0a20 2020 2020 2020 206d 656d 7265 7375  .        memresu
-0003f2b0: 6c74 6669 6c65 203d 2066 696c 656e 616d  ltfile = filenam
-0003f2c0: 650a 2020 2020 2020 2020 6466 203d 2070  e.        df = p
-0003f2d0: 642e 7265 6164 5f63 7376 2866 696c 656e  d.read_csv(filen
-0003f2e0: 616d 652c 2068 6561 6465 723d 302c 2073  ame, header=0, s
-0003f2f0: 6570 3d27 2c27 2c20 736b 6970 696e 6974  ep=',', skipinit
-0003f300: 6961 6c73 7061 6365 3d54 7275 6529 0a20  ialspace=True). 
-0003f310: 2020 2020 2020 2064 665b 636f 6c75 6d6e         df[column
-0003f320: 6e61 6d65 5d5b 6c65 6e28 6466 2e69 6e64  name][len(df.ind
-0003f330: 6578 2920 2d20 315d 203d 206d 6178 6d65  ex) - 1] = maxme
-0003f340: 6d0a 2020 2020 2020 2020 6466 2e74 6f5f  m.        df.to_
-0003f350: 6373 7628 6d65 6d72 6573 756c 7466 696c  csv(memresultfil
-0003f360: 652c 2073 6570 3d27 2c27 2c20 696e 6465  e, sep=',', inde
-0003f370: 783d 4661 6c73 6529 0a0a 2020 2020 2020  x=False)..      
-0003f380: 2020 7265 7475 726e 204e 6f6e 650a 0a0a    return None...
-0003f390: 2020 2020 2320 4070 726f 6669 6c65 0a20      # @profile. 
-0003f3a0: 2020 2064 6566 2073 796d 6d65 7472 7928     def symmetry(
-0003f3b0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0003f3c0: 2222 0a20 2020 2020 2020 2020 2020 2050  "".            P
-0003f3d0: 726f 6475 696e 6720 7379 6d6d 6574 7279  roduing symmetry
-0003f3e0: 2069 6e66 6f72 6d61 7469 6f6e 206f 6620   information of 
-0003f3f0: 7468 6520 6d61 7020 6279 2075 7369 6e67  the map by using
-0003f400: 2050 726f 7368 6164 650a 2020 2020 2020   Proshade.      
-0003f410: 2020 2020 2020 5468 6973 2066 756e 6374        This funct
-0003f420: 696f 6e20 7573 696e 6720 7468 6520 6269  ion using the bi
-0003f430: 6e61 7279 2070 726f 7368 6164 6520 7072  nary proshade pr
-0003f440: 6f67 7261 6d20 206e 6f74 2074 6865 2070  ogram  not the p
-0003f450: 7974 686f 6e20 6170 690a 0a20 2020 2020  ython api..     
-0003f460: 2020 203a 7265 7475 726e 3a20 204e 6f6e     :return:  Non
-0003f470: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
-0003f480: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
-0003f490: 6c61 7466 6f72 6d20 3d3d 2027 656d 6462  latform == 'emdb
-0003f4a0: 273a 0a20 2020 2020 2020 2020 2020 2073  ':.            s
-0003f4b0: 7461 7274 203d 2074 696d 6569 742e 6465  tart = timeit.de
-0003f4c0: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
-0003f4d0: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
-0003f4e0: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-0003f4f0: 2020 2066 696e 616c 6469 6374 203d 207b     finaldict = {
-0003f500: 7d0a 2020 2020 2020 2020 2020 2020 7379  }.            sy
-0003f510: 6d6d 6574 7279 5265 7320 3d20 4661 6c73  mmetryRes = Fals
-0003f520: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-0003f530: 7366 6163 746f 7220 3d20 312e 300a 2020  sfactor = 1.0.  
-0003f540: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0003f550: 662e 6d65 7420 6973 206e 6f74 204e 6f6e  f.met is not Non
-0003f560: 6520 616e 6420 7365 6c66 2e72 6573 6f6c  e and self.resol
-0003f570: 7574 696f 6e20 6973 206e 6f74 204e 6f6e  ution is not Non
-0003f580: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0003f590: 2020 2069 6620 7365 6c66 2e6d 6574 2021     if self.met !
-0003f5a0: 3d20 2774 6f6d 6f27 2061 6e64 2073 656c  = 'tomo' and sel
-0003f5b0: 662e 6d65 7420 213d 2027 6865 6c69 273a  f.met != 'heli':
-0003f5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f5d0: 2020 2020 2070 726f 7368 6164 6520 3d20       proshade = 
-0003f5e0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0003f5f0: 2020 2020 2020 2020 2020 6966 2050 524f            if PRO
-0003f600: 5348 4144 4550 4154 483a 0a20 2020 2020  SHADEPATH:.     
-0003f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f620: 2020 2070 726f 7368 6164 6570 6174 6820     proshadepath 
-0003f630: 3d20 5052 4f53 4841 4445 5041 5448 0a20  = PROSHADEPATH. 
-0003f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f650: 2020 2020 2020 2070 726f 7368 6164 6520         proshade 
-0003f660: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
-0003f670: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0003f680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003f690: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0003f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f6b0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0003f6c0: 7420 6669 6e64 5f65 7865 6375 7461 626c  t find_executabl
-0003f6d0: 6528 2770 726f 7368 6164 6527 2920 6973  e('proshade') is
-0003f6e0: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+0003de80: 2020 276f 6e65 6269 7427 3a20 7b27 7827    'onebit': {'x'
+0003de90: 3a20 786f 6e65 6269 742c 2027 7927 3a20  : xonebit, 'y': 
+0003dea0: 796f 6e65 6269 747d 2c0a 2020 2020 2020  yonebit},.      
+0003deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dec0: 2020 2020 2020 2020 2020 2020 2730 2e35              '0.5
+0003ded0: 273a 207b 2778 273a 2078 6861 6c66 2c20  ': {'x': xhalf, 
+0003dee0: 2779 273a 2079 6861 6c66 7d2c 0a20 2020  'y': yhalf},.   
+0003def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003df00: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0003df10: 302e 3333 3327 3a20 7b27 7827 3a20 786f  0.333': {'x': xo
+0003df20: 6e65 7468 7265 652c 2027 7927 3a20 796f  nethree, 'y': yo
+0003df30: 6e65 7468 7265 657d 2c0a 2020 2020 2020  nethree},.      
+0003df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003df50: 2020 2020 2020 2020 2020 2020 2730 2e31              '0.1
+0003df60: 3433 273a 207b 2778 273a 2078 676f 6c64  43': {'x': xgold
+0003df70: 2c20 2779 273a 2079 676f 6c64 7d7d 7d0a  , 'y': ygold}}}.
+0003df80: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
+0003df90: 6c64 6963 7420 3d20 6469 6374 2829 0a20  ldict = dict(). 
+0003dfa0: 2020 2020 2020 2020 2020 2066 696e 616c             final
+0003dfb0: 6469 6374 5b6c 6162 656c 202b 2027 6673  dict[label + 'fs
+0003dfc0: 6327 5d20 3d20 6461 7461 6469 6374 0a0a  c'] = datadict..
+0003dfd0: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
+0003dfe0: 706c 6f74 2869 6e64 6961 7869 732c 2063  plot(indiaxis, c
+0003dff0: 6f72 726c 6973 742c 206c 6162 656c 3d6c  orrlist, label=l
+0003e000: 6162 656c 202b 2027 4653 4327 290a 2020  abel + 'FSC').  
+0003e010: 2020 2020 2020 2020 2020 2320 706c 742e            # plt.
+0003e020: 706c 6f74 2869 6e64 6961 7869 732c 2074  plot(indiaxis, t
+0003e030: 6872 6565 7369 672c 206c 6162 656c 3d27  hreesig, label='
+0003e040: 3320 7369 676d 6127 290a 2020 2020 2020  3 sigma').      
+0003e050: 2020 2020 2020 706c 742e 706c 6f74 2869        plt.plot(i
+0003e060: 6e64 6961 7869 732c 2068 616c 6662 6974  ndiaxis, halfbit
+0003e070: 2c20 6c61 6265 6c3d 2731 2f32 2062 6974  , label='1/2 bit
+0003e080: 2729 0a20 2020 2020 2020 2020 2020 2023  ').            #
+0003e090: 2070 6c74 2e70 6c6f 7428 696e 6469 6178   plt.plot(indiax
+0003e0a0: 6973 2c20 6f6e 6562 6974 2c20 6c61 6265  is, onebit, labe
+0003e0b0: 6c3d 2731 2062 6974 2729 0a20 2020 2020  l='1 bit').     
+0003e0c0: 2020 2020 2020 2070 6c74 2e70 6c6f 7428         plt.plot(
+0003e0d0: 696e 6469 6178 6973 2c20 662c 206c 6162  indiaxis, f, lab
+0003e0e0: 656c 3d27 302e 3527 2c20 6c69 6e65 7374  el='0.5', linest
+0003e0f0: 796c 653d 273a 2729 0a20 2020 2020 2020  yle=':').       
+0003e100: 2020 2020 2023 2070 6c74 2e70 6c6f 7428       # plt.plot(
+0003e110: 696e 6469 6178 6973 2c20 672c 206c 6162  indiaxis, g, lab
+0003e120: 656c 3d27 302e 3333 3327 2c20 6c69 6e65  el='0.333', line
+0003e130: 7374 796c 653d 272d 2d27 290a 2020 2020  style='--').    
+0003e140: 2020 2020 2020 2020 706c 742e 706c 6f74          plt.plot
+0003e150: 2869 6e64 6961 7869 732c 2068 2c20 6c61  (indiaxis, h, la
+0003e160: 6265 6c3d 2730 2e31 3433 272c 206c 696e  bel='0.143', lin
+0003e170: 6573 7479 6c65 3d27 2d2e 2729 0a20 2020  estyle='-.').   
+0003e180: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0003e190: 2e72 6573 6f6c 7574 696f 6e20 6973 206e  .resolution is n
+0003e1a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0003e1b0: 2020 2020 2020 2020 2070 6c74 2e70 6c6f           plt.plo
+0003e1c0: 7428 5b31 2f66 6c6f 6174 2873 656c 662e  t([1/float(self.
+0003e1d0: 7265 736f 6c75 7469 6f6e 295d 202a 2031  resolution)] * 1
+0003e1e0: 3030 2c20 6e70 2e6c 696e 7370 6163 6528  00, np.linspace(
+0003e1f0: 302c 2031 2c20 3130 3029 2c20 636f 6c6f  0, 1, 100), colo
+0003e200: 723d 2772 6564 2729 0a20 2020 2020 2020  r='red').       
+0003e210: 2020 2020 2070 6c74 2e6c 6567 656e 6428       plt.legend(
+0003e220: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0003e230: 206c 6162 656c 3a0a 2020 2020 2020 2020   label:.        
+0003e240: 2020 2020 2020 2020 706c 742e 7361 7665          plt.save
+0003e250: 6669 6728 7365 6c66 2e77 6f72 6b64 6972  fig(self.workdir
+0003e260: 202b 2073 656c 662e 6d61 706e 616d 6520   + self.mapname 
+0003e270: 2b20 275f 2720 2b20 6c61 6265 6c20 2b20  + '_' + label + 
+0003e280: 275f 6673 632e 706e 6727 290a 2020 2020  '_fsc.png').    
+0003e290: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0003e2a0: 2020 2020 2020 2020 2020 2020 2020 706c                pl
+0003e2b0: 742e 7361 7665 6669 6728 7365 6c66 2e77  t.savefig(self.w
+0003e2c0: 6f72 6b64 6972 202b 2073 656c 662e 6d61  orkdir + self.ma
+0003e2d0: 706e 616d 6520 2b20 275f 6673 632e 706e  pname + '_fsc.pn
+0003e2e0: 6727 290a 0a20 2020 2020 2020 2065 7863  g')..        exc
+0003e2f0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0003e300: 2065 7272 203d 2027 4653 4320 6361 6c63   err = 'FSC calc
+0003e310: 756c 6174 696f 6e20 6572 726f 723a 207b  ulation error: {
+0003e320: 7d27 2e66 6f72 6d61 7428 7379 732e 6578  }'.format(sys.ex
+0003e330: 635f 696e 666f 2829 5b31 5d29 0a20 2020  c_info()[1]).   
+0003e340: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
+0003e350: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
+0003e360: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0003e370: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
+0003e380: 275c 6e27 290a 0a20 2020 2020 2020 2069  '\n')..        i
+0003e390: 6620 6572 726c 6973 743a 0a20 2020 2020  f errlist:.     
+0003e3a0: 2020 2020 2020 2064 6174 6164 6963 7420         datadict 
+0003e3b0: 3d20 7b27 6572 7227 3a20 7b6c 6162 656c  = {'err': {label
+0003e3c0: 202b 2027 6673 635f 6572 726f 7227 3a20   + 'fsc_error': 
+0003e3d0: 6572 726c 6973 747d 7d0a 2020 2020 2020  errlist}}.      
+0003e3e0: 2020 2020 2020 6669 6e61 6c64 6963 745b        finaldict[
+0003e3f0: 6c61 6265 6c20 2b20 2766 7363 275d 203d  label + 'fsc'] =
+0003e400: 2064 6174 6164 6963 740a 2020 2020 2020   datadict.      
+0003e410: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003e420: 2020 2020 7072 696e 7428 274e 6f20 6572      print('No er
+0003e430: 726f 7220 696e 2046 5343 2063 616c 6375  ror in FSC calcu
+0003e440: 6c61 7469 6f6e 2e27 290a 0a20 2020 2020  lation.')..     
+0003e450: 2020 2069 6620 626f 6f6c 2864 6174 6164     if bool(datad
+0003e460: 6963 7429 2061 6e64 2062 6f6f 6c28 6669  ict) and bool(fi
+0003e470: 6e61 6c64 6963 7429 3a0a 2020 2020 2020  naldict):.      
+0003e480: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0003e490: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0003e4a0: 636f 6465 6373 2e6f 7065 6e28 7365 6c66  codecs.open(self
+0003e4b0: 2e77 6f72 6b64 6972 202b 2073 656c 662e  .workdir + self.
+0003e4c0: 6d61 706e 616d 6520 2b20 275f 2720 2b20  mapname + '_' + 
+0003e4d0: 6c61 6265 6c20 2b20 2766 7363 2e6a 736f  label + 'fsc.jso
+0003e4e0: 6e27 2c20 2777 272c 2065 6e63 6f64 696e  n', 'w', encodin
+0003e4f0: 673d 2775 7466 2d38 2729 2061 7320 663a  g='utf-8') as f:
+0003e500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e510: 2020 2020 206a 736f 6e2e 6475 6d70 2866       json.dump(f
+0003e520: 696e 616c 6469 6374 2c20 6629 0a20 2020  inaldict, f).   
+0003e530: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0003e540: 6e74 2827 4653 4320 7072 6f64 7563 6564  nt('FSC produced
+0003e550: 2062 7920 7477 6f20 6861 6c66 206d 6170   by two half map
+0003e560: 732e 2729 0a20 2020 2020 2020 2020 2020  s.').           
+0003e570: 2020 2020 2023 2077 6974 6820 636f 6465       # with code
+0003e580: 6373 2e6f 7065 6e28 7365 6c66 2e77 6f72  cs.open(self.wor
+0003e590: 6b64 6972 202b 206f 6464 6e61 6d65 202b  kdir + oddname +
+0003e5a0: 2027 5f27 202b 2065 7665 6e6e 616d 6520   '_' + evenname 
+0003e5b0: 2b20 275f 2720 2b20 6c61 6265 6c20 2b20  + '_' + label + 
+0003e5c0: 2766 7363 2e6a 736f 6e27 2c20 2777 272c  'fsc.json', 'w',
+0003e5d0: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
+0003e5e0: 2729 2061 7320 6e66 3a0a 2020 2020 2020  ') as nf:.      
+0003e5f0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0003e600: 6a73 6f6e 2e64 756d 7028 6669 6e61 6c64  json.dump(finald
+0003e610: 6963 742c 206e 6629 0a20 2020 2020 2020  ict, nf).       
+0003e620: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
+0003e630: 2827 326e 6420 6673 6320 7361 7665 6427  ('2nd fsc saved'
+0003e640: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+0003e650: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+0003e660: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
+0003e670: 2e77 7269 7465 2827 5772 6974 696e 6720  .write('Writing 
+0003e680: 4653 4320 6461 7461 2074 6f20 6a73 6f6e  FSC data to json
+0003e690: 2066 696c 6520 6572 726f 723a 207b 7d2e   file error: {}.
+0003e6a0: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
+0003e6b0: 5f69 6e66 6f28 295b 315d 2929 0a20 2020  _info()[1])).   
+0003e6c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0003e6d0: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
+0003e6e0: 722e 7772 6974 6528 2746 5343 2063 616c  r.write('FSC cal
+0003e6f0: 6375 6c61 7469 6f6e 2067 6574 206e 6f6e  culation get non
+0003e700: 6520 2729 0a0a 2020 2020 2020 2020 7265  e ')..        re
+0003e710: 7475 726e 204e 6f6e 650a 0a20 2020 2040  turn None..    @
+0003e720: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0003e730: 2064 6566 206d 656d 7072 6564 2872 6573   def mempred(res
+0003e740: 756c 7466 696c 652c 2069 6e70 7574 6669  ultfile, inputfi
+0003e750: 6c65 7369 7a65 293a 0a20 2020 2020 2020  lesize):.       
+0003e760: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+0003e770: 2020 5072 6f64 7563 6520 6d65 6d6f 7279    Produce memory
+0003e780: 2070 7265 6469 6374 696f 6e20 7265 7375   prediction resu
+0003e790: 6c74 7320 7573 696e 6720 6c69 6e65 6172  lts using linear
+0003e7a0: 2072 6567 7265 7373 696f 6e0a 2020 2020   regression.    
+0003e7b0: 2020 2020 2020 2020 6261 7365 6420 6f6e          based on
+0003e7c0: 2074 6865 2064 6174 6120 6672 6f6d 2070   the data from p
+0003e7d0: 7265 7669 6f75 7320 656e 7472 6965 732e  revious entries.
+0003e7e0: 0a0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0003e7f0: 6d20 7265 7375 6c74 6669 6c65 3a20 5072  m resultfile: Pr
+0003e800: 6576 696f 7573 206d 656d 6f72 7920 7573  evious memory us
+0003e810: 6167 6520 696e 666f 726d 6174 696f 6e20  age information 
+0003e820: 696e 2043 5356 2066 696c 650a 2020 2020  in CSV file.    
+0003e830: 2020 2020 3a70 6172 616d 2069 6e70 7574      :param input
+0003e840: 6669 6c65 7369 7a65 3a20 5468 6520 696e  filesize: The in
+0003e850: 7075 7420 6465 6e73 6974 7920 6d61 7020  put density map 
+0003e860: 7369 7a65 0a20 2020 2020 2020 203a 7265  size.        :re
+0003e870: 7475 726e 3a20 3020 6f72 2079 5f70 7265  turn: 0 or y_pre
+0003e880: 6420 2874 6865 2070 7265 6469 6374 6564  d (the predicted
+0003e890: 206d 656d 6f72 7920 7573 6167 6529 0a20   memory usage). 
+0003e8a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0003e8b0: 2020 2066 726f 6d20 736b 6c65 6172 6e2e     from sklearn.
+0003e8c0: 6c69 6e65 6172 5f6d 6f64 656c 2069 6d70  linear_model imp
+0003e8d0: 6f72 7420 4c69 6e65 6172 5265 6772 6573  ort LinearRegres
+0003e8e0: 7369 6f6e 0a20 2020 2020 2020 2066 726f  sion.        fro
+0003e8f0: 6d20 736b 6c65 6172 6e2e 6d65 7472 6963  m sklearn.metric
+0003e900: 7320 696d 706f 7274 206d 6561 6e5f 7371  s import mean_sq
+0003e910: 7561 7265 645f 6572 726f 722c 2072 325f  uared_error, r2_
+0003e920: 7363 6f72 650a 2020 2020 2020 2020 6672  score.        fr
+0003e930: 6f6d 2073 6b6c 6561 726e 2e6d 6f64 656c  om sklearn.model
+0003e940: 5f73 656c 6563 7469 6f6e 2069 6d70 6f72  _selection impor
+0003e950: 7420 7472 6169 6e5f 7465 7374 5f73 706c  t train_test_spl
+0003e960: 6974 0a20 2020 2020 2020 2066 726f 6d20  it.        from 
+0003e970: 736b 6c65 6172 6e2e 6d6f 6465 6c5f 7365  sklearn.model_se
+0003e980: 6c65 6374 696f 6e20 696d 706f 7274 2063  lection import c
+0003e990: 726f 7373 5f76 616c 5f73 636f 7265 2c20  ross_val_score, 
+0003e9a0: 6372 6f73 735f 7661 6c5f 7072 6564 6963  cross_val_predic
+0003e9b0: 740a 0a20 2020 2020 2020 2064 6174 6120  t..        data 
+0003e9c0: 3d20 7064 2e72 6561 645f 6373 7628 7265  = pd.read_csv(re
+0003e9d0: 7375 6c74 6669 6c65 2c20 6865 6164 6572  sultfile, header
+0003e9e0: 3d30 290a 2020 2020 2020 2020 6461 7461  =0).        data
+0003e9f0: 203d 2064 6174 612e 6472 6f70 6e61 2829   = data.dropna()
+0003ea00: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
+0003ea10: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
+0003ea20: 2020 2020 7072 696e 7428 274e 6f20 7573      print('No us
+0003ea30: 6566 756c 2064 6174 6120 696e 2074 6865  eful data in the
+0003ea40: 2064 6174 6166 7261 6d65 2e27 290a 2020   dataframe.').  
+0003ea50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0003ea60: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+0003ea70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0003ea80: 6e65 7764 6174 6120 3d20 6461 7461 2e69  newdata = data.i
+0003ea90: 6c6f 635b 3a2c 2031 3a5d 0a20 2020 2020  loc[:, 1:].     
+0003eaa0: 2020 2020 2020 2073 6f72 7464 6174 6120         sortdata 
+0003eab0: 3d20 6e65 7764 6174 612e 736f 7274 5f76  = newdata.sort_v
+0003eac0: 616c 7565 7328 6e65 7764 6174 612e 636f  alues(newdata.co
+0003ead0: 6c75 6d6e 735b 305d 290a 2020 2020 2020  lumns[0]).      
+0003eae0: 2020 2020 2020 6d65 7264 6174 6120 3d20        merdata = 
+0003eaf0: 736f 7274 6461 7461 2e67 726f 7570 6279  sortdata.groupby
+0003eb00: 2873 6f72 7464 6174 612e 636f 6c75 6d6e  (sortdata.column
+0003eb10: 735b 305d 2c20 6173 5f69 6e64 6578 3d46  s[0], as_index=F
+0003eb20: 616c 7365 292e 6d65 616e 2829 0a20 2020  alse).mean().   
+0003eb30: 2020 2020 2020 2020 2078 203d 206d 6572           x = mer
+0003eb40: 6461 7461 5b27 6d61 7072 6561 6c73 697a  data['maprealsiz
+0003eb50: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0003eb60: 7920 3d20 6d65 7264 6174 615b 276d 656d  y = merdata['mem
+0003eb70: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
+0003eb80: 6620 782e 7368 6170 655b 305d 203c 3d20  f x.shape[0] <= 
+0003eb90: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0003eba0: 2020 2070 7269 6e74 2827 5361 6d70 6c65     print('Sample
+0003ebb0: 2069 7320 746f 6f20 6c69 7474 6c65 2074   is too little t
+0003ebc0: 6f20 7370 6c69 742e 2729 0a20 2020 2020  o split.').     
+0003ebd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0003ebe0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2020  n None.         
+0003ebf0: 2020 2058 5f74 7261 696e 2c20 585f 7465     X_train, X_te
+0003ec00: 7374 2c20 795f 7472 6169 6e2c 2079 5f74  st, y_train, y_t
+0003ec10: 6573 7420 3d20 7472 6169 6e5f 7465 7374  est = train_test
+0003ec20: 5f73 706c 6974 2878 2c20 792c 2074 6573  _split(x, y, tes
+0003ec30: 745f 7369 7a65 3d30 2e32 2c20 7261 6e64  t_size=0.2, rand
+0003ec40: 6f6d 5f73 7461 7465 3d30 290a 2020 2020  om_state=0).    
+0003ec50: 2020 2020 2020 2020 6966 2058 5f74 7261          if X_tra
+0003ec60: 696e 2e65 6d70 7479 206f 7220 585f 7465  in.empty or X_te
+0003ec70: 7374 2e65 6d70 7479 206f 7220 795f 7472  st.empty or y_tr
+0003ec80: 6169 6e2e 656d 7074 7920 6f72 2079 5f74  ain.empty or y_t
+0003ec90: 6573 742e 656d 7074 7920 6f72 206c 656e  est.empty or len
+0003eca0: 2878 2e69 6e64 6578 2920 3c20 3330 3a0a  (x.index) < 30:.
+0003ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ecc0: 7072 696e 7428 2753 7061 7273 6520 6461  print('Sparse da
+0003ecd0: 7461 2066 6f72 206d 656d 6f72 7920 7072  ta for memory pr
+0003ece0: 6564 6963 7469 6f6e 2c20 7265 7375 6c74  ediction, result
+0003ecf0: 206d 6179 206e 6f74 2061 6363 7572 6174   may not accurat
+0003ed00: 652e 2729 0a20 2020 2020 2020 2020 2020  e.').           
+0003ed10: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0003ed20: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0003ed30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003ed40: 2020 206c 726d 6f64 656c 203d 204c 696e     lrmodel = Lin
+0003ed50: 6561 7252 6567 7265 7373 696f 6e28 6669  earRegression(fi
+0003ed60: 745f 696e 7465 7263 6570 743d 4661 6c73  t_intercept=Fals
+0003ed70: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0003ed80: 2020 2023 2050 6572 666f 726d 2043 560a     # Perform CV.
+0003ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003eda0: 7363 6f72 6573 203d 2063 726f 7373 5f76  scores = cross_v
+0003edb0: 616c 5f73 636f 7265 286c 726d 6f64 656c  al_score(lrmodel
+0003edc0: 2c20 782e 7661 6c75 6573 2e72 6573 6861  , x.values.resha
+0003edd0: 7065 282d 312c 2031 292c 2079 2c20 6376  pe(-1, 1), y, cv
+0003ede0: 3d36 290a 2020 2020 2020 2020 2020 2020  =6).            
+0003edf0: 2020 2020 7072 6564 6963 7469 6f6e 7320      predictions 
+0003ee00: 3d20 6372 6f73 735f 7661 6c5f 7072 6564  = cross_val_pred
+0003ee10: 6963 7428 6c72 6d6f 6465 6c2c 2078 2e76  ict(lrmodel, x.v
+0003ee20: 616c 7565 732e 7265 7368 6170 6528 2d31  alues.reshape(-1
+0003ee30: 2c20 3129 2c20 792c 2063 763d 3629 0a0a  , 1), y, cv=6)..
+0003ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ee50: 6c72 6d6f 6465 6c2e 6669 7428 585f 7472  lrmodel.fit(X_tr
+0003ee60: 6169 6e2e 7661 6c75 6573 2e72 6573 6861  ain.values.resha
+0003ee70: 7065 282d 312c 2031 292c 2079 5f74 7261  pe(-1, 1), y_tra
+0003ee80: 696e 290a 2020 2020 2020 2020 2020 2020  in).            
+0003ee90: 2020 2020 6c72 7072 6564 6963 7420 3d20      lrpredict = 
+0003eea0: 6c72 6d6f 6465 6c2e 7072 6564 6963 7428  lrmodel.predict(
+0003eeb0: 585f 7465 7374 2e76 616c 7565 732e 7265  X_test.values.re
+0003eec0: 7368 6170 6528 2d31 2c20 3129 290a 2020  shape(-1, 1)).  
+0003eed0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003eee0: 696e 7428 2736 2d46 6f6c 6420 4356 2073  int('6-Fold CV s
+0003eef0: 636f 7265 733a 2573 2720 2520 7363 6f72  cores:%s' % scor
+0003ef00: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0003ef10: 2020 2020 7072 696e 7428 2743 5620 6163      print('CV ac
+0003ef20: 6375 7261 6379 3a20 2573 2720 2520 2872  curacy: %s' % (r
+0003ef30: 325f 7363 6f72 6528 792c 2070 7265 6469  2_score(y, predi
+0003ef40: 6374 696f 6e73 2929 290a 2020 2020 2020  ctions))).      
+0003ef50: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+0003ef60: 7420 2753 636f 7265 3a25 7327 2025 2028  t 'Score:%s' % (
+0003ef70: 6c72 6d6f 6465 6c2e 7363 6f72 6528 585f  lrmodel.score(X_
+0003ef80: 7465 7374 2e76 616c 7565 732e 7265 7368  test.values.resh
+0003ef90: 6170 6528 2d31 2c31 292c 2079 5f74 6573  ape(-1,1), y_tes
+0003efa0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+0003efb0: 2020 2020 7072 696e 7428 274c 696e 6561      print('Linea
+0003efc0: 7220 6d6f 6465 6c20 636f 6566 6669 6369  r model coeffici
+0003efd0: 656e 7473 3a20 2573 2720 2520 286c 726d  ents: %s' % (lrm
+0003efe0: 6f64 656c 2e63 6f65 665f 2929 0a20 2020  odel.coef_)).   
+0003eff0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0003f000: 6e74 2827 4d53 453a 2025 7327 2025 2028  nt('MSE: %s' % (
+0003f010: 6d65 616e 5f73 7175 6172 6564 5f65 7272  mean_squared_err
+0003f020: 6f72 2879 5f74 6573 742c 206c 7270 7265  or(y_test, lrpre
+0003f030: 6469 6374 2929 290a 2020 2020 2020 2020  dict))).        
+0003f040: 2020 2020 2020 2020 7072 696e 7428 2756          print('V
+0003f050: 6172 6961 6e63 6520 7363 6f72 6528 7465  ariance score(te
+0003f060: 7374 2061 6363 7572 6163 7929 3a20 2573  st accuracy): %s
+0003f070: 2720 2520 2872 325f 7363 6f72 6528 795f  ' % (r2_score(y_
+0003f080: 7465 7374 2c20 6c72 7072 6564 6963 7429  test, lrpredict)
+0003f090: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0003f0a0: 2020 2079 5f70 7265 6420 3d20 6c72 6d6f     y_pred = lrmo
+0003f0b0: 6465 6c2e 7072 6564 6963 7428 5b5b 696e  del.predict([[in
+0003f0c0: 7075 7466 696c 6573 697a 655d 5d29 0a0a  putfilesize]])..
+0003f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f0e0: 7265 7475 726e 2079 5f70 7265 640a 0a20  return y_pred.. 
+0003f0f0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+0003f100: 0a20 2020 2064 6566 2073 6176 6570 6561  .    def savepea
+0003f110: 6b6d 656d 6f72 7928 6669 6c65 6e61 6d65  kmemory(filename
+0003f120: 2c20 6d61 786d 656d 293a 0a20 2020 2020  , maxmem):.     
+0003f130: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0003f140: 2020 2020 4461 7461 2063 6f6c 6c65 6374      Data collect
+0003f150: 6564 2061 6e64 2074 6f20 6265 2075 7365  ed and to be use
+0003f160: 6420 666f 7220 7072 6564 6963 7469 6f6e  d for prediction
+0003f170: 2066 6f72 206d 656d 6f72 7920 7573 6167   for memory usag
+0003f180: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
+0003f190: 6d6f 7279 2073 6176 6564 2061 7320 6120  mory saved as a 
+0003f1a0: 636f 6d6d 6120 7365 7061 7261 7465 2043  comma separate C
+0003f1b0: 5356 2066 696c 652e 0a0a 0a20 2020 2020  SV file....     
+0003f1c0: 2020 203a 7061 7261 6d20 6669 6c65 6e61     :param filena
+0003f1d0: 6d65 3a20 5374 7269 6e67 2066 6f72 2066  me: String for f
+0003f1e0: 696c 6520 7768 6963 6820 7573 6564 2074  ile which used t
+0003f1f0: 6f20 636f 6c6c 6563 7420 6461 7461 0a20  o collect data. 
+0003f200: 2020 2020 2020 203a 7061 7261 6d20 6d61         :param ma
+0003f210: 786d 656d 3a20 466c 6f61 7420 6e75 6d62  xmem: Float numb
+0003f220: 6572 2077 6869 6368 2067 6976 6573 2070  er which gives p
+0003f230: 6561 6b20 6d65 6d6f 7279 2075 7361 6765  eak memory usage
+0003f240: 206f 6620 7468 6520 6669 6e69 7368 6564   of the finished
+0003f250: 206a 6f62 0a20 2020 2020 2020 203a 7265   job.        :re
+0003f260: 7475 726e 3a20 4e6f 6e65 0a0a 2020 2020  turn: None..    
+0003f270: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0003f280: 2063 6f6c 756d 6e6e 616d 6520 3d20 276d   columnname = 'm
+0003f290: 656d 270a 2020 2020 2020 2020 2320 6469  em'.        # di
+0003f2a0: 7220 3d20 4d41 505f 5345 5256 4552 5f50  r = MAP_SERVER_P
+0003f2b0: 4154 4820 6966 2073 656c 662e 656d 6469  ATH if self.emdi
+0003f2c0: 6420 6973 206e 6f74 204e 6f6e 6520 656c  d is not None el
+0003f2d0: 7365 206f 732e 7061 7468 2e64 6972 6e61  se os.path.dirna
+0003f2e0: 6d65 286f 732e 7061 7468 2e64 6972 6e61  me(os.path.dirna
+0003f2f0: 6d65 2873 656c 662e 776f 726b 6469 7229  me(self.workdir)
+0003f300: 290a 2020 2020 2020 2020 2320 6669 6c65  ).        # file
+0003f310: 6e61 6d65 203d 2064 6972 202b 2027 696e  name = dir + 'in
+0003f320: 7075 742e 6373 7627 0a20 2020 2020 2020  put.csv'.       
+0003f330: 206d 656d 7265 7375 6c74 6669 6c65 203d   memresultfile =
+0003f340: 2066 696c 656e 616d 650a 2020 2020 2020   filename.      
+0003f350: 2020 6466 203d 2070 642e 7265 6164 5f63    df = pd.read_c
+0003f360: 7376 2866 696c 656e 616d 652c 2068 6561  sv(filename, hea
+0003f370: 6465 723d 302c 2073 6570 3d27 2c27 2c20  der=0, sep=',', 
+0003f380: 736b 6970 696e 6974 6961 6c73 7061 6365  skipinitialspace
+0003f390: 3d54 7275 6529 0a20 2020 2020 2020 2064  =True).        d
+0003f3a0: 665b 636f 6c75 6d6e 6e61 6d65 5d5b 6c65  f[columnname][le
+0003f3b0: 6e28 6466 2e69 6e64 6578 2920 2d20 315d  n(df.index) - 1]
+0003f3c0: 203d 206d 6178 6d65 6d0a 2020 2020 2020   = maxmem.      
+0003f3d0: 2020 6466 2e74 6f5f 6373 7628 6d65 6d72    df.to_csv(memr
+0003f3e0: 6573 756c 7466 696c 652c 2073 6570 3d27  esultfile, sep='
+0003f3f0: 2c27 2c20 696e 6465 783d 4661 6c73 6529  ,', index=False)
+0003f400: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003f410: 204e 6f6e 650a 0a0a 2020 2020 2320 4070   None...    # @p
+0003f420: 726f 6669 6c65 0a20 2020 2064 6566 2073  rofile.    def s
+0003f430: 796d 6d65 7472 7928 7365 6c66 293a 0a20  ymmetry(self):. 
+0003f440: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0003f450: 2020 2020 2020 2050 726f 6475 696e 6720         Produing 
+0003f460: 7379 6d6d 6574 7279 2069 6e66 6f72 6d61  symmetry informa
+0003f470: 7469 6f6e 206f 6620 7468 6520 6d61 7020  tion of the map 
+0003f480: 6279 2075 7369 6e67 2050 726f 7368 6164  by using Proshad
+0003f490: 650a 2020 2020 2020 2020 2020 2020 5468  e.            Th
+0003f4a0: 6973 2066 756e 6374 696f 6e20 7573 696e  is function usin
+0003f4b0: 6720 7468 6520 6269 6e61 7279 2070 726f  g the binary pro
+0003f4c0: 7368 6164 6520 7072 6f67 7261 6d20 206e  shade program  n
+0003f4d0: 6f74 2074 6865 2070 7974 686f 6e20 6170  ot the python ap
+0003f4e0: 690a 0a20 2020 2020 2020 203a 7265 7475  i..        :retu
+0003f4f0: 726e 3a20 204e 6f6e 650a 2020 2020 2020  rn:  None.      
+0003f500: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
+0003f510: 6620 7365 6c66 2e70 6c61 7466 6f72 6d20  f self.platform 
+0003f520: 3d3d 2027 656d 6462 273a 0a20 2020 2020  == 'emdb':.     
+0003f530: 2020 2020 2020 2073 7461 7274 203d 2074         start = t
+0003f540: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
+0003f550: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
+0003f560: 2020 6572 726c 6973 7420 3d20 5b5d 0a20    errlist = []. 
+0003f570: 2020 2020 2020 2020 2020 2066 696e 616c             final
+0003f580: 6469 6374 203d 207b 7d0a 2020 2020 2020  dict = {}.      
+0003f590: 2020 2020 2020 7379 6d6d 6574 7279 5265        symmetryRe
+0003f5a0: 7320 3d20 4661 6c73 650a 2020 2020 2020  s = False.      
+0003f5b0: 2020 2020 2020 7265 7366 6163 746f 7220        resfactor 
+0003f5c0: 3d20 312e 300a 2020 2020 2020 2020 2020  = 1.0.          
+0003f5d0: 2020 6966 2073 656c 662e 6d65 7420 6973    if self.met is
+0003f5e0: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
+0003f5f0: 6c66 2e72 6573 6f6c 7574 696f 6e20 6973  lf.resolution is
+0003f600: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0003f610: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0003f620: 6c66 2e6d 6574 2021 3d20 2774 6f6d 6f27  lf.met != 'tomo'
+0003f630: 2061 6e64 2073 656c 662e 6d65 7420 213d   and self.met !=
+0003f640: 2027 6865 6c69 273a 0a20 2020 2020 2020   'heli':.       
+0003f650: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0003f660: 7368 6164 6520 3d20 4661 6c73 650a 2020  shade = False.  
+0003f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f680: 2020 6966 2050 524f 5348 4144 4550 4154    if PROSHADEPAT
+0003f690: 483a 0a20 2020 2020 2020 2020 2020 2020  H:.             
+0003f6a0: 2020 2020 2020 2020 2020 2070 726f 7368             prosh
+0003f6b0: 6164 6570 6174 6820 3d20 5052 4f53 4841  adepath = PROSHA
+0003f6c0: 4445 5041 5448 0a20 2020 2020 2020 2020  DEPATH.         
+0003f6d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0003f6e0: 726f 7368 6164 6520 3d20 5472 7565 0a0a  roshade = True..
 0003f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f700: 2020 2020 2020 7072 6f73 6861 6465 7061        proshadepa
-0003f710: 7468 203d 2066 696e 645f 6578 6563 7574  th = find_execut
-0003f720: 6162 6c65 2827 7072 6f73 6861 6465 2729  able('proshade')
-0003f730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f740: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0003f750: 7368 6164 6520 3d20 5472 7565 0a20 2020  shade = True.   
-0003f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f770: 2020 2020 2065 7863 6570 7420 4173 7365       except Asse
-0003f780: 7274 696f 6e45 7272 6f72 3a0a 2020 2020  rtionError:.    
-0003f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f7a0: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
-0003f7b0: 7272 2e77 7269 7465 2827 7072 6f73 6861  rr.write('prosha
-0003f7c0: 6465 2065 7865 6375 7461 626c 6520 6973  de executable is
-0003f7d0: 206e 6f74 2074 6865 7265 2c20 706c 6561   not there, plea
-0003f7e0: 7365 2069 6e73 7461 6c6c 2070 726f 7368  se install prosh
-0003f7f0: 6164 652e 5c6e 2729 0a20 2020 2020 2020  ade.\n').       
-0003f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f810: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-0003f820: 7772 6974 6528 2753 796d 6d65 7472 7920  write('Symmetry 
-0003f830: 696e 666f 726d 6174 696f 6e20 7769 6c6c  information will
-0003f840: 206e 6f74 2062 6520 7072 6f64 7563 6564   not be produced
-0003f850: 2e5c 6e27 290a 0a20 2020 2020 2020 2020  .\n')..         
-0003f860: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-0003f870: 6f73 6861 6465 3a0a 2020 2020 2020 2020  oshade:.        
-0003f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f890: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0003f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f8b0: 2066 756c 6c6d 6170 7061 7468 203d 2027   fullmappath = '
-0003f8c0: 7b7d 7b7d 272e 666f 726d 6174 2873 656c  {}{}'.format(sel
-0003f8d0: 662e 776f 726b 6469 722c 2073 656c 662e  f.workdir, self.
-0003f8e0: 6d61 706e 616d 6529 0a20 2020 2020 2020  mapname).       
-0003f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f900: 2020 2020 2069 6620 2763 6370 656d 2720       if 'ccpem' 
-0003f910: 6e6f 7420 696e 2050 524f 5348 4144 4550  not in PROSHADEP
-0003f920: 4154 483a 0a20 2020 2020 2020 2020 2020  ATH:.           
-0003f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f940: 2020 2020 2023 2063 6d64 203d 206c 6973       # cmd = lis
-0003f950: 7428 2850 524f 5348 4144 4550 4154 4820  t((PROSHADEPATH 
-0003f960: 2b20 2720 2d53 202d 6620 2720 2b20 7365  + ' -S -f ' + se
-0003f970: 6c66 2e6d 6170 2e66 696c 656e 616d 6520  lf.map.filename 
-0003f980: 2b20 2720 2d73 2027 202b 2073 7472 2866  + ' -s ' + str(f
-0003f990: 6c6f 6174 2873 656c 662e 7265 736f 6c75  loat(self.resolu
-0003f9a0: 7469 6f6e 2920 2a20 7265 7366 6163 746f  tion) * resfacto
-0003f9b0: 7229 292e 7370 6c69 7428 2720 2729 290a  r)).split(' ')).
-0003f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f9e0: 636d 6420 3d20 6c69 7374 2828 5052 4f53  cmd = list((PROS
-0003f9f0: 4841 4445 5041 5448 202b 2027 202d 5320  HADEPATH + ' -S 
-0003fa00: 2d66 2027 202b 2073 656c 662e 6d61 702e  -f ' + self.map.
-0003fa10: 6675 6c6c 6e61 6d65 202b 2027 202d 7320  fullname + ' -s 
-0003fa20: 2720 2b20 7374 7228 666c 6f61 7428 7365  ' + str(float(se
-0003fa30: 6c66 2e72 6573 6f6c 7574 696f 6e29 202a  lf.resolution) *
-0003fa40: 2072 6573 6661 6374 6f72 2929 2e73 706c   resfactor)).spl
-0003fa50: 6974 2827 2027 2929 0a20 2020 2020 2020  it(' ')).       
-0003fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fa70: 2020 2020 2020 2020 2070 7269 6e74 2863           print(c
-0003fa80: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
-0003fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003faa0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003fab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fac0: 2020 2020 2020 7368 6172 6569 6e64 6578        shareindex
-0003fad0: 203d 205b 6964 7820 666f 7220 6964 782c   = [idx for idx,
-0003fae0: 2073 2069 6e20 656e 756d 6572 6174 6528   s in enumerate(
-0003faf0: 5052 4f53 4841 4445 5041 5448 2e73 706c  PROSHADEPATH.spl
-0003fb00: 6974 2827 2f27 2929 2069 6620 2763 6370  it('/')) if 'ccp
-0003fb10: 656d 2d27 2069 6e20 735d 5b30 5d20 2b20  em-' in s][0] + 
-0003fb20: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0003f700: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f720: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0003f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f740: 2020 2061 7373 6572 7420 6669 6e64 5f65     assert find_e
+0003f750: 7865 6375 7461 626c 6528 2770 726f 7368  xecutable('prosh
+0003f760: 6164 6527 2920 6973 206e 6f74 204e 6f6e  ade') is not Non
+0003f770: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0003f780: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003f790: 6f73 6861 6465 7061 7468 203d 2066 696e  oshadepath = fin
+0003f7a0: 645f 6578 6563 7574 6162 6c65 2827 7072  d_executable('pr
+0003f7b0: 6f73 6861 6465 2729 0a20 2020 2020 2020  oshade').       
+0003f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f7d0: 2020 2020 2070 726f 7368 6164 6520 3d20       proshade = 
+0003f7e0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0003f7f0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0003f800: 6570 7420 4173 7365 7274 696f 6e45 7272  ept AssertionErr
+0003f810: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0003f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f830: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+0003f840: 2827 7072 6f73 6861 6465 2065 7865 6375  ('proshade execu
+0003f850: 7461 626c 6520 6973 206e 6f74 2074 6865  table is not the
+0003f860: 7265 2c20 706c 6561 7365 2069 6e73 7461  re, please insta
+0003f870: 6c6c 2070 726f 7368 6164 652e 5c6e 2729  ll proshade.\n')
+0003f880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f890: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0003f8a0: 2e73 7464 6572 722e 7772 6974 6528 2753  .stderr.write('S
+0003f8b0: 796d 6d65 7472 7920 696e 666f 726d 6174  ymmetry informat
+0003f8c0: 696f 6e20 7769 6c6c 206e 6f74 2062 6520  ion will not be 
+0003f8d0: 7072 6f64 7563 6564 2e5c 6e27 290a 0a20  produced.\n').. 
+0003f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f8f0: 2020 2069 6620 7072 6f73 6861 6465 3a0a     if proshade:.
+0003f900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f910: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0003f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f930: 2020 2020 2020 2020 2066 756c 6c6d 6170           fullmap
+0003f940: 7061 7468 203d 2027 7b7d 7b7d 272e 666f  path = '{}{}'.fo
+0003f950: 726d 6174 2873 656c 662e 776f 726b 6469  rmat(self.workdi
+0003f960: 722c 2073 656c 662e 6d61 706e 616d 6529  r, self.mapname)
+0003f970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f980: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003f990: 2763 6370 656d 2720 6e6f 7420 696e 2050  'ccpem' not in P
+0003f9a0: 524f 5348 4144 4550 4154 483a 0a20 2020  ROSHADEPATH:.   
+0003f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f9c0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0003f9d0: 6d64 203d 206c 6973 7428 2850 524f 5348  md = list((PROSH
+0003f9e0: 4144 4550 4154 4820 2b20 2720 2d53 202d  ADEPATH + ' -S -
+0003f9f0: 6620 2720 2b20 7365 6c66 2e6d 6170 2e66  f ' + self.map.f
+0003fa00: 696c 656e 616d 6520 2b20 2720 2d73 2027  ilename + ' -s '
+0003fa10: 202b 2073 7472 2866 6c6f 6174 2873 656c   + str(float(sel
+0003fa20: 662e 7265 736f 6c75 7469 6f6e 2920 2a20  f.resolution) * 
+0003fa30: 7265 7366 6163 746f 7229 292e 7370 6c69  resfactor)).spli
+0003fa40: 7428 2720 2729 290a 2020 2020 2020 2020  t(' ')).        
+0003fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fa60: 2020 2020 2020 2020 636d 6420 3d20 6c69          cmd = li
+0003fa70: 7374 2828 5052 4f53 4841 4445 5041 5448  st((PROSHADEPATH
+0003fa80: 202b 2027 202d 5320 2d66 2027 202b 2073   + ' -S -f ' + s
+0003fa90: 656c 662e 6d61 702e 6675 6c6c 6e61 6d65  elf.map.fullname
+0003faa0: 202b 2027 202d 7320 2720 2b20 7374 7228   + ' -s ' + str(
+0003fab0: 666c 6f61 7428 7365 6c66 2e72 6573 6f6c  float(self.resol
+0003fac0: 7574 696f 6e29 202a 2072 6573 6661 6374  ution) * resfact
+0003fad0: 6f72 2929 2e73 706c 6974 2827 2027 2929  or)).split(' '))
+0003fae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fb00: 2070 7269 6e74 2863 6d64 290a 2020 2020   print(cmd).    
+0003fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fb20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 0003fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb40: 2020 6265 666f 7265 7368 6172 6520 3d20    beforeshare = 
-0003fb50: 272f 272e 6a6f 696e 2850 524f 5348 4144  '/'.join(PROSHAD
-0003fb60: 4550 4154 482e 7370 6c69 7428 272f 2729  EPATH.split('/')
-0003fb70: 5b3a 7368 6172 6569 6e64 6578 5d29 0a20  [:shareindex]). 
-0003fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003fba0: 7670 6174 6820 3d20 277b 7d2f 7368 6172  vpath = '{}/shar
-0003fbb0: 6527 2e66 6f72 6d61 7428 6265 666f 7265  e'.format(before
-0003fbc0: 7368 6172 6529 0a20 2020 2020 2020 2020  share).         
-0003fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fbe0: 2020 2020 2020 2023 2063 6d64 203d 206c         # cmd = l
-0003fbf0: 6973 7428 2850 524f 5348 4144 4550 4154  ist((PROSHADEPAT
-0003fc00: 4820 2b20 2720 2d53 202d 6620 2720 2b20  H + ' -S -f ' + 
-0003fc10: 7365 6c66 2e6d 6170 2e66 696c 656e 616d  self.map.filenam
-0003fc20: 6520 2b20 2720 2d73 2027 202b 2073 7472  e + ' -s ' + str
-0003fc30: 2866 6c6f 6174 2873 656c 662e 7265 736f  (float(self.reso
-0003fc40: 6c75 7469 6f6e 292a 312e 3529 202b 2027  lution)*1.5) + '
-0003fc50: 202d 2d72 7670 6174 6820 2720 2b20 7276   --rvpath ' + rv
-0003fc60: 7061 7468 292e 7370 6c69 7428 2720 2729  path).split(' ')
-0003fc70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fc90: 2020 636d 6420 3d20 6c69 7374 2828 5052    cmd = list((PR
-0003fca0: 4f53 4841 4445 5041 5448 202b 2027 202d  OSHADEPATH + ' -
-0003fcb0: 5320 2d66 2027 202b 2073 656c 662e 6d61  S -f ' + self.ma
-0003fcc0: 702e 6675 6c6c 6e61 6d65 202b 2027 202d  p.fullname + ' -
-0003fcd0: 7320 2720 2b20 7374 7228 666c 6f61 7428  s ' + str(float(
-0003fce0: 7365 6c66 2e72 6573 6f6c 7574 696f 6e29  self.resolution)
-0003fcf0: 202a 2031 2e30 2920 2b20 2720 2d2d 7276   * 1.0) + ' --rv
-0003fd00: 7061 7468 2027 202b 2072 7670 6174 6829  path ' + rvpath)
-0003fd10: 2e73 706c 6974 2827 2027 2929 0a20 2020  .split(' ')).   
-0003fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fd30: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0003fd40: 5379 6d6d 6574 7279 2063 6f6d 6d61 6e64  Symmetry command
-0003fd50: 3a20 7b7d 272e 666f 726d 6174 2827 2027  : {}'.format(' '
-0003fd60: 2e6a 6f69 6e28 636d 6429 2929 0a0a 2020  .join(cmd)))..  
-0003fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fd80: 2020 2020 2020 2020 2020 2320 7072 6f63            # proc
-0003fd90: 6573 7320 3d20 7375 6270 726f 6365 7373  ess = subprocess
-0003fda0: 2e50 6f70 656e 2863 6d64 2c20 7374 646f  .Popen(cmd, stdo
-0003fdb0: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
-0003fdc0: 5045 2c20 7374 6465 7272 3d73 7562 7072  PE, stderr=subpr
-0003fdd0: 6f63 6573 732e 5354 444f 5554 290a 2020  ocess.STDOUT).  
-0003fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fdf0: 2020 2020 2020 2020 2020 2320 636f 6465            # code
-0003fe00: 203d 2070 726f 6365 7373 2e77 6169 7428   = process.wait(
-0003fe10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0003fe20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0003fe30: 6f75 7470 7574 203d 2070 726f 6365 7373  output = process
-0003fe40: 2e73 7464 6f75 742e 7265 6164 2829 0a0a  .stdout.read()..
-0003fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fe60: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
-0003fe70: 6573 7320 3d20 7375 6270 726f 6365 7373  ess = subprocess
-0003fe80: 2e50 6f70 656e 2863 6d64 2c20 7374 646f  .Popen(cmd, stdo
-0003fe90: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
-0003fea0: 5045 2c20 7374 6465 7272 3d73 7562 7072  PE, stderr=subpr
-0003feb0: 6f63 6573 732e 5354 444f 5554 2c20 6377  ocess.STDOUT, cw
-0003fec0: 643d 7365 6c66 2e77 6f72 6b64 6972 290a  d=self.workdir).
-0003fed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fee0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-0003fef0: 7574 203d 2070 726f 6365 7373 2e63 6f6d  ut = process.com
-0003ff00: 6d75 6e69 6361 7465 2827 6e5c 6e27 295b  municate('n\n')[
-0003ff10: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-0003ff20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0003ff30: 7272 7072 6f73 6861 6465 203d 2027 2121  rrproshade = '!!
-0003ff40: 2120 5072 6f53 4841 4445 2045 5252 4f52  ! ProSHADE ERROR
-0003ff50: 2021 2121 270a 0a20 2020 2020 2020 2020   !!!'..         
+0003fb40: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+0003fb50: 6172 6569 6e64 6578 203d 205b 6964 7820  areindex = [idx 
+0003fb60: 666f 7220 6964 782c 2073 2069 6e20 656e  for idx, s in en
+0003fb70: 756d 6572 6174 6528 5052 4f53 4841 4445  umerate(PROSHADE
+0003fb80: 5041 5448 2e73 706c 6974 2827 2f27 2929  PATH.split('/'))
+0003fb90: 2069 6620 2763 6370 656d 2d27 2069 6e20   if 'ccpem-' in 
+0003fba0: 735d 5b30 5d20 2b20 310a 2020 2020 2020  s][0] + 1.      
+0003fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fbc0: 2020 2020 2020 2020 2020 6265 666f 7265            before
+0003fbd0: 7368 6172 6520 3d20 272f 272e 6a6f 696e  share = '/'.join
+0003fbe0: 2850 524f 5348 4144 4550 4154 482e 7370  (PROSHADEPATH.sp
+0003fbf0: 6c69 7428 272f 2729 5b3a 7368 6172 6569  lit('/')[:sharei
+0003fc00: 6e64 6578 5d29 0a20 2020 2020 2020 2020  ndex]).         
+0003fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fc20: 2020 2020 2020 2072 7670 6174 6820 3d20         rvpath = 
+0003fc30: 277b 7d2f 7368 6172 6527 2e66 6f72 6d61  '{}/share'.forma
+0003fc40: 7428 6265 666f 7265 7368 6172 6529 0a20  t(beforeshare). 
+0003fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fc60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003fc70: 2063 6d64 203d 206c 6973 7428 2850 524f   cmd = list((PRO
+0003fc80: 5348 4144 4550 4154 4820 2b20 2720 2d53  SHADEPATH + ' -S
+0003fc90: 202d 6620 2720 2b20 7365 6c66 2e6d 6170   -f ' + self.map
+0003fca0: 2e66 696c 656e 616d 6520 2b20 2720 2d73  .filename + ' -s
+0003fcb0: 2027 202b 2073 7472 2866 6c6f 6174 2873   ' + str(float(s
+0003fcc0: 656c 662e 7265 736f 6c75 7469 6f6e 292a  elf.resolution)*
+0003fcd0: 312e 3529 202b 2027 202d 2d72 7670 6174  1.5) + ' --rvpat
+0003fce0: 6820 2720 2b20 7276 7061 7468 292e 7370  h ' + rvpath).sp
+0003fcf0: 6c69 7428 2720 2729 290a 2020 2020 2020  lit(' ')).      
+0003fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fd10: 2020 2020 2020 2020 2020 636d 6420 3d20            cmd = 
+0003fd20: 6c69 7374 2828 5052 4f53 4841 4445 5041  list((PROSHADEPA
+0003fd30: 5448 202b 2027 202d 5320 2d66 2027 202b  TH + ' -S -f ' +
+0003fd40: 2073 656c 662e 6d61 702e 6675 6c6c 6e61   self.map.fullna
+0003fd50: 6d65 202b 2027 202d 7320 2720 2b20 7374  me + ' -s ' + st
+0003fd60: 7228 666c 6f61 7428 7365 6c66 2e72 6573  r(float(self.res
+0003fd70: 6f6c 7574 696f 6e29 202a 2031 2e30 2920  olution) * 1.0) 
+0003fd80: 2b20 2720 2d2d 7276 7061 7468 2027 202b  + ' --rvpath ' +
+0003fd90: 2072 7670 6174 6829 2e73 706c 6974 2827   rvpath).split('
+0003fda0: 2027 2929 0a20 2020 2020 2020 2020 2020   ')).           
+0003fdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fdc0: 2070 7269 6e74 2827 5379 6d6d 6574 7279   print('Symmetry
+0003fdd0: 2063 6f6d 6d61 6e64 3a20 7b7d 272e 666f   command: {}'.fo
+0003fde0: 726d 6174 2827 2027 2e6a 6f69 6e28 636d  rmat(' '.join(cm
+0003fdf0: 6429 2929 0a0a 2020 2020 2020 2020 2020  d)))..          
+0003fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fe10: 2020 2320 7072 6f63 6573 7320 3d20 7375    # process = su
+0003fe20: 6270 726f 6365 7373 2e50 6f70 656e 2863  bprocess.Popen(c
+0003fe30: 6d64 2c20 7374 646f 7574 3d73 7562 7072  md, stdout=subpr
+0003fe40: 6f63 6573 732e 5049 5045 2c20 7374 6465  ocess.PIPE, stde
+0003fe50: 7272 3d73 7562 7072 6f63 6573 732e 5354  rr=subprocess.ST
+0003fe60: 444f 5554 290a 2020 2020 2020 2020 2020  DOUT).          
+0003fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fe80: 2020 2320 636f 6465 203d 2070 726f 6365    # code = proce
+0003fe90: 7373 2e77 6169 7428 290a 2020 2020 2020  ss.wait().      
+0003fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003feb0: 2020 2020 2020 2320 6f75 7470 7574 203d        # output =
+0003fec0: 2070 726f 6365 7373 2e73 7464 6f75 742e   process.stdout.
+0003fed0: 7265 6164 2829 0a0a 2020 2020 2020 2020  read()..        
+0003fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fef0: 2020 2020 7072 6f63 6573 7320 3d20 7375      process = su
+0003ff00: 6270 726f 6365 7373 2e50 6f70 656e 2863  bprocess.Popen(c
+0003ff10: 6d64 2c20 7374 646f 7574 3d73 7562 7072  md, stdout=subpr
+0003ff20: 6f63 6573 732e 5049 5045 2c20 7374 6465  ocess.PIPE, stde
+0003ff30: 7272 3d73 7562 7072 6f63 6573 732e 5354  rr=subprocess.ST
+0003ff40: 444f 5554 2c20 6377 643d 7365 6c66 2e77  DOUT, cwd=self.w
+0003ff50: 6f72 6b64 6972 290a 2020 2020 2020 2020  orkdir).        
 0003ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ff70: 2020 2023 2046 6f72 2070 7974 686f 6e33     # For python3
-0003ff80: 206d 6967 7261 7469 6f6e 2074 6f20 7079   migration to py
-0003ff90: 7468 6f6e 3320 7769 7468 2064 6563 6f64  thon3 with decod
-0003ffa0: 6520 7072 6f62 6c65 6d20 6f66 2073 7472  e problem of str
-0003ffb0: 696e 6720 746f 2062 7974 6573 0a20 2020  ing to bytes.   
-0003ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ffd0: 2020 2020 2020 2020 2069 6620 7379 732e           if sys.
-0003ffe0: 7665 7273 696f 6e5f 696e 666f 5b30 5d20  version_info[0] 
-0003fff0: 3e3d 2033 3a0a 2020 2020 2020 2020 2020  >= 3:.          
-00040000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040010: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
-00040020: 6e20 6f75 7470 7574 2e64 6563 6f64 6528  n output.decode(
-00040030: 2775 7466 2d38 2729 2e73 706c 6974 2827  'utf-8').split('
-00040040: 5c6e 2729 3a0a 2020 2020 2020 2020 2020  \n'):.          
+0003ff70: 2020 2020 6f75 7470 7574 203d 2070 726f      output = pro
+0003ff80: 6365 7373 2e63 6f6d 6d75 6e69 6361 7465  cess.communicate
+0003ff90: 2827 6e5c 6e27 295b 305d 0a20 2020 2020  ('n\n')[0].     
+0003ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ffb0: 2020 2020 2020 2065 7272 7072 6f73 6861         errprosha
+0003ffc0: 6465 203d 2027 2121 2120 5072 6f53 4841  de = '!!! ProSHA
+0003ffd0: 4445 2045 5252 4f52 2021 2121 270a 0a20  DE ERROR !!!'.. 
+0003ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fff0: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
+00040000: 2070 7974 686f 6e33 206d 6967 7261 7469   python3 migrati
+00040010: 6f6e 2074 6f20 7079 7468 6f6e 3320 7769  on to python3 wi
+00040020: 7468 2064 6563 6f64 6520 7072 6f62 6c65  th decode proble
+00040030: 6d20 6f66 2073 7472 696e 6720 746f 2062  m of string to b
+00040040: 7974 6573 0a20 2020 2020 2020 2020 2020  ytes.           
 00040050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040060: 2020 2020 2020 2020 2020 2320 6974 656d            # item
-00040070: 203d 2063 6c69 6e65 2e64 6563 6f64 6528   = cline.decode(
-00040080: 2775 7466 2d38 2729 2e73 7472 6970 2829  'utf-8').strip()
-00040090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000400a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000400b0: 2020 2020 2070 7269 6e74 2869 7465 6d29       print(item)
-000400c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040060: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
+00040070: 696e 666f 5b30 5d20 3e3d 2033 3a0a 2020  info[0] >= 3:.  
+00040080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040090: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000400a0: 7220 6974 656d 2069 6e20 6f75 7470 7574  r item in output
+000400b0: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
+000400c0: 2e73 706c 6974 2827 5c6e 2729 3a0a 2020  .split('\n'):.  
 000400d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000400e0: 2020 2020 2069 6620 6572 7270 726f 7368       if errprosh
-000400f0: 6164 6520 696e 2069 7465 6d3a 0a20 2020  ade in item:.   
-00040100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040120: 2020 2020 2065 7272 6c69 6e65 203d 2069       errline = i
-00040130: 7465 6d2e 7374 7269 7028 290a 2020 2020  tem.strip().    
-00040140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000400e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000400f0: 2020 2320 6974 656d 203d 2063 6c69 6e65    # item = cline
+00040100: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
+00040110: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00040120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040130: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00040140: 6e74 2869 7465 6d29 0a20 2020 2020 2020  nt(item).       
 00040150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040160: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
-00040170: 6e64 2865 7272 6c69 6e65 290a 2020 2020  nd(errline).    
-00040180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040160: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00040170: 6572 7270 726f 7368 6164 6520 696e 2069  errproshade in i
+00040180: 7465 6d3a 0a20 2020 2020 2020 2020 2020  tem:.           
 00040190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000401a0: 2020 2020 6173 7365 7274 2065 7272 7072      assert errpr
-000401b0: 6f73 6861 6465 206e 6f74 2069 6e20 6f75  oshade not in ou
-000401c0: 7470 7574 2e64 6563 6f64 6528 2775 7466  tput.decode('utf
-000401d0: 2d38 2729 2c20 6572 726c 696e 650a 2020  -8'), errline.  
-000401e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000401f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00040200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000401a0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+000401b0: 6c69 6e65 203d 2069 7465 6d2e 7374 7269  line = item.stri
+000401c0: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+000401d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000401e0: 2020 2020 2020 2020 2020 2020 6572 726c              errl
+000401f0: 6973 742e 6170 7065 6e64 2865 7272 6c69  ist.append(errli
+00040200: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
 00040210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040220: 666f 7220 6974 656d 2069 6e20 6f75 7470  for item in outp
-00040230: 7574 2e73 706c 6974 2827 5c6e 2729 3a0a  ut.split('\n'):.
-00040240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040260: 2020 2020 7072 696e 7428 6974 656d 290a      print(item).
+00040220: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00040230: 7274 2065 7272 7072 6f73 6861 6465 206e  rt errproshade n
+00040240: 6f74 2069 6e20 6f75 7470 7574 2e64 6563  ot in output.dec
+00040250: 6f64 6528 2775 7466 2d38 2729 2c20 6572  ode('utf-8'), er
+00040260: 726c 696e 650a 2020 2020 2020 2020 2020  rline.          
 00040270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040290: 2020 2020 6966 2065 7272 7072 6f73 6861      if errprosha
-000402a0: 6465 2069 6e20 6974 656d 3a0a 2020 2020  de in item:.    
-000402b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000402c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000402d0: 2020 2020 6572 726c 696e 6520 3d20 6974      errline = it
-000402e0: 656d 2e73 7472 6970 2829 0a20 2020 2020  em.strip().     
-000402f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040280: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00040290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000402a0: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+000402b0: 2069 6e20 6f75 7470 7574 2e73 706c 6974   in output.split
+000402c0: 2827 5c6e 2729 3a0a 2020 2020 2020 2020  ('\n'):.        
+000402d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000402e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000402f0: 7428 6974 656d 290a 2020 2020 2020 2020  t(item).        
 00040300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040310: 2020 2065 7272 6c69 7374 2e61 7070 656e     errlist.appen
-00040320: 6428 6572 726c 696e 6529 0a20 2020 2020  d(errline).     
-00040330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040310: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00040320: 7272 7072 6f73 6861 6465 2069 6e20 6974  rrproshade in it
+00040330: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
 00040340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040350: 2020 2061 7373 6572 7420 6572 7270 726f     assert errpro
-00040360: 7368 6164 6520 6e6f 7420 696e 206f 7574  shade not in out
-00040370: 7075 742e 6465 636f 6465 2827 7574 662d  put.decode('utf-
-00040380: 3827 292c 2065 7272 6c69 6e65 0a0a 2020  8'), errline..  
-00040390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000403a0: 2020 2020 2020 2020 2020 7072 6f73 6861            prosha
-000403b0: 6465 666f 6c64 6572 203d 2073 656c 662e  defolder = self.
-000403c0: 776f 726b 6469 7220 2b20 2770 726f 7368  workdir + 'prosh
-000403d0: 6164 655f 7265 706f 7274 270a 2020 2020  ade_report'.    
-000403e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000403f0: 2020 2020 2020 2020 7379 6d5f 7461 626c          sym_tabl
-00040400: 6573 203d 2027 7b7d 2f2a 2e74 6162 6c65  es = '{}/*.table
-00040410: 272e 666f 726d 6174 2870 726f 7368 6164  '.format(proshad
-00040420: 6566 6f6c 6465 7229 0a20 2020 2020 2020  efolder).       
-00040430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040440: 2020 2020 206e 6669 6c65 696e 7072 6f73       nfileinpros
-00040450: 6861 6465 203d 206c 656e 285b 6620 666f  hade = len([f fo
-00040460: 7220 6620 696e 2067 6c6f 622e 676c 6f62  r f in glob.glob
-00040470: 2873 796d 5f74 6162 6c65 7329 5d29 0a20  (sym_tables)]). 
-00040480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040490: 2020 2020 2020 2020 2020 2023 206e 6669             # nfi
-000404a0: 6c65 696e 7072 6f73 6861 6465 203d 206c  leinproshade = l
-000404b0: 656e 285b 6620 666f 7220 6620 696e 206f  en([f for f in o
-000404c0: 732e 6c69 7374 6469 7228 7072 6f73 6861  s.listdir(prosha
-000404d0: 6465 666f 6c64 6572 2920 6966 206f 732e  defolder) if os.
-000404e0: 7061 7468 2e69 7366 696c 6528 6f73 2e70  path.isfile(os.p
-000404f0: 6174 682e 6a6f 696e 2870 726f 7368 6164  ath.join(proshad
-00040500: 6566 6f6c 6465 722c 2066 2929 5d29 0a20  efolder, f))]). 
+00040350: 2020 2020 2020 2020 2020 2020 6572 726c              errl
+00040360: 696e 6520 3d20 6974 656d 2e73 7472 6970  ine = item.strip
+00040370: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00040380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040390: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+000403a0: 7374 2e61 7070 656e 6428 6572 726c 696e  st.append(errlin
+000403b0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000403c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000403d0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+000403e0: 7420 6572 7270 726f 7368 6164 6520 6e6f  t errproshade no
+000403f0: 7420 696e 206f 7574 7075 742e 6465 636f  t in output.deco
+00040400: 6465 2827 7574 662d 3827 292c 2065 7272  de('utf-8'), err
+00040410: 6c69 6e65 0a0a 2020 2020 2020 2020 2020  line..          
+00040420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040430: 2020 7072 6f73 6861 6465 666f 6c64 6572    proshadefolder
+00040440: 203d 2073 656c 662e 776f 726b 6469 7220   = self.workdir 
+00040450: 2b20 2770 726f 7368 6164 655f 7265 706f  + 'proshade_repo
+00040460: 7274 270a 2020 2020 2020 2020 2020 2020  rt'.            
+00040470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040480: 7379 6d5f 7461 626c 6573 203d 2027 7b7d  sym_tables = '{}
+00040490: 2f2a 2e74 6162 6c65 272e 666f 726d 6174  /*.table'.format
+000404a0: 2870 726f 7368 6164 6566 6f6c 6465 7229  (proshadefolder)
+000404b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000404c0: 2020 2020 2020 2020 2020 2020 206e 6669               nfi
+000404d0: 6c65 696e 7072 6f73 6861 6465 203d 206c  leinproshade = l
+000404e0: 656e 285b 6620 666f 7220 6620 696e 2067  en([f for f in g
+000404f0: 6c6f 622e 676c 6f62 2873 796d 5f74 6162  lob.glob(sym_tab
+00040500: 6c65 7329 5d29 0a20 2020 2020 2020 2020  les)]).         
 00040510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040520: 2020 2020 2020 2020 2020 2069 6620 6e66             if nf
-00040530: 696c 6569 6e70 726f 7368 6164 6520 3e3d  ileinproshade >=
-00040540: 2033 3a0a 2020 2020 2020 2020 2020 2020   3:.            
-00040550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040560: 2020 2020 7379 6d6d 6574 7279 5265 7320      symmetryRes 
-00040570: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00040580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040590: 2020 2023 2073 706c 7374 7220 3d20 2752     # splstr = 'R
-000405a0: 4553 554c 5453 270a 2020 2020 2020 2020  ESULTS'.        
-000405b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000405c0: 2020 2020 2320 6f75 7470 7574 7370 6c20      # outputspl 
-000405d0: 3d20 6f75 7470 7574 2e73 706c 6974 2827  = output.split('
-000405e0: 4465 7465 6374 6564 2043 7963 6c69 6320  Detected Cyclic 
-000405f0: 7379 6d6d 6574 7279 272c 2031 290a 2020  symmetry', 1).  
+00040520: 2020 2023 206e 6669 6c65 696e 7072 6f73     # nfileinpros
+00040530: 6861 6465 203d 206c 656e 285b 6620 666f  hade = len([f fo
+00040540: 7220 6620 696e 206f 732e 6c69 7374 6469  r f in os.listdi
+00040550: 7228 7072 6f73 6861 6465 666f 6c64 6572  r(proshadefolder
+00040560: 2920 6966 206f 732e 7061 7468 2e69 7366  ) if os.path.isf
+00040570: 696c 6528 6f73 2e70 6174 682e 6a6f 696e  ile(os.path.join
+00040580: 2870 726f 7368 6164 6566 6f6c 6465 722c  (proshadefolder,
+00040590: 2066 2929 5d29 0a20 2020 2020 2020 2020   f))]).         
+000405a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000405b0: 2020 2069 6620 6e66 696c 6569 6e70 726f     if nfileinpro
+000405c0: 7368 6164 6520 3e3d 2033 3a0a 2020 2020  shade >= 3:.    
+000405d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000405e0: 2020 2020 2020 2020 2020 2020 7379 6d6d              symm
+000405f0: 6574 7279 5265 7320 3d20 5472 7565 0a20  etryRes = True. 
 00040600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040610: 2020 2020 2020 2020 2020 2320 6f75 7470            # outp
-00040620: 7574 7370 6c20 3d20 7265 2e73 706c 6974  utspl = re.split
-00040630: 2827 5245 5355 4c54 5327 2c20 6f75 7470  ('RESULTS', outp
-00040640: 7574 2e64 6563 6f64 6528 2929 0a20 2020  ut.decode()).   
-00040650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040660: 2020 2020 2020 2020 2023 2069 6620 7370           # if sp
-00040670: 6c73 7472 2069 6e20 6f75 7470 7574 2e64  lstr in output.d
-00040680: 6563 6f64 6528 293a 0a20 2020 2020 2020  ecode():.       
+00040610: 2020 2020 2020 2020 2020 2023 2073 706c             # spl
+00040620: 7374 7220 3d20 2752 4553 554c 5453 270a  str = 'RESULTS'.
+00040630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040640: 2020 2020 2020 2020 2020 2020 2320 6f75              # ou
+00040650: 7470 7574 7370 6c20 3d20 6f75 7470 7574  tputspl = output
+00040660: 2e73 706c 6974 2827 4465 7465 6374 6564  .split('Detected
+00040670: 2043 7963 6c69 6320 7379 6d6d 6574 7279   Cyclic symmetry
+00040680: 272c 2031 290a 2020 2020 2020 2020 2020  ', 1).          
 00040690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000406a0: 2020 2020 2023 2020 2020 2070 7269 6e74       #     print
-000406b0: 286f 7574 7075 7473 706c 5b31 5d29 0a20  (outputspl[1]). 
-000406c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000406d0: 2020 2020 2020 2020 2020 2023 2065 6c73             # els
-000406e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000406f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00040700: 2020 2020 2070 7269 6e74 286f 7574 7075       print(outpu
-00040710: 7473 706c 5b30 5d29 0a0a 2020 2020 2020  tspl[0])..      
-00040720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040730: 2020 2020 2020 2320 7365 6c66 2e6d 6f76        # self.mov
-00040740: 6570 726f 7368 6164 6552 6573 756c 7428  eproshadeResult(
-00040750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00040760: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00040770: 6420 3d20 7469 6d65 6974 2e64 6566 6175  d = timeit.defau
-00040780: 6c74 5f74 696d 6572 2829 0a20 2020 2020  lt_timer().     
-00040790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000407a0: 2020 2020 2020 2070 7269 6e74 2827 5379         print('Sy
-000407b0: 6d6d 6574 7279 2074 696d 653a 2025 7327  mmetry time: %s'
-000407c0: 2025 2028 656e 6420 2d20 7374 6172 7429   % (end - start)
-000407d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000407e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000407f0: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
-00040800: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00040810: 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020 2020  ---------').    
-00040820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040830: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00040840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040850: 2020 2020 2020 2020 6572 7220 3d20 2753          err = 'S
-00040860: 796d 6d65 7472 7920 6361 6c63 756c 6174  ymmetry calculat
-00040870: 696f 6e20 6572 726f 723a 207b 7d2e 272e  ion error: {}.'.
-00040880: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
-00040890: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
-000408a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000408b0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
-000408c0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+000406a0: 2020 2320 6f75 7470 7574 7370 6c20 3d20    # outputspl = 
+000406b0: 7265 2e73 706c 6974 2827 5245 5355 4c54  re.split('RESULT
+000406c0: 5327 2c20 6f75 7470 7574 2e64 6563 6f64  S', output.decod
+000406d0: 6528 2929 0a20 2020 2020 2020 2020 2020  e()).           
+000406e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000406f0: 2023 2069 6620 7370 6c73 7472 2069 6e20   # if splstr in 
+00040700: 6f75 7470 7574 2e64 6563 6f64 6528 293a  output.decode():
+00040710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040720: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00040730: 2020 2070 7269 6e74 286f 7574 7075 7473     print(outputs
+00040740: 706c 5b31 5d29 0a20 2020 2020 2020 2020  pl[1]).         
+00040750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040760: 2020 2023 2065 6c73 653a 0a20 2020 2020     # else:.     
+00040770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040780: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
+00040790: 6e74 286f 7574 7075 7473 706c 5b30 5d29  nt(outputspl[0])
+000407a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000407b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000407c0: 7365 6c66 2e6d 6f76 6570 726f 7368 6164  self.moveproshad
+000407d0: 6552 6573 756c 7428 290a 2020 2020 2020  eResult().      
+000407e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000407f0: 2020 2020 2020 656e 6420 3d20 7469 6d65        end = time
+00040800: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
+00040810: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00040820: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00040830: 7269 6e74 2827 5379 6d6d 6574 7279 2074  rint('Symmetry t
+00040840: 696d 653a 2025 7327 2025 2028 656e 6420  ime: %s' % (end 
+00040850: 2d20 7374 6172 7429 290a 2020 2020 2020  - start)).      
+00040860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040870: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
+00040880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00040890: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000408a0: 2d27 290a 2020 2020 2020 2020 2020 2020  -').            
+000408b0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+000408c0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
 000408d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000408e0: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-000408f0: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
-00040900: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00040910: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00040920: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
-00040930: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00040940: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020  ----------')..  
-00040950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040960: 2020 2020 2020 6966 2065 7272 6c69 7374        if errlist
-00040970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00040980: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00040990: 6e61 6c64 6963 745b 2773 796d 6d65 7472  naldict['symmetr
-000409a0: 7927 5d20 3d20 7b27 6572 7227 3a20 7b27  y'] = {'err': {'
-000409b0: 7379 6d6d 6574 7279 5f65 7272 273a 2065  symmetry_err': e
-000409c0: 7272 6c69 7374 7d7d 0a20 2020 2020 2020  rrlist}}.       
-000409d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000409e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000409f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040a00: 2020 2066 696e 616c 6469 6374 5b27 7379     finaldict['sy
-00040a10: 6d6d 6574 7279 275d 203d 207b 2773 796d  mmetry'] = {'sym
-00040a20: 6d65 7472 795f 696e 666f 273a 2073 796d  metry_info': sym
-00040a30: 6d65 7472 7952 6573 7d0a 0a20 2020 2020  metryRes}..     
-00040a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040a50: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00040a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040a70: 2020 2020 7769 7468 2063 6f64 6563 732e      with codecs.
-00040a80: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
-00040a90: 7220 2b20 7365 6c66 2e6d 6170 6e61 6d65  r + self.mapname
-00040aa0: 202b 2027 5f73 796d 6d65 7472 792e 6a73   + '_symmetry.js
-00040ab0: 6f6e 272c 2027 7727 2c0a 2020 2020 2020  on', 'w',.      
-00040ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ae0: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
-00040af0: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
-00040b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040b10: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-00040b20: 736f 6e2e 6475 6d70 2866 696e 616c 6469  son.dump(finaldi
-00040b30: 6374 2c20 6629 0a20 2020 2020 2020 2020  ct, f).         
-00040b40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00040b50: 7863 6570 7420 494f 4572 726f 7220 6173  xcept IOError as
-00040b60: 2069 6f65 7272 3a0a 2020 2020 2020 2020   ioerr:.        
-00040b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040b80: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00040b90: 7269 7465 2827 5361 7669 6e67 2073 796d  rite('Saving sym
-00040ba0: 6d65 7472 7920 696e 666f 726d 6174 696f  metry informatio
-00040bb0: 6e20 746f 206a 736f 6e20 6572 723a 207b  n to json err: {
-00040bc0: 7d2e 5c6e 272e 666f 726d 6174 2869 6f65  }.\n'.format(ioe
-00040bd0: 7272 2929 0a0a 0a0a 2020 2020 2020 2020  rr))....        
-00040be0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00040bf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00040c00: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-00040c10: 6465 7272 2e77 7269 7465 2827 5072 6f73  derr.write('Pros
-00040c20: 6861 6465 2069 7320 6e6f 7420 696e 7374  hade is not inst
-00040c30: 616c 6c65 642e 2054 6865 7265 2077 696c  alled. There wil
-00040c40: 6c20 6265 206e 6f20 7379 6d6d 6574 7279  l be no symmetry
-00040c50: 2069 6e66 6f72 6d61 7469 6f6e 2e5c 6e27   information.\n'
-00040c60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00040c70: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00040c80: 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '---------------
-00040c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00040ca0: 2d2d 2d2d 2d27 290a 0a20 2020 2020 2020  -----')..       
-00040cb0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00040cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040cd0: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
-00040ce0: 6974 6528 2754 6869 7320 6973 2061 207b  ite('This is a {
-00040cf0: 7d20 656e 7472 792c 2073 796d 6d65 7472  } entry, symmetr
-00040d00: 7920 7769 6c6c 206e 6f74 2062 6520 6361  y will not be ca
-00040d10: 6c63 756c 6174 6564 2e5c 6e27 2e66 6f72  lculated.\n'.for
-00040d20: 6d61 7428 7365 6c66 2e6d 6574 2929 0a20  mat(self.met)). 
-00040d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040d40: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
-00040d50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00040d60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-00040d70: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00040d80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00040d90: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00040da0: 7269 7465 2827 454d 206d 6574 686f 6420  rite('EM method 
-00040db0: 616e 6420 7265 736f 6c75 7469 6f6e 206e  and resolution n
-00040dc0: 6565 6465 6420 746f 2063 616c 6375 6c61  eeded to calcula
-00040dd0: 7465 6420 7379 6d6d 6574 7279 2069 6e66  ted symmetry inf
-00040de0: 6f72 6d61 7469 6f6e 215c 6e27 290a 2020  ormation!\n').  
-00040df0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00040e00: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
-00040e10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00040e20: 2d2d 2d2d 2d2d 2d2d 2d27 290a 0a20 2020  ---------')..   
-00040e30: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00040e40: 0a0a 2020 2020 2320 512d 7363 6f72 6520  ..    # Q-score 
-00040e50: 7265 6c61 7465 6420 7374 6172 7465 6420  related started 
-00040e60: 6672 6f6d 2068 6572 650a 2020 2020 6465  from here.    de
-00040e70: 6620 6f63 6869 6d65 7261 6368 6563 6b28  f ochimeracheck(
-00040e80: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00040e90: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-00040ea0: 4368 6563 6b20 7768 6572 6520 6973 206f  Check where is o
-00040eb0: 6c64 2043 6869 6d65 7261 206e 6f74 2066  ld Chimera not f
-00040ec0: 6f72 2043 6869 6d65 7261 580a 0a20 2020  or ChimeraX..   
-00040ed0: 2020 2020 203a 7265 7475 726e 3a20 7468       :return: th
-00040ee0: 6520 7061 7468 206f 6620 6f6c 6420 4368  e path of old Ch
-00040ef0: 696d 6572 6120 6f72 204e 6f6e 6520 7769  imera or None wi
-00040f00: 7468 206e 6f20 4368 696d 6572 610a 2020  th no Chimera.  
-00040f10: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00040f20: 2020 206f 6368 696d 6572 6161 7070 203d     ochimeraapp =
-00040f30: 204e 6f6e 650a 2020 2020 2020 2020 7472   None.        tr
-00040f40: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
-00040f50: 6620 4f43 4849 4d45 5241 2069 7320 6e6f  f OCHIMERA is no
-00040f60: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00040f70: 2020 2020 2020 2020 6f63 6869 6d65 7261          ochimera
-00040f80: 6170 7020 3d20 4f43 4849 4d45 5241 0a20  app = OCHIMERA. 
-00040f90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00040fa0: 7269 6e74 2827 4368 696d 6572 613a 207b  rint('Chimera: {
-00040fb0: 7d27 2e66 6f72 6d61 7428 6f63 6869 6d65  }'.format(ochime
-00040fc0: 7261 6170 7029 290a 2020 2020 2020 2020  raapp)).        
-00040fd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00040fe0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00040ff0: 2066 696e 645f 6578 6563 7574 6162 6c65   find_executable
-00041000: 2827 6368 696d 6572 6127 2920 6973 206e  ('chimera') is n
-00041010: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00041020: 2020 2020 2020 2020 6f63 6869 6d65 7261          ochimera
-00041030: 6170 7020 3d20 6669 6e64 5f65 7865 6375  app = find_execu
-00041040: 7461 626c 6528 2763 6869 6d65 7261 2729  table('chimera')
-00041050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041060: 2070 7269 6e74 2827 4368 696d 6572 613a   print('Chimera:
-00041070: 207b 7d27 2e66 6f72 6d61 7428 6f63 6869   {}'.format(ochi
-00041080: 6d65 7261 6170 7029 290a 0a20 2020 2020  meraapp))..     
-00041090: 2020 2065 7863 6570 7420 4173 7365 7274     except Assert
-000410a0: 696f 6e45 7272 6f72 3a0a 2020 2020 2020  ionError:.      
-000410b0: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-000410c0: 2e77 7269 7465 2827 4368 696d 6572 6158  .write('ChimeraX
-000410d0: 2065 7865 6375 7461 626c 6520 6973 206e   executable is n
-000410e0: 6f74 2074 6865 7265 2e5c 6e27 290a 0a20  ot there.\n').. 
-000410f0: 2020 2020 2020 2072 6574 7572 6e20 6f63         return oc
-00041100: 6869 6d65 7261 6170 700a 0a20 2020 2064  himeraapp..    d
-00041110: 6566 2063 6865 636b 7173 636f 7265 2873  ef checkqscore(s
-00041120: 656c 662c 206f 6368 696d 6572 6161 7070  elf, ochimeraapp
-00041130: 293a 0a0a 2020 2020 2020 2020 2222 220a  ):..        """.
-00041140: 0a20 2020 2020 2020 2020 2020 2043 6865  .            Che
-00041150: 636b 2069 6620 5173 636f 7265 2069 7320  ck if Qscore is 
-00041160: 7072 6f70 6572 6c79 2069 6e73 7461 6c6c  properly install
-00041170: 6564 0a0a 2020 2020 2020 2020 3a72 6574  ed..        :ret
-00041180: 7572 6e3a 2051 7363 6f72 6520 6669 6c65  urn: Qscore file
-00041190: 2066 756c 6c20 7061 7468 206f 7220 4e6f   full path or No
-000411a0: 6e65 0a20 2020 2020 2020 2022 2222 0a0a  ne.        """..
-000411b0: 2020 2020 2020 2020 7173 636f 7265 6170          qscoreap
-000411c0: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
-000411d0: 2069 6620 6f63 6869 6d65 7261 6170 703a   if ochimeraapp:
-000411e0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-000411f0: 6865 636b 2069 6620 6f63 6869 6d65 7261  heck if ochimera
-00041200: 6170 7020 6973 2061 2073 796d 626f 6c69  app is a symboli
-00041210: 6320 6c69 6e6b 0a20 2020 2020 2020 2020  c link.         
-00041220: 2020 2069 6620 6f73 2e70 6174 682e 6973     if os.path.is
-00041230: 6c69 6e6b 286f 6368 696d 6572 6161 7070  link(ochimeraapp
-00041240: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00041250: 2020 2072 6561 6c63 6869 6d65 7261 6170     realchimeraap
-00041260: 7020 3d20 6f73 2e70 6174 682e 7265 616c  p = os.path.real
-00041270: 7061 7468 2870 6174 6829 0a20 2020 2020  path(path).     
-00041280: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00041290: 2020 2020 2020 2020 2020 2020 2072 6561               rea
-000412a0: 6c63 6869 6d65 7261 6170 7020 3d20 6f63  lchimeraapp = oc
-000412b0: 6869 6d65 7261 6170 700a 0a20 2020 2020  himeraapp..     
-000412c0: 2020 2020 2020 2069 6620 2743 6f6e 7465         if 'Conte
-000412d0: 6e74 2720 696e 2072 6561 6c63 6869 6d65  nt' in realchime
-000412e0: 7261 6170 703a 0a20 2020 2020 2020 2020  raapp:.         
-000412f0: 2020 2020 2020 2076 6f72 636f 6e74 656e         vorconten
-00041300: 7420 3d20 6f63 6869 6d65 7261 6170 702e  t = ochimeraapp.
-00041310: 7370 6c69 7428 2743 6f6e 7465 6e74 2729  split('Content')
-00041320: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00041330: 2020 2020 6d61 7071 203d 2076 6f72 636f      mapq = vorco
-00041340: 6e74 656e 7420 2b20 2743 6f6e 7465 6e74  ntent + 'Content
-00041350: 732f 5265 736f 7572 6365 732f 7368 6172  s/Resources/shar
-00041360: 652f 6d61 7071 2f6d 6170 715f 636d 642e  e/mapq/mapq_cmd.
-00041370: 7079 270a 2020 2020 2020 2020 2020 2020  py'.            
-00041380: 2020 2020 7173 636f 7265 6170 7020 3d20      qscoreapp = 
-00041390: 6d61 7071 2069 6620 6f73 2e70 6174 682e  mapq if os.path.
-000413a0: 6973 6669 6c65 286d 6170 7129 2065 6c73  isfile(mapq) els
-000413b0: 6520 4e6f 6e65 0a20 2020 2020 2020 2020  e None.         
-000413c0: 2020 2065 6c69 6620 2762 696e 2720 696e     elif 'bin' in
-000413d0: 2072 6561 6c63 6869 6d65 7261 6170 703a   realchimeraapp:
-000413e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000413f0: 2076 6f72 636f 6e74 656e 7420 3d20 6f63   vorcontent = oc
-00041400: 6869 6d65 7261 6170 702e 7370 6c69 7428  himeraapp.split(
-00041410: 2762 696e 2729 5b30 5d0a 2020 2020 2020  'bin')[0].      
-00041420: 2020 2020 2020 2020 2020 6d61 7071 203d            mapq =
-00041430: 2076 6f72 636f 6e74 656e 7420 2b20 2773   vorcontent + 's
-00041440: 6861 7265 2f6d 6170 712f 6d61 7071 5f63  hare/mapq/mapq_c
-00041450: 6d64 2e70 7927 0a20 2020 2020 2020 2020  md.py'.         
-00041460: 2020 2020 2020 2071 7363 6f72 6561 7070         qscoreapp
-00041470: 203d 206d 6170 7120 6966 206f 732e 7061   = mapq if os.pa
-00041480: 7468 2e69 7366 696c 6528 6d61 7071 2920  th.isfile(mapq) 
-00041490: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
-000414a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000414b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000414c0: 7428 2743 6869 6d65 7261 2069 7320 6e6f  t('Chimera is no
-000414d0: 7420 6769 7665 6e20 696e 2061 2070 726f  t given in a pro
-000414e0: 7065 7220 6578 6563 7574 6162 6c65 206f  per executable o
-000414f0: 7220 7379 6d62 6f6c 6963 206c 696e 6b20  r symbolic link 
-00041500: 666f 726d 6174 2e27 290a 2020 2020 2020  format.').      
-00041510: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00041520: 2020 2020 7072 696e 7428 2743 6869 6d65      print('Chime
-00041530: 7261 2077 6173 206e 6f74 2066 6f75 6e64  ra was not found
-00041540: 2e27 290a 0a20 2020 2020 2020 2072 6574  .')..        ret
-00041550: 7572 6e20 7173 636f 7265 6170 700a 0a20  urn qscoreapp.. 
-00041560: 2020 2064 6566 2061 746f 6d5f 6e75 6d62     def atom_numb
-00041570: 6572 7328 7365 6c66 2c20 6d6f 6465 6c5f  ers(self, model_
-00041580: 6669 6c65 6e61 6d65 293a 0a20 2020 2020  filename):.     
-00041590: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
-000415a0: 2020 2047 6574 2074 6865 206e 756d 6265     Get the numbe
-000415b0: 7220 6f66 2061 746f 6d73 2069 6e20 7468  r of atoms in th
-000415c0: 6520 6d6f 6465 6c0a 2020 2020 2020 2020  e model.        
-000415d0: 3a70 6172 616d 206d 6f64 656c 5f66 696c  :param model_fil
-000415e0: 656e 616d 653a 2073 7472 696e 6720 6f66  ename: string of
-000415f0: 2066 756c 6c20 6d6f 6465 6c20 6e61 6d65   full model name
-00041600: 2077 6974 6820 7061 7468 0a20 2020 2020   with path.     
-00041610: 2020 203a 7265 7475 726e 3a20 696e 7465     :return: inte
-00041620: 6765 7220 6f66 206e 756d 6265 7220 6f66  ger of number of
-00041630: 2061 746f 6d73 0a20 2020 2020 2020 2022   atoms.        "
-00041640: 2222 0a0a 2020 2020 2020 2020 7061 7273  ""..        pars
-00041650: 6572 203d 204d 4d43 4946 5061 7273 6572  er = MMCIFParser
-00041660: 2829 0a20 2020 2020 2020 2073 7472 7563  ().        struc
-00041670: 7475 7265 203d 2070 6172 7365 722e 6765  ture = parser.ge
-00041680: 745f 7374 7275 6374 7572 6528 2774 272c  t_structure('t',
-00041690: 206d 6f64 656c 5f66 696c 656e 616d 6529   model_filename)
-000416a0: 0a20 2020 2020 2020 2061 746f 6d73 203d  .        atoms =
-000416b0: 2073 7472 7563 7475 7265 2e67 6574 5f61   structure.get_a
-000416c0: 746f 6d73 2829 0a0a 2020 2020 2020 2020  toms()..        
-000416d0: 7265 7475 726e 2073 756d 2831 2066 6f72  return sum(1 for
-000416e0: 205f 2069 6e20 6174 6f6d 7329 0a0a 0a0a   _ in atoms)....
-000416f0: 2020 2020 6465 6620 7173 636f 7265 5f62      def qscore_b
-00041700: 6172 2873 656c 6629 3a0a 0a20 2020 2020  ar(self):..     
-00041710: 2020 2069 6620 6e6f 7420 7365 6c66 2e6f     if not self.o
-00041720: 6e6c 7962 6172 3a0a 2020 2020 2020 2020  nlybar:.        
-00041730: 2020 2020 7365 6c66 2e71 7363 6f72 6528      self.qscore(
-00041740: 290a 2020 2020 2020 2020 7365 6c66 2e67  ).        self.g
-00041750: 6574 5f62 6172 2873 636f 7265 5f74 7970  et_bar(score_typ
-00041760: 653d 2771 7363 6f72 6527 290a 0a20 2020  e='qscore')..   
-00041770: 2023 2040 7072 6f66 696c 650a 2020 2020   # @profile.    
-00041780: 6465 6620 7173 636f 7265 2873 656c 6629  def qscore(self)
-00041790: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
-000417a0: 2020 2020 2020 2020 2020 2043 616c 6375             Calcu
-000417b0: 6c61 7465 2051 2d73 636f 7265 0a0a 2020  late Q-score..  
-000417c0: 2020 2020 2020 3a72 6574 7572 6e3a 0a20        :return:. 
-000417d0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000417e0: 2020 2020 6572 726c 6973 7420 3d20 5b5d      errlist = []
-000417f0: 0a20 2020 2020 2020 2071 7363 6f72 6561  .        qscorea
-00041800: 7070 203d 204e 6f6e 650a 2020 2020 2020  pp = None.      
-00041810: 2020 6f63 6869 6d65 7261 6170 7020 3d20    ochimeraapp = 
-00041820: 4e6f 6e65 0a20 2020 2020 2020 206d 6170  None.        map
-00041830: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
-00041840: 2020 2020 6d6f 6465 6c73 203d 204e 6f6e      models = Non
-00041850: 650a 2020 2020 2020 2020 2320 7573 6520  e.        # use 
-00041860: 6120 6669 7820 7661 6c75 6520 666f 7220  a fix value for 
-00041870: 6e6f 772c 206d 6179 2063 6f6e 7369 6465  now, may conside
-00041880: 7220 6173 2061 2061 7267 756d 656e 7420  r as a argument 
-00041890: 666f 7220 6c61 7465 720a 2020 2020 2020  for later.      
-000418a0: 2020 6e75 6d6f 6663 6f72 6573 203d 2069    numofcores = i
-000418b0: 6e74 286f 732e 6370 755f 636f 756e 7428  nt(os.cpu_count(
-000418c0: 2920 2f20 3229 0a0a 2020 2020 2020 2020  ) / 2)..        
-000418d0: 6966 2073 656c 662e 706c 6174 666f 726d  if self.platform
-000418e0: 203d 3d20 2765 6d64 6227 206f 7220 7365   == 'emdb' or se
-000418f0: 6c66 2e72 6573 6f6c 7574 696f 6e20 6973  lf.resolution is
-00041900: 204e 6f6e 6520 6f72 2073 656c 662e 7265   None or self.re
-00041910: 736f 6c75 7469 6f6e 203e 3d20 312e 3235  solution >= 1.25
-00041920: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00041930: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00041940: 2020 206f 6368 696d 6572 6161 7070 203d     ochimeraapp =
-00041950: 2073 656c 662e 6f63 6869 6d65 7261 6368   self.ochimerach
-00041960: 6563 6b28 290a 2020 2020 2020 2020 2020  eck().          
-00041970: 2020 2020 2020 7173 636f 7265 6170 7020        qscoreapp 
-00041980: 3d20 7365 6c66 2e63 6865 636b 7173 636f  = self.checkqsco
-00041990: 7265 286f 6368 696d 6572 6161 7070 290a  re(ochimeraapp).
-000419a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000419b0: 6d61 706e 616d 6520 3d20 7365 6c66 2e6d  mapname = self.m
-000419c0: 6170 2e66 756c 6c6e 616d 650a 2020 2020  ap.fullname.    
-000419d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000419e0: 656c 662e 6d6f 6465 6c73 2069 7320 6e6f  elf.models is no
-000419f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00041a00: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00041a10: 6c73 203d 2027 2027 2e6a 6f69 6e28 5b27  ls = ' '.join(['
-00041a20: 6369 663d 2720 2b20 6d6f 6465 6c2e 6669  cif=' + model.fi
-00041a30: 6c65 6e61 6d65 2066 6f72 206d 6f64 656c  lename for model
-00041a40: 2069 6e20 7365 6c66 2e6d 6f64 656c 735d   in self.models]
-00041a50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00041a60: 2020 2020 2020 6174 6f6d 5f6e 756d 6265        atom_numbe
-00041a70: 725f 616c 6c20 3d20 5b5d 0a20 2020 2020  r_all = [].     
-00041a80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00041a90: 6f72 206d 6f64 656c 2069 6e20 7365 6c66  or model in self
-00041aa0: 2e6d 6f64 656c 733a 0a20 2020 2020 2020  .models:.       
-00041ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041ac0: 2023 2066 6f72 206d 6f64 656c 7320 7769   # for models wi
-00041ad0: 7468 2065 7874 7261 2064 6174 6120 626c  th extra data bl
-00041ae0: 6f63 6b73 0a20 2020 2020 2020 2020 2020  ocks.           
-00041af0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00041b00: 6572 6174 6564 5f63 6966 203d 2027 7b7d  erated_cif = '{}
-00041b10: 5f6d 6f64 6572 6174 6564 2e63 6966 272e  _moderated.cif'.
-00041b20: 666f 726d 6174 286f 732e 7061 7468 2e62  format(os.path.b
-00041b30: 6173 656e 616d 6528 6d6f 6465 6c2e 6669  asename(model.fi
-00041b40: 6c65 6e61 6d65 2929 0a20 2020 2020 2020  lename)).       
-00041b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041b60: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
-00041b70: 6c65 2873 656c 662e 776f 726b 6469 7220  le(self.workdir 
-00041b80: 2b20 6d6f 6465 7261 7465 645f 6369 6629  + moderated_cif)
-00041b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00041ba0: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00041bb0: 6f6d 5f6e 756d 6265 725f 616c 6c2e 6170  om_number_all.ap
-00041bc0: 7065 6e64 2873 656c 662e 6174 6f6d 5f6e  pend(self.atom_n
-00041bd0: 756d 6265 7273 2873 656c 662e 776f 726b  umbers(self.work
-00041be0: 6469 7220 2b20 6d6f 6465 7261 7465 645f  dir + moderated_
-00041bf0: 6369 6629 290a 2020 2020 2020 2020 2020  cif)).          
-00041c00: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00041c10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00041c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041c30: 6174 6f6d 5f6e 756d 6265 725f 616c 6c2e  atom_number_all.
-00041c40: 6170 7065 6e64 2873 656c 662e 6174 6f6d  append(self.atom
-00041c50: 5f6e 756d 6265 7273 286d 6f64 656c 2e66  _numbers(model.f
-00041c60: 696c 656e 616d 6529 290a 0a20 2020 2020  ilename))..     
-00041c70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00041c80: 6620 6e75 6d6f 6663 6f72 6573 203e 206d  f numofcores > m
-00041c90: 696e 2861 746f 6d5f 6e75 6d62 6572 5f61  in(atom_number_a
-00041ca0: 6c6c 293a 0a20 2020 2020 2020 2020 2020  ll):.           
-00041cb0: 2020 2020 2020 2020 2020 2020 206e 756d               num
-00041cc0: 6f66 636f 7265 7320 3d20 6d69 6e28 6174  ofcores = min(at
-00041cd0: 6f6d 5f6e 756d 6265 725f 616c 6c29 0a20  om_number_all). 
-00041ce0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00041cf0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00041d00: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00041d10: 4e6f 2066 6974 7465 6420 6d6f 6465 6c2e  No fitted model.
-00041d20: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-00041d30: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00041d40: 2020 2020 2020 2020 6572 7220 3d20 2751          err = 'Q
-00041d50: 2d73 636f 7265 2070 7265 7061 7261 7469  -score preparati
-00041d60: 6f6e 2065 7272 6f72 3a20 7b7d 2e27 2e66  on error: {}.'.f
-00041d70: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
-00041d80: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
-00041d90: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
-00041da0: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
-00041db0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00041dc0: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
-00041dd0: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
-00041de0: 2020 2020 2020 2023 206d 6f64 656c 7320         # models 
-00041df0: 3d20 2720 272e 6a6f 696e 285b 276d 7966  = ' '.join(['myf
-00041e00: 6972 7374 2e63 6966 272c 2027 6d79 7365  irst.cif', 'myse
-00041e10: 636f 6e64 2e63 6966 275d 2920 2020 2020  cond.cif'])     
-00041e20: 2020 2320 6661 6b65 2074 6573 7420 706f    # fake test po
-00041e30: 696e 7420 666f 7220 6d75 6c74 6970 6c65  int for multiple
-00041e40: 2063 6966 2066 696c 6573 0a20 2020 2020   cif files.     
-00041e50: 2020 2020 2020 2069 6620 7173 636f 7265         if qscore
-00041e60: 6170 7020 616e 6420 7365 6c66 2e6d 6f64  app and self.mod
-00041e70: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
-00041e80: 2020 2020 2023 206f 6c64 2051 7363 6f72       # old Qscor
-00041e90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00041ea0: 2020 2320 7173 636f 7265 636d 6420 3d20    # qscorecmd = 
-00041eb0: 277b 7d20 2d2d 6e6f 6775 6920 2d2d 6e6f  '{} --nogui --no
-00041ec0: 7374 6174 7573 207b 7d20 7b7d 207b 7d27  status {} {} {}'
-00041ed0: 2e66 6f72 6d61 7428 6f63 6869 6d65 7261  .format(ochimera
-00041ee0: 6170 702c 206d 6170 6e61 6d65 2c20 6d6f  app, mapname, mo
-00041ef0: 6465 6c73 2c20 7173 636f 7265 6170 7029  dels, qscoreapp)
-00041f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041f10: 2076 6f72 636f 6e74 656e 7473 203d 206f   vorcontents = o
-00041f20: 6368 696d 6572 6161 7070 2e73 706c 6974  chimeraapp.split
-00041f30: 2827 436f 6e74 656e 7473 2729 5b30 5d20  ('Contents')[0] 
-00041f40: 6966 2027 436f 6e74 656e 7473 2720 696e  if 'Contents' in
-00041f50: 206f 6368 696d 6572 6161 7070 2065 6c73   ochimeraapp els
-00041f60: 6520 6f63 6869 6d65 7261 6170 702e 7370  e ochimeraapp.sp
-00041f70: 6c69 7428 2762 696e 2729 5b30 5d0a 2020  lit('bin')[0].  
-00041f80: 2020 2020 2020 2020 2020 2020 2020 7173                qs
-00041f90: 636f 7265 636d 6420 3d20 277b 7d20 7b7d  corecmd = '{} {}
-00041fa0: 207b 7d20 6d61 703d 7b7d 207b 7d20 6e70   {} map={} {} np
-00041fb0: 3d7b 7d20 7265 733d 7b7d 2073 6967 6d61  ={} res={} sigma
-00041fc0: 3d30 2e34 272e 666f 726d 6174 2873 7973  =0.4'.format(sys
-00041fd0: 2e65 7865 6375 7461 626c 652c 2071 7363  .executable, qsc
-00041fe0: 6f72 6561 7070 2c20 766f 7263 6f6e 7465  oreapp, vorconte
-00041ff0: 6e74 732c 0a20 2020 2020 2020 2020 2020  nts,.           
-00042000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042030: 2020 2020 2020 6d61 706e 616d 652c 206d        mapname, m
-00042040: 6f64 656c 732c 206e 756d 6f66 636f 7265  odels, numofcore
-00042050: 732c 2073 656c 662e 7265 736f 6c75 7469  s, self.resoluti
-00042060: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
-00042070: 2020 2020 7072 696e 7428 7173 636f 7265      print(qscore
-00042080: 636d 6429 0a20 2020 2020 2020 2020 2020  cmd).           
-00042090: 2020 2020 206c 7173 636f 7265 636d 6420       lqscorecmd 
-000420a0: 3d20 7173 636f 7265 636d 642e 7370 6c69  = qscorecmd.spli
-000420b0: 7428 2720 2729 0a20 2020 2020 2020 2020  t(' ').         
-000420c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000420d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000420e0: 7072 6f63 6573 7320 3d20 7375 6270 726f  process = subpro
-000420f0: 6365 7373 2e50 6f70 656e 286c 7173 636f  cess.Popen(lqsco
-00042100: 7265 636d 642c 2073 7464 6f75 743d 7375  recmd, stdout=su
-00042110: 6270 726f 6365 7373 2e50 4950 452c 2073  bprocess.PIPE, s
-00042120: 7464 6572 723d 7375 6270 726f 6365 7373  tderr=subprocess
-00042130: 2e53 5444 4f55 542c 0a20 2020 2020 2020  .STDOUT,.       
-00042140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042160: 2020 2020 2020 2020 6377 643d 7365 6c66          cwd=self
-00042170: 2e77 6f72 6b64 6972 290a 2020 2020 2020  .workdir).      
-00042180: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00042190: 7470 7574 203d 2070 726f 6365 7373 2e63  tput = process.c
-000421a0: 6f6d 6d75 6e69 6361 7465 2827 6e5c 6e27  ommunicate('n\n'
-000421b0: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
-000421c0: 2020 2020 2020 2020 2065 7272 7173 636f           errqsco
-000421d0: 7265 203d 2027 6572 726f 7227 0a20 2020  re = 'error'.   
+000408e0: 6572 7220 3d20 2753 796d 6d65 7472 7920  err = 'Symmetry 
+000408f0: 6361 6c63 756c 6174 696f 6e20 6572 726f  calculation erro
+00040900: 723a 207b 7d2e 272e 666f 726d 6174 2873  r: {}.'.format(s
+00040910: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+00040920: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00040930: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00040940: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
+00040950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00040960: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00040970: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
+00040980: 7272 202b 2027 5c6e 2729 0a20 2020 2020  rr + '\n').     
+00040990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000409a0: 2020 2020 2020 2070 7269 6e74 2827 2d2d         print('--
+000409b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000409c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000409d0: 2d2d 2729 0a0a 2020 2020 2020 2020 2020  --')..          
+000409e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000409f0: 2065 7272 6c69 7374 3a0a 2020 2020 2020   errlist:.      
+00040a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040a10: 2020 2020 2020 6669 6e61 6c64 6963 745b        finaldict[
+00040a20: 2773 796d 6d65 7472 7927 5d20 3d20 7b27  'symmetry'] = {'
+00040a30: 6572 7227 3a20 7b27 7379 6d6d 6574 7279  err': {'symmetry
+00040a40: 5f65 7272 273a 2065 7272 6c69 7374 7d7d  _err': errlist}}
+00040a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040a60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00040a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040a80: 2020 2020 2020 2020 2020 2066 696e 616c             final
+00040a90: 6469 6374 5b27 7379 6d6d 6574 7279 275d  dict['symmetry']
+00040aa0: 203d 207b 2773 796d 6d65 7472 795f 696e   = {'symmetry_in
+00040ab0: 666f 273a 2073 796d 6d65 7472 7952 6573  fo': symmetryRes
+00040ac0: 7d0a 0a20 2020 2020 2020 2020 2020 2020  }..             
+00040ad0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00040ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040af0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00040b00: 2063 6f64 6563 732e 6f70 656e 2873 656c   codecs.open(sel
+00040b10: 662e 776f 726b 6469 7220 2b20 7365 6c66  f.workdir + self
+00040b20: 2e6d 6170 6e61 6d65 202b 2027 5f73 796d  .mapname + '_sym
+00040b30: 6d65 7472 792e 6a73 6f6e 272c 2027 7727  metry.json', 'w'
+00040b40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00040b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040b60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00040b70: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
+00040b80: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+00040b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ba0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
+00040bb0: 2866 696e 616c 6469 6374 2c20 6629 0a20  (finaldict, f). 
+00040bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040bd0: 2020 2020 2020 2065 7863 6570 7420 494f         except IO
+00040be0: 4572 726f 7220 6173 2069 6f65 7272 3a0a  Error as ioerr:.
+00040bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040c00: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00040c10: 7374 6465 7272 2e77 7269 7465 2827 5361  stderr.write('Sa
+00040c20: 7669 6e67 2073 796d 6d65 7472 7920 696e  ving symmetry in
+00040c30: 666f 726d 6174 696f 6e20 746f 206a 736f  formation to jso
+00040c40: 6e20 6572 723a 207b 7d2e 5c6e 272e 666f  n err: {}.\n'.fo
+00040c50: 726d 6174 2869 6f65 7272 2929 0a0a 0a0a  rmat(ioerr))....
+00040c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040c70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00040c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040c90: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
+00040ca0: 7465 2827 5072 6f73 6861 6465 2069 7320  te('Proshade is 
+00040cb0: 6e6f 7420 696e 7374 616c 6c65 642e 2054  not installed. T
+00040cc0: 6865 7265 2077 696c 6c20 6265 206e 6f20  here will be no 
+00040cd0: 7379 6d6d 6574 7279 2069 6e66 6f72 6d61  symmetry informa
+00040ce0: 7469 6f6e 2e5c 6e27 290a 2020 2020 2020  tion.\n').      
+00040cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040d00: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
+00040d10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00040d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
+00040d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040d40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00040d50: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+00040d60: 7464 6572 722e 7772 6974 6528 2754 6869  tderr.write('Thi
+00040d70: 7320 6973 2061 207b 7d20 656e 7472 792c  s is a {} entry,
+00040d80: 2073 796d 6d65 7472 7920 7769 6c6c 206e   symmetry will n
+00040d90: 6f74 2062 6520 6361 6c63 756c 6174 6564  ot be calculated
+00040da0: 2e5c 6e27 2e66 6f72 6d61 7428 7365 6c66  .\n'.format(self
+00040db0: 2e6d 6574 2929 0a20 2020 2020 2020 2020  .met)).         
+00040dc0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00040dd0: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
+00040de0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00040df0: 2d2d 2d2d 2d2d 2729 0a0a 2020 2020 2020  ------')..      
+00040e00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00040e10: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00040e20: 7374 6465 7272 2e77 7269 7465 2827 454d  stderr.write('EM
+00040e30: 206d 6574 686f 6420 616e 6420 7265 736f   method and reso
+00040e40: 6c75 7469 6f6e 206e 6565 6465 6420 746f  lution needed to
+00040e50: 2063 616c 6375 6c61 7465 6420 7379 6d6d   calculated symm
+00040e60: 6574 7279 2069 6e66 6f72 6d61 7469 6f6e  etry information
+00040e70: 215c 6e27 290a 2020 2020 2020 2020 2020  !\n').          
+00040e80: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
+00040e90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00040ea0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00040eb0: 2d27 290a 0a20 2020 2020 2020 2072 6574  -')..        ret
+00040ec0: 7572 6e20 4e6f 6e65 0a0a 2020 2020 2320  urn None..    # 
+00040ed0: 512d 7363 6f72 6520 7265 6c61 7465 6420  Q-score related 
+00040ee0: 7374 6172 7465 6420 6672 6f6d 2068 6572  started from her
+00040ef0: 650a 2020 2020 6465 6620 6f63 6869 6d65  e.    def ochime
+00040f00: 7261 6368 6563 6b28 7365 6c66 293a 0a20  racheck(self):. 
+00040f10: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00040f20: 2020 2020 2020 2020 4368 6563 6b20 7768          Check wh
+00040f30: 6572 6520 6973 206f 6c64 2043 6869 6d65  ere is old Chime
+00040f40: 7261 206e 6f74 2066 6f72 2043 6869 6d65  ra not for Chime
+00040f50: 7261 580a 0a20 2020 2020 2020 203a 7265  raX..        :re
+00040f60: 7475 726e 3a20 7468 6520 7061 7468 206f  turn: the path o
+00040f70: 6620 6f6c 6420 4368 696d 6572 6120 6f72  f old Chimera or
+00040f80: 204e 6f6e 6520 7769 7468 206e 6f20 4368   None with no Ch
+00040f90: 696d 6572 610a 2020 2020 2020 2020 2222  imera.        ""
+00040fa0: 220a 0a20 2020 2020 2020 206f 6368 696d  "..        ochim
+00040fb0: 6572 6161 7070 203d 204e 6f6e 650a 2020  eraapp = None.  
+00040fc0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00040fd0: 2020 2020 2020 2069 6620 4f43 4849 4d45         if OCHIME
+00040fe0: 5241 2069 7320 6e6f 7420 4e6f 6e65 3a0a  RA is not None:.
+00040ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041000: 6f63 6869 6d65 7261 6170 7020 3d20 4f43  ochimeraapp = OC
+00041010: 4849 4d45 5241 0a20 2020 2020 2020 2020  HIMERA.         
+00041020: 2020 2020 2020 2070 7269 6e74 2827 4368         print('Ch
+00041030: 696d 6572 613a 207b 7d27 2e66 6f72 6d61  imera: {}'.forma
+00041040: 7428 6f63 6869 6d65 7261 6170 7029 290a  t(ochimeraapp)).
+00041050: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00041060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00041070: 2020 6173 7365 7274 2066 696e 645f 6578    assert find_ex
+00041080: 6563 7574 6162 6c65 2827 6368 696d 6572  ecutable('chimer
+00041090: 6127 2920 6973 206e 6f74 204e 6f6e 650a  a') is not None.
+000410a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000410b0: 6f63 6869 6d65 7261 6170 7020 3d20 6669  ochimeraapp = fi
+000410c0: 6e64 5f65 7865 6375 7461 626c 6528 2763  nd_executable('c
+000410d0: 6869 6d65 7261 2729 0a20 2020 2020 2020  himera').       
+000410e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000410f0: 4368 696d 6572 613a 207b 7d27 2e66 6f72  Chimera: {}'.for
+00041100: 6d61 7428 6f63 6869 6d65 7261 6170 7029  mat(ochimeraapp)
+00041110: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+00041120: 7420 4173 7365 7274 696f 6e45 7272 6f72  t AssertionError
+00041130: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+00041140: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
+00041150: 4368 696d 6572 6158 2065 7865 6375 7461  ChimeraX executa
+00041160: 626c 6520 6973 206e 6f74 2074 6865 7265  ble is not there
+00041170: 2e5c 6e27 290a 0a20 2020 2020 2020 2072  .\n')..        r
+00041180: 6574 7572 6e20 6f63 6869 6d65 7261 6170  eturn ochimeraap
+00041190: 700a 0a20 2020 2064 6566 2063 6865 636b  p..    def check
+000411a0: 7173 636f 7265 2873 656c 662c 206f 6368  qscore(self, och
+000411b0: 696d 6572 6161 7070 293a 0a0a 2020 2020  imeraapp):..    
+000411c0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+000411d0: 2020 2020 2043 6865 636b 2069 6620 5173       Check if Qs
+000411e0: 636f 7265 2069 7320 7072 6f70 6572 6c79  core is properly
+000411f0: 2069 6e73 7461 6c6c 6564 0a0a 2020 2020   installed..    
+00041200: 2020 2020 3a72 6574 7572 6e3a 2051 7363      :return: Qsc
+00041210: 6f72 6520 6669 6c65 2066 756c 6c20 7061  ore file full pa
+00041220: 7468 206f 7220 4e6f 6e65 0a20 2020 2020  th or None.     
+00041230: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00041240: 7173 636f 7265 6170 7020 3d20 4e6f 6e65  qscoreapp = None
+00041250: 0a20 2020 2020 2020 2069 6620 6f63 6869  .        if ochi
+00041260: 6d65 7261 6170 703a 0a20 2020 2020 2020  meraapp:.       
+00041270: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
+00041280: 6f63 6869 6d65 7261 6170 7020 6973 2061  ochimeraapp is a
+00041290: 2073 796d 626f 6c69 6320 6c69 6e6b 0a20   symbolic link. 
+000412a0: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+000412b0: 2e70 6174 682e 6973 6c69 6e6b 286f 6368  .path.islink(och
+000412c0: 696d 6572 6161 7070 293a 0a20 2020 2020  imeraapp):.     
+000412d0: 2020 2020 2020 2020 2020 2072 6561 6c63             realc
+000412e0: 6869 6d65 7261 6170 7020 3d20 6f73 2e70  himeraapp = os.p
+000412f0: 6174 682e 7265 616c 7061 7468 2870 6174  ath.realpath(pat
+00041300: 6829 0a20 2020 2020 2020 2020 2020 2065  h).            e
+00041310: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00041320: 2020 2020 2072 6561 6c63 6869 6d65 7261       realchimera
+00041330: 6170 7020 3d20 6f63 6869 6d65 7261 6170  app = ochimeraap
+00041340: 700a 0a20 2020 2020 2020 2020 2020 2069  p..            i
+00041350: 6620 2743 6f6e 7465 6e74 2720 696e 2072  f 'Content' in r
+00041360: 6561 6c63 6869 6d65 7261 6170 703a 0a20  ealchimeraapp:. 
+00041370: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00041380: 6f72 636f 6e74 656e 7420 3d20 6f63 6869  orcontent = ochi
+00041390: 6d65 7261 6170 702e 7370 6c69 7428 2743  meraapp.split('C
+000413a0: 6f6e 7465 6e74 2729 5b30 5d0a 2020 2020  ontent')[0].    
+000413b0: 2020 2020 2020 2020 2020 2020 6d61 7071              mapq
+000413c0: 203d 2076 6f72 636f 6e74 656e 7420 2b20   = vorcontent + 
+000413d0: 2743 6f6e 7465 6e74 732f 5265 736f 7572  'Contents/Resour
+000413e0: 6365 732f 7368 6172 652f 6d61 7071 2f6d  ces/share/mapq/m
+000413f0: 6170 715f 636d 642e 7079 270a 2020 2020  apq_cmd.py'.    
+00041400: 2020 2020 2020 2020 2020 2020 7173 636f              qsco
+00041410: 7265 6170 7020 3d20 6d61 7071 2069 6620  reapp = mapq if 
+00041420: 6f73 2e70 6174 682e 6973 6669 6c65 286d  os.path.isfile(m
+00041430: 6170 7129 2065 6c73 6520 4e6f 6e65 0a20  apq) else None. 
+00041440: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00041450: 2762 696e 2720 696e 2072 6561 6c63 6869  'bin' in realchi
+00041460: 6d65 7261 6170 703a 0a20 2020 2020 2020  meraapp:.       
+00041470: 2020 2020 2020 2020 2076 6f72 636f 6e74           vorcont
+00041480: 656e 7420 3d20 6f63 6869 6d65 7261 6170  ent = ochimeraap
+00041490: 702e 7370 6c69 7428 2762 696e 2729 5b30  p.split('bin')[0
+000414a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000414b0: 2020 6d61 7071 203d 2076 6f72 636f 6e74    mapq = vorcont
+000414c0: 656e 7420 2b20 2773 6861 7265 2f6d 6170  ent + 'share/map
+000414d0: 712f 6d61 7071 5f63 6d64 2e70 7927 0a20  q/mapq_cmd.py'. 
+000414e0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+000414f0: 7363 6f72 6561 7070 203d 206d 6170 7120  scoreapp = mapq 
+00041500: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+00041510: 6528 6d61 7071 2920 656c 7365 204e 6f6e  e(mapq) else Non
+00041520: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+00041530: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00041540: 2020 2020 7072 696e 7428 2743 6869 6d65      print('Chime
+00041550: 7261 2069 7320 6e6f 7420 6769 7665 6e20  ra is not given 
+00041560: 696e 2061 2070 726f 7065 7220 6578 6563  in a proper exec
+00041570: 7574 6162 6c65 206f 7220 7379 6d62 6f6c  utable or symbol
+00041580: 6963 206c 696e 6b20 666f 726d 6174 2e27  ic link format.'
+00041590: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000415a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000415b0: 7428 2743 6869 6d65 7261 2077 6173 206e  t('Chimera was n
+000415c0: 6f74 2066 6f75 6e64 2e27 290a 0a20 2020  ot found.')..   
+000415d0: 2020 2020 2072 6574 7572 6e20 7173 636f       return qsco
+000415e0: 7265 6170 700a 0a20 2020 2064 6566 2061  reapp..    def a
+000415f0: 746f 6d5f 6e75 6d62 6572 7328 7365 6c66  tom_numbers(self
+00041600: 2c20 6d6f 6465 6c5f 6669 6c65 6e61 6d65  , model_filename
+00041610: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00041620: 2020 2020 2020 2020 2020 2047 6574 2074             Get t
+00041630: 6865 206e 756d 6265 7220 6f66 2061 746f  he number of ato
+00041640: 6d73 2069 6e20 7468 6520 6d6f 6465 6c0a  ms in the model.
+00041650: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+00041660: 6f64 656c 5f66 696c 656e 616d 653a 2073  odel_filename: s
+00041670: 7472 696e 6720 6f66 2066 756c 6c20 6d6f  tring of full mo
+00041680: 6465 6c20 6e61 6d65 2077 6974 6820 7061  del name with pa
+00041690: 7468 0a20 2020 2020 2020 203a 7265 7475  th.        :retu
+000416a0: 726e 3a20 696e 7465 6765 7220 6f66 206e  rn: integer of n
+000416b0: 756d 6265 7220 6f66 2061 746f 6d73 0a20  umber of atoms. 
+000416c0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000416d0: 2020 2020 7061 7273 6572 203d 204d 4d43      parser = MMC
+000416e0: 4946 5061 7273 6572 2829 0a20 2020 2020  IFParser().     
+000416f0: 2020 2073 7472 7563 7475 7265 203d 2070     structure = p
+00041700: 6172 7365 722e 6765 745f 7374 7275 6374  arser.get_struct
+00041710: 7572 6528 2774 272c 206d 6f64 656c 5f66  ure('t', model_f
+00041720: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+00041730: 2061 746f 6d73 203d 2073 7472 7563 7475   atoms = structu
+00041740: 7265 2e67 6574 5f61 746f 6d73 2829 0a0a  re.get_atoms()..
+00041750: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00041760: 756d 2831 2066 6f72 205f 2069 6e20 6174  um(1 for _ in at
+00041770: 6f6d 7329 0a0a 0a0a 2020 2020 6465 6620  oms)....    def 
+00041780: 7173 636f 7265 5f62 6172 2873 656c 6629  qscore_bar(self)
+00041790: 3a0a 0a20 2020 2020 2020 2069 6620 6e6f  :..        if no
+000417a0: 7420 7365 6c66 2e6f 6e6c 7962 6172 3a0a  t self.onlybar:.
+000417b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000417c0: 2e71 7363 6f72 6528 290a 2020 2020 2020  .qscore().      
+000417d0: 2020 7365 6c66 2e67 6574 5f62 6172 2873    self.get_bar(s
+000417e0: 636f 7265 5f74 7970 653d 2771 7363 6f72  core_type='qscor
+000417f0: 6527 290a 0a20 2020 2023 2040 7072 6f66  e')..    # @prof
+00041800: 696c 650a 2020 2020 6465 6620 7173 636f  ile.    def qsco
+00041810: 7265 2873 656c 6629 3a0a 2020 2020 2020  re(self):.      
+00041820: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
+00041830: 2020 2043 616c 6375 6c61 7465 2051 2d73     Calculate Q-s
+00041840: 636f 7265 0a0a 2020 2020 2020 2020 3a72  core..        :r
+00041850: 6574 7572 6e3a 0a20 2020 2020 2020 2022  eturn:.        "
+00041860: 2222 0a0a 2020 2020 2020 2020 6572 726c  ""..        errl
+00041870: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00041880: 2071 7363 6f72 6561 7070 203d 204e 6f6e   qscoreapp = Non
+00041890: 650a 2020 2020 2020 2020 6f63 6869 6d65  e.        ochime
+000418a0: 7261 6170 7020 3d20 4e6f 6e65 0a20 2020  raapp = None.   
+000418b0: 2020 2020 206d 6170 6e61 6d65 203d 204e       mapname = N
+000418c0: 6f6e 650a 2020 2020 2020 2020 6d6f 6465  one.        mode
+000418d0: 6c73 203d 204e 6f6e 650a 2020 2020 2020  ls = None.      
+000418e0: 2020 2320 7573 6520 6120 6669 7820 7661    # use a fix va
+000418f0: 6c75 6520 666f 7220 6e6f 772c 206d 6179  lue for now, may
+00041900: 2063 6f6e 7369 6465 7220 6173 2061 2061   consider as a a
+00041910: 7267 756d 656e 7420 666f 7220 6c61 7465  rgument for late
+00041920: 720a 2020 2020 2020 2020 6e75 6d6f 6663  r.        numofc
+00041930: 6f72 6573 203d 2069 6e74 286f 732e 6370  ores = int(os.cp
+00041940: 755f 636f 756e 7428 2920 2f20 3229 0a0a  u_count() / 2)..
+00041950: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00041960: 706c 6174 666f 726d 203d 3d20 2765 6d64  platform == 'emd
+00041970: 6227 206f 7220 7365 6c66 2e72 6573 6f6c  b' or self.resol
+00041980: 7574 696f 6e20 6973 204e 6f6e 6520 6f72  ution is None or
+00041990: 2066 6c6f 6174 2873 656c 662e 7265 736f   float(self.reso
+000419a0: 6c75 7469 6f6e 2920 3e3d 2031 2e32 353a  lution) >= 1.25:
+000419b0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+000419c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000419d0: 2020 6f63 6869 6d65 7261 6170 7020 3d20    ochimeraapp = 
+000419e0: 7365 6c66 2e6f 6368 696d 6572 6163 6865  self.ochimerache
+000419f0: 636b 2829 0a20 2020 2020 2020 2020 2020  ck().           
+00041a00: 2020 2020 2071 7363 6f72 6561 7070 203d       qscoreapp =
+00041a10: 2073 656c 662e 6368 6563 6b71 7363 6f72   self.checkqscor
+00041a20: 6528 6f63 6869 6d65 7261 6170 7029 0a20  e(ochimeraapp). 
+00041a30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00041a40: 6170 6e61 6d65 203d 2073 656c 662e 6d61  apname = self.ma
+00041a50: 702e 6675 6c6c 6e61 6d65 0a20 2020 2020  p.fullname.     
+00041a60: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00041a70: 6c66 2e6d 6f64 656c 7320 6973 206e 6f74  lf.models is not
+00041a80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00041a90: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+00041aa0: 7320 3d20 2720 272e 6a6f 696e 285b 2763  s = ' '.join(['c
+00041ab0: 6966 3d27 202b 206d 6f64 656c 2e66 696c  if=' + model.fil
+00041ac0: 656e 616d 6520 666f 7220 6d6f 6465 6c20  ename for model 
+00041ad0: 696e 2073 656c 662e 6d6f 6465 6c73 5d29  in self.models])
+00041ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041af0: 2020 2020 2061 746f 6d5f 6e75 6d62 6572       atom_number
+00041b00: 5f61 6c6c 203d 205b 5d0a 2020 2020 2020  _all = [].      
+00041b10: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00041b20: 7220 6d6f 6465 6c20 696e 2073 656c 662e  r model in self.
+00041b30: 6d6f 6465 6c73 3a0a 2020 2020 2020 2020  models:.        
+00041b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041b50: 2320 666f 7220 6d6f 6465 6c73 2077 6974  # for models wit
+00041b60: 6820 6578 7472 6120 6461 7461 2062 6c6f  h extra data blo
+00041b70: 636b 730a 2020 2020 2020 2020 2020 2020  cks.            
+00041b80: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00041b90: 7261 7465 645f 6369 6620 3d20 277b 7d5f  rated_cif = '{}_
+00041ba0: 6d6f 6465 7261 7465 642e 6369 6627 2e66  moderated.cif'.f
+00041bb0: 6f72 6d61 7428 6f73 2e70 6174 682e 6261  ormat(os.path.ba
+00041bc0: 7365 6e61 6d65 286d 6f64 656c 2e66 696c  sename(model.fil
+00041bd0: 656e 616d 6529 290a 2020 2020 2020 2020  ename)).        
+00041be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041bf0: 6966 206f 732e 7061 7468 2e69 7366 696c  if os.path.isfil
+00041c00: 6528 7365 6c66 2e77 6f72 6b64 6972 202b  e(self.workdir +
+00041c10: 206d 6f64 6572 6174 6564 5f63 6966 293a   moderated_cif):
+00041c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041c30: 2020 2020 2020 2020 2020 2020 2061 746f               ato
+00041c40: 6d5f 6e75 6d62 6572 5f61 6c6c 2e61 7070  m_number_all.app
+00041c50: 656e 6428 7365 6c66 2e61 746f 6d5f 6e75  end(self.atom_nu
+00041c60: 6d62 6572 7328 7365 6c66 2e77 6f72 6b64  mbers(self.workd
+00041c70: 6972 202b 206d 6f64 6572 6174 6564 5f63  ir + moderated_c
+00041c80: 6966 2929 0a20 2020 2020 2020 2020 2020  if)).           
+00041c90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00041ca0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00041cb0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00041cc0: 746f 6d5f 6e75 6d62 6572 5f61 6c6c 2e61  tom_number_all.a
+00041cd0: 7070 656e 6428 7365 6c66 2e61 746f 6d5f  ppend(self.atom_
+00041ce0: 6e75 6d62 6572 7328 6d6f 6465 6c2e 6669  numbers(model.fi
+00041cf0: 6c65 6e61 6d65 2929 0a0a 2020 2020 2020  lename))..      
+00041d00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00041d10: 206e 756d 6f66 636f 7265 7320 3e20 6d69   numofcores > mi
+00041d20: 6e28 6174 6f6d 5f6e 756d 6265 725f 616c  n(atom_number_al
+00041d30: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
+00041d40: 2020 2020 2020 2020 2020 2020 6e75 6d6f              numo
+00041d50: 6663 6f72 6573 203d 206d 696e 2861 746f  fcores = min(ato
+00041d60: 6d5f 6e75 6d62 6572 5f61 6c6c 290a 2020  m_number_all).  
+00041d70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00041d80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00041d90: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
+00041da0: 6f20 6669 7474 6564 206d 6f64 656c 2e27  o fitted model.'
+00041db0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00041dc0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+00041dd0: 2020 2020 2020 2065 7272 203d 2027 512d         err = 'Q-
+00041de0: 7363 6f72 6520 7072 6570 6172 6174 696f  score preparatio
+00041df0: 6e20 6572 726f 723a 207b 7d2e 272e 666f  n error: {}.'.fo
+00041e00: 726d 6174 2873 7973 2e65 7863 5f69 6e66  rmat(sys.exc_inf
+00041e10: 6f28 295b 315d 290a 2020 2020 2020 2020  o()[1]).        
+00041e20: 2020 2020 2020 2020 6572 726c 6973 742e          errlist.
+00041e30: 6170 7065 6e64 2865 7272 290a 2020 2020  append(err).    
+00041e40: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00041e50: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
+00041e60: 202b 2027 5c6e 2729 0a0a 2020 2020 2020   + '\n')..      
+00041e70: 2020 2020 2020 2320 6d6f 6465 6c73 203d        # models =
+00041e80: 2027 2027 2e6a 6f69 6e28 5b27 6d79 6669   ' '.join(['myfi
+00041e90: 7273 742e 6369 6627 2c20 276d 7973 6563  rst.cif', 'mysec
+00041ea0: 6f6e 642e 6369 6627 5d29 2020 2020 2020  ond.cif'])      
+00041eb0: 2023 2066 616b 6520 7465 7374 2070 6f69   # fake test poi
+00041ec0: 6e74 2066 6f72 206d 756c 7469 706c 6520  nt for multiple 
+00041ed0: 6369 6620 6669 6c65 730a 2020 2020 2020  cif files.      
+00041ee0: 2020 2020 2020 6966 2071 7363 6f72 6561        if qscorea
+00041ef0: 7070 2061 6e64 2073 656c 662e 6d6f 6465  pp and self.mode
+00041f00: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+00041f10: 2020 2020 2320 6f6c 6420 5173 636f 7265      # old Qscore
+00041f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041f30: 2023 2071 7363 6f72 6563 6d64 203d 2027   # qscorecmd = '
+00041f40: 7b7d 202d 2d6e 6f67 7569 202d 2d6e 6f73  {} --nogui --nos
+00041f50: 7461 7475 7320 7b7d 207b 7d20 7b7d 272e  tatus {} {} {}'.
+00041f60: 666f 726d 6174 286f 6368 696d 6572 6161  format(ochimeraa
+00041f70: 7070 2c20 6d61 706e 616d 652c 206d 6f64  pp, mapname, mod
+00041f80: 656c 732c 2071 7363 6f72 6561 7070 290a  els, qscoreapp).
+00041f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041fa0: 766f 7263 6f6e 7465 6e74 7320 3d20 6f63  vorcontents = oc
+00041fb0: 6869 6d65 7261 6170 702e 7370 6c69 7428  himeraapp.split(
+00041fc0: 2743 6f6e 7465 6e74 7327 295b 305d 2069  'Contents')[0] i
+00041fd0: 6620 2743 6f6e 7465 6e74 7327 2069 6e20  f 'Contents' in 
+00041fe0: 6f63 6869 6d65 7261 6170 7020 656c 7365  ochimeraapp else
+00041ff0: 206f 6368 696d 6572 6161 7070 2e73 706c   ochimeraapp.spl
+00042000: 6974 2827 6269 6e27 295b 305d 0a20 2020  it('bin')[0].   
+00042010: 2020 2020 2020 2020 2020 2020 2071 7363               qsc
+00042020: 6f72 6563 6d64 203d 2027 7b7d 207b 7d20  orecmd = '{} {} 
+00042030: 7b7d 206d 6170 3d7b 7d20 7b7d 206e 703d  {} map={} {} np=
+00042040: 7b7d 2072 6573 3d7b 7d20 7369 676d 613d  {} res={} sigma=
+00042050: 302e 3427 2e66 6f72 6d61 7428 7379 732e  0.4'.format(sys.
+00042060: 6578 6563 7574 6162 6c65 2c20 7173 636f  executable, qsco
+00042070: 7265 6170 702c 2076 6f72 636f 6e74 656e  reapp, vorconten
+00042080: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00042090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000420a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000420b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000420c0: 2020 2020 206d 6170 6e61 6d65 2c20 6d6f       mapname, mo
+000420d0: 6465 6c73 2c20 6e75 6d6f 6663 6f72 6573  dels, numofcores
+000420e0: 2c20 7365 6c66 2e72 6573 6f6c 7574 696f  , self.resolutio
+000420f0: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00042100: 2020 2070 7269 6e74 2871 7363 6f72 6563     print(qscorec
+00042110: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
+00042120: 2020 2020 6c71 7363 6f72 6563 6d64 203d      lqscorecmd =
+00042130: 2071 7363 6f72 6563 6d64 2e73 706c 6974   qscorecmd.split
+00042140: 2827 2027 290a 2020 2020 2020 2020 2020  (' ').          
+00042150: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00042160: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00042170: 726f 6365 7373 203d 2073 7562 7072 6f63  rocess = subproc
+00042180: 6573 732e 506f 7065 6e28 6c71 7363 6f72  ess.Popen(lqscor
+00042190: 6563 6d64 2c20 7374 646f 7574 3d73 7562  ecmd, stdout=sub
+000421a0: 7072 6f63 6573 732e 5049 5045 2c20 7374  process.PIPE, st
+000421b0: 6465 7272 3d73 7562 7072 6f63 6573 732e  derr=subprocess.
+000421c0: 5354 444f 5554 2c0a 2020 2020 2020 2020  STDOUT,.        
+000421d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000421e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000421f0: 2069 6620 7379 732e 7665 7273 696f 6e5f   if sys.version_
-00042200: 696e 666f 5b30 5d20 3e3d 2033 3a0a 2020  info[0] >= 3:.  
-00042210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042220: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
-00042230: 6e20 6f75 7470 7574 2e64 6563 6f64 6528  n output.decode(
-00042240: 2775 7466 2d38 2729 2e73 706c 6974 2827  'utf-8').split('
-00042250: 5c6e 2729 3a0a 2020 2020 2020 2020 2020  \n'):.          
-00042260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042270: 2020 2320 6974 656d 203d 2063 6c69 6e65    # item = cline
-00042280: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
-00042290: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+000421f0: 2020 2020 2020 2063 7764 3d73 656c 662e         cwd=self.
+00042200: 776f 726b 6469 7229 0a20 2020 2020 2020  workdir).       
+00042210: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00042220: 7075 7420 3d20 7072 6f63 6573 732e 636f  put = process.co
+00042230: 6d6d 756e 6963 6174 6528 276e 5c6e 2729  mmunicate('n\n')
+00042240: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00042250: 2020 2020 2020 2020 6572 7271 7363 6f72          errqscor
+00042260: 6520 3d20 2765 7272 6f72 270a 2020 2020  e = 'error'.    
+00042270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042280: 6966 2073 7973 2e76 6572 7369 6f6e 5f69  if sys.version_i
+00042290: 6e66 6f5b 305d 203e 3d20 333a 0a20 2020  nfo[0] >= 3:.   
 000422a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000422b0: 2020 2020 2070 7269 6e74 2869 7465 6d29       print(item)
-000422c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000422d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000422e0: 6572 7271 7363 6f72 6520 696e 2069 7465  errqscore in ite
-000422f0: 6d2e 6c6f 7765 7228 293a 0a20 2020 2020  m.lower():.     
-00042300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042310: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
-00042320: 6e65 203d 2069 7465 6d2e 7374 7269 7028  ne = item.strip(
-00042330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00042340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042350: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-00042360: 2865 7272 6c69 6e65 290a 2020 2020 2020  (errline).      
-00042370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042380: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00042390: 2065 7272 7173 636f 7265 206e 6f74 2069   errqscore not i
-000423a0: 6e20 6f75 7470 7574 2e64 6563 6f64 6528  n output.decode(
-000423b0: 2775 7466 2d38 2729 2c20 6572 726c 696e  'utf-8'), errlin
-000423c0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-000423d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000423e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000423f0: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-00042400: 206f 7574 7075 742e 7370 6c69 7428 275c   output.split('\
-00042410: 6e27 293a 0a20 2020 2020 2020 2020 2020  n'):.           
-00042420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042430: 2070 7269 6e74 2869 7465 6d29 0a20 2020   print(item).   
-00042440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042450: 2020 2020 2020 2020 2069 6620 6572 7271           if errq
-00042460: 7363 6f72 6520 696e 2069 7465 6d2e 6c6f  score in item.lo
-00042470: 7765 7228 293a 0a20 2020 2020 2020 2020  wer():.         
-00042480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042490: 2020 2020 2020 2065 7272 6c69 6e65 203d         errline =
-000424a0: 2069 7465 6d2e 7374 7269 7028 290a 2020   item.strip().  
+000422b0: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+000422c0: 206f 7574 7075 742e 6465 636f 6465 2827   output.decode('
+000422d0: 7574 662d 3827 292e 7370 6c69 7428 275c  utf-8').split('\
+000422e0: 6e27 293a 0a20 2020 2020 2020 2020 2020  n'):.           
+000422f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042300: 2023 2069 7465 6d20 3d20 636c 696e 652e   # item = cline.
+00042310: 6465 636f 6465 2827 7574 662d 3827 292e  decode('utf-8').
+00042320: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00042330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042340: 2020 2020 7072 696e 7428 6974 656d 290a      print(item).
+00042350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042360: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00042370: 7272 7173 636f 7265 2069 6e20 6974 656d  rrqscore in item
+00042380: 2e6c 6f77 6572 2829 3a0a 2020 2020 2020  .lower():.      
+00042390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000423a0: 2020 2020 2020 2020 2020 6572 726c 696e            errlin
+000423b0: 6520 3d20 6974 656d 2e73 7472 6970 2829  e = item.strip()
+000423c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000423d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000423e0: 2065 7272 6c69 7374 2e61 7070 656e 6428   errlist.append(
+000423f0: 6572 726c 696e 6529 0a20 2020 2020 2020  errline).       
+00042400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042410: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00042420: 6572 7271 7363 6f72 6520 6e6f 7420 696e  errqscore not in
+00042430: 206f 7574 7075 742e 6465 636f 6465 2827   output.decode('
+00042440: 7574 662d 3827 292c 2065 7272 6c69 6e65  utf-8'), errline
+00042450: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042460: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00042470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042480: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
+00042490: 6f75 7470 7574 2e73 706c 6974 2827 5c6e  output.split('\n
+000424a0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
 000424b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000424c0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-000424d0: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
-000424e0: 6c69 6e65 290a 2020 2020 2020 2020 2020  line).          
-000424f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042500: 2020 2020 2020 6173 7365 7274 2065 7272        assert err
-00042510: 7173 636f 7265 206e 6f74 2069 6e20 6f75  qscore not in ou
-00042520: 7470 7574 2e64 6563 6f64 6528 2775 7466  tput.decode('utf
-00042530: 2d38 2729 2c20 6572 726c 696e 650a 2020  -8'), errline.  
+000424c0: 7072 696e 7428 6974 656d 290a 2020 2020  print(item).    
+000424d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000424e0: 2020 2020 2020 2020 6966 2065 7272 7173          if errqs
+000424f0: 636f 7265 2069 6e20 6974 656d 2e6c 6f77  core in item.low
+00042500: 6572 2829 3a0a 2020 2020 2020 2020 2020  er():.          
+00042510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042520: 2020 2020 2020 6572 726c 696e 6520 3d20        errline = 
+00042530: 6974 656d 2e73 7472 6970 2829 0a20 2020  item.strip().   
 00042540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042550: 2020 7365 6c66 2e70 6f73 7471 7363 6f72    self.postqscor
-00042560: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
-00042570: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00042550: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00042560: 6c69 7374 2e61 7070 656e 6428 6572 726c  list.append(errl
+00042570: 696e 6529 0a20 2020 2020 2020 2020 2020  ine).           
 00042580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042590: 2065 7272 203d 2027 512d 7363 6f72 6520   err = 'Q-score 
-000425a0: 6361 6c63 756c 6174 696f 6e20 6572 726f  calculation erro
-000425b0: 723a 207b 7d27 2e66 6f72 6d61 7428 7379  r: {}'.format(sy
-000425c0: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
-000425d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000425e0: 2020 2020 2070 7269 6e74 2874 7261 6365       print(trace
-000425f0: 6261 636b 2e66 6f72 6d61 745f 6578 6328  back.format_exc(
-00042600: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00042610: 2020 2020 2020 2065 7272 6c69 7374 2e61         errlist.a
-00042620: 7070 656e 6428 6572 7229 0a20 2020 2020  ppend(err).     
-00042630: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00042640: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00042650: 6572 7220 2b20 275c 6e27 290a 0a20 2020  err + '\n')..   
-00042660: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00042670: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00042680: 7269 6e74 2827 4368 696d 6572 6120 6973  rint('Chimera is
-00042690: 206e 6f74 2064 6574 6563 7465 6420 6f72   not detected or
-000426a0: 206e 6f20 6669 7474 6564 206d 6f64 656c   no fitted model
-000426b0: 2066 6f72 2074 6869 7320 656e 7472 792e   for this entry.
-000426c0: 2051 7363 6f72 6520 7769 6c6c 206e 6f74   Qscore will not
-000426d0: 2062 6520 6361 6c63 756c 6174 6564 2e27   be calculated.'
-000426e0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000426f0: 6e20 4e6f 6e65 0a0a 0a20 2020 2064 6566  n None...    def
-00042700: 2070 6f73 7471 7363 6f72 6528 7365 6c66   postqscore(self
-00042710: 293a 0a0a 2020 2020 2020 2020 2320 7365  ):..        # se
-00042720: 6c66 2e72 656e 616d 6571 6669 6c65 7328  lf.renameqfiles(
-00042730: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-00042740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00042750: 6e65 7772 6561 645f 7173 636f 7265 2829  newread_qscore()
-00042760: 0a20 2020 2020 2020 2020 2020 2076 746b  .            vtk
-00042770: 7061 636b 2c20 6368 696d 6572 6161 7070  pack, chimeraapp
-00042780: 203d 2073 656c 662e 7375 7266 6163 655f   = self.surface_
-00042790: 656e 7663 6865 636b 2829 0a20 2020 2020  envcheck().     
-000427a0: 2020 2020 2020 2073 656c 662e 7173 636f         self.qsco
-000427b0: 7265 7669 6577 2863 6869 6d65 7261 6170  review(chimeraap
-000427c0: 7029 0a20 2020 2020 2020 2065 7863 6570  p).        excep
-000427d0: 743a 0a20 2020 2020 2020 2020 2020 2065  t:.            e
-000427e0: 7272 203d 2027 512d 7363 6f72 6520 7265  rr = 'Q-score re
-000427f0: 7375 6c74 7320 7072 6f63 6573 7369 6e67  sults processing
-00042800: 2066 6169 6c65 643a 207b 7d27 2e66 6f72   failed: {}'.for
-00042810: 6d61 7428 7379 732e 6578 635f 696e 666f  mat(sys.exc_info
-00042820: 2829 5b31 5d29 0a20 2020 2020 2020 2020  ()[1]).         
-00042830: 2020 2070 7269 6e74 2874 7261 6365 6261     print(traceba
-00042840: 636b 2e66 6f72 6d61 745f 6578 6328 2929  ck.format_exc())
-00042850: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
-00042860: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
-00042870: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
-00042880: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
-00042890: 2020 2020 6465 6620 7265 6e61 6d65 7166      def renameqf
-000428a0: 696c 6573 2873 656c 6629 3a0a 2020 2020  iles(self):.    
-000428b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000428c0: 2020 2020 5265 6e61 6d65 2051 2d73 636f      Rename Q-sco
-000428d0: 7265 206f 7574 7075 7420 6669 6c65 7320  re output files 
-000428e0: 6966 2069 6e2d 6361 7365 2c20 7468 6579  if in-case, they
-000428f0: 2075 7365 202a 5f41 6c74 5f41 2f42 2e63   use *_Alt_A/B.c
-00042900: 6966 2074 6f20 7072 6f64 7563 6520 7468  if to produce th
-00042910: 6520 7265 7375 6c74 0a0a 2020 2020 2020  e result..      
-00042920: 2020 3a72 6574 7572 6e3a 0a20 2020 2020    :return:.     
-00042930: 2020 2022 2222 0a20 2020 2020 2020 2061     """.        a
-00042940: 6c74 6669 6c65 7320 3d20 676c 6f62 2e67  ltfiles = glob.g
-00042950: 6c6f 6228 277b 7d2f 2a2e 2a5f 416c 745f  lob('{}/*.*_Alt_
-00042960: 2a5f 5f51 5f5f 656d 645f 2a2e 7064 6227  *__Q__emd_*.pdb'
-00042970: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
-00042980: 6b64 6972 2929 0a20 2020 2020 2020 2069  kdir)).        i
-00042990: 6620 616c 7466 696c 6573 3a0a 2020 2020  f altfiles:.    
-000429a0: 2020 2020 2020 2020 666f 7220 616c 7466          for altf
-000429b0: 696c 6520 696e 2061 6c74 6669 6c65 733a  ile in altfiles:
-000429c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000429d0: 2061 6c74 6469 7220 3d20 6f73 2e70 6174   altdir = os.pat
-000429e0: 682e 6469 726e 616d 6528 616c 7466 696c  h.dirname(altfil
-000429f0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00042a00: 2020 2061 6c74 7064 6220 3d20 6f73 2e70     altpdb = os.p
-00042a10: 6174 682e 6261 7365 6e61 6d65 2861 6c74  ath.basename(alt
-00042a20: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-00042a30: 2020 2020 2020 6e65 7770 6462 203d 2072        newpdb = r
-00042a40: 652e 7375 6228 272e 6369 665f 416c 745f  e.sub('.cif_Alt_
-00042a50: 2e27 2c20 2727 2c20 616c 7470 6462 290a  .', '', altpdb).
-00042a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042a70: 616c 7474 7874 203d 2027 7b7d 5f41 6c6c  alttxt = '{}_All
-00042a80: 2e74 7874 272e 666f 726d 6174 2861 6c74  .txt'.format(alt
-00042a90: 7064 625b 3a2d 345d 290a 2020 2020 2020  pdb[:-4]).      
-00042aa0: 2020 2020 2020 2020 2020 6e65 7774 7874            newtxt
-00042ab0: 203d 2027 7b7d 5f41 6c6c 2e74 7874 272e   = '{}_All.txt'.
-00042ac0: 666f 726d 6174 286e 6577 7064 625b 3a2d  format(newpdb[:-
-00042ad0: 345d 290a 2020 2020 2020 2020 2020 2020  4]).            
-00042ae0: 2020 2020 6f73 2e72 656e 616d 6528 277b      os.rename('{
-00042af0: 7d2f 7b7d 272e 666f 726d 6174 2861 6c74  }/{}'.format(alt
-00042b00: 6469 722c 2061 6c74 7064 6229 2c20 277b  dir, altpdb), '{
-00042b10: 7d2f 7b7d 272e 666f 726d 6174 2861 6c74  }/{}'.format(alt
-00042b20: 6469 722c 206e 6577 7064 6229 290a 2020  dir, newpdb)).  
-00042b30: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00042b40: 2e72 656e 616d 6528 277b 7d2f 7b7d 272e  .rename('{}/{}'.
-00042b50: 666f 726d 6174 2861 6c74 6469 722c 2061  format(altdir, a
-00042b60: 6c74 7478 7429 2c20 277b 7d2f 7b7d 272e  lttxt), '{}/{}'.
-00042b70: 666f 726d 6174 2861 6c74 6469 722c 206e  format(altdir, n
-00042b80: 6577 7478 7429 290a 2020 2020 2020 2020  ewtxt)).        
-00042b90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00042ba0: 2020 7072 696e 7428 274e 6f20 616c 7465    print('No alte
-00042bb0: 726e 6174 6976 6520 636f 6f72 6469 6e61  rnative coordina
-00042bc0: 7465 7320 6578 6973 742e 2729 0a0a 2020  tes exist.')..  
-00042bd0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00042be0: 650a 0a20 2020 2064 6566 206e 6577 7265  e..    def newre
-00042bf0: 6164 5f71 7363 6f72 6528 7365 6c66 293a  ad_qscore(self):
-00042c00: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00042c10: 2020 2020 2020 2020 2020 4c6f 6164 2074            Load t
-00042c20: 6865 2051 2d73 636f 7265 2063 6966 2066  he Q-score cif f
-00042c30: 696c 6520 6d61 7463 6820 746f 2051 7363  ile match to Qsc
-00042c40: 6f72 6520 312e 382e 3220 2874 656d 7061  ore 1.8.2 (tempa
-00042c50: 7261 7279 290a 2020 2020 2020 2020 2020  rary).          
-00042c60: 2020 4f75 7470 7574 206a 736f 6e20 6669    Output json fi
-00042c70: 6c65 2077 6974 6820 512d 7363 6f72 6520  le with Q-score 
-00042c80: 696e 666f 726d 6174 696f 6e20 6465 7269  information deri
-00042c90: 7665 6420 6672 6f6d 2063 6966 2066 696c  ved from cif fil
-00042ca0: 650a 0a20 2020 2020 2020 203a 7265 7475  e..        :retu
-00042cb0: 726e 3a20 4e6f 6e65 0a20 2020 2020 2020  rn: None.       
-00042cc0: 2022 2222 0a0a 2020 2020 2020 2020 6d61   """..        ma
-00042cd0: 706e 616d 6520 3d20 7365 6c66 2e6d 6170  pname = self.map
-00042ce0: 6e61 6d65 0a20 2020 2020 2020 2071 6669  name.        qfi
-00042cf0: 6c65 7320 3d20 5b5d 0a20 2020 2020 2020  les = [].       
-00042d00: 2071 7363 6f72 6565 7272 6c69 7374 203d   qscoreerrlist =
-00042d10: 205b 5d0a 2020 2020 2020 2020 6d6f 6465   [].        mode
-00042d20: 6c6e 756d 203d 2030 0a20 2020 2020 2020  lnum = 0.       
-00042d30: 2071 7363 6f72 6564 6963 7420 3d20 4f72   qscoredict = Or
-00042d40: 6465 7265 6444 6963 7428 290a 2020 2020  deredDict().    
-00042d50: 2020 2020 6669 6e61 6c64 6963 7420 3d20      finaldict = 
-00042d60: 4f72 6465 7265 6444 6963 7428 290a 2020  OrderedDict().  
-00042d70: 2020 2020 2020 616c 6c6d 6f64 656c 735f        allmodels_
-00042d80: 6e75 6d62 6572 6f66 6174 6f6d 7320 3d20  numberofatoms = 
-00042d90: 300a 2020 2020 2020 2020 616c 6c6d 6f64  0.        allmod
-00042da0: 656c 735f 7173 636f 7265 7320 3d20 302e  els_qscores = 0.
-00042db0: 0a20 2020 2020 2020 2066 6f72 206d 6f64  .        for mod
-00042dc0: 656c 2069 6e20 7365 6c66 2e6d 6f64 656c  el in self.model
-00042dd0: 733a 0a20 2020 2020 2020 2020 2020 206f  s:.            o
-00042de0: 7267 6d6f 6465 6c20 3d20 6f73 2e70 6174  rgmodel = os.pat
-00042df0: 682e 6261 7365 6e61 6d65 286d 6f64 656c  h.basename(model
-00042e00: 2e66 696c 656e 616d 6529 0a20 2020 2020  .filename).     
-00042e10: 2020 2020 2020 2063 7572 6d6f 6465 6c20         curmodel 
-00042e20: 3d20 6f72 676d 6f64 656c 0a20 2020 2020  = orgmodel.     
-00042e30: 2020 2020 2020 2071 6669 6c65 203d 2027         qfile = '
-00042e40: 7b7d 7b7d 5f5f 515f 5f7b 7d2e 6369 6627  {}{}__Q__{}.cif'
-00042e50: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
-00042e60: 6b64 6972 2c20 6375 726d 6f64 656c 2c20  kdir, curmodel, 
-00042e70: 6d61 706e 616d 6529 0a20 2020 2020 2020  mapname).       
-00042e80: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00042e90: 6973 6669 6c65 2871 6669 6c65 293a 0a20  isfile(qfile):. 
-00042ea0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00042eb0: 203d 204d 4d43 4946 5061 7273 6572 2829   = MMCIFParser()
-00042ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042ed0: 2070 2e5f 6d6d 6369 665f 6469 6374 203d   p._mmcif_dict =
-00042ee0: 204d 4d43 4946 3244 6963 7428 7166 696c   MMCIF2Dict(qfil
-00042ef0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00042f00: 2020 2063 6f6f 7264 7320 3d20 7a69 7028     coords = zip(
-00042f10: 702e 5f6d 6d63 6966 5f64 6963 745b 275f  p._mmcif_dict['_
-00042f20: 6174 6f6d 5f73 6974 652e 4361 7274 6e5f  atom_site.Cartn_
-00042f30: 7827 5d2c 2070 2e5f 6d6d 6369 665f 6469  x'], p._mmcif_di
-00042f40: 6374 5b27 5f61 746f 6d5f 7369 7465 2e43  ct['_atom_site.C
-00042f50: 6172 746e 5f79 275d 2c20 702e 5f6d 6d63  artn_y'], p._mmc
-00042f60: 6966 5f64 6963 745b 275f 6174 6f6d 5f73  if_dict['_atom_s
-00042f70: 6974 652e 4361 7274 6e5f 7a27 5d29 0a20  ite.Cartn_z']). 
-00042f80: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-00042f90: 7363 6f72 6573 203d 2070 2e5f 6d6d 6369  scores = p._mmci
-00042fa0: 665f 6469 6374 5b27 5f61 746f 6d5f 7369  f_dict['_atom_si
-00042fb0: 7465 2e51 2d73 636f 7265 275d 0a20 2020  te.Q-score'].   
-00042fc0: 2020 2020 2020 2020 2020 2020 2063 6f6f               coo
-00042fd0: 7264 735f 7173 636f 7265 735f 6469 6374  rds_qscores_dict
-00042fe0: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
-00042ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043000: 2066 6f72 2063 6f6f 7264 2c20 7173 636f   for coord, qsco
-00043010: 7265 2069 6e20 7a69 7028 636f 6f72 6473  re in zip(coords
-00043020: 2c20 7173 636f 7265 7329 3a0a 2020 2020  , qscores):.    
-00043030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043040: 666c 6f61 745f 636f 6f72 6420 3d20 7475  float_coord = tu
-00043050: 706c 6528 6d61 7028 666c 6f61 742c 2063  ple(map(float, c
-00043060: 6f6f 7264 2929 0a20 2020 2020 2020 2020  oord)).         
-00043070: 2020 2020 2020 2020 2020 2023 206f 7267             # org
-00043080: 5f63 6f6f 7264 5f6b 6579 203d 2074 7570  _coord_key = tup
-00043090: 6c65 286d 6170 286c 616d 6264 6120 783a  le(map(lambda x:
-000430a0: 206d 6174 682e 666c 6f6f 7228 7820 2a20   math.floor(x * 
-000430b0: 3130 202a 2a20 3229 202f 2031 3020 2a2a  10 ** 2) / 10 **
-000430c0: 2032 2c20 666c 6f61 745f 636f 6f72 6429   2, float_coord)
-000430d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000430e0: 2020 2020 2020 6f72 675f 636f 6f72 645f        org_coord_
-000430f0: 6b65 7920 3d20 7475 706c 6528 6d61 7028  key = tuple(map(
-00043100: 6c61 6d62 6461 2078 3a20 6d61 7468 2e66  lambda x: math.f
-00043110: 6c6f 6f72 2878 292c 2066 6c6f 6174 5f63  loor(x), float_c
-00043120: 6f6f 7264 2929 0a20 2020 2020 2020 2020  oord)).         
-00043130: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
-00043140: 735f 7173 636f 7265 735f 6469 6374 5b6f  s_qscores_dict[o
-00043150: 7267 5f63 6f6f 7264 5f6b 6579 5d20 3d20  rg_coord_key] = 
-00043160: 666c 6f61 7428 7173 636f 7265 2920 6966  float(qscore) if
-00043170: 2071 7363 6f72 6520 213d 2027 3f27 2065   qscore != '?' e
-00043180: 6c73 6520 302e 0a20 2020 2020 2020 2020  lse 0..         
-00043190: 2020 2020 2020 2070 7173 636f 7265 6369         pqscoreci
-000431a0: 6620 3d20 702e 6765 745f 7374 7275 6374  f = p.get_struct
-000431b0: 7572 6528 7166 696c 652c 2071 6669 6c65  ure(qfile, qfile
-000431c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000431d0: 2020 666f 7220 6174 6f6d 2069 6e20 7071    for atom in pq
-000431e0: 7363 6f72 6563 6966 2e67 6574 5f61 746f  scorecif.get_ato
-000431f0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00043200: 2020 2020 2020 2020 2020 2320 636f 6f72            # coor
-00043210: 645f 6b65 7920 3d20 7475 706c 6528 6d61  d_key = tuple(ma
-00043220: 7028 666c 6f61 742c 206d 6170 2873 7472  p(float, map(str
-00043230: 2c20 6174 6f6d 2e63 6f6f 7264 2929 290a  , atom.coord))).
-00043240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043250: 2020 2020 636f 6f72 645f 6b65 7920 3d20      coord_key = 
-00043260: 7475 706c 6528 6d61 7028 666c 6f61 742c  tuple(map(float,
-00043270: 2074 7570 6c65 286d 6170 2873 7472 2c20   tuple(map(str, 
-00043280: 6174 6f6d 2e63 6f6f 7264 2929 2929 0a20  atom.coord)))). 
-00043290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000432a0: 2020 2023 206e 6577 5f63 6f6f 7264 5f6b     # new_coord_k
-000432b0: 6579 203d 2074 7570 6c65 286d 6170 286c  ey = tuple(map(l
-000432c0: 616d 6264 6120 783a 206d 6174 682e 666c  ambda x: math.fl
-000432d0: 6f6f 7228 7820 2a20 3130 202a 2a20 3229  oor(x * 10 ** 2)
-000432e0: 202f 2031 3020 2a2a 2032 2c20 636f 6f72   / 10 ** 2, coor
-000432f0: 645f 6b65 7929 290a 2020 2020 2020 2020  d_key)).        
-00043300: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00043310: 636f 6f72 645f 6b65 7920 3d20 7475 706c  coord_key = tupl
-00043320: 6528 6d61 7028 6c61 6d62 6461 2078 3a20  e(map(lambda x: 
-00043330: 6d61 7468 2e66 6c6f 6f72 2878 292c 2063  math.floor(x), c
-00043340: 6f6f 7264 5f6b 6579 2929 0a20 2020 2020  oord_key)).     
-00043350: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00043360: 6574 6174 7472 2861 746f 6d2c 2027 7173  etattr(atom, 'qs
-00043370: 636f 7265 272c 2063 6f6f 7264 735f 7173  core', coords_qs
-00043380: 636f 7265 735f 6469 6374 5b6e 6577 5f63  cores_dict[new_c
-00043390: 6f6f 7264 5f6b 6579 5d29 0a20 2020 2020  oord_key]).     
-000433a0: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
-000433b0: 6563 6966 203d 2070 7173 636f 7265 6369  ecif = pqscoreci
-000433c0: 6620 6966 206c 656e 2870 7173 636f 7265  f if len(pqscore
-000433d0: 6369 662e 6765 745f 6c69 7374 2829 2920  cif.get_list()) 
-000433e0: 3d3d 2031 2065 6c73 6520 7071 7363 6f72  == 1 else pqscor
-000433f0: 6563 6966 5b30 5d0a 2020 2020 2020 2020  ecif[0].        
-00043400: 2020 2020 2020 2020 7166 696c 6573 2e61          qfiles.a
-00043410: 7070 656e 6428 7173 636f 7265 6369 6629  ppend(qscorecif)
-00043420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043430: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00043440: 2020 2020 2020 2020 2020 6369 6664 6963            cifdic
-00043450: 7420 3d20 7365 6c66 2e6e 6577 6369 665f  t = self.newcif_
-00043460: 746f 7164 6963 7428 7173 636f 7265 6369  toqdict(qscoreci
-00043470: 662c 206f 7267 6d6f 6465 6c29 0a20 2020  f, orgmodel).   
-00043480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043490: 2061 6c6c 6d6f 6465 6c73 5f6e 756d 6265   allmodels_numbe
-000434a0: 726f 6661 746f 6d73 202b 3d20 6369 6664  rofatoms += cifd
-000434b0: 6963 745b 2764 6174 6127 5d5b 276e 756d  ict['data']['num
-000434c0: 6265 726f 6661 746f 6d73 275d 0a20 2020  berofatoms'].   
-000434d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000434e0: 2061 6c6c 6d6f 6465 6c73 5f71 7363 6f72   allmodels_qscor
-000434f0: 6573 202b 3d20 6369 6664 6963 745b 2764  es += cifdict['d
-00043500: 6174 6127 5d5b 276e 756d 6265 726f 6661  ata']['numberofa
-00043510: 746f 6d73 275d 2a63 6966 6469 6374 5b27  toms']*cifdict['
-00043520: 6461 7461 275d 5b27 6176 6572 6167 6571  data']['averageq
-00043530: 7363 6f72 6527 5d0a 2020 2020 2020 2020  score'].        
-00043540: 2020 2020 2020 2020 2020 2020 7173 636f              qsco
-00043550: 7265 6469 6374 5b73 7472 286d 6f64 656c  redict[str(model
-00043560: 6e75 6d29 5d20 3d20 6369 6664 6963 740a  num)] = cifdict.
-00043570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043580: 2020 2020 6d6f 6465 6c6e 756d 202b 3d20      modelnum += 
-00043590: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000435a0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-000435b0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-000435c0: 7220 3d20 2751 7363 6f72 6520 6361 6c63  r = 'Qscore calc
-000435d0: 756c 6174 696f 6e20 6572 726f 7220 284d  ulation error (M
-000435e0: 6f64 656c 3a20 7b7d 293a 207b 7d2e 272e  odel: {}): {}.'.
-000435f0: 666f 726d 6174 286d 6f64 656c 2e66 696c  format(model.fil
-00043600: 656e 616d 652c 2073 7973 2e65 7863 5f69  ename, sys.exc_i
-00043610: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
-00043620: 2020 2020 2020 2020 2020 2020 2020 7173                qs
-00043630: 636f 7265 6572 726c 6973 742e 6170 7065  coreerrlist.appe
-00043640: 6e64 2865 7272 290a 2020 2020 2020 2020  nd(err).        
-00043650: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00043660: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
-00043670: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
-00043680: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00043690: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000436a0: 2056 616c 7565 4572 726f 720a 2020 2020   ValueError.    
-000436b0: 2020 2020 6966 2061 6c6c 6d6f 6465 6c73      if allmodels
-000436c0: 5f6e 756d 6265 726f 6661 746f 6d73 2021  _numberofatoms !
-000436d0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000436e0: 2061 6c6c 6d6f 6465 6c73 5f61 7665 7261   allmodels_avera
-000436f0: 6765 5f71 7363 6f72 6520 3d20 616c 6c6d  ge_qscore = allm
-00043700: 6f64 656c 735f 7173 636f 7265 7320 2f20  odels_qscores / 
-00043710: 616c 6c6d 6f64 656c 735f 6e75 6d62 6572  allmodels_number
-00043720: 6f66 6174 6f6d 730a 2020 2020 2020 2020  ofatoms.        
-00043730: 2020 2020 2320 7173 636f 7265 6469 6374      # qscoredict
-00043740: 2e75 7064 6174 6528 7b27 616c 6c6d 6f64  .update({'allmod
-00043750: 656c 735f 6176 6572 6167 655f 7173 636f  els_average_qsco
-00043760: 7265 273a 2072 6f75 6e64 2861 6c6c 6d6f  re': round(allmo
-00043770: 6465 6c73 5f61 7665 7261 6765 5f71 7363  dels_average_qsc
-00043780: 6f72 652c 2033 297d 290a 2020 2020 2020  ore, 3)}).      
-00043790: 2020 2020 2020 7173 636f 7265 6469 6374        qscoredict
-000437a0: 5b27 616c 6c6d 6f64 656c 735f 6176 6572  ['allmodels_aver
-000437b0: 6167 655f 7173 636f 7265 275d 203d 2072  age_qscore'] = r
-000437c0: 6f75 6e64 2861 6c6c 6d6f 6465 6c73 5f61  ound(allmodels_a
-000437d0: 7665 7261 6765 5f71 7363 6f72 652c 2033  verage_qscore, 3
-000437e0: 290a 2020 2020 2020 2020 6966 2071 7363  ).        if qsc
-000437f0: 6f72 6564 6963 743a 0a20 2020 2020 2020  oredict:.       
-00043800: 2020 2020 2066 696e 616c 6469 6374 5b27       finaldict['
-00043810: 7173 636f 7265 275d 203d 2071 7363 6f72  qscore'] = qscor
-00043820: 6564 6963 740a 2020 2020 2020 2020 2020  edict.          
-00043830: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00043840: 2020 2020 2020 2077 6974 6820 636f 6465         with code
-00043850: 6373 2e6f 7065 6e28 7365 6c66 2e77 6f72  cs.open(self.wor
-00043860: 6b64 6972 202b 2073 656c 662e 6d61 706e  kdir + self.mapn
-00043870: 616d 6520 2b20 275f 7173 636f 7265 2e6a  ame + '_qscore.j
-00043880: 736f 6e27 2c20 2777 272c 0a20 2020 2020  son', 'w',.     
-00043890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000438a0: 2020 2020 2020 2020 2020 2020 656e 636f              enco
-000438b0: 6469 6e67 3d27 7574 662d 3827 2920 6173  ding='utf-8') as
-000438c0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-000438d0: 2020 2020 2020 2020 6a73 6f6e 2e64 756d          json.dum
-000438e0: 7028 6669 6e61 6c64 6963 742c 2066 290a  p(finaldict, f).
-000438f0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00043900: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-00043910: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00043920: 7269 7465 2827 5361 7669 6e67 2074 6f20  rite('Saving to 
-00043930: 5173 636f 7265 206a 736f 6e20 6572 726f  Qscore json erro
-00043940: 723a 207b 7d2e 5c6e 272e 666f 726d 6174  r: {}.\n'.format
-00043950: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-00043960: 315d 2929 0a20 2020 2020 2020 2065 6c73  1])).        els
-00043970: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00043980: 7269 6e74 2827 5173 636f 7265 2077 6173  rint('Qscore was
-00043990: 206e 6f74 2063 6f6c 6c65 6374 6564 2c20   not collected, 
-000439a0: 706c 6561 7365 2063 6865 636b 2127 290a  please check!').
-000439b0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000439c0: 204e 6f6e 650a 0a20 2020 2064 6566 206e   None..    def n
-000439d0: 6577 6369 665f 746f 7164 6963 7428 7365  ewcif_toqdict(se
-000439e0: 6c66 2c20 7173 636f 7265 6369 662c 206f  lf, qscorecif, o
-000439f0: 7267 6d6f 6465 6c29 3a0a 2020 2020 2020  rgmodel):.      
-00043a00: 2020 2222 220a 0a20 2020 2020 2020 2020    """..         
-00043a10: 2020 2047 6976 656e 2063 6966 2062 696f     Given cif bio
-00043a20: 7079 7468 6f6e 206f 626a 6563 7420 616e  python object an
-00043a30: 6420 636f 6e76 6572 7420 746f 2061 2064  d convert to a d
-00043a40: 6963 746f 7279 2077 6869 6368 2063 6f6e  ictory which con
-00043a50: 7461 696e 7320 616c 6c20 6461 7461 2066  tains all data f
-00043a60: 6f72 204a 534f 4e0a 0a20 2020 2020 2020  or JSON..       
-00043a70: 203a 7265 7475 726e 3a20 4449 4354 2063   :return: DICT c
-00043a80: 6f6e 7461 696e 7320 512d 7363 6f72 6520  ontains Q-score 
-00043a90: 6461 7461 2066 726f 6d20 6d6d 6369 6620  data from mmcif 
-00043aa0: 2862 696f 7079 7468 6f6e 206f 626a 6563  (biopython objec
-00043ab0: 7429 0a20 2020 2020 2020 2022 2222 0a0a  t).        """..
-00043ac0: 0a20 2020 2020 2020 2072 6573 6964 7565  .        residue
-00043ad0: 7320 3d20 5b5d 0a20 2020 2020 2020 2063  s = [].        c
-00043ae0: 6f6c 6f72 7320 3d20 5b5d 0a20 2020 2020  olors = [].     
-00043af0: 2020 2071 7363 6f72 6573 203d 205b 5d0a     qscores = [].
-00043b00: 2020 2020 2020 2020 6368 6169 6e5f 7173          chain_qs
-00043b10: 636f 7265 203d 207b 7d0a 2020 2020 2020  core = {}.      
-00043b20: 2020 7173 636f 7265 5f6c 6973 7420 3d20    qscore_list = 
-00043b30: 5b61 746f 6d2e 7173 636f 7265 2066 6f72  [atom.qscore for
-00043b40: 2061 746f 6d20 696e 2071 7363 6f72 6563   atom in qscorec
-00043b50: 6966 2e67 6574 5f61 746f 6d73 2829 2069  if.get_atoms() i
-00043b60: 6620 6174 6f6d 2e71 7363 6f72 6520 3e20  f atom.qscore > 
-00043b70: 312e 305d 0a20 2020 2020 2020 2070 726f  1.0].        pro
-00043b80: 7465 696e 5f71 7363 6f72 6573 203d 205b  tein_qscores = [
-00043b90: 5d0a 2020 2020 2020 2020 666f 7220 6174  ].        for at
-00043ba0: 6f6d 2069 6e20 7173 636f 7265 6369 662e  om in qscorecif.
-00043bb0: 6765 745f 6174 6f6d 7328 293a 0a20 2020  get_atoms():.   
-00043bc0: 2020 2020 2020 2020 2069 6620 6174 6f6d           if atom
-00043bd0: 2e6e 616d 652e 7374 6172 7473 7769 7468  .name.startswith
-00043be0: 2827 4827 2920 6f72 2061 746f 6d2e 6765  ('H') or atom.ge
-00043bf0: 745f 7061 7265 6e74 2829 2e72 6573 6e61  t_parent().resna
-00043c00: 6d65 203d 3d20 2748 4f48 273a 0a20 2020  me == 'HOH':.   
-00043c10: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00043c20: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00043c30: 2020 7072 6f74 6569 6e5f 7173 636f 7265    protein_qscore
-00043c40: 732e 6170 7065 6e64 2861 746f 6d2e 7173  s.append(atom.qs
-00043c50: 636f 7265 290a 2020 2020 2020 2020 6176  core).        av
-00043c60: 6572 6167 655f 7173 636f 7265 203d 2072  erage_qscore = r
-00043c70: 6f75 6e64 2873 756d 2870 726f 7465 696e  ound(sum(protein
-00043c80: 5f71 7363 6f72 6573 2920 2f20 6c65 6e28  _qscores) / len(
-00043c90: 7072 6f74 6569 6e5f 7173 636f 7265 7329  protein_qscores)
-00043ca0: 2c20 3329 0a20 2020 2020 2020 2069 6620  , 3).        if 
-00043cb0: 7173 636f 7265 5f6c 6973 743a 0a20 2020  qscore_list:.   
-00043cc0: 2020 2020 2020 2020 206d 696e 5f71 7363           min_qsc
-00043cd0: 6f72 6520 3d20 6d69 6e28 7173 636f 7265  ore = min(qscore
-00043ce0: 5f6c 6973 7429 0a20 2020 2020 2020 2020  _list).         
-00043cf0: 2020 206d 6178 5f71 7363 6f72 6520 3d20     max_qscore = 
-00043d00: 6d61 7828 7173 636f 7265 5f6c 6973 7429  max(qscore_list)
-00043d10: 0a20 2020 2020 2020 2066 6f72 2063 6861  .        for cha
-00043d20: 696e 2069 6e20 7173 636f 7265 6369 662e  in in qscorecif.
-00043d30: 6765 745f 6368 6169 6e73 2829 3a0a 2020  get_chains():.  
-00043d40: 2020 2020 2020 2020 2020 6375 7263 6861            curcha
-00043d50: 696e 5f6e 616d 6520 3d20 6368 6169 6e2e  in_name = chain.
-00043d60: 6964 0a20 2020 2020 2020 2020 2020 2063  id.            c
-00043d70: 7572 6368 6169 6e5f 7173 636f 7265 203d  urchain_qscore =
-00043d80: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00043d90: 666f 7220 6174 6f6d 2069 6e20 6368 6169  for atom in chai
-00043da0: 6e2e 6765 745f 6174 6f6d 7328 293a 0a20  n.get_atoms():. 
-00043db0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00043dc0: 6620 6174 6f6d 2e6e 616d 652e 7374 6172  f atom.name.star
-00043dd0: 7473 7769 7468 2827 4827 2920 6f72 2061  tswith('H') or a
-00043de0: 746f 6d2e 6765 745f 7061 7265 6e74 2829  tom.get_parent()
-00043df0: 2e72 6573 6e61 6d65 203d 3d20 2748 4f48  .resname == 'HOH
-00043e00: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00043e10: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00043e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043e30: 6375 7263 6861 696e 5f71 7363 6f72 652e  curchain_qscore.
-00043e40: 6170 7065 6e64 2861 746f 6d2e 7173 636f  append(atom.qsco
-00043e50: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-00043e60: 6966 206e 6f74 2063 7572 6368 6169 6e5f  if not curchain_
-00043e70: 7173 636f 7265 3a0a 2020 2020 2020 2020  qscore:.        
-00043e80: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00043e90: 0a20 2020 2020 2020 2020 2020 2061 7665  .            ave
-00043ea0: 7261 6765 6375 7263 6861 696e 5f71 7363  ragecurchain_qsc
-00043eb0: 6f72 6520 3d20 726f 756e 6428 7375 6d28  ore = round(sum(
-00043ec0: 6375 7263 6861 696e 5f71 7363 6f72 6529  curchain_qscore)
-00043ed0: 202f 206c 656e 2863 7572 6368 6169 6e5f   / len(curchain_
-00043ee0: 7173 636f 7265 292c 2033 290a 2020 2020  qscore), 3).    
-00043ef0: 2020 2020 2020 2020 6174 6f6d 735f 696e          atoms_in
-00043f00: 6368 6169 6e20 3d20 300a 2020 2020 2020  chain = 0.      
-00043f10: 2020 2020 2020 7173 636f 7265 5f69 6e63        qscore_inc
-00043f20: 6861 696e 203d 2030 2e0a 2020 2020 2020  hain = 0..      
-00043f30: 2020 2020 2020 666f 7220 7265 7369 6475        for residu
-00043f40: 6520 696e 2063 6861 696e 3a0a 2020 2020  e in chain:.    
-00043f50: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00043f60: 6573 5f6e 616d 6520 3d20 7265 7369 6475  es_name = residu
-00043f70: 652e 7265 736e 616d 650a 2020 2020 2020  e.resname.      
-00043f80: 2020 2020 2020 2020 2020 6966 2063 7572            if cur
-00043f90: 7265 735f 6e61 6d65 203d 3d20 2748 4f48  res_name == 'HOH
-00043fa0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00043fb0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00043fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043fd0: 6375 7272 6573 5f69 6420 3d20 7265 7369  curres_id = resi
-00043fe0: 6475 652e 6964 5b31 5d0a 2020 2020 2020  due.id[1].      
-00043ff0: 2020 2020 2020 2020 2020 6174 6f6d 735f            atoms_
-00044000: 696e 7265 7369 6475 6520 3d20 300a 2020  inresidue = 0.  
-00044010: 2020 2020 2020 2020 2020 2020 2020 7173                qs
-00044020: 636f 7265 5f69 6e72 6573 6964 7565 203d  core_inresidue =
-00044030: 2030 2e0a 2020 2020 2020 2020 2020 2020   0..            
-00044040: 2020 2020 666f 7220 6174 6f6d 2069 6e20      for atom in 
-00044050: 7265 7369 6475 653a 0a20 2020 2020 2020  residue:.       
-00044060: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00044070: 6174 6f6d 2e6e 616d 652e 7374 6172 7473  atom.name.starts
-00044080: 7769 7468 2827 4827 2920 6f72 2061 746f  with('H') or ato
-00044090: 6d2e 6765 745f 7061 7265 6e74 2829 2e72  m.get_parent().r
-000440a0: 6573 6e61 6d65 203d 3d20 2748 4f48 273a  esname == 'HOH':
-000440b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000440c0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-000440d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000440e0: 2020 2020 2020 6174 6f6d 735f 696e 6368        atoms_inch
-000440f0: 6169 6e20 2b3d 2031 0a20 2020 2020 2020  ain += 1.       
-00044100: 2020 2020 2020 2020 2020 2020 2061 746f               ato
-00044110: 6d73 5f69 6e72 6573 6964 7565 202b 3d20  ms_inresidue += 
-00044120: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00044130: 2020 2020 2020 6375 7261 746f 6d5f 7173        curatom_qs
-00044140: 636f 7265 203d 2061 746f 6d2e 7173 636f  core = atom.qsco
-00044150: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
-00044160: 2020 2020 2020 2071 7363 6f72 655f 696e         qscore_in
-00044170: 6368 6169 6e20 2b3d 2063 7572 6174 6f6d  chain += curatom
-00044180: 5f71 7363 6f72 650a 2020 2020 2020 2020  _qscore.        
-00044190: 2020 2020 2020 2020 2020 2020 7173 636f              qsco
-000441a0: 7265 5f69 6e72 6573 6964 7565 202b 3d20  re_inresidue += 
-000441b0: 6375 7261 746f 6d5f 7173 636f 7265 0a20  curatom_qscore. 
-000441c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000441d0: 6620 6174 6f6d 735f 696e 7265 7369 6475  f atoms_inresidu
-000441e0: 6520 213d 2030 2e3a 0a20 2020 2020 2020  e != 0.:.       
-000441f0: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00044200: 7265 735f 7173 636f 7265 203d 2072 6f75  res_qscore = rou
-00044210: 6e64 2871 7363 6f72 655f 696e 7265 7369  nd(qscore_inresi
-00044220: 6475 6520 2f20 6174 6f6d 735f 696e 7265  due / atoms_inre
-00044230: 7369 6475 652c 2033 290a 2020 2020 2020  sidue, 3).      
-00044240: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00044250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044260: 2020 2020 6375 7272 6573 5f71 7363 6f72      curres_qscor
-00044270: 6520 3d20 302e 0a20 2020 2020 2020 2020  e = 0..         
-00044280: 2020 2020 2020 2069 6620 6375 7272 6573         if curres
-00044290: 5f71 7363 6f72 6520 3e20 312e 303a 0a20  _qscore > 1.0:. 
-000442a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000442b0: 2020 2069 6620 6d69 6e5f 7173 636f 7265     if min_qscore
-000442c0: 203d 3d20 6d61 785f 7173 636f 7265 3a0a   == max_qscore:.
-000442d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000442e0: 2020 2020 2020 2020 6375 7272 6573 5f63          curres_c
-000442f0: 6f6c 6f72 203d 2027 2330 3030 3030 3027  olor = '#000000'
-00044300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044310: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00044320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044330: 2020 2073 6361 6c65 645f 7173 636f 7265     scaled_qscore
-00044340: 203d 2028 6375 7272 6573 5f71 7363 6f72   = (curres_qscor
-00044350: 6520 2d20 6d69 6e5f 7173 636f 7265 2920  e - min_qscore) 
-00044360: 2f20 286d 6178 5f71 7363 6f72 6520 2d20  / (max_qscore - 
-00044370: 6d69 6e5f 7173 636f 7265 290a 2020 2020  min_qscore).    
-00044380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044390: 2020 2020 6375 7272 6573 5f63 6f6c 6f72      curres_color
-000443a0: 203d 2073 656c 662e 5f5f 666c 6f61 746f   = self.__floato
-000443b0: 6865 785f 6162 6f76 656f 6e65 285b 7363  hex_aboveone([sc
-000443c0: 616c 6564 5f71 7363 6f72 655d 295b 305d  aled_qscore])[0]
-000443d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000443e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000443f0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00044400: 735f 636f 6c6f 7220 3d20 7365 6c66 2e5f  s_color = self._
-00044410: 5f66 6c6f 6174 6f68 6578 285b 6375 7272  _floatohex([curr
-00044420: 6573 5f71 7363 6f72 655d 295b 305d 0a0a  es_qscore])[0]..
-00044430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044440: 6963 6f64 6520 3d20 7265 7369 6475 652e  icode = residue.
-00044450: 6964 5b32 5d0a 2020 2020 2020 2020 2020  id[2].          
-00044460: 2020 2020 2020 6966 2069 636f 6465 2021        if icode !
-00044470: 3d20 2720 273a 0a20 2020 2020 2020 2020  = ' ':.         
-00044480: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00044490: 735f 7374 7269 6e67 203d 2027 7b7d 3a7b  s_string = '{}:{
-000444a0: 7d7b 7d20 7b7d 272e 666f 726d 6174 2863  }{} {}'.format(c
-000444b0: 7572 6368 6169 6e5f 6e61 6d65 2c20 6375  urchain_name, cu
-000444c0: 7272 6573 5f69 642c 2069 636f 6465 2c20  rres_id, icode, 
-000444d0: 6375 7272 6573 5f6e 616d 6529 0a20 2020  curres_name).   
-000444e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000444f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00044500: 2020 2020 2020 2063 7572 7265 735f 7374         curres_st
-00044510: 7269 6e67 203d 2027 7b7d 3a7b 7d20 7b7d  ring = '{}:{} {}
-00044520: 272e 666f 726d 6174 2863 7572 6368 6169  '.format(curchai
-00044530: 6e5f 6e61 6d65 2c20 6375 7272 6573 5f69  n_name, curres_i
-00044540: 642c 2063 7572 7265 735f 6e61 6d65 290a  d, curres_name).
-00044550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044560: 7265 7369 6475 6573 2e61 7070 656e 6428  residues.append(
-00044570: 6375 7272 6573 5f73 7472 696e 6729 0a20  curres_string). 
-00044580: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00044590: 6f6c 6f72 732e 6170 7065 6e64 2863 7572  olors.append(cur
-000445a0: 7265 735f 636f 6c6f 7229 0a20 2020 2020  res_color).     
-000445b0: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
-000445c0: 6573 2e61 7070 656e 6428 6375 7272 6573  es.append(curres
-000445d0: 5f71 7363 6f72 6529 0a20 2020 2020 2020  _qscore).       
-000445e0: 2020 2020 2061 7665 7261 6765 7173 636f       averageqsco
-000445f0: 7265 5f69 6e63 6f6c 6f72 203d 2073 656c  re_incolor = sel
-00044600: 662e 5f5f 666c 6f61 746f 6865 7828 5b61  f.__floatohex([a
-00044610: 7665 7261 6765 6375 7263 6861 696e 5f71  veragecurchain_q
-00044620: 7363 6f72 655d 295b 305d 0a20 2020 2020  score])[0].     
-00044630: 2020 2020 2020 2063 6861 696e 5f71 7363         chain_qsc
-00044640: 6f72 655b 6375 7263 6861 696e 5f6e 616d  ore[curchain_nam
-00044650: 655d 203d 207b 2776 616c 7565 273a 2061  e] = {'value': a
-00044660: 7665 7261 6765 6375 7263 6861 696e 5f71  veragecurchain_q
-00044670: 7363 6f72 652c 2027 636f 6c6f 7227 3a20  score, 'color': 
-00044680: 6176 6572 6167 6571 7363 6f72 655f 696e  averageqscore_in
-00044690: 636f 6c6f 727d 0a0a 2020 2020 2020 2020  color}..        
-000446a0: 6c65 7665 6c73 203d 206e 702e 6c69 6e73  levels = np.lins
-000446b0: 7061 6365 282d 312c 2031 2c20 3130 3029  pace(-1, 1, 100)
-000446c0: 0a20 2020 2020 2020 2071 6172 7261 7920  .        qarray 
-000446d0: 3d20 6e70 2e61 7272 6179 2871 7363 6f72  = np.array(qscor
-000446e0: 6573 290a 2020 2020 2020 2020 6869 7374  es).        hist
-000446f0: 2c20 6269 6e5f 6564 6765 7320 3d20 6e70  , bin_edges = np
-00044700: 2e68 6973 746f 6772 616d 2871 6172 7261  .histogram(qarra
-00044710: 792c 2062 696e 733d 6c65 7665 6c73 290a  y, bins=levels).
-00044720: 2020 2020 2020 2020 706c 742e 706c 6f74          plt.plot
-00044730: 2862 696e 5f65 6467 6573 5b31 3a5d 2c20  (bin_edges[1:], 
-00044740: 6869 7374 2f71 6172 7261 792e 7369 7a65  hist/qarray.size
-00044750: 290a 0a20 2020 2020 2020 2070 726f 7465  )..        prote
-00044760: 696e 5f71 6172 7261 7920 3d20 6e70 2e61  in_qarray = np.a
-00044770: 7272 6179 2870 726f 7465 696e 5f71 7363  rray(protein_qsc
-00044780: 6f72 6573 290a 2020 2020 2020 2020 7068  ores).        ph
-00044790: 6973 742c 2070 5f62 696e 5f65 6467 6573  ist, p_bin_edges
-000447a0: 203d 206e 702e 6869 7374 6f67 7261 6d28   = np.histogram(
-000447b0: 7072 6f74 6569 6e5f 7161 7272 6179 2c20  protein_qarray, 
-000447c0: 6269 6e73 3d6c 6576 656c 7329 0a20 2020  bins=levels).   
-000447d0: 2020 2020 2070 6c74 2e70 6c6f 7428 705f       plt.plot(p_
-000447e0: 6269 6e5f 6564 6765 735b 313a 5d2c 2070  bin_edges[1:], p
-000447f0: 6869 7374 2f70 726f 7465 696e 5f71 6172  hist/protein_qar
-00044800: 7261 792e 7369 7a65 290a 2020 2020 2020  ray.size).      
-00044810: 2020 706c 742e 786c 6162 656c 2827 512d    plt.xlabel('Q-
-00044820: 7363 6f72 6527 290a 2020 2020 2020 2020  score').        
-00044830: 706c 742e 796c 6162 656c 2827 4672 6163  plt.ylabel('Frac
-00044840: 7469 6f6e 2729 0a20 2020 2020 2020 2070  tion').        p
-00044850: 6c74 2e6c 6567 656e 6428 2827 5265 7369  lt.legend(('Resi
-00044860: 6475 653a 2027 202b 2027 2827 202b 2073  due: ' + '(' + s
-00044870: 7472 2871 6172 7261 792e 7369 7a65 2920  tr(qarray.size) 
-00044880: 2b20 2729 272c 2027 4174 6f6d 3a20 2720  + ')', 'Atom: ' 
-00044890: 2b20 2728 2720 2b20 7374 7228 7072 6f74  + '(' + str(prot
-000448a0: 6569 6e5f 7161 7272 6179 2e73 697a 6529  ein_qarray.size)
-000448b0: 202b 2027 2927 292c 206c 6f63 3d27 7570   + ')'), loc='up
-000448c0: 7065 7220 6c65 6674 272c 2073 6861 646f  per left', shado
-000448d0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-000448e0: 6966 2073 656c 662e 6d61 706e 616d 6520  if self.mapname 
-000448f0: 616e 6420 7365 6c66 2e72 6573 6f6c 7574  and self.resolut
-00044900: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00044910: 2070 6c74 2e74 6974 6c65 2827 4d61 703a   plt.title('Map:
-00044920: 2027 202b 2073 656c 662e 6d61 706e 616d   ' + self.mapnam
-00044930: 6520 2b20 2720 6174 3a20 2720 2b20 7374  e + ' at: ' + st
-00044940: 7228 7365 6c66 2e72 6573 6f6c 7574 696f  r(self.resolutio
-00044950: 6e29 202b 2027 c385 2729 0a20 2020 2020  n) + '..').     
-00044960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00044970: 2020 2020 2070 6c74 2e74 6974 6c65 2827       plt.title('
-00044980: 4d61 7020 512d 7363 6f72 6520 2729 0a20  Map Q-score '). 
-00044990: 2020 2020 2020 2070 6c74 2e73 6176 6566         plt.savef
-000449a0: 6967 2873 656c 662e 776f 726b 6469 7220  ig(self.workdir 
-000449b0: 2b20 7365 6c66 2e6d 6170 6e61 6d65 202b  + self.mapname +
-000449c0: 2027 5f71 7363 6f72 652e 706e 6727 290a   '_qscore.png').
-000449d0: 2020 2020 2020 2020 706c 742e 636c 6f73          plt.clos
-000449e0: 6528 290a 2020 2020 2020 2020 715f 7265  e().        q_re
-000449f0: 7369 6475 655f 6672 6163 7469 6f6e 7320  sidue_fractions 
-00044a00: 3d20 6c69 7374 286e 702e 6172 6f75 6e64  = list(np.around
-00044a10: 2868 6973 742f 7161 7272 6179 2e73 697a  (hist/qarray.siz
-00044a20: 652c 2033 2929 0a20 2020 2020 2020 2071  e, 3)).        q
-00044a30: 5f70 726f 7465 696e 5f66 7261 6374 696f  _protein_fractio
-00044a40: 6e73 203d 206c 6973 7428 6e70 2e61 726f  ns = list(np.aro
-00044a50: 756e 6428 7068 6973 742f 7072 6f74 6569  und(phist/protei
-00044a60: 6e5f 7161 7272 6179 2e73 697a 652c 2033  n_qarray.size, 3
-00044a70: 2929 0a20 2020 2020 2020 2071 6672 6163  )).        qfrac
-00044a80: 7469 6f6e 7320 3d20 7b27 714c 6576 656c  tions = {'qLevel
-00044a90: 7327 3a20 6c69 7374 286e 702e 6172 6f75  s': list(np.arou
-00044aa0: 6e64 286c 6576 656c 735b 313a 5d2c 2033  nd(levels[1:], 3
-00044ab0: 2929 2c20 2771 5265 7369 6475 6546 7261  )), 'qResidueFra
-00044ac0: 6374 696f 6e73 273a 2071 5f72 6573 6964  ctions': q_resid
-00044ad0: 7565 5f66 7261 6374 696f 6e73 2c0a 2020  ue_fractions,.  
-00044ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044af0: 2020 2020 2771 4174 6f6d 4672 6163 7469      'qAtomFracti
-00044b00: 6f6e 7327 3a20 715f 7072 6f74 6569 6e5f  ons': q_protein_
-00044b10: 6672 6163 7469 6f6e 737d 0a0a 2020 2020  fractions}..    
-00044b20: 2020 2020 2320 7363 6f72 655f 7479 7065      # score_type
-00044b30: 203d 2027 7173 636f 7265 270a 2020 2020   = 'qscore'.    
-00044b40: 2020 2020 2320 6e65 775f 6469 6374 203d      # new_dict =
-00044b50: 207b 2769 6427 3a20 7365 6c66 2e65 6d64   {'id': self.emd
-00044b60: 6964 2c20 2772 6573 6f6c 7574 696f 6e27  id, 'resolution'
-00044b70: 3a20 666c 6f61 7428 7365 6c66 2e72 6573  : float(self.res
-00044b80: 6f6c 7574 696f 6e29 2c20 276e 616d 6527  olution), 'name'
-00044b90: 3a20 6f72 676d 6f64 656c 2c20 7363 6f72  : orgmodel, scor
-00044ba0: 655f 7479 7065 3a20 6176 6572 6167 655f  e_type: average_
-00044bb0: 7173 636f 7265 7d0a 2020 2020 2020 2020  qscore}.        
-00044bc0: 2320 706c 6f74 5f6e 616d 6520 3d20 277b  # plot_name = '{
-00044bd0: 7d5f 7b7d 5f7b 7d5f 6261 722e 706e 6727  }_{}_{}_bar.png'
-00044be0: 2e66 6f72 6d61 7428 7365 6c66 2e6d 6170  .format(self.map
-00044bf0: 6e61 6d65 2c20 6f72 676d 6f64 656c 2c20  name, orgmodel, 
-00044c00: 7363 6f72 655f 7479 7065 290a 2020 2020  score_type).    
-00044c10: 2020 2020 2320 7363 6f72 655f 6469 7220      # score_dir 
-00044c20: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00044c30: 6528 7661 2e5f 5f66 696c 655f 5f29 0a20  e(va.__file__). 
-00044c40: 2020 2020 2020 2023 2072 656c 6174 6976         # relativ
-00044c50: 655f 746f 7768 6f6c 652c 2072 656c 6174  e_towhole, relat
-00044c60: 6976 655f 746f 7477 6f20 3d20 6261 7228  ive_totwo = bar(
-00044c70: 6e65 775f 6469 6374 2c20 7363 6f72 655f  new_dict, score_
-00044c80: 7479 7065 2c20 7365 6c66 2e77 6f72 6b64  type, self.workd
-00044c90: 6972 2c20 7363 6f72 655f 6469 722c 2070  ir, score_dir, p
-00044ca0: 6c6f 745f 6e61 6d65 290a 2020 2020 2020  lot_name).      
-00044cb0: 2020 2320 7162 6172 203d 207b 2777 686f    # qbar = {'who
-00044cc0: 6c65 273a 2072 656c 6174 6976 655f 746f  le': relative_to
-00044cd0: 7768 6f6c 652c 2027 7265 6c61 7469 7665  whole, 'relative
-00044ce0: 273a 2072 656c 6174 6976 655f 746f 7477  ': relative_totw
-00044cf0: 6f7d 0a0a 2020 2020 2020 2020 7464 6963  o}..        tdic
-00044d00: 7420 3d20 4f72 6465 7265 6444 6963 7428  t = OrderedDict(
-00044d10: 5b0a 2020 2020 2020 2020 2020 2020 2827  [.            ('
-00044d20: 6176 6572 6167 6571 7363 6f72 6527 2c20  averageqscore', 
-00044d30: 6176 6572 6167 655f 7173 636f 7265 292c  average_qscore),
-00044d40: 0a20 2020 2020 2020 2020 2020 2028 2761  .            ('a
-00044d50: 7665 7261 6765 7173 636f 7265 5f63 6f6c  verageqscore_col
-00044d60: 6f72 272c 2073 656c 662e 5f5f 666c 6f61  or', self.__floa
-00044d70: 746f 6865 7828 5b61 7665 7261 6765 5f71  tohex([average_q
-00044d80: 7363 6f72 655d 295b 305d 292c 0a20 2020  score])[0]),.   
-00044d90: 2020 2020 2020 2020 2023 2028 2771 7363           # ('qsc
-00044da0: 6f72 655f 6261 7227 2c20 7162 6172 292c  ore_bar', qbar),
-00044db0: 0a20 2020 2020 2020 2020 2020 2028 276e  .            ('n
-00044dc0: 756d 6265 726f 6661 746f 6d73 272c 206c  umberofatoms', l
-00044dd0: 656e 2870 726f 7465 696e 5f71 7363 6f72  en(protein_qscor
-00044de0: 6573 2929 2c0a 2020 2020 2020 2020 2020  es)),.          
-00044df0: 2020 2827 636f 6c6f 7227 2c20 636f 6c6f    ('color', colo
-00044e00: 7273 292c 0a20 2020 2020 2020 2020 2020  rs),.           
-00044e10: 2028 2769 6e63 6c75 7369 6f6e 272c 2071   ('inclusion', q
-00044e20: 7363 6f72 6573 292c 0a20 2020 2020 2020  scores),.       
-00044e30: 2020 2020 2028 2771 7363 6f72 6527 2c20       ('qscore', 
-00044e40: 7173 636f 7265 7329 2c0a 2020 2020 2020  qscores),.      
-00044e50: 2020 2020 2020 2827 7265 7369 6475 6527        ('residue'
-00044e60: 2c20 7265 7369 6475 6573 292c 0a20 2020  , residues),.   
-00044e70: 2020 2020 2020 2020 2028 2763 6861 696e           ('chain
-00044e80: 7173 636f 7265 272c 2063 6861 696e 5f71  qscore', chain_q
-00044e90: 7363 6f72 6529 2c0a 2020 2020 2020 2020  score),.        
-00044ea0: 2020 2020 2827 7146 7261 6374 696f 6e44      ('qFractionD
-00044eb0: 6973 7472 6962 7574 696f 6e27 2c20 7166  istribution', qf
-00044ec0: 7261 6374 696f 6e73 290a 2020 2020 2020  ractions).      
-00044ed0: 2020 5d29 0a0a 0a20 2020 2020 2020 2072    ])...        r
-00044ee0: 6573 756c 7464 6963 7420 3d20 4f72 6465  esultdict = Orde
-00044ef0: 7265 6444 6963 7428 5b28 276e 616d 6527  redDict([('name'
-00044f00: 2c20 6f72 676d 6f64 656c 292c 2028 2764  , orgmodel), ('d
-00044f10: 6174 6127 2c20 7464 6963 7429 5d29 0a0a  ata', tdict)])..
-00044f20: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00044f30: 6573 756c 7464 6963 740a 0a0a 2020 2020  esultdict...    
-00044f40: 6465 6620 7265 6164 7173 636f 7265 2873  def readqscore(s
-00044f50: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00044f60: 220a 0a20 2020 2020 2020 2020 2020 204c  "..            L
-00044f70: 6f61 6420 7468 6520 512d 7363 6f72 6520  oad the Q-score 
-00044f80: 7064 6220 6669 6c65 2874 656d 7061 7261  pdb file(tempara
-00044f90: 7279 290a 0a20 2020 2020 2020 203a 7265  ry)..        :re
-00044fa0: 7475 726e 3a0a 2020 2020 2020 2020 2222  turn:.        ""
-00044fb0: 220a 0a20 2020 2020 2020 206d 6170 6e61  "..        mapna
-00044fc0: 6d65 203d 2073 656c 662e 6d61 706e 616d  me = self.mapnam
-00044fd0: 655b 3a2d 345d 0a20 2020 2020 2020 2071  e[:-4].        q
-00044fe0: 6669 6c65 7320 3d20 5b5d 0a20 2020 2020  files = [].     
-00044ff0: 2020 2071 7363 6f72 6565 7272 6c69 7374     qscoreerrlist
-00045000: 203d 205b 5d0a 2020 2020 2020 2020 7265   = [].        re
-00045010: 7375 6c74 203d 207b 7d0a 2020 2020 2020  sult = {}.      
-00045020: 2020 6d6f 6465 6c6e 756d 203d 2030 0a20    modelnum = 0. 
-00045030: 2020 2020 2020 2071 7363 6f72 6564 6963         qscoredic
-00045040: 7420 3d20 4f72 6465 7265 6444 6963 7428  t = OrderedDict(
-00045050: 290a 2020 2020 2020 2020 6669 6e61 6c64  ).        finald
-00045060: 6963 7420 3d20 4f72 6465 7265 6444 6963  ict = OrderedDic
-00045070: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
-00045080: 6d6f 6465 6c20 696e 2073 656c 662e 6d6f  model in self.mo
-00045090: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
-000450a0: 2020 6f72 676d 6f64 656c 203d 206f 732e    orgmodel = os.
-000450b0: 7061 7468 2e62 6173 656e 616d 6528 6d6f  path.basename(mo
-000450c0: 6465 6c2e 6669 6c65 6e61 6d65 290a 2020  del.filename).  
-000450d0: 2020 2020 2020 2020 2020 6375 726d 6f64            curmod
-000450e0: 656c 203d 206f 7267 6d6f 6465 6c5b 3a2d  el = orgmodel[:-
-000450f0: 345d 0a20 2020 2020 2020 2020 2020 2071  4].            q
-00045100: 6669 6c65 203d 2027 7b7d 7b7d 5f5f 515f  file = '{}{}__Q_
-00045110: 5f7b 7d2e 7064 6227 2e66 6f72 6d61 7428  _{}.pdb'.format(
-00045120: 7365 6c66 2e77 6f72 6b64 6972 2c20 6375  self.workdir, cu
-00045130: 726d 6f64 656c 2c20 6d61 706e 616d 6529  rmodel, mapname)
-00045140: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00045150: 6f73 2e70 6174 682e 6973 6669 6c65 2871  os.path.isfile(q
-00045160: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-00045170: 2020 2020 2020 2070 203d 206f 7267 5044         p = orgPD
-00045180: 4250 6172 7365 7228 290a 2020 2020 2020  BParser().      
-00045190: 2020 2020 2020 2020 2020 7071 7363 6f72            pqscor
-000451a0: 6570 6462 203d 2070 2e67 6574 5f73 7472  epdb = p.get_str
-000451b0: 7563 7475 7265 2827 6d79 7166 696c 6527  ucture('myqfile'
-000451c0: 2c20 7166 696c 6529 0a20 2020 2020 2020  , qfile).       
-000451d0: 2020 2020 2020 2020 2071 7363 6f72 6570           qscorep
-000451e0: 6462 203d 2070 7173 636f 7265 7064 6220  db = pqscorepdb 
-000451f0: 6966 206c 656e 2870 7173 636f 7265 7064  if len(pqscorepd
-00045200: 622e 6765 745f 6c69 7374 2829 2920 3d3d  b.get_list()) ==
-00045210: 2031 2065 6c73 6520 7071 7363 6f72 6570   1 else pqscorep
-00045220: 6462 5b30 5d0a 2020 2020 2020 2020 2020  db[0].          
-00045230: 2020 2020 2020 7166 696c 6573 2e61 7070        qfiles.app
-00045240: 656e 6428 7173 636f 7265 7064 6229 0a20  end(qscorepdb). 
-00045250: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00045260: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00045270: 2020 2020 2020 2020 2320 7173 636f 7265          # qscore
-00045280: 6469 6374 5b73 7472 286d 6f64 656c 6e75  dict[str(modelnu
-00045290: 6d29 5d20 3d20 7365 6c66 2e70 6462 746f  m)] = self.pdbto
-000452a0: 7164 6963 7428 7173 636f 7265 7064 622c  qdict(qscorepdb,
-000452b0: 206f 7267 6d6f 6465 6c29 0a20 2020 2020   orgmodel).     
-000452c0: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-000452d0: 7363 6f72 6564 6963 745b 7374 7228 6d6f  scoredict[str(mo
-000452e0: 6465 6c6e 756d 295d 203d 2073 656c 662e  delnum)] = self.
-000452f0: 6e65 7770 6462 746f 7164 6963 7428 7173  newpdbtoqdict(qs
-00045300: 636f 7265 7064 622c 206f 7267 6d6f 6465  corepdb, orgmode
-00045310: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-00045320: 2020 2020 2020 206d 6f64 656c 6e75 6d20         modelnum 
-00045330: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00045340: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-00045350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045360: 2065 7272 203d 2027 5173 636f 7265 2063   err = 'Qscore c
-00045370: 616c 6375 6c61 7469 6f6e 2065 7272 6f72  alculation error
-00045380: 2028 4d6f 6465 6c3a 207b 7d29 3a20 7b7d   (Model: {}): {}
-00045390: 2e27 2e66 6f72 6d61 7428 6d6f 6465 6c2e  .'.format(model.
-000453a0: 6669 6c65 6e61 6d65 2c20 7379 732e 6578  filename, sys.ex
-000453b0: 635f 696e 666f 2829 5b31 5d29 0a20 2020  c_info()[1]).   
-000453c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000453d0: 2071 7363 6f72 6565 7272 6c69 7374 2e61   qscoreerrlist.a
-000453e0: 7070 656e 6428 6572 7229 0a20 2020 2020  ppend(err).     
-000453f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00045400: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00045410: 6572 7220 2b20 275c 6e27 290a 2020 2020  err + '\n').    
-00045420: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00045430: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00045440: 6973 6520 5661 6c75 6545 7272 6f72 0a0a  ise ValueError..
-00045450: 2020 2020 2020 2020 6966 2071 7363 6f72          if qscor
-00045460: 6564 6963 743a 0a20 2020 2020 2020 2020  edict:.         
-00045470: 2020 2066 696e 616c 6469 6374 5b27 7173     finaldict['qs
-00045480: 636f 7265 275d 203d 2071 7363 6f72 6564  core'] = qscored
-00045490: 6963 740a 2020 2020 2020 2020 2020 2020  ict.            
-000454a0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000454b0: 2020 2020 2077 6974 6820 636f 6465 6373       with codecs
-000454c0: 2e6f 7065 6e28 7365 6c66 2e77 6f72 6b64  .open(self.workd
-000454d0: 6972 202b 2073 656c 662e 6d61 706e 616d  ir + self.mapnam
-000454e0: 6520 2b20 275f 7173 636f 7265 2e6a 736f  e + '_qscore.jso
-000454f0: 6e27 2c20 2777 272c 0a20 2020 2020 2020  n', 'w',.       
-00045500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045510: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
-00045520: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
-00045530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00045540: 2020 2020 2020 6a73 6f6e 2e64 756d 7028        json.dump(
-00045550: 6669 6e61 6c64 6963 742c 2066 290a 2020  finaldict, f).  
-00045560: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00045570: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00045580: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-00045590: 7465 2827 5361 7669 6e67 2074 6f20 5173  te('Saving to Qs
-000455a0: 636f 7265 206a 736f 6e20 6572 726f 723a  core json error:
-000455b0: 207b 7d2e 5c6e 272e 666f 726d 6174 2873   {}.\n'.format(s
-000455c0: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
-000455d0: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-000455e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000455f0: 6e74 2827 5173 636f 7265 2077 6173 206e  nt('Qscore was n
-00045600: 6f74 2063 6f6c 6c65 6374 6564 2c20 706c  ot collected, pl
-00045610: 6561 7365 2063 6865 636b 2127 290a 0a0a  ease check!')...
-00045620: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00045630: 6f6e 650a 0a20 2020 2064 6566 206e 6577  one..    def new
-00045640: 7064 6274 6f71 6469 6374 2873 656c 662c  pdbtoqdict(self,
-00045650: 2071 7363 6f72 6570 6462 2c20 6f72 676d   qscorepdb, orgm
-00045660: 6f64 656c 293a 0a20 2020 2020 2020 2022  odel):.        "
-00045670: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-00045680: 4769 7665 6e20 7064 6220 6269 6f70 7974  Given pdb biopyt
-00045690: 686f 6e20 6f62 6a65 6374 2061 6e64 2063  hon object and c
-000456a0: 6f6e 7665 7274 2074 6f20 6120 6469 6374  onvert to a dict
-000456b0: 2077 6869 6368 2063 6f6e 7461 696e 7320   which contains 
-000456c0: 616c 6c20 6461 7461 2066 6f72 204a 534f  all data for JSO
-000456d0: 4e0a 0a20 2020 2020 2020 203a 7265 7475  N..        :retu
-000456e0: 726e 3a20 4449 4354 2063 6f6e 7461 696e  rn: DICT contain
-000456f0: 7320 616c 6c20 6461 7461 0a20 2020 2020  s all data.     
-00045700: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00045710: 7265 7369 6475 6573 203d 205b 5d0a 2020  residues = [].  
-00045720: 2020 2020 2020 636f 6c6f 7273 203d 205b        colors = [
-00045730: 5d0a 2020 2020 2020 2020 7173 636f 7265  ].        qscore
-00045740: 7320 3d20 5b5d 0a20 2020 2020 2020 2063  s = [].        c
-00045750: 6861 696e 5f71 7363 6f72 6520 3d20 7b7d  hain_qscore = {}
-00045760: 0a20 2020 2020 2020 2071 7363 6f72 655f  .        qscore_
-00045770: 6c69 7374 203d 205b 6174 6f6d 2e62 6661  list = [atom.bfa
-00045780: 6374 6f72 2066 6f72 2061 746f 6d20 696e  ctor for atom in
-00045790: 2071 7363 6f72 6570 6462 2e67 6574 5f61   qscorepdb.get_a
-000457a0: 746f 6d73 2829 2069 6620 6174 6f6d 2e62  toms() if atom.b
-000457b0: 6661 6374 6f72 203e 2031 2e30 5d0a 2020  factor > 1.0].  
-000457c0: 2020 2020 2020 7072 6f74 6569 6e5f 7173        protein_qs
-000457d0: 636f 7265 7320 3d20 5b5d 0a20 2020 2020  cores = [].     
-000457e0: 2020 2066 6f72 2061 746f 6d20 696e 2071     for atom in q
-000457f0: 7363 6f72 6570 6462 2e67 6574 5f61 746f  scorepdb.get_ato
-00045800: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00045810: 2020 6966 2061 746f 6d2e 6e61 6d65 2e73    if atom.name.s
-00045820: 7461 7274 7377 6974 6828 2748 2729 206f  tartswith('H') o
-00045830: 7220 6174 6f6d 2e67 6574 5f70 6172 656e  r atom.get_paren
-00045840: 7428 292e 7265 736e 616d 6520 3d3d 2027  t().resname == '
-00045850: 484f 4827 206f 7220 6174 6f6d 2e62 6661  HOH' or atom.bfa
-00045860: 6374 6f72 203e 3d20 312e 303a 0a20 2020  ctor >= 1.0:.   
-00045870: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00045880: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00045890: 2020 7072 6f74 6569 6e5f 7173 636f 7265    protein_qscore
-000458a0: 732e 6170 7065 6e64 2861 746f 6d2e 6266  s.append(atom.bf
-000458b0: 6163 746f 7229 0a20 2020 2020 2020 2061  actor).        a
-000458c0: 7665 7261 6765 5f71 7363 6f72 6520 3d20  verage_qscore = 
-000458d0: 726f 756e 6428 7375 6d28 7072 6f74 6569  round(sum(protei
-000458e0: 6e5f 7173 636f 7265 7329 202f 206c 656e  n_qscores) / len
-000458f0: 2870 726f 7465 696e 5f71 7363 6f72 6573  (protein_qscores
-00045900: 292c 2033 290a 2020 2020 2020 2020 6966  ), 3).        if
-00045910: 2071 7363 6f72 655f 6c69 7374 3a0a 2020   qscore_list:.  
-00045920: 2020 2020 2020 2020 2020 6d69 6e5f 7173            min_qs
-00045930: 636f 7265 203d 206d 696e 2871 7363 6f72  core = min(qscor
-00045940: 655f 6c69 7374 290a 2020 2020 2020 2020  e_list).        
-00045950: 2020 2020 6d61 785f 7173 636f 7265 203d      max_qscore =
-00045960: 206d 6178 2871 7363 6f72 655f 6c69 7374   max(qscore_list
-00045970: 290a 2020 2020 2020 2020 666f 7220 6368  ).        for ch
-00045980: 6169 6e20 696e 2071 7363 6f72 6570 6462  ain in qscorepdb
-00045990: 2e67 6574 5f63 6861 696e 7328 293a 0a20  .get_chains():. 
-000459a0: 2020 2020 2020 2020 2020 2063 7572 6368             curch
-000459b0: 6169 6e5f 6e61 6d65 203d 2063 6861 696e  ain_name = chain
-000459c0: 2e69 640a 2020 2020 2020 2020 2020 2020  .id.            
-000459d0: 6375 7263 6861 696e 5f71 7363 6f72 6520  curchain_qscore 
-000459e0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-000459f0: 2066 6f72 2061 746f 6d20 696e 2063 6861   for atom in cha
-00045a00: 696e 2e67 6574 5f61 746f 6d73 2829 3a0a  in.get_atoms():.
-00045a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045a20: 6966 2061 746f 6d2e 6e61 6d65 2e73 7461  if atom.name.sta
-00045a30: 7274 7377 6974 6828 2748 2729 206f 7220  rtswith('H') or 
-00045a40: 6174 6f6d 2e67 6574 5f70 6172 656e 7428  atom.get_parent(
-00045a50: 292e 7265 736e 616d 6520 3d3d 2027 484f  ).resname == 'HO
-00045a60: 4827 206f 7220 6174 6f6d 2e62 6661 6374  H' or atom.bfact
-00045a70: 6f72 203e 3d20 312e 303a 0a20 2020 2020  or >= 1.0:.     
-00045a80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00045a90: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-00045aa0: 2020 2020 2020 2020 6375 7263 6861 696e          curchain
-00045ab0: 5f71 7363 6f72 652e 6170 7065 6e64 2861  _qscore.append(a
-00045ac0: 746f 6d2e 6266 6163 746f 7229 0a20 2020  tom.bfactor).   
-00045ad0: 2020 2020 2020 2020 2061 7665 7261 6765           average
-00045ae0: 6375 7263 6861 696e 5f71 7363 6f72 6520  curchain_qscore 
-00045af0: 3d20 726f 756e 6428 7375 6d28 6375 7263  = round(sum(curc
-00045b00: 6861 696e 5f71 7363 6f72 6529 202f 206c  hain_qscore) / l
-00045b10: 656e 2863 7572 6368 6169 6e5f 7173 636f  en(curchain_qsco
-00045b20: 7265 292c 2033 290a 2020 2020 2020 2020  re), 3).        
-00045b30: 2020 2020 6174 6f6d 735f 696e 6368 6169      atoms_inchai
-00045b40: 6e20 3d20 300a 2020 2020 2020 2020 2020  n = 0.          
-00045b50: 2020 7173 636f 7265 5f69 6e63 6861 696e    qscore_inchain
-00045b60: 203d 2030 2e0a 2020 2020 2020 2020 2020   = 0..          
-00045b70: 2020 666f 7220 7265 7369 6475 6520 696e    for residue in
-00045b80: 2063 6861 696e 3a0a 2020 2020 2020 2020   chain:.        
-00045b90: 2020 2020 2020 2020 6375 7272 6573 5f6e          curres_n
-00045ba0: 616d 6520 3d20 7265 7369 6475 652e 7265  ame = residue.re
-00045bb0: 736e 616d 650a 2020 2020 2020 2020 2020  sname.          
-00045bc0: 2020 2020 2020 6966 2063 7572 7265 735f        if curres_
-00045bd0: 6e61 6d65 203d 3d20 2748 4f48 273a 0a20  name == 'HOH':. 
-00045be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045bf0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00045c00: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00045c10: 6573 5f69 6420 3d20 7265 7369 6475 652e  es_id = residue.
-00045c20: 6964 5b31 5d0a 2020 2020 2020 2020 2020  id[1].          
-00045c30: 2020 2020 2020 6174 6f6d 735f 696e 7265        atoms_inre
-00045c40: 7369 6475 6520 3d20 300a 2020 2020 2020  sidue = 0.      
-00045c50: 2020 2020 2020 2020 2020 7173 636f 7265            qscore
-00045c60: 5f69 6e72 6573 6964 7565 203d 2030 2e0a  _inresidue = 0..
+00042590: 2020 2020 2061 7373 6572 7420 6572 7271       assert errq
+000425a0: 7363 6f72 6520 6e6f 7420 696e 206f 7574  score not in out
+000425b0: 7075 742e 6465 636f 6465 2827 7574 662d  put.decode('utf-
+000425c0: 3827 292c 2065 7272 6c69 6e65 0a20 2020  8'), errline.   
+000425d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000425e0: 2073 656c 662e 706f 7374 7173 636f 7265   self.postqscore
+000425f0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00042600: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+00042610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042620: 6572 7220 3d20 2751 2d73 636f 7265 2063  err = 'Q-score c
+00042630: 616c 6375 6c61 7469 6f6e 2065 7272 6f72  alculation error
+00042640: 3a20 7b7d 272e 666f 726d 6174 2873 7973  : {}'.format(sys
+00042650: 2e65 7863 5f69 6e66 6f28 295b 315d 290a  .exc_info()[1]).
+00042660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042670: 2020 2020 7072 696e 7428 7472 6163 6562      print(traceb
+00042680: 6163 6b2e 666f 726d 6174 5f65 7863 2829  ack.format_exc()
+00042690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000426a0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+000426b0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+000426c0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+000426d0: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
+000426e0: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
+000426f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00042700: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00042710: 696e 7428 2743 6869 6d65 7261 2069 7320  int('Chimera is 
+00042720: 6e6f 7420 6465 7465 6374 6564 206f 7220  not detected or 
+00042730: 6e6f 2066 6974 7465 6420 6d6f 6465 6c20  no fitted model 
+00042740: 666f 7220 7468 6973 2065 6e74 7279 2e20  for this entry. 
+00042750: 5173 636f 7265 2077 696c 6c20 6e6f 7420  Qscore will not 
+00042760: 6265 2063 616c 6375 6c61 7465 642e 2729  be calculated.')
+00042770: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00042780: 204e 6f6e 650a 0a0a 2020 2020 6465 6620   None...    def 
+00042790: 706f 7374 7173 636f 7265 2873 656c 6629  postqscore(self)
+000427a0: 3a0a 0a20 2020 2020 2020 2023 2073 656c  :..        # sel
+000427b0: 662e 7265 6e61 6d65 7166 696c 6573 2829  f.renameqfiles()
+000427c0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000427d0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
+000427e0: 6577 7265 6164 5f71 7363 6f72 6528 290a  ewread_qscore().
+000427f0: 2020 2020 2020 2020 2020 2020 7674 6b70              vtkp
+00042800: 6163 6b2c 2063 6869 6d65 7261 6170 7020  ack, chimeraapp 
+00042810: 3d20 7365 6c66 2e73 7572 6661 6365 5f65  = self.surface_e
+00042820: 6e76 6368 6563 6b28 290a 2020 2020 2020  nvcheck().      
+00042830: 2020 2020 2020 7365 6c66 2e71 7363 6f72        self.qscor
+00042840: 6576 6965 7728 6368 696d 6572 6161 7070  eview(chimeraapp
+00042850: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00042860: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
+00042870: 7220 3d20 2751 2d73 636f 7265 2072 6573  r = 'Q-score res
+00042880: 756c 7473 2070 726f 6365 7373 696e 6720  ults processing 
+00042890: 6661 696c 6564 3a20 7b7d 272e 666f 726d  failed: {}'.form
+000428a0: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
+000428b0: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+000428c0: 2020 7072 696e 7428 7472 6163 6562 6163    print(tracebac
+000428d0: 6b2e 666f 726d 6174 5f65 7863 2829 290a  k.format_exc()).
+000428e0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+000428f0: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
+00042900: 202b 2027 5c6e 2729 0a0a 2020 2020 2020   + '\n')..      
+00042910: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+00042920: 2020 2064 6566 2072 656e 616d 6571 6669     def renameqfi
+00042930: 6c65 7328 7365 6c66 293a 0a20 2020 2020  les(self):.     
+00042940: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+00042950: 2020 2052 656e 616d 6520 512d 7363 6f72     Rename Q-scor
+00042960: 6520 6f75 7470 7574 2066 696c 6573 2069  e output files i
+00042970: 6620 696e 2d63 6173 652c 2074 6865 7920  f in-case, they 
+00042980: 7573 6520 2a5f 416c 745f 412f 422e 6369  use *_Alt_A/B.ci
+00042990: 6620 746f 2070 726f 6475 6365 2074 6865  f to produce the
+000429a0: 2072 6573 756c 740a 0a20 2020 2020 2020   result..       
+000429b0: 203a 7265 7475 726e 3a0a 2020 2020 2020   :return:.      
+000429c0: 2020 2222 220a 2020 2020 2020 2020 616c    """.        al
+000429d0: 7466 696c 6573 203d 2067 6c6f 622e 676c  tfiles = glob.gl
+000429e0: 6f62 2827 7b7d 2f2a 2e2a 5f41 6c74 5f2a  ob('{}/*.*_Alt_*
+000429f0: 5f5f 515f 5f65 6d64 5f2a 2e70 6462 272e  __Q__emd_*.pdb'.
+00042a00: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
+00042a10: 6469 7229 290a 2020 2020 2020 2020 6966  dir)).        if
+00042a20: 2061 6c74 6669 6c65 733a 0a20 2020 2020   altfiles:.     
+00042a30: 2020 2020 2020 2066 6f72 2061 6c74 6669         for altfi
+00042a40: 6c65 2069 6e20 616c 7466 696c 6573 3a0a  le in altfiles:.
+00042a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a60: 616c 7464 6972 203d 206f 732e 7061 7468  altdir = os.path
+00042a70: 2e64 6972 6e61 6d65 2861 6c74 6669 6c65  .dirname(altfile
+00042a80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00042a90: 2020 616c 7470 6462 203d 206f 732e 7061    altpdb = os.pa
+00042aa0: 7468 2e62 6173 656e 616d 6528 616c 7466  th.basename(altf
+00042ab0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00042ac0: 2020 2020 206e 6577 7064 6220 3d20 7265       newpdb = re
+00042ad0: 2e73 7562 2827 2e63 6966 5f41 6c74 5f2e  .sub('.cif_Alt_.
+00042ae0: 272c 2027 272c 2061 6c74 7064 6229 0a20  ', '', altpdb). 
+00042af0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00042b00: 6c74 7478 7420 3d20 277b 7d5f 416c 6c2e  lttxt = '{}_All.
+00042b10: 7478 7427 2e66 6f72 6d61 7428 616c 7470  txt'.format(altp
+00042b20: 6462 5b3a 2d34 5d29 0a20 2020 2020 2020  db[:-4]).       
+00042b30: 2020 2020 2020 2020 206e 6577 7478 7420           newtxt 
+00042b40: 3d20 277b 7d5f 416c 6c2e 7478 7427 2e66  = '{}_All.txt'.f
+00042b50: 6f72 6d61 7428 6e65 7770 6462 5b3a 2d34  ormat(newpdb[:-4
+00042b60: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00042b70: 2020 206f 732e 7265 6e61 6d65 2827 7b7d     os.rename('{}
+00042b80: 2f7b 7d27 2e66 6f72 6d61 7428 616c 7464  /{}'.format(altd
+00042b90: 6972 2c20 616c 7470 6462 292c 2027 7b7d  ir, altpdb), '{}
+00042ba0: 2f7b 7d27 2e66 6f72 6d61 7428 616c 7464  /{}'.format(altd
+00042bb0: 6972 2c20 6e65 7770 6462 2929 0a20 2020  ir, newpdb)).   
+00042bc0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+00042bd0: 7265 6e61 6d65 2827 7b7d 2f7b 7d27 2e66  rename('{}/{}'.f
+00042be0: 6f72 6d61 7428 616c 7464 6972 2c20 616c  ormat(altdir, al
+00042bf0: 7474 7874 292c 2027 7b7d 2f7b 7d27 2e66  ttxt), '{}/{}'.f
+00042c00: 6f72 6d61 7428 616c 7464 6972 2c20 6e65  ormat(altdir, ne
+00042c10: 7774 7874 2929 0a20 2020 2020 2020 2065  wtxt)).        e
+00042c20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00042c30: 2070 7269 6e74 2827 4e6f 2061 6c74 6572   print('No alter
+00042c40: 6e61 7469 7665 2063 6f6f 7264 696e 6174  native coordinat
+00042c50: 6573 2065 7869 7374 2e27 290a 0a20 2020  es exist.')..   
+00042c60: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00042c70: 0a0a 2020 2020 6465 6620 6e65 7772 6561  ..    def newrea
+00042c80: 645f 7173 636f 7265 2873 656c 6629 3a0a  d_qscore(self):.
+00042c90: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00042ca0: 2020 2020 2020 2020 204c 6f61 6420 7468           Load th
+00042cb0: 6520 512d 7363 6f72 6520 6369 6620 6669  e Q-score cif fi
+00042cc0: 6c65 206d 6174 6368 2074 6f20 5173 636f  le match to Qsco
+00042cd0: 7265 2031 2e38 2e32 2028 7465 6d70 6172  re 1.8.2 (tempar
+00042ce0: 6172 7929 0a20 2020 2020 2020 2020 2020  ary).           
+00042cf0: 204f 7574 7075 7420 6a73 6f6e 2066 696c   Output json fil
+00042d00: 6520 7769 7468 2051 2d73 636f 7265 2069  e with Q-score i
+00042d10: 6e66 6f72 6d61 7469 6f6e 2064 6572 6976  nformation deriv
+00042d20: 6564 2066 726f 6d20 6369 6620 6669 6c65  ed from cif file
+00042d30: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00042d40: 6e3a 204e 6f6e 650a 2020 2020 2020 2020  n: None.        
+00042d50: 2222 220a 0a20 2020 2020 2020 206d 6170  """..        map
+00042d60: 6e61 6d65 203d 2073 656c 662e 6d61 706e  name = self.mapn
+00042d70: 616d 650a 2020 2020 2020 2020 7166 696c  ame.        qfil
+00042d80: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
+00042d90: 7173 636f 7265 6572 726c 6973 7420 3d20  qscoreerrlist = 
+00042da0: 5b5d 0a20 2020 2020 2020 206d 6f64 656c  [].        model
+00042db0: 6e75 6d20 3d20 300a 2020 2020 2020 2020  num = 0.        
+00042dc0: 7173 636f 7265 6469 6374 203d 204f 7264  qscoredict = Ord
+00042dd0: 6572 6564 4469 6374 2829 0a20 2020 2020  eredDict().     
+00042de0: 2020 2066 696e 616c 6469 6374 203d 204f     finaldict = O
+00042df0: 7264 6572 6564 4469 6374 2829 0a20 2020  rderedDict().   
+00042e00: 2020 2020 2061 6c6c 6d6f 6465 6c73 5f6e       allmodels_n
+00042e10: 756d 6265 726f 6661 746f 6d73 203d 2030  umberofatoms = 0
+00042e20: 0a20 2020 2020 2020 2061 6c6c 6d6f 6465  .        allmode
+00042e30: 6c73 5f71 7363 6f72 6573 203d 2030 2e0a  ls_qscores = 0..
+00042e40: 2020 2020 2020 2020 666f 7220 6d6f 6465          for mode
+00042e50: 6c20 696e 2073 656c 662e 6d6f 6465 6c73  l in self.models
+00042e60: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
+00042e70: 676d 6f64 656c 203d 206f 732e 7061 7468  gmodel = os.path
+00042e80: 2e62 6173 656e 616d 6528 6d6f 6465 6c2e  .basename(model.
+00042e90: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00042ea0: 2020 2020 2020 6375 726d 6f64 656c 203d        curmodel =
+00042eb0: 206f 7267 6d6f 6465 6c0a 2020 2020 2020   orgmodel.      
+00042ec0: 2020 2020 2020 7166 696c 6520 3d20 277b        qfile = '{
+00042ed0: 7d7b 7d5f 5f51 5f5f 7b7d 2e63 6966 272e  }{}__Q__{}.cif'.
+00042ee0: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
+00042ef0: 6469 722c 2063 7572 6d6f 6465 6c2c 206d  dir, curmodel, m
+00042f00: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
+00042f10: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
+00042f20: 7366 696c 6528 7166 696c 6529 3a0a 2020  sfile(qfile):.  
+00042f30: 2020 2020 2020 2020 2020 2020 2020 7020                p 
+00042f40: 3d20 4d4d 4349 4650 6172 7365 7228 290a  = MMCIFParser().
+00042f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042f60: 702e 5f6d 6d63 6966 5f64 6963 7420 3d20  p._mmcif_dict = 
+00042f70: 4d4d 4349 4632 4469 6374 2871 6669 6c65  MMCIF2Dict(qfile
+00042f80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00042f90: 2020 636f 6f72 6473 203d 207a 6970 2870    coords = zip(p
+00042fa0: 2e5f 6d6d 6369 665f 6469 6374 5b27 5f61  ._mmcif_dict['_a
+00042fb0: 746f 6d5f 7369 7465 2e43 6172 746e 5f78  tom_site.Cartn_x
+00042fc0: 275d 2c20 702e 5f6d 6d63 6966 5f64 6963  '], p._mmcif_dic
+00042fd0: 745b 275f 6174 6f6d 5f73 6974 652e 4361  t['_atom_site.Ca
+00042fe0: 7274 6e5f 7927 5d2c 2070 2e5f 6d6d 6369  rtn_y'], p._mmci
+00042ff0: 665f 6469 6374 5b27 5f61 746f 6d5f 7369  f_dict['_atom_si
+00043000: 7465 2e43 6172 746e 5f7a 275d 290a 2020  te.Cartn_z']).  
+00043010: 2020 2020 2020 2020 2020 2020 2020 7173                qs
+00043020: 636f 7265 7320 3d20 702e 5f6d 6d63 6966  cores = p._mmcif
+00043030: 5f64 6963 745b 275f 6174 6f6d 5f73 6974  _dict['_atom_sit
+00043040: 652e 512d 7363 6f72 6527 5d0a 2020 2020  e.Q-score'].    
+00043050: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+00043060: 6473 5f71 7363 6f72 6573 5f64 6963 7420  ds_qscores_dict 
+00043070: 3d20 4f72 6465 7265 6444 6963 7428 290a  = OrderedDict().
+00043080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043090: 666f 7220 636f 6f72 642c 2071 7363 6f72  for coord, qscor
+000430a0: 6520 696e 207a 6970 2863 6f6f 7264 732c  e in zip(coords,
+000430b0: 2071 7363 6f72 6573 293a 0a20 2020 2020   qscores):.     
+000430c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000430d0: 6c6f 6174 5f63 6f6f 7264 203d 2074 7570  loat_coord = tup
+000430e0: 6c65 286d 6170 2866 6c6f 6174 2c20 636f  le(map(float, co
+000430f0: 6f72 6429 290a 2020 2020 2020 2020 2020  ord)).          
+00043100: 2020 2020 2020 2020 2020 2320 6f72 675f            # org_
+00043110: 636f 6f72 645f 6b65 7920 3d20 7475 706c  coord_key = tupl
+00043120: 6528 6d61 7028 6c61 6d62 6461 2078 3a20  e(map(lambda x: 
+00043130: 6d61 7468 2e66 6c6f 6f72 2878 202a 2031  math.floor(x * 1
+00043140: 3020 2a2a 2032 2920 2f20 3130 202a 2a20  0 ** 2) / 10 ** 
+00043150: 322c 2066 6c6f 6174 5f63 6f6f 7264 2929  2, float_coord))
+00043160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043170: 2020 2020 206f 7267 5f63 6f6f 7264 5f6b       org_coord_k
+00043180: 6579 203d 2074 7570 6c65 286d 6170 286c  ey = tuple(map(l
+00043190: 616d 6264 6120 783a 206d 6174 682e 666c  ambda x: math.fl
+000431a0: 6f6f 7228 7829 2c20 666c 6f61 745f 636f  oor(x), float_co
+000431b0: 6f72 6429 290a 2020 2020 2020 2020 2020  ord)).          
+000431c0: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+000431d0: 5f71 7363 6f72 6573 5f64 6963 745b 6f72  _qscores_dict[or
+000431e0: 675f 636f 6f72 645f 6b65 795d 203d 2066  g_coord_key] = f
+000431f0: 6c6f 6174 2871 7363 6f72 6529 2069 6620  loat(qscore) if 
+00043200: 7173 636f 7265 2021 3d20 273f 2720 656c  qscore != '?' el
+00043210: 7365 2030 2e0a 2020 2020 2020 2020 2020  se 0..          
+00043220: 2020 2020 2020 7071 7363 6f72 6563 6966        pqscorecif
+00043230: 203d 2070 2e67 6574 5f73 7472 7563 7475   = p.get_structu
+00043240: 7265 2871 6669 6c65 2c20 7166 696c 6529  re(qfile, qfile)
+00043250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043260: 2066 6f72 2061 746f 6d20 696e 2070 7173   for atom in pqs
+00043270: 636f 7265 6369 662e 6765 745f 6174 6f6d  corecif.get_atom
+00043280: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00043290: 2020 2020 2020 2020 2023 2063 6f6f 7264           # coord
+000432a0: 5f6b 6579 203d 2074 7570 6c65 286d 6170  _key = tuple(map
+000432b0: 2866 6c6f 6174 2c20 6d61 7028 7374 722c  (float, map(str,
+000432c0: 2061 746f 6d2e 636f 6f72 6429 2929 0a20   atom.coord))). 
+000432d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000432e0: 2020 2063 6f6f 7264 5f6b 6579 203d 2074     coord_key = t
+000432f0: 7570 6c65 286d 6170 2866 6c6f 6174 2c20  uple(map(float, 
+00043300: 7475 706c 6528 6d61 7028 7374 722c 2061  tuple(map(str, a
+00043310: 746f 6d2e 636f 6f72 6429 2929 290a 2020  tom.coord)))).  
+00043320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043330: 2020 2320 6e65 775f 636f 6f72 645f 6b65    # new_coord_ke
+00043340: 7920 3d20 7475 706c 6528 6d61 7028 6c61  y = tuple(map(la
+00043350: 6d62 6461 2078 3a20 6d61 7468 2e66 6c6f  mbda x: math.flo
+00043360: 6f72 2878 202a 2031 3020 2a2a 2032 2920  or(x * 10 ** 2) 
+00043370: 2f20 3130 202a 2a20 322c 2063 6f6f 7264  / 10 ** 2, coord
+00043380: 5f6b 6579 2929 0a20 2020 2020 2020 2020  _key)).         
+00043390: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+000433a0: 6f6f 7264 5f6b 6579 203d 2074 7570 6c65  oord_key = tuple
+000433b0: 286d 6170 286c 616d 6264 6120 783a 206d  (map(lambda x: m
+000433c0: 6174 682e 666c 6f6f 7228 7829 2c20 636f  ath.floor(x), co
+000433d0: 6f72 645f 6b65 7929 290a 2020 2020 2020  ord_key)).      
+000433e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000433f0: 7461 7474 7228 6174 6f6d 2c20 2771 7363  tattr(atom, 'qsc
+00043400: 6f72 6527 2c20 636f 6f72 6473 5f71 7363  ore', coords_qsc
+00043410: 6f72 6573 5f64 6963 745b 6e65 775f 636f  ores_dict[new_co
+00043420: 6f72 645f 6b65 795d 290a 2020 2020 2020  ord_key]).      
+00043430: 2020 2020 2020 2020 2020 7173 636f 7265            qscore
+00043440: 6369 6620 3d20 7071 7363 6f72 6563 6966  cif = pqscorecif
+00043450: 2069 6620 6c65 6e28 7071 7363 6f72 6563   if len(pqscorec
+00043460: 6966 2e67 6574 5f6c 6973 7428 2929 203d  if.get_list()) =
+00043470: 3d20 3120 656c 7365 2070 7173 636f 7265  = 1 else pqscore
+00043480: 6369 665b 305d 0a20 2020 2020 2020 2020  cif[0].         
+00043490: 2020 2020 2020 2071 6669 6c65 732e 6170         qfiles.ap
+000434a0: 7065 6e64 2871 7363 6f72 6563 6966 290a  pend(qscorecif).
+000434b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000434c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000434d0: 2020 2020 2020 2020 2063 6966 6469 6374           cifdict
+000434e0: 203d 2073 656c 662e 6e65 7763 6966 5f74   = self.newcif_t
+000434f0: 6f71 6469 6374 2871 7363 6f72 6563 6966  oqdict(qscorecif
+00043500: 2c20 6f72 676d 6f64 656c 290a 2020 2020  , orgmodel).    
+00043510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043520: 616c 6c6d 6f64 656c 735f 6e75 6d62 6572  allmodels_number
+00043530: 6f66 6174 6f6d 7320 2b3d 2063 6966 6469  ofatoms += cifdi
+00043540: 6374 5b27 6461 7461 275d 5b27 6e75 6d62  ct['data']['numb
+00043550: 6572 6f66 6174 6f6d 7327 5d0a 2020 2020  erofatoms'].    
+00043560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043570: 616c 6c6d 6f64 656c 735f 7173 636f 7265  allmodels_qscore
+00043580: 7320 2b3d 2063 6966 6469 6374 5b27 6461  s += cifdict['da
+00043590: 7461 275d 5b27 6e75 6d62 6572 6f66 6174  ta']['numberofat
+000435a0: 6f6d 7327 5d2a 6369 6664 6963 745b 2764  oms']*cifdict['d
+000435b0: 6174 6127 5d5b 2761 7665 7261 6765 7173  ata']['averageqs
+000435c0: 636f 7265 275d 0a20 2020 2020 2020 2020  core'].         
+000435d0: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
+000435e0: 6564 6963 745b 7374 7228 6d6f 6465 6c6e  edict[str(modeln
+000435f0: 756d 295d 203d 2063 6966 6469 6374 0a20  um)] = cifdict. 
+00043600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043610: 2020 206d 6f64 656c 6e75 6d20 2b3d 2031     modelnum += 1
+00043620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043630: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+00043640: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00043650: 203d 2027 5173 636f 7265 2063 616c 6375   = 'Qscore calcu
+00043660: 6c61 7469 6f6e 2065 7272 6f72 2028 4d6f  lation error (Mo
+00043670: 6465 6c3a 207b 7d29 3a20 7b7d 2e27 2e66  del: {}): {}.'.f
+00043680: 6f72 6d61 7428 6d6f 6465 6c2e 6669 6c65  ormat(model.file
+00043690: 6e61 6d65 2c20 7379 732e 6578 635f 696e  name, sys.exc_in
+000436a0: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
+000436b0: 2020 2020 2020 2020 2020 2020 2071 7363               qsc
+000436c0: 6f72 6565 7272 6c69 7374 2e61 7070 656e  oreerrlist.appen
+000436d0: 6428 6572 7229 0a20 2020 2020 2020 2020  d(err).         
+000436e0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+000436f0: 7464 6572 722e 7772 6974 6528 6572 7220  tderr.write(err 
+00043700: 2b20 275c 6e27 290a 2020 2020 2020 2020  + '\n').        
+00043710: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00043720: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00043730: 5661 6c75 6545 7272 6f72 0a20 2020 2020  ValueError.     
+00043740: 2020 2069 6620 616c 6c6d 6f64 656c 735f     if allmodels_
+00043750: 6e75 6d62 6572 6f66 6174 6f6d 7320 213d  numberofatoms !=
+00043760: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00043770: 616c 6c6d 6f64 656c 735f 6176 6572 6167  allmodels_averag
+00043780: 655f 7173 636f 7265 203d 2061 6c6c 6d6f  e_qscore = allmo
+00043790: 6465 6c73 5f71 7363 6f72 6573 202f 2061  dels_qscores / a
+000437a0: 6c6c 6d6f 6465 6c73 5f6e 756d 6265 726f  llmodels_numbero
+000437b0: 6661 746f 6d73 0a20 2020 2020 2020 2020  fatoms.         
+000437c0: 2020 2023 2071 7363 6f72 6564 6963 742e     # qscoredict.
+000437d0: 7570 6461 7465 287b 2761 6c6c 6d6f 6465  update({'allmode
+000437e0: 6c73 5f61 7665 7261 6765 5f71 7363 6f72  ls_average_qscor
+000437f0: 6527 3a20 726f 756e 6428 616c 6c6d 6f64  e': round(allmod
+00043800: 656c 735f 6176 6572 6167 655f 7173 636f  els_average_qsco
+00043810: 7265 2c20 3329 7d29 0a20 2020 2020 2020  re, 3)}).       
+00043820: 2020 2020 2071 7363 6f72 6564 6963 745b       qscoredict[
+00043830: 2761 6c6c 6d6f 6465 6c73 5f61 7665 7261  'allmodels_avera
+00043840: 6765 5f71 7363 6f72 6527 5d20 3d20 726f  ge_qscore'] = ro
+00043850: 756e 6428 616c 6c6d 6f64 656c 735f 6176  und(allmodels_av
+00043860: 6572 6167 655f 7173 636f 7265 2c20 3329  erage_qscore, 3)
+00043870: 0a20 2020 2020 2020 2069 6620 7173 636f  .        if qsco
+00043880: 7265 6469 6374 3a0a 2020 2020 2020 2020  redict:.        
+00043890: 2020 2020 6669 6e61 6c64 6963 745b 2771      finaldict['q
+000438a0: 7363 6f72 6527 5d20 3d20 7173 636f 7265  score'] = qscore
+000438b0: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+000438c0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000438d0: 2020 2020 2020 7769 7468 2063 6f64 6563        with codec
+000438e0: 732e 6f70 656e 2873 656c 662e 776f 726b  s.open(self.work
+000438f0: 6469 7220 2b20 7365 6c66 2e6d 6170 6e61  dir + self.mapna
+00043900: 6d65 202b 2027 5f71 7363 6f72 652e 6a73  me + '_qscore.js
+00043910: 6f6e 272c 2027 7727 2c0a 2020 2020 2020  on', 'w',.      
+00043920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043930: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
+00043940: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
+00043950: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+00043960: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
+00043970: 2866 696e 616c 6469 6374 2c20 6629 0a20  (finaldict, f). 
+00043980: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00043990: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000439a0: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
+000439b0: 6974 6528 2753 6176 696e 6720 746f 2051  ite('Saving to Q
+000439c0: 7363 6f72 6520 6a73 6f6e 2065 7272 6f72  score json error
+000439d0: 3a20 7b7d 2e5c 6e27 2e66 6f72 6d61 7428  : {}.\n'.format(
+000439e0: 7379 732e 6578 635f 696e 666f 2829 5b31  sys.exc_info()[1
+000439f0: 5d29 290a 2020 2020 2020 2020 656c 7365  ])).        else
+00043a00: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00043a10: 696e 7428 2751 7363 6f72 6520 7761 7320  int('Qscore was 
+00043a20: 6e6f 7420 636f 6c6c 6563 7465 642c 2070  not collected, p
+00043a30: 6c65 6173 6520 6368 6563 6b21 2729 0a0a  lease check!')..
+00043a40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00043a50: 4e6f 6e65 0a0a 2020 2020 6465 6620 6e65  None..    def ne
+00043a60: 7763 6966 5f74 6f71 6469 6374 2873 656c  wcif_toqdict(sel
+00043a70: 662c 2071 7363 6f72 6563 6966 2c20 6f72  f, qscorecif, or
+00043a80: 676d 6f64 656c 293a 0a20 2020 2020 2020  gmodel):.       
+00043a90: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+00043aa0: 2020 4769 7665 6e20 6369 6620 6269 6f70    Given cif biop
+00043ab0: 7974 686f 6e20 6f62 6a65 6374 2061 6e64  ython object and
+00043ac0: 2063 6f6e 7665 7274 2074 6f20 6120 6469   convert to a di
+00043ad0: 6374 6f72 7920 7768 6963 6820 636f 6e74  ctory which cont
+00043ae0: 6169 6e73 2061 6c6c 2064 6174 6120 666f  ains all data fo
+00043af0: 7220 4a53 4f4e 0a0a 2020 2020 2020 2020  r JSON..        
+00043b00: 3a72 6574 7572 6e3a 2044 4943 5420 636f  :return: DICT co
+00043b10: 6e74 6169 6e73 2051 2d73 636f 7265 2064  ntains Q-score d
+00043b20: 6174 6120 6672 6f6d 206d 6d63 6966 2028  ata from mmcif (
+00043b30: 6269 6f70 7974 686f 6e20 6f62 6a65 6374  biopython object
+00043b40: 290a 2020 2020 2020 2020 2222 220a 0a0a  ).        """...
+00043b50: 2020 2020 2020 2020 7265 7369 6475 6573          residues
+00043b60: 203d 205b 5d0a 2020 2020 2020 2020 636f   = [].        co
+00043b70: 6c6f 7273 203d 205b 5d0a 2020 2020 2020  lors = [].      
+00043b80: 2020 7173 636f 7265 7320 3d20 5b5d 0a20    qscores = []. 
+00043b90: 2020 2020 2020 2063 6861 696e 5f71 7363         chain_qsc
+00043ba0: 6f72 6520 3d20 7b7d 0a20 2020 2020 2020  ore = {}.       
+00043bb0: 2071 7363 6f72 655f 6c69 7374 203d 205b   qscore_list = [
+00043bc0: 6174 6f6d 2e71 7363 6f72 6520 666f 7220  atom.qscore for 
+00043bd0: 6174 6f6d 2069 6e20 7173 636f 7265 6369  atom in qscoreci
+00043be0: 662e 6765 745f 6174 6f6d 7328 2920 6966  f.get_atoms() if
+00043bf0: 2061 746f 6d2e 7173 636f 7265 203e 2031   atom.qscore > 1
+00043c00: 2e30 5d0a 2020 2020 2020 2020 7072 6f74  .0].        prot
+00043c10: 6569 6e5f 7173 636f 7265 7320 3d20 5b5d  ein_qscores = []
+00043c20: 0a20 2020 2020 2020 2066 6f72 2061 746f  .        for ato
+00043c30: 6d20 696e 2071 7363 6f72 6563 6966 2e67  m in qscorecif.g
+00043c40: 6574 5f61 746f 6d73 2829 3a0a 2020 2020  et_atoms():.    
+00043c50: 2020 2020 2020 2020 6966 2061 746f 6d2e          if atom.
+00043c60: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
+00043c70: 2748 2729 206f 7220 6174 6f6d 2e67 6574  'H') or atom.get
+00043c80: 5f70 6172 656e 7428 292e 7265 736e 616d  _parent().resnam
+00043c90: 6520 3d3d 2027 484f 4827 3a0a 2020 2020  e == 'HOH':.    
+00043ca0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00043cb0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00043cc0: 2070 726f 7465 696e 5f71 7363 6f72 6573   protein_qscores
+00043cd0: 2e61 7070 656e 6428 6174 6f6d 2e71 7363  .append(atom.qsc
+00043ce0: 6f72 6529 0a20 2020 2020 2020 2061 7665  ore).        ave
+00043cf0: 7261 6765 5f71 7363 6f72 6520 3d20 726f  rage_qscore = ro
+00043d00: 756e 6428 7375 6d28 7072 6f74 6569 6e5f  und(sum(protein_
+00043d10: 7173 636f 7265 7329 202f 206c 656e 2870  qscores) / len(p
+00043d20: 726f 7465 696e 5f71 7363 6f72 6573 292c  rotein_qscores),
+00043d30: 2033 290a 2020 2020 2020 2020 6966 2071   3).        if q
+00043d40: 7363 6f72 655f 6c69 7374 3a0a 2020 2020  score_list:.    
+00043d50: 2020 2020 2020 2020 6d69 6e5f 7173 636f          min_qsco
+00043d60: 7265 203d 206d 696e 2871 7363 6f72 655f  re = min(qscore_
+00043d70: 6c69 7374 290a 2020 2020 2020 2020 2020  list).          
+00043d80: 2020 6d61 785f 7173 636f 7265 203d 206d    max_qscore = m
+00043d90: 6178 2871 7363 6f72 655f 6c69 7374 290a  ax(qscore_list).
+00043da0: 2020 2020 2020 2020 666f 7220 6368 6169          for chai
+00043db0: 6e20 696e 2071 7363 6f72 6563 6966 2e67  n in qscorecif.g
+00043dc0: 6574 5f63 6861 696e 7328 293a 0a20 2020  et_chains():.   
+00043dd0: 2020 2020 2020 2020 2063 7572 6368 6169           curchai
+00043de0: 6e5f 6e61 6d65 203d 2063 6861 696e 2e69  n_name = chain.i
+00043df0: 640a 2020 2020 2020 2020 2020 2020 6375  d.            cu
+00043e00: 7263 6861 696e 5f71 7363 6f72 6520 3d20  rchain_qscore = 
+00043e10: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+00043e20: 6f72 2061 746f 6d20 696e 2063 6861 696e  or atom in chain
+00043e30: 2e67 6574 5f61 746f 6d73 2829 3a0a 2020  .get_atoms():.  
+00043e40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00043e50: 2061 746f 6d2e 6e61 6d65 2e73 7461 7274   atom.name.start
+00043e60: 7377 6974 6828 2748 2729 206f 7220 6174  swith('H') or at
+00043e70: 6f6d 2e67 6574 5f70 6172 656e 7428 292e  om.get_parent().
+00043e80: 7265 736e 616d 6520 3d3d 2027 484f 4827  resname == 'HOH'
+00043e90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00043ea0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00043eb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00043ec0: 7572 6368 6169 6e5f 7173 636f 7265 2e61  urchain_qscore.a
+00043ed0: 7070 656e 6428 6174 6f6d 2e71 7363 6f72  ppend(atom.qscor
+00043ee0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00043ef0: 6620 6e6f 7420 6375 7263 6861 696e 5f71  f not curchain_q
+00043f00: 7363 6f72 653a 0a20 2020 2020 2020 2020  score:.         
+00043f10: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00043f20: 2020 2020 2020 2020 2020 2020 6176 6572              aver
+00043f30: 6167 6563 7572 6368 6169 6e5f 7173 636f  agecurchain_qsco
+00043f40: 7265 203d 2072 6f75 6e64 2873 756d 2863  re = round(sum(c
+00043f50: 7572 6368 6169 6e5f 7173 636f 7265 2920  urchain_qscore) 
+00043f60: 2f20 6c65 6e28 6375 7263 6861 696e 5f71  / len(curchain_q
+00043f70: 7363 6f72 6529 2c20 3329 0a20 2020 2020  score), 3).     
+00043f80: 2020 2020 2020 2061 746f 6d73 5f69 6e63         atoms_inc
+00043f90: 6861 696e 203d 2030 0a20 2020 2020 2020  hain = 0.       
+00043fa0: 2020 2020 2071 7363 6f72 655f 696e 6368       qscore_inch
+00043fb0: 6169 6e20 3d20 302e 0a20 2020 2020 2020  ain = 0..       
+00043fc0: 2020 2020 2066 6f72 2072 6573 6964 7565       for residue
+00043fd0: 2069 6e20 6368 6169 6e3a 0a20 2020 2020   in chain:.     
+00043fe0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00043ff0: 735f 6e61 6d65 203d 2072 6573 6964 7565  s_name = residue
+00044000: 2e72 6573 6e61 6d65 0a20 2020 2020 2020  .resname.       
+00044010: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
+00044020: 6573 5f6e 616d 6520 3d3d 2027 484f 4827  es_name == 'HOH'
+00044030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00044040: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00044050: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00044060: 7572 7265 735f 6964 203d 2072 6573 6964  urres_id = resid
+00044070: 7565 2e69 645b 315d 0a20 2020 2020 2020  ue.id[1].       
+00044080: 2020 2020 2020 2020 2061 746f 6d73 5f69           atoms_i
+00044090: 6e72 6573 6964 7565 203d 2030 0a20 2020  nresidue = 0.   
+000440a0: 2020 2020 2020 2020 2020 2020 2071 7363               qsc
+000440b0: 6f72 655f 696e 7265 7369 6475 6520 3d20  ore_inresidue = 
+000440c0: 302e 0a20 2020 2020 2020 2020 2020 2020  0..             
+000440d0: 2020 2066 6f72 2061 746f 6d20 696e 2072     for atom in r
+000440e0: 6573 6964 7565 3a0a 2020 2020 2020 2020  esidue:.        
+000440f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00044100: 746f 6d2e 6e61 6d65 2e73 7461 7274 7377  tom.name.startsw
+00044110: 6974 6828 2748 2729 206f 7220 6174 6f6d  ith('H') or atom
+00044120: 2e67 6574 5f70 6172 656e 7428 292e 7265  .get_parent().re
+00044130: 736e 616d 6520 3d3d 2027 484f 4827 3a0a  sname == 'HOH':.
+00044140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044150: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00044160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044170: 2020 2020 2061 746f 6d73 5f69 6e63 6861       atoms_incha
+00044180: 696e 202b 3d20 310a 2020 2020 2020 2020  in += 1.        
+00044190: 2020 2020 2020 2020 2020 2020 6174 6f6d              atom
+000441a0: 735f 696e 7265 7369 6475 6520 2b3d 2031  s_inresidue += 1
+000441b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000441c0: 2020 2020 2063 7572 6174 6f6d 5f71 7363       curatom_qsc
+000441d0: 6f72 6520 3d20 6174 6f6d 2e71 7363 6f72  ore = atom.qscor
+000441e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000441f0: 2020 2020 2020 7173 636f 7265 5f69 6e63        qscore_inc
+00044200: 6861 696e 202b 3d20 6375 7261 746f 6d5f  hain += curatom_
+00044210: 7173 636f 7265 0a20 2020 2020 2020 2020  qscore.         
+00044220: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
+00044230: 655f 696e 7265 7369 6475 6520 2b3d 2063  e_inresidue += c
+00044240: 7572 6174 6f6d 5f71 7363 6f72 650a 2020  uratom_qscore.  
+00044250: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00044260: 2061 746f 6d73 5f69 6e72 6573 6964 7565   atoms_inresidue
+00044270: 2021 3d20 302e 3a0a 2020 2020 2020 2020   != 0.:.        
+00044280: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00044290: 6573 5f71 7363 6f72 6520 3d20 726f 756e  es_qscore = roun
+000442a0: 6428 7173 636f 7265 5f69 6e72 6573 6964  d(qscore_inresid
+000442b0: 7565 202f 2061 746f 6d73 5f69 6e72 6573  ue / atoms_inres
+000442c0: 6964 7565 2c20 3329 0a20 2020 2020 2020  idue, 3).       
+000442d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000442e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000442f0: 2020 2063 7572 7265 735f 7173 636f 7265     curres_qscore
+00044300: 203d 2030 2e0a 2020 2020 2020 2020 2020   = 0..          
+00044310: 2020 2020 2020 6966 2063 7572 7265 735f        if curres_
+00044320: 7173 636f 7265 203e 2031 2e30 3a0a 2020  qscore > 1.0:.  
+00044330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044340: 2020 6966 206d 696e 5f71 7363 6f72 6520    if min_qscore 
+00044350: 3d3d 206d 6178 5f71 7363 6f72 653a 0a20  == max_qscore:. 
+00044360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044370: 2020 2020 2020 2063 7572 7265 735f 636f         curres_co
+00044380: 6c6f 7220 3d20 2723 3030 3030 3030 270a  lor = '#000000'.
+00044390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000443b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443c0: 2020 7363 616c 6564 5f71 7363 6f72 6520    scaled_qscore 
+000443d0: 3d20 2863 7572 7265 735f 7173 636f 7265  = (curres_qscore
+000443e0: 202d 206d 696e 5f71 7363 6f72 6529 202f   - min_qscore) /
+000443f0: 2028 6d61 785f 7173 636f 7265 202d 206d   (max_qscore - m
+00044400: 696e 5f71 7363 6f72 6529 0a20 2020 2020  in_qscore).     
+00044410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044420: 2020 2063 7572 7265 735f 636f 6c6f 7220     curres_color 
+00044430: 3d20 7365 6c66 2e5f 5f66 6c6f 6174 6f68  = self.__floatoh
+00044440: 6578 5f61 626f 7665 6f6e 6528 5b73 6361  ex_aboveone([sca
+00044450: 6c65 645f 7173 636f 7265 5d29 5b30 5d0a  led_qscore])[0].
+00044460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044470: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00044480: 2020 2020 2020 2020 2020 6375 7272 6573            curres
+00044490: 5f63 6f6c 6f72 203d 2073 656c 662e 5f5f  _color = self.__
+000444a0: 666c 6f61 746f 6865 7828 5b63 7572 7265  floatohex([curre
+000444b0: 735f 7173 636f 7265 5d29 5b30 5d0a 0a20  s_qscore])[0].. 
+000444c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000444d0: 636f 6465 203d 2072 6573 6964 7565 2e69  code = residue.i
+000444e0: 645b 325d 0a20 2020 2020 2020 2020 2020  d[2].           
+000444f0: 2020 2020 2069 6620 6963 6f64 6520 213d       if icode !=
+00044500: 2027 2027 3a0a 2020 2020 2020 2020 2020   ' ':.          
+00044510: 2020 2020 2020 2020 2020 6375 7272 6573            curres
+00044520: 5f73 7472 696e 6720 3d20 277b 7d3a 7b7d  _string = '{}:{}
+00044530: 7b7d 207b 7d27 2e66 6f72 6d61 7428 6375  {} {}'.format(cu
+00044540: 7263 6861 696e 5f6e 616d 652c 2063 7572  rchain_name, cur
+00044550: 7265 735f 6964 2c20 6963 6f64 652c 2063  res_id, icode, c
+00044560: 7572 7265 735f 6e61 6d65 290a 2020 2020  urres_name).    
+00044570: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00044580: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00044590: 2020 2020 2020 6375 7272 6573 5f73 7472        curres_str
+000445a0: 696e 6720 3d20 277b 7d3a 7b7d 207b 7d27  ing = '{}:{} {}'
+000445b0: 2e66 6f72 6d61 7428 6375 7263 6861 696e  .format(curchain
+000445c0: 5f6e 616d 652c 2063 7572 7265 735f 6964  _name, curres_id
+000445d0: 2c20 6375 7272 6573 5f6e 616d 6529 0a20  , curres_name). 
+000445e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000445f0: 6573 6964 7565 732e 6170 7065 6e64 2863  esidues.append(c
+00044600: 7572 7265 735f 7374 7269 6e67 290a 2020  urres_string).  
+00044610: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00044620: 6c6f 7273 2e61 7070 656e 6428 6375 7272  lors.append(curr
+00044630: 6573 5f63 6f6c 6f72 290a 2020 2020 2020  es_color).      
+00044640: 2020 2020 2020 2020 2020 7173 636f 7265            qscore
+00044650: 732e 6170 7065 6e64 2863 7572 7265 735f  s.append(curres_
+00044660: 7173 636f 7265 290a 2020 2020 2020 2020  qscore).        
+00044670: 2020 2020 6176 6572 6167 6571 7363 6f72      averageqscor
+00044680: 655f 696e 636f 6c6f 7220 3d20 7365 6c66  e_incolor = self
+00044690: 2e5f 5f66 6c6f 6174 6f68 6578 285b 6176  .__floatohex([av
+000446a0: 6572 6167 6563 7572 6368 6169 6e5f 7173  eragecurchain_qs
+000446b0: 636f 7265 5d29 5b30 5d0a 2020 2020 2020  core])[0].      
+000446c0: 2020 2020 2020 6368 6169 6e5f 7173 636f        chain_qsco
+000446d0: 7265 5b63 7572 6368 6169 6e5f 6e61 6d65  re[curchain_name
+000446e0: 5d20 3d20 7b27 7661 6c75 6527 3a20 6176  ] = {'value': av
+000446f0: 6572 6167 6563 7572 6368 6169 6e5f 7173  eragecurchain_qs
+00044700: 636f 7265 2c20 2763 6f6c 6f72 273a 2061  core, 'color': a
+00044710: 7665 7261 6765 7173 636f 7265 5f69 6e63  verageqscore_inc
+00044720: 6f6c 6f72 7d0a 0a20 2020 2020 2020 206c  olor}..        l
+00044730: 6576 656c 7320 3d20 6e70 2e6c 696e 7370  evels = np.linsp
+00044740: 6163 6528 2d31 2c20 312c 2031 3030 290a  ace(-1, 1, 100).
+00044750: 2020 2020 2020 2020 7161 7272 6179 203d          qarray =
+00044760: 206e 702e 6172 7261 7928 7173 636f 7265   np.array(qscore
+00044770: 7329 0a20 2020 2020 2020 2068 6973 742c  s).        hist,
+00044780: 2062 696e 5f65 6467 6573 203d 206e 702e   bin_edges = np.
+00044790: 6869 7374 6f67 7261 6d28 7161 7272 6179  histogram(qarray
+000447a0: 2c20 6269 6e73 3d6c 6576 656c 7329 0a20  , bins=levels). 
+000447b0: 2020 2020 2020 2070 6c74 2e70 6c6f 7428         plt.plot(
+000447c0: 6269 6e5f 6564 6765 735b 313a 5d2c 2068  bin_edges[1:], h
+000447d0: 6973 742f 7161 7272 6179 2e73 697a 6529  ist/qarray.size)
+000447e0: 0a0a 2020 2020 2020 2020 7072 6f74 6569  ..        protei
+000447f0: 6e5f 7161 7272 6179 203d 206e 702e 6172  n_qarray = np.ar
+00044800: 7261 7928 7072 6f74 6569 6e5f 7173 636f  ray(protein_qsco
+00044810: 7265 7329 0a20 2020 2020 2020 2070 6869  res).        phi
+00044820: 7374 2c20 705f 6269 6e5f 6564 6765 7320  st, p_bin_edges 
+00044830: 3d20 6e70 2e68 6973 746f 6772 616d 2870  = np.histogram(p
+00044840: 726f 7465 696e 5f71 6172 7261 792c 2062  rotein_qarray, b
+00044850: 696e 733d 6c65 7665 6c73 290a 2020 2020  ins=levels).    
+00044860: 2020 2020 706c 742e 706c 6f74 2870 5f62      plt.plot(p_b
+00044870: 696e 5f65 6467 6573 5b31 3a5d 2c20 7068  in_edges[1:], ph
+00044880: 6973 742f 7072 6f74 6569 6e5f 7161 7272  ist/protein_qarr
+00044890: 6179 2e73 697a 6529 0a20 2020 2020 2020  ay.size).       
+000448a0: 2070 6c74 2e78 6c61 6265 6c28 2751 2d73   plt.xlabel('Q-s
+000448b0: 636f 7265 2729 0a20 2020 2020 2020 2070  core').        p
+000448c0: 6c74 2e79 6c61 6265 6c28 2746 7261 6374  lt.ylabel('Fract
+000448d0: 696f 6e27 290a 2020 2020 2020 2020 706c  ion').        pl
+000448e0: 742e 6c65 6765 6e64 2828 2752 6573 6964  t.legend(('Resid
+000448f0: 7565 3a20 2720 2b20 2728 2720 2b20 7374  ue: ' + '(' + st
+00044900: 7228 7161 7272 6179 2e73 697a 6529 202b  r(qarray.size) +
+00044910: 2027 2927 2c20 2741 746f 6d3a 2027 202b   ')', 'Atom: ' +
+00044920: 2027 2827 202b 2073 7472 2870 726f 7465   '(' + str(prote
+00044930: 696e 5f71 6172 7261 792e 7369 7a65 2920  in_qarray.size) 
+00044940: 2b20 2729 2729 2c20 6c6f 633d 2775 7070  + ')'), loc='upp
+00044950: 6572 206c 6566 7427 2c20 7368 6164 6f77  er left', shadow
+00044960: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
+00044970: 6620 7365 6c66 2e6d 6170 6e61 6d65 2061  f self.mapname a
+00044980: 6e64 2073 656c 662e 7265 736f 6c75 7469  nd self.resoluti
+00044990: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+000449a0: 706c 742e 7469 746c 6528 274d 6170 3a20  plt.title('Map: 
+000449b0: 2720 2b20 7365 6c66 2e6d 6170 6e61 6d65  ' + self.mapname
+000449c0: 202b 2027 2061 743a 2027 202b 2073 7472   + ' at: ' + str
+000449d0: 2873 656c 662e 7265 736f 6c75 7469 6f6e  (self.resolution
+000449e0: 2920 2b20 27c3 8527 290a 2020 2020 2020  ) + '..').      
+000449f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00044a00: 2020 2020 706c 742e 7469 746c 6528 274d      plt.title('M
+00044a10: 6170 2051 2d73 636f 7265 2027 290a 2020  ap Q-score ').  
+00044a20: 2020 2020 2020 706c 742e 7361 7665 6669        plt.savefi
+00044a30: 6728 7365 6c66 2e77 6f72 6b64 6972 202b  g(self.workdir +
+00044a40: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
+00044a50: 275f 7173 636f 7265 2e70 6e67 2729 0a20  '_qscore.png'). 
+00044a60: 2020 2020 2020 2070 6c74 2e63 6c6f 7365         plt.close
+00044a70: 2829 0a20 2020 2020 2020 2071 5f72 6573  ().        q_res
+00044a80: 6964 7565 5f66 7261 6374 696f 6e73 203d  idue_fractions =
+00044a90: 206c 6973 7428 6e70 2e61 726f 756e 6428   list(np.around(
+00044aa0: 6869 7374 2f71 6172 7261 792e 7369 7a65  hist/qarray.size
+00044ab0: 2c20 3329 290a 2020 2020 2020 2020 715f  , 3)).        q_
+00044ac0: 7072 6f74 6569 6e5f 6672 6163 7469 6f6e  protein_fraction
+00044ad0: 7320 3d20 6c69 7374 286e 702e 6172 6f75  s = list(np.arou
+00044ae0: 6e64 2870 6869 7374 2f70 726f 7465 696e  nd(phist/protein
+00044af0: 5f71 6172 7261 792e 7369 7a65 2c20 3329  _qarray.size, 3)
+00044b00: 290a 2020 2020 2020 2020 7166 7261 6374  ).        qfract
+00044b10: 696f 6e73 203d 207b 2771 4c65 7665 6c73  ions = {'qLevels
+00044b20: 273a 206c 6973 7428 6e70 2e61 726f 756e  ': list(np.aroun
+00044b30: 6428 6c65 7665 6c73 5b31 3a5d 2c20 3329  d(levels[1:], 3)
+00044b40: 292c 2027 7152 6573 6964 7565 4672 6163  ), 'qResidueFrac
+00044b50: 7469 6f6e 7327 3a20 715f 7265 7369 6475  tions': q_residu
+00044b60: 655f 6672 6163 7469 6f6e 732c 0a20 2020  e_fractions,.   
+00044b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044b80: 2020 2027 7141 746f 6d46 7261 6374 696f     'qAtomFractio
+00044b90: 6e73 273a 2071 5f70 726f 7465 696e 5f66  ns': q_protein_f
+00044ba0: 7261 6374 696f 6e73 7d0a 0a20 2020 2020  ractions}..     
+00044bb0: 2020 2023 2073 636f 7265 5f74 7970 6520     # score_type 
+00044bc0: 3d20 2771 7363 6f72 6527 0a20 2020 2020  = 'qscore'.     
+00044bd0: 2020 2023 206e 6577 5f64 6963 7420 3d20     # new_dict = 
+00044be0: 7b27 6964 273a 2073 656c 662e 656d 6469  {'id': self.emdi
+00044bf0: 642c 2027 7265 736f 6c75 7469 6f6e 273a  d, 'resolution':
+00044c00: 2066 6c6f 6174 2873 656c 662e 7265 736f   float(self.reso
+00044c10: 6c75 7469 6f6e 292c 2027 6e61 6d65 273a  lution), 'name':
+00044c20: 206f 7267 6d6f 6465 6c2c 2073 636f 7265   orgmodel, score
+00044c30: 5f74 7970 653a 2061 7665 7261 6765 5f71  _type: average_q
+00044c40: 7363 6f72 657d 0a20 2020 2020 2020 2023  score}.        #
+00044c50: 2070 6c6f 745f 6e61 6d65 203d 2027 7b7d   plot_name = '{}
+00044c60: 5f7b 7d5f 7b7d 5f62 6172 2e70 6e67 272e  _{}_{}_bar.png'.
+00044c70: 666f 726d 6174 2873 656c 662e 6d61 706e  format(self.mapn
+00044c80: 616d 652c 206f 7267 6d6f 6465 6c2c 2073  ame, orgmodel, s
+00044c90: 636f 7265 5f74 7970 6529 0a20 2020 2020  core_type).     
+00044ca0: 2020 2023 2073 636f 7265 5f64 6972 203d     # score_dir =
+00044cb0: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+00044cc0: 2876 612e 5f5f 6669 6c65 5f5f 290a 2020  (va.__file__).  
+00044cd0: 2020 2020 2020 2320 7265 6c61 7469 7665        # relative
+00044ce0: 5f74 6f77 686f 6c65 2c20 7265 6c61 7469  _towhole, relati
+00044cf0: 7665 5f74 6f74 776f 203d 2062 6172 286e  ve_totwo = bar(n
+00044d00: 6577 5f64 6963 742c 2073 636f 7265 5f74  ew_dict, score_t
+00044d10: 7970 652c 2073 656c 662e 776f 726b 6469  ype, self.workdi
+00044d20: 722c 2073 636f 7265 5f64 6972 2c20 706c  r, score_dir, pl
+00044d30: 6f74 5f6e 616d 6529 0a20 2020 2020 2020  ot_name).       
+00044d40: 2023 2071 6261 7220 3d20 7b27 7768 6f6c   # qbar = {'whol
+00044d50: 6527 3a20 7265 6c61 7469 7665 5f74 6f77  e': relative_tow
+00044d60: 686f 6c65 2c20 2772 656c 6174 6976 6527  hole, 'relative'
+00044d70: 3a20 7265 6c61 7469 7665 5f74 6f74 776f  : relative_totwo
+00044d80: 7d0a 0a20 2020 2020 2020 2074 6469 6374  }..        tdict
+00044d90: 203d 204f 7264 6572 6564 4469 6374 285b   = OrderedDict([
+00044da0: 0a20 2020 2020 2020 2020 2020 2028 2761  .            ('a
+00044db0: 7665 7261 6765 7173 636f 7265 272c 2061  verageqscore', a
+00044dc0: 7665 7261 6765 5f71 7363 6f72 6529 2c0a  verage_qscore),.
+00044dd0: 2020 2020 2020 2020 2020 2020 2827 6176              ('av
+00044de0: 6572 6167 6571 7363 6f72 655f 636f 6c6f  erageqscore_colo
+00044df0: 7227 2c20 7365 6c66 2e5f 5f66 6c6f 6174  r', self.__float
+00044e00: 6f68 6578 285b 6176 6572 6167 655f 7173  ohex([average_qs
+00044e10: 636f 7265 5d29 5b30 5d29 2c0a 2020 2020  core])[0]),.    
+00044e20: 2020 2020 2020 2020 2320 2827 7173 636f          # ('qsco
+00044e30: 7265 5f62 6172 272c 2071 6261 7229 2c0a  re_bar', qbar),.
+00044e40: 2020 2020 2020 2020 2020 2020 2827 6e75              ('nu
+00044e50: 6d62 6572 6f66 6174 6f6d 7327 2c20 6c65  mberofatoms', le
+00044e60: 6e28 7072 6f74 6569 6e5f 7173 636f 7265  n(protein_qscore
+00044e70: 7329 292c 0a20 2020 2020 2020 2020 2020  s)),.           
+00044e80: 2028 2763 6f6c 6f72 272c 2063 6f6c 6f72   ('color', color
+00044e90: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+00044ea0: 2827 696e 636c 7573 696f 6e27 2c20 7173  ('inclusion', qs
+00044eb0: 636f 7265 7329 2c0a 2020 2020 2020 2020  cores),.        
+00044ec0: 2020 2020 2827 7173 636f 7265 272c 2071      ('qscore', q
+00044ed0: 7363 6f72 6573 292c 0a20 2020 2020 2020  scores),.       
+00044ee0: 2020 2020 2028 2772 6573 6964 7565 272c       ('residue',
+00044ef0: 2072 6573 6964 7565 7329 2c0a 2020 2020   residues),.    
+00044f00: 2020 2020 2020 2020 2827 6368 6169 6e71          ('chainq
+00044f10: 7363 6f72 6527 2c20 6368 6169 6e5f 7173  score', chain_qs
+00044f20: 636f 7265 292c 0a20 2020 2020 2020 2020  core),.         
+00044f30: 2020 2028 2771 4672 6163 7469 6f6e 4469     ('qFractionDi
+00044f40: 7374 7269 6275 7469 6f6e 272c 2071 6672  stribution', qfr
+00044f50: 6163 7469 6f6e 7329 0a20 2020 2020 2020  actions).       
+00044f60: 205d 290a 0a0a 2020 2020 2020 2020 7265   ])...        re
+00044f70: 7375 6c74 6469 6374 203d 204f 7264 6572  sultdict = Order
+00044f80: 6564 4469 6374 285b 2827 6e61 6d65 272c  edDict([('name',
+00044f90: 206f 7267 6d6f 6465 6c29 2c20 2827 6461   orgmodel), ('da
+00044fa0: 7461 272c 2074 6469 6374 295d 290a 0a20  ta', tdict)]).. 
+00044fb0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00044fc0: 7375 6c74 6469 6374 0a0a 0a20 2020 2064  sultdict...    d
+00044fd0: 6566 2072 6561 6471 7363 6f72 6528 7365  ef readqscore(se
+00044fe0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00044ff0: 0a0a 2020 2020 2020 2020 2020 2020 4c6f  ..            Lo
+00045000: 6164 2074 6865 2051 2d73 636f 7265 2070  ad the Q-score p
+00045010: 6462 2066 696c 6528 7465 6d70 6172 6172  db file(temparar
+00045020: 7929 0a0a 2020 2020 2020 2020 3a72 6574  y)..        :ret
+00045030: 7572 6e3a 0a20 2020 2020 2020 2022 2222  urn:.        """
+00045040: 0a0a 2020 2020 2020 2020 6d61 706e 616d  ..        mapnam
+00045050: 6520 3d20 7365 6c66 2e6d 6170 6e61 6d65  e = self.mapname
+00045060: 5b3a 2d34 5d0a 2020 2020 2020 2020 7166  [:-4].        qf
+00045070: 696c 6573 203d 205b 5d0a 2020 2020 2020  iles = [].      
+00045080: 2020 7173 636f 7265 6572 726c 6973 7420    qscoreerrlist 
+00045090: 3d20 5b5d 0a20 2020 2020 2020 2072 6573  = [].        res
+000450a0: 756c 7420 3d20 7b7d 0a20 2020 2020 2020  ult = {}.       
+000450b0: 206d 6f64 656c 6e75 6d20 3d20 300a 2020   modelnum = 0.  
+000450c0: 2020 2020 2020 7173 636f 7265 6469 6374        qscoredict
+000450d0: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
+000450e0: 0a20 2020 2020 2020 2066 696e 616c 6469  .        finaldi
+000450f0: 6374 203d 204f 7264 6572 6564 4469 6374  ct = OrderedDict
+00045100: 2829 0a20 2020 2020 2020 2066 6f72 206d  ().        for m
+00045110: 6f64 656c 2069 6e20 7365 6c66 2e6d 6f64  odel in self.mod
+00045120: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
+00045130: 206f 7267 6d6f 6465 6c20 3d20 6f73 2e70   orgmodel = os.p
+00045140: 6174 682e 6261 7365 6e61 6d65 286d 6f64  ath.basename(mod
+00045150: 656c 2e66 696c 656e 616d 6529 0a20 2020  el.filename).   
+00045160: 2020 2020 2020 2020 2063 7572 6d6f 6465           curmode
+00045170: 6c20 3d20 6f72 676d 6f64 656c 5b3a 2d34  l = orgmodel[:-4
+00045180: 5d0a 2020 2020 2020 2020 2020 2020 7166  ].            qf
+00045190: 696c 6520 3d20 277b 7d7b 7d5f 5f51 5f5f  ile = '{}{}__Q__
+000451a0: 7b7d 2e70 6462 272e 666f 726d 6174 2873  {}.pdb'.format(s
+000451b0: 656c 662e 776f 726b 6469 722c 2063 7572  elf.workdir, cur
+000451c0: 6d6f 6465 6c2c 206d 6170 6e61 6d65 290a  model, mapname).
+000451d0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000451e0: 732e 7061 7468 2e69 7366 696c 6528 7166  s.path.isfile(qf
+000451f0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+00045200: 2020 2020 2020 7020 3d20 6f72 6750 4442        p = orgPDB
+00045210: 5061 7273 6572 2829 0a20 2020 2020 2020  Parser().       
+00045220: 2020 2020 2020 2020 2070 7173 636f 7265           pqscore
+00045230: 7064 6220 3d20 702e 6765 745f 7374 7275  pdb = p.get_stru
+00045240: 6374 7572 6528 276d 7971 6669 6c65 272c  cture('myqfile',
+00045250: 2071 6669 6c65 290a 2020 2020 2020 2020   qfile).        
+00045260: 2020 2020 2020 2020 7173 636f 7265 7064          qscorepd
+00045270: 6220 3d20 7071 7363 6f72 6570 6462 2069  b = pqscorepdb i
+00045280: 6620 6c65 6e28 7071 7363 6f72 6570 6462  f len(pqscorepdb
+00045290: 2e67 6574 5f6c 6973 7428 2929 203d 3d20  .get_list()) == 
+000452a0: 3120 656c 7365 2070 7173 636f 7265 7064  1 else pqscorepd
+000452b0: 625b 305d 0a20 2020 2020 2020 2020 2020  b[0].           
+000452c0: 2020 2020 2071 6669 6c65 732e 6170 7065       qfiles.appe
+000452d0: 6e64 2871 7363 6f72 6570 6462 290a 2020  nd(qscorepdb).  
+000452e0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000452f0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00045300: 2020 2020 2020 2023 2071 7363 6f72 6564         # qscored
+00045310: 6963 745b 7374 7228 6d6f 6465 6c6e 756d  ict[str(modelnum
+00045320: 295d 203d 2073 656c 662e 7064 6274 6f71  )] = self.pdbtoq
+00045330: 6469 6374 2871 7363 6f72 6570 6462 2c20  dict(qscorepdb, 
+00045340: 6f72 676d 6f64 656c 290a 2020 2020 2020  orgmodel).      
+00045350: 2020 2020 2020 2020 2020 2020 2020 7173                qs
+00045360: 636f 7265 6469 6374 5b73 7472 286d 6f64  coredict[str(mod
+00045370: 656c 6e75 6d29 5d20 3d20 7365 6c66 2e6e  elnum)] = self.n
+00045380: 6577 7064 6274 6f71 6469 6374 2871 7363  ewpdbtoqdict(qsc
+00045390: 6f72 6570 6462 2c20 6f72 676d 6f64 656c  orepdb, orgmodel
+000453a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000453b0: 2020 2020 2020 6d6f 6465 6c6e 756d 202b        modelnum +
+000453c0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+000453d0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+000453e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000453f0: 6572 7220 3d20 2751 7363 6f72 6520 6361  err = 'Qscore ca
+00045400: 6c63 756c 6174 696f 6e20 6572 726f 7220  lculation error 
+00045410: 284d 6f64 656c 3a20 7b7d 293a 207b 7d2e  (Model: {}): {}.
+00045420: 272e 666f 726d 6174 286d 6f64 656c 2e66  '.format(model.f
+00045430: 696c 656e 616d 652c 2073 7973 2e65 7863  ilename, sys.exc
+00045440: 5f69 6e66 6f28 295b 315d 290a 2020 2020  _info()[1]).    
+00045450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045460: 7173 636f 7265 6572 726c 6973 742e 6170  qscoreerrlist.ap
+00045470: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+00045480: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00045490: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
+000454a0: 7272 202b 2027 5c6e 2729 0a20 2020 2020  rr + '\n').     
+000454b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000454c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+000454d0: 7365 2056 616c 7565 4572 726f 720a 0a20  se ValueError.. 
+000454e0: 2020 2020 2020 2069 6620 7173 636f 7265         if qscore
+000454f0: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+00045500: 2020 6669 6e61 6c64 6963 745b 2771 7363    finaldict['qsc
+00045510: 6f72 6527 5d20 3d20 7173 636f 7265 6469  ore'] = qscoredi
+00045520: 6374 0a20 2020 2020 2020 2020 2020 2074  ct.            t
+00045530: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00045540: 2020 2020 7769 7468 2063 6f64 6563 732e      with codecs.
+00045550: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
+00045560: 7220 2b20 7365 6c66 2e6d 6170 6e61 6d65  r + self.mapname
+00045570: 202b 2027 5f71 7363 6f72 652e 6a73 6f6e   + '_qscore.json
+00045580: 272c 2027 7727 2c0a 2020 2020 2020 2020  ', 'w',.        
+00045590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000455a0: 2020 2020 2020 2020 2065 6e63 6f64 696e           encodin
+000455b0: 673d 2775 7466 2d38 2729 2061 7320 663a  g='utf-8') as f:
+000455c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000455d0: 2020 2020 206a 736f 6e2e 6475 6d70 2866       json.dump(f
+000455e0: 696e 616c 6469 6374 2c20 6629 0a20 2020  inaldict, f).   
+000455f0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+00045600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045610: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
+00045620: 6528 2753 6176 696e 6720 746f 2051 7363  e('Saving to Qsc
+00045630: 6f72 6520 6a73 6f6e 2065 7272 6f72 3a20  ore json error: 
+00045640: 7b7d 2e5c 6e27 2e66 6f72 6d61 7428 7379  {}.\n'.format(sy
+00045650: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
+00045660: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00045670: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00045680: 7428 2751 7363 6f72 6520 7761 7320 6e6f  t('Qscore was no
+00045690: 7420 636f 6c6c 6563 7465 642c 2070 6c65  t collected, ple
+000456a0: 6173 6520 6368 6563 6b21 2729 0a0a 0a20  ase check!')... 
+000456b0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000456c0: 6e65 0a0a 2020 2020 6465 6620 6e65 7770  ne..    def newp
+000456d0: 6462 746f 7164 6963 7428 7365 6c66 2c20  dbtoqdict(self, 
+000456e0: 7173 636f 7265 7064 622c 206f 7267 6d6f  qscorepdb, orgmo
+000456f0: 6465 6c29 3a0a 2020 2020 2020 2020 2222  del):.        ""
+00045700: 220a 0a20 2020 2020 2020 2020 2020 2047  "..            G
+00045710: 6976 656e 2070 6462 2062 696f 7079 7468  iven pdb biopyth
+00045720: 6f6e 206f 626a 6563 7420 616e 6420 636f  on object and co
+00045730: 6e76 6572 7420 746f 2061 2064 6963 7420  nvert to a dict 
+00045740: 7768 6963 6820 636f 6e74 6169 6e73 2061  which contains a
+00045750: 6c6c 2064 6174 6120 666f 7220 4a53 4f4e  ll data for JSON
+00045760: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00045770: 6e3a 2044 4943 5420 636f 6e74 6169 6e73  n: DICT contains
+00045780: 2061 6c6c 2064 6174 610a 2020 2020 2020   all data.      
+00045790: 2020 2222 220a 0a20 2020 2020 2020 2072    """..        r
+000457a0: 6573 6964 7565 7320 3d20 5b5d 0a20 2020  esidues = [].   
+000457b0: 2020 2020 2063 6f6c 6f72 7320 3d20 5b5d       colors = []
+000457c0: 0a20 2020 2020 2020 2071 7363 6f72 6573  .        qscores
+000457d0: 203d 205b 5d0a 2020 2020 2020 2020 6368   = [].        ch
+000457e0: 6169 6e5f 7173 636f 7265 203d 207b 7d0a  ain_qscore = {}.
+000457f0: 2020 2020 2020 2020 7173 636f 7265 5f6c          qscore_l
+00045800: 6973 7420 3d20 5b61 746f 6d2e 6266 6163  ist = [atom.bfac
+00045810: 746f 7220 666f 7220 6174 6f6d 2069 6e20  tor for atom in 
+00045820: 7173 636f 7265 7064 622e 6765 745f 6174  qscorepdb.get_at
+00045830: 6f6d 7328 2920 6966 2061 746f 6d2e 6266  oms() if atom.bf
+00045840: 6163 746f 7220 3e20 312e 305d 0a20 2020  actor > 1.0].   
+00045850: 2020 2020 2070 726f 7465 696e 5f71 7363       protein_qsc
+00045860: 6f72 6573 203d 205b 5d0a 2020 2020 2020  ores = [].      
+00045870: 2020 666f 7220 6174 6f6d 2069 6e20 7173    for atom in qs
+00045880: 636f 7265 7064 622e 6765 745f 6174 6f6d  corepdb.get_atom
+00045890: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+000458a0: 2069 6620 6174 6f6d 2e6e 616d 652e 7374   if atom.name.st
+000458b0: 6172 7473 7769 7468 2827 4827 2920 6f72  artswith('H') or
+000458c0: 2061 746f 6d2e 6765 745f 7061 7265 6e74   atom.get_parent
+000458d0: 2829 2e72 6573 6e61 6d65 203d 3d20 2748  ().resname == 'H
+000458e0: 4f48 2720 6f72 2061 746f 6d2e 6266 6163  OH' or atom.bfac
+000458f0: 746f 7220 3e3d 2031 2e30 3a0a 2020 2020  tor >= 1.0:.    
+00045900: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00045910: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00045920: 2070 726f 7465 696e 5f71 7363 6f72 6573   protein_qscores
+00045930: 2e61 7070 656e 6428 6174 6f6d 2e62 6661  .append(atom.bfa
+00045940: 6374 6f72 290a 2020 2020 2020 2020 6176  ctor).        av
+00045950: 6572 6167 655f 7173 636f 7265 203d 2072  erage_qscore = r
+00045960: 6f75 6e64 2873 756d 2870 726f 7465 696e  ound(sum(protein
+00045970: 5f71 7363 6f72 6573 2920 2f20 6c65 6e28  _qscores) / len(
+00045980: 7072 6f74 6569 6e5f 7173 636f 7265 7329  protein_qscores)
+00045990: 2c20 3329 0a20 2020 2020 2020 2069 6620  , 3).        if 
+000459a0: 7173 636f 7265 5f6c 6973 743a 0a20 2020  qscore_list:.   
+000459b0: 2020 2020 2020 2020 206d 696e 5f71 7363           min_qsc
+000459c0: 6f72 6520 3d20 6d69 6e28 7173 636f 7265  ore = min(qscore
+000459d0: 5f6c 6973 7429 0a20 2020 2020 2020 2020  _list).         
+000459e0: 2020 206d 6178 5f71 7363 6f72 6520 3d20     max_qscore = 
+000459f0: 6d61 7828 7173 636f 7265 5f6c 6973 7429  max(qscore_list)
+00045a00: 0a20 2020 2020 2020 2066 6f72 2063 6861  .        for cha
+00045a10: 696e 2069 6e20 7173 636f 7265 7064 622e  in in qscorepdb.
+00045a20: 6765 745f 6368 6169 6e73 2829 3a0a 2020  get_chains():.  
+00045a30: 2020 2020 2020 2020 2020 6375 7263 6861            curcha
+00045a40: 696e 5f6e 616d 6520 3d20 6368 6169 6e2e  in_name = chain.
+00045a50: 6964 0a20 2020 2020 2020 2020 2020 2063  id.            c
+00045a60: 7572 6368 6169 6e5f 7173 636f 7265 203d  urchain_qscore =
+00045a70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00045a80: 666f 7220 6174 6f6d 2069 6e20 6368 6169  for atom in chai
+00045a90: 6e2e 6765 745f 6174 6f6d 7328 293a 0a20  n.get_atoms():. 
+00045aa0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00045ab0: 6620 6174 6f6d 2e6e 616d 652e 7374 6172  f atom.name.star
+00045ac0: 7473 7769 7468 2827 4827 2920 6f72 2061  tswith('H') or a
+00045ad0: 746f 6d2e 6765 745f 7061 7265 6e74 2829  tom.get_parent()
+00045ae0: 2e72 6573 6e61 6d65 203d 3d20 2748 4f48  .resname == 'HOH
+00045af0: 2720 6f72 2061 746f 6d2e 6266 6163 746f  ' or atom.bfacto
+00045b00: 7220 3e3d 2031 2e30 3a0a 2020 2020 2020  r >= 1.0:.      
+00045b10: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00045b20: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00045b30: 2020 2020 2020 2063 7572 6368 6169 6e5f         curchain_
+00045b40: 7173 636f 7265 2e61 7070 656e 6428 6174  qscore.append(at
+00045b50: 6f6d 2e62 6661 6374 6f72 290a 2020 2020  om.bfactor).    
+00045b60: 2020 2020 2020 2020 6176 6572 6167 6563          averagec
+00045b70: 7572 6368 6169 6e5f 7173 636f 7265 203d  urchain_qscore =
+00045b80: 2072 6f75 6e64 2873 756d 2863 7572 6368   round(sum(curch
+00045b90: 6169 6e5f 7173 636f 7265 2920 2f20 6c65  ain_qscore) / le
+00045ba0: 6e28 6375 7263 6861 696e 5f71 7363 6f72  n(curchain_qscor
+00045bb0: 6529 2c20 3329 0a20 2020 2020 2020 2020  e), 3).         
+00045bc0: 2020 2061 746f 6d73 5f69 6e63 6861 696e     atoms_inchain
+00045bd0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00045be0: 2071 7363 6f72 655f 696e 6368 6169 6e20   qscore_inchain 
+00045bf0: 3d20 302e 0a20 2020 2020 2020 2020 2020  = 0..           
+00045c00: 2066 6f72 2072 6573 6964 7565 2069 6e20   for residue in 
+00045c10: 6368 6169 6e3a 0a20 2020 2020 2020 2020  chain:.         
+00045c20: 2020 2020 2020 2063 7572 7265 735f 6e61         curres_na
+00045c30: 6d65 203d 2072 6573 6964 7565 2e72 6573  me = residue.res
+00045c40: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+00045c50: 2020 2020 2069 6620 6375 7272 6573 5f6e       if curres_n
+00045c60: 616d 6520 3d3d 2027 484f 4827 3a0a 2020  ame == 'HOH':.  
 00045c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045c80: 666f 7220 6174 6f6d 2069 6e20 7265 7369  for atom in resi
-00045c90: 6475 653a 0a20 2020 2020 2020 2020 2020  due:.           
-00045ca0: 2020 2020 2020 2020 2069 6620 6174 6f6d           if atom
-00045cb0: 2e6e 616d 652e 7374 6172 7473 7769 7468  .name.startswith
-00045cc0: 2827 4827 2920 6f72 2061 746f 6d2e 6765  ('H') or atom.ge
-00045cd0: 745f 7061 7265 6e74 2829 2e72 6573 6e61  t_parent().resna
-00045ce0: 6d65 203d 3d20 2748 4f48 2720 6f72 2061  me == 'HOH' or a
-00045cf0: 746f 6d2e 6266 6163 746f 7220 3e3d 2031  tom.bfactor >= 1
-00045d00: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
-00045d10: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00045d20: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00045d30: 2020 2020 2020 2020 2061 746f 6d73 5f69           atoms_i
-00045d40: 6e63 6861 696e 202b 3d20 310a 2020 2020  nchain += 1.    
-00045d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045d60: 6174 6f6d 735f 696e 7265 7369 6475 6520  atoms_inresidue 
-00045d70: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00045d80: 2020 2020 2020 2020 2063 7572 6174 6f6d           curatom
-00045d90: 5f71 7363 6f72 6520 3d20 6174 6f6d 2e62  _qscore = atom.b
-00045da0: 6661 6374 6f72 0a20 2020 2020 2020 2020  factor.         
-00045db0: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
-00045dc0: 655f 696e 6368 6169 6e20 2b3d 2063 7572  e_inchain += cur
-00045dd0: 6174 6f6d 5f71 7363 6f72 650a 2020 2020  atom_qscore.    
-00045de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045df0: 7173 636f 7265 5f69 6e72 6573 6964 7565  qscore_inresidue
-00045e00: 202b 3d20 6375 7261 746f 6d5f 7173 636f   += curatom_qsco
-00045e10: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
-00045e20: 2020 2063 7572 7265 735f 7173 636f 7265     curres_qscore
-00045e30: 203d 2072 6f75 6e64 2871 7363 6f72 655f   = round(qscore_
-00045e40: 696e 7265 7369 6475 6520 2f20 6174 6f6d  inresidue / atom
-00045e50: 735f 696e 7265 7369 6475 652c 2033 290a  s_inresidue, 3).
-00045e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045e70: 6966 2063 7572 7265 735f 7173 636f 7265  if curres_qscore
-00045e80: 203e 2031 2e30 3a0a 2020 2020 2020 2020   > 1.0:.        
-00045e90: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00045ea0: 696e 5f71 7363 6f72 6520 3d3d 206d 6178  in_qscore == max
-00045eb0: 5f71 7363 6f72 653a 0a20 2020 2020 2020  _qscore:.       
-00045ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045ed0: 2063 7572 7265 735f 636f 6c6f 7220 3d20   curres_color = 
-00045ee0: 2723 3030 3030 3030 270a 2020 2020 2020  '#000000'.      
-00045ef0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00045f00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00045f10: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-00045f20: 6564 5f71 7363 6f72 6520 3d20 2863 7572  ed_qscore = (cur
-00045f30: 7265 735f 7173 636f 7265 202d 206d 696e  res_qscore - min
-00045f40: 5f71 7363 6f72 6529 202f 2028 6d61 785f  _qscore) / (max_
-00045f50: 7173 636f 7265 202d 206d 696e 5f71 7363  qscore - min_qsc
-00045f60: 6f72 6529 0a20 2020 2020 2020 2020 2020  ore).           
-00045f70: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00045f80: 7265 735f 636f 6c6f 7220 3d20 7365 6c66  res_color = self
-00045f90: 2e5f 5f66 6c6f 6174 6f68 6578 5f61 626f  .__floatohex_abo
-00045fa0: 7665 6f6e 6528 5b73 6361 6c65 645f 7173  veone([scaled_qs
-00045fb0: 636f 7265 5d29 5b30 5d0a 2020 2020 2020  core])[0].      
-00045fc0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00045fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045fe0: 2020 2020 6375 7272 6573 5f63 6f6c 6f72      curres_color
-00045ff0: 203d 2073 656c 662e 5f5f 666c 6f61 746f   = self.__floato
-00046000: 6865 7828 5b63 7572 7265 735f 7173 636f  hex([curres_qsco
-00046010: 7265 5d29 5b30 5d0a 0a20 2020 2020 2020  re])[0]..       
-00046020: 2020 2020 2020 2020 2069 636f 6465 203d           icode =
-00046030: 2072 6573 6964 7565 2e69 645b 325d 0a20   residue.id[2]. 
-00046040: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00046050: 6620 6963 6f64 653a 0a20 2020 2020 2020  f icode:.       
-00046060: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00046070: 7265 735f 7374 7269 6e67 203d 2027 7b7d  res_string = '{}
-00046080: 3a7b 7d7b 7d7b 7d27 2e66 6f72 6d61 7428  :{}{}{}'.format(
-00046090: 6375 7263 6861 696e 5f6e 616d 652c 2063  curchain_name, c
-000460a0: 7572 7265 735f 6964 2c20 6963 6f64 652c  urres_id, icode,
-000460b0: 2063 7572 7265 735f 6e61 6d65 290a 2020   curres_name).  
-000460c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000460d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000460e0: 2020 2020 2020 2020 6375 7272 6573 5f73          curres_s
-000460f0: 7472 696e 6720 3d20 277b 7d3a 7b7d 7b7d  tring = '{}:{}{}
-00046100: 272e 666f 726d 6174 2863 7572 6368 6169  '.format(curchai
-00046110: 6e5f 6e61 6d65 2c20 6375 7272 6573 5f69  n_name, curres_i
-00046120: 642c 2063 7572 7265 735f 6e61 6d65 290a  d, curres_name).
-00046130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046140: 7265 7369 6475 6573 2e61 7070 656e 6428  residues.append(
-00046150: 6375 7272 6573 5f73 7472 696e 6729 0a20  curres_string). 
-00046160: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00046170: 6f6c 6f72 732e 6170 7065 6e64 2863 7572  olors.append(cur
-00046180: 7265 735f 636f 6c6f 7229 0a20 2020 2020  res_color).     
-00046190: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
-000461a0: 6573 2e61 7070 656e 6428 6375 7272 6573  es.append(curres
-000461b0: 5f71 7363 6f72 6529 0a20 2020 2020 2020  _qscore).       
-000461c0: 2020 2020 2061 7665 7261 6765 7173 636f       averageqsco
-000461d0: 7265 5f69 6e63 6f6c 6f72 203d 2073 656c  re_incolor = sel
-000461e0: 662e 5f5f 666c 6f61 746f 6865 7828 5b61  f.__floatohex([a
-000461f0: 7665 7261 6765 6375 7263 6861 696e 5f71  veragecurchain_q
-00046200: 7363 6f72 655d 295b 305d 0a20 2020 2020  score])[0].     
-00046210: 2020 2020 2020 2063 6861 696e 5f71 7363         chain_qsc
-00046220: 6f72 655b 6375 7263 6861 696e 5f6e 616d  ore[curchain_nam
-00046230: 655d 203d 207b 2776 616c 7565 273a 2061  e] = {'value': a
-00046240: 7665 7261 6765 6375 7263 6861 696e 5f71  veragecurchain_q
-00046250: 7363 6f72 652c 2027 636f 6c6f 7227 3a20  score, 'color': 
-00046260: 6176 6572 6167 6571 7363 6f72 655f 696e  averageqscore_in
-00046270: 636f 6c6f 727d 0a0a 2020 2020 2020 2020  color}..        
-00046280: 7464 6963 7420 3d20 4f72 6465 7265 6444  tdict = OrderedD
-00046290: 6963 7428 5b0a 2020 2020 2020 2020 2020  ict([.          
-000462a0: 2020 2827 6176 6572 6167 6571 7363 6f72    ('averageqscor
-000462b0: 6527 2c20 6176 6572 6167 655f 7173 636f  e', average_qsco
-000462c0: 7265 292c 2028 2763 6f6c 6f72 272c 2063  re), ('color', c
-000462d0: 6f6c 6f72 7329 2c0a 2020 2020 2020 2020  olors),.        
-000462e0: 2020 2020 2827 696e 636c 7573 696f 6e27      ('inclusion'
-000462f0: 2c20 7173 636f 7265 7329 2c0a 2020 2020  , qscores),.    
-00046300: 2020 2020 2020 2020 2827 7265 7369 6475          ('residu
-00046310: 6527 2c20 7265 7369 6475 6573 292c 0a20  e', residues),. 
-00046320: 2020 2020 2020 2020 2020 2028 2763 6861             ('cha
-00046330: 696e 7173 636f 7265 272c 2063 6861 696e  inqscore', chain
-00046340: 5f71 7363 6f72 6529 0a0a 2020 2020 2020  _qscore)..      
-00046350: 2020 5d29 0a0a 2020 2020 2020 2020 7265    ])..        re
-00046360: 7375 6c74 6469 6374 203d 204f 7264 6572  sultdict = Order
-00046370: 6564 4469 6374 285b 2827 6e61 6d65 272c  edDict([('name',
-00046380: 206f 7267 6d6f 6465 6c29 2c20 2827 6461   orgmodel), ('da
-00046390: 7461 272c 2074 6469 6374 295d 290a 0a20  ta', tdict)]).. 
-000463a0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000463b0: 7375 6c74 6469 6374 0a0a 2020 2020 6465  sultdict..    de
-000463c0: 6620 7064 6274 6f71 6469 6374 2873 656c  f pdbtoqdict(sel
-000463d0: 662c 2071 7363 6f72 6570 6462 2c20 6f72  f, qscorepdb, or
-000463e0: 676d 6f64 656c 293a 0a20 2020 2020 2020  gmodel):.       
-000463f0: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
-00046400: 2020 4769 7665 6e20 7064 6220 6269 6f70    Given pdb biop
-00046410: 7974 686f 6e20 6f62 6a65 6374 2061 6e64  ython object and
-00046420: 2063 6f6e 7665 7274 2074 6f20 6120 6469   convert to a di
-00046430: 6374 2077 6869 6368 2063 6f6e 7461 696e  ct which contain
-00046440: 7320 616c 6c20 6461 7461 2066 6f72 204a  s all data for J
-00046450: 534f 4e0a 0a20 2020 2020 2020 203a 7265  SON..        :re
-00046460: 7475 726e 3a20 4449 4354 2063 6f6e 7461  turn: DICT conta
-00046470: 696e 7320 616c 6c20 6461 7461 0a20 2020  ins all data.   
-00046480: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00046490: 2020 616c 6c6b 6579 7320 3d20 5b5d 0a20    allkeys = []. 
-000464a0: 2020 2020 2020 2061 6c6c 7661 6c75 6573         allvalues
-000464b0: 203d 205b 5d0a 2020 2020 2020 2020 7072   = [].        pr
-000464c0: 6572 6573 6964 203d 2030 0a20 2020 2020  eresid = 0.     
-000464d0: 2020 2070 7265 6368 6169 6e20 3d20 2727     prechain = ''
-000464e0: 0a20 2020 2020 2020 2061 6970 7265 6368  .        aiprech
-000464f0: 6169 6e20 3d20 2727 0a20 2020 2020 2020  ain = ''.       
-00046500: 2070 7265 7265 7320 3d20 2727 0a20 2020   preres = ''.   
-00046510: 2020 2020 2072 6573 636f 756e 7420 3d20       rescount = 
-00046520: 310a 2020 2020 2020 2020 6174 6f6d 636f  1.        atomco
-00046530: 756e 7420 3d20 300a 2020 2020 2020 2020  unt = 0.        
-00046540: 6368 6169 6e61 746f 6d63 6f75 6e74 203d  chainatomcount =
-00046550: 2030 0a20 2020 2020 2020 2072 6573 6f63   0.        resoc
-00046560: 6320 3d20 302e 0a20 2020 2020 2020 2061  c = 0..        a
-00046570: 6c6c 6174 6f6d 7320 3d20 300a 2020 2020  llatoms = 0.    
-00046580: 2020 2020 616c 6c6f 6363 203d 2030 2e0a      allocc = 0..
-00046590: 2020 2020 2020 2020 6368 6169 6e6f 6363          chainocc
-000465a0: 203d 2030 2e0a 2020 2020 2020 2020 6368   = 0..        ch
-000465b0: 6169 6e63 6f75 6e74 203d 2031 0a20 2020  aincount = 1.   
-000465c0: 2020 2020 2063 6861 696e 6174 6f6d 7320       chainatoms 
-000465d0: 3d20 300a 2020 2020 2020 2020 6368 6169  = 0.        chai
-000465e0: 6e71 7363 6f72 6520 3d20 7b7d 0a20 2020  nqscore = {}.   
-000465f0: 2020 2020 2066 6f72 2061 746f 6d20 696e       for atom in
-00046600: 2071 7363 6f72 6570 6462 3a0a 2020 2020   qscorepdb:.    
-00046610: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-00046620: 746f 6d2e 6174 6f6d 5f6e 616d 652e 7374  tom.atom_name.st
-00046630: 6172 7473 7769 7468 2827 4827 293a 0a20  artswith('H'):. 
-00046640: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00046650: 6c6c 6174 6f6d 7320 2b3d 2031 0a20 2020  llatoms += 1.   
-00046660: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
-00046670: 6f63 6320 2b3d 2061 746f 6d2e 7465 6d70  occ += atom.temp
-00046680: 5f66 6163 0a20 2020 2020 2020 2020 2020  _fac.           
-00046690: 2020 2020 2061 746f 6d63 6f75 6e74 202b       atomcount +
-000466a0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-000466b0: 2020 2020 6368 6169 6e61 746f 6d63 6f75      chainatomcou
-000466c0: 6e74 202b 3d20 310a 2020 2020 2020 2020  nt += 1.        
-000466d0: 2020 2020 2020 2020 6966 2028 6174 6f6d          if (atom
-000466e0: 636f 756e 7420 3d3d 2031 2920 6f72 2028  count == 1) or (
-000466f0: 6174 6f6d 2e72 6573 5f6e 6f20 3d3d 2070  atom.res_no == p
-00046700: 7265 7265 7369 6420 616e 6420 6174 6f6d  reresid and atom
-00046710: 2e63 6861 696e 203d 3d20 7072 6563 6861  .chain == precha
-00046720: 696e 293a 0a20 2020 2020 2020 2020 2020  in):.           
-00046730: 2020 2020 2020 2020 2070 7265 7265 7369           preresi
-00046740: 6420 3d20 6174 6f6d 2e72 6573 5f6e 6f0a  d = atom.res_no.
-00046750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046760: 2020 2020 7072 6563 6861 696e 203d 2061      prechain = a
-00046770: 746f 6d2e 6368 6169 6e0a 2020 2020 2020  tom.chain.      
-00046780: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00046790: 6572 6573 203d 2061 746f 6d2e 7265 730a  eres = atom.res.
-000467a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000467b0: 2020 2020 7265 736f 6363 202b 3d20 6174      resocc += at
-000467c0: 6f6d 2e74 656d 705f 6661 630a 2020 2020  om.temp_fac.    
-000467d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000467e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000467f0: 2020 2020 2020 6174 6f6d 636f 756e 7420        atomcount 
-00046800: 2d3d 2031 0a20 2020 2020 2020 2020 2020  -= 1.           
-00046810: 2020 2020 2020 2020 206b 6579 7374 7220           keystr 
-00046820: 3d20 7072 6563 6861 696e 202b 2027 3a27  = prechain + ':'
-00046830: 202b 2073 7472 2870 7265 7265 7369 6429   + str(preresid)
-00046840: 202b 2070 7265 7265 730a 2020 2020 2020   + preres.      
-00046850: 2020 2020 2020 2020 2020 2020 2020 616c                al
-00046860: 6c6b 6579 732e 6170 7065 6e64 286b 6579  lkeys.append(key
-00046870: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
-00046880: 2020 2020 2020 2020 2072 6573 6f63 6376           resoccv
-00046890: 616c 7565 203d 2072 6573 6f63 6320 2f20  alue = resocc / 
-000468a0: 6174 6f6d 636f 756e 740a 2020 2020 2020  atomcount.      
-000468b0: 2020 2020 2020 2020 2020 2020 2020 616c                al
-000468c0: 6c76 616c 7565 732e 6170 7065 6e64 2872  lvalues.append(r
-000468d0: 6573 6f63 6376 616c 7565 290a 2020 2020  esoccvalue).    
-000468e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000468f0: 7072 6572 6573 6964 203d 2061 746f 6d2e  preresid = atom.
-00046900: 7265 735f 6e6f 0a20 2020 2020 2020 2020  res_no.         
-00046910: 2020 2020 2020 2020 2020 2070 7265 6368             prech
-00046920: 6169 6e20 3d20 6174 6f6d 2e63 6861 696e  ain = atom.chain
-00046930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046940: 2020 2020 2070 7265 7265 7320 3d20 6174       preres = at
-00046950: 6f6d 2e72 6573 0a20 2020 2020 2020 2020  om.res.         
-00046960: 2020 2020 2020 2020 2020 2061 746f 6d63             atomc
-00046970: 6f75 6e74 203d 2031 0a20 2020 2020 2020  ount = 1.       
-00046980: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00046990: 636f 756e 7420 2b3d 2031 0a20 2020 2020  count += 1.     
-000469a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000469b0: 6573 6f63 6320 3d20 6174 6f6d 2e74 656d  esocc = atom.tem
-000469c0: 705f 6661 630a 2020 2020 2020 2020 2020  p_fac.          
-000469d0: 2020 2020 2020 6966 2028 6368 6169 6e61        if (chaina
-000469e0: 746f 6d63 6f75 6e74 203d 3d20 3129 206f  tomcount == 1) o
-000469f0: 7220 2861 746f 6d2e 6368 6169 6e20 3d3d  r (atom.chain ==
-00046a00: 2061 6970 7265 6368 6169 6e29 3a0a 2020   aiprechain):.  
-00046a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046a20: 2020 6368 6169 6e61 746f 6d73 202b 3d20    chainatoms += 
-00046a30: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00046a40: 2020 2020 2020 6169 7072 6563 6861 696e        aiprechain
-00046a50: 203d 2061 746f 6d2e 6368 6169 6e0a 2020   = atom.chain.  
-00046a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046a70: 2020 6368 6169 6e6f 6363 202b 3d20 6174    chainocc += at
-00046a80: 6f6d 2e74 656d 705f 6661 630a 2020 2020  om.temp_fac.    
-00046a90: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00046aa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00046ab0: 2020 2020 2020 7176 616c 7565 203d 2072        qvalue = r
-00046ac0: 6f75 6e64 2863 6861 696e 6f63 6320 2f20  ound(chainocc / 
-00046ad0: 6368 6169 6e61 746f 6d73 2c20 3329 0a20  chainatoms, 3). 
-00046ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046af0: 2020 2071 636f 6c6f 7220 3d20 7365 6c66     qcolor = self
-00046b00: 2e5f 5f66 6c6f 6174 6f68 6578 285b 7176  .__floatohex([qv
-00046b10: 616c 7565 5d29 5b30 5d0a 2020 2020 2020  alue])[0].      
-00046b20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00046b30: 6368 6169 6e71 7363 6f72 655b 6169 7072  chainqscore[aipr
-00046b40: 6563 6861 696e 5d20 3d20 7b27 7661 6c75  echain] = {'valu
-00046b50: 6527 3a20 7176 616c 7565 2c20 2763 6f6c  e': qvalue, 'col
-00046b60: 6f72 273a 2071 636f 6c6f 727d 0a20 2020  or': qcolor}.   
+00045c80: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00045c90: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00045ca0: 735f 6964 203d 2072 6573 6964 7565 2e69  s_id = residue.i
+00045cb0: 645b 315d 0a20 2020 2020 2020 2020 2020  d[1].           
+00045cc0: 2020 2020 2061 746f 6d73 5f69 6e72 6573       atoms_inres
+00045cd0: 6964 7565 203d 2030 0a20 2020 2020 2020  idue = 0.       
+00045ce0: 2020 2020 2020 2020 2071 7363 6f72 655f           qscore_
+00045cf0: 696e 7265 7369 6475 6520 3d20 302e 0a20  inresidue = 0.. 
+00045d00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00045d10: 6f72 2061 746f 6d20 696e 2072 6573 6964  or atom in resid
+00045d20: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00045d30: 2020 2020 2020 2020 6966 2061 746f 6d2e          if atom.
+00045d40: 6e61 6d65 2e73 7461 7274 7377 6974 6828  name.startswith(
+00045d50: 2748 2729 206f 7220 6174 6f6d 2e67 6574  'H') or atom.get
+00045d60: 5f70 6172 656e 7428 292e 7265 736e 616d  _parent().resnam
+00045d70: 6520 3d3d 2027 484f 4827 206f 7220 6174  e == 'HOH' or at
+00045d80: 6f6d 2e62 6661 6374 6f72 203e 3d20 312e  om.bfactor >= 1.
+00045d90: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00045da0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00045db0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00045dc0: 2020 2020 2020 2020 6174 6f6d 735f 696e          atoms_in
+00045dd0: 6368 6169 6e20 2b3d 2031 0a20 2020 2020  chain += 1.     
+00045de0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00045df0: 746f 6d73 5f69 6e72 6573 6964 7565 202b  toms_inresidue +
+00045e00: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00045e10: 2020 2020 2020 2020 6375 7261 746f 6d5f          curatom_
+00045e20: 7173 636f 7265 203d 2061 746f 6d2e 6266  qscore = atom.bf
+00045e30: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00045e40: 2020 2020 2020 2020 2020 7173 636f 7265            qscore
+00045e50: 5f69 6e63 6861 696e 202b 3d20 6375 7261  _inchain += cura
+00045e60: 746f 6d5f 7173 636f 7265 0a20 2020 2020  tom_qscore.     
+00045e70: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+00045e80: 7363 6f72 655f 696e 7265 7369 6475 6520  score_inresidue 
+00045e90: 2b3d 2063 7572 6174 6f6d 5f71 7363 6f72  += curatom_qscor
+00045ea0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00045eb0: 2020 6375 7272 6573 5f71 7363 6f72 6520    curres_qscore 
+00045ec0: 3d20 726f 756e 6428 7173 636f 7265 5f69  = round(qscore_i
+00045ed0: 6e72 6573 6964 7565 202f 2061 746f 6d73  nresidue / atoms
+00045ee0: 5f69 6e72 6573 6964 7565 2c20 3329 0a20  _inresidue, 3). 
+00045ef0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00045f00: 6620 6375 7272 6573 5f71 7363 6f72 6520  f curres_qscore 
+00045f10: 3e20 312e 303a 0a20 2020 2020 2020 2020  > 1.0:.         
+00045f20: 2020 2020 2020 2020 2020 2069 6620 6d69             if mi
+00045f30: 6e5f 7173 636f 7265 203d 3d20 6d61 785f  n_qscore == max_
+00045f40: 7173 636f 7265 3a0a 2020 2020 2020 2020  qscore:.        
+00045f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045f60: 6375 7272 6573 5f63 6f6c 6f72 203d 2027  curres_color = '
+00045f70: 2330 3030 3030 3027 0a20 2020 2020 2020  #000000'.       
+00045f80: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00045f90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00045fa0: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+00045fb0: 645f 7173 636f 7265 203d 2028 6375 7272  d_qscore = (curr
+00045fc0: 6573 5f71 7363 6f72 6520 2d20 6d69 6e5f  es_qscore - min_
+00045fd0: 7173 636f 7265 2920 2f20 286d 6178 5f71  qscore) / (max_q
+00045fe0: 7363 6f72 6520 2d20 6d69 6e5f 7173 636f  score - min_qsco
+00045ff0: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
+00046000: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00046010: 6573 5f63 6f6c 6f72 203d 2073 656c 662e  es_color = self.
+00046020: 5f5f 666c 6f61 746f 6865 785f 6162 6f76  __floatohex_abov
+00046030: 656f 6e65 285b 7363 616c 6564 5f71 7363  eone([scaled_qsc
+00046040: 6f72 655d 295b 305d 0a20 2020 2020 2020  ore])[0].       
+00046050: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00046060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046070: 2020 2063 7572 7265 735f 636f 6c6f 7220     curres_color 
+00046080: 3d20 7365 6c66 2e5f 5f66 6c6f 6174 6f68  = self.__floatoh
+00046090: 6578 285b 6375 7272 6573 5f71 7363 6f72  ex([curres_qscor
+000460a0: 655d 295b 305d 0a0a 2020 2020 2020 2020  e])[0]..        
+000460b0: 2020 2020 2020 2020 6963 6f64 6520 3d20          icode = 
+000460c0: 7265 7369 6475 652e 6964 5b32 5d0a 2020  residue.id[2].  
+000460d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000460e0: 2069 636f 6465 3a0a 2020 2020 2020 2020   icode:.        
+000460f0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00046100: 6573 5f73 7472 696e 6720 3d20 277b 7d3a  es_string = '{}:
+00046110: 7b7d 7b7d 7b7d 272e 666f 726d 6174 2863  {}{}{}'.format(c
+00046120: 7572 6368 6169 6e5f 6e61 6d65 2c20 6375  urchain_name, cu
+00046130: 7272 6573 5f69 642c 2069 636f 6465 2c20  rres_id, icode, 
+00046140: 6375 7272 6573 5f6e 616d 6529 0a20 2020  curres_name).   
+00046150: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00046160: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00046170: 2020 2020 2020 2063 7572 7265 735f 7374         curres_st
+00046180: 7269 6e67 203d 2027 7b7d 3a7b 7d7b 7d27  ring = '{}:{}{}'
+00046190: 2e66 6f72 6d61 7428 6375 7263 6861 696e  .format(curchain
+000461a0: 5f6e 616d 652c 2063 7572 7265 735f 6964  _name, curres_id
+000461b0: 2c20 6375 7272 6573 5f6e 616d 6529 0a20  , curres_name). 
+000461c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000461d0: 6573 6964 7565 732e 6170 7065 6e64 2863  esidues.append(c
+000461e0: 7572 7265 735f 7374 7269 6e67 290a 2020  urres_string).  
+000461f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00046200: 6c6f 7273 2e61 7070 656e 6428 6375 7272  lors.append(curr
+00046210: 6573 5f63 6f6c 6f72 290a 2020 2020 2020  es_color).      
+00046220: 2020 2020 2020 2020 2020 7173 636f 7265            qscore
+00046230: 732e 6170 7065 6e64 2863 7572 7265 735f  s.append(curres_
+00046240: 7173 636f 7265 290a 2020 2020 2020 2020  qscore).        
+00046250: 2020 2020 6176 6572 6167 6571 7363 6f72      averageqscor
+00046260: 655f 696e 636f 6c6f 7220 3d20 7365 6c66  e_incolor = self
+00046270: 2e5f 5f66 6c6f 6174 6f68 6578 285b 6176  .__floatohex([av
+00046280: 6572 6167 6563 7572 6368 6169 6e5f 7173  eragecurchain_qs
+00046290: 636f 7265 5d29 5b30 5d0a 2020 2020 2020  core])[0].      
+000462a0: 2020 2020 2020 6368 6169 6e5f 7173 636f        chain_qsco
+000462b0: 7265 5b63 7572 6368 6169 6e5f 6e61 6d65  re[curchain_name
+000462c0: 5d20 3d20 7b27 7661 6c75 6527 3a20 6176  ] = {'value': av
+000462d0: 6572 6167 6563 7572 6368 6169 6e5f 7173  eragecurchain_qs
+000462e0: 636f 7265 2c20 2763 6f6c 6f72 273a 2061  core, 'color': a
+000462f0: 7665 7261 6765 7173 636f 7265 5f69 6e63  verageqscore_inc
+00046300: 6f6c 6f72 7d0a 0a20 2020 2020 2020 2074  olor}..        t
+00046310: 6469 6374 203d 204f 7264 6572 6564 4469  dict = OrderedDi
+00046320: 6374 285b 0a20 2020 2020 2020 2020 2020  ct([.           
+00046330: 2028 2761 7665 7261 6765 7173 636f 7265   ('averageqscore
+00046340: 272c 2061 7665 7261 6765 5f71 7363 6f72  ', average_qscor
+00046350: 6529 2c20 2827 636f 6c6f 7227 2c20 636f  e), ('color', co
+00046360: 6c6f 7273 292c 0a20 2020 2020 2020 2020  lors),.         
+00046370: 2020 2028 2769 6e63 6c75 7369 6f6e 272c     ('inclusion',
+00046380: 2071 7363 6f72 6573 292c 0a20 2020 2020   qscores),.     
+00046390: 2020 2020 2020 2028 2772 6573 6964 7565         ('residue
+000463a0: 272c 2072 6573 6964 7565 7329 2c0a 2020  ', residues),.  
+000463b0: 2020 2020 2020 2020 2020 2827 6368 6169            ('chai
+000463c0: 6e71 7363 6f72 6527 2c20 6368 6169 6e5f  nqscore', chain_
+000463d0: 7173 636f 7265 290a 0a20 2020 2020 2020  qscore)..       
+000463e0: 205d 290a 0a20 2020 2020 2020 2072 6573   ])..        res
+000463f0: 756c 7464 6963 7420 3d20 4f72 6465 7265  ultdict = Ordere
+00046400: 6444 6963 7428 5b28 276e 616d 6527 2c20  dDict([('name', 
+00046410: 6f72 676d 6f64 656c 292c 2028 2764 6174  orgmodel), ('dat
+00046420: 6127 2c20 7464 6963 7429 5d29 0a0a 2020  a', tdict)])..  
+00046430: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00046440: 756c 7464 6963 740a 0a20 2020 2064 6566  ultdict..    def
+00046450: 2070 6462 746f 7164 6963 7428 7365 6c66   pdbtoqdict(self
+00046460: 2c20 7173 636f 7265 7064 622c 206f 7267  , qscorepdb, org
+00046470: 6d6f 6465 6c29 3a0a 2020 2020 2020 2020  model):.        
+00046480: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
+00046490: 2047 6976 656e 2070 6462 2062 696f 7079   Given pdb biopy
+000464a0: 7468 6f6e 206f 626a 6563 7420 616e 6420  thon object and 
+000464b0: 636f 6e76 6572 7420 746f 2061 2064 6963  convert to a dic
+000464c0: 7420 7768 6963 6820 636f 6e74 6169 6e73  t which contains
+000464d0: 2061 6c6c 2064 6174 6120 666f 7220 4a53   all data for JS
+000464e0: 4f4e 0a0a 2020 2020 2020 2020 3a72 6574  ON..        :ret
+000464f0: 7572 6e3a 2044 4943 5420 636f 6e74 6169  urn: DICT contai
+00046500: 6e73 2061 6c6c 2064 6174 610a 2020 2020  ns all data.    
+00046510: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00046520: 2061 6c6c 6b65 7973 203d 205b 5d0a 2020   allkeys = [].  
+00046530: 2020 2020 2020 616c 6c76 616c 7565 7320        allvalues 
+00046540: 3d20 5b5d 0a20 2020 2020 2020 2070 7265  = [].        pre
+00046550: 7265 7369 6420 3d20 300a 2020 2020 2020  resid = 0.      
+00046560: 2020 7072 6563 6861 696e 203d 2027 270a    prechain = ''.
+00046570: 2020 2020 2020 2020 6169 7072 6563 6861          aiprecha
+00046580: 696e 203d 2027 270a 2020 2020 2020 2020  in = ''.        
+00046590: 7072 6572 6573 203d 2027 270a 2020 2020  preres = ''.    
+000465a0: 2020 2020 7265 7363 6f75 6e74 203d 2031      rescount = 1
+000465b0: 0a20 2020 2020 2020 2061 746f 6d63 6f75  .        atomcou
+000465c0: 6e74 203d 2030 0a20 2020 2020 2020 2063  nt = 0.        c
+000465d0: 6861 696e 6174 6f6d 636f 756e 7420 3d20  hainatomcount = 
+000465e0: 300a 2020 2020 2020 2020 7265 736f 6363  0.        resocc
+000465f0: 203d 2030 2e0a 2020 2020 2020 2020 616c   = 0..        al
+00046600: 6c61 746f 6d73 203d 2030 0a20 2020 2020  latoms = 0.     
+00046610: 2020 2061 6c6c 6f63 6320 3d20 302e 0a20     allocc = 0.. 
+00046620: 2020 2020 2020 2063 6861 696e 6f63 6320         chainocc 
+00046630: 3d20 302e 0a20 2020 2020 2020 2063 6861  = 0..        cha
+00046640: 696e 636f 756e 7420 3d20 310a 2020 2020  incount = 1.    
+00046650: 2020 2020 6368 6169 6e61 746f 6d73 203d      chainatoms =
+00046660: 2030 0a20 2020 2020 2020 2063 6861 696e   0.        chain
+00046670: 7173 636f 7265 203d 207b 7d0a 2020 2020  qscore = {}.    
+00046680: 2020 2020 666f 7220 6174 6f6d 2069 6e20      for atom in 
+00046690: 7173 636f 7265 7064 623a 0a20 2020 2020  qscorepdb:.     
+000466a0: 2020 2020 2020 2069 6620 6e6f 7420 6174         if not at
+000466b0: 6f6d 2e61 746f 6d5f 6e61 6d65 2e73 7461  om.atom_name.sta
+000466c0: 7274 7377 6974 6828 2748 2729 3a0a 2020  rtswith('H'):.  
+000466d0: 2020 2020 2020 2020 2020 2020 2020 616c                al
+000466e0: 6c61 746f 6d73 202b 3d20 310a 2020 2020  latoms += 1.    
+000466f0: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
+00046700: 6363 202b 3d20 6174 6f6d 2e74 656d 705f  cc += atom.temp_
+00046710: 6661 630a 2020 2020 2020 2020 2020 2020  fac.            
+00046720: 2020 2020 6174 6f6d 636f 756e 7420 2b3d      atomcount +=
+00046730: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00046740: 2020 2063 6861 696e 6174 6f6d 636f 756e     chainatomcoun
+00046750: 7420 2b3d 2031 0a20 2020 2020 2020 2020  t += 1.         
+00046760: 2020 2020 2020 2069 6620 2861 746f 6d63         if (atomc
+00046770: 6f75 6e74 203d 3d20 3129 206f 7220 2861  ount == 1) or (a
+00046780: 746f 6d2e 7265 735f 6e6f 203d 3d20 7072  tom.res_no == pr
+00046790: 6572 6573 6964 2061 6e64 2061 746f 6d2e  eresid and atom.
+000467a0: 6368 6169 6e20 3d3d 2070 7265 6368 6169  chain == prechai
+000467b0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
+000467c0: 2020 2020 2020 2020 7072 6572 6573 6964          preresid
+000467d0: 203d 2061 746f 6d2e 7265 735f 6e6f 0a20   = atom.res_no. 
+000467e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000467f0: 2020 2070 7265 6368 6169 6e20 3d20 6174     prechain = at
+00046800: 6f6d 2e63 6861 696e 0a20 2020 2020 2020  om.chain.       
+00046810: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00046820: 7265 7320 3d20 6174 6f6d 2e72 6573 0a20  res = atom.res. 
+00046830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046840: 2020 2072 6573 6f63 6320 2b3d 2061 746f     resocc += ato
+00046850: 6d2e 7465 6d70 5f66 6163 0a20 2020 2020  m.temp_fac.     
+00046860: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00046870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046880: 2020 2020 2061 746f 6d63 6f75 6e74 202d       atomcount -
+00046890: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+000468a0: 2020 2020 2020 2020 6b65 7973 7472 203d          keystr =
+000468b0: 2070 7265 6368 6169 6e20 2b20 273a 2720   prechain + ':' 
+000468c0: 2b20 7374 7228 7072 6572 6573 6964 2920  + str(preresid) 
+000468d0: 2b20 7072 6572 6573 0a20 2020 2020 2020  + preres.       
+000468e0: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
+000468f0: 6b65 7973 2e61 7070 656e 6428 6b65 7973  keys.append(keys
+00046900: 7472 290a 2020 2020 2020 2020 2020 2020  tr).            
+00046910: 2020 2020 2020 2020 7265 736f 6363 7661          resoccva
+00046920: 6c75 6520 3d20 7265 736f 6363 202f 2061  lue = resocc / a
+00046930: 746f 6d63 6f75 6e74 0a20 2020 2020 2020  tomcount.       
+00046940: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
+00046950: 7661 6c75 6573 2e61 7070 656e 6428 7265  values.append(re
+00046960: 736f 6363 7661 6c75 6529 0a20 2020 2020  soccvalue).     
+00046970: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00046980: 7265 7265 7369 6420 3d20 6174 6f6d 2e72  reresid = atom.r
+00046990: 6573 5f6e 6f0a 2020 2020 2020 2020 2020  es_no.          
+000469a0: 2020 2020 2020 2020 2020 7072 6563 6861            precha
+000469b0: 696e 203d 2061 746f 6d2e 6368 6169 6e0a  in = atom.chain.
+000469c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000469d0: 2020 2020 7072 6572 6573 203d 2061 746f      preres = ato
+000469e0: 6d2e 7265 730a 2020 2020 2020 2020 2020  m.res.          
+000469f0: 2020 2020 2020 2020 2020 6174 6f6d 636f            atomco
+00046a00: 756e 7420 3d20 310a 2020 2020 2020 2020  unt = 1.        
+00046a10: 2020 2020 2020 2020 2020 2020 7265 7363              resc
+00046a20: 6f75 6e74 202b 3d20 310a 2020 2020 2020  ount += 1.      
+00046a30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00046a40: 736f 6363 203d 2061 746f 6d2e 7465 6d70  socc = atom.temp
+00046a50: 5f66 6163 0a20 2020 2020 2020 2020 2020  _fac.           
+00046a60: 2020 2020 2069 6620 2863 6861 696e 6174       if (chainat
+00046a70: 6f6d 636f 756e 7420 3d3d 2031 2920 6f72  omcount == 1) or
+00046a80: 2028 6174 6f6d 2e63 6861 696e 203d 3d20   (atom.chain == 
+00046a90: 6169 7072 6563 6861 696e 293a 0a20 2020  aiprechain):.   
+00046aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046ab0: 2063 6861 696e 6174 6f6d 7320 2b3d 2031   chainatoms += 1
+00046ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046ad0: 2020 2020 2061 6970 7265 6368 6169 6e20       aiprechain 
+00046ae0: 3d20 6174 6f6d 2e63 6861 696e 0a20 2020  = atom.chain.   
+00046af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046b00: 2063 6861 696e 6f63 6320 2b3d 2061 746f   chainocc += ato
+00046b10: 6d2e 7465 6d70 5f66 6163 0a20 2020 2020  m.temp_fac.     
+00046b20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00046b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046b40: 2020 2020 2071 7661 6c75 6520 3d20 726f       qvalue = ro
+00046b50: 756e 6428 6368 6169 6e6f 6363 202f 2063  und(chainocc / c
+00046b60: 6861 696e 6174 6f6d 732c 2033 290a 2020  hainatoms, 3).  
 00046b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046b80: 2069 6620 6169 7072 6563 6861 696e 2069   if aiprechain i
-00046b90: 6e20 6368 6169 6e71 7363 6f72 652e 6b65  n chainqscore.ke
-00046ba0: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
-00046bb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00046bc0: 6368 6169 6e71 7363 6f72 655b 7072 6563  chainqscore[prec
-00046bd0: 6861 696e 202b 2027 5f27 202b 2073 7472  hain + '_' + str
-00046be0: 2861 6976 616c 7565 295d 203d 207b 2776  (aivalue)] = {'v
-00046bf0: 616c 7565 273a 2061 6976 616c 7565 2c20  alue': aivalue, 
-00046c00: 2763 6f6c 6f72 273a 2061 6963 6f6c 6f72  'color': aicolor
-00046c10: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00046c20: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-00046c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00046c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c60: 2063 6861 696e 7173 636f 7265 5b61 6970   chainqscore[aip
-00046c70: 7265 6368 6169 6e5d 203d 207b 2776 616c  rechain] = {'val
-00046c80: 7565 273a 2071 7661 6c75 652c 2027 636f  ue': qvalue, 'co
-00046c90: 6c6f 7227 3a20 7163 6f6c 6f72 7d0a 2020  lor': qcolor}.  
-00046ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046cb0: 2020 6368 6169 6e61 746f 6d73 203d 2031    chainatoms = 1
-00046cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046cd0: 2020 2020 2063 6861 696e 6f63 6320 3d20       chainocc = 
-00046ce0: 6174 6f6d 2e74 656d 705f 6661 630a 2020  atom.temp_fac.  
-00046cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046d00: 2020 6169 7072 6563 6861 696e 203d 2061    aiprechain = a
-00046d10: 746f 6d2e 6368 6169 6e0a 2020 2020 2020  tom.chain.      
-00046d20: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00046d30: 6169 6e63 6f75 6e74 202b 3d20 310a 0a20  aincount += 1.. 
-00046d40: 2020 2020 2020 2071 7661 6c75 6520 3d20         qvalue = 
-00046d50: 726f 756e 6428 6368 6169 6e6f 6363 202f  round(chainocc /
-00046d60: 2063 6861 696e 6174 6f6d 732c 2033 290a   chainatoms, 3).
-00046d70: 2020 2020 2020 2020 7163 6f6c 6f72 203d          qcolor =
-00046d80: 2073 656c 662e 5f5f 666c 6f61 746f 6865   self.__floatohe
-00046d90: 7828 5b71 7661 6c75 655d 295b 305d 0a20  x([qvalue])[0]. 
-00046da0: 2020 2020 2020 2069 6620 6169 7072 6563         if aiprec
-00046db0: 6861 696e 2069 6e20 6368 6169 6e71 7363  hain in chainqsc
-00046dc0: 6f72 652e 6b65 7973 2829 3a0a 2020 2020  ore.keys():.    
-00046dd0: 2020 2020 2020 2020 2320 6368 6169 6e71          # chainq
-00046de0: 7363 6f72 655b 7072 6563 6861 696e 202b  score[prechain +
-00046df0: 2027 5f27 202b 2073 7472 2861 6976 616c   '_' + str(aival
-00046e00: 7565 295d 203d 207b 2776 616c 7565 273a  ue)] = {'value':
-00046e10: 2061 6976 616c 7565 2c20 2763 6f6c 6f72   aivalue, 'color
-00046e20: 273a 2061 6963 6f6c 6f72 7d0a 2020 2020  ': aicolor}.    
-00046e30: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00046e40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00046e50: 2020 2020 2020 2063 6861 696e 7173 636f         chainqsco
-00046e60: 7265 5b61 6970 7265 6368 6169 6e5d 203d  re[aiprechain] =
-00046e70: 207b 2776 616c 7565 273a 2071 7661 6c75   {'value': qvalu
-00046e80: 652c 2027 636f 6c6f 7227 3a20 7163 6f6c  e, 'color': qcol
-00046e90: 6f72 7d0a 2020 2020 2020 2020 6c61 7374  or}.        last
-00046ea0: 7661 6c75 6520 3d20 7265 736f 6363 202f  value = resocc /
-00046eb0: 2061 746f 6d63 6f75 6e74 0a20 2020 2020   atomcount.     
-00046ec0: 2020 206b 6579 7374 7220 3d20 7072 6563     keystr = prec
-00046ed0: 6861 696e 202b 2027 3a27 202b 2073 7472  hain + ':' + str
-00046ee0: 2870 7265 7265 7369 6429 202b 2070 7265  (preresid) + pre
-00046ef0: 7265 730a 2020 2020 2020 2020 616c 6c6b  res.        allk
-00046f00: 6579 732e 6170 7065 6e64 286b 6579 7374  eys.append(keyst
-00046f10: 7229 0a20 2020 2020 2020 2061 6c6c 7661  r).        allva
-00046f20: 6c75 6573 2e61 7070 656e 6428 6c61 7374  lues.append(last
-00046f30: 7661 6c75 6529 0a20 2020 2020 2020 2063  value).        c
-00046f40: 6f6c 6f75 7273 203d 2073 656c 662e 5f5f  olours = self.__
-00046f50: 666c 6f61 746f 6865 7828 5b69 2066 6f72  floatohex([i for
-00046f60: 2069 2069 6e20 616c 6c76 616c 7565 735d   i in allvalues]
-00046f70: 290a 2020 2020 2020 2020 6176 6572 6167  ).        averag
-00046f80: 656f 6363 203d 2061 6c6c 6f63 6320 2f20  eocc = allocc / 
-00046f90: 616c 6c61 746f 6d73 0a0a 2020 2020 2020  allatoms..      
-00046fa0: 2020 7464 6963 7420 3d20 4f72 6465 7265    tdict = Ordere
-00046fb0: 6444 6963 7428 5b0a 2020 2020 2020 2020  dDict([.        
-00046fc0: 2020 2020 2827 6176 6572 6167 656f 6363      ('averageocc
-00046fd0: 272c 2072 6f75 6e64 2861 7665 7261 6765  ', round(average
-00046fe0: 6f63 632c 2036 2929 2c20 2827 636f 6c6f  occ, 6)), ('colo
-00046ff0: 7227 2c20 636f 6c6f 7572 7329 2c0a 2020  r', colours),.  
-00047000: 2020 2020 2020 2020 2020 2827 696e 636c            ('incl
-00047010: 7573 696f 6e27 2c20 5b72 6f75 6e64 2865  usion', [round(e
-00047020: 6c65 6d2c 2036 2920 666f 7220 656c 656d  lem, 6) for elem
-00047030: 2069 6e20 616c 6c76 616c 7565 735d 292c   in allvalues]),
-00047040: 0a20 2020 2020 2020 2020 2020 2028 2772  .            ('r
-00047050: 6573 6964 7565 272c 2061 6c6c 6b65 7973  esidue', allkeys
-00047060: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-00047070: 2763 6861 696e 7173 636f 7265 272c 2063  'chainqscore', c
-00047080: 6861 696e 7173 636f 7265 290a 0a20 2020  hainqscore)..   
-00047090: 2020 2020 205d 290a 0a20 2020 2020 2020       ])..       
-000470a0: 2072 6573 756c 7464 6963 7420 3d20 4f72   resultdict = Or
-000470b0: 6465 7265 6444 6963 7428 5b28 276e 616d  deredDict([('nam
-000470c0: 6527 2c20 6f72 676d 6f64 656c 292c 2028  e', orgmodel), (
-000470d0: 2764 6174 6127 2c20 7464 6963 7429 5d29  'data', tdict)])
-000470e0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000470f0: 2072 6573 756c 7464 6963 740a 0a20 2020   resultdict..   
-00047100: 2064 6566 2071 7363 6f72 6576 6965 7728   def qscoreview(
-00047110: 7365 6c66 2c20 6368 696d 6572 6161 7070  self, chimeraapp
-00047120: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
-00047130: 2020 2020 2020 2020 2020 2020 582c 2059              X, Y
-00047140: 2c20 5a20 696d 6167 6573 2077 6869 6368  , Z images which
-00047150: 206d 6f64 656c 2077 6173 2063 6f6c 6f72   model was color
-00047160: 6564 2062 7920 512d 7363 6f72 650a 0a20  ed by Q-score.. 
-00047170: 2020 2020 2020 203a 7265 7475 726e 3a0a         :return:.
-00047180: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00047190: 2020 2020 2023 2072 6561 6420 6a73 6f6e       # read json
-000471a0: 0a20 2020 2020 2020 2073 7461 7274 203d  .        start =
-000471b0: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-000471c0: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
-000471d0: 696e 6a73 6f6e 203d 2067 6c6f 622e 676c  injson = glob.gl
-000471e0: 6f62 2873 656c 662e 776f 726b 6469 7220  ob(self.workdir 
-000471f0: 2b20 272a 5f71 7363 6f72 652e 6a73 6f6e  + '*_qscore.json
-00047200: 2729 0a20 2020 2020 2020 2062 6173 6564  ').        based
-00047210: 6972 203d 2073 656c 662e 776f 726b 6469  ir = self.workdi
-00047220: 720a 2020 2020 2020 2020 6d61 706e 616d  r.        mapnam
-00047230: 6520 3d20 7365 6c66 2e6d 6170 6e61 6d65  e = self.mapname
-00047240: 0a20 2020 2020 2020 206c 6f63 4348 494d  .        locCHIM
-00047250: 4552 4120 3d20 6368 696d 6572 6161 7070  ERA = chimeraapp
-00047260: 0a20 2020 2020 2020 2062 696e 6469 7370  .        bindisp
-00047270: 6c61 7920 3d20 6f73 2e67 6574 656e 7628  lay = os.getenv(
-00047280: 2744 4953 504c 4159 2729 0a20 2020 2020  'DISPLAY').     
-00047290: 2020 2065 7272 6c69 7374 203d 205b 5d0a     errlist = [].
-000472a0: 0a20 2020 2020 2020 2066 756c 696e 6a73  .        fulinjs
-000472b0: 6f6e 203d 2069 6e6a 736f 6e5b 305d 2069  on = injson[0] i
-000472c0: 6620 696e 6a73 6f6e 2065 6c73 6520 4e6f  f injson else No
-000472d0: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
-000472e0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-000472f0: 756c 696e 6a73 6f6e 3a0a 2020 2020 2020  ulinjson:.      
-00047300: 2020 2020 2020 2020 2020 7769 7468 206f            with o
-00047310: 7065 6e28 6675 6c69 6e6a 736f 6e2c 2027  pen(fulinjson, '
-00047320: 7227 2920 6173 2066 3a0a 2020 2020 2020  r') as f:.      
-00047330: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-00047340: 6773 203d 206a 736f 6e2e 6c6f 6164 2866  gs = json.load(f
-00047350: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00047360: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00047370: 2020 2020 6172 6773 203d 204e 6f6e 650a      args = None.
-00047380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047390: 7072 696e 7428 2754 6865 7265 2069 7320  print('There is 
-000473a0: 6e6f 2051 7363 6f72 6520 6a73 6f6e 2066  no Qscore json f
-000473b0: 696c 652e 2729 0a20 2020 2020 2020 2065  ile.').        e
-000473c0: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
-000473d0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-000473e0: 203d 2027 4f70 656e 2051 7363 6f72 6520   = 'Open Qscore 
-000473f0: 4a53 4f4e 2065 7272 6f72 3a20 7b7d 2e27  JSON error: {}.'
-00047400: 2e66 6f72 6d61 7428 7379 732e 6578 635f  .format(sys.exc_
-00047410: 696e 666f 2829 5b31 5d29 0a20 2020 2020  info()[1]).     
-00047420: 2020 2020 2020 2065 7272 6c69 7374 2e61         errlist.a
-00047430: 7070 656e 6428 6572 7229 0a20 2020 2020  ppend(err).     
-00047440: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
-00047450: 722e 7772 6974 6528 6572 7220 2b20 275c  r.write(err + '\
-00047460: 6e27 290a 2020 2020 2020 2020 656c 7365  n').        else
-00047470: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00047480: 2061 7267 7320 6973 206e 6f74 204e 6f6e   args is not Non
-00047490: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000474a0: 2020 206d 6f64 656c 7320 3d20 6172 6773     models = args
-000474b0: 5b27 7173 636f 7265 275d 0a20 2020 2020  ['qscore'].     
-000474c0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000474d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000474e0: 2020 2020 6465 6c20 6d6f 6465 6c73 5b27      del models['
-000474f0: 6572 7227 5d0a 2020 2020 2020 2020 2020  err'].          
-00047500: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00047510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047520: 2020 7072 696e 7428 2751 7363 6f72 6520    print('Qscore 
-00047530: 6a73 6f6e 2072 6573 756c 7420 6973 2063  json result is c
-00047540: 6f72 7265 6374 2729 0a0a 2020 2020 2020  orrect')..      
-00047550: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00047560: 2754 6865 7265 2069 732f 6172 6520 2573  'There is/are %s
-00047570: 206d 6f64 656c 2873 292e 2720 2520 6c65   model(s).' % le
-00047580: 6e28 6d6f 6465 6c73 2929 0a20 2020 2020  n(models)).     
-00047590: 2020 2020 2020 2020 2020 2066 6f72 2028             for (
-000475a0: 6b65 792c 2076 616c 7565 2920 696e 2069  key, value) in i
-000475b0: 7465 7269 7465 6d73 286d 6f64 656c 7329  teritems(models)
-000475c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000475d0: 2020 2020 2020 2320 666f 7220 286b 6579        # for (key
-000475e0: 322c 2076 616c 7565 3229 2069 6e20 6974  2, value2) in it
-000475f0: 6572 6974 656d 7328 7661 6c75 6529 3a0a  eritems(value):.
-00047600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047610: 2020 2020 6966 2074 7970 6528 7661 6c75      if type(valu
-00047620: 6529 2069 7320 666c 6f61 743a 0a20 2020  e) is float:.   
-00047630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047640: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00047650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047660: 2020 6b65 796c 6973 7420 3d20 6c69 7374    keylist = list
-00047670: 2876 616c 7565 290a 2020 2020 2020 2020  (value).        
-00047680: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00047690: 6b65 7920 696e 206b 6579 6c69 7374 3a0a  key in keylist:.
-000476a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000476b0: 2020 2020 2020 2020 6966 206b 6579 2021          if key !
-000476c0: 3d20 276e 616d 6527 3a0a 2020 2020 2020  = 'name':.      
-000476d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000476e0: 2020 2020 2020 636f 6c6f 7273 203d 2076        colors = v
-000476f0: 616c 7565 5b6b 6579 5d5b 2763 6f6c 6f72  alue[key]['color
-00047700: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00047710: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00047720: 6573 6964 7565 7320 3d20 7661 6c75 655b  esidues = value[
-00047730: 6b65 795d 5b27 7265 7369 6475 6527 5d0a  key]['residue'].
-00047740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047750: 2020 2020 2020 2020 2020 2020 7173 636f              qsco
-00047760: 7265 7320 3d20 7661 6c75 655b 6b65 795d  res = value[key]
-00047770: 5b27 696e 636c 7573 696f 6e27 5d0a 2020  ['inclusion'].  
-00047780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047790: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000477a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000477b0: 2020 2020 2020 2020 6d6f 6465 6c6e 616d          modelnam
-000477c0: 6520 3d20 7661 6c75 655b 6b65 795d 0a20  e = value[key]. 
+00046b80: 2020 7163 6f6c 6f72 203d 2073 656c 662e    qcolor = self.
+00046b90: 5f5f 666c 6f61 746f 6865 7828 5b71 7661  __floatohex([qva
+00046ba0: 6c75 655d 295b 305d 0a20 2020 2020 2020  lue])[0].       
+00046bb0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+00046bc0: 6861 696e 7173 636f 7265 5b61 6970 7265  hainqscore[aipre
+00046bd0: 6368 6169 6e5d 203d 207b 2776 616c 7565  chain] = {'value
+00046be0: 273a 2071 7661 6c75 652c 2027 636f 6c6f  ': qvalue, 'colo
+00046bf0: 7227 3a20 7163 6f6c 6f72 7d0a 2020 2020  r': qcolor}.    
+00046c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046c10: 6966 2061 6970 7265 6368 6169 6e20 696e  if aiprechain in
+00046c20: 2063 6861 696e 7173 636f 7265 2e6b 6579   chainqscore.key
+00046c30: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00046c40: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+00046c50: 6861 696e 7173 636f 7265 5b70 7265 6368  hainqscore[prech
+00046c60: 6169 6e20 2b20 275f 2720 2b20 7374 7228  ain + '_' + str(
+00046c70: 6169 7661 6c75 6529 5d20 3d20 7b27 7661  aivalue)] = {'va
+00046c80: 6c75 6527 3a20 6169 7661 6c75 652c 2027  lue': aivalue, '
+00046c90: 636f 6c6f 7227 3a20 6169 636f 6c6f 727d  color': aicolor}
+00046ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046cb0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00046cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046cd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00046ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046cf0: 6368 6169 6e71 7363 6f72 655b 6169 7072  chainqscore[aipr
+00046d00: 6563 6861 696e 5d20 3d20 7b27 7661 6c75  echain] = {'valu
+00046d10: 6527 3a20 7176 616c 7565 2c20 2763 6f6c  e': qvalue, 'col
+00046d20: 6f72 273a 2071 636f 6c6f 727d 0a20 2020  or': qcolor}.   
+00046d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046d40: 2063 6861 696e 6174 6f6d 7320 3d20 310a   chainatoms = 1.
+00046d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046d60: 2020 2020 6368 6169 6e6f 6363 203d 2061      chainocc = a
+00046d70: 746f 6d2e 7465 6d70 5f66 6163 0a20 2020  tom.temp_fac.   
+00046d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046d90: 2061 6970 7265 6368 6169 6e20 3d20 6174   aiprechain = at
+00046da0: 6f6d 2e63 6861 696e 0a20 2020 2020 2020  om.chain.       
+00046db0: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+00046dc0: 696e 636f 756e 7420 2b3d 2031 0a0a 2020  incount += 1..  
+00046dd0: 2020 2020 2020 7176 616c 7565 203d 2072        qvalue = r
+00046de0: 6f75 6e64 2863 6861 696e 6f63 6320 2f20  ound(chainocc / 
+00046df0: 6368 6169 6e61 746f 6d73 2c20 3329 0a20  chainatoms, 3). 
+00046e00: 2020 2020 2020 2071 636f 6c6f 7220 3d20         qcolor = 
+00046e10: 7365 6c66 2e5f 5f66 6c6f 6174 6f68 6578  self.__floatohex
+00046e20: 285b 7176 616c 7565 5d29 5b30 5d0a 2020  ([qvalue])[0].  
+00046e30: 2020 2020 2020 6966 2061 6970 7265 6368        if aiprech
+00046e40: 6169 6e20 696e 2063 6861 696e 7173 636f  ain in chainqsco
+00046e50: 7265 2e6b 6579 7328 293a 0a20 2020 2020  re.keys():.     
+00046e60: 2020 2020 2020 2023 2063 6861 696e 7173         # chainqs
+00046e70: 636f 7265 5b70 7265 6368 6169 6e20 2b20  core[prechain + 
+00046e80: 275f 2720 2b20 7374 7228 6169 7661 6c75  '_' + str(aivalu
+00046e90: 6529 5d20 3d20 7b27 7661 6c75 6527 3a20  e)] = {'value': 
+00046ea0: 6169 7661 6c75 652c 2027 636f 6c6f 7227  aivalue, 'color'
+00046eb0: 3a20 6169 636f 6c6f 727d 0a20 2020 2020  : aicolor}.     
+00046ec0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00046ed0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00046ee0: 2020 2020 2020 6368 6169 6e71 7363 6f72        chainqscor
+00046ef0: 655b 6169 7072 6563 6861 696e 5d20 3d20  e[aiprechain] = 
+00046f00: 7b27 7661 6c75 6527 3a20 7176 616c 7565  {'value': qvalue
+00046f10: 2c20 2763 6f6c 6f72 273a 2071 636f 6c6f  , 'color': qcolo
+00046f20: 727d 0a20 2020 2020 2020 206c 6173 7476  r}.        lastv
+00046f30: 616c 7565 203d 2072 6573 6f63 6320 2f20  alue = resocc / 
+00046f40: 6174 6f6d 636f 756e 740a 2020 2020 2020  atomcount.      
+00046f50: 2020 6b65 7973 7472 203d 2070 7265 6368    keystr = prech
+00046f60: 6169 6e20 2b20 273a 2720 2b20 7374 7228  ain + ':' + str(
+00046f70: 7072 6572 6573 6964 2920 2b20 7072 6572  preresid) + prer
+00046f80: 6573 0a20 2020 2020 2020 2061 6c6c 6b65  es.        allke
+00046f90: 7973 2e61 7070 656e 6428 6b65 7973 7472  ys.append(keystr
+00046fa0: 290a 2020 2020 2020 2020 616c 6c76 616c  ).        allval
+00046fb0: 7565 732e 6170 7065 6e64 286c 6173 7476  ues.append(lastv
+00046fc0: 616c 7565 290a 2020 2020 2020 2020 636f  alue).        co
+00046fd0: 6c6f 7572 7320 3d20 7365 6c66 2e5f 5f66  lours = self.__f
+00046fe0: 6c6f 6174 6f68 6578 285b 6920 666f 7220  loatohex([i for 
+00046ff0: 6920 696e 2061 6c6c 7661 6c75 6573 5d29  i in allvalues])
+00047000: 0a20 2020 2020 2020 2061 7665 7261 6765  .        average
+00047010: 6f63 6320 3d20 616c 6c6f 6363 202f 2061  occ = allocc / a
+00047020: 6c6c 6174 6f6d 730a 0a20 2020 2020 2020  llatoms..       
+00047030: 2074 6469 6374 203d 204f 7264 6572 6564   tdict = Ordered
+00047040: 4469 6374 285b 0a20 2020 2020 2020 2020  Dict([.         
+00047050: 2020 2028 2761 7665 7261 6765 6f63 6327     ('averageocc'
+00047060: 2c20 726f 756e 6428 6176 6572 6167 656f  , round(averageo
+00047070: 6363 2c20 3629 292c 2028 2763 6f6c 6f72  cc, 6)), ('color
+00047080: 272c 2063 6f6c 6f75 7273 292c 0a20 2020  ', colours),.   
+00047090: 2020 2020 2020 2020 2028 2769 6e63 6c75           ('inclu
+000470a0: 7369 6f6e 272c 205b 726f 756e 6428 656c  sion', [round(el
+000470b0: 656d 2c20 3629 2066 6f72 2065 6c65 6d20  em, 6) for elem 
+000470c0: 696e 2061 6c6c 7661 6c75 6573 5d29 2c0a  in allvalues]),.
+000470d0: 2020 2020 2020 2020 2020 2020 2827 7265              ('re
+000470e0: 7369 6475 6527 2c20 616c 6c6b 6579 7329  sidue', allkeys)
+000470f0: 2c0a 2020 2020 2020 2020 2020 2020 2827  ,.            ('
+00047100: 6368 6169 6e71 7363 6f72 6527 2c20 6368  chainqscore', ch
+00047110: 6169 6e71 7363 6f72 6529 0a0a 2020 2020  ainqscore)..    
+00047120: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
+00047130: 7265 7375 6c74 6469 6374 203d 204f 7264  resultdict = Ord
+00047140: 6572 6564 4469 6374 285b 2827 6e61 6d65  eredDict([('name
+00047150: 272c 206f 7267 6d6f 6465 6c29 2c20 2827  ', orgmodel), ('
+00047160: 6461 7461 272c 2074 6469 6374 295d 290a  data', tdict)]).
+00047170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00047180: 7265 7375 6c74 6469 6374 0a0a 2020 2020  resultdict..    
+00047190: 6465 6620 7173 636f 7265 7669 6577 2873  def qscoreview(s
+000471a0: 656c 662c 2063 6869 6d65 7261 6170 7029  elf, chimeraapp)
+000471b0: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
+000471c0: 2020 2020 2020 2020 2020 2058 2c20 592c             X, Y,
+000471d0: 205a 2069 6d61 6765 7320 7768 6963 6820   Z images which 
+000471e0: 6d6f 6465 6c20 7761 7320 636f 6c6f 7265  model was colore
+000471f0: 6420 6279 2051 2d73 636f 7265 0a0a 2020  d by Q-score..  
+00047200: 2020 2020 2020 3a72 6574 7572 6e3a 0a20        :return:. 
+00047210: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00047220: 2020 2020 2320 7265 6164 206a 736f 6e0a      # read json.
+00047230: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
+00047240: 7469 6d65 6974 2e64 6566 6175 6c74 5f74  timeit.default_t
+00047250: 696d 6572 2829 0a20 2020 2020 2020 2069  imer().        i
+00047260: 6e6a 736f 6e20 3d20 676c 6f62 2e67 6c6f  njson = glob.glo
+00047270: 6228 7365 6c66 2e77 6f72 6b64 6972 202b  b(self.workdir +
+00047280: 2027 2a5f 7173 636f 7265 2e6a 736f 6e27   '*_qscore.json'
+00047290: 290a 2020 2020 2020 2020 6261 7365 6469  ).        basedi
+000472a0: 7220 3d20 7365 6c66 2e77 6f72 6b64 6972  r = self.workdir
+000472b0: 0a20 2020 2020 2020 206d 6170 6e61 6d65  .        mapname
+000472c0: 203d 2073 656c 662e 6d61 706e 616d 650a   = self.mapname.
+000472d0: 2020 2020 2020 2020 6c6f 6343 4849 4d45          locCHIME
+000472e0: 5241 203d 2063 6869 6d65 7261 6170 700a  RA = chimeraapp.
+000472f0: 2020 2020 2020 2020 6269 6e64 6973 706c          bindispl
+00047300: 6179 203d 206f 732e 6765 7465 6e76 2827  ay = os.getenv('
+00047310: 4449 5350 4c41 5927 290a 2020 2020 2020  DISPLAY').      
+00047320: 2020 6572 726c 6973 7420 3d20 5b5d 0a0a    errlist = []..
+00047330: 2020 2020 2020 2020 6675 6c69 6e6a 736f          fulinjso
+00047340: 6e20 3d20 696e 6a73 6f6e 5b30 5d20 6966  n = injson[0] if
+00047350: 2069 6e6a 736f 6e20 656c 7365 204e 6f6e   injson else Non
+00047360: 650a 2020 2020 2020 2020 7472 793a 0a20  e.        try:. 
+00047370: 2020 2020 2020 2020 2020 2069 6620 6675             if fu
+00047380: 6c69 6e6a 736f 6e3a 0a20 2020 2020 2020  linjson:.       
+00047390: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+000473a0: 656e 2866 756c 696e 6a73 6f6e 2c20 2772  en(fulinjson, 'r
+000473b0: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+000473c0: 2020 2020 2020 2020 2020 2020 2061 7267               arg
+000473d0: 7320 3d20 6a73 6f6e 2e6c 6f61 6428 6629  s = json.load(f)
+000473e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000473f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00047400: 2020 2061 7267 7320 3d20 4e6f 6e65 0a20     args = None. 
+00047410: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00047420: 7269 6e74 2827 5468 6572 6520 6973 206e  rint('There is n
+00047430: 6f20 5173 636f 7265 206a 736f 6e20 6669  o Qscore json fi
+00047440: 6c65 2e27 290a 2020 2020 2020 2020 6578  le.').        ex
+00047450: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
+00047460: 2020 2020 2020 2020 2020 2020 6572 7220              err 
+00047470: 3d20 274f 7065 6e20 5173 636f 7265 204a  = 'Open Qscore J
+00047480: 534f 4e20 6572 726f 723a 207b 7d2e 272e  SON error: {}.'.
+00047490: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
+000474a0: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
+000474b0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+000474c0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+000474d0: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
+000474e0: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
+000474f0: 2729 0a20 2020 2020 2020 2065 6c73 653a  ').        else:
+00047500: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00047510: 6172 6773 2069 7320 6e6f 7420 4e6f 6e65  args is not None
+00047520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00047530: 2020 6d6f 6465 6c73 203d 2061 7267 735b    models = args[
+00047540: 2771 7363 6f72 6527 5d0a 2020 2020 2020  'qscore'].      
+00047550: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00047560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047570: 2020 2064 656c 206d 6f64 656c 735b 2765     del models['e
+00047580: 7272 275d 0a20 2020 2020 2020 2020 2020  rr'].           
+00047590: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+000475a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000475b0: 2070 7269 6e74 2827 5173 636f 7265 206a   print('Qscore j
+000475c0: 736f 6e20 7265 7375 6c74 2069 7320 636f  son result is co
+000475d0: 7272 6563 7427 290a 0a20 2020 2020 2020  rrect')..       
+000475e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000475f0: 5468 6572 6520 6973 2f61 7265 2025 7320  There is/are %s 
+00047600: 6d6f 6465 6c28 7329 2e27 2025 206c 656e  model(s).' % len
+00047610: 286d 6f64 656c 7329 290a 2020 2020 2020  (models)).      
+00047620: 2020 2020 2020 2020 2020 666f 7220 286b            for (k
+00047630: 6579 2c20 7661 6c75 6529 2069 6e20 6974  ey, value) in it
+00047640: 6572 6974 656d 7328 6d6f 6465 6c73 293a  eritems(models):
+00047650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047660: 2020 2020 2023 2066 6f72 2028 6b65 7932       # for (key2
+00047670: 2c20 7661 6c75 6532 2920 696e 2069 7465  , value2) in ite
+00047680: 7269 7465 6d73 2876 616c 7565 293a 0a20  ritems(value):. 
+00047690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000476a0: 2020 2069 6620 7479 7065 2876 616c 7565     if type(value
+000476b0: 2920 6973 2066 6c6f 6174 3a0a 2020 2020  ) is float:.    
+000476c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000476d0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+000476e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000476f0: 206b 6579 6c69 7374 203d 206c 6973 7428   keylist = list(
+00047700: 7661 6c75 6529 0a20 2020 2020 2020 2020  value).         
+00047710: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00047720: 6579 2069 6e20 6b65 796c 6973 743a 0a20  ey in keylist:. 
+00047730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047740: 2020 2020 2020 2069 6620 6b65 7920 213d         if key !=
+00047750: 2027 6e61 6d65 273a 0a20 2020 2020 2020   'name':.       
+00047760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047770: 2020 2020 2063 6f6c 6f72 7320 3d20 7661       colors = va
+00047780: 6c75 655b 6b65 795d 5b27 636f 6c6f 7227  lue[key]['color'
+00047790: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000477a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000477b0: 7369 6475 6573 203d 2076 616c 7565 5b6b  sidues = value[k
+000477c0: 6579 5d5b 2772 6573 6964 7565 275d 0a20  ey]['residue']. 
 000477d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000477e0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-000477f0: 203d 2073 656c 662e 776f 726b 6469 7220   = self.workdir 
-00047800: 2b20 6d6f 6465 6c6e 616d 650a 2020 2020  + modelname.    
+000477e0: 2020 2020 2020 2020 2020 2071 7363 6f72             qscor
+000477f0: 6573 203d 2076 616c 7565 5b6b 6579 5d5b  es = value[key][
+00047800: 2769 6e63 6c75 7369 6f6e 275d 0a20 2020  'inclusion'].   
 00047810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047820: 2020 2020 2020 2020 6368 696d 6572 6166          chimeraf
-00047830: 6e61 6d65 203d 2027 7b7d 5f7b 7d5f 7173  name = '{}_{}_qs
-00047840: 636f 7265 5f63 6869 6d65 7261 2e63 7863  core_chimera.cxc
-00047850: 272e 666f 726d 6174 286d 6f64 656c 6e61  '.format(modelna
-00047860: 6d65 2c20 6d61 706e 616d 6529 0a20 2020  me, mapname).   
-00047870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047880: 2020 2020 2020 2020 2073 7572 6661 6365           surface
-00047890: 666e 203d 2027 7b7d 7b7d 5f7b 7d27 2e66  fn = '{}{}_{}'.f
-000478a0: 6f72 6d61 7428 6261 7365 6469 722c 206d  ormat(basedir, m
-000478b0: 6f64 656c 6e61 6d65 2c20 6d61 706e 616d  odelname, mapnam
-000478c0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000478d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000478e0: 6869 6d65 7261 636d 6420 3d20 6368 696d  himeracmd = chim
-000478f0: 6572 6166 6e61 6d65 0a20 2020 2020 2020  erafname.       
+00047820: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00047830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047840: 2020 2020 2020 206d 6f64 656c 6e61 6d65         modelname
+00047850: 203d 2076 616c 7565 5b6b 6579 5d0a 2020   = value[key].  
+00047860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047870: 2020 2020 2020 2020 2020 6d6f 6465 6c20            model 
+00047880: 3d20 7365 6c66 2e77 6f72 6b64 6972 202b  = self.workdir +
+00047890: 206d 6f64 656c 6e61 6d65 0a20 2020 2020   modelname.     
+000478a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000478b0: 2020 2020 2020 2063 6869 6d65 7261 666e         chimerafn
+000478c0: 616d 6520 3d20 277b 7d5f 7b7d 5f71 7363  ame = '{}_{}_qsc
+000478d0: 6f72 655f 6368 696d 6572 612e 6378 6327  ore_chimera.cxc'
+000478e0: 2e66 6f72 6d61 7428 6d6f 6465 6c6e 616d  .format(modelnam
+000478f0: 652c 206d 6170 6e61 6d65 290a 2020 2020  e, mapname).    
 00047900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047910: 2020 2020 2023 2070 6462 6d6f 6465 6c6e       # pdbmodeln
-00047920: 616d 6520 3d20 277b 7d7b 7d5f 5f51 5f5f  ame = '{}{}__Q__
-00047930: 7b7d 2e70 6462 272e 666f 726d 6174 2862  {}.pdb'.format(b
-00047940: 6173 6564 6972 2c20 6d6f 6465 6c6e 616d  asedir, modelnam
-00047950: 655b 3a2d 345d 2c20 6d61 706e 616d 655b  e[:-4], mapname[
-00047960: 3a2d 345d 290a 2020 2020 2020 2020 2020  :-4]).          
-00047970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047980: 2020 7064 626d 6f64 656c 6e61 6d65 203d    pdbmodelname =
-00047990: 2027 7b7d 7b7d 5f5f 515f 5f7b 7d2e 6369   '{}{}__Q__{}.ci
-000479a0: 6627 2e66 6f72 6d61 7428 6261 7365 6469  f'.format(basedi
-000479b0: 722c 206d 6f64 656c 6e61 6d65 2c20 6d61  r, modelname, ma
-000479c0: 706e 616d 6529 0a0a 2020 2020 2020 2020  pname)..        
-000479d0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000479e0: 206f 7065 6e28 7365 6c66 2e77 6f72 6b64   open(self.workd
-000479f0: 6972 202b 2063 6869 6d65 7261 636d 642c  ir + chimeracmd,
-00047a00: 2027 7727 2920 6173 2066 703a 0a20 2020   'w') as fp:.   
-00047a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047a20: 2020 2020 2066 702e 7772 6974 6528 226f       fp.write("o
-00047a30: 7065 6e20 2220 2b20 7374 7228 7064 626d  pen " + str(pdbm
-00047a40: 6f64 656c 6e61 6d65 2920 2b20 2220 666f  odelname) + " fo
-00047a50: 726d 6174 206d 6d63 6966 2220 2b20 275c  rmat mmcif" + '\
-00047a60: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
-00047a70: 2020 2020 2020 2020 2020 2020 2320 6670              # fp
-00047a80: 2e77 7269 7465 2822 6f70 656e 2022 202b  .write("open " +
-00047a90: 2073 7472 2870 6462 6d6f 6465 6c6e 616d   str(pdbmodelnam
-00047aa0: 6529 202b 2022 2066 6f72 6d61 7420 7064  e) + " format pd
-00047ab0: 6222 202b 2027 5c6e 2729 0a20 2020 2020  b" + '\n').     
-00047ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ad0: 2020 2066 702e 7772 6974 6528 2773 686f     fp.write('sho
-00047ae0: 7720 7365 6c41 746f 6d73 2072 6962 626f  w selAtoms ribbo
-00047af0: 6e73 2720 2b20 275c 6e27 290a 2020 2020  ns' + '\n').    
-00047b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047b10: 2020 2020 6670 2e77 7269 7465 2827 6869      fp.write('hi
-00047b20: 6465 2073 656c 4174 6f6d 7327 202b 2027  de selAtoms' + '
-00047b30: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
-00047b40: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00047b50: 7220 2863 6f6c 6f72 2c20 7265 7369 6475  r (color, residu
-00047b60: 652c 2071 7363 6f72 6529 2069 6e20 7a69  e, qscore) in zi
-00047b70: 7028 636f 6c6f 7273 2c20 7265 7369 6475  p(colors, residu
-00047b80: 6573 2c20 7173 636f 7265 7329 3a0a 2020  es, qscores):.  
+00047910: 2020 2020 2020 2020 7375 7266 6163 6566          surfacef
+00047920: 6e20 3d20 277b 7d7b 7d5f 7b7d 272e 666f  n = '{}{}_{}'.fo
+00047930: 726d 6174 2862 6173 6564 6972 2c20 6d6f  rmat(basedir, mo
+00047940: 6465 6c6e 616d 652c 206d 6170 6e61 6d65  delname, mapname
+00047950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00047960: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00047970: 696d 6572 6163 6d64 203d 2063 6869 6d65  imeracmd = chime
+00047980: 7261 666e 616d 650a 2020 2020 2020 2020  rafname.        
+00047990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000479a0: 2020 2020 2320 7064 626d 6f64 656c 6e61      # pdbmodelna
+000479b0: 6d65 203d 2027 7b7d 7b7d 5f5f 515f 5f7b  me = '{}{}__Q__{
+000479c0: 7d2e 7064 6227 2e66 6f72 6d61 7428 6261  }.pdb'.format(ba
+000479d0: 7365 6469 722c 206d 6f64 656c 6e61 6d65  sedir, modelname
+000479e0: 5b3a 2d34 5d2c 206d 6170 6e61 6d65 5b3a  [:-4], mapname[:
+000479f0: 2d34 5d29 0a20 2020 2020 2020 2020 2020  -4]).           
+00047a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047a10: 2070 6462 6d6f 6465 6c6e 616d 6520 3d20   pdbmodelname = 
+00047a20: 277b 7d7b 7d5f 5f51 5f5f 7b7d 2e63 6966  '{}{}__Q__{}.cif
+00047a30: 272e 666f 726d 6174 2862 6173 6564 6972  '.format(basedir
+00047a40: 2c20 6d6f 6465 6c6e 616d 652c 206d 6170  , modelname, map
+00047a50: 6e61 6d65 290a 0a20 2020 2020 2020 2020  name)..         
+00047a60: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00047a70: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
+00047a80: 7220 2b20 6368 696d 6572 6163 6d64 2c20  r + chimeracmd, 
+00047a90: 2777 2729 2061 7320 6670 3a0a 2020 2020  'w') as fp:.    
+00047aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ab0: 2020 2020 6670 2e77 7269 7465 2822 6f70      fp.write("op
+00047ac0: 656e 2022 202b 2073 7472 2870 6462 6d6f  en " + str(pdbmo
+00047ad0: 6465 6c6e 616d 6529 202b 2022 2066 6f72  delname) + " for
+00047ae0: 6d61 7420 6d6d 6369 6622 202b 2027 5c6e  mat mmcif" + '\n
+00047af0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00047b00: 2020 2020 2020 2020 2020 2023 2066 702e             # fp.
+00047b10: 7772 6974 6528 226f 7065 6e20 2220 2b20  write("open " + 
+00047b20: 7374 7228 7064 626d 6f64 656c 6e61 6d65  str(pdbmodelname
+00047b30: 2920 2b20 2220 666f 726d 6174 2070 6462  ) + " format pdb
+00047b40: 2220 2b20 275c 6e27 290a 2020 2020 2020  " + '\n').      
+00047b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047b60: 2020 6670 2e77 7269 7465 2827 7368 6f77    fp.write('show
+00047b70: 2073 656c 4174 6f6d 7320 7269 6262 6f6e   selAtoms ribbon
+00047b80: 7327 202b 2027 5c6e 2729 0a20 2020 2020  s' + '\n').     
 00047b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ba0: 2020 2020 2020 2020 2020 6368 6169 6e2c            chain,
-00047bb0: 2072 6573 746d 7020 3d20 7265 7369 6475   restmp = residu
-00047bc0: 652e 7370 6c69 7428 273a 2729 0a20 2020  e.split(':').   
-00047bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047be0: 2020 2020 2020 2020 2023 204e 6f74 2073           # Not s
-00047bf0: 7572 6520 6966 2061 6c6c 2074 6865 206c  ure if all the l
-00047c00: 6574 7465 7273 2073 686f 756c 6420 6265  etters should be
-00047c10: 2072 6570 6c61 6365 640a 2020 2020 2020   replaced.      
+00047ba0: 2020 2066 702e 7772 6974 6528 2768 6964     fp.write('hid
+00047bb0: 6520 7365 6c41 746f 6d73 2720 2b20 275c  e selAtoms' + '\
+00047bc0: 6e27 290a 0a20 2020 2020 2020 2020 2020  n')..           
+00047bd0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00047be0: 2028 636f 6c6f 722c 2072 6573 6964 7565   (color, residue
+00047bf0: 2c20 7173 636f 7265 2920 696e 207a 6970  , qscore) in zip
+00047c00: 2863 6f6c 6f72 732c 2072 6573 6964 7565  (colors, residue
+00047c10: 732c 2071 7363 6f72 6573 293a 0a20 2020  s, qscores):.   
 00047c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c30: 2020 2020 2020 2320 3173 7420 7761 7920        # 1st way 
-00047c40: 6f66 2067 6574 7469 6e67 2072 6573 5f69  of getting res_i
-00047c50: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00047c60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00047c70: 7265 735f 6964 203d 2072 652e 7375 6228  res_id = re.sub(
-00047c80: 225c 4422 2c20 2222 2c20 7265 7374 6d70  "\D", "", restmp
-00047c90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00047ca0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00047cb0: 326e 6420 7761 7920 6f66 2067 6574 7469  2nd way of getti
-00047cc0: 6e67 2072 6573 0a20 2020 2020 2020 2020  ng res.         
-00047cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ce0: 2020 2072 6573 5f69 6420 3d20 7265 2e66     res_id = re.f
-00047cf0: 696e 6461 6c6c 2872 272d 3f5c 642b 272c  indall(r'-?\d+',
-00047d00: 2072 6573 746d 7029 5b30 5d0a 2020 2020   restmp)[0].    
-00047d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d20: 2020 2020 2020 2020 6670 2e77 7269 7465          fp.write
-00047d30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00047d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d50: 2020 2763 6f6c 6f72 202f 2720 2b20 6368    'color /' + ch
-00047d60: 6169 6e20 2b20 273a 2720 2b20 7265 735f  ain + ':' + res_
-00047d70: 6964 202b 2027 2027 202b 2063 6f6c 6f72  id + ' ' + color
-00047d80: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-00047d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047da0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00047db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047dc0: 2020 6966 2071 7363 6f72 6520 3e20 312e    if qscore > 1.
-00047dd0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00047de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047df0: 2020 2066 702e 7772 6974 6528 0a20 2020     fp.write(.   
-00047e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047e20: 2027 7368 6f77 202f 2720 2b20 6368 6169   'show /' + chai
-00047e30: 6e20 2b20 273a 2720 2b20 7265 735f 6964  n + ':' + res_id
-00047e40: 202b 2027 2061 746f 6d73 2720 2b20 275c   + ' atoms' + '\
-00047e50: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
-00047e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047e70: 2020 2020 2020 2027 7374 796c 6520 2f27         'style /'
-00047e80: 202b 2063 6861 696e 202b 2027 3a27 202b   + chain + ':' +
-00047e90: 2072 6573 5f69 6420 2b20 2720 7374 6963   res_id + ' stic
-00047ea0: 6b27 202b 2027 5c6e 270a 2020 2020 2020  k' + '\n'.      
-00047eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ec0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00047ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ee0: 2020 2020 6670 2e77 7269 7465 280a 2020      fp.write(.  
+00047c30: 2020 2020 2020 2020 2063 6861 696e 2c20           chain, 
+00047c40: 7265 7374 6d70 203d 2072 6573 6964 7565  restmp = residue
+00047c50: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+00047c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047c70: 2020 2020 2020 2020 2320 4e6f 7420 7375          # Not su
+00047c80: 7265 2069 6620 616c 6c20 7468 6520 6c65  re if all the le
+00047c90: 7474 6572 7320 7368 6f75 6c64 2062 6520  tters should be 
+00047ca0: 7265 706c 6163 6564 0a20 2020 2020 2020  replaced.       
+00047cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047cc0: 2020 2020 2023 2031 7374 2077 6179 206f       # 1st way o
+00047cd0: 6620 6765 7474 696e 6720 7265 735f 6964  f getting res_id
+00047ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047cf0: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+00047d00: 6573 5f69 6420 3d20 7265 2e73 7562 2822  es_id = re.sub("
+00047d10: 5c44 222c 2022 222c 2072 6573 746d 7029  \D", "", restmp)
+00047d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047d30: 2020 2020 2020 2020 2020 2020 2023 2032               # 2
+00047d40: 6e64 2077 6179 206f 6620 6765 7474 696e  nd way of gettin
+00047d50: 6720 7265 730a 2020 2020 2020 2020 2020  g res.          
+00047d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047d70: 2020 7265 735f 6964 203d 2072 652e 6669    res_id = re.fi
+00047d80: 6e64 616c 6c28 7227 2d3f 5c64 2b27 2c20  ndall(r'-?\d+', 
+00047d90: 7265 7374 6d70 295b 305d 0a20 2020 2020  restmp)[0].     
+00047da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047db0: 2020 2020 2020 2066 702e 7772 6974 6528         fp.write(
+00047dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047de0: 2027 636f 6c6f 7220 2f27 202b 2063 6861   'color /' + cha
+00047df0: 696e 202b 2027 3a27 202b 2072 6573 5f69  in + ':' + res_i
+00047e00: 6420 2b20 2720 2720 2b20 636f 6c6f 7220  d + ' ' + color 
+00047e10: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+00047e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e30: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00047e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e50: 2069 6620 7173 636f 7265 203e 2031 2e30   if qscore > 1.0
+00047e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00047e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e80: 2020 6670 2e77 7269 7465 280a 2020 2020    fp.write(.    
+00047e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047eb0: 2773 686f 7720 2f27 202b 2063 6861 696e  'show /' + chain
+00047ec0: 202b 2027 3a27 202b 2072 6573 5f69 6420   + ':' + res_id 
+00047ed0: 2b20 2720 6174 6f6d 7327 202b 2027 5c6e  + ' atoms' + '\n
+00047ee0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
 00047ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047f00: 2020 2020 2020 2020 2020 2273 6574 2062            "set b
-00047f10: 6743 6f6c 6f72 2077 6869 7465 2220 2b20  gColor white" + 
-00047f20: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
-00047f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047f40: 2022 6c69 6768 7469 6e67 2073 6f66 7422   "lighting soft"
-00047f50: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+00047f00: 2020 2020 2020 2773 7479 6c65 202f 2720        'style /' 
+00047f10: 2b20 6368 6169 6e20 2b20 273a 2720 2b20  + chain + ':' + 
+00047f20: 7265 735f 6964 202b 2027 2073 7469 636b  res_id + ' stick
+00047f30: 2720 2b20 275c 6e27 0a20 2020 2020 2020  ' + '\n'.       
+00047f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
 00047f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047f70: 2020 2020 2276 6965 7720 636f 6672 2054      "view cofr T
-00047f80: 7275 6522 202b 2027 5c6e 270a 2020 2020  rue" + '\n'.    
-00047f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047fa0: 2020 2020 2020 2020 2273 6176 6520 2220          "save " 
-00047fb0: 2b20 7374 7228 7375 7266 6163 6566 6e29  + str(surfacefn)
-00047fc0: 202b 2022 5f7a 7173 636f 7265 7375 7266   + "_zqscoresurf
-00047fd0: 6163 652e 6a70 6567 2220 2b20 2220 7375  ace.jpeg" + " su
-00047fe0: 7065 7273 616d 706c 6520 3320 7769 6474  persample 3 widt
-00047ff0: 6820 3132 3030 2068 6569 6768 7420 3132  h 1200 height 12
-00048000: 3030 2220 2b20 275c 6e27 0a20 2020 2020  00" + '\n'.     
-00048010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048020: 2020 2020 2020 2022 7475 726e 2078 202d         "turn x -
-00048030: 3930 2220 2b20 275c 6e27 0a20 2020 2020  90" + '\n'.     
-00048040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048050: 2020 2020 2020 2022 7475 726e 2079 202d         "turn y -
-00048060: 3930 2220 2b20 275c 6e27 0a20 2020 2020  90" + '\n'.     
-00048070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048080: 2020 2020 2020 2022 7669 6577 2063 6f66         "view cof
-00048090: 7220 5472 7565 2220 2b20 275c 6e27 0a20  r True" + '\n'. 
+00047f70: 2020 2066 702e 7772 6974 6528 0a20 2020     fp.write(.   
+00047f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f90: 2020 2020 2020 2020 2022 7365 7420 6267           "set bg
+00047fa0: 436f 6c6f 7220 7768 6974 6522 202b 2027  Color white" + '
+00047fb0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+00047fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047fd0: 226c 6967 6874 696e 6720 736f 6674 2220  "lighting soft" 
+00047fe0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+00047ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048000: 2020 2022 7669 6577 2063 6f66 7220 5472     "view cofr Tr
+00048010: 7565 2220 2b20 275c 6e27 0a20 2020 2020  ue" + '\n'.     
+00048020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048030: 2020 2020 2020 2022 7361 7665 2022 202b         "save " +
+00048040: 2073 7472 2873 7572 6661 6365 666e 2920   str(surfacefn) 
+00048050: 2b20 225f 7a71 7363 6f72 6573 7572 6661  + "_zqscoresurfa
+00048060: 6365 2e6a 7065 6722 202b 2022 2073 7570  ce.jpeg" + " sup
+00048070: 6572 7361 6d70 6c65 2033 2077 6964 7468  ersample 3 width
+00048080: 2031 3230 3020 6865 6967 6874 2031 3230   1200 height 120
+00048090: 3022 202b 2027 5c6e 270a 2020 2020 2020  0" + '\n'.      
 000480a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000480b0: 2020 2020 2020 2020 2020 2022 7361 7665             "save
-000480c0: 2022 202b 2073 7472 2873 7572 6661 6365   " + str(surface
-000480d0: 666e 2920 2b20 225f 7871 7363 6f72 6573  fn) + "_xqscores
-000480e0: 7572 6661 6365 2e6a 7065 6722 202b 2022  urface.jpeg" + "
-000480f0: 2073 7570 6572 7361 6d70 6c65 2033 2077   supersample 3 w
-00048100: 6964 7468 2031 3230 3020 6865 6967 6874  idth 1200 height
-00048110: 2031 3230 3022 202b 2027 5c6e 270a 2020   1200" + '\n'.  
-00048120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048130: 2020 2020 2020 2020 2020 2276 6965 7720            "view 
-00048140: 6f72 6965 6e74 2220 2b20 275c 6e27 0a20  orient" + '\n'. 
-00048150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048160: 2020 2020 2020 2020 2020 2022 7475 726e             "turn
-00048170: 2078 2039 3022 202b 2027 5c6e 270a 2020   x 90" + '\n'.  
-00048180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048190: 2020 2020 2020 2020 2020 2274 7572 6e20            "turn 
-000481a0: 7a20 3930 2220 2b20 275c 6e27 0a20 2020  z 90" + '\n'.   
+000480b0: 2020 2020 2020 2274 7572 6e20 7820 2d39        "turn x -9
+000480c0: 3022 202b 2027 5c6e 270a 2020 2020 2020  0" + '\n'.      
+000480d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480e0: 2020 2020 2020 2274 7572 6e20 7920 2d39        "turn y -9
+000480f0: 3022 202b 2027 5c6e 270a 2020 2020 2020  0" + '\n'.      
+00048100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048110: 2020 2020 2020 2276 6965 7720 636f 6672        "view cofr
+00048120: 2054 7275 6522 202b 2027 5c6e 270a 2020   True" + '\n'.  
+00048130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048140: 2020 2020 2020 2020 2020 2273 6176 6520            "save 
+00048150: 2220 2b20 7374 7228 7375 7266 6163 6566  " + str(surfacef
+00048160: 6e29 202b 2022 5f78 7173 636f 7265 7375  n) + "_xqscoresu
+00048170: 7266 6163 652e 6a70 6567 2220 2b20 2220  rface.jpeg" + " 
+00048180: 7375 7065 7273 616d 706c 6520 3320 7769  supersample 3 wi
+00048190: 6474 6820 3132 3030 2068 6569 6768 7420  dth 1200 height 
+000481a0: 3132 3030 2220 2b20 275c 6e27 0a20 2020  1200" + '\n'.   
 000481b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000481c0: 2020 2020 2020 2020 2022 7669 6577 2063           "view c
-000481d0: 6f66 7220 5472 7565 2220 2b20 275c 6e27  ofr True" + '\n'
-000481e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000481f0: 2020 2020 2020 2020 2020 2020 2022 7361               "sa
-00048200: 7665 2022 202b 2073 7472 2873 7572 6661  ve " + str(surfa
-00048210: 6365 666e 2920 2b20 225f 7971 7363 6f72  cefn) + "_yqscor
-00048220: 6573 7572 6661 6365 2e6a 7065 6722 202b  esurface.jpeg" +
-00048230: 2022 2073 7570 6572 7361 6d70 6c65 2033   " supersample 3
-00048240: 2077 6964 7468 2031 3230 3020 6865 6967   width 1200 heig
-00048250: 6874 2031 3230 3022 202b 2027 5c6e 270a  ht 1200" + '\n'.
-00048260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048270: 2020 2020 2020 2020 2020 2020 2263 6c6f              "clo
-00048280: 7365 2061 6c6c 2220 2b20 225c 6e22 0a20  se all" + "\n". 
-00048290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482a0: 2020 2020 2020 2020 2020 2022 6578 6974             "exit
-000482b0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000482c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000482d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000482f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00048300: 6e6f 7420 6269 6e64 6973 706c 6179 3a0a  not bindisplay:.
-00048310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048320: 2020 2020 2020 2020 2020 2020 7375 6270              subp
-00048330: 726f 6365 7373 2e63 6865 636b 5f63 616c  rocess.check_cal
-00048340: 6c28 6c6f 6343 4849 4d45 5241 202b 2022  l(locCHIMERA + "
-00048350: 202d 2d6f 6666 7363 7265 656e 202d 2d6e   --offscreen --n
-00048360: 6f67 7569 2022 202b 2073 656c 662e 776f  ogui " + self.wo
-00048370: 726b 6469 7220 2b20 6368 696d 6572 6163  rkdir + chimerac
-00048380: 6d64 2c0a 2020 2020 2020 2020 2020 2020  md,.            
-00048390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000481c0: 2020 2020 2020 2020 2022 7669 6577 206f           "view o
+000481d0: 7269 656e 7422 202b 2027 5c6e 270a 2020  rient" + '\n'.  
+000481e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000481f0: 2020 2020 2020 2020 2020 2274 7572 6e20            "turn 
+00048200: 7820 3930 2220 2b20 275c 6e27 0a20 2020  x 90" + '\n'.   
+00048210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048220: 2020 2020 2020 2020 2022 7475 726e 207a           "turn z
+00048230: 2039 3022 202b 2027 5c6e 270a 2020 2020   90" + '\n'.    
+00048240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048250: 2020 2020 2020 2020 2276 6965 7720 636f          "view co
+00048260: 6672 2054 7275 6522 202b 2027 5c6e 270a  fr True" + '\n'.
+00048270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048280: 2020 2020 2020 2020 2020 2020 2273 6176              "sav
+00048290: 6520 2220 2b20 7374 7228 7375 7266 6163  e " + str(surfac
+000482a0: 6566 6e29 202b 2022 5f79 7173 636f 7265  efn) + "_yqscore
+000482b0: 7375 7266 6163 652e 6a70 6567 2220 2b20  surface.jpeg" + 
+000482c0: 2220 7375 7065 7273 616d 706c 6520 3320  " supersample 3 
+000482d0: 7769 6474 6820 3132 3030 2068 6569 6768  width 1200 heigh
+000482e0: 7420 3132 3030 2220 2b20 275c 6e27 0a20  t 1200" + '\n'. 
+000482f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048300: 2020 2020 2020 2020 2020 2022 636c 6f73             "clos
+00048310: 6520 616c 6c22 202b 2022 5c6e 220a 2020  e all" + "\n".  
+00048320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048330: 2020 2020 2020 2020 2020 2265 7869 7422            "exit"
+00048340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048350: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00048360: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00048370: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00048380: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00048390: 6f74 2062 696e 6469 7370 6c61 793a 0a20  ot bindisplay:. 
 000483a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000483b0: 2020 2020 2020 6377 643d 7365 6c66 2e77        cwd=self.w
-000483c0: 6f72 6b64 6972 2c20 7368 656c 6c3d 5472  orkdir, shell=Tr
-000483d0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-000483e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000483f0: 7072 696e 7428 2743 6f6c 6f72 6564 206d  print('Colored m
-00048400: 6f64 656c 7320 6261 7365 6420 6f6e 2051  odels based on Q
-00048410: 7363 6f72 6520 7765 7265 2070 726f 6475  score were produ
-00048420: 6365 642e 2729 0a20 2020 2020 2020 2020  ced.').         
-00048430: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00048440: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00048450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048460: 2073 7562 7072 6f63 6573 732e 6368 6563   subprocess.chec
-00048470: 6b5f 6361 6c6c 286c 6f63 4348 494d 4552  k_call(locCHIMER
-00048480: 4120 2b20 2220 2220 2b20 7365 6c66 2e77  A + " " + self.w
-00048490: 6f72 6b64 6972 202b 2063 6869 6d65 7261  orkdir + chimera
-000484a0: 636d 642c 2063 7764 3d73 656c 662e 776f  cmd, cwd=self.wo
-000484b0: 726b 6469 722c 0a20 2020 2020 2020 2020  rkdir,.         
-000484c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000484d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000484e0: 2020 2020 2020 2020 2073 6865 6c6c 3d54           shell=T
-000484f0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00048500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048510: 2070 7269 6e74 2827 436f 6c6f 7265 6420   print('Colored 
-00048520: 6d6f 6465 6c73 2062 6173 6564 206f 6e20  models based on 
-00048530: 5173 636f 7265 2077 6572 6520 7072 6f64  Qscore were prod
-00048540: 7563 6564 2e27 290a 2020 2020 2020 2020  uced.').        
-00048550: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00048560: 7074 2073 7562 7072 6f63 6573 732e 4361  pt subprocess.Ca
-00048570: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00048580: 2061 7320 7375 6265 7272 3a0a 2020 2020   as suberr:.    
+000483b0: 2020 2020 2020 2020 2020 2073 7562 7072             subpr
+000483c0: 6f63 6573 732e 6368 6563 6b5f 6361 6c6c  ocess.check_call
+000483d0: 286c 6f63 4348 494d 4552 4120 2b20 2220  (locCHIMERA + " 
+000483e0: 2d2d 6f66 6673 6372 6565 6e20 2d2d 6e6f  --offscreen --no
+000483f0: 6775 6920 2220 2b20 7365 6c66 2e77 6f72  gui " + self.wor
+00048400: 6b64 6972 202b 2063 6869 6d65 7261 636d  kdir + chimeracm
+00048410: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00048420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048440: 2020 2020 2063 7764 3d73 656c 662e 776f       cwd=self.wo
+00048450: 726b 6469 722c 2073 6865 6c6c 3d54 7275  rkdir, shell=Tru
+00048460: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00048470: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00048480: 7269 6e74 2827 436f 6c6f 7265 6420 6d6f  rint('Colored mo
+00048490: 6465 6c73 2062 6173 6564 206f 6e20 5173  dels based on Qs
+000484a0: 636f 7265 2077 6572 6520 7072 6f64 7563  core were produc
+000484b0: 6564 2e27 290a 2020 2020 2020 2020 2020  ed.').          
+000484c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000484d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000484e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000484f0: 7375 6270 726f 6365 7373 2e63 6865 636b  subprocess.check
+00048500: 5f63 616c 6c28 6c6f 6343 4849 4d45 5241  _call(locCHIMERA
+00048510: 202b 2022 2022 202b 2073 656c 662e 776f   + " " + self.wo
+00048520: 726b 6469 7220 2b20 6368 696d 6572 6163  rkdir + chimerac
+00048530: 6d64 2c20 6377 643d 7365 6c66 2e77 6f72  md, cwd=self.wor
+00048540: 6b64 6972 2c0a 2020 2020 2020 2020 2020  kdir,.          
+00048550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048570: 2020 2020 2020 2020 7368 656c 6c3d 5472          shell=Tr
+00048580: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
 00048590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000485a0: 2020 2020 6572 7220 3d20 2753 6176 696e      err = 'Savin
-000485b0: 6720 6d6f 6465 6c20 7b7d 2051 7363 6f72  g model {} Qscor
-000485c0: 6520 7669 6577 2065 7272 6f72 3a20 7b7d  e view error: {}
-000485d0: 2e27 2e66 6f72 6d61 7428 6d6f 6465 6c6e  .'.format(modeln
-000485e0: 616d 652c 2073 7562 6572 7229 0a20 2020  ame, suberr).   
-000485f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048600: 2020 2020 2065 7272 6c69 7374 2e61 7070       errlist.app
-00048610: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
+000485a0: 7072 696e 7428 2743 6f6c 6f72 6564 206d  print('Colored m
+000485b0: 6f64 656c 7320 6261 7365 6420 6f6e 2051  odels based on Q
+000485c0: 7363 6f72 6520 7765 7265 2070 726f 6475  score were produ
+000485d0: 6365 642e 2729 0a20 2020 2020 2020 2020  ced.').         
+000485e0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000485f0: 7420 7375 6270 726f 6365 7373 2e43 616c  t subprocess.Cal
+00048600: 6c65 6450 726f 6365 7373 4572 726f 7220  ledProcessError 
+00048610: 6173 2073 7562 6572 723a 0a20 2020 2020  as suberr:.     
 00048620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048630: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-00048640: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
-00048650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048660: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00048670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048680: 7365 6c66 2e73 6361 6c65 5f73 7572 6661  self.scale_surfa
-00048690: 6365 7669 6577 2829 0a20 2020 2020 2020  ceview().       
-000486a0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000486b0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-000486c0: 2020 2020 2020 2020 2020 2020 2065 7272               err
-000486d0: 203d 2027 5363 616c 696e 6720 6d6f 6465   = 'Scaling mode
-000486e0: 6c20 5173 636f 7265 2076 6965 7720 6572  l Qscore view er
-000486f0: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
-00048700: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-00048710: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-00048720: 2020 2020 2020 2020 2020 2020 6572 726c              errl
-00048730: 6973 742e 6170 7065 6e64 2865 7272 290a  ist.append(err).
-00048740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048750: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
-00048760: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
-00048770: 5c6e 2729 0a0a 2020 2020 2020 2020 2020  \n')..          
-00048780: 2020 2020 2020 2020 2020 6a70 6567 7320            jpegs 
-00048790: 3d20 676c 6f62 2e67 6c6f 6228 7365 6c66  = glob.glob(self
-000487a0: 2e77 6f72 6b64 6972 202b 2027 2f2a 7375  .workdir + '/*su
-000487b0: 7266 6163 652e 6a70 6567 2729 0a20 2020  rface.jpeg').   
-000487c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000487d0: 206d 6f64 656c 7375 7266 203d 2064 6963   modelsurf = dic
-000487e0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-000487f0: 2020 2020 2020 2020 6669 6e61 6c6d 6d64          finalmmd
-00048800: 6963 7420 3d20 6469 6374 2829 0a20 2020  ict = dict().   
-00048810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048820: 2069 6620 7365 6c66 2e6d 6f64 656c 733a   if self.models:
-00048830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048840: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
-00048850: 2022 7365 6c66 2e6d 6f64 656c 733a 2573   "self.models:%s
-00048860: 2220 2520 7365 6c66 2e6d 6f64 656c 730a  " % self.models.
-00048870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048880: 2020 2020 2020 2020 666f 7220 6d6f 6465          for mode
-00048890: 6c20 696e 2073 656c 662e 6d6f 6465 6c73  l in self.models
-000488a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000488b0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000488c0: 6465 6c6e 616d 6520 3d20 6f73 2e70 6174  delname = os.pat
-000488d0: 682e 6261 7365 6e61 6d65 286d 6f64 656c  h.basename(model
-000488e0: 2e66 696c 656e 616d 6529 0a20 2020 2020  .filename).     
-000488f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048900: 2020 2020 2020 2073 7572 6661 6365 666e         surfacefn
-00048910: 203d 2027 7b7d 5f7b 7d27 2e66 6f72 6d61   = '{}_{}'.forma
-00048920: 7428 6d6f 6465 6c6e 616d 652c 2073 656c  t(modelname, sel
-00048930: 662e 6d61 706e 616d 6529 0a20 2020 2020  f.mapname).     
-00048940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048950: 2020 2020 2020 206d 6f64 656c 6d61 7073         modelmaps
-00048960: 7572 6661 6365 203d 2064 6963 7428 290a  urface = dict().
-00048970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048980: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00048990: 6a70 6567 2069 6e20 6a70 6567 733a 0a20  jpeg in jpegs:. 
-000489a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000489b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000489c0: 6620 6d6f 6465 6c6e 616d 6520 696e 206a  f modelname in j
-000489d0: 7065 6720 616e 6420 2778 7173 636f 7265  peg and 'xqscore
-000489e0: 2720 696e 206a 7065 673a 0a20 2020 2020  ' in jpeg:.     
-000489f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048a00: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00048a10: 6f64 656c 6d61 7073 7572 6661 6365 5b27  odelmapsurface['
-00048a20: 7827 5d20 3d20 7374 7228 7375 7266 6163  x'] = str(surfac
-00048a30: 6566 6e29 202b 2027 5f73 6361 6c65 645f  efn) + '_scaled_
-00048a40: 7871 7363 6f72 6573 7572 6661 6365 2e6a  xqscoresurface.j
-00048a50: 7065 6727 0a20 2020 2020 2020 2020 2020  peg'.           
-00048a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048a70: 2020 2020 2069 6620 6d6f 6465 6c6e 616d       if modelnam
-00048a80: 6520 696e 206a 7065 6720 616e 6420 2779  e in jpeg and 'y
-00048a90: 7173 636f 7265 2720 696e 206a 7065 673a  qscore' in jpeg:
-00048aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ac0: 2020 2020 206d 6f64 656c 6d61 7073 7572       modelmapsur
-00048ad0: 6661 6365 5b27 7927 5d20 3d20 7374 7228  face['y'] = str(
-00048ae0: 7375 7266 6163 6566 6e29 202b 2027 5f73  surfacefn) + '_s
-00048af0: 6361 6c65 645f 7971 7363 6f72 6573 7572  caled_yqscoresur
-00048b00: 6661 6365 2e6a 7065 6727 0a20 2020 2020  face.jpeg'.     
-00048b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048b20: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
-00048b30: 6465 6c6e 616d 6520 696e 206a 7065 6720  delname in jpeg 
-00048b40: 616e 6420 277a 7173 636f 7265 2720 696e  and 'zqscore' in
-00048b50: 206a 7065 673a 0a20 2020 2020 2020 2020   jpeg:.         
-00048b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048b70: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-00048b80: 6d61 7073 7572 6661 6365 5b27 7a27 5d20  mapsurface['z'] 
-00048b90: 3d20 7374 7228 7375 7266 6163 6566 6e29  = str(surfacefn)
-00048ba0: 202b 2027 5f73 6361 6c65 645f 7a71 7363   + '_scaled_zqsc
-00048bb0: 6f72 6573 7572 6661 6365 2e6a 7065 6727  oresurface.jpeg'
-00048bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048bd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00048be0: 6572 726c 6973 743a 0a20 2020 2020 2020  errlist:.       
+00048630: 2020 2065 7272 203d 2027 5361 7669 6e67     err = 'Saving
+00048640: 206d 6f64 656c 207b 7d20 5173 636f 7265   model {} Qscore
+00048650: 2076 6965 7720 6572 726f 723a 207b 7d2e   view error: {}.
+00048660: 272e 666f 726d 6174 286d 6f64 656c 6e61  '.format(modelna
+00048670: 6d65 2c20 7375 6265 7272 290a 2020 2020  me, suberr).    
+00048680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048690: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
+000486a0: 6e64 2865 7272 290a 2020 2020 2020 2020  nd(err).        
+000486b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486c0: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+000486d0: 2865 7272 202b 2027 5c6e 2729 0a0a 2020  (err + '\n')..  
+000486e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00048700: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00048710: 656c 662e 7363 616c 655f 7375 7266 6163  elf.scale_surfac
+00048720: 6576 6965 7728 290a 2020 2020 2020 2020  eview().        
+00048730: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00048740: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00048750: 2020 2020 2020 2020 2020 2020 6572 7220              err 
+00048760: 3d20 2753 6361 6c69 6e67 206d 6f64 656c  = 'Scaling model
+00048770: 2051 7363 6f72 6520 7669 6577 2065 7272   Qscore view err
+00048780: 6f72 3a20 7b7d 2e27 2e66 6f72 6d61 7428  or: {}.'.format(
+00048790: 7379 732e 6578 635f 696e 666f 2829 5b31  sys.exc_info()[1
+000487a0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+000487b0: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+000487c0: 7374 2e61 7070 656e 6428 6572 7229 0a20  st.append(err). 
+000487d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000487e0: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
+000487f0: 722e 7772 6974 6528 6572 7220 2b20 275c  r.write(err + '\
+00048800: 6e27 290a 0a20 2020 2020 2020 2020 2020  n')..           
+00048810: 2020 2020 2020 2020 206a 7065 6773 203d           jpegs =
+00048820: 2067 6c6f 622e 676c 6f62 2873 656c 662e   glob.glob(self.
+00048830: 776f 726b 6469 7220 2b20 272f 2a73 7572  workdir + '/*sur
+00048840: 6661 6365 2e6a 7065 6727 290a 2020 2020  face.jpeg').    
+00048850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048860: 6d6f 6465 6c73 7572 6620 3d20 6469 6374  modelsurf = dict
+00048870: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00048880: 2020 2020 2020 2066 696e 616c 6d6d 6469         finalmmdi
+00048890: 6374 203d 2064 6963 7428 290a 2020 2020  ct = dict().    
+000488a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000488b0: 6966 2073 656c 662e 6d6f 6465 6c73 3a0a  if self.models:.
+000488c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000488d0: 2020 2020 2020 2020 2320 7072 696e 7420          # print 
+000488e0: 2273 656c 662e 6d6f 6465 6c73 3a25 7322  "self.models:%s"
+000488f0: 2025 2073 656c 662e 6d6f 6465 6c73 0a20   % self.models. 
+00048900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048910: 2020 2020 2020 2066 6f72 206d 6f64 656c         for model
+00048920: 2069 6e20 7365 6c66 2e6d 6f64 656c 733a   in self.models:
+00048930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048940: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+00048950: 656c 6e61 6d65 203d 206f 732e 7061 7468  elname = os.path
+00048960: 2e62 6173 656e 616d 6528 6d6f 6465 6c2e  .basename(model.
+00048970: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00048980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048990: 2020 2020 2020 7375 7266 6163 6566 6e20        surfacefn 
+000489a0: 3d20 277b 7d5f 7b7d 272e 666f 726d 6174  = '{}_{}'.format
+000489b0: 286d 6f64 656c 6e61 6d65 2c20 7365 6c66  (modelname, self
+000489c0: 2e6d 6170 6e61 6d65 290a 2020 2020 2020  .mapname).      
+000489d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000489e0: 2020 2020 2020 6d6f 6465 6c6d 6170 7375        modelmapsu
+000489f0: 7266 6163 6520 3d20 6469 6374 2829 0a20  rface = dict(). 
+00048a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048a10: 2020 2020 2020 2020 2020 2066 6f72 206a             for j
+00048a20: 7065 6720 696e 206a 7065 6773 3a0a 2020  peg in jpegs:.  
+00048a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048a40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00048a50: 206d 6f64 656c 6e61 6d65 2069 6e20 6a70   modelname in jp
+00048a60: 6567 2061 6e64 2027 7871 7363 6f72 6527  eg and 'xqscore'
+00048a70: 2069 6e20 6a70 6567 3a0a 2020 2020 2020   in jpeg:.      
+00048a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048a90: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+00048aa0: 6465 6c6d 6170 7375 7266 6163 655b 2778  delmapsurface['x
+00048ab0: 275d 203d 2073 7472 2873 7572 6661 6365  '] = str(surface
+00048ac0: 666e 2920 2b20 275f 7363 616c 6564 5f78  fn) + '_scaled_x
+00048ad0: 7173 636f 7265 7375 7266 6163 652e 6a70  qscoresurface.jp
+00048ae0: 6567 270a 2020 2020 2020 2020 2020 2020  eg'.            
+00048af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b00: 2020 2020 6966 206d 6f64 656c 6e61 6d65      if modelname
+00048b10: 2069 6e20 6a70 6567 2061 6e64 2027 7971   in jpeg and 'yq
+00048b20: 7363 6f72 6527 2069 6e20 6a70 6567 3a0a  score' in jpeg:.
+00048b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b50: 2020 2020 6d6f 6465 6c6d 6170 7375 7266      modelmapsurf
+00048b60: 6163 655b 2779 275d 203d 2073 7472 2873  ace['y'] = str(s
+00048b70: 7572 6661 6365 666e 2920 2b20 275f 7363  urfacefn) + '_sc
+00048b80: 616c 6564 5f79 7173 636f 7265 7375 7266  aled_yqscoresurf
+00048b90: 6163 652e 6a70 6567 270a 2020 2020 2020  ace.jpeg'.      
+00048ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048bb0: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
+00048bc0: 656c 6e61 6d65 2069 6e20 6a70 6567 2061  elname in jpeg a
+00048bd0: 6e64 2027 7a71 7363 6f72 6527 2069 6e20  nd 'zqscore' in 
+00048be0: 6a70 6567 3a0a 2020 2020 2020 2020 2020  jpeg:.          
 00048bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c00: 2020 2020 2020 2020 206d 6f64 656c 6d61           modelma
-00048c10: 7073 7572 6661 6365 5b27 6572 7227 5d20  psurface['err'] 
-00048c20: 3d20 7b27 6d6f 6465 6c5f 6669 745f 6572  = {'model_fit_er
-00048c30: 7227 3a20 6572 726c 6973 747d 0a20 2020  r': errlist}.   
-00048c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c50: 2020 2020 2020 2020 206d 6f64 656c 7375           modelsu
-00048c60: 7266 5b6d 6f64 656c 6e61 6d65 5d20 3d20  rf[modelname] = 
-00048c70: 6d6f 6465 6c6d 6170 7375 7266 6163 650a  modelmapsurface.
+00048c00: 2020 2020 2020 2020 2020 6d6f 6465 6c6d            modelm
+00048c10: 6170 7375 7266 6163 655b 277a 275d 203d  apsurface['z'] =
+00048c20: 2073 7472 2873 7572 6661 6365 666e 2920   str(surfacefn) 
+00048c30: 2b20 275f 7363 616c 6564 5f7a 7173 636f  + '_scaled_zqsco
+00048c40: 7265 7375 7266 6163 652e 6a70 6567 270a  resurface.jpeg'.
+00048c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c60: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00048c70: 7272 6c69 7374 3a0a 2020 2020 2020 2020  rrlist:.        
 00048c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c90: 2020 2020 2020 2020 6669 6e61 6c6d 6d64          finalmmd
-00048ca0: 6963 745b 2771 7363 6f72 655f 7375 7266  ict['qscore_surf
-00048cb0: 6163 6527 5d20 3d20 6d6f 6465 6c73 7572  ace'] = modelsur
-00048cc0: 660a 0a20 2020 2020 2020 2020 2020 2020  f..             
-00048cd0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00048ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048cf0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00048d00: 2063 6f64 6563 732e 6f70 656e 2873 656c   codecs.open(sel
-00048d10: 662e 776f 726b 6469 7220 2b20 7365 6c66  f.workdir + self
-00048d20: 2e6d 6170 6e61 6d65 202b 2027 5f71 7363  .mapname + '_qsc
-00048d30: 6f72 6576 6965 772e 6a73 6f6e 272c 2027  oreview.json', '
-00048d40: 7727 2c0a 2020 2020 2020 2020 2020 2020  w',.            
-00048d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d70: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
-00048d80: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
-00048d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048da0: 2020 2020 2020 2020 206a 736f 6e2e 6475           json.du
-00048db0: 6d70 2866 696e 616c 6d6d 6469 6374 2c20  mp(finalmmdict, 
-00048dc0: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
-00048dd0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00048de0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00048df0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00048e00: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00048e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048c90: 2020 2020 2020 2020 6d6f 6465 6c6d 6170          modelmap
+00048ca0: 7375 7266 6163 655b 2765 7272 275d 203d  surface['err'] =
+00048cb0: 207b 276d 6f64 656c 5f66 6974 5f65 7272   {'model_fit_err
+00048cc0: 273a 2065 7272 6c69 7374 7d0a 2020 2020  ': errlist}.    
+00048cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ce0: 2020 2020 2020 2020 6d6f 6465 6c73 7572          modelsur
+00048cf0: 665b 6d6f 6465 6c6e 616d 655d 203d 206d  f[modelname] = m
+00048d00: 6f64 656c 6d61 7073 7572 6661 6365 0a20  odelmapsurface. 
+00048d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d20: 2020 2020 2020 2066 696e 616c 6d6d 6469         finalmmdi
+00048d30: 6374 5b27 7173 636f 7265 5f73 7572 6661  ct['qscore_surfa
+00048d40: 6365 275d 203d 206d 6f64 656c 7375 7266  ce'] = modelsurf
+00048d50: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048d60: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00048d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d80: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00048d90: 636f 6465 6373 2e6f 7065 6e28 7365 6c66  codecs.open(self
+00048da0: 2e77 6f72 6b64 6972 202b 2073 656c 662e  .workdir + self.
+00048db0: 6d61 706e 616d 6520 2b20 275f 7173 636f  mapname + '_qsco
+00048dc0: 7265 7669 6577 2e6a 736f 6e27 2c20 2777  review.json', 'w
+00048dd0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00048de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048e00: 656e 636f 6469 6e67 3d27 7574 662d 3827  encoding='utf-8'
+00048e10: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
 00048e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e30: 2027 5361 7669 6e67 2051 7363 6f72 6520   'Saving Qscore 
-00048e40: 7669 6577 2074 6f20 4a53 4f4e 2065 7272  view to JSON err
-00048e50: 6f72 3a20 7b7d 2e5c 6e27 2e66 6f72 6d61  or: {}.\n'.forma
-00048e60: 7428 7379 732e 6578 635f 696e 666f 2829  t(sys.exc_info()
-00048e70: 5b31 5d29 290a 0a20 2020 2020 2020 2020  [1]))..         
-00048e80: 2020 2020 2020 2065 6e64 203d 2074 696d         end = tim
-00048e90: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
-00048ea0: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-00048eb0: 2020 2020 7072 696e 7428 2751 7363 6f72      print('Qscor
-00048ec0: 6520 7375 7266 6163 6520 7469 6d65 3a20  e surface time: 
-00048ed0: 2573 2720 2520 2865 6e64 202d 2073 7461  %s' % (end - sta
-00048ee0: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
-00048ef0: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
-00048f00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00048f10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00048f20: 2729 0a0a 2020 2020 6465 6620 7173 636f  ')..    def qsco
-00048f30: 7265 6a73 6f6e 2873 656c 6629 3a0a 2020  rejson(self):.  
-00048f40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00048f50: 2020 2020 2020 5173 636f 7265 206a 736f        Qscore jso
-00048f60: 6e20 6669 6c65 2066 6565 6420 696e 746f  n file feed into
-00048f70: 2074 6865 2070 6167 650a 0a20 2020 2020   the page..     
-00048f80: 2020 203a 7265 7475 726e 3a0a 2020 2020     :return:.    
-00048f90: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00048fa0: 2070 6173 730a 0a20 2020 2064 6566 2071   pass..    def q
-00048fb0: 7363 6f72 655f 7363 616c 6562 6172 2873  score_scalebar(s
-00048fc0: 656c 662c 2069 6e70 7574 5f66 696c 652c  elf, input_file,
-00048fd0: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-00048fe0: 2020 2020 2020 2020 4675 6e63 7469 6f6e          Function
-00048ff0: 2068 6572 6520 6973 2074 6f20 7072 6f64   here is to prod
-00049000: 7563 6520 7468 6520 512d 7363 6f72 6520  uce the Q-score 
-00049010: 7363 616c 6520 6261 7220 706c 6f74 0a20  scale bar plot. 
-00049020: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00049030: 2020 2020 696e 7075 745f 6669 6c65 203d      input_file =
-00049040: 2027 2f55 7365 7273 2f7a 6865 2f44 6f77   '/Users/zhe/Dow
-00049050: 6e6c 6f61 6473 2f61 6c6c 7465 6d70 6d61  nloads/alltempma
-00049060: 7073 2f71 7363 6f72 6573 2e63 7376 270a  ps/qscores.csv'.
-00049070: 2020 2020 2020 2020 6e65 775f 656e 7472          new_entr
-00049080: 795f 6469 6374 203d 207b 2769 6473 273a  y_dict = {'ids':
-00049090: 2027 3831 3137 272c 2027 7265 736f 6c75   '8117', 'resolu
-000490a0: 7469 6f6e 273a 2032 2e39 352c 2027 6e61  tion': 2.95, 'na
-000490b0: 6d65 7327 3a20 2735 6972 782e 6369 6627  mes': '5irx.cif'
-000490c0: 2c20 2771 7363 6f72 6573 273a 2030 2e35  , 'qscores': 0.5
-000490d0: 3231 7d0a 2020 2020 2020 2020 6466 203d  21}.        df =
-000490e0: 206c 6f61 645f 7173 636f 7265 2869 6e70   load_qscore(inp
-000490f0: 7574 5f66 696c 652c 206e 6577 5f65 6e74  ut_file, new_ent
-00049100: 7279 5f64 6963 7429 0a20 2020 2020 2020  ry_dict).       
-00049110: 2069 6e64 6578 203d 2064 665b 6466 5b27   index = df[df['
-00049120: 6964 7327 5d20 3d3d 2027 3030 3030 3027  ids'] == '00000'
-00049130: 5d2e 696e 6465 780a 2020 2020 2020 2020  ].index.        
-00049140: 726f 7720 3d20 6466 2e69 6c6f 635b 696e  row = df.iloc[in
-00049150: 6465 782c 5d0a 2020 2020 2020 2020 2871  dex,].        (q
-00049160: 6d69 6e2c 2071 6d61 7829 2c20 6f72 6967  min, qmax), orig
-00049170: 696e 616c 5f76 616c 7565 203d 2067 6574  inal_value = get
-00049180: 5f71 7363 6f72 6573 2864 662c 206e 6577  _qscores(df, new
-00049190: 5f65 6e74 7279 5f64 6963 745b 2771 7363  _entry_dict['qsc
-000491a0: 6f72 6573 275d 290a 2020 2020 2020 2020  ores']).        
-000491b0: 7461 7267 6574 5f76 616c 7565 203d 2069  target_value = i
-000491c0: 6e74 286d 6174 6368 5f74 6f5f 6e65 7773  nt(match_to_news
-000491d0: 6361 6c65 2828 302c 2073 756d 286f 7269  cale((0, sum(ori
-000491e0: 6769 6e61 6c5f 7661 6c75 6529 292c 2028  ginal_value)), (
-000491f0: 302c 2031 3939 292c 206f 7269 6769 6e61  0, 199), origina
-00049200: 6c5f 7661 6c75 655b 305d 2929 0a0a 2020  l_value[0]))..  
-00049210: 2020 2020 2020 6466 3130 3030 203d 2067        df1000 = g
-00049220: 6574 5f6e 6561 7265 7374 5f6f 6e65 7468  et_nearest_oneth
-00049230: 6f75 7361 6e64 286e 6577 5f65 6e74 7279  ousand(new_entry
-00049240: 5f64 6963 742c 2064 662c 2035 3030 290a  _dict, df, 500).
-00049250: 2020 2020 2020 2020 2873 716d 696e 2c20          (sqmin, 
-00049260: 7371 6d61 7829 2c20 6f76 616c 7565 203d  sqmax), ovalue =
-00049270: 2067 6574 5f71 7363 6f72 6573 2864 6631   get_qscores(df1
-00049280: 3030 302c 206e 6577 5f65 6e74 7279 5f64  000, new_entry_d
-00049290: 6963 745b 2771 7363 6f72 6573 275d 290a  ict['qscores']).
-000492a0: 2020 2020 2020 2020 7072 696e 7428 7371          print(sq
-000492b0: 6d69 6e2c 2073 716d 6178 290a 2020 2020  min, sqmax).    
-000492c0: 2020 2020 7072 696e 7428 6f76 616c 7565      print(ovalue
-000492d0: 290a 2020 2020 2020 2020 7461 7267 6574  ).        target
-000492e0: 5f76 616c 7565 5f34 3020 3d20 696e 7428  _value_40 = int(
-000492f0: 6d61 7463 685f 746f 5f6e 6577 7363 616c  match_to_newscal
-00049300: 6528 2830 2c20 7375 6d28 6f76 616c 7565  e((0, sum(ovalue
-00049310: 2929 2c20 2830 2c20 3139 3929 2c20 6f76  )), (0, 199), ov
-00049320: 616c 7565 5b30 5d29 290a 2020 2020 2020  alue[0])).      
-00049330: 2020 7072 696e 7428 7461 7267 6574 5f76    print(target_v
-00049340: 616c 7565 290a 2020 2020 2020 2020 7072  alue).        pr
-00049350: 696e 7428 7461 7267 6574 5f76 616c 7565  int(target_value
-00049360: 5f34 3029 0a20 2020 2020 2020 2070 6c6f  _40).        plo
-00049370: 745f 6261 725f 6d61 7428 7461 7267 6574  t_bar_mat(target
-00049380: 5f76 616c 7565 2c20 7461 7267 6574 5f76  _value, target_v
-00049390: 616c 7565 5f34 302c 2071 6d69 6e2c 2071  alue_40, qmin, q
-000493a0: 6d61 7829 0a0a 2020 2020 2320 5173 636f  max)..    # Qsco
-000493b0: 7265 2072 656c 6174 6564 2065 6e64 6564  re related ended
-000493c0: 2068 6572 650a 0a20 2020 2064 6566 206d   here..    def m
-000493d0: 6f76 6570 726f 7368 6164 6552 6573 756c  oveproshadeResul
-000493e0: 7428 7365 6c66 293a 0a0a 2020 2020 2020  t(self):..      
-000493f0: 2020 696d 706f 7274 2073 6875 7469 6c0a    import shutil.
-00049400: 0a20 2020 2020 2020 2063 7764 203d 206f  .        cwd = o
-00049410: 732e 6765 7463 7764 2829 0a20 2020 2020  s.getcwd().     
-00049420: 2020 2073 7263 6469 7220 3d20 277b 7d2f     srcdir = '{}/
-00049430: 7072 6f73 6861 6465 5f72 6570 6f72 7427  proshade_report'
-00049440: 2e66 6f72 6d61 7428 6377 6429 0a20 2020  .format(cwd).   
-00049450: 2020 2020 2064 6573 6469 7220 3d20 7365       desdir = se
-00049460: 6c66 2e77 6f72 6b64 6972 0a20 2020 2020  lf.workdir.     
-00049470: 2020 2064 6573 7072 6f64 6972 203d 2027     desprodir = '
-00049480: 7b7d 2f70 726f 7368 6164 655f 7265 706f  {}/proshade_repo
-00049490: 7274 272e 666f 726d 6174 2864 6573 6469  rt'.format(desdi
-000494a0: 7229 0a20 2020 2020 2020 2069 6620 6f73  r).        if os
-000494b0: 2e70 6174 682e 6973 6469 7228 6465 7370  .path.isdir(desp
-000494c0: 726f 6469 7229 3a0a 2020 2020 2020 2020  rodir):.        
-000494d0: 2020 2020 7368 7574 696c 2e72 6d74 7265      shutil.rmtre
-000494e0: 6528 6465 7370 726f 6469 7229 0a20 2020  e(desprodir).   
-000494f0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00049500: 6973 6469 7228 7372 6364 6972 293a 0a20  isdir(srcdir):. 
-00049510: 2020 2020 2020 2020 2020 2064 6573 7420             dest 
-00049520: 3d20 7368 7574 696c 2e6d 6f76 6528 7372  = shutil.move(sr
-00049530: 6364 6972 2c20 6465 7364 6972 290a 2020  cdir, desdir).  
-00049540: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00049550: 2020 2020 2020 2020 6465 7374 203d 204e          dest = N
-00049560: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00049570: 7072 696e 7428 274e 6f20 7072 6f73 6861  print('No prosha
-00049580: 6465 2072 6573 756c 7420 746f 2062 6520  de result to be 
-00049590: 6d6f 7665 642e 2729 0a0a 2020 2020 2020  moved.')..      
-000495a0: 2020 7265 7475 726e 2064 6573 740a 0a20    return dest.. 
-000495b0: 2020 2064 6566 2073 796d 6d65 7472 7974     def symmetryt
-000495c0: 6f6a 736f 6e28 7365 6c66 2c20 6f75 7470  ojson(self, outp
-000495d0: 7574 293a 0a20 2020 2020 2020 2022 2222  ut):.        """
-000495e0: 0a0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
-000495f0: 6e76 6572 7420 7468 6520 6f75 7470 7574  nvert the output
-00049600: 206f 6620 7072 6f73 6861 6465 2073 796d   of proshade sym
-00049610: 6d65 7472 7920 6361 6c63 756c 6174 696f  metry calculatio
-00049620: 6e20 746f 206a 736f 6e20 7768 6963 6820  n to json which 
-00049630: 6361 6e20 6265 2075 7365 6420 6675 7274  can be used furt
-00049640: 6865 720a 0a20 2020 2020 2020 203a 7061  her..        :pa
-00049650: 7261 6d20 6f75 7470 7574 3a0a 2020 2020  ram output:.    
-00049660: 2020 2020 3a72 6574 7572 6e3a 0a20 2020      :return:.   
-00049670: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00049680: 2020 7061 7373 0a0a 2020 2020 6465 6620    pass..    def 
-00049690: 7374 7275 6465 6c28 7365 6c66 293a 0a20  strudel(self):. 
-000496a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000496b0: 2020 2020 3a72 6574 7572 6e3a 0a20 2020      :return:.   
-000496c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000496d0: 2069 6620 7365 6c66 2e70 6c61 7466 6f72   if self.platfor
-000496e0: 6d20 3d3d 2027 656d 6462 2720 616e 6420  m == 'emdb' and 
-000496f0: 7365 6c66 2e6d 6574 2021 3d20 2774 6f6d  self.met != 'tom
-00049700: 6f27 3a0a 2020 2020 2020 2020 2020 2020  o':.            
-00049710: 6572 726c 6973 7420 3d20 5b5d 0a20 2020  errlist = [].   
-00049720: 2020 2020 2020 2020 2066 696e 616c 5f72           final_r
-00049730: 616e 6765 203d 204e 6f6e 650a 2020 2020  ange = None.    
-00049740: 2020 2020 2020 2020 7265 735f 7261 6e67          res_rang
-00049750: 6573 203d 205b 5b32 2e30 2c20 322e 335d  es = [[2.0, 2.3]
-00049760: 2c20 5b32 2e33 2c20 322e 355d 2c20 5b32  , [2.3, 2.5], [2
-00049770: 2e35 2c20 322e 385d 2c20 5b32 2e38 2c20  .5, 2.8], [2.8, 
-00049780: 332e 305d 2c20 5b33 2e30 2c20 332e 325d  3.0], [3.0, 3.2]
-00049790: 2c20 5b33 2e32 2c20 332e 355d 2c20 5b33  , [3.2, 3.5], [3
-000497a0: 2e35 2c20 342e 305d 5d0a 2020 2020 2020  .5, 4.0]].      
-000497b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000497c0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-000497d0: 6478 2c20 6372 616e 6765 2069 6e20 656e  dx, crange in en
-000497e0: 756d 6572 6174 6528 7265 735f 7261 6e67  umerate(res_rang
-000497f0: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-00049800: 2020 2020 2020 2020 2069 6620 6372 616e           if cran
-00049810: 6765 5b30 5d20 3c20 666c 6f61 7428 7365  ge[0] < float(se
-00049820: 6c66 2e72 6573 6f6c 7574 696f 6e29 203c  lf.resolution) <
-00049830: 3d20 6372 616e 6765 5b31 5d3a 0a20 2020  = crange[1]:.   
-00049840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049850: 2020 2020 2066 696e 616c 5f72 616e 6765       final_range
-00049860: 203d 2063 7261 6e67 650a 2020 2020 2020   = crange.      
-00049870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049880: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-00049890: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000498a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000498b0: 2020 7072 696e 7428 274d 6170 2064 6964    print('Map did
-000498c0: 206e 6f74 2066 616c 6c20 696e 746f 2061   not fall into a
-000498d0: 6e79 2061 7661 696c 6162 6c65 2072 6573  ny available res
-000498e0: 6f6c 7574 696f 6e20 7261 6e67 652e 2729  olution range.')
+00048e30: 2020 2020 2020 2020 6a73 6f6e 2e64 756d          json.dum
+00048e40: 7028 6669 6e61 6c6d 6d64 6963 742c 2066  p(finalmmdict, f
+00048e50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00048e60: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00048e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00048e80: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00048e90: 732e 7374 6465 7272 2e77 7269 7465 280a  s.stderr.write(.
+00048ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ec0: 2753 6176 696e 6720 5173 636f 7265 2076  'Saving Qscore v
+00048ed0: 6965 7720 746f 204a 534f 4e20 6572 726f  iew to JSON erro
+00048ee0: 723a 207b 7d2e 5c6e 272e 666f 726d 6174  r: {}.\n'.format
+00048ef0: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
+00048f00: 315d 2929 0a0a 2020 2020 2020 2020 2020  1]))..          
+00048f10: 2020 2020 2020 656e 6420 3d20 7469 6d65        end = time
+00048f20: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
+00048f30: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00048f40: 2020 2070 7269 6e74 2827 5173 636f 7265     print('Qscore
+00048f50: 2073 7572 6661 6365 2074 696d 653a 2025   surface time: %
+00048f60: 7327 2025 2028 656e 6420 2d20 7374 6172  s' % (end - star
+00048f70: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+00048f80: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+00048f90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00048fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+00048fb0: 290a 0a20 2020 2064 6566 206d 6f76 6570  )..    def movep
+00048fc0: 726f 7368 6164 6552 6573 756c 7428 7365  roshadeResult(se
+00048fd0: 6c66 293a 0a0a 2020 2020 2020 2020 696d  lf):..        im
+00048fe0: 706f 7274 2073 6875 7469 6c0a 0a20 2020  port shutil..   
+00048ff0: 2020 2020 2063 7764 203d 206f 732e 6765       cwd = os.ge
+00049000: 7463 7764 2829 0a20 2020 2020 2020 2073  tcwd().        s
+00049010: 7263 6469 7220 3d20 277b 7d2f 7072 6f73  rcdir = '{}/pros
+00049020: 6861 6465 5f72 6570 6f72 7427 2e66 6f72  hade_report'.for
+00049030: 6d61 7428 6377 6429 0a20 2020 2020 2020  mat(cwd).       
+00049040: 2064 6573 6469 7220 3d20 7365 6c66 2e77   desdir = self.w
+00049050: 6f72 6b64 6972 0a20 2020 2020 2020 2064  orkdir.        d
+00049060: 6573 7072 6f64 6972 203d 2027 7b7d 2f70  esprodir = '{}/p
+00049070: 726f 7368 6164 655f 7265 706f 7274 272e  roshade_report'.
+00049080: 666f 726d 6174 2864 6573 6469 7229 0a20  format(desdir). 
+00049090: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+000490a0: 682e 6973 6469 7228 6465 7370 726f 6469  h.isdir(desprodi
+000490b0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000490c0: 7368 7574 696c 2e72 6d74 7265 6528 6465  shutil.rmtree(de
+000490d0: 7370 726f 6469 7229 0a20 2020 2020 2020  sprodir).       
+000490e0: 2069 6620 6f73 2e70 6174 682e 6973 6469   if os.path.isdi
+000490f0: 7228 7372 6364 6972 293a 0a20 2020 2020  r(srcdir):.     
+00049100: 2020 2020 2020 2064 6573 7420 3d20 7368         dest = sh
+00049110: 7574 696c 2e6d 6f76 6528 7372 6364 6972  util.move(srcdir
+00049120: 2c20 6465 7364 6972 290a 2020 2020 2020  , desdir).      
+00049130: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00049140: 2020 2020 6465 7374 203d 204e 6f6e 650a      dest = None.
+00049150: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00049160: 7428 274e 6f20 7072 6f73 6861 6465 2072  t('No proshade r
+00049170: 6573 756c 7420 746f 2062 6520 6d6f 7665  esult to be move
+00049180: 642e 2729 0a0a 2020 2020 2020 2020 7265  d.')..        re
+00049190: 7475 726e 2064 6573 740a 0a20 2020 2064  turn dest..    d
+000491a0: 6566 2073 796d 6d65 7472 7974 6f6a 736f  ef symmetrytojso
+000491b0: 6e28 7365 6c66 2c20 6f75 7470 7574 293a  n(self, output):
+000491c0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+000491d0: 2020 2020 2020 2020 2020 436f 6e76 6572            Conver
+000491e0: 7420 7468 6520 6f75 7470 7574 206f 6620  t the output of 
+000491f0: 7072 6f73 6861 6465 2073 796d 6d65 7472  proshade symmetr
+00049200: 7920 6361 6c63 756c 6174 696f 6e20 746f  y calculation to
+00049210: 206a 736f 6e20 7768 6963 6820 6361 6e20   json which can 
+00049220: 6265 2075 7365 6420 6675 7274 6865 720a  be used further.
+00049230: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00049240: 6f75 7470 7574 3a0a 2020 2020 2020 2020  output:.        
+00049250: 3a72 6574 7572 6e3a 0a20 2020 2020 2020  :return:.       
+00049260: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
+00049270: 7373 0a0a 2020 2020 6465 6620 7374 7275  ss..    def stru
+00049280: 6465 6c28 7365 6c66 293a 0a20 2020 2020  del(self):.     
+00049290: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+000492a0: 3a72 6574 7572 6e3a 0a20 2020 2020 2020  :return:.       
+000492b0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+000492c0: 7365 6c66 2e70 6c61 7466 6f72 6d20 3d3d  self.platform ==
+000492d0: 2027 656d 6462 2720 616e 6420 7365 6c66   'emdb' and self
+000492e0: 2e6d 6574 2021 3d20 2774 6f6d 6f27 3a0a  .met != 'tomo':.
+000492f0: 2020 2020 2020 2020 2020 2020 6572 726c              errl
+00049300: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00049310: 2020 2020 2066 696e 616c 5f72 616e 6765       final_range
+00049320: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00049330: 2020 2020 7265 735f 7261 6e67 6573 203d      res_ranges =
+00049340: 205b 5b32 2e30 2c20 322e 335d 2c20 5b32   [[2.0, 2.3], [2
+00049350: 2e33 2c20 322e 355d 2c20 5b32 2e35 2c20  .3, 2.5], [2.5, 
+00049360: 322e 385d 2c20 5b32 2e38 2c20 332e 305d  2.8], [2.8, 3.0]
+00049370: 2c20 5b33 2e30 2c20 332e 325d 2c20 5b33  , [3.0, 3.2], [3
+00049380: 2e32 2c20 332e 355d 2c20 5b33 2e35 2c20  .2, 3.5], [3.5, 
+00049390: 342e 305d 5d0a 2020 2020 2020 2020 2020  4.0]].          
+000493a0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000493b0: 2020 2020 2020 2066 6f72 2069 6478 2c20         for idx, 
+000493c0: 6372 616e 6765 2069 6e20 656e 756d 6572  crange in enumer
+000493d0: 6174 6528 7265 735f 7261 6e67 6573 293a  ate(res_ranges):
+000493e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000493f0: 2020 2020 2069 6620 6372 616e 6765 5b30       if crange[0
+00049400: 5d20 3c20 666c 6f61 7428 7365 6c66 2e72  ] < float(self.r
+00049410: 6573 6f6c 7574 696f 6e29 203c 3d20 6372  esolution) <= cr
+00049420: 616e 6765 5b31 5d3a 0a20 2020 2020 2020  ange[1]:.       
+00049430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049440: 2066 696e 616c 5f72 616e 6765 203d 2063   final_range = c
+00049450: 7261 6e67 650a 2020 2020 2020 2020 2020  range.          
+00049460: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00049470: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00049480: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00049490: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000494a0: 696e 7428 274d 6170 2064 6964 206e 6f74  int('Map did not
+000494b0: 2066 616c 6c20 696e 746f 2061 6e79 2061   fall into any a
+000494c0: 7661 696c 6162 6c65 2072 6573 6f6c 7574  vailable resolut
+000494d0: 696f 6e20 7261 6e67 652e 2729 0a20 2020  ion range.').   
+000494e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000494f0: 2070 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d   print('--------
+00049500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00049510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a20  ------------'). 
+00049520: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00049530: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00049540: 2020 2065 7272 203d 2027 5374 7275 6465     err = 'Strude
+00049550: 6c20 6d6f 7469 6620 6c69 6220 7265 736f  l motif lib reso
+00049560: 6c75 7469 6f6e 2072 616e 6765 2063 6865  lution range che
+00049570: 636b 2065 7272 6f72 3a20 7b7d 2e27 2e66  ck error: {}.'.f
+00049580: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
+00049590: 666f 2829 5b31 5d29 0a20 2020 2020 2020  fo()[1]).       
+000495a0: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
+000495b0: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
+000495c0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+000495d0: 2e73 7464 6572 722e 7772 6974 6528 6572  .stderr.write(er
+000495e0: 7220 2b20 275c 6e27 290a 0a20 2020 2020  r + '\n')..     
+000495f0: 2020 2020 2020 2073 7472 7564 656c 6170         strudelap
+00049600: 7020 3d20 4e6f 6e65 0a20 2020 2020 2020  p = None.       
+00049610: 2020 2020 2023 2075 7365 2061 2066 6978       # use a fix
+00049620: 2076 616c 7565 2066 6f72 206e 6f77 2c20   value for now, 
+00049630: 6d61 7920 636f 6e73 6964 6572 2061 7320  may consider as 
+00049640: 6120 6172 6775 6d65 6e74 2066 6f72 206c  a argument for l
+00049650: 6174 6572 0a20 2020 2020 2020 2020 2020  ater.           
+00049660: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00049670: 2020 2020 2020 2320 7374 7275 6465 6c61        # strudela
+00049680: 7070 203d 2073 656c 662e 6368 6563 6b73  pp = self.checks
+00049690: 7472 7564 656c 7363 6f72 6528 6f63 6869  trudelscore(ochi
+000496a0: 6d65 7261 6170 7029 0a20 2020 2020 2020  meraapp).       
+000496b0: 2020 2020 2020 2020 206d 6170 6e61 6d65           mapname
+000496c0: 203d 2073 656c 662e 6d61 702e 6675 6c6c   = self.map.full
+000496d0: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+000496e0: 2020 2020 2069 6620 7365 6c66 2e6d 6f64       if self.mod
+000496f0: 656c 7320 6973 206e 6f74 204e 6f6e 653a  els is not None:
+00049700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049710: 2020 2020 206d 6f64 656c 7320 3d20 2720       models = ' 
+00049720: 272e 6a6f 696e 285b 6d6f 6465 6c2e 6669  '.join([model.fi
+00049730: 6c65 6e61 6d65 2066 6f72 206d 6f64 656c  lename for model
+00049740: 2069 6e20 7365 6c66 2e6d 6f64 656c 735d   in self.models]
+00049750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00049760: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00049770: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00049780: 7428 274e 6f20 6669 7474 6564 206d 6f64  t('No fitted mod
+00049790: 656c 2066 6f72 2053 7472 7564 656c 2063  el for Strudel c
+000497a0: 616c 6375 6c61 7469 6f6e 2e27 290a 2020  alculation.').  
+000497b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000497c0: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
+000497d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000497e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
+000497f0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00049800: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+00049810: 2020 2020 2065 7272 203d 2027 5374 7275       err = 'Stru
+00049820: 6465 6c20 7072 6570 6172 6174 696f 6e20  del preparation 
+00049830: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
+00049840: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
+00049850: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+00049860: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+00049870: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+00049880: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+00049890: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
+000498a0: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+000498b0: 2020 2020 6c69 625f 726f 6f74 203d 204e      lib_root = N
+000498c0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000498d0: 6966 204c 4942 5f53 5452 5544 454c 5f52  if LIB_STRUDEL_R
+000498e0: 4f4f 5420 6973 206e 6f74 204e 6f6e 653a  OOT is not None:
 000498f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049900: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
-00049910: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00049920: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00049930: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
-00049940: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-00049950: 2020 2020 2020 2065 7272 203d 2027 5374         err = 'St
-00049960: 7275 6465 6c20 6d6f 7469 6620 6c69 6220  rudel motif lib 
-00049970: 7265 736f 6c75 7469 6f6e 2072 616e 6765  resolution range
-00049980: 2063 6865 636b 2065 7272 6f72 3a20 7b7d   check error: {}
-00049990: 2e27 2e66 6f72 6d61 7428 7379 732e 6578  .'.format(sys.ex
-000499a0: 635f 696e 666f 2829 5b31 5d29 0a20 2020  c_info()[1]).   
-000499b0: 2020 2020 2020 2020 2020 2020 2065 7272               err
-000499c0: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
-000499d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000499e0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-000499f0: 6528 6572 7220 2b20 275c 6e27 290a 0a20  e(err + '\n').. 
-00049a00: 2020 2020 2020 2020 2020 2073 7472 7564             strud
-00049a10: 656c 6170 7020 3d20 4e6f 6e65 0a20 2020  elapp = None.   
-00049a20: 2020 2020 2020 2020 2023 2075 7365 2061           # use a
-00049a30: 2066 6978 2076 616c 7565 2066 6f72 206e   fix value for n
-00049a40: 6f77 2c20 6d61 7920 636f 6e73 6964 6572  ow, may consider
-00049a50: 2061 7320 6120 6172 6775 6d65 6e74 2066   as a argument f
-00049a60: 6f72 206c 6174 6572 0a20 2020 2020 2020  or later.       
-00049a70: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00049a80: 2020 2020 2020 2020 2020 2320 7374 7275            # stru
-00049a90: 6465 6c61 7070 203d 2073 656c 662e 6368  delapp = self.ch
-00049aa0: 6563 6b73 7472 7564 656c 7363 6f72 6528  eckstrudelscore(
-00049ab0: 6f63 6869 6d65 7261 6170 7029 0a20 2020  ochimeraapp).   
-00049ac0: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00049ad0: 6e61 6d65 203d 2073 656c 662e 6d61 702e  name = self.map.
-00049ae0: 6675 6c6c 6e61 6d65 0a20 2020 2020 2020  fullname.       
-00049af0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00049b00: 2e6d 6f64 656c 7320 6973 206e 6f74 204e  .models is not N
-00049b10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00049b20: 2020 2020 2020 2020 206d 6f64 656c 7320           models 
-00049b30: 3d20 2720 272e 6a6f 696e 285b 6d6f 6465  = ' '.join([mode
-00049b40: 6c2e 6669 6c65 6e61 6d65 2066 6f72 206d  l.filename for m
-00049b50: 6f64 656c 2069 6e20 7365 6c66 2e6d 6f64  odel in self.mod
-00049b60: 656c 735d 290a 2020 2020 2020 2020 2020  els]).          
-00049b70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00049b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049b90: 7072 696e 7428 274e 6f20 6669 7474 6564  print('No fitted
-00049ba0: 206d 6f64 656c 2066 6f72 2053 7472 7564   model for Strud
-00049bb0: 656c 2063 616c 6375 6c61 7469 6f6e 2e27  el calculation.'
-00049bc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00049bd0: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
-00049be0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00049bf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00049c00: 2d27 290a 0a20 2020 2020 2020 2020 2020  -')..           
-00049c10: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00049c20: 2020 2020 2020 2020 2065 7272 203d 2027           err = '
-00049c30: 5374 7275 6465 6c20 7072 6570 6172 6174  Strudel preparat
-00049c40: 696f 6e20 6572 726f 723a 207b 7d2e 272e  ion error: {}.'.
-00049c50: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
-00049c60: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
-00049c70: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
-00049c80: 742e 6170 7065 6e64 2865 7272 290a 2020  t.append(err).  
-00049c90: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00049ca0: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
-00049cb0: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
-00049cc0: 2020 2020 2020 2020 6c69 625f 726f 6f74          lib_root
-00049cd0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00049ce0: 2020 2020 6966 204c 4942 5f53 5452 5544      if LIB_STRUD
-00049cf0: 454c 5f52 4f4f 5420 6973 206e 6f74 204e  EL_ROOT is not N
-00049d00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00049d10: 2020 2020 206c 6962 5f72 6f6f 7420 3d20       lib_root = 
-00049d20: 4c49 425f 5354 5255 4445 4c5f 524f 4f54  LIB_STRUDEL_ROOT
-00049d30: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00049d40: 6620 4c49 425f 5354 5255 4445 4c5f 524f  f LIB_STRUDEL_RO
-00049d50: 4f54 2069 7320 4e6f 6e65 2061 6e64 2073  OT is None and s
-00049d60: 656c 662e 7374 7275 6465 6c6c 6962 2069  elf.strudellib i
-00049d70: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00049d80: 2020 2020 2020 2020 2020 2020 6c69 625f              lib_
-00049d90: 726f 6f74 203d 2073 656c 662e 7374 7275  root = self.stru
-00049da0: 6465 6c6c 6962 0a20 2020 2020 2020 2020  dellib.         
-00049db0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00049dc0: 2020 2020 2020 2020 206c 6962 5f72 6f6f           lib_roo
-00049dd0: 7420 3d20 4e6f 6e65 0a0a 2020 2020 2020  t = None..      
-00049de0: 2020 2020 2020 2320 6966 2073 7472 7564        # if strud
-00049df0: 656c 6170 7020 616e 6420 7365 6c66 2e6d  elapp and self.m
-00049e00: 6f64 656c 733a 0a20 2020 2020 2020 2020  odels:.         
-00049e10: 2020 2069 6620 6669 6e61 6c5f 7261 6e67     if final_rang
-00049e20: 6520 616e 6420 7365 6c66 2e6d 6f64 656c  e and self.model
-00049e30: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00049e40: 2020 2066 6f72 206d 6f64 656c 2069 6e20     for model in 
-00049e50: 7365 6c66 2e6d 6f64 656c 733a 0a20 2020  self.models:.   
-00049e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e70: 2066 756c 6c5f 6d6f 6465 6c20 3d20 277b   full_model = '{
-00049e80: 7d7b 7d27 2e66 6f72 6d61 7428 7365 6c66  }{}'.format(self
-00049e90: 2e77 6f72 6b64 6972 2c20 6f73 2e70 6174  .workdir, os.pat
-00049ea0: 682e 6261 7365 6e61 6d65 286d 6f64 656c  h.basename(model
-00049eb0: 2e66 696c 656e 616d 6529 290a 2020 2020  .filename)).    
-00049ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ed0: 6675 6c6c 5f6d 6170 203d 2027 7b7d 7b7d  full_map = '{}{}
-00049ee0: 272e 666f 726d 6174 2873 656c 662e 776f  '.format(self.wo
-00049ef0: 726b 6469 722c 2073 656c 662e 6d61 706e  rkdir, self.mapn
-00049f00: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00049f10: 2020 2020 2020 2020 206c 6962 5f70 6174           lib_pat
-00049f20: 6820 3d20 277b 7d2f 6d6f 7469 6673 5f7b  h = '{}/motifs_{
-00049f30: 7d2d 7b7d 272e 666f 726d 6174 286c 6962  }-{}'.format(lib
-00049f40: 5f72 6f6f 742c 2066 696e 616c 5f72 616e  _root, final_ran
-00049f50: 6765 5b30 5d2c 2066 696e 616c 5f72 616e  ge[0], final_ran
-00049f60: 6765 5b31 5d29 0a20 2020 2020 2020 2020  ge[1]).         
-00049f70: 2020 2020 2020 2020 2020 206f 7574 5f70             out_p
-00049f80: 6174 6820 3d20 277b 7d5f 7374 7275 6465  ath = '{}_strude
-00049f90: 6c27 2e66 6f72 6d61 7428 6675 6c6c 5f6d  l'.format(full_m
-00049fa0: 6f64 656c 290a 0a20 2020 2020 2020 2020  odel)..         
-00049fb0: 2020 2020 2020 2020 2020 2072 6572 7220             rerr 
-00049fc0: 3d20 7275 6e5f 7374 7275 6465 6c28 6675  = run_strudel(fu
-00049fd0: 6c6c 5f6d 6f64 656c 2c20 6675 6c6c 5f6d  ll_model, full_m
-00049fe0: 6170 2c20 6c69 625f 7061 7468 2c20 6f75  ap, lib_path, ou
-00049ff0: 745f 7061 7468 2c20 7365 6c66 2e70 6c61  t_path, self.pla
-0004a000: 7466 6f72 6d29 0a20 2020 2020 2020 2020  tform).         
-0004a010: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0004a020: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
-0004a030: 2020 2020 2020 2020 2020 2020 6572 7220              err 
-0004a040: 3d20 2753 7472 7564 656c 2063 616c 6375  = 'Strudel calcu
-0004a050: 6c61 7469 6f6e 2065 7272 6f72 3a20 7b7d  lation error: {}
-0004a060: 272e 666f 726d 6174 2872 6572 7229 0a20  '.format(rerr). 
-0004a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a080: 2020 2020 2020 2065 7272 6c69 7374 2e61         errlist.a
-0004a090: 7070 656e 6428 6572 7229 0a20 2020 2020  ppend(err).     
-0004a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a0b0: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
-0004a0c0: 6974 6528 6572 7220 2b20 275c 6e27 290a  ite(err + '\n').
-0004a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a0e0: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
-0004a0f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a110: 2d2d 2d27 290a 0a20 2020 2020 2020 2020  ---')..         
-0004a120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0004a130: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004a140: 4e6f 206d 6f64 656c 206f 7220 7265 736f  No model or reso
-0004a150: 6c75 7469 6f6e 2069 7320 6e6f 7420 636f  lution is not co
-0004a160: 7665 7265 6420 696e 2074 6865 206d 6f74  vered in the mot
-0004a170: 6966 206c 6962 7261 7279 2028 3c34 2e30  if library (<4.0
-0004a180: c385 2920 2729 0a20 2020 2020 2020 2020  ..) ').         
-0004a190: 2020 2020 2020 2070 7269 6e74 2827 2d2d         print('--
-0004a1a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a1b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a1c0: 2d2d 2729 0a0a 2020 2020 2020 2020 7265  --')..        re
-0004a1d0: 7475 726e 204e 6f6e 650a 0a0a 0a0a 2020  turn None.....  
-0004a1e0: 2020 6465 6620 7265 616c 5f6d 6d63 6328    def real_mmcc(
-0004a1f0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0004a200: 2222 0a20 2020 2020 2020 2020 2020 2043  "".            C
-0004a210: 616c 6375 6c61 7469 6f6e 2072 6561 6c20  alculation real 
-0004a220: 7370 6163 6520 6372 6f73 732d 636f 7272  space cross-corr
-0004a230: 656c 6174 696f 6e20 6265 7477 6565 6e20  elation between 
-0004a240: 7072 696d 6172 7920 6d61 7020 616e 6420  primary map and 
-0004a250: 6d6f 6465 6c2d 6d61 7020 2852 6566 6d61  model-map (Refma
-0004a260: 6329 0a0a 2020 2020 2020 2020 3a72 6574  c)..        :ret
-0004a270: 7572 6e3a 0a20 2020 2020 2020 2022 2222  urn:.        """
-0004a280: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0004a290: 662e 6d6f 6465 6c73 6d61 7073 2061 6e64  f.modelsmaps and
-0004a2a0: 2073 656c 662e 706c 6174 666f 726d 203d   self.platform =
-0004a2b0: 3d20 2765 6d64 6227 3a0a 2020 2020 2020  = 'emdb':.      
-0004a2c0: 2020 2020 2020 7374 6172 7420 3d20 7469        start = ti
-0004a2d0: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-0004a2e0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-0004a2f0: 2072 6d6d 6363 6320 3d20 7b7d 0a20 2020   rmmccc = {}.   
-0004a300: 2020 2020 2020 2020 206d 6d63 635f 6469           mmcc_di
-0004a310: 6374 203d 207b 7d0a 2020 2020 2020 2020  ct = {}.        
-0004a320: 2020 2020 6572 726c 6973 7420 3d20 5b5d      errlist = []
-0004a330: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0004a340: 206d 6f64 656c 6d61 7020 696e 2073 656c   modelmap in sel
-0004a350: 662e 6d6f 6465 6c73 6d61 7073 3a0a 2020  f.modelsmaps:.  
-0004a360: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0004a370: 696e 7428 6d6f 6465 6c6d 6170 290a 2020  int(modelmap).  
-0004a380: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0004a390: 6465 6c6d 6170 5f6e 616d 6520 3d20 6f73  delmap_name = os
-0004a3a0: 2e70 6174 682e 6261 7365 6e61 6d65 286d  .path.basename(m
-0004a3b0: 6f64 656c 6d61 7029 0a20 2020 2020 2020  odelmap).       
-0004a3c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0004a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a3e0: 2020 6d6d 6170 203d 206d 7263 6669 6c65    mmap = mrcfile
-0004a3f0: 2e6d 6d61 7028 6d6f 6465 6c6d 6170 2c20  .mmap(modelmap, 
-0004a400: 6d6f 6465 3d27 7227 290a 2020 2020 2020  mode='r').      
-0004a410: 2020 2020 2020 2020 2020 2020 2020 6d6d                mm
-0004a420: 6170 6461 7461 203d 206d 6d61 702e 6461  apdata = mmap.da
-0004a430: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
-0004a440: 2020 2020 2020 206d 6d63 6320 3d20 7275         mmcc = ru
-0004a450: 6e5f 7265 616c 6d6d 6363 2873 656c 662e  n_realmmcc(self.
-0004a460: 6d61 702e 6461 7461 2c20 6d6d 6170 6461  map.data, mmapda
-0004a470: 7461 295b 315d 0a20 2020 2020 2020 2020  ta)[1].         
-0004a480: 2020 2020 2020 2020 2020 206d 6d63 635f             mmcc_
-0004a490: 6469 6374 5b6d 6f64 656c 6d61 705f 6e61  dict[modelmap_na
-0004a4a0: 6d65 5d20 3d20 6d6d 6363 0a20 2020 2020  me] = mmcc.     
-0004a4b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0004a4c0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0004a4d0: 2020 2020 2020 2065 7272 203d 2027 4d61         err = 'Ma
-0004a4e0: 7020 616e 6420 6d6f 6465 6c20 7b7d 2072  p and model {} r
-0004a4f0: 6561 6c20 7370 6163 6520 4343 2063 616c  eal space CC cal
-0004a500: 6375 6c61 7469 6f6e 2065 7272 6f72 3a20  culation error: 
-0004a510: 7b7d 2e27 2e66 6f72 6d61 7428 6d6f 6465  {}.'.format(mode
-0004a520: 6c6d 6170 5f6e 616d 652c 2073 7973 2e65  lmap_name, sys.e
-0004a530: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-0004a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a550: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-0004a560: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
-0004a570: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-0004a580: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
-0004a590: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
-0004a5a0: 2020 2020 6966 2065 7272 6c69 7374 3a0a      if errlist:.
-0004a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a5c0: 726d 6d63 6363 5b27 6572 7227 5d20 3d20  rmmccc['err'] = 
-0004a5d0: 7b27 726d 6d63 6363 5f65 7272 273a 2065  {'rmmccc_err': e
-0004a5e0: 7272 6c69 7374 7d0a 2020 2020 2020 2020  rrlist}.        
-0004a5f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0004a600: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0004a610: 274e 6f20 6572 726f 7220 696e 2072 6d6d  'No error in rmm
-0004a620: 6363 6320 6361 6c63 756c 6174 696f 6e2e  ccc calculation.
-0004a630: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
-0004a640: 726d 6d63 6363 5b27 726d 6d63 6363 275d  rmmccc['rmmccc']
-0004a650: 203d 206d 6d63 635f 6469 6374 0a20 2020   = mmcc_dict.   
-0004a660: 2020 2020 2020 2020 2069 6620 726d 6d63           if rmmc
-0004a670: 6363 3a0a 2020 2020 2020 2020 2020 2020  cc:.            
-0004a680: 2020 2020 7769 7468 2063 6f64 6563 732e      with codecs.
-0004a690: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
-0004a6a0: 7220 2b20 7365 6c66 2e6d 6170 6e61 6d65  r + self.mapname
-0004a6b0: 202b 2027 5f72 6d6d 6363 7363 6f72 652e   + '_rmmccscore.
-0004a6c0: 6a73 6f6e 272c 2027 7727 2c20 656e 636f  json', 'w', enco
-0004a6d0: 6469 6e67 3d27 7574 662d 3827 2920 6173  ding='utf-8') as
-0004a6e0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
-0004a6f0: 2020 2020 2020 2020 6a73 6f6e 2e64 756d          json.dum
-0004a700: 7028 726d 6d63 6363 2c20 6629 0a20 2020  p(rmmccc, f).   
-0004a710: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0004a720: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0004a730: 7269 6e74 2827 4e6f 206d 6f64 656c 206d  rint('No model m
-0004a740: 6170 2043 4320 6973 2063 616c 6375 6c61  ap CC is calcula
-0004a750: 7465 642c 2063 6865 636b 2074 6865 2065  ted, check the e
-0004a760: 7272 6f72 2069 6e66 6f72 6d61 7469 6f6e  rror information
-0004a770: 2e27 290a 0a20 2020 2020 2020 2020 2020  .')..           
-0004a780: 2065 6e64 203d 2074 696d 6569 742e 6465   end = timeit.de
-0004a790: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
-0004a7a0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0004a7b0: 2752 6561 6c20 7370 6163 6520 6d6f 6465  'Real space mode
-0004a7c0: 6c20 616e 6420 6d61 7020 4372 6f73 732d  l and map Cross-
-0004a7d0: 436f 7272 656c 6174 696f 6e20 436f 6566  Correlation Coef
-0004a7e0: 6669 6369 656e 7420 7469 6d65 3a20 2573  ficient time: %s
-0004a7f0: 2720 2520 2865 6e64 202d 2073 7461 7274  ' % (end - start
-0004a800: 2929 0a20 2020 2020 2020 2020 2020 2070  )).            p
-0004a810: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
-0004a820: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a830: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020  ----------')..  
-0004a840: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0004a850: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
-0004a860: 6f20 6d6f 6465 6c20 6d61 7020 666f 7220  o model map for 
-0004a870: 6d6f 6465 6c20 616e 6420 6d61 7020 7265  model and map re
-0004a880: 616c 2073 7061 6365 2063 726f 7373 2d63  al space cross-c
-0004a890: 6f72 7265 6c61 7469 6f6e 2063 616c 6375  orrelation calcu
-0004a8a0: 6c61 7469 6f6e 2e27 290a 2020 2020 2020  lation.').      
-0004a8b0: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
-0004a8c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a8d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004a8e0: 2d27 290a 0a20 2020 2020 2020 2072 6574  -')..        ret
-0004a8f0: 7572 6e20 4e6f 6e65 0a0a 0a20 2020 2064  urn None...    d
-0004a900: 6566 2073 6d6f 635f 6261 7228 7365 6c66  ef smoc_bar(self
-0004a910: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0004a920: 2020 2020 2020 2073 6d6f 6320 6361 6c63         smoc calc
-0004a930: 7561 6c74 696f 6e20 616e 6420 6261 720a  ualtion and bar.
-0004a940: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0004a950: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-0004a960: 2e6f 6e6c 7962 6172 3a0a 2020 2020 2020  .onlybar:.      
-0004a970: 2020 2020 2020 7365 6c66 2e73 6d6f 6328        self.smoc(
-0004a980: 290a 2020 2020 2020 2020 7365 6c66 2e67  ).        self.g
-0004a990: 6574 5f62 6172 2873 636f 7265 5f74 7970  et_bar(score_typ
-0004a9a0: 653d 2773 6d6f 6327 290a 0a20 2020 2023  e='smoc')..    #
-0004a9b0: 2075 7365 206c 6174 6573 7420 5445 4d50   use latest TEMP
-0004a9c0: 7920 322e 3020 666f 7220 736d 6f63 2063  y 2.0 for smoc c
-0004a9d0: 616c 6375 6c61 7469 6f6e 0a20 2020 2064  alculation.    d
-0004a9e0: 6566 2073 6d6f 6328 7365 6c66 293a 0a20  ef smoc(self):. 
-0004a9f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0004aa00: 2020 2020 2020 2072 756e 2073 6d6f 630a         run smoc.
-0004aa10: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0004aa20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0004aa30: 2020 2020 2069 6620 7365 6c66 2e70 6c61       if self.pla
-0004aa40: 7466 6f72 6d20 3d3d 2027 656d 6462 2720  tform == 'emdb' 
-0004aa50: 616e 6420 7365 6c66 2e6d 6574 2021 3d20  and self.met != 
-0004aa60: 2774 6f6d 6f27 3a0a 2020 2020 2020 2020  'tomo':.        
-0004aa70: 2020 2020 7374 6172 7420 3d20 7469 6d65      start = time
-0004aa80: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
-0004aa90: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
-0004aaa0: 7272 6c69 7374 203d 205b 5d0a 2020 2020  rrlist = [].    
-0004aab0: 2020 2020 2020 2020 7265 7375 6c74 5f64          result_d
-0004aac0: 6963 7420 3d20 7b7d 0a20 2020 2020 2020  ict = {}.       
-0004aad0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0004aae0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0004aaf0: 662e 6d6f 6465 6c73 3a0a 2020 2020 2020  f.models:.      
-0004ab00: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0004ab10: 756e 7420 3d20 300a 2020 2020 2020 2020  unt = 0.        
-0004ab20: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-0004ab30: 6c5f 6469 6374 203d 207b 7d0a 2020 2020  l_dict = {}.    
-0004ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ab50: 6f75 745f 7061 7468 203d 2027 7b7d 2f73  out_path = '{}/s
-0004ab60: 6d6f 6327 2e66 6f72 6d61 7428 7365 6c66  moc'.format(self
-0004ab70: 2e77 6f72 6b64 6972 290a 2020 2020 2020  .workdir).      
-0004ab80: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0004ab90: 7220 6d6f 6465 6c20 696e 2073 656c 662e  r model in self.
-0004aba0: 6d6f 6465 6c73 3a0a 2020 2020 2020 2020  models:.        
-0004abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004abc0: 6675 6c6c 5f6d 6f64 656c 203d 2027 7b7d  full_model = '{}
-0004abd0: 7b7d 272e 666f 726d 6174 2873 656c 662e  {}'.format(self.
-0004abe0: 776f 726b 6469 722c 206f 732e 7061 7468  workdir, os.path
-0004abf0: 2e62 6173 656e 616d 6528 6d6f 6465 6c2e  .basename(model.
-0004ac00: 6669 6c65 6e61 6d65 2929 0a20 2020 2020  filename)).     
-0004ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac20: 2020 2066 756c 6c5f 6d61 7020 3d20 277b     full_map = '{
-0004ac30: 7d7b 7d27 2e66 6f72 6d61 7428 7365 6c66  }{}'.format(self
-0004ac40: 2e77 6f72 6b64 6972 2c20 7365 6c66 2e6d  .workdir, self.m
-0004ac50: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
-0004ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac70: 7265 7320 3d20 7365 6c66 2e72 6573 6f6c  res = self.resol
-0004ac80: 7574 696f 6e0a 0a20 2020 2020 2020 2020  ution..         
-0004ac90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004aca0: 6469 6374 2c20 7265 7272 203d 2072 756e  dict, rerr = run
-0004acb0: 5f73 6d6f 6328 6675 6c6c 5f6d 6f64 656c  _smoc(full_model
-0004acc0: 2c20 6675 6c6c 5f6d 6170 2c20 7265 732c  , full_map, res,
-0004acd0: 206f 7574 5f70 6174 6829 0a20 2020 2020   out_path).     
-0004ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004acf0: 2020 2069 6620 7264 6963 743a 0a0a 2020     if rdict:..  
+00049900: 206c 6962 5f72 6f6f 7420 3d20 4c49 425f   lib_root = LIB_
+00049910: 5354 5255 4445 4c5f 524f 4f54 0a20 2020  STRUDEL_ROOT.   
+00049920: 2020 2020 2020 2020 2065 6c69 6620 4c49           elif LI
+00049930: 425f 5354 5255 4445 4c5f 524f 4f54 2069  B_STRUDEL_ROOT i
+00049940: 7320 4e6f 6e65 2061 6e64 2073 656c 662e  s None and self.
+00049950: 7374 7275 6465 6c6c 6962 2069 7320 6e6f  strudellib is no
+00049960: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00049970: 2020 2020 2020 2020 6c69 625f 726f 6f74          lib_root
+00049980: 203d 2073 656c 662e 7374 7275 6465 6c6c   = self.strudell
+00049990: 6962 0a20 2020 2020 2020 2020 2020 2065  ib.            e
+000499a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000499b0: 2020 2020 206c 6962 5f72 6f6f 7420 3d20       lib_root = 
+000499c0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
+000499d0: 2020 2320 6966 2073 7472 7564 656c 6170    # if strudelap
+000499e0: 7020 616e 6420 7365 6c66 2e6d 6f64 656c  p and self.model
+000499f0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+00049a00: 6620 6669 6e61 6c5f 7261 6e67 6520 616e  f final_range an
+00049a10: 6420 7365 6c66 2e6d 6f64 656c 733a 0a20  d self.models:. 
+00049a20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00049a30: 6f72 206d 6f64 656c 2069 6e20 7365 6c66  or model in self
+00049a40: 2e6d 6f64 656c 733a 0a20 2020 2020 2020  .models:.       
+00049a50: 2020 2020 2020 2020 2020 2020 2066 756c               ful
+00049a60: 6c5f 6d6f 6465 6c20 3d20 277b 7d7b 7d27  l_model = '{}{}'
+00049a70: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
+00049a80: 6b64 6972 2c20 6f73 2e70 6174 682e 6261  kdir, os.path.ba
+00049a90: 7365 6e61 6d65 286d 6f64 656c 2e66 696c  sename(model.fil
+00049aa0: 656e 616d 6529 290a 2020 2020 2020 2020  ename)).        
+00049ab0: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
+00049ac0: 5f6d 6170 203d 2027 7b7d 7b7d 272e 666f  _map = '{}{}'.fo
+00049ad0: 726d 6174 2873 656c 662e 776f 726b 6469  rmat(self.workdi
+00049ae0: 722c 2073 656c 662e 6d61 706e 616d 6529  r, self.mapname)
+00049af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049b00: 2020 2020 206c 6962 5f70 6174 6820 3d20       lib_path = 
+00049b10: 277b 7d2f 6d6f 7469 6673 5f7b 7d2d 7b7d  '{}/motifs_{}-{}
+00049b20: 272e 666f 726d 6174 286c 6962 5f72 6f6f  '.format(lib_roo
+00049b30: 742c 2066 696e 616c 5f72 616e 6765 5b30  t, final_range[0
+00049b40: 5d2c 2066 696e 616c 5f72 616e 6765 5b31  ], final_range[1
+00049b50: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00049b60: 2020 2020 2020 206f 7574 5f70 6174 6820         out_path 
+00049b70: 3d20 277b 7d5f 7374 7275 6465 6c27 2e66  = '{}_strudel'.f
+00049b80: 6f72 6d61 7428 6675 6c6c 5f6d 6f64 656c  ormat(full_model
+00049b90: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00049ba0: 2020 2020 2020 2072 6572 7220 3d20 7275         rerr = ru
+00049bb0: 6e5f 7374 7275 6465 6c28 6675 6c6c 5f6d  n_strudel(full_m
+00049bc0: 6f64 656c 2c20 6675 6c6c 5f6d 6170 2c20  odel, full_map, 
+00049bd0: 6c69 625f 7061 7468 2c20 6f75 745f 7061  lib_path, out_pa
+00049be0: 7468 2c20 7365 6c66 2e70 6c61 7466 6f72  th, self.platfor
+00049bf0: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
+00049c00: 2020 2020 2020 2069 6620 7265 7272 3a0a         if rerr:.
+00049c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049c20: 2020 2020 2020 2020 6572 7220 3d20 2753          err = 'S
+00049c30: 7472 7564 656c 2063 616c 6375 6c61 7469  trudel calculati
+00049c40: 6f6e 2065 7272 6f72 3a20 7b7d 272e 666f  on error: {}'.fo
+00049c50: 726d 6174 2872 6572 7229 0a20 2020 2020  rmat(rerr).     
+00049c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049c70: 2020 2065 7272 6c69 7374 2e61 7070 656e     errlist.appen
+00049c80: 6428 6572 7229 0a20 2020 2020 2020 2020  d(err).         
+00049c90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00049ca0: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+00049cb0: 6572 7220 2b20 275c 6e27 290a 2020 2020  err + '\n').    
+00049cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049cd0: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+00049ce0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00049cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+00049d00: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00049d10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00049d20: 2020 2020 2070 7269 6e74 2827 4e6f 206d       print('No m
+00049d30: 6f64 656c 206f 7220 7265 736f 6c75 7469  odel or resoluti
+00049d40: 6f6e 2069 7320 6e6f 7420 636f 7665 7265  on is not covere
+00049d50: 6420 696e 2074 6865 206d 6f74 6966 206c  d in the motif l
+00049d60: 6962 7261 7279 2028 3c34 2e30 c385 2920  ibrary (<4.0..) 
+00049d70: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00049d80: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
+00049d90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00049da0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
+00049db0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00049dc0: 204e 6f6e 650a 0a0a 0a0a 2020 2020 6465   None.....    de
+00049dd0: 6620 7265 616c 5f6d 6d63 6328 7365 6c66  f real_mmcc(self
+00049de0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00049df0: 2020 2020 2020 2020 2020 2043 616c 6375             Calcu
+00049e00: 6c61 7469 6f6e 2072 6561 6c20 7370 6163  lation real spac
+00049e10: 6520 6372 6f73 732d 636f 7272 656c 6174  e cross-correlat
+00049e20: 696f 6e20 6265 7477 6565 6e20 7072 696d  ion between prim
+00049e30: 6172 7920 6d61 7020 616e 6420 6d6f 6465  ary map and mode
+00049e40: 6c2d 6d61 7020 2852 6566 6d61 6329 0a0a  l-map (Refmac)..
+00049e50: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00049e60: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00049e70: 2020 2020 2020 6966 2073 656c 662e 6d6f        if self.mo
+00049e80: 6465 6c73 6d61 7073 2061 6e64 2073 656c  delsmaps and sel
+00049e90: 662e 706c 6174 666f 726d 203d 3d20 2765  f.platform == 'e
+00049ea0: 6d64 6227 3a0a 2020 2020 2020 2020 2020  mdb':.          
+00049eb0: 2020 7374 6172 7420 3d20 7469 6d65 6974    start = timeit
+00049ec0: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
+00049ed0: 0a20 2020 2020 2020 2020 2020 2072 6d6d  .            rmm
+00049ee0: 6363 6320 3d20 7b7d 0a20 2020 2020 2020  ccc = {}.       
+00049ef0: 2020 2020 206d 6d63 635f 6469 6374 203d       mmcc_dict =
+00049f00: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
+00049f10: 6572 726c 6973 7420 3d20 5b5d 0a20 2020  errlist = [].   
+00049f20: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
+00049f30: 656c 6d61 7020 696e 2073 656c 662e 6d6f  elmap in self.mo
+00049f40: 6465 6c73 6d61 7073 3a0a 2020 2020 2020  delsmaps:.      
+00049f50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00049f60: 6d6f 6465 6c6d 6170 290a 2020 2020 2020  modelmap).      
+00049f70: 2020 2020 2020 2020 2020 6d6f 6465 6c6d            modelm
+00049f80: 6170 5f6e 616d 6520 3d20 6f73 2e70 6174  ap_name = os.pat
+00049f90: 682e 6261 7365 6e61 6d65 286d 6f64 656c  h.basename(model
+00049fa0: 6d61 7029 0a20 2020 2020 2020 2020 2020  map).           
+00049fb0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00049fc0: 2020 2020 2020 2020 2020 2020 2020 6d6d                mm
+00049fd0: 6170 203d 206d 7263 6669 6c65 2e6d 6d61  ap = mrcfile.mma
+00049fe0: 7028 6d6f 6465 6c6d 6170 2c20 6d6f 6465  p(modelmap, mode
+00049ff0: 3d27 7227 290a 2020 2020 2020 2020 2020  ='r').          
+0004a000: 2020 2020 2020 2020 2020 6d6d 6170 6461            mmapda
+0004a010: 7461 203d 206d 6d61 702e 6461 7461 0a20  ta = mmap.data. 
+0004a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a030: 2020 206d 6d63 6320 3d20 7275 6e5f 7265     mmcc = run_re
+0004a040: 616c 6d6d 6363 2873 656c 662e 6d61 702e  almmcc(self.map.
+0004a050: 6461 7461 2c20 6d6d 6170 6461 7461 295b  data, mmapdata)[
+0004a060: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+0004a070: 2020 2020 2020 206d 6d63 635f 6469 6374         mmcc_dict
+0004a080: 5b6d 6f64 656c 6d61 705f 6e61 6d65 5d20  [modelmap_name] 
+0004a090: 3d20 6d6d 6363 0a20 2020 2020 2020 2020  = mmcc.         
+0004a0a0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0004a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a0c0: 2020 2065 7272 203d 2027 4d61 7020 616e     err = 'Map an
+0004a0d0: 6420 6d6f 6465 6c20 7b7d 2072 6561 6c20  d model {} real 
+0004a0e0: 7370 6163 6520 4343 2063 616c 6375 6c61  space CC calcula
+0004a0f0: 7469 6f6e 2065 7272 6f72 3a20 7b7d 2e27  tion error: {}.'
+0004a100: 2e66 6f72 6d61 7428 6d6f 6465 6c6d 6170  .format(modelmap
+0004a110: 5f6e 616d 652c 2073 7973 2e65 7863 5f69  _name, sys.exc_i
+0004a120: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
+0004a130: 2020 2020 2020 2020 2020 2020 2020 6572                er
+0004a140: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
+0004a150: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004a160: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
+0004a170: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
+0004a180: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+0004a190: 6966 2065 7272 6c69 7374 3a0a 2020 2020  if errlist:.    
+0004a1a0: 2020 2020 2020 2020 2020 2020 726d 6d63              rmmc
+0004a1b0: 6363 5b27 6572 7227 5d20 3d20 7b27 726d  cc['err'] = {'rm
+0004a1c0: 6d63 6363 5f65 7272 273a 2065 7272 6c69  mccc_err': errli
+0004a1d0: 7374 7d0a 2020 2020 2020 2020 2020 2020  st}.            
+0004a1e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004a1f0: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
+0004a200: 6572 726f 7220 696e 2072 6d6d 6363 6320  error in rmmccc 
+0004a210: 6361 6c63 756c 6174 696f 6e2e 2729 0a0a  calculation.')..
+0004a220: 2020 2020 2020 2020 2020 2020 726d 6d63              rmmc
+0004a230: 6363 5b27 726d 6d63 6363 275d 203d 206d  cc['rmmccc'] = m
+0004a240: 6d63 635f 6469 6374 0a20 2020 2020 2020  mcc_dict.       
+0004a250: 2020 2020 2069 6620 726d 6d63 6363 3a0a       if rmmccc:.
+0004a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a270: 7769 7468 2063 6f64 6563 732e 6f70 656e  with codecs.open
+0004a280: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
+0004a290: 7365 6c66 2e6d 6170 6e61 6d65 202b 2027  self.mapname + '
+0004a2a0: 5f72 6d6d 6363 7363 6f72 652e 6a73 6f6e  _rmmccscore.json
+0004a2b0: 272c 2027 7727 2c20 656e 636f 6469 6e67  ', 'w', encoding
+0004a2c0: 3d27 7574 662d 3827 2920 6173 2066 3a0a  ='utf-8') as f:.
+0004a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a2e0: 2020 2020 6a73 6f6e 2e64 756d 7028 726d      json.dump(rm
+0004a2f0: 6d63 6363 2c20 6629 0a20 2020 2020 2020  mccc, f).       
+0004a300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004a310: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0004a320: 2827 4e6f 206d 6f64 656c 206d 6170 2043  ('No model map C
+0004a330: 4320 6973 2063 616c 6375 6c61 7465 642c  C is calculated,
+0004a340: 2063 6865 636b 2074 6865 2065 7272 6f72   check the error
+0004a350: 2069 6e66 6f72 6d61 7469 6f6e 2e27 290a   information.').
+0004a360: 0a20 2020 2020 2020 2020 2020 2065 6e64  .            end
+0004a370: 203d 2074 696d 6569 742e 6465 6661 756c   = timeit.defaul
+0004a380: 745f 7469 6d65 7228 290a 2020 2020 2020  t_timer().      
+0004a390: 2020 2020 2020 7072 696e 7428 2752 6561        print('Rea
+0004a3a0: 6c20 7370 6163 6520 6d6f 6465 6c20 616e  l space model an
+0004a3b0: 6420 6d61 7020 4372 6f73 732d 436f 7272  d map Cross-Corr
+0004a3c0: 656c 6174 696f 6e20 436f 6566 6669 6369  elation Coeffici
+0004a3d0: 656e 7420 7469 6d65 3a20 2573 2720 2520  ent time: %s' % 
+0004a3e0: 2865 6e64 202d 2073 7461 7274 2929 0a20  (end - start)). 
+0004a3f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0004a400: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
+0004a410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004a420: 2d2d 2d2d 2d2d 2729 0a0a 2020 2020 2020  ------')..      
+0004a430: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0004a440: 2020 2020 7072 696e 7428 274e 6f20 6d6f      print('No mo
+0004a450: 6465 6c20 6d61 7020 666f 7220 6d6f 6465  del map for mode
+0004a460: 6c20 616e 6420 6d61 7020 7265 616c 2073  l and map real s
+0004a470: 7061 6365 2063 726f 7373 2d63 6f72 7265  pace cross-corre
+0004a480: 6c61 7469 6f6e 2063 616c 6375 6c61 7469  lation calculati
+0004a490: 6f6e 2e27 290a 2020 2020 2020 2020 2020  on.').          
+0004a4a0: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
+0004a4b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004a4c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
+0004a4d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004a4e0: 4e6f 6e65 0a0a 0a20 2020 2064 6566 2073  None...    def s
+0004a4f0: 6d6f 635f 6261 7228 7365 6c66 293a 0a20  moc_bar(self):. 
+0004a500: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0004a510: 2020 2073 6d6f 6320 6361 6c63 7561 6c74     smoc calcualt
+0004a520: 696f 6e20 616e 6420 6261 720a 2020 2020  ion and bar.    
+0004a530: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0004a540: 2069 6620 6e6f 7420 7365 6c66 2e6f 6e6c   if not self.onl
+0004a550: 7962 6172 3a0a 2020 2020 2020 2020 2020  ybar:.          
+0004a560: 2020 7365 6c66 2e73 6d6f 6328 290a 2020    self.smoc().  
+0004a570: 2020 2020 2020 7365 6c66 2e67 6574 5f62        self.get_b
+0004a580: 6172 2873 636f 7265 5f74 7970 653d 2773  ar(score_type='s
+0004a590: 6d6f 6327 290a 0a20 2020 2023 2075 7365  moc')..    # use
+0004a5a0: 206c 6174 6573 7420 5445 4d50 7920 322e   latest TEMPy 2.
+0004a5b0: 3020 666f 7220 736d 6f63 2063 616c 6375  0 for smoc calcu
+0004a5c0: 6c61 7469 6f6e 0a20 2020 2064 6566 2073  lation.    def s
+0004a5d0: 6d6f 6328 7365 6c66 293a 0a20 2020 2020  moc(self):.     
+0004a5e0: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+0004a5f0: 2020 2072 756e 2073 6d6f 630a 2020 2020     run smoc.    
+0004a600: 2020 2020 3a72 6574 7572 6e3a 0a20 2020      :return:.   
+0004a610: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0004a620: 2069 6620 7365 6c66 2e70 6c61 7466 6f72   if self.platfor
+0004a630: 6d20 3d3d 2027 656d 6462 2720 616e 6420  m == 'emdb' and 
+0004a640: 7365 6c66 2e6d 6574 2021 3d20 2774 6f6d  self.met != 'tom
+0004a650: 6f27 3a0a 2020 2020 2020 2020 2020 2020  o':.            
+0004a660: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+0004a670: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+0004a680: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+0004a690: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+0004a6a0: 2020 2020 7265 7375 6c74 5f64 6963 7420      result_dict 
+0004a6b0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0004a6c0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0004a6d0: 2020 2020 2020 6966 2073 656c 662e 6d6f        if self.mo
+0004a6e0: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
+0004a6f0: 2020 2020 2020 2020 2020 636f 756e 7420            count 
+0004a700: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+0004a710: 2020 2020 2020 2020 6669 6e61 6c5f 6469          final_di
+0004a720: 6374 203d 207b 7d0a 2020 2020 2020 2020  ct = {}.        
+0004a730: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0004a740: 7061 7468 203d 2027 7b7d 2f73 6d6f 6327  path = '{}/smoc'
+0004a750: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
+0004a760: 6b64 6972 290a 2020 2020 2020 2020 2020  kdir).          
+0004a770: 2020 2020 2020 2020 2020 666f 7220 6d6f            for mo
+0004a780: 6465 6c20 696e 2073 656c 662e 6d6f 6465  del in self.mode
+0004a790: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
+0004a7a0: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
+0004a7b0: 5f6d 6f64 656c 203d 2027 7b7d 7b7d 272e  _model = '{}{}'.
+0004a7c0: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
+0004a7d0: 6469 722c 206f 732e 7061 7468 2e62 6173  dir, os.path.bas
+0004a7e0: 656e 616d 6528 6d6f 6465 6c2e 6669 6c65  ename(model.file
+0004a7f0: 6e61 6d65 2929 0a20 2020 2020 2020 2020  name)).         
+0004a800: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004a810: 756c 6c5f 6d61 7020 3d20 277b 7d7b 7d27  ull_map = '{}{}'
+0004a820: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
+0004a830: 6b64 6972 2c20 7365 6c66 2e6d 6170 6e61  kdir, self.mapna
+0004a840: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0004a850: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+0004a860: 3d20 7365 6c66 2e72 6573 6f6c 7574 696f  = self.resolutio
+0004a870: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+0004a880: 2020 2020 2020 2020 2020 2072 6469 6374             rdict
+0004a890: 2c20 7265 7272 203d 2072 756e 5f73 6d6f  , rerr = run_smo
+0004a8a0: 6328 6675 6c6c 5f6d 6f64 656c 2c20 6675  c(full_model, fu
+0004a8b0: 6c6c 5f6d 6170 2c20 7265 732c 206f 7574  ll_map, res, out
+0004a8c0: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
+0004a8d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004a8e0: 6620 7264 6963 743a 0a0a 2020 2020 2020  f rdict:..      
+0004a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a900: 2020 2020 2020 6669 6e61 6c5f 6469 6374        final_dict
+0004a910: 5b73 7472 2863 6f75 6e74 295d 203d 2072  [str(count)] = r
+0004a920: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
+0004a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a940: 2063 6f75 6e74 202b 3d20 310a 0a20 2020   count += 1..   
+0004a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a960: 2020 2020 2065 6e64 203d 2074 696d 6569       end = timei
+0004a970: 742e 6465 6661 756c 745f 7469 6d65 7228  t.default_timer(
+0004a980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004a990: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0004a9a0: 2753 4d4f 4320 7469 6d65 3a20 2573 2720  'SMOC time: %s' 
+0004a9b0: 2520 2865 6e64 202d 2073 7461 7274 2929  % (end - start))
+0004a9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a9d0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0004a9e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004a9f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004aa00: 2d2d 2d2d 2729 0a20 2020 2020 2020 2020  ----').         
+0004aa10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004aa20: 6620 7265 7272 3a0a 2020 2020 2020 2020  f rerr:.        
+0004aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aa40: 2020 2020 6572 7220 3d20 2753 4d4f 4320      err = 'SMOC 
+0004aa50: 6361 6c63 756c 6174 696f 6e20 6572 726f  calculation erro
+0004aa60: 723a 207b 7d27 2e66 6f72 6d61 7428 7265  r: {}'.format(re
+0004aa70: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
+0004aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aa90: 6572 726c 6973 742e 6170 7065 6e64 2865  errlist.append(e
+0004aaa0: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
+0004aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aac0: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+0004aad0: 2865 7272 202b 2027 5c6e 2729 0a20 2020  (err + '\n').   
+0004aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aaf0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0004ab00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004ab10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004ab20: 2d2d 2d2d 2729 0a0a 2020 2020 2020 2020  ----')..        
+0004ab30: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0004ab40: 696e 616c 5f64 6963 743a 0a20 2020 2020  inal_dict:.     
+0004ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ab60: 2020 2072 6573 756c 745f 6469 6374 5b27     result_dict['
+0004ab70: 736d 6f63 275d 203d 2066 696e 616c 5f64  smoc'] = final_d
+0004ab80: 6963 740a 0a20 2020 2020 2020 2020 2020  ict..           
+0004ab90: 2020 2020 2020 2020 2069 6620 6572 726c           if errl
+0004aba0: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+0004abb0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0004abc0: 756c 745f 6469 6374 5b27 6572 7227 5d20  ult_dict['err'] 
+0004abd0: 3d20 6572 726c 6973 740a 0a20 2020 2020  = errlist..     
+0004abe0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004abf0: 6620 7265 7375 6c74 5f64 6963 743a 0a20  f result_dict:. 
+0004ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ac10: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0004ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ac30: 2020 2020 2020 2020 7769 7468 2063 6f64          with cod
+0004ac40: 6563 732e 6f70 656e 2873 656c 662e 776f  ecs.open(self.wo
+0004ac50: 726b 6469 7220 2b20 7365 6c66 2e6d 6170  rkdir + self.map
+0004ac60: 6e61 6d65 202b 2027 5f73 6d6f 632e 6a73  name + '_smoc.js
+0004ac70: 6f6e 272c 2027 7727 2c0a 2020 2020 2020  on', 'w',.      
+0004ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aca0: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+0004acb0: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
+0004acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004acd0: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+0004ace0: 736f 6e2e 6475 6d70 2872 6573 756c 745f  son.dump(result_
+0004acf0: 6469 6374 2c20 6629 0a0a 2020 2020 2020  dict, f)..      
 0004ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad10: 2020 2020 2020 2020 2020 6669 6e61 6c5f            final_
-0004ad20: 6469 6374 5b73 7472 2863 6f75 6e74 295d  dict[str(count)]
-0004ad30: 203d 2072 6469 6374 0a20 2020 2020 2020   = rdict.       
-0004ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad50: 2020 2020 2063 6f75 6e74 202b 3d20 310a       count += 1.
-0004ad60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ad70: 2020 2020 2020 2020 2065 6e64 203d 2074           end = t
-0004ad80: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
-0004ad90: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
-0004ada0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0004adb0: 696e 7428 2753 4d4f 4320 7469 6d65 3a20  int('SMOC time: 
-0004adc0: 2573 2720 2520 2865 6e64 202d 2073 7461  %s' % (end - sta
-0004add0: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
-0004ade0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0004adf0: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
-0004ae00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004ae10: 2d2d 2d2d 2d2d 2d2d 2729 0a20 2020 2020  --------').     
-0004ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae30: 2020 2069 6620 7265 7272 3a0a 2020 2020     if rerr:.    
-0004ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae50: 2020 2020 2020 2020 6572 7220 3d20 2753          err = 'S
-0004ae60: 4d4f 4320 6361 6c63 756c 6174 696f 6e20  MOC calculation 
-0004ae70: 6572 726f 723a 207b 7d27 2e66 6f72 6d61  error: {}'.forma
-0004ae80: 7428 7265 7272 290a 2020 2020 2020 2020  t(rerr).        
-0004ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aea0: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
-0004aeb0: 6e64 2865 7272 290a 2020 2020 2020 2020  nd(err).        
-0004aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aed0: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-0004aee0: 7269 7465 2865 7272 202b 2027 5c6e 2729  rite(err + '\n')
-0004aef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004af00: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0004af10: 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  nt('------------
-0004af20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004af30: 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020 2020  --------')..    
-0004af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af50: 6966 2066 696e 616c 5f64 6963 743a 0a20  if final_dict:. 
-0004af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af70: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
-0004af80: 6374 5b27 736d 6f63 275d 203d 2066 696e  ct['smoc'] = fin
-0004af90: 616c 5f64 6963 740a 0a20 2020 2020 2020  al_dict..       
-0004afa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004afb0: 6572 726c 6973 743a 0a20 2020 2020 2020  errlist:.       
-0004afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004afd0: 2072 6573 756c 745f 6469 6374 5b27 6572   result_dict['er
-0004afe0: 7227 5d20 3d20 6572 726c 6973 740a 0a20  r'] = errlist.. 
-0004aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b000: 2020 2069 6620 7265 7375 6c74 5f64 6963     if result_dic
-0004b010: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0004b020: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0004b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b040: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0004b050: 2063 6f64 6563 732e 6f70 656e 2873 656c   codecs.open(sel
-0004b060: 662e 776f 726b 6469 7220 2b20 7365 6c66  f.workdir + self
-0004b070: 2e6d 6170 6e61 6d65 202b 2027 5f73 6d6f  .mapname + '_smo
-0004b080: 632e 6a73 6f6e 272c 2027 7727 2c0a 2020  c.json', 'w',.  
-0004b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0b0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-0004b0c0: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
-0004b0d0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0004b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0f0: 2020 206a 736f 6e2e 6475 6d70 2872 6573     json.dump(res
-0004b100: 756c 745f 6469 6374 2c20 6629 0a0a 2020  ult_dict, f)..  
-0004b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b120: 2020 2020 2020 2020 2020 7769 7468 2063            with c
-0004b130: 6f64 6563 732e 6f70 656e 286f 7574 5f70  odecs.open(out_p
-0004b140: 6174 6820 2b20 272f 2720 2b20 7365 6c66  ath + '/' + self
-0004b150: 2e6d 6170 6e61 6d65 202b 2027 5f73 6d6f  .mapname + '_smo
-0004b160: 632e 6a73 6f6e 272c 2027 7727 2c20 656e  c.json', 'w', en
-0004b170: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
-0004b180: 6173 2066 663a 0a20 2020 2020 2020 2020  as ff:.         
-0004b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b1a0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
-0004b1b0: 2872 6573 756c 745f 6469 6374 2c20 6666  (result_dict, ff
-0004b1c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004b1d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004b1e0: 6c66 2e73 6d6f 635f 7375 7266 6163 6528  lf.smoc_surface(
-0004b1f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004b200: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0004b210: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004b220: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0004b230: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-0004b240: 5361 7669 6e67 2074 6f20 534d 4f43 206a  Saving to SMOC j
-0004b250: 736f 6e20 6572 726f 723a 207b 7d2e 5c6e  son error: {}.\n
-0004b260: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
-0004b270: 5f69 6e66 6f28 295b 315d 2929 0a20 2020  _info()[1])).   
-0004b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b290: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0004b2a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0004b2b0: 7269 6e74 2827 534d 4f43 2077 6173 206e  rint('SMOC was n
-0004b2c0: 6f74 2063 6f6c 6c65 6374 6564 2c20 706c  ot collected, pl
-0004b2d0: 6561 7365 2063 6865 636b 2127 290a 0a20  ease check!').. 
-0004b2e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004b2f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0004b300: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004b310: 4e6f 206d 6f64 656c 206f 7220 736f 6d65  No model or some
-0004b320: 7468 696e 6720 7772 6f6e 6720 7769 7468  thing wrong with
-0004b330: 206d 6f64 656c 206c 6f61 6469 6e67 2e27   model loading.'
-0004b340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004b350: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
-0004b360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004b370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004b380: 2d27 290a 2020 2020 2020 2020 2020 2020  -').            
-0004b390: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0004b3a0: 2020 2020 2020 2020 6572 7220 3d20 2753          err = 'S
-0004b3b0: 4d4f 4320 6361 6c63 756c 6174 696f 6e20  MOC calculation 
-0004b3c0: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
-0004b3d0: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-0004b3e0: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-0004b3f0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
-0004b400: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
-0004b410: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-0004b420: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
-0004b430: 2027 5c6e 2729 0a0a 0a20 2020 2020 2020   '\n')...       
-0004b440: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0004b450: 2020 2070 7269 6e74 2827 4368 6563 6b20     print('Check 
-0004b460: 7468 6520 656e 7472 792c 2074 6865 7265  the entry, there
-0004b470: 2069 7320 6e6f 2053 4d4f 4320 666f 7220   is no SMOC for 
-0004b480: 7468 6973 2065 6e74 7279 2e27 290a 0a20  this entry.').. 
-0004b490: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0004b4a0: 6e65 0a0a 2020 2020 6465 6620 6765 745f  ne..    def get_
-0004b4b0: 6261 7228 7365 6c66 2c20 7363 6f72 655f  bar(self, score_
-0004b4c0: 7479 7065 293a 0a0a 0a20 2020 2020 2020  type):...       
-0004b4d0: 2073 636f 7265 5f6c 6973 7420 3d20 5b27   score_list = ['
-0004b4e0: 6363 6327 2c20 2743 4343 272c 2027 6174  ccc', 'CCC', 'at
-0004b4f0: 6f6d 5f69 6e63 6c75 7369 6f6e 5f62 795f  om_inclusion_by_
-0004b500: 6c65 7665 6c27 2c20 2773 6d6f 6327 2c20  level', 'smoc', 
-0004b510: 2771 7363 6f72 6527 5d0a 2020 2020 2020  'qscore'].      
-0004b520: 2020 6669 6c65 5f6e 616d 6520 3d20 4e6f    file_name = No
-0004b530: 6e65 0a20 2020 2020 2020 2069 6620 7363  ne.        if sc
-0004b540: 6f72 655f 7479 7065 203d 3d20 2773 6d6f  ore_type == 'smo
-0004b550: 6327 3a0a 2020 2020 2020 2020 2020 2020  c':.            
-0004b560: 6669 6c65 5f6e 616d 6520 3d20 277b 7d2f  file_name = '{}/
-0004b570: 7b7d 5f7b 7d2e 6a73 6f6e 272e 666f 726d  {}_{}.json'.form
-0004b580: 6174 2873 656c 662e 776f 726b 6469 722c  at(self.workdir,
-0004b590: 2073 656c 662e 6d61 706e 616d 652c 2073   self.mapname, s
-0004b5a0: 636f 7265 5f74 7970 6529 0a20 2020 2020  core_type).     
-0004b5b0: 2020 2065 6c69 6620 7363 6f72 655f 7479     elif score_ty
-0004b5c0: 7065 203d 3d20 2763 6363 273a 0a20 2020  pe == 'ccc':.   
-0004b5d0: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
-0004b5e0: 6d65 203d 2027 7b7d 2f7b 7d5f 7265 737b  me = '{}/{}_res{
-0004b5f0: 7d2e 6a73 6f6e 272e 666f 726d 6174 2873  }.json'.format(s
-0004b600: 656c 662e 776f 726b 6469 722c 2073 656c  elf.workdir, sel
-0004b610: 662e 6d61 706e 616d 652c 2073 636f 7265  f.mapname, score
-0004b620: 5f74 7970 6529 0a20 2020 2020 2020 2065  _type).        e
-0004b630: 6c69 6620 7363 6f72 655f 7479 7065 203d  lif score_type =
-0004b640: 3d20 2771 7363 6f72 6527 3a0a 2020 2020  = 'qscore':.    
-0004b650: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-0004b660: 6520 3d20 277b 7d2f 7b7d 5f7b 7d2e 6a73  e = '{}/{}_{}.js
-0004b670: 6f6e 272e 666f 726d 6174 2873 656c 662e  on'.format(self.
-0004b680: 776f 726b 6469 722c 2073 656c 662e 6d61  workdir, self.ma
-0004b690: 706e 616d 652c 2073 636f 7265 5f74 7970  pname, score_typ
-0004b6a0: 6529 0a20 2020 2020 2020 2065 6c69 6620  e).        elif 
-0004b6b0: 7363 6f72 655f 7479 7065 203d 3d20 2761  score_type == 'a
-0004b6c0: 746f 6d5f 696e 636c 7573 696f 6e27 3a0a  tom_inclusion':.
-0004b6d0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0004b6e0: 5f6e 616d 6520 3d20 277b 7d2f 7b7d 5f7b  _name = '{}/{}_{
-0004b6f0: 7d2e 6a73 6f6e 272e 666f 726d 6174 2873  }.json'.format(s
-0004b700: 656c 662e 776f 726b 6469 722c 2073 656c  elf.workdir, sel
-0004b710: 662e 6d61 706e 616d 652c 2073 636f 7265  f.mapname, score
-0004b720: 5f74 7970 6529 0a0a 2020 2020 2020 2020  _type)..        
-0004b730: 6966 2066 696c 655f 6e61 6d65 2061 6e64  if file_name and
-0004b740: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-0004b750: 6669 6c65 5f6e 616d 6529 3a0a 2020 2020  file_name):.    
-0004b760: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-0004b770: 6e28 6669 6c65 5f6e 616d 652c 2027 7227  n(file_name, 'r'
-0004b780: 2920 6173 206a 736f 6e5f 6669 6c65 3a0a  ) as json_file:.
-0004b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b7a0: 6375 725f 6a73 6f6e 203d 206a 736f 6e2e  cur_json = json.
-0004b7b0: 6c6f 6164 286a 736f 6e5f 6669 6c65 290a  load(json_file).
-0004b7c0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0004b7d0: 6e79 2869 7465 6d20 696e 2063 7572 5f6a  ny(item in cur_j
-0004b7e0: 736f 6e20 666f 7220 6974 656d 2069 6e20  son for item in 
-0004b7f0: 7363 6f72 655f 6c69 7374 293a 0a20 2020  score_list):.   
-0004b800: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004b810: 7363 6f72 655f 7479 7065 203d 3d20 2761  score_type == 'a
-0004b820: 746f 6d5f 696e 636c 7573 696f 6e27 3a0a  tom_inclusion':.
-0004b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b840: 2020 2020 736d 6f63 5f64 6174 6120 3d20      smoc_data = 
-0004b850: 6375 725f 6a73 6f6e 5b66 277b 7363 6f72  cur_json[f'{scor
-0004b860: 655f 7479 7065 7d5f 6279 5f6c 6576 656c  e_type}_by_level
-0004b870: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0004b880: 2020 2065 6c69 6620 7363 6f72 655f 7479     elif score_ty
-0004b890: 7065 203d 3d20 2763 6363 273a 0a20 2020  pe == 'ccc':.   
-0004b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b8b0: 2069 6620 2763 6363 2720 696e 2063 7572   if 'ccc' in cur
-0004b8c0: 5f6a 736f 6e2e 6b65 7973 2829 3a0a 2020  _json.keys():.  
-0004b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b8e0: 2020 2020 2020 736d 6f63 5f64 6174 6120        smoc_data 
-0004b8f0: 3d20 6375 725f 6a73 6f6e 5b27 6363 6327  = cur_json['ccc'
-0004b900: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0004b910: 2020 2020 2020 656c 6966 2027 4343 4327        elif 'CCC'
-0004b920: 2069 6e20 6375 725f 6a73 6f6e 2e6b 6579   in cur_json.key
-0004b930: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0004b940: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
-0004b950: 635f 6461 7461 203d 2063 7572 5f6a 736f  c_data = cur_jso
-0004b960: 6e5b 2743 4343 275d 0a20 2020 2020 2020  n['CCC'].       
-0004b970: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0004b980: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0004b990: 2020 2020 2020 2020 2020 2073 6d6f 635f             smoc_
-0004b9a0: 6461 7461 203d 204e 6f6e 650a 2020 2020  data = None.    
-0004b9b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0004b9c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004b9d0: 2020 2020 2020 736d 6f63 5f64 6174 6120        smoc_data 
-0004b9e0: 3d20 6375 725f 6a73 6f6e 5b73 636f 7265  = cur_json[score
-0004b9f0: 5f74 7970 655d 0a20 2020 2020 2020 2020  _type].         
-0004ba00: 2020 2020 2020 2069 6620 7363 6f72 655f         if score_
-0004ba10: 7479 7065 203d 3d20 2761 746f 6d5f 696e  type == 'atom_in
-0004ba20: 636c 7573 696f 6e27 3a0a 2020 2020 2020  clusion':.      
-0004ba30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004ba40: 2027 6176 6572 6167 655f 6169 5f61 6c6c   'average_ai_all
-0004ba50: 6d6f 6465 6c73 2720 696e 2073 6d6f 635f  models' in smoc_
-0004ba60: 6461 7461 2e6b 6579 7328 293a 0a20 2020  data.keys():.   
+0004ad10: 2020 2020 2020 7769 7468 2063 6f64 6563        with codec
+0004ad20: 732e 6f70 656e 286f 7574 5f70 6174 6820  s.open(out_path 
+0004ad30: 2b20 272f 2720 2b20 7365 6c66 2e6d 6170  + '/' + self.map
+0004ad40: 6e61 6d65 202b 2027 5f73 6d6f 632e 6a73  name + '_smoc.js
+0004ad50: 6f6e 272c 2027 7727 2c20 656e 636f 6469  on', 'w', encodi
+0004ad60: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
+0004ad70: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0004ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ad90: 2020 206a 736f 6e2e 6475 6d70 2872 6573     json.dump(res
+0004ada0: 756c 745f 6469 6374 2c20 6666 290a 2020  ult_dict, ff).  
+0004adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004adc0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0004add0: 6d6f 635f 7375 7266 6163 6528 290a 2020  moc_surface().  
+0004ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004adf0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0004ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ae10: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+0004ae20: 6465 7272 2e77 7269 7465 2827 5361 7669  derr.write('Savi
+0004ae30: 6e67 2074 6f20 534d 4f43 206a 736f 6e20  ng to SMOC json 
+0004ae40: 6572 726f 723a 207b 7d2e 5c6e 272e 666f  error: {}.\n'.fo
+0004ae50: 726d 6174 2873 7973 2e65 7863 5f69 6e66  rmat(sys.exc_inf
+0004ae60: 6f28 295b 315d 2929 0a20 2020 2020 2020  o()[1])).       
+0004ae70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0004ae80: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0004ae90: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0004aea0: 2827 534d 4f43 2077 6173 206e 6f74 2063  ('SMOC was not c
+0004aeb0: 6f6c 6c65 6374 6564 2c20 706c 6561 7365  ollected, please
+0004aec0: 2063 6865 636b 2127 290a 0a20 2020 2020   check!')..     
+0004aed0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0004aee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004aef0: 2020 2020 2070 7269 6e74 2827 4e6f 206d       print('No m
+0004af00: 6f64 656c 206f 7220 736f 6d65 7468 696e  odel or somethin
+0004af10: 6720 7772 6f6e 6720 7769 7468 206d 6f64  g wrong with mod
+0004af20: 656c 206c 6f61 6469 6e67 2e27 290a 2020  el loading.').  
+0004af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004af40: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
+0004af50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004af60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
+0004af70: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0004af80: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0004af90: 2020 2020 6572 7220 3d20 2753 4d4f 4320      err = 'SMOC 
+0004afa0: 6361 6c63 756c 6174 696f 6e20 6572 726f  calculation erro
+0004afb0: 723a 207b 7d2e 272e 666f 726d 6174 2873  r: {}.'.format(s
+0004afc0: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+0004afd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004afe0: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
+0004aff0: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
+0004b000: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
+0004b010: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
+0004b020: 2729 0a0a 0a20 2020 2020 2020 2065 6c73  ')...        els
+0004b030: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0004b040: 7269 6e74 2827 4368 6563 6b20 7468 6520  rint('Check the 
+0004b050: 656e 7472 792c 2074 6865 7265 2069 7320  entry, there is 
+0004b060: 6e6f 2053 4d4f 4320 666f 7220 7468 6973  no SMOC for this
+0004b070: 2065 6e74 7279 2e27 290a 0a20 2020 2020   entry.')..     
+0004b080: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+0004b090: 2020 2020 6465 6620 6765 745f 6261 7228      def get_bar(
+0004b0a0: 7365 6c66 2c20 7363 6f72 655f 7479 7065  self, score_type
+0004b0b0: 293a 0a0a 0a20 2020 2020 2020 2073 636f  ):...        sco
+0004b0c0: 7265 5f6c 6973 7420 3d20 5b27 6363 6327  re_list = ['ccc'
+0004b0d0: 2c20 2743 4343 272c 2027 6174 6f6d 5f69  , 'CCC', 'atom_i
+0004b0e0: 6e63 6c75 7369 6f6e 5f62 795f 6c65 7665  nclusion_by_leve
+0004b0f0: 6c27 2c20 2773 6d6f 6327 2c20 2771 7363  l', 'smoc', 'qsc
+0004b100: 6f72 6527 5d0a 2020 2020 2020 2020 6669  ore'].        fi
+0004b110: 6c65 5f6e 616d 6520 3d20 4e6f 6e65 0a20  le_name = None. 
+0004b120: 2020 2020 2020 2069 6620 7363 6f72 655f         if score_
+0004b130: 7479 7065 203d 3d20 2773 6d6f 6327 3a0a  type == 'smoc':.
+0004b140: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0004b150: 5f6e 616d 6520 3d20 277b 7d2f 7b7d 5f7b  _name = '{}/{}_{
+0004b160: 7d2e 6a73 6f6e 272e 666f 726d 6174 2873  }.json'.format(s
+0004b170: 656c 662e 776f 726b 6469 722c 2073 656c  elf.workdir, sel
+0004b180: 662e 6d61 706e 616d 652c 2073 636f 7265  f.mapname, score
+0004b190: 5f74 7970 6529 0a20 2020 2020 2020 2065  _type).        e
+0004b1a0: 6c69 6620 7363 6f72 655f 7479 7065 203d  lif score_type =
+0004b1b0: 3d20 2763 6363 273a 0a20 2020 2020 2020  = 'ccc':.       
+0004b1c0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+0004b1d0: 2027 7b7d 2f7b 7d5f 7265 737b 7d2e 6a73   '{}/{}_res{}.js
+0004b1e0: 6f6e 272e 666f 726d 6174 2873 656c 662e  on'.format(self.
+0004b1f0: 776f 726b 6469 722c 2073 656c 662e 6d61  workdir, self.ma
+0004b200: 706e 616d 652c 2073 636f 7265 5f74 7970  pname, score_typ
+0004b210: 6529 0a20 2020 2020 2020 2065 6c69 6620  e).        elif 
+0004b220: 7363 6f72 655f 7479 7065 203d 3d20 2771  score_type == 'q
+0004b230: 7363 6f72 6527 3a0a 2020 2020 2020 2020  score':.        
+0004b240: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+0004b250: 277b 7d2f 7b7d 5f7b 7d2e 6a73 6f6e 272e  '{}/{}_{}.json'.
+0004b260: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
+0004b270: 6469 722c 2073 656c 662e 6d61 706e 616d  dir, self.mapnam
+0004b280: 652c 2073 636f 7265 5f74 7970 6529 0a20  e, score_type). 
+0004b290: 2020 2020 2020 2065 6c69 6620 7363 6f72         elif scor
+0004b2a0: 655f 7479 7065 203d 3d20 2761 746f 6d5f  e_type == 'atom_
+0004b2b0: 696e 636c 7573 696f 6e27 3a0a 2020 2020  inclusion':.    
+0004b2c0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+0004b2d0: 6520 3d20 277b 7d2f 7b7d 5f7b 7d2e 6a73  e = '{}/{}_{}.js
+0004b2e0: 6f6e 272e 666f 726d 6174 2873 656c 662e  on'.format(self.
+0004b2f0: 776f 726b 6469 722c 2073 656c 662e 6d61  workdir, self.ma
+0004b300: 706e 616d 652c 2073 636f 7265 5f74 7970  pname, score_typ
+0004b310: 6529 0a0a 2020 2020 2020 2020 6966 2066  e)..        if f
+0004b320: 696c 655f 6e61 6d65 2061 6e64 206f 732e  ile_name and os.
+0004b330: 7061 7468 2e69 7366 696c 6528 6669 6c65  path.isfile(file
+0004b340: 5f6e 616d 6529 3a0a 2020 2020 2020 2020  _name):.        
+0004b350: 2020 2020 7769 7468 206f 7065 6e28 6669      with open(fi
+0004b360: 6c65 5f6e 616d 652c 2027 7227 2920 6173  le_name, 'r') as
+0004b370: 206a 736f 6e5f 6669 6c65 3a0a 2020 2020   json_file:.    
+0004b380: 2020 2020 2020 2020 2020 2020 6375 725f              cur_
+0004b390: 6a73 6f6e 203d 206a 736f 6e2e 6c6f 6164  json = json.load
+0004b3a0: 286a 736f 6e5f 6669 6c65 290a 2020 2020  (json_file).    
+0004b3b0: 2020 2020 2020 2020 6966 2061 6e79 2869          if any(i
+0004b3c0: 7465 6d20 696e 2063 7572 5f6a 736f 6e20  tem in cur_json 
+0004b3d0: 666f 7220 6974 656d 2069 6e20 7363 6f72  for item in scor
+0004b3e0: 655f 6c69 7374 293a 0a20 2020 2020 2020  e_list):.       
+0004b3f0: 2020 2020 2020 2020 2069 6620 7363 6f72           if scor
+0004b400: 655f 7479 7065 203d 3d20 2761 746f 6d5f  e_type == 'atom_
+0004b410: 696e 636c 7573 696f 6e27 3a0a 2020 2020  inclusion':.    
+0004b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b430: 736d 6f63 5f64 6174 6120 3d20 6375 725f  smoc_data = cur_
+0004b440: 6a73 6f6e 5b66 277b 7363 6f72 655f 7479  json[f'{score_ty
+0004b450: 7065 7d5f 6279 5f6c 6576 656c 275d 0a20  pe}_by_level']. 
+0004b460: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004b470: 6c69 6620 7363 6f72 655f 7479 7065 203d  lif score_type =
+0004b480: 3d20 2763 6363 273a 0a20 2020 2020 2020  = 'ccc':.       
+0004b490: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004b4a0: 2763 6363 2720 696e 2063 7572 5f6a 736f  'ccc' in cur_jso
+0004b4b0: 6e2e 6b65 7973 2829 3a0a 2020 2020 2020  n.keys():.      
+0004b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4d0: 2020 736d 6f63 5f64 6174 6120 3d20 6375    smoc_data = cu
+0004b4e0: 725f 6a73 6f6e 5b27 6363 6327 5d0a 2020  r_json['ccc'].  
+0004b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b500: 2020 656c 6966 2027 4343 4327 2069 6e20    elif 'CCC' in 
+0004b510: 6375 725f 6a73 6f6e 2e6b 6579 7328 293a  cur_json.keys():
+0004b520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b530: 2020 2020 2020 2020 2073 6d6f 635f 6461           smoc_da
+0004b540: 7461 203d 2063 7572 5f6a 736f 6e5b 2743  ta = cur_json['C
+0004b550: 4343 275d 0a20 2020 2020 2020 2020 2020  CC'].           
+0004b560: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0004b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b580: 2020 2020 2020 2073 6d6f 635f 6461 7461         smoc_data
+0004b590: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0004b5a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b5c0: 2020 736d 6f63 5f64 6174 6120 3d20 6375    smoc_data = cu
+0004b5d0: 725f 6a73 6f6e 5b73 636f 7265 5f74 7970  r_json[score_typ
+0004b5e0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+0004b5f0: 2020 2069 6620 7363 6f72 655f 7479 7065     if score_type
+0004b600: 203d 3d20 2761 746f 6d5f 696e 636c 7573   == 'atom_inclus
+0004b610: 696f 6e27 3a0a 2020 2020 2020 2020 2020  ion':.          
+0004b620: 2020 2020 2020 2020 2020 6966 2027 6176            if 'av
+0004b630: 6572 6167 655f 6169 5f61 6c6c 6d6f 6465  erage_ai_allmode
+0004b640: 6c73 2720 696e 2073 6d6f 635f 6461 7461  ls' in smoc_data
+0004b650: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
+0004b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b670: 206d 6f64 656c 5f6e 756d 6265 7273 203d   model_numbers =
+0004b680: 206c 656e 2873 6d6f 635f 6461 7461 2920   len(smoc_data) 
+0004b690: 2d20 310a 2020 2020 2020 2020 2020 2020  - 1.            
+0004b6a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0004b6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b6c0: 2020 2020 2020 6d6f 6465 6c5f 6e75 6d62        model_numb
+0004b6d0: 6572 7320 3d20 6c65 6e28 736d 6f63 5f64  ers = len(smoc_d
+0004b6e0: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
+0004b6f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004b700: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0004b710: 6f64 656c 5f6e 756d 6265 7273 203d 206c  odel_numbers = l
+0004b720: 656e 2873 6d6f 635f 6461 7461 290a 2020  en(smoc_data).  
+0004b730: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0004b740: 6e61 6c5f 6469 6374 203d 207b 7d0a 2020  nal_dict = {}.  
+0004b750: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0004b760: 7461 203d 207b 7d0a 2020 2020 2020 2020  ta = {}.        
+0004b770: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0004b780: 2072 616e 6765 2830 2c20 6d6f 6465 6c5f   range(0, model_
+0004b790: 6e75 6d62 6572 7329 3a0a 2020 2020 2020  numbers):.      
+0004b7a0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0004b7b0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0004b7c0: 2020 2020 2020 2020 2020 2063 7572 5f73             cur_s
+0004b7d0: 6d6f 635f 6461 7461 203d 2073 6d6f 635f  moc_data = smoc_
+0004b7e0: 6461 7461 5b73 7472 2869 295d 0a20 2020  data[str(i)].   
+0004b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b800: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+0004b810: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004b820: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0004b830: 6627 4b65 793a 207b 697d 3a20 7b6c 6973  f'Key: {i}: {lis
+0004b840: 7428 736d 6f63 5f64 6174 612e 6b65 7973  t(smoc_data.keys
+0004b850: 2829 295b 695d 7d20 736b 6970 7065 642e  ())[i]} skipped.
+0004b860: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0004b870: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0004b880: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0004b890: 2020 2020 2020 2020 6d6f 6465 6c5f 6e61          model_na
+0004b8a0: 6d65 203d 2063 7572 5f73 6d6f 635f 6461  me = cur_smoc_da
+0004b8b0: 7461 5b27 6e61 6d65 275d 0a20 2020 2020  ta['name'].     
+0004b8c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004b8d0: 6620 7363 6f72 655f 7479 7065 203d 3d20  f score_type == 
+0004b8e0: 2763 6363 273a 0a20 2020 2020 2020 2020  'ccc':.         
+0004b8f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0004b900: 6577 5f64 6963 7420 3d20 7b27 6964 273a  ew_dict = {'id':
+0004b910: 2073 656c 662e 656d 6469 642c 2027 7265   self.emdid, 're
+0004b920: 736f 6c75 7469 6f6e 273a 2066 6c6f 6174  solution': float
+0004b930: 2873 656c 662e 7265 736f 6c75 7469 6f6e  (self.resolution
+0004b940: 292c 2027 6e61 6d65 273a 206d 6f64 656c  ), 'name': model
+0004b950: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+0004b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b970: 2020 2020 2020 2020 2020 2073 636f 7265             score
+0004b980: 5f74 7970 653a 2072 6f75 6e64 2863 7572  _type: round(cur
+0004b990: 5f73 6d6f 635f 6461 7461 5b27 6461 7461  _smoc_data['data
+0004b9a0: 275d 5b27 6176 6572 6167 6563 6327 5d2c  ']['averagecc'],
+0004b9b0: 2033 297d 0a20 2020 2020 2020 2020 2020   3)}.           
+0004b9c0: 2020 2020 2020 2020 2065 6c69 6620 7363           elif sc
+0004b9d0: 6f72 655f 7479 7065 203d 3d20 2761 746f  ore_type == 'ato
+0004b9e0: 6d5f 696e 636c 7573 696f 6e27 3a0a 2020  m_inclusion':.  
+0004b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ba00: 2020 2020 2020 6e65 775f 6469 6374 203d        new_dict =
+0004ba10: 207b 2769 6427 3a20 7365 6c66 2e65 6d64   {'id': self.emd
+0004ba20: 6964 2c20 2772 6573 6f6c 7574 696f 6e27  id, 'resolution'
+0004ba30: 3a20 666c 6f61 7428 7365 6c66 2e72 6573  : float(self.res
+0004ba40: 6f6c 7574 696f 6e29 2c20 276e 616d 6527  olution), 'name'
+0004ba50: 3a20 6d6f 6465 6c5f 6e61 6d65 2c0a 2020  : model_name,.  
+0004ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba80: 2020 2020 206d 6f64 656c 5f6e 756d 6265       model_numbe
-0004ba90: 7273 203d 206c 656e 2873 6d6f 635f 6461  rs = len(smoc_da
-0004baa0: 7461 2920 2d20 310a 2020 2020 2020 2020  ta) - 1.        
-0004bab0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0004bac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004bad0: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
-0004bae0: 6e75 6d62 6572 7320 3d20 6c65 6e28 736d  numbers = len(sm
-0004baf0: 6f63 5f64 6174 6129 0a20 2020 2020 2020  oc_data).       
-0004bb00: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0004bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb20: 2020 206d 6f64 656c 5f6e 756d 6265 7273     model_numbers
-0004bb30: 203d 206c 656e 2873 6d6f 635f 6461 7461   = len(smoc_data
-0004bb40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004bb50: 2020 6669 6e61 6c5f 6469 6374 203d 207b    final_dict = {
-0004bb60: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0004bb70: 2020 6461 7461 203d 207b 7d0a 2020 2020    data = {}.    
-0004bb80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0004bb90: 6920 696e 2072 616e 6765 2830 2c20 6d6f  i in range(0, mo
-0004bba0: 6465 6c5f 6e75 6d62 6572 7329 3a0a 2020  del_numbers):.  
-0004bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bbc0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0004bbd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004bbe0: 7572 5f73 6d6f 635f 6461 7461 203d 2073  ur_smoc_data = s
-0004bbf0: 6d6f 635f 6461 7461 5b73 7472 2869 295d  moc_data[str(i)]
-0004bc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bc10: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-0004bc20: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0004bc30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0004bc40: 696e 7428 6627 4b65 793a 207b 697d 3a20  int(f'Key: {i}: 
-0004bc50: 7b6c 6973 7428 736d 6f63 5f64 6174 612e  {list(smoc_data.
-0004bc60: 6b65 7973 2829 295b 695d 7d20 736b 6970  keys())[i]} skip
-0004bc70: 7065 642e 2729 0a20 2020 2020 2020 2020  ped.').         
-0004bc80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004bc90: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0004bca0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0004bcb0: 6c5f 6e61 6d65 203d 2063 7572 5f73 6d6f  l_name = cur_smo
-0004bcc0: 635f 6461 7461 5b27 6e61 6d65 275d 0a20  c_data['name']. 
-0004bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bce0: 2020 2069 6620 7363 6f72 655f 7479 7065     if score_type
-0004bcf0: 203d 3d20 2763 6363 273a 0a20 2020 2020   == 'ccc':.     
-0004bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd10: 2020 206e 6577 5f64 6963 7420 3d20 7b27     new_dict = {'
-0004bd20: 6964 273a 2073 656c 662e 656d 6469 642c  id': self.emdid,
-0004bd30: 2027 7265 736f 6c75 7469 6f6e 273a 2066   'resolution': f
-0004bd40: 6c6f 6174 2873 656c 662e 7265 736f 6c75  loat(self.resolu
-0004bd50: 7469 6f6e 292c 2027 6e61 6d65 273a 206d  tion), 'name': m
-0004bd60: 6f64 656c 5f6e 616d 652c 0a20 2020 2020  odel_name,.     
-0004bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004bd90: 636f 7265 5f74 7970 653a 2072 6f75 6e64  core_type: round
-0004bda0: 2863 7572 5f73 6d6f 635f 6461 7461 5b27  (cur_smoc_data['
-0004bdb0: 6461 7461 275d 5b27 6176 6572 6167 6563  data']['averagec
-0004bdc0: 6327 5d2c 2033 297d 0a20 2020 2020 2020  c'], 3)}.       
-0004bdd0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0004bde0: 6620 7363 6f72 655f 7479 7065 203d 3d20  f score_type == 
-0004bdf0: 2761 746f 6d5f 696e 636c 7573 696f 6e27  'atom_inclusion'
-0004be00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004be10: 2020 2020 2020 2020 2020 6e65 775f 6469            new_di
-0004be20: 6374 203d 207b 2769 6427 3a20 7365 6c66  ct = {'id': self
-0004be30: 2e65 6d64 6964 2c20 2772 6573 6f6c 7574  .emdid, 'resolut
-0004be40: 696f 6e27 3a20 666c 6f61 7428 7365 6c66  ion': float(self
-0004be50: 2e72 6573 6f6c 7574 696f 6e29 2c20 276e  .resolution), 'n
-0004be60: 616d 6527 3a20 6d6f 6465 6c5f 6e61 6d65  ame': model_name
-0004be70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0004be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004be90: 2020 2020 2020 2761 6927 3a20 726f 756e        'ai': roun
-0004bea0: 6428 6375 725f 736d 6f63 5f64 6174 615b  d(cur_smoc_data[
-0004beb0: 2761 7665 7261 6765 5f61 695f 6d6f 6465  'average_ai_mode
-0004bec0: 6c27 5d2c 2033 297d 0a20 2020 2020 2020  l'], 3)}.       
-0004bed0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0004bee0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0004bef0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-0004bf00: 6963 7420 3d20 7b27 6964 273a 2073 656c  ict = {'id': sel
-0004bf10: 662e 656d 6469 642c 2027 7265 736f 6c75  f.emdid, 'resolu
-0004bf20: 7469 6f6e 273a 2066 6c6f 6174 2873 656c  tion': float(sel
-0004bf30: 662e 7265 736f 6c75 7469 6f6e 292c 2027  f.resolution), '
-0004bf40: 6e61 6d65 273a 206d 6f64 656c 5f6e 616d  name': model_nam
-0004bf50: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0004bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf70: 2020 2020 2020 2073 636f 7265 5f74 7970         score_typ
-0004bf80: 653a 2072 6f75 6e64 2863 7572 5f73 6d6f  e: round(cur_smo
-0004bf90: 635f 6461 7461 5b27 6461 7461 275d 5b66  c_data['data'][f
-0004bfa0: 2761 7665 7261 6765 7b73 636f 7265 5f74  'average{score_t
-0004bfb0: 7970 657d 275d 2c20 3329 7d0a 2020 2020  ype}'], 3)}.    
-0004bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bfd0: 706c 6f74 5f6e 616d 6520 3d20 277b 7d5f  plot_name = '{}_
-0004bfe0: 7b7d 5f7b 7d5f 6261 722e 706e 6727 2e66  {}_{}_bar.png'.f
-0004bff0: 6f72 6d61 7428 7365 6c66 2e6d 6170 6e61  ormat(self.mapna
-0004c000: 6d65 2c20 6d6f 6465 6c5f 6e61 6d65 2c20  me, model_name, 
-0004c010: 7363 6f72 655f 7479 7065 290a 2020 2020  score_type).    
+0004ba80: 2020 2761 6927 3a20 726f 756e 6428 6375    'ai': round(cu
+0004ba90: 725f 736d 6f63 5f64 6174 615b 2761 7665  r_smoc_data['ave
+0004baa0: 7261 6765 5f61 695f 6d6f 6465 6c27 5d2c  rage_ai_model'],
+0004bab0: 2033 297d 0a20 2020 2020 2020 2020 2020   3)}.           
+0004bac0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0004bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bae0: 2020 2020 2020 206e 6577 5f64 6963 7420         new_dict 
+0004baf0: 3d20 7b27 6964 273a 2073 656c 662e 656d  = {'id': self.em
+0004bb00: 6469 642c 2027 7265 736f 6c75 7469 6f6e  did, 'resolution
+0004bb10: 273a 2066 6c6f 6174 2873 656c 662e 7265  ': float(self.re
+0004bb20: 736f 6c75 7469 6f6e 292c 2027 6e61 6d65  solution), 'name
+0004bb30: 273a 206d 6f64 656c 5f6e 616d 652c 0a20  ': model_name,. 
+0004bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb60: 2020 2073 636f 7265 5f74 7970 653a 2072     score_type: r
+0004bb70: 6f75 6e64 2863 7572 5f73 6d6f 635f 6461  ound(cur_smoc_da
+0004bb80: 7461 5b27 6461 7461 275d 5b66 2761 7665  ta['data'][f'ave
+0004bb90: 7261 6765 7b73 636f 7265 5f74 7970 657d  rage{score_type}
+0004bba0: 275d 2c20 3329 7d0a 2020 2020 2020 2020  '], 3)}.        
+0004bbb0: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
+0004bbc0: 5f6e 616d 6520 3d20 277b 7d5f 7b7d 5f7b  _name = '{}_{}_{
+0004bbd0: 7d5f 6261 722e 706e 6727 2e66 6f72 6d61  }_bar.png'.forma
+0004bbe0: 7428 7365 6c66 2e6d 6170 6e61 6d65 2c20  t(self.mapname, 
+0004bbf0: 6d6f 6465 6c5f 6e61 6d65 2c20 7363 6f72  model_name, scor
+0004bc00: 655f 7479 7065 290a 2020 2020 2020 2020  e_type).        
+0004bc10: 2020 2020 2020 2020 2020 2020 7363 6f72              scor
+0004bc20: 655f 6469 7220 3d20 6f73 2e70 6174 682e  e_dir = os.path.
+0004bc30: 6469 726e 616d 6528 7661 2e5f 5f66 696c  dirname(va.__fil
+0004bc40: 655f 5f29 0a20 2020 2020 2020 2020 2020  e__).           
+0004bc50: 2020 2020 2020 2020 2069 6620 7363 6f72           if scor
+0004bc60: 655f 7479 7065 203d 3d20 2761 746f 6d5f  e_type == 'atom_
+0004bc70: 696e 636c 7573 696f 6e27 3a0a 2020 2020  inclusion':.    
+0004bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc90: 2020 2020 7265 6c61 7469 7665 5f74 6f77      relative_tow
+0004bca0: 686f 6c65 2c20 7265 6c61 7469 7665 5f74  hole, relative_t
+0004bcb0: 6f74 776f 203d 2062 6172 286e 6577 5f64  otwo = bar(new_d
+0004bcc0: 6963 742c 2027 6169 272c 2073 656c 662e  ict, 'ai', self.
+0004bcd0: 776f 726b 6469 722c 2073 636f 7265 5f64  workdir, score_d
+0004bce0: 6972 2c20 706c 6f74 5f6e 616d 6529 0a20  ir, plot_name). 
+0004bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bd00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bd20: 2072 656c 6174 6976 655f 746f 7768 6f6c   relative_towhol
+0004bd30: 652c 2072 656c 6174 6976 655f 746f 7477  e, relative_totw
+0004bd40: 6f20 3d20 6261 7228 6e65 775f 6469 6374  o = bar(new_dict
+0004bd50: 2c20 7363 6f72 655f 7479 7065 2c20 7365  , score_type, se
+0004bd60: 6c66 2e77 6f72 6b64 6972 2c20 7363 6f72  lf.workdir, scor
+0004bd70: 655f 6469 722c 2070 6c6f 745f 6e61 6d65  e_dir, plot_name
+0004bd80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004bd90: 2020 2020 2020 736d 6f63 5f62 6172 203d        smoc_bar =
+0004bda0: 207b 2777 686f 6c65 273a 2072 656c 6174   {'whole': relat
+0004bdb0: 6976 655f 746f 7768 6f6c 652c 2027 7265  ive_towhole, 're
+0004bdc0: 6c61 7469 7665 273a 2072 656c 6174 6976  lative': relativ
+0004bdd0: 655f 746f 7477 6f7d 0a20 2020 2020 2020  e_totwo}.       
+0004bde0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004bdf0: 7363 6f72 655f 7479 7065 203d 3d20 2761  score_type == 'a
+0004be00: 746f 6d5f 696e 636c 7573 696f 6e27 3a0a  tom_inclusion':.
+0004be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be20: 2020 2020 2020 2020 6461 7461 5b73 7472          data[str
+0004be30: 2869 295d 203d 207b 276e 616d 6527 3a20  (i)] = {'name': 
+0004be40: 6d6f 6465 6c5f 6e61 6d65 7d0a 2020 2020  model_name}.    
+0004be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be60: 2020 2020 6461 7461 5b73 7472 2869 295d      data[str(i)]
+0004be70: 203d 207b 2761 695f 6261 7227 3a20 736d   = {'ai_bar': sm
+0004be80: 6f63 5f62 6172 7d0a 2020 2020 2020 2020  oc_bar}.        
+0004be90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004bea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004beb0: 2020 2020 2020 2020 2020 6461 7461 5b73            data[s
+0004bec0: 7472 2869 295d 203d 207b 276e 616d 6527  tr(i)] = {'name'
+0004bed0: 3a20 6d6f 6465 6c5f 6e61 6d65 7d0a 2020  : model_name}.  
+0004bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bef0: 2020 2020 2020 6461 7461 5b73 7472 2869        data[str(i
+0004bf00: 295d 203d 207b 2764 6174 6127 3a20 7b66  )] = {'data': {f
+0004bf10: 277b 7363 6f72 655f 7479 7065 7d5f 6261  '{score_type}_ba
+0004bf20: 7227 3a20 736d 6f63 5f62 6172 7d7d 0a20  r': smoc_bar}}. 
+0004bf30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004bf40: 6620 7363 6f72 655f 7479 7065 203d 3d20  f score_type == 
+0004bf50: 2761 746f 6d5f 696e 636c 7573 696f 6e27  'atom_inclusion'
+0004bf60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004bf70: 2020 2020 2020 6669 6e61 6c5f 6469 6374        final_dict
+0004bf80: 5b27 6174 6f6d 5f69 6e63 6c75 7369 6f6e  ['atom_inclusion
+0004bf90: 5f62 795f 6c65 7665 6c27 5d20 3d20 6461  _by_level'] = da
+0004bfa0: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
+0004bfb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004bfc0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+0004bfd0: 616c 5f64 6963 745b 7363 6f72 655f 7479  al_dict[score_ty
+0004bfe0: 7065 5d20 3d20 6461 7461 0a0a 2020 2020  pe] = data..    
+0004bff0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0004c000: 636f 7265 5f74 7970 6520 3d3d 2027 6174  core_type == 'at
+0004c010: 6f6d 5f69 6e63 6c75 7369 6f6e 273a 0a20  om_inclusion':. 
 0004c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c030: 7363 6f72 655f 6469 7220 3d20 6f73 2e70  score_dir = os.p
-0004c040: 6174 682e 6469 726e 616d 6528 7661 2e5f  ath.dirname(va._
-0004c050: 5f66 696c 655f 5f29 0a20 2020 2020 2020  _file__).       
-0004c060: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004c070: 7363 6f72 655f 7479 7065 203d 3d20 2761  score_type == 'a
-0004c080: 746f 6d5f 696e 636c 7573 696f 6e27 3a0a  tom_inclusion':.
-0004c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c0a0: 2020 2020 2020 2020 7265 6c61 7469 7665          relative
-0004c0b0: 5f74 6f77 686f 6c65 2c20 7265 6c61 7469  _towhole, relati
-0004c0c0: 7665 5f74 6f74 776f 203d 2062 6172 286e  ve_totwo = bar(n
-0004c0d0: 6577 5f64 6963 742c 2027 6169 272c 2073  ew_dict, 'ai', s
-0004c0e0: 656c 662e 776f 726b 6469 722c 2073 636f  elf.workdir, sco
-0004c0f0: 7265 5f64 6972 2c20 706c 6f74 5f6e 616d  re_dir, plot_nam
-0004c100: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0004c110: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c130: 2020 2020 2072 656c 6174 6976 655f 746f       relative_to
-0004c140: 7768 6f6c 652c 2072 656c 6174 6976 655f  whole, relative_
-0004c150: 746f 7477 6f20 3d20 6261 7228 6e65 775f  totwo = bar(new_
-0004c160: 6469 6374 2c20 7363 6f72 655f 7479 7065  dict, score_type
-0004c170: 2c20 7365 6c66 2e77 6f72 6b64 6972 2c20  , self.workdir, 
-0004c180: 7363 6f72 655f 6469 722c 2070 6c6f 745f  score_dir, plot_
-0004c190: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0004c1a0: 2020 2020 2020 2020 2020 736d 6f63 5f62            smoc_b
-0004c1b0: 6172 203d 207b 2777 686f 6c65 273a 2072  ar = {'whole': r
-0004c1c0: 656c 6174 6976 655f 746f 7768 6f6c 652c  elative_towhole,
-0004c1d0: 2027 7265 6c61 7469 7665 273a 2072 656c   'relative': rel
-0004c1e0: 6174 6976 655f 746f 7477 6f7d 0a20 2020  ative_totwo}.   
-0004c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c200: 2069 6620 7363 6f72 655f 7479 7065 203d   if score_type =
-0004c210: 3d20 2761 746f 6d5f 696e 636c 7573 696f  = 'atom_inclusio
-0004c220: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-0004c230: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0004c240: 5b73 7472 2869 295d 203d 207b 276e 616d  [str(i)] = {'nam
-0004c250: 6527 3a20 6d6f 6465 6c5f 6e61 6d65 7d0a  e': model_name}.
-0004c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c270: 2020 2020 2020 2020 6461 7461 5b73 7472          data[str
-0004c280: 2869 295d 203d 207b 2761 695f 6261 7227  (i)] = {'ai_bar'
-0004c290: 3a20 736d 6f63 5f62 6172 7d0a 2020 2020  : smoc_bar}.    
-0004c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c2b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004c2c0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0004c2d0: 7461 5b73 7472 2869 295d 203d 207b 276e  ta[str(i)] = {'n
-0004c2e0: 616d 6527 3a20 6d6f 6465 6c5f 6e61 6d65  ame': model_name
-0004c2f0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0004c300: 2020 2020 2020 2020 2020 6461 7461 5b73            data[s
-0004c310: 7472 2869 295d 203d 207b 2764 6174 6127  tr(i)] = {'data'
-0004c320: 3a20 7b66 277b 7363 6f72 655f 7479 7065  : {f'{score_type
-0004c330: 7d5f 6261 7227 3a20 736d 6f63 5f62 6172  }_bar': smoc_bar
-0004c340: 7d7d 0a20 2020 2020 2020 2020 2020 2020  }}.             
-0004c350: 2020 2069 6620 7363 6f72 655f 7479 7065     if score_type
-0004c360: 203d 3d20 2761 746f 6d5f 696e 636c 7573   == 'atom_inclus
-0004c370: 696f 6e27 3a0a 2020 2020 2020 2020 2020  ion':.          
-0004c380: 2020 2020 2020 2020 2020 6669 6e61 6c5f            final_
-0004c390: 6469 6374 5b27 6174 6f6d 5f69 6e63 6c75  dict['atom_inclu
-0004c3a0: 7369 6f6e 5f62 795f 6c65 7665 6c27 5d20  sion_by_level'] 
-0004c3b0: 3d20 6461 7461 0a20 2020 2020 2020 2020  = data.         
-0004c3c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c3e0: 2066 696e 616c 5f64 6963 745b 7363 6f72   final_dict[scor
-0004c3f0: 655f 7479 7065 5d20 3d20 6461 7461 0a0a  e_type] = data..
-0004c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c410: 6966 2073 636f 7265 5f74 7970 6520 3d3d  if score_type ==
-0004c420: 2027 6174 6f6d 5f69 6e63 6c75 7369 6f6e   'atom_inclusion
-0004c430: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-0004c440: 2020 2020 2020 2062 6172 5f6a 736f 6e20         bar_json 
-0004c450: 3d20 277b 7d2f 7b7d 5f61 6962 6172 2e6a  = '{}/{}_aibar.j
-0004c460: 736f 6e27 2e66 6f72 6d61 7428 7365 6c66  son'.format(self
-0004c470: 2e77 6f72 6b64 6972 2c20 7365 6c66 2e6d  .workdir, self.m
-0004c480: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
-0004c490: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0004c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c4b0: 2020 6261 725f 6a73 6f6e 203d 2027 7b7d    bar_json = '{}
-0004c4c0: 2f7b 7d5f 7b7d 6261 722e 6a73 6f6e 272e  /{}_{}bar.json'.
-0004c4d0: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
-0004c4e0: 6469 722c 2073 656c 662e 6d61 706e 616d  dir, self.mapnam
-0004c4f0: 652c 2073 636f 7265 5f74 7970 6529 0a20  e, score_type). 
-0004c500: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004c510: 6620 6669 6e61 6c5f 6469 6374 3a0a 2020  f final_dict:.  
-0004c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c530: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0004c540: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0004c550: 6974 6820 636f 6465 6373 2e6f 7065 6e28  ith codecs.open(
-0004c560: 6261 725f 6a73 6f6e 2c20 2777 272c 2065  bar_json, 'w', e
-0004c570: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
-0004c580: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-0004c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c5a0: 2020 206a 736f 6e2e 6475 6d70 2866 696e     json.dump(fin
-0004c5b0: 616c 5f64 6963 742c 2066 290a 0a20 2020  al_dict, f)..   
-0004c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c5d0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-0004c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c5f0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-0004c600: 6528 2753 6176 696e 6720 746f 2053 4d4f  e('Saving to SMO
-0004c610: 4320 6a73 6f6e 2065 7272 6f72 3a20 7b7d  C json error: {}
-0004c620: 2e5c 6e27 2e66 6f72 6d61 7428 7379 732e  .\n'.format(sys.
-0004c630: 6578 635f 696e 666f 2829 5b31 5d29 290a  exc_info()[1])).
-0004c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c650: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004c660: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0004c670: 2753 4d4f 4320 7761 7320 6e6f 7420 636f  'SMOC was not co
-0004c680: 6c6c 6563 7465 642c 2070 6c65 6173 6520  llected, please 
-0004c690: 6368 6563 6b21 2729 0a20 2020 2020 2020  check!').       
-0004c6a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0004c6b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0004c6c0: 2866 277b 7363 6f72 655f 7479 7065 7d20  (f'{score_type} 
-0004c6d0: 4a53 4f4e 2065 7869 7374 2062 7574 2063  JSON exist but c
-0004c6e0: 6f72 7265 7370 6f6e 6469 6e67 2073 636f  orresponding sco
-0004c6f0: 7265 2064 6f65 7320 6e6f 7420 6578 6973  re does not exis
-0004c700: 742e 2043 6865 636b 2074 6865 2065 7272  t. Check the err
-0004c710: 6f72 2e27 290a 2020 2020 2020 2020 656c  or.').        el
-0004c720: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0004c730: 7072 696e 7428 2753 4d4f 4320 4a53 4f4e  print('SMOC JSON
-0004c740: 2072 6573 756c 7473 2064 6f65 7320 6e6f   results does no
-0004c750: 7420 6578 6973 742e 2043 6865 636b 2053  t exist. Check S
-0004c760: 4d4f 4320 7275 6e2e 2729 0a0a 2020 2020  MOC run.')..    
-0004c770: 6465 6620 736d 6f63 5f76 6965 7728 7365  def smoc_view(se
-0004c780: 6c66 2c20 6368 696d 6572 6161 7070 293a  lf, chimeraapp):
-0004c790: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0004c7a0: 2020 2020 2020 2020 2020 582c 2059 2c20            X, Y, 
-0004c7b0: 5a20 696d 6167 6573 2077 6869 6368 206d  Z images which m
-0004c7c0: 6f64 656c 2077 6173 2063 6f6c 6f72 6564  odel was colored
-0004c7d0: 2062 7920 534d 4f43 0a0a 2020 2020 2020   by SMOC..      
-0004c7e0: 2020 3a72 6574 7572 6e3a 0a20 2020 2020    :return:.     
-0004c7f0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0004c800: 2320 7265 6164 206a 736f 6e0a 2020 2020  # read json.    
-0004c810: 2020 2020 7374 6172 7420 3d20 7469 6d65      start = time
-0004c820: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
-0004c830: 2829 0a20 2020 2020 2020 2069 6e6a 736f  ().        injso
-0004c840: 6e20 3d20 676c 6f62 2e67 6c6f 6228 7365  n = glob.glob(se
-0004c850: 6c66 2e77 6f72 6b64 6972 202b 2027 2a5f  lf.workdir + '*_
-0004c860: 736d 6f63 2e6a 736f 6e27 290a 2020 2020  smoc.json').    
-0004c870: 2020 2020 6261 7365 6469 7220 3d20 7365      basedir = se
-0004c880: 6c66 2e77 6f72 6b64 6972 0a20 2020 2020  lf.workdir.     
-0004c890: 2020 206d 6170 6e61 6d65 203d 2073 656c     mapname = sel
-0004c8a0: 662e 6d61 706e 616d 650a 2020 2020 2020  f.mapname.      
-0004c8b0: 2020 6c6f 6343 4849 4d45 5241 203d 2063    locCHIMERA = c
-0004c8c0: 6869 6d65 7261 6170 700a 2020 2020 2020  himeraapp.      
-0004c8d0: 2020 6269 6e64 6973 706c 6179 203d 206f    bindisplay = o
-0004c8e0: 732e 6765 7465 6e76 2827 4449 5350 4c41  s.getenv('DISPLA
-0004c8f0: 5927 290a 2020 2020 2020 2020 6572 726c  Y').        errl
-0004c900: 6973 7420 3d20 5b5d 0a0a 2020 2020 2020  ist = []..      
-0004c910: 2020 6675 6c69 6e6a 736f 6e20 3d20 696e    fulinjson = in
-0004c920: 6a73 6f6e 5b30 5d20 6966 2069 6e6a 736f  json[0] if injso
-0004c930: 6e20 656c 7365 204e 6f6e 650a 2020 2020  n else None.    
-0004c940: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0004c950: 2020 2020 2069 6620 6675 6c69 6e6a 736f       if fulinjso
-0004c960: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0004c970: 2020 2077 6974 6820 6f70 656e 2866 756c     with open(ful
-0004c980: 696e 6a73 6f6e 2c20 2772 2729 2061 7320  injson, 'r') as 
-0004c990: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0004c9a0: 2020 2020 2020 2061 7267 7320 3d20 6a73         args = js
-0004c9b0: 6f6e 2e6c 6f61 6428 6629 0a20 2020 2020  on.load(f).     
-0004c9c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004c9d0: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-0004c9e0: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
-0004c9f0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004ca00: 5468 6572 6520 6973 206e 6f20 534d 4f43  There is no SMOC
-0004ca10: 206a 736f 6e20 6669 6c65 2e27 290a 2020   json file.').  
-0004ca20: 2020 2020 2020 6578 6365 7074 2054 7970        except Typ
-0004ca30: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-0004ca40: 2020 2020 6572 7220 3d20 274f 7065 6e20      err = 'Open 
-0004ca50: 534d 4f43 204a 534f 4e20 6572 726f 723a  SMOC JSON error:
-0004ca60: 207b 7d2e 272e 666f 726d 6174 2873 7973   {}.'.format(sys
-0004ca70: 2e65 7863 5f69 6e66 6f28 295b 315d 290a  .exc_info()[1]).
-0004ca80: 2020 2020 2020 2020 2020 2020 6572 726c              errl
-0004ca90: 6973 742e 6170 7065 6e64 2865 7272 290a  ist.append(err).
-0004caa0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0004cab0: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
-0004cac0: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
-0004cad0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0004cae0: 2020 2069 6620 6172 6773 2069 7320 6e6f     if args is no
-0004caf0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0004cb00: 2020 2020 2020 2020 6d6f 6465 6c73 203d          models =
-0004cb10: 2061 7267 735b 2773 6d6f 6327 5d0a 2020   args['smoc'].  
-0004cb20: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0004cb30: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0004cb40: 2020 2020 2020 2064 656c 206d 6f64 656c         del model
-0004cb50: 735b 2765 7272 275d 0a20 2020 2020 2020  s['err'].       
-0004cb60: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-0004cb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004cb80: 2020 2020 2070 7269 6e74 2827 534d 4f43       print('SMOC
-0004cb90: 206a 736f 6e20 7265 7375 6c74 2069 7320   json result is 
-0004cba0: 636f 7272 6563 7427 290a 0a20 2020 2020  correct')..     
-0004cbb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0004cbc0: 2827 5468 6572 6520 6973 2f61 7265 2025  ('There is/are %
-0004cbd0: 7320 6d6f 6465 6c28 7329 2e27 2025 206c  s model(s).' % l
-0004cbe0: 656e 286d 6f64 656c 7329 290a 2020 2020  en(models)).    
-0004cbf0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0004cc00: 286b 6579 2c20 7661 6c75 6529 2069 6e20  (key, value) in 
-0004cc10: 6974 6572 6974 656d 7328 6d6f 6465 6c73  iteritems(models
-0004cc20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0004cc30: 2020 2020 2020 2023 2066 6f72 2028 6b65         # for (ke
-0004cc40: 7932 2c20 7661 6c75 6532 2920 696e 2069  y2, value2) in i
-0004cc50: 7465 7269 7465 6d73 2876 616c 7565 293a  teritems(value):
-0004cc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004cc70: 2020 2020 2069 6620 7479 7065 2876 616c       if type(val
-0004cc80: 7565 2920 6973 2066 6c6f 6174 3a0a 2020  ue) is float:.  
-0004cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cca0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0004ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ccc0: 2020 206b 6579 6c69 7374 203d 206c 6973     keylist = lis
-0004ccd0: 7428 7661 6c75 6529 0a20 2020 2020 2020  t(value).       
-0004cce0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0004ccf0: 206b 6579 2069 6e20 6b65 796c 6973 743a   key in keylist:
-0004cd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004cd10: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-0004cd20: 213d 2027 6e61 6d65 273a 0a20 2020 2020  != 'name':.     
-0004cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cd40: 2020 2020 2020 2063 6f6c 6f72 7320 3d20         colors = 
-0004cd50: 7661 6c75 655b 6b65 795d 5b27 636f 6c6f  value[key]['colo
-0004cd60: 7227 5d0a 2020 2020 2020 2020 2020 2020  r'].            
+0004c030: 2020 2062 6172 5f6a 736f 6e20 3d20 277b     bar_json = '{
+0004c040: 7d2f 7b7d 5f61 6962 6172 2e6a 736f 6e27  }/{}_aibar.json'
+0004c050: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
+0004c060: 6b64 6972 2c20 7365 6c66 2e6d 6170 6e61  kdir, self.mapna
+0004c070: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0004c080: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0004c090: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0004c0a0: 725f 6a73 6f6e 203d 2027 7b7d 2f7b 7d5f  r_json = '{}/{}_
+0004c0b0: 7b7d 6261 722e 6a73 6f6e 272e 666f 726d  {}bar.json'.form
+0004c0c0: 6174 2873 656c 662e 776f 726b 6469 722c  at(self.workdir,
+0004c0d0: 2073 656c 662e 6d61 706e 616d 652c 2073   self.mapname, s
+0004c0e0: 636f 7265 5f74 7970 6529 0a20 2020 2020  core_type).     
+0004c0f0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+0004c100: 6e61 6c5f 6469 6374 3a0a 2020 2020 2020  nal_dict:.      
+0004c110: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0004c120: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0004c130: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0004c140: 636f 6465 6373 2e6f 7065 6e28 6261 725f  codecs.open(bar_
+0004c150: 6a73 6f6e 2c20 2777 272c 2065 6e63 6f64  json, 'w', encod
+0004c160: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
+0004c170: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
+0004c180: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+0004c190: 736f 6e2e 6475 6d70 2866 696e 616c 5f64  son.dump(final_d
+0004c1a0: 6963 742c 2066 290a 0a20 2020 2020 2020  ict, f)..       
+0004c1b0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0004c1c0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0004c1d0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0004c1e0: 2e73 7464 6572 722e 7772 6974 6528 2753  .stderr.write('S
+0004c1f0: 6176 696e 6720 746f 2053 4d4f 4320 6a73  aving to SMOC js
+0004c200: 6f6e 2065 7272 6f72 3a20 7b7d 2e5c 6e27  on error: {}.\n'
+0004c210: 2e66 6f72 6d61 7428 7379 732e 6578 635f  .format(sys.exc_
+0004c220: 696e 666f 2829 5b31 5d29 290a 2020 2020  info()[1])).    
+0004c230: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0004c240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004c250: 2020 2020 2020 7072 696e 7428 2753 4d4f        print('SMO
+0004c260: 4320 7761 7320 6e6f 7420 636f 6c6c 6563  C was not collec
+0004c270: 7465 642c 2070 6c65 6173 6520 6368 6563  ted, please chec
+0004c280: 6b21 2729 0a20 2020 2020 2020 2020 2020  k!').           
+0004c290: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0004c2a0: 2020 2020 2020 2070 7269 6e74 2866 277b         print(f'{
+0004c2b0: 7363 6f72 655f 7479 7065 7d20 4a53 4f4e  score_type} JSON
+0004c2c0: 2065 7869 7374 2062 7574 2063 6f72 7265   exist but corre
+0004c2d0: 7370 6f6e 6469 6e67 2073 636f 7265 2064  sponding score d
+0004c2e0: 6f65 7320 6e6f 7420 6578 6973 742e 2043  oes not exist. C
+0004c2f0: 6865 636b 2074 6865 2065 7272 6f72 2e27  heck the error.'
+0004c300: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0004c310: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0004c320: 7428 2753 4d4f 4320 4a53 4f4e 2072 6573  t('SMOC JSON res
+0004c330: 756c 7473 2064 6f65 7320 6e6f 7420 6578  ults does not ex
+0004c340: 6973 742e 2043 6865 636b 2053 4d4f 4320  ist. Check SMOC 
+0004c350: 7275 6e2e 2729 0a0a 2020 2020 6465 6620  run.')..    def 
+0004c360: 736d 6f63 5f76 6965 7728 7365 6c66 2c20  smoc_view(self, 
+0004c370: 6368 696d 6572 6161 7070 293a 0a20 2020  chimeraapp):.   
+0004c380: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0004c390: 2020 2020 2020 582c 2059 2c20 5a20 696d        X, Y, Z im
+0004c3a0: 6167 6573 2077 6869 6368 206d 6f64 656c  ages which model
+0004c3b0: 2077 6173 2063 6f6c 6f72 6564 2062 7920   was colored by 
+0004c3c0: 534d 4f43 0a0a 2020 2020 2020 2020 3a72  SMOC..        :r
+0004c3d0: 6574 7572 6e3a 0a20 2020 2020 2020 2022  eturn:.        "
+0004c3e0: 2222 0a0a 2020 2020 2020 2020 2320 7265  ""..        # re
+0004c3f0: 6164 206a 736f 6e0a 2020 2020 2020 2020  ad json.        
+0004c400: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+0004c410: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+0004c420: 2020 2020 2020 2069 6e6a 736f 6e20 3d20         injson = 
+0004c430: 676c 6f62 2e67 6c6f 6228 7365 6c66 2e77  glob.glob(self.w
+0004c440: 6f72 6b64 6972 202b 2027 2a5f 736d 6f63  orkdir + '*_smoc
+0004c450: 2e6a 736f 6e27 290a 2020 2020 2020 2020  .json').        
+0004c460: 6261 7365 6469 7220 3d20 7365 6c66 2e77  basedir = self.w
+0004c470: 6f72 6b64 6972 0a20 2020 2020 2020 206d  orkdir.        m
+0004c480: 6170 6e61 6d65 203d 2073 656c 662e 6d61  apname = self.ma
+0004c490: 706e 616d 650a 2020 2020 2020 2020 6c6f  pname.        lo
+0004c4a0: 6343 4849 4d45 5241 203d 2063 6869 6d65  cCHIMERA = chime
+0004c4b0: 7261 6170 700a 2020 2020 2020 2020 6269  raapp.        bi
+0004c4c0: 6e64 6973 706c 6179 203d 206f 732e 6765  ndisplay = os.ge
+0004c4d0: 7465 6e76 2827 4449 5350 4c41 5927 290a  tenv('DISPLAY').
+0004c4e0: 2020 2020 2020 2020 6572 726c 6973 7420          errlist 
+0004c4f0: 3d20 5b5d 0a0a 2020 2020 2020 2020 6675  = []..        fu
+0004c500: 6c69 6e6a 736f 6e20 3d20 696e 6a73 6f6e  linjson = injson
+0004c510: 5b30 5d20 6966 2069 6e6a 736f 6e20 656c  [0] if injson el
+0004c520: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+0004c530: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0004c540: 2069 6620 6675 6c69 6e6a 736f 6e3a 0a20   if fulinjson:. 
+0004c550: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0004c560: 6974 6820 6f70 656e 2866 756c 696e 6a73  ith open(fulinjs
+0004c570: 6f6e 2c20 2772 2729 2061 7320 663a 0a20  on, 'r') as f:. 
+0004c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c590: 2020 2061 7267 7320 3d20 6a73 6f6e 2e6c     args = json.l
+0004c5a0: 6f61 6428 6629 0a20 2020 2020 2020 2020  oad(f).         
+0004c5b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004c5c0: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
+0004c5d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0004c5e0: 2020 2020 2070 7269 6e74 2827 5468 6572       print('Ther
+0004c5f0: 6520 6973 206e 6f20 534d 4f43 206a 736f  e is no SMOC jso
+0004c600: 6e20 6669 6c65 2e27 290a 2020 2020 2020  n file.').      
+0004c610: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
+0004c620: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0004c630: 6572 7220 3d20 274f 7065 6e20 534d 4f43  err = 'Open SMOC
+0004c640: 204a 534f 4e20 6572 726f 723a 207b 7d2e   JSON error: {}.
+0004c650: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
+0004c660: 5f69 6e66 6f28 295b 315d 290a 2020 2020  _info()[1]).    
+0004c670: 2020 2020 2020 2020 6572 726c 6973 742e          errlist.
+0004c680: 6170 7065 6e64 2865 7272 290a 2020 2020  append(err).    
+0004c690: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+0004c6a0: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
+0004c6b0: 5c6e 2729 0a20 2020 2020 2020 2065 6c73  \n').        els
+0004c6c0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0004c6d0: 6620 6172 6773 2069 7320 6e6f 7420 4e6f  f args is not No
+0004c6e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0004c6f0: 2020 2020 6d6f 6465 6c73 203d 2061 7267      models = arg
+0004c700: 735b 2773 6d6f 6327 5d0a 2020 2020 2020  s['smoc'].      
+0004c710: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0004c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c730: 2020 2064 656c 206d 6f64 656c 735b 2765     del models['e
+0004c740: 7272 275d 0a20 2020 2020 2020 2020 2020  rr'].           
+0004c750: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+0004c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c770: 2070 7269 6e74 2827 534d 4f43 206a 736f   print('SMOC jso
+0004c780: 6e20 7265 7375 6c74 2069 7320 636f 7272  n result is corr
+0004c790: 6563 7427 290a 0a20 2020 2020 2020 2020  ect')..         
+0004c7a0: 2020 2020 2020 2070 7269 6e74 2827 5468         print('Th
+0004c7b0: 6572 6520 6973 2f61 7265 2025 7320 6d6f  ere is/are %s mo
+0004c7c0: 6465 6c28 7329 2e27 2025 206c 656e 286d  del(s).' % len(m
+0004c7d0: 6f64 656c 7329 290a 2020 2020 2020 2020  odels)).        
+0004c7e0: 2020 2020 2020 2020 666f 7220 286b 6579          for (key
+0004c7f0: 2c20 7661 6c75 6529 2069 6e20 6974 6572  , value) in iter
+0004c800: 6974 656d 7328 6d6f 6465 6c73 293a 0a20  items(models):. 
+0004c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c820: 2020 2023 2066 6f72 2028 6b65 7932 2c20     # for (key2, 
+0004c830: 7661 6c75 6532 2920 696e 2069 7465 7269  value2) in iteri
+0004c840: 7465 6d73 2876 616c 7565 293a 0a20 2020  tems(value):.   
+0004c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c860: 2069 6620 7479 7065 2876 616c 7565 2920   if type(value) 
+0004c870: 6973 2066 6c6f 6174 3a0a 2020 2020 2020  is float:.      
+0004c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c890: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0004c8a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0004c8b0: 6579 6c69 7374 203d 206c 6973 7428 7661  eylist = list(va
+0004c8c0: 6c75 6529 0a20 2020 2020 2020 2020 2020  lue).           
+0004c8d0: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
+0004c8e0: 2069 6e20 6b65 796c 6973 743a 0a20 2020   in keylist:.   
+0004c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c900: 2020 2020 2069 6620 6b65 7920 213d 2027       if key != '
+0004c910: 6e61 6d65 273a 0a20 2020 2020 2020 2020  name':.         
+0004c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c930: 2020 2063 6f6c 6f72 7320 3d20 7661 6c75     colors = valu
+0004c940: 655b 6b65 795d 5b27 636f 6c6f 7227 5d0a  e[key]['color'].
+0004c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c960: 2020 2020 2020 2020 2020 2020 7265 7369              resi
+0004c970: 6475 6573 203d 2076 616c 7565 5b6b 6579  dues = value[key
+0004c980: 5d5b 2772 6573 6964 7565 275d 0a20 2020  ]['residue'].   
+0004c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c9a0: 2020 2020 2020 2020 2073 6d6f 6373 203d           smocs =
+0004c9b0: 2076 616c 7565 5b6b 6579 5d5b 2773 6d6f   value[key]['smo
+0004c9c0: 635f 7363 6f72 6573 275d 0a20 2020 2020  c_scores'].     
+0004c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c9e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca00: 2020 2020 206d 6f64 656c 6e61 6d65 203d       modelname =
+0004ca10: 2076 616c 7565 5b6b 6579 5d0a 2020 2020   value[key].    
+0004ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca30: 2020 2020 2020 2020 6d6f 6465 6c20 3d20          model = 
+0004ca40: 7365 6c66 2e77 6f72 6b64 6972 202b 206d  self.workdir + m
+0004ca50: 6f64 656c 6e61 6d65 0a20 2020 2020 2020  odelname.       
+0004ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca70: 2020 2020 2063 6869 6d65 7261 666e 616d       chimerafnam
+0004ca80: 6520 3d20 277b 7d5f 7b7d 5f73 6d6f 635f  e = '{}_{}_smoc_
+0004ca90: 6368 696d 6572 612e 6378 6327 2e66 6f72  chimera.cxc'.for
+0004caa0: 6d61 7428 6d6f 6465 6c6e 616d 652c 206d  mat(modelname, m
+0004cab0: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
+0004cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cad0: 2020 2020 7375 7266 6163 6566 6e20 3d20      surfacefn = 
+0004cae0: 277b 7d7b 7d5f 7b7d 272e 666f 726d 6174  '{}{}_{}'.format
+0004caf0: 2862 6173 6564 6972 2c20 6d6f 6465 6c6e  (basedir, modeln
+0004cb00: 616d 652c 206d 6170 6e61 6d65 290a 2020  ame, mapname).  
+0004cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb20: 2020 2020 2020 2020 2020 6368 696d 6572            chimer
+0004cb30: 6163 6d64 203d 2063 6869 6d65 7261 666e  acmd = chimerafn
+0004cb40: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0004cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb60: 2320 7064 626d 6f64 656c 6e61 6d65 203d  # pdbmodelname =
+0004cb70: 2027 7b7d 7b7d 5f5f 515f 5f7b 7d2e 7064   '{}{}__Q__{}.pd
+0004cb80: 6227 2e66 6f72 6d61 7428 6261 7365 6469  b'.format(basedi
+0004cb90: 722c 206d 6f64 656c 6e61 6d65 5b3a 2d34  r, modelname[:-4
+0004cba0: 5d2c 206d 6170 6e61 6d65 5b3a 2d34 5d29  ], mapname[:-4])
+0004cbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004cbc0: 2020 2020 2020 2020 2020 2020 2070 6462               pdb
+0004cbd0: 6d6f 6465 6c6e 616d 6520 3d20 277b 7d7b  modelname = '{}{
+0004cbe0: 7d27 2e66 6f72 6d61 7428 6261 7365 6469  }'.format(basedi
+0004cbf0: 722c 206d 6f64 656c 6e61 6d65 290a 0a20  r, modelname).. 
+0004cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cc10: 2020 2077 6974 6820 6f70 656e 2873 656c     with open(sel
+0004cc20: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
+0004cc30: 6572 6163 6d64 2c20 2777 2729 2061 7320  eracmd, 'w') as 
+0004cc40: 6670 3a0a 2020 2020 2020 2020 2020 2020  fp:.            
+0004cc50: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
+0004cc60: 7269 7465 2822 6f70 656e 2022 202b 2073  rite("open " + s
+0004cc70: 7472 2870 6462 6d6f 6465 6c6e 616d 6529  tr(pdbmodelname)
+0004cc80: 202b 2022 2066 6f72 6d61 7420 6d6d 6369   + " format mmci
+0004cc90: 6622 202b 2027 5c6e 2729 0a20 2020 2020  f" + '\n').     
+0004cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ccb0: 2020 2023 2066 702e 7772 6974 6528 226f     # fp.write("o
+0004ccc0: 7065 6e20 2220 2b20 7374 7228 7064 626d  pen " + str(pdbm
+0004ccd0: 6f64 656c 6e61 6d65 2920 2b20 2220 666f  odelname) + " fo
+0004cce0: 726d 6174 2070 6462 2220 2b20 275c 6e27  rmat pdb" + '\n'
+0004ccf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004cd00: 2020 2020 2020 2020 2020 6670 2e77 7269            fp.wri
+0004cd10: 7465 2827 7368 6f77 2073 656c 4174 6f6d  te('show selAtom
+0004cd20: 7320 7269 6262 6f6e 7327 202b 2027 5c6e  s ribbons' + '\n
+0004cd30: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0004cd40: 2020 2020 2020 2020 2020 2066 702e 7772             fp.wr
+0004cd50: 6974 6528 2768 6964 6520 7365 6c41 746f  ite('hide selAto
+0004cd60: 6d73 2720 2b20 275c 6e27 290a 0a20 2020  ms' + '\n')..   
 0004cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cd80: 7265 7369 6475 6573 203d 2076 616c 7565  residues = value
-0004cd90: 5b6b 6579 5d5b 2772 6573 6964 7565 275d  [key]['residue']
-0004cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004cdb0: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
-0004cdc0: 6373 203d 2076 616c 7565 5b6b 6579 5d5b  cs = value[key][
-0004cdd0: 2773 6d6f 635f 7363 6f72 6573 275d 0a20  'smoc_scores']. 
-0004cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cdf0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ce10: 2020 2020 2020 2020 206d 6f64 656c 6e61           modelna
-0004ce20: 6d65 203d 2076 616c 7565 5b6b 6579 5d0a  me = value[key].
-0004ce30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ce40: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0004ce50: 6c20 3d20 7365 6c66 2e77 6f72 6b64 6972  l = self.workdir
-0004ce60: 202b 206d 6f64 656c 6e61 6d65 0a20 2020   + modelname.   
-0004ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ce80: 2020 2020 2020 2020 2063 6869 6d65 7261           chimera
-0004ce90: 666e 616d 6520 3d20 277b 7d5f 7b7d 5f73  fname = '{}_{}_s
-0004cea0: 6d6f 635f 6368 696d 6572 612e 6378 6327  moc_chimera.cxc'
-0004ceb0: 2e66 6f72 6d61 7428 6d6f 6465 6c6e 616d  .format(modelnam
-0004cec0: 652c 206d 6170 6e61 6d65 290a 2020 2020  e, mapname).    
+0004cd80: 2020 2020 2066 6f72 2028 636f 6c6f 722c       for (color,
+0004cd90: 2072 6573 6964 7565 2c20 736d 6f63 7363   residue, smocsc
+0004cda0: 6f72 6529 2069 6e20 7a69 7028 636f 6c6f  ore) in zip(colo
+0004cdb0: 7273 2c20 7265 7369 6475 6573 2c20 736d  rs, residues, sm
+0004cdc0: 6f63 7329 3a0a 2020 2020 2020 2020 2020  ocs):.          
+0004cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cde0: 2020 6368 6169 6e2c 2072 6573 746d 7020    chain, restmp 
+0004cdf0: 3d20 7265 7369 6475 652e 7370 6c69 7428  = residue.split(
+0004ce00: 273a 2729 0a20 2020 2020 2020 2020 2020  ':').           
+0004ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ce20: 2023 204e 6f74 2073 7572 6520 6966 2061   # Not sure if a
+0004ce30: 6c6c 2074 6865 206c 6574 7465 7273 2073  ll the letters s
+0004ce40: 686f 756c 6420 6265 2072 6570 6c61 6365  hould be replace
+0004ce50: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0004ce60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004ce70: 3173 7420 7761 7920 6f66 2067 6574 7469  1st way of getti
+0004ce80: 6e67 2072 6573 5f69 640a 2020 2020 2020  ng res_id.      
+0004ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cea0: 2020 2020 2020 2320 7265 735f 6964 203d        # res_id =
+0004ceb0: 2072 652e 7375 6228 225c 4422 2c20 2222   re.sub("\D", ""
+0004cec0: 2c20 7265 7374 6d70 290a 2020 2020 2020  , restmp).      
 0004ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cee0: 2020 2020 2020 2020 7375 7266 6163 6566          surfacef
-0004cef0: 6e20 3d20 277b 7d7b 7d5f 7b7d 272e 666f  n = '{}{}_{}'.fo
-0004cf00: 726d 6174 2862 6173 6564 6972 2c20 6d6f  rmat(basedir, mo
-0004cf10: 6465 6c6e 616d 652c 206d 6170 6e61 6d65  delname, mapname
-0004cf20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004cf30: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-0004cf40: 696d 6572 6163 6d64 203d 2063 6869 6d65  imeracmd = chime
-0004cf50: 7261 666e 616d 650a 2020 2020 2020 2020  rafname.        
-0004cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cf70: 2020 2020 2320 7064 626d 6f64 656c 6e61      # pdbmodelna
-0004cf80: 6d65 203d 2027 7b7d 7b7d 5f5f 515f 5f7b  me = '{}{}__Q__{
-0004cf90: 7d2e 7064 6227 2e66 6f72 6d61 7428 6261  }.pdb'.format(ba
-0004cfa0: 7365 6469 722c 206d 6f64 656c 6e61 6d65  sedir, modelname
-0004cfb0: 5b3a 2d34 5d2c 206d 6170 6e61 6d65 5b3a  [:-4], mapname[:
-0004cfc0: 2d34 5d29 0a20 2020 2020 2020 2020 2020  -4]).           
-0004cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cfe0: 2070 6462 6d6f 6465 6c6e 616d 6520 3d20   pdbmodelname = 
-0004cff0: 277b 7d7b 7d27 2e66 6f72 6d61 7428 6261  '{}{}'.format(ba
-0004d000: 7365 6469 722c 206d 6f64 656c 6e61 6d65  sedir, modelname
-0004d010: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004d020: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0004d030: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
-0004d040: 6368 696d 6572 6163 6d64 2c20 2777 2729  chimeracmd, 'w')
-0004d050: 2061 7320 6670 3a0a 2020 2020 2020 2020   as fp:.        
-0004d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d070: 6670 2e77 7269 7465 2822 6f70 656e 2022  fp.write("open "
-0004d080: 202b 2073 7472 2870 6462 6d6f 6465 6c6e   + str(pdbmodeln
-0004d090: 616d 6529 202b 2022 2066 6f72 6d61 7420  ame) + " format 
-0004d0a0: 6d6d 6369 6622 202b 2027 5c6e 2729 0a20  mmcif" + '\n'). 
-0004d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d0c0: 2020 2020 2020 2023 2066 702e 7772 6974         # fp.writ
-0004d0d0: 6528 226f 7065 6e20 2220 2b20 7374 7228  e("open " + str(
-0004d0e0: 7064 626d 6f64 656c 6e61 6d65 2920 2b20  pdbmodelname) + 
-0004d0f0: 2220 666f 726d 6174 2070 6462 2220 2b20  " format pdb" + 
-0004d100: 275c 6e27 290a 2020 2020 2020 2020 2020  '\n').          
-0004d110: 2020 2020 2020 2020 2020 2020 2020 6670                fp
-0004d120: 2e77 7269 7465 2827 7368 6f77 2073 656c  .write('show sel
-0004d130: 4174 6f6d 7320 7269 6262 6f6e 7327 202b  Atoms ribbons' +
-0004d140: 2027 5c6e 2729 0a20 2020 2020 2020 2020   '\n').         
-0004d150: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004d160: 702e 7772 6974 6528 2768 6964 6520 7365  p.write('hide se
-0004d170: 6c41 746f 6d73 2720 2b20 275c 6e27 290a  lAtoms' + '\n').
-0004d180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d190: 2020 2020 2020 2020 2066 6f72 2028 636f           for (co
-0004d1a0: 6c6f 722c 2072 6573 6964 7565 2c20 736d  lor, residue, sm
-0004d1b0: 6f63 7363 6f72 6529 2069 6e20 7a69 7028  ocscore) in zip(
-0004d1c0: 636f 6c6f 7273 2c20 7265 7369 6475 6573  colors, residues
-0004d1d0: 2c20 736d 6f63 7329 3a0a 2020 2020 2020  , smocs):.      
-0004d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d1f0: 2020 2020 2020 6368 6169 6e2c 2072 6573        chain, res
-0004d200: 746d 7020 3d20 7265 7369 6475 652e 7370  tmp = residue.sp
-0004d210: 6c69 7428 273a 2729 0a20 2020 2020 2020  lit(':').       
-0004d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d230: 2020 2020 2023 204e 6f74 2073 7572 6520       # Not sure 
-0004d240: 6966 2061 6c6c 2074 6865 206c 6574 7465  if all the lette
-0004d250: 7273 2073 686f 756c 6420 6265 2072 6570  rs should be rep
-0004d260: 6c61 6365 640a 2020 2020 2020 2020 2020  laced.          
-0004d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d280: 2020 2320 3173 7420 7761 7920 6f66 2067    # 1st way of g
-0004d290: 6574 7469 6e67 2072 6573 5f69 640a 2020  etting res_id.  
-0004d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d2b0: 2020 2020 2020 2020 2020 2320 7265 735f            # res_
-0004d2c0: 6964 203d 2072 652e 7375 6228 225c 4422  id = re.sub("\D"
-0004d2d0: 2c20 2222 2c20 7265 7374 6d70 290a 2020  , "", restmp).  
+0004cee0: 2020 2020 2020 2320 326e 6420 7761 7920        # 2nd way 
+0004cef0: 6f66 2067 6574 7469 6e67 2072 6573 0a20  of getting res. 
+0004cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cf10: 2020 2020 2020 2020 2020 2072 6573 5f69             res_i
+0004cf20: 6420 3d20 7265 2e66 696e 6461 6c6c 2872  d = re.findall(r
+0004cf30: 272d 3f5c 642b 272c 2072 6573 746d 7029  '-?\d+', restmp)
+0004cf40: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0004cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cf60: 6670 2e77 7269 7465 280a 2020 2020 2020  fp.write(.      
+0004cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cf80: 2020 2020 2020 2020 2020 2763 6f6c 6f72            'color
+0004cf90: 202f 2720 2b20 6368 6169 6e20 2b20 273a   /' + chain + ':
+0004cfa0: 2720 2b20 7265 735f 6964 202b 2027 2027  ' + res_id + ' '
+0004cfb0: 202b 2063 6f6c 6f72 202b 2027 5c6e 270a   + color + '\n'.
+0004cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cfd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0004cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cff0: 2020 2020 2020 2020 2020 6966 2073 6d6f            if smo
+0004d000: 6373 636f 7265 203e 2031 2e30 3a0a 2020  cscore > 1.0:.  
+0004d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d020: 2020 2020 2020 2020 2020 2020 2020 6670                fp
+0004d030: 2e77 7269 7465 280a 2020 2020 2020 2020  .write(.        
+0004d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d050: 2020 2020 2020 2020 2020 2020 2773 686f              'sho
+0004d060: 7720 2f27 202b 2063 6861 696e 202b 2027  w /' + chain + '
+0004d070: 3a27 202b 2072 6573 5f69 6420 2b20 2720  :' + res_id + ' 
+0004d080: 6174 6f6d 7327 202b 2027 5c6e 270a 2020  atoms' + '\n'.  
+0004d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d0b0: 2020 2773 7479 6c65 202f 2720 2b20 6368    'style /' + ch
+0004d0c0: 6169 6e20 2b20 273a 2720 2b20 7265 735f  ain + ':' + res_
+0004d0d0: 6964 202b 2027 2073 7469 636b 2720 2b20  id + ' stick' + 
+0004d0e0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0004d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d100: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0004d110: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004d120: 702e 7772 6974 6528 0a20 2020 2020 2020  p.write(.       
+0004d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d140: 2020 2020 2022 7365 7420 6267 436f 6c6f       "set bgColo
+0004d150: 7220 7768 6974 6522 202b 2027 5c6e 270a  r white" + '\n'.
+0004d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d170: 2020 2020 2020 2020 2020 2020 226c 6967              "lig
+0004d180: 6874 696e 6720 736f 6674 2220 2b20 275c  hting soft" + '\
+0004d190: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004d1a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004d1b0: 7669 6577 2063 6f66 7220 5472 7565 2220  view cofr True" 
+0004d1c0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0004d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d1e0: 2020 2022 7361 7665 2022 202b 2073 7472     "save " + str
+0004d1f0: 2873 7572 6661 6365 666e 2920 2b20 225f  (surfacefn) + "_
+0004d200: 7a73 6d6f 6373 7572 6661 6365 2e6a 7065  zsmocsurface.jpe
+0004d210: 6722 202b 2022 2073 7570 6572 7361 6d70  g" + " supersamp
+0004d220: 6c65 2033 2077 6964 7468 2031 3230 3020  le 3 width 1200 
+0004d230: 6865 6967 6874 2031 3230 3022 202b 2027  height 1200" + '
+0004d240: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0004d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d260: 2274 7572 6e20 7820 2d39 3022 202b 2027  "turn x -90" + '
+0004d270: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0004d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d290: 2274 7572 6e20 7920 2d39 3022 202b 2027  "turn y -90" + '
+0004d2a0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0004d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d2c0: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
+0004d2d0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
 0004d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d2f0: 2020 2020 2020 2020 2020 2320 326e 6420            # 2nd 
-0004d300: 7761 7920 6f66 2067 6574 7469 6e67 2072  way of getting r
-0004d310: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0004d320: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004d330: 6573 5f69 6420 3d20 7265 2e66 696e 6461  es_id = re.finda
-0004d340: 6c6c 2872 272d 3f5c 642b 272c 2072 6573  ll(r'-?\d+', res
-0004d350: 746d 7029 5b30 5d0a 2020 2020 2020 2020  tmp)[0].        
+0004d2f0: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
+0004d300: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
+0004d310: 5f78 736d 6f63 7375 7266 6163 652e 6a70  _xsmocsurface.jp
+0004d320: 6567 2220 2b20 2220 7375 7065 7273 616d  eg" + " supersam
+0004d330: 706c 6520 3320 7769 6474 6820 3132 3030  ple 3 width 1200
+0004d340: 2068 6569 6768 7420 3132 3030 2220 2b20   height 1200" + 
+0004d350: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
 0004d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d370: 2020 2020 6670 2e77 7269 7465 280a 2020      fp.write(.  
-0004d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d390: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0004d3a0: 6f6c 6f72 202f 2720 2b20 6368 6169 6e20  olor /' + chain 
-0004d3b0: 2b20 273a 2720 2b20 7265 735f 6964 202b  + ':' + res_id +
-0004d3c0: 2027 2027 202b 2063 6f6c 6f72 202b 2027   ' ' + color + '
-0004d3d0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0004d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d3f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004d400: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004d410: 2073 6d6f 6373 636f 7265 203e 2031 2e30   smocscore > 1.0
-0004d420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d440: 2020 6670 2e77 7269 7465 280a 2020 2020    fp.write(.    
-0004d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d470: 2773 686f 7720 2f27 202b 2063 6861 696e  'show /' + chain
-0004d480: 202b 2027 3a27 202b 2072 6573 5f69 6420   + ':' + res_id 
-0004d490: 2b20 2720 6174 6f6d 7327 202b 2027 5c6e  + ' atoms' + '\n
-0004d4a0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0004d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d4c0: 2020 2020 2020 2773 7479 6c65 202f 2720        'style /' 
-0004d4d0: 2b20 6368 6169 6e20 2b20 273a 2720 2b20  + chain + ':' + 
-0004d4e0: 7265 735f 6964 202b 2027 2073 7469 636b  res_id + ' stick
-0004d4f0: 2720 2b20 275c 6e27 0a20 2020 2020 2020  ' + '\n'.       
-0004d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d510: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0004d370: 2022 7669 6577 206f 7269 656e 7422 202b   "view orient" +
+0004d380: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
+0004d390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d3a0: 2020 2274 7572 6e20 7820 3930 2220 2b20    "turn x 90" + 
+0004d3b0: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0004d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d3d0: 2022 7475 726e 207a 2039 3022 202b 2027   "turn z 90" + '
+0004d3e0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0004d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d400: 2276 6965 7720 636f 6672 2054 7275 6522  "view cofr True"
+0004d410: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0004d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d430: 2020 2020 2273 6176 6520 2220 2b20 7374      "save " + st
+0004d440: 7228 7375 7266 6163 6566 6e29 202b 2022  r(surfacefn) + "
+0004d450: 5f79 736d 6f63 7375 7266 6163 652e 6a70  _ysmocsurface.jp
+0004d460: 6567 2220 2b20 2220 7375 7065 7273 616d  eg" + " supersam
+0004d470: 706c 6520 3320 7769 6474 6820 3132 3030  ple 3 width 1200
+0004d480: 2068 6569 6768 7420 3132 3030 2220 2b20   height 1200" + 
+0004d490: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0004d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d4b0: 2022 636c 6f73 6520 616c 6c22 202b 2022   "close all" + "
+0004d4c0: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+0004d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d4e0: 2265 7869 7422 0a20 2020 2020 2020 2020  "exit".         
+0004d4f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0004d500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d510: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
 0004d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d530: 2020 2066 702e 7772 6974 6528 0a20 2020     fp.write(.   
-0004d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d550: 2020 2020 2020 2020 2022 7365 7420 6267           "set bg
-0004d560: 436f 6c6f 7220 7768 6974 6522 202b 2027  Color white" + '
-0004d570: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0004d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d590: 226c 6967 6874 696e 6720 736f 6674 2220  "lighting soft" 
-0004d5a0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-0004d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d5c0: 2020 2022 7669 6577 2063 6f66 7220 5472     "view cofr Tr
-0004d5d0: 7565 2220 2b20 275c 6e27 0a20 2020 2020  ue" + '\n'.     
-0004d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d5f0: 2020 2020 2020 2022 7361 7665 2022 202b         "save " +
-0004d600: 2073 7472 2873 7572 6661 6365 666e 2920   str(surfacefn) 
-0004d610: 2b20 225f 7a73 6d6f 6373 7572 6661 6365  + "_zsmocsurface
-0004d620: 2e6a 7065 6722 202b 2022 2073 7570 6572  .jpeg" + " super
-0004d630: 7361 6d70 6c65 2033 2077 6964 7468 2031  sample 3 width 1
-0004d640: 3230 3020 6865 6967 6874 2031 3230 3022  200 height 1200"
-0004d650: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
+0004d530: 2020 6966 206e 6f74 2062 696e 6469 7370    if not bindisp
+0004d540: 6c61 793a 0a20 2020 2020 2020 2020 2020  lay:.           
+0004d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d560: 2073 7562 7072 6f63 6573 732e 6368 6563   subprocess.chec
+0004d570: 6b5f 6361 6c6c 286c 6f63 4348 494d 4552  k_call(locCHIMER
+0004d580: 4120 2b20 2220 2d2d 6f66 6673 6372 6565  A + " --offscree
+0004d590: 6e20 2d2d 6e6f 6775 6920 2220 2b20 7365  n --nogui " + se
+0004d5a0: 6c66 2e77 6f72 6b64 6972 202b 2063 6869  lf.workdir + chi
+0004d5b0: 6d65 7261 636d 642c 0a20 2020 2020 2020  meracmd,.       
+0004d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d5e0: 2020 2020 2020 2020 2020 2063 7764 3d73             cwd=s
+0004d5f0: 656c 662e 776f 726b 6469 722c 2073 6865  elf.workdir, she
+0004d600: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
+0004d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d620: 2020 2020 2070 7269 6e74 2827 436f 6c6f       print('Colo
+0004d630: 7265 6420 6d6f 6465 6c73 2062 6173 6564  red models based
+0004d640: 206f 6e20 534d 4f43 2077 6572 6520 7072   on SMOC were pr
+0004d650: 6f64 7563 6564 2e27 290a 2020 2020 2020  oduced.').      
 0004d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d670: 2020 2020 2274 7572 6e20 7820 2d39 3022      "turn x -90"
-0004d680: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0004d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6a0: 2020 2020 2274 7572 6e20 7920 2d39 3022      "turn y -90"
-0004d6b0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0004d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6d0: 2020 2020 2276 6965 7720 636f 6672 2054      "view cofr T
-0004d6e0: 7275 6522 202b 2027 5c6e 270a 2020 2020  rue" + '\n'.    
+0004d670: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0004d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d690: 2020 2020 7375 6270 726f 6365 7373 2e63      subprocess.c
+0004d6a0: 6865 636b 5f63 616c 6c28 6c6f 6343 4849  heck_call(locCHI
+0004d6b0: 4d45 5241 202b 2022 2022 202b 2073 656c  MERA + " " + sel
+0004d6c0: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
+0004d6d0: 6572 6163 6d64 2c20 6377 643d 7365 6c66  eracmd, cwd=self
+0004d6e0: 2e77 6f72 6b64 6972 2c0a 2020 2020 2020  .workdir,.      
 0004d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d700: 2020 2020 2020 2020 2273 6176 6520 2220          "save " 
-0004d710: 2b20 7374 7228 7375 7266 6163 6566 6e29  + str(surfacefn)
-0004d720: 202b 2022 5f78 736d 6f63 7375 7266 6163   + "_xsmocsurfac
-0004d730: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
-0004d740: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
-0004d750: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
-0004d760: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
-0004d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d780: 2020 2020 2022 7669 6577 206f 7269 656e       "view orien
-0004d790: 7422 202b 2027 5c6e 270a 2020 2020 2020  t" + '\n'.      
-0004d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d7b0: 2020 2020 2020 2274 7572 6e20 7820 3930        "turn x 90
-0004d7c0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
-0004d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d7e0: 2020 2020 2022 7475 726e 207a 2039 3022       "turn z 90"
-0004d7f0: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-0004d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d810: 2020 2020 2276 6965 7720 636f 6672 2054      "view cofr T
-0004d820: 7275 6522 202b 2027 5c6e 270a 2020 2020  rue" + '\n'.    
-0004d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d840: 2020 2020 2020 2020 2273 6176 6520 2220          "save " 
-0004d850: 2b20 7374 7228 7375 7266 6163 6566 6e29  + str(surfacefn)
-0004d860: 202b 2022 5f79 736d 6f63 7375 7266 6163   + "_ysmocsurfac
-0004d870: 652e 6a70 6567 2220 2b20 2220 7375 7065  e.jpeg" + " supe
-0004d880: 7273 616d 706c 6520 3320 7769 6474 6820  rsample 3 width 
-0004d890: 3132 3030 2068 6569 6768 7420 3132 3030  1200 height 1200
-0004d8a0: 2220 2b20 275c 6e27 0a20 2020 2020 2020  " + '\n'.       
-0004d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d8c0: 2020 2020 2022 636c 6f73 6520 616c 6c22       "close all"
-0004d8d0: 202b 2022 5c6e 220a 2020 2020 2020 2020   + "\n".        
-0004d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d8f0: 2020 2020 2265 7869 7422 0a20 2020 2020      "exit".     
-0004d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d910: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0004d920: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0004d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d940: 2020 2020 2020 6966 206e 6f74 2062 696e        if not bin
-0004d950: 6469 7370 6c61 793a 0a20 2020 2020 2020  display:.       
-0004d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d970: 2020 2020 2073 7562 7072 6f63 6573 732e       subprocess.
-0004d980: 6368 6563 6b5f 6361 6c6c 286c 6f63 4348  check_call(locCH
-0004d990: 494d 4552 4120 2b20 2220 2d2d 6f66 6673  IMERA + " --offs
-0004d9a0: 6372 6565 6e20 2d2d 6e6f 6775 6920 2220  creen --nogui " 
-0004d9b0: 2b20 7365 6c66 2e77 6f72 6b64 6972 202b  + self.workdir +
-0004d9c0: 2063 6869 6d65 7261 636d 642c 0a20 2020   chimeracmd,.   
-0004d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d9f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004da00: 7764 3d73 656c 662e 776f 726b 6469 722c  wd=self.workdir,
-0004da10: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-0004da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004da30: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004da40: 436f 6c6f 7265 6420 6d6f 6465 6c73 2062  Colored models b
-0004da50: 6173 6564 206f 6e20 534d 4f43 2077 6572  ased on SMOC wer
-0004da60: 6520 7072 6f64 7563 6564 2e27 290a 2020  e produced.').  
-0004da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004da80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0004da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004daa0: 2020 2020 2020 2020 7375 6270 726f 6365          subproce
-0004dab0: 7373 2e63 6865 636b 5f63 616c 6c28 6c6f  ss.check_call(lo
-0004dac0: 6343 4849 4d45 5241 202b 2022 2022 202b  cCHIMERA + " " +
-0004dad0: 2073 656c 662e 776f 726b 6469 7220 2b20   self.workdir + 
-0004dae0: 6368 696d 6572 6163 6d64 2c20 6377 643d  chimeracmd, cwd=
-0004daf0: 7365 6c66 2e77 6f72 6b64 6972 2c0a 2020  self.workdir,.  
-0004db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d710: 2020 2020 2020 2020 2020 2020 7368 656c              shel
+0004d720: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+0004d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d740: 2020 2020 7072 696e 7428 2743 6f6c 6f72      print('Color
+0004d750: 6564 206d 6f64 656c 7320 6261 7365 6420  ed models based 
+0004d760: 6f6e 2053 4d4f 4320 7765 7265 2070 726f  on SMOC were pro
+0004d770: 6475 6365 642e 2729 0a20 2020 2020 2020  duced.').       
+0004d780: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0004d790: 6570 7420 7375 6270 726f 6365 7373 2e43  ept subprocess.C
+0004d7a0: 616c 6c65 6450 726f 6365 7373 4572 726f  alledProcessErro
+0004d7b0: 7220 6173 2073 7562 6572 723a 0a20 2020  r as suberr:.   
+0004d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d7d0: 2020 2020 2065 7272 203d 2027 5361 7669       err = 'Savi
+0004d7e0: 6e67 206d 6f64 656c 207b 7d20 534d 4f43  ng model {} SMOC
+0004d7f0: 2076 6965 7720 6572 726f 723a 207b 7d2e   view error: {}.
+0004d800: 272e 666f 726d 6174 286d 6f64 656c 6e61  '.format(modelna
+0004d810: 6d65 2c20 7375 6265 7272 290a 2020 2020  me, suberr).    
+0004d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d830: 2020 2020 6572 726c 6973 742e 6170 7065      errlist.appe
+0004d840: 6e64 2865 7272 290a 2020 2020 2020 2020  nd(err).        
+0004d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d860: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+0004d870: 2865 7272 202b 2027 5c6e 2729 0a0a 2020  (err + '\n')..  
+0004d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d890: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0004d8a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004d8b0: 656c 662e 7363 616c 655f 7375 7266 6163  elf.scale_surfac
+0004d8c0: 6576 6965 7728 290a 2020 2020 2020 2020  eview().        
+0004d8d0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0004d8e0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0004d8f0: 2020 2020 2020 2020 2020 2020 6572 7220              err 
+0004d900: 3d20 2753 6361 6c69 6e67 206d 6f64 656c  = 'Scaling model
+0004d910: 2053 4d4f 4320 7669 6577 2065 7272 6f72   SMOC view error
+0004d920: 3a20 7b7d 2e27 2e66 6f72 6d61 7428 7379  : {}.'.format(sy
+0004d930: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
+0004d940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d950: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
+0004d960: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
+0004d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d980: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+0004d990: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
+0004d9a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004d9b0: 2020 2020 2020 206a 7065 6773 203d 2067         jpegs = g
+0004d9c0: 6c6f 622e 676c 6f62 2873 656c 662e 776f  lob.glob(self.wo
+0004d9d0: 726b 6469 7220 2b20 272f 2a73 6d6f 6373  rkdir + '/*smocs
+0004d9e0: 7572 6661 6365 2e6a 7065 6727 290a 2020  urface.jpeg').  
+0004d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004da00: 2020 6d6f 6465 6c73 7572 6620 3d20 6469    modelsurf = di
+0004da10: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
+0004da20: 2020 2020 2020 2020 2066 696e 616c 6d6d           finalmm
+0004da30: 6469 6374 203d 2064 6963 7428 290a 2020  dict = dict().  
+0004da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004da50: 2020 6966 2073 656c 662e 6d6f 6465 6c73    if self.models
+0004da60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004da70: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+0004da80: 7420 2273 656c 662e 6d6f 6465 6c73 3a25  t "self.models:%
+0004da90: 7322 2025 2073 656c 662e 6d6f 6465 6c73  s" % self.models
+0004daa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004dab0: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
+0004dac0: 656c 2069 6e20 7365 6c66 2e6d 6f64 656c  el in self.model
+0004dad0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0004dae0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0004daf0: 6f64 656c 6e61 6d65 203d 206f 732e 7061  odelname = os.pa
+0004db00: 7468 2e62 6173 656e 616d 6528 6d6f 6465  th.basename(mode
+0004db10: 6c2e 6669 6c65 6e61 6d65 290a 2020 2020  l.filename).    
 0004db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004db30: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
-0004db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004db50: 2020 2020 2020 2020 7072 696e 7428 2743          print('C
-0004db60: 6f6c 6f72 6564 206d 6f64 656c 7320 6261  olored models ba
-0004db70: 7365 6420 6f6e 2053 4d4f 4320 7765 7265  sed on SMOC were
-0004db80: 2070 726f 6475 6365 642e 2729 0a20 2020   produced.').   
-0004db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dba0: 2065 7863 6570 7420 7375 6270 726f 6365   except subproce
-0004dbb0: 7373 2e43 616c 6c65 6450 726f 6365 7373  ss.CalledProcess
-0004dbc0: 4572 726f 7220 6173 2073 7562 6572 723a  Error as suberr:
-0004dbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004dbe0: 2020 2020 2020 2020 2065 7272 203d 2027           err = '
-0004dbf0: 5361 7669 6e67 206d 6f64 656c 207b 7d20  Saving model {} 
-0004dc00: 534d 4f43 2076 6965 7720 6572 726f 723a  SMOC view error:
-0004dc10: 207b 7d2e 272e 666f 726d 6174 286d 6f64   {}.'.format(mod
-0004dc20: 656c 6e61 6d65 2c20 7375 6265 7272 290a  elname, suberr).
-0004dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dc40: 2020 2020 2020 2020 6572 726c 6973 742e          errlist.
-0004dc50: 6170 7065 6e64 2865 7272 290a 2020 2020  append(err).    
-0004dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dc70: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-0004dc80: 7269 7465 2865 7272 202b 2027 5c6e 2729  rite(err + '\n')
-0004dc90: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004dca0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0004dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dcc0: 2020 2073 656c 662e 7363 616c 655f 7375     self.scale_su
-0004dcd0: 7266 6163 6576 6965 7728 290a 2020 2020  rfaceview().    
+0004db30: 2020 2020 2020 2020 7375 7266 6163 6566          surfacef
+0004db40: 6e20 3d20 277b 7d5f 7b7d 272e 666f 726d  n = '{}_{}'.form
+0004db50: 6174 286d 6f64 656c 6e61 6d65 2c20 7365  at(modelname, se
+0004db60: 6c66 2e6d 6170 6e61 6d65 290a 2020 2020  lf.mapname).    
+0004db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004db80: 2020 2020 2020 2020 6d6f 6465 6c6d 6170          modelmap
+0004db90: 7375 7266 6163 6520 3d20 6469 6374 2829  surface = dict()
+0004dba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004dbb0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004dbc0: 206a 7065 6720 696e 206a 7065 6773 3a0a   jpeg in jpegs:.
+0004dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dbf0: 6966 206d 6f64 656c 6e61 6d65 2069 6e20  if modelname in 
+0004dc00: 6a70 6567 2061 6e64 2027 7873 6d6f 6327  jpeg and 'xsmoc'
+0004dc10: 2069 6e20 6a70 6567 3a0a 2020 2020 2020   in jpeg:.      
+0004dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dc30: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0004dc40: 6465 6c6d 6170 7375 7266 6163 655b 2778  delmapsurface['x
+0004dc50: 275d 203d 2073 7472 2873 7572 6661 6365  '] = str(surface
+0004dc60: 666e 2920 2b20 275f 7363 616c 6564 5f78  fn) + '_scaled_x
+0004dc70: 736d 6f63 7375 7266 6163 652e 6a70 6567  smocsurface.jpeg
+0004dc80: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0004dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dca0: 2020 6966 206d 6f64 656c 6e61 6d65 2069    if modelname i
+0004dcb0: 6e20 6a70 6567 2061 6e64 2027 7973 6d6f  n jpeg and 'ysmo
+0004dcc0: 6327 2069 6e20 6a70 6567 3a0a 2020 2020  c' in jpeg:.    
+0004dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dcf0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-0004dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dd10: 6572 7220 3d20 2753 6361 6c69 6e67 206d  err = 'Scaling m
-0004dd20: 6f64 656c 2053 4d4f 4320 7669 6577 2065  odel SMOC view e
-0004dd30: 7272 6f72 3a20 7b7d 2e27 2e66 6f72 6d61  rror: {}.'.forma
-0004dd40: 7428 7379 732e 6578 635f 696e 666f 2829  t(sys.exc_info()
-0004dd50: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
-0004dd60: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0004dd70: 6c69 7374 2e61 7070 656e 6428 6572 7229  list.append(err)
-0004dd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004dd90: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
-0004dda0: 6572 722e 7772 6974 6528 6572 7220 2b20  err.write(err + 
-0004ddb0: 275c 6e27 290a 0a20 2020 2020 2020 2020  '\n')..         
-0004ddc0: 2020 2020 2020 2020 2020 206a 7065 6773             jpegs
-0004ddd0: 203d 2067 6c6f 622e 676c 6f62 2873 656c   = glob.glob(sel
-0004dde0: 662e 776f 726b 6469 7220 2b20 272f 2a73  f.workdir + '/*s
-0004ddf0: 6d6f 6373 7572 6661 6365 2e6a 7065 6727  mocsurface.jpeg'
-0004de00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004de10: 2020 2020 2020 6d6f 6465 6c73 7572 6620        modelsurf 
-0004de20: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
-0004de30: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-0004de40: 616c 6d6d 6469 6374 203d 2064 6963 7428  almmdict = dict(
-0004de50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004de60: 2020 2020 2020 6966 2073 656c 662e 6d6f        if self.mo
-0004de70: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
-0004de80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004de90: 7072 696e 7420 2273 656c 662e 6d6f 6465  print "self.mode
-0004dea0: 6c73 3a25 7322 2025 2073 656c 662e 6d6f  ls:%s" % self.mo
-0004deb0: 6465 6c73 0a20 2020 2020 2020 2020 2020  dels.           
-0004dec0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0004ded0: 206d 6f64 656c 2069 6e20 7365 6c66 2e6d   model in self.m
-0004dee0: 6f64 656c 733a 0a20 2020 2020 2020 2020  odels:.         
+0004dcf0: 6d6f 6465 6c6d 6170 7375 7266 6163 655b  modelmapsurface[
+0004dd00: 2779 275d 203d 2073 7472 2873 7572 6661  'y'] = str(surfa
+0004dd10: 6365 666e 2920 2b20 275f 7363 616c 6564  cefn) + '_scaled
+0004dd20: 5f79 736d 6f63 7375 7266 6163 652e 6a70  _ysmocsurface.jp
+0004dd30: 6567 270a 2020 2020 2020 2020 2020 2020  eg'.            
+0004dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dd50: 2020 2020 6966 206d 6f64 656c 6e61 6d65      if modelname
+0004dd60: 2069 6e20 6a70 6567 2061 6e64 2027 7a73   in jpeg and 'zs
+0004dd70: 6d6f 6327 2069 6e20 6a70 6567 3a0a 2020  moc' in jpeg:.  
+0004dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dda0: 2020 6d6f 6465 6c6d 6170 7375 7266 6163    modelmapsurfac
+0004ddb0: 655b 277a 275d 203d 2073 7472 2873 7572  e['z'] = str(sur
+0004ddc0: 6661 6365 666e 2920 2b20 275f 7363 616c  facefn) + '_scal
+0004ddd0: 6564 5f7a 736d 6f63 7375 7266 6163 652e  ed_zsmocsurface.
+0004dde0: 6a70 6567 270a 2020 2020 2020 2020 2020  jpeg'.          
+0004ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004de00: 2020 6966 2065 7272 6c69 7374 3a0a 2020    if errlist:.  
+0004de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004de20: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0004de30: 6465 6c6d 6170 7375 7266 6163 655b 2765  delmapsurface['e
+0004de40: 7272 275d 203d 207b 276d 6f64 656c 5f66  rr'] = {'model_f
+0004de50: 6974 5f65 7272 273a 2065 7272 6c69 7374  it_err': errlist
+0004de60: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0004de70: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0004de80: 6465 6c73 7572 665b 6d6f 6465 6c6e 616d  delsurf[modelnam
+0004de90: 655d 203d 206d 6f64 656c 6d61 7073 7572  e] = modelmapsur
+0004dea0: 6661 6365 0a20 2020 2020 2020 2020 2020  face.           
+0004deb0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+0004dec0: 616c 6d6d 6469 6374 5b27 736d 6f63 7363  almmdict['smocsc
+0004ded0: 6f72 655f 7375 7266 6163 6527 5d20 3d20  ore_surface'] = 
+0004dee0: 6d6f 6465 6c73 7572 660a 0a20 2020 2020  modelsurf..     
 0004def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004df00: 2020 206d 6f64 656c 6e61 6d65 203d 206f     modelname = o
-0004df10: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0004df20: 6d6f 6465 6c2e 6669 6c65 6e61 6d65 290a  model.filename).
-0004df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004df40: 2020 2020 2020 2020 2020 2020 7375 7266              surf
-0004df50: 6163 6566 6e20 3d20 277b 7d5f 7b7d 272e  acefn = '{}_{}'.
-0004df60: 666f 726d 6174 286d 6f64 656c 6e61 6d65  format(modelname
-0004df70: 2c20 7365 6c66 2e6d 6170 6e61 6d65 290a  , self.mapname).
+0004df00: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0004df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004df20: 2020 2020 7769 7468 2063 6f64 6563 732e      with codecs.
+0004df30: 6f70 656e 2873 656c 662e 776f 726b 6469  open(self.workdi
+0004df40: 7220 2b20 7365 6c66 2e6d 6170 6e61 6d65  r + self.mapname
+0004df50: 202b 2027 5f73 6d6f 6376 6965 772e 6a73   + '_smocview.js
+0004df60: 6f6e 272c 2027 7727 2c0a 2020 2020 2020  on', 'w',.      
+0004df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004df90: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0004dfa0: 6c6d 6170 7375 7266 6163 6520 3d20 6469  lmapsurface = di
-0004dfb0: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
-0004dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dfd0: 2066 6f72 206a 7065 6720 696e 206a 7065   for jpeg in jpe
-0004dfe0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+0004df90: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+0004dfa0: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
+0004dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dfc0: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+0004dfd0: 736f 6e2e 6475 6d70 2866 696e 616c 6d6d  son.dump(finalmm
+0004dfe0: 6469 6374 2c20 6629 0a20 2020 2020 2020  dict, f).       
 0004dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e000: 2020 2020 6966 206d 6f64 656c 6e61 6d65      if modelname
-0004e010: 2069 6e20 6a70 6567 2061 6e64 2027 7873   in jpeg and 'xs
-0004e020: 6d6f 6327 2069 6e20 6a70 6567 3a0a 2020  moc' in jpeg:.  
-0004e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e000: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+0004e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e020: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+0004e030: 7772 6974 6528 0a20 2020 2020 2020 2020  write(.         
 0004e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e050: 2020 6d6f 6465 6c6d 6170 7375 7266 6163    modelmapsurfac
-0004e060: 655b 2778 275d 203d 2073 7472 2873 7572  e['x'] = str(sur
-0004e070: 6661 6365 666e 2920 2b20 275f 7363 616c  facefn) + '_scal
-0004e080: 6564 5f78 736d 6f63 7375 7266 6163 652e  ed_xsmocsurface.
-0004e090: 6a70 6567 270a 2020 2020 2020 2020 2020  jpeg'.          
-0004e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e0b0: 2020 2020 2020 6966 206d 6f64 656c 6e61        if modelna
-0004e0c0: 6d65 2069 6e20 6a70 6567 2061 6e64 2027  me in jpeg and '
-0004e0d0: 7973 6d6f 6327 2069 6e20 6a70 6567 3a0a  ysmoc' in jpeg:.
-0004e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e100: 2020 2020 6d6f 6465 6c6d 6170 7375 7266      modelmapsurf
-0004e110: 6163 655b 2779 275d 203d 2073 7472 2873  ace['y'] = str(s
-0004e120: 7572 6661 6365 666e 2920 2b20 275f 7363  urfacefn) + '_sc
-0004e130: 616c 6564 5f79 736d 6f63 7375 7266 6163  aled_ysmocsurfac
-0004e140: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
-0004e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e160: 2020 2020 2020 2020 6966 206d 6f64 656c          if model
-0004e170: 6e61 6d65 2069 6e20 6a70 6567 2061 6e64  name in jpeg and
-0004e180: 2027 7a73 6d6f 6327 2069 6e20 6a70 6567   'zsmoc' in jpeg
-0004e190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e1b0: 2020 2020 2020 6d6f 6465 6c6d 6170 7375        modelmapsu
-0004e1c0: 7266 6163 655b 277a 275d 203d 2073 7472  rface['z'] = str
-0004e1d0: 2873 7572 6661 6365 666e 2920 2b20 275f  (surfacefn) + '_
-0004e1e0: 7363 616c 6564 5f7a 736d 6f63 7375 7266  scaled_zsmocsurf
-0004e1f0: 6163 652e 6a70 6567 270a 2020 2020 2020  ace.jpeg'.      
-0004e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e210: 2020 2020 2020 6966 2065 7272 6c69 7374        if errlist
-0004e220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e240: 2020 6d6f 6465 6c6d 6170 7375 7266 6163    modelmapsurfac
-0004e250: 655b 2765 7272 275d 203d 207b 276d 6f64  e['err'] = {'mod
-0004e260: 656c 5f66 6974 5f65 7272 273a 2065 7272  el_fit_err': err
-0004e270: 6c69 7374 7d0a 2020 2020 2020 2020 2020  list}.          
-0004e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e290: 2020 6d6f 6465 6c73 7572 665b 6d6f 6465    modelsurf[mode
-0004e2a0: 6c6e 616d 655d 203d 206d 6f64 656c 6d61  lname] = modelma
-0004e2b0: 7073 7572 6661 6365 0a20 2020 2020 2020  psurface.       
-0004e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e2d0: 2066 696e 616c 6d6d 6469 6374 5b27 736d   finalmmdict['sm
-0004e2e0: 6f63 7363 6f72 655f 7375 7266 6163 6527  ocscore_surface'
-0004e2f0: 5d20 3d20 6d6f 6465 6c73 7572 660a 0a20  ] = modelsurf.. 
-0004e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e310: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0004e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e330: 2020 2020 2020 2020 7769 7468 2063 6f64          with cod
-0004e340: 6563 732e 6f70 656e 2873 656c 662e 776f  ecs.open(self.wo
-0004e350: 726b 6469 7220 2b20 7365 6c66 2e6d 6170  rkdir + self.map
-0004e360: 6e61 6d65 202b 2027 5f73 6d6f 6376 6965  name + '_smocvie
-0004e370: 772e 6a73 6f6e 272c 2027 7727 2c0a 2020  w.json', 'w',.  
-0004e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3a0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-0004e3b0: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
-0004e3c0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0004e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3e0: 2020 206a 736f 6e2e 6475 6d70 2866 696e     json.dump(fin
-0004e3f0: 616c 6d6d 6469 6374 2c20 6629 0a20 2020  almmdict, f).   
-0004e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e410: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-0004e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e430: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
-0004e440: 6572 722e 7772 6974 6528 0a20 2020 2020  err.write(.     
-0004e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e460: 2020 2020 2020 2020 2020 2027 5361 7669             'Savi
-0004e470: 6e67 2053 4d4f 4320 7669 6577 2074 6f20  ng SMOC view to 
-0004e480: 4a53 4f4e 2065 7272 6f72 3a20 7b7d 2e5c  JSON error: {}.\
-0004e490: 6e27 2e66 6f72 6d61 7428 7379 732e 6578  n'.format(sys.ex
-0004e4a0: 635f 696e 666f 2829 5b31 5d29 290a 0a20  c_info()[1])).. 
-0004e4b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004e4c0: 6e64 203d 2074 696d 6569 742e 6465 6661  nd = timeit.defa
-0004e4d0: 756c 745f 7469 6d65 7228 290a 2020 2020  ult_timer().    
-0004e4e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0004e4f0: 7428 2753 4d4f 4320 7375 7266 6163 6520  t('SMOC surface 
-0004e500: 7469 6d65 3a20 2573 2720 2520 2865 6e64  time: %s' % (end
-0004e510: 202d 2073 7461 7274 2929 0a20 2020 2020   - start)).     
-0004e520: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0004e530: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
-0004e540: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004e550: 2d2d 2d2d 2d2d 2729 0a0a 2020 2020 6465  ------')..    de
-0004e560: 6620 736d 6f63 5f73 7572 6661 6365 2873  f smoc_surface(s
-0004e570: 656c 6629 3a0a 0a20 2020 2020 2020 2023  elf):..        #
-0004e580: 2073 656c 662e 7265 6e61 6d65 7166 696c   self.renameqfil
-0004e590: 6573 2829 0a20 2020 2020 2020 2074 7279  es().        try
-0004e5a0: 3a0a 2020 2020 2020 2020 2020 2020 7674  :.            vt
-0004e5b0: 6b70 6163 6b2c 2063 6869 6d65 7261 6170  kpack, chimeraap
-0004e5c0: 7020 3d20 7365 6c66 2e73 7572 6661 6365  p = self.surface
-0004e5d0: 5f65 6e76 6368 6563 6b28 290a 2020 2020  _envcheck().    
-0004e5e0: 2020 2020 2020 2020 7365 6c66 2e73 6d6f          self.smo
-0004e5f0: 635f 7669 6577 2863 6869 6d65 7261 6170  c_view(chimeraap
-0004e600: 7029 0a20 2020 2020 2020 2065 7863 6570  p).        excep
-0004e610: 743a 0a20 2020 2020 2020 2020 2020 2065  t:.            e
-0004e620: 7272 203d 2027 534d 4f43 2073 7572 6661  rr = 'SMOC surfa
-0004e630: 6365 2076 6965 7720 6661 696c 6564 3a20  ce view failed: 
-0004e640: 7b7d 272e 666f 726d 6174 2873 7973 2e65  {}'.format(sys.e
-0004e650: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-0004e660: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0004e670: 7472 6163 6562 6163 6b2e 666f 726d 6174  traceback.format
-0004e680: 5f65 7863 2829 290a 2020 2020 2020 2020  _exc()).        
-0004e690: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-0004e6a0: 7269 7465 2865 7272 202b 2027 5c6e 2729  rite(err + '\n')
-0004e6b0: 0a0a 0a20 2020 2064 6566 2063 6363 5f62  ...    def ccc_b
-0004e6c0: 6172 2873 656c 6629 3a0a 0a0a 2020 2020  ar(self):...    
-0004e6d0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0004e6e0: 6f6e 6c79 6261 723a 0a20 2020 2020 2020  onlybar:.       
-0004e6f0: 2020 2020 2073 656c 662e 7068 656e 6978       self.phenix
-0004e700: 5f72 6573 6363 6328 290a 2020 2020 2020  _resccc().      
-0004e710: 2020 7365 6c66 2e67 6574 5f62 6172 2873    self.get_bar(s
-0004e720: 636f 7265 5f74 7970 653d 2763 6363 2729  core_type='ccc')
-0004e730: 0a0a 0a20 2020 2064 6566 2070 6865 6e69  ...    def pheni
-0004e740: 785f 7265 7363 6363 2873 656c 6629 3a0a  x_resccc(self):.
-0004e750: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0004e760: 2020 2020 2020 2020 5275 6e20 5068 656e          Run Phen
-0004e770: 6978 2072 6573 6964 7565 2d77 6973 6520  ix residue-wise 
-0004e780: 4343 4320 6361 6c63 7561 7469 6f6e 0a20  CCC calcuation. 
-0004e790: 2020 2020 2020 203a 7265 7475 726e 3a0a         :return:.
-0004e7a0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0004e7b0: 2020 2020 2069 6620 7365 6c66 2e70 6c61       if self.pla
-0004e7c0: 7466 6f72 6d20 3d3d 2027 656d 6462 2720  tform == 'emdb' 
-0004e7d0: 616e 6420 7365 6c66 2e6d 6574 2021 3d20  and self.met != 
-0004e7e0: 2774 6f6d 6f27 3a0a 2020 2020 2020 2020  'tomo':.        
-0004e7f0: 2020 2020 7374 6172 7420 3d20 7469 6d65      start = time
-0004e800: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
-0004e810: 2829 0a20 2020 2020 2020 2020 2020 2065  ().            e
-0004e820: 7272 6c69 7374 203d 205b 5d0a 2020 2020  rrlist = [].    
-0004e830: 2020 2020 2020 2020 7265 7375 6c74 5f64          result_d
-0004e840: 6963 7420 3d20 7b7d 0a20 2020 2020 2020  ict = {}.       
-0004e850: 2020 2020 2023 2069 6620 7374 7275 6465       # if strude
-0004e860: 6c61 7070 2061 6e64 2073 656c 662e 6d6f  lapp and self.mo
-0004e870: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
-0004e880: 2020 6966 2073 656c 662e 6d6f 6465 6c73    if self.models
-0004e890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004e8a0: 2020 6e75 6d6d 6f64 656c 7320 3d20 300a    nummodels = 0.
-0004e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e8c0: 616c 6c72 6573 756c 7473 203d 207b 7d0a  allresults = {}.
-0004e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e8e0: 666f 7220 6d6f 6465 6c20 696e 2073 656c  for model in sel
-0004e8f0: 662e 6d6f 6465 6c73 3a0a 2020 2020 2020  f.models:.      
-0004e900: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0004e910: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0004e920: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
-0004e930: 6d6f 6465 6c20 3d20 277b 7d7b 7d27 2e66  model = '{}{}'.f
-0004e940: 6f72 6d61 7428 7365 6c66 2e77 6f72 6b64  ormat(self.workd
-0004e950: 6972 2c20 6f73 2e70 6174 682e 6261 7365  ir, os.path.base
-0004e960: 6e61 6d65 286d 6f64 656c 2e66 696c 656e  name(model.filen
-0004e970: 616d 6529 290a 2020 2020 2020 2020 2020  ame)).          
-0004e980: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0004e990: 6c6c 5f6d 6170 203d 2027 7b7d 7b7d 272e  ll_map = '{}{}'.
-0004e9a0: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
-0004e9b0: 6469 722c 2073 656c 662e 6d61 706e 616d  dir, self.mapnam
-0004e9c0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0004e9d0: 2020 2020 2020 2020 2020 206f 7574 5f70             out_p
-0004e9e0: 6174 6820 3d20 277b 7d5f 7068 656e 6978  ath = '{}_phenix
-0004e9f0: 272e 666f 726d 6174 2866 756c 6c5f 6d6f  '.format(full_mo
-0004ea00: 6465 6c29 0a0a 2020 2020 2020 2020 2020  del)..          
-0004ea10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0004ea20: 7272 203d 2072 756e 5f70 6865 6e69 7863  rr = run_phenixc
-0004ea30: 6328 6675 6c6c 5f6d 6f64 656c 2c20 6675  c(full_model, fu
-0004ea40: 6c6c 5f6d 6170 2c20 7365 6c66 2e72 6573  ll_map, self.res
-0004ea50: 6f6c 7574 696f 6e2c 206f 7574 5f70 6174  olution, out_pat
-0004ea60: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-0004ea70: 2020 2020 2020 2020 2020 2065 6e64 203d             end =
-0004ea80: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-0004ea90: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
-0004eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eab0: 7072 696e 7428 2750 6865 6e69 7820 4343  print('Phenix CC
-0004eac0: 4320 7469 6d65 3a20 2573 2720 2520 2865  C time: %s' % (e
-0004ead0: 6e64 202d 2073 7461 7274 2929 0a20 2020  nd - start)).   
-0004eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eaf0: 2020 2020 2063 636c 6f67 203d 2027 7b7d       cclog = '{}
-0004eb00: 2f63 635f 7065 725f 7265 7369 6475 652e  /cc_per_residue.
-0004eb10: 6c6f 6727 2e66 6f72 6d61 7428 6f75 745f  log'.format(out_
-0004eb20: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
-0004eb30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0004eb40: 696e 7428 6363 6c6f 672c 2072 6572 7229  int(cclog, rerr)
-0004eb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004eb60: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004eb70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004eb80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004eb90: 2d2d 2d2d 2729 0a20 2020 2020 2020 2020  ----').         
-0004eba0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0004ebb0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0004ebc0: 2020 2020 2020 2020 2020 2065 7272 203d             err =
-0004ebd0: 2027 5068 656e 6978 2043 4343 2063 616c   'Phenix CCC cal
-0004ebe0: 6375 6c61 7469 6f6e 2065 7272 6f72 3a20  culation error: 
-0004ebf0: 7b7d 2e27 2e66 6f72 6d61 7428 7379 732e  {}.'.format(sys.
-0004ec00: 6578 635f 696e 666f 2829 5b31 5d29 0a20  exc_info()[1]). 
-0004ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ec20: 2020 2020 2020 2065 7272 6c69 7374 2e61         errlist.a
-0004ec30: 7070 656e 6428 6572 7229 0a20 2020 2020  ppend(err).     
-0004ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ec50: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
-0004ec60: 6974 6528 6572 7220 2b20 275c 6e27 290a  ite(err + '\n').
+0004e050: 2020 2020 2020 2027 5361 7669 6e67 2053         'Saving S
+0004e060: 4d4f 4320 7669 6577 2074 6f20 4a53 4f4e  MOC view to JSON
+0004e070: 2065 7272 6f72 3a20 7b7d 2e5c 6e27 2e66   error: {}.\n'.f
+0004e080: 6f72 6d61 7428 7379 732e 6578 635f 696e  ormat(sys.exc_in
+0004e090: 666f 2829 5b31 5d29 290a 0a20 2020 2020  fo()[1]))..     
+0004e0a0: 2020 2020 2020 2020 2020 2065 6e64 203d             end =
+0004e0b0: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
+0004e0c0: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
+0004e0d0: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+0004e0e0: 4d4f 4320 7375 7266 6163 6520 7469 6d65  MOC surface time
+0004e0f0: 3a20 2573 2720 2520 2865 6e64 202d 2073  : %s' % (end - s
+0004e100: 7461 7274 2929 0a20 2020 2020 2020 2020  tart)).         
+0004e110: 2020 2020 2020 2070 7269 6e74 2827 2d2d         print('--
+0004e120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004e130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004e140: 2d2d 2729 0a0a 2020 2020 6465 6620 736d  --')..    def sm
+0004e150: 6f63 5f73 7572 6661 6365 2873 656c 6629  oc_surface(self)
+0004e160: 3a0a 0a20 2020 2020 2020 2023 2073 656c  :..        # sel
+0004e170: 662e 7265 6e61 6d65 7166 696c 6573 2829  f.renameqfiles()
+0004e180: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0004e190: 2020 2020 2020 2020 2020 7674 6b70 6163            vtkpac
+0004e1a0: 6b2c 2063 6869 6d65 7261 6170 7020 3d20  k, chimeraapp = 
+0004e1b0: 7365 6c66 2e73 7572 6661 6365 5f65 6e76  self.surface_env
+0004e1c0: 6368 6563 6b28 290a 2020 2020 2020 2020  check().        
+0004e1d0: 2020 2020 7365 6c66 2e73 6d6f 635f 7669      self.smoc_vi
+0004e1e0: 6577 2863 6869 6d65 7261 6170 7029 0a20  ew(chimeraapp). 
+0004e1f0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0004e200: 2020 2020 2020 2020 2020 2065 7272 203d             err =
+0004e210: 2027 534d 4f43 2073 7572 6661 6365 2076   'SMOC surface v
+0004e220: 6965 7720 6661 696c 6564 3a20 7b7d 272e  iew failed: {}'.
+0004e230: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
+0004e240: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
+0004e250: 2020 2020 2020 7072 696e 7428 7472 6163        print(trac
+0004e260: 6562 6163 6b2e 666f 726d 6174 5f65 7863  eback.format_exc
+0004e270: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+0004e280: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+0004e290: 2865 7272 202b 2027 5c6e 2729 0a0a 0a20  (err + '\n')... 
+0004e2a0: 2020 2064 6566 2063 6363 5f62 6172 2873     def ccc_bar(s
+0004e2b0: 656c 6629 3a0a 0a0a 2020 2020 2020 2020  elf):...        
+0004e2c0: 6966 206e 6f74 2073 656c 662e 6f6e 6c79  if not self.only
+0004e2d0: 6261 723a 0a20 2020 2020 2020 2020 2020  bar:.           
+0004e2e0: 2073 656c 662e 7068 656e 6978 5f72 6573   self.phenix_res
+0004e2f0: 6363 6328 290a 2020 2020 2020 2020 7365  ccc().        se
+0004e300: 6c66 2e67 6574 5f62 6172 2873 636f 7265  lf.get_bar(score
+0004e310: 5f74 7970 653d 2763 6363 2729 0a0a 0a20  _type='ccc')... 
+0004e320: 2020 2064 6566 2070 6865 6e69 785f 7265     def phenix_re
+0004e330: 7363 6363 2873 656c 6629 3a0a 2020 2020  sccc(self):.    
+0004e340: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0004e350: 2020 2020 5275 6e20 5068 656e 6978 2072      Run Phenix r
+0004e360: 6573 6964 7565 2d77 6973 6520 4343 4320  esidue-wise CCC 
+0004e370: 6361 6c63 7561 7469 6f6e 0a20 2020 2020  calcuation.     
+0004e380: 2020 203a 7265 7475 726e 3a0a 2020 2020     :return:.    
+0004e390: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0004e3a0: 2069 6620 7365 6c66 2e70 6c61 7466 6f72   if self.platfor
+0004e3b0: 6d20 3d3d 2027 656d 6462 2720 616e 6420  m == 'emdb' and 
+0004e3c0: 7365 6c66 2e6d 6574 2021 3d20 2774 6f6d  self.met != 'tom
+0004e3d0: 6f27 3a0a 2020 2020 2020 2020 2020 2020  o':.            
+0004e3e0: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+0004e3f0: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+0004e400: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+0004e410: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+0004e420: 2020 2020 7265 7375 6c74 5f64 6963 7420      result_dict 
+0004e430: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0004e440: 2023 2069 6620 7374 7275 6465 6c61 7070   # if strudelapp
+0004e450: 2061 6e64 2073 656c 662e 6d6f 6465 6c73   and self.models
+0004e460: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0004e470: 2073 656c 662e 6d6f 6465 6c73 3a0a 2020   self.models:.  
+0004e480: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
+0004e490: 6d6d 6f64 656c 7320 3d20 300a 2020 2020  mmodels = 0.    
+0004e4a0: 2020 2020 2020 2020 2020 2020 616c 6c72              allr
+0004e4b0: 6573 756c 7473 203d 207b 7d0a 2020 2020  esults = {}.    
+0004e4c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0004e4d0: 6d6f 6465 6c20 696e 2073 656c 662e 6d6f  model in self.mo
+0004e4e0: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
+0004e4f0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0004e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e510: 2020 2020 2020 2066 756c 6c5f 6d6f 6465         full_mode
+0004e520: 6c20 3d20 277b 7d7b 7d27 2e66 6f72 6d61  l = '{}{}'.forma
+0004e530: 7428 7365 6c66 2e77 6f72 6b64 6972 2c20  t(self.workdir, 
+0004e540: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0004e550: 286d 6f64 656c 2e66 696c 656e 616d 6529  (model.filename)
+0004e560: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004e570: 2020 2020 2020 2020 2020 6675 6c6c 5f6d            full_m
+0004e580: 6170 203d 2027 7b7d 7b7d 272e 666f 726d  ap = '{}{}'.form
+0004e590: 6174 2873 656c 662e 776f 726b 6469 722c  at(self.workdir,
+0004e5a0: 2073 656c 662e 6d61 706e 616d 6529 0a20   self.mapname). 
+0004e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e5c0: 2020 2020 2020 206f 7574 5f70 6174 6820         out_path 
+0004e5d0: 3d20 277b 7d5f 7068 656e 6978 272e 666f  = '{}_phenix'.fo
+0004e5e0: 726d 6174 2866 756c 6c5f 6d6f 6465 6c29  rmat(full_model)
+0004e5f0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e600: 2020 2020 2020 2020 2020 7265 7272 203d            rerr =
+0004e610: 2072 756e 5f70 6865 6e69 7863 6328 6675   run_phenixcc(fu
+0004e620: 6c6c 5f6d 6f64 656c 2c20 6675 6c6c 5f6d  ll_model, full_m
+0004e630: 6170 2c20 7365 6c66 2e72 6573 6f6c 7574  ap, self.resolut
+0004e640: 696f 6e2c 206f 7574 5f70 6174 6829 0a20  ion, out_path). 
+0004e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e660: 2020 2020 2020 2065 6e64 203d 2074 696d         end = tim
+0004e670: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
+0004e680: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+0004e690: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0004e6a0: 7428 2750 6865 6e69 7820 4343 4320 7469  t('Phenix CCC ti
+0004e6b0: 6d65 3a20 2573 2720 2520 2865 6e64 202d  me: %s' % (end -
+0004e6c0: 2073 7461 7274 2929 0a20 2020 2020 2020   start)).       
+0004e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e6e0: 2063 636c 6f67 203d 2027 7b7d 2f63 635f   cclog = '{}/cc_
+0004e6f0: 7065 725f 7265 7369 6475 652e 6c6f 6727  per_residue.log'
+0004e700: 2e66 6f72 6d61 7428 6f75 745f 7061 7468  .format(out_path
+0004e710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004e720: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0004e730: 6363 6c6f 672c 2072 6572 7229 0a20 2020  cclog, rerr).   
+0004e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e750: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+0004e760: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004e770: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004e780: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0004e790: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+0004e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e7b0: 2020 2020 2020 2065 7272 203d 2027 5068         err = 'Ph
+0004e7c0: 656e 6978 2043 4343 2063 616c 6375 6c61  enix CCC calcula
+0004e7d0: 7469 6f6e 2065 7272 6f72 3a20 7b7d 2e27  tion error: {}.'
+0004e7e0: 2e66 6f72 6d61 7428 7379 732e 6578 635f  .format(sys.exc_
+0004e7f0: 696e 666f 2829 5b31 5d29 0a20 2020 2020  info()[1]).     
+0004e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e810: 2020 2065 7272 6c69 7374 2e61 7070 656e     errlist.appen
+0004e820: 6428 6572 7229 0a20 2020 2020 2020 2020  d(err).         
+0004e830: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004e840: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+0004e850: 6572 7220 2b20 275c 6e27 290a 2020 2020  err + '\n').    
+0004e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e870: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0004e880: 2020 2020 2020 2020 2020 2020 2064 6620               df 
+0004e890: 3d20 7265 6164 5f63 6328 6363 6c6f 672c  = read_cc(cclog,
+0004e8a0: 2072 6572 7229 0a20 2020 2020 2020 2020   rerr).         
+0004e8b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004e8c0: 6364 6963 7420 3d20 6363 6466 5f74 6f64  cdict = ccdf_tod
+0004e8d0: 6963 7428 6466 290a 0a20 2020 2020 2020  ict(df)..       
+0004e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e8f0: 2061 6c6c 7265 7375 6c74 735b 7374 7228   allresults[str(
+0004e900: 6e75 6d6d 6f64 656c 7329 5d20 3d20 7b27  nummodels)] = {'
+0004e910: 6e61 6d65 273a 206f 732e 7061 7468 2e62  name': os.path.b
+0004e920: 6173 656e 616d 6528 6d6f 6465 6c2e 6669  asename(model.fi
+0004e930: 6c65 6e61 6d65 292c 0a20 2020 2020 2020  lename),.       
+0004e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e960: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0004e970: 6461 7461 273a 2063 6364 6963 747d 0a0a  data': ccdict}..
+0004e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e990: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+0004e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e9b0: 2020 2020 6572 7220 3d20 2753 6176 6520      err = 'Save 
+0004e9c0: 5068 656e 6978 2043 4343 2064 6174 6120  Phenix CCC data 
+0004e9d0: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
+0004e9e0: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
+0004e9f0: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
+0004ea00: 2020 2020 2020 2020 2020 2020 2020 6572                er
+0004ea10: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
+0004ea20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004ea30: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+0004ea40: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
+0004ea50: 2027 5c6e 2729 0a20 2020 2020 2020 2020   '\n').         
+0004ea60: 2020 2020 2020 2020 2020 206e 756d 6d6f             nummo
+0004ea70: 6465 6c73 202b 3d20 310a 0a20 2020 2020  dels += 1..     
+0004ea80: 2020 2020 2020 2020 2020 2069 6620 616c             if al
+0004ea90: 6c72 6573 756c 7473 3a0a 2020 2020 2020  lresults:.      
+0004eaa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0004eab0: 7375 6c74 5f64 6963 745b 2763 6363 275d  sult_dict['ccc']
+0004eac0: 203d 2061 6c6c 7265 7375 6c74 730a 0a20   = allresults.. 
+0004ead0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004eae0: 6620 6572 726c 6973 743a 0a20 2020 2020  f errlist:.     
+0004eaf0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0004eb00: 6573 756c 745f 6469 6374 5b27 6572 7227  esult_dict['err'
+0004eb10: 5d20 3d20 6572 726c 6973 740a 0a20 2020  ] = errlist..   
+0004eb20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004eb30: 6c65 6e28 7265 7375 6c74 5f64 6963 7429  len(result_dict)
+0004eb40: 203d 3d20 3120 616e 6420 2763 6363 2720   == 1 and 'ccc' 
+0004eb50: 696e 2072 6573 756c 745f 6469 6374 3a0a  in result_dict:.
+0004eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eb70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0004eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eb90: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
+0004eba0: 6e28 7365 6c66 2e77 6f72 6b64 6972 202b  n(self.workdir +
+0004ebb0: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
+0004ebc0: 275f 7265 7363 6363 2e6a 736f 6e27 2c20  '_resccc.json', 
+0004ebd0: 2777 272c 0a20 2020 2020 2020 2020 2020  'w',.           
+0004ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ebf0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0004ec00: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
+0004ec10: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0004ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ec30: 2020 6a73 6f6e 2e64 756d 7028 7265 7375    json.dump(resu
+0004ec40: 6c74 5f64 6963 742c 2066 290a 2020 2020  lt_dict, f).    
+0004ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ec60: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
 0004ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ec80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0004ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eca0: 2064 6620 3d20 7265 6164 5f63 6328 6363   df = read_cc(cc
-0004ecb0: 6c6f 672c 2072 6572 7229 0a20 2020 2020  log, rerr).     
-0004ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ecd0: 2020 2063 6364 6963 7420 3d20 6363 6466     ccdict = ccdf
-0004ece0: 5f74 6f64 6963 7428 6466 290a 0a20 2020  _todict(df)..   
+0004ec80: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+0004ec90: 2827 5361 7669 6e67 2074 6f20 4343 4320  ('Saving to CCC 
+0004eca0: 6a73 6f6e 2065 7272 6f72 3a20 7b7d 2e5c  json error: {}.\
+0004ecb0: 6e27 2e66 6f72 6d61 7428 7379 732e 6578  n'.format(sys.ex
+0004ecc0: 635f 696e 666f 2829 5b31 5d29 290a 0a20  c_info()[1])).. 
+0004ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ece0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
 0004ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed00: 2020 2020 2061 6c6c 7265 7375 6c74 735b       allresults[
-0004ed10: 7374 7228 6e75 6d6d 6f64 656c 7329 5d20  str(nummodels)] 
-0004ed20: 3d20 7b27 6e61 6d65 273a 206f 732e 7061  = {'name': os.pa
-0004ed30: 7468 2e62 6173 656e 616d 6528 6d6f 6465  th.basename(mode
-0004ed40: 6c2e 6669 6c65 6e61 6d65 292c 0a20 2020  l.filename),.   
-0004ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed80: 2020 2027 6461 7461 273a 2063 6364 6963     'data': ccdic
-0004ed90: 747d 0a0a 2020 2020 2020 2020 2020 2020  t}..            
-0004eda0: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-0004edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004edc0: 2020 2020 2020 2020 6572 7220 3d20 2753          err = 'S
-0004edd0: 6176 6520 5068 656e 6978 2043 4343 2064  ave Phenix CCC d
-0004ede0: 6174 6120 6572 726f 723a 207b 7d2e 272e  ata error: {}.'.
-0004edf0: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
-0004ee00: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
-0004ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ee20: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-0004ee30: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
-0004ee40: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0004ee50: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
-0004ee60: 7272 202b 2027 5c6e 2729 0a20 2020 2020  rr + '\n').     
-0004ee70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0004ee80: 756d 6d6f 6465 6c73 202b 3d20 310a 0a20  ummodels += 1.. 
-0004ee90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004eea0: 6620 616c 6c72 6573 756c 7473 3a0a 2020  f allresults:.  
-0004eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eec0: 2020 7265 7375 6c74 5f64 6963 745b 2763    result_dict['c
-0004eed0: 6363 275d 203d 2061 6c6c 7265 7375 6c74  cc'] = allresult
-0004eee0: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
-0004eef0: 2020 2069 6620 6572 726c 6973 743a 0a20     if errlist:. 
-0004ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ef10: 2020 2072 6573 756c 745f 6469 6374 5b27     result_dict['
-0004ef20: 6572 7227 5d20 3d20 6572 726c 6973 740a  err'] = errlist.
-0004ef30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ef40: 2069 6620 6c65 6e28 7265 7375 6c74 5f64   if len(result_d
-0004ef50: 6963 7429 203d 3d20 3120 616e 6420 2763  ict) == 1 and 'c
-0004ef60: 6363 2720 696e 2072 6573 756c 745f 6469  cc' in result_di
-0004ef70: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
-0004ef80: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0004ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004efa0: 2020 2020 2077 6974 6820 636f 6465 6373       with codecs
-0004efb0: 2e6f 7065 6e28 7365 6c66 2e77 6f72 6b64  .open(self.workd
-0004efc0: 6972 202b 2073 656c 662e 6d61 706e 616d  ir + self.mapnam
-0004efd0: 6520 2b20 275f 7265 7363 6363 2e6a 736f  e + '_resccc.jso
-0004efe0: 6e27 2c20 2777 272c 0a20 2020 2020 2020  n', 'w',.       
-0004eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f010: 2020 656e 636f 6469 6e67 3d27 7574 662d    encoding='utf-
-0004f020: 3827 2920 6173 2066 3a0a 2020 2020 2020  8') as f:.      
-0004f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f040: 2020 2020 2020 6a73 6f6e 2e64 756d 7028        json.dump(
-0004f050: 7265 7375 6c74 5f64 6963 742c 2066 290a  result_dict, f).
-0004f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f070: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-0004f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f090: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-0004f0a0: 7269 7465 2827 5361 7669 6e67 2074 6f20  rite('Saving to 
-0004f0b0: 4343 4320 6a73 6f6e 2065 7272 6f72 3a20  CCC json error: 
-0004f0c0: 7b7d 2e5c 6e27 2e66 6f72 6d61 7428 7379  {}.\n'.format(sy
-0004f0d0: 732e 6578 635f 696e 666f 2829 5b31 5d29  s.exc_info()[1])
-0004f0e0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004f0f0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0004f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f110: 2020 2020 7365 6c66 2e63 635f 7375 7266      self.cc_surf
-0004f120: 6163 6528 290a 2020 2020 2020 2020 2020  ace().          
-0004f130: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0004f140: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004f150: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0004f160: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
-0004f170: 4343 4320 7375 7266 6163 6520 6572 726f  CCC surface erro
-0004f180: 723a 207b 7d2e 5c6e 272e 666f 726d 6174  r: {}.\n'.format
-0004f190: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-0004f1a0: 315d 2929 0a20 2020 2020 2020 2020 2020  1])).           
-0004f1b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0004f1c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0004f1d0: 7269 6e74 2827 4343 4320 7761 7320 6e6f  rint('CCC was no
-0004f1e0: 7420 636f 6c6c 6563 7465 642c 2070 6c65  t collected, ple
-0004f1f0: 6173 6520 6368 6563 6b20 7468 6520 6572  ase check the er
-0004f200: 726f 7221 2729 0a0a 2020 2020 2020 2020  ror!')..        
-0004f210: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0004f220: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0004f230: 274e 6f20 6d6f 6465 6c20 6f72 2072 6573  'No model or res
-0004f240: 6f6c 7574 696f 6e20 6973 206e 6f74 2063  olution is not c
-0004f250: 6f76 6572 6564 2069 6e20 7468 6520 6d6f  overed in the mo
-0004f260: 7469 6620 6c69 6272 6172 7920 283c 342e  tif library (<4.
-0004f270: 30c3 8529 2027 290a 2020 2020 2020 2020  0..) ').        
-0004f280: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
-0004f290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004f2a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0004f2b0: 2d2d 2d27 290a 0a20 2020 2020 2020 2072  ---')..        r
-0004f2c0: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-0004f2d0: 6465 6620 6363 7363 6f72 6576 6965 7728  def ccscoreview(
-0004f2e0: 7365 6c66 2c20 6368 696d 6572 6161 7070  self, chimeraapp
-0004f2f0: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
-0004f300: 2020 2020 2020 2020 2020 2020 582c 2059              X, Y
-0004f310: 2c20 5a20 696d 6167 6573 2077 6869 6368  , Z images which
-0004f320: 206d 6f64 656c 2077 6173 2063 6f6c 6f72   model was color
-0004f330: 6564 2062 7920 7265 7369 6475 652d 7769  ed by residue-wi
-0004f340: 7365 2043 4343 0a0a 2020 2020 2020 2020  se CCC..        
-0004f350: 3a72 6574 7572 6e3a 0a20 2020 2020 2020  :return:.       
-0004f360: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-0004f370: 7265 6164 206a 736f 6e0a 2020 2020 2020  read json.      
-0004f380: 2020 7374 6172 7420 3d20 7469 6d65 6974    start = timeit
-0004f390: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
-0004f3a0: 0a20 2020 2020 2020 2069 6e6a 736f 6e20  .        injson 
-0004f3b0: 3d20 676c 6f62 2e67 6c6f 6228 7365 6c66  = glob.glob(self
-0004f3c0: 2e77 6f72 6b64 6972 202b 2027 2a5f 7265  .workdir + '*_re
-0004f3d0: 7363 6363 2e6a 736f 6e27 290a 2020 2020  sccc.json').    
-0004f3e0: 2020 2020 6261 7365 6469 7220 3d20 7365      basedir = se
-0004f3f0: 6c66 2e77 6f72 6b64 6972 0a20 2020 2020  lf.workdir.     
-0004f400: 2020 206d 6170 6e61 6d65 203d 2073 656c     mapname = sel
-0004f410: 662e 6d61 706e 616d 650a 2020 2020 2020  f.mapname.      
-0004f420: 2020 6c6f 6343 4849 4d45 5241 203d 2063    locCHIMERA = c
-0004f430: 6869 6d65 7261 6170 700a 2020 2020 2020  himeraapp.      
-0004f440: 2020 6269 6e64 6973 706c 6179 203d 206f    bindisplay = o
-0004f450: 732e 6765 7465 6e76 2827 4449 5350 4c41  s.getenv('DISPLA
-0004f460: 5927 290a 2020 2020 2020 2020 6572 726c  Y').        errl
-0004f470: 6973 7420 3d20 5b5d 0a0a 2020 2020 2020  ist = []..      
-0004f480: 2020 6675 6c69 6e6a 736f 6e20 3d20 696e    fulinjson = in
-0004f490: 6a73 6f6e 5b30 5d20 6966 2069 6e6a 736f  json[0] if injso
-0004f4a0: 6e20 656c 7365 204e 6f6e 650a 2020 2020  n else None.    
-0004f4b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0004f4c0: 2020 2020 2069 6620 6675 6c69 6e6a 736f       if fulinjso
-0004f4d0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0004f4e0: 2020 2077 6974 6820 6f70 656e 2866 756c     with open(ful
-0004f4f0: 696e 6a73 6f6e 2c20 2772 2729 2061 7320  injson, 'r') as 
-0004f500: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0004f510: 2020 2020 2020 2061 7267 7320 3d20 6a73         args = js
-0004f520: 6f6e 2e6c 6f61 6428 6629 0a20 2020 2020  on.load(f).     
-0004f530: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0004f540: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-0004f550: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
-0004f560: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0004f570: 5468 6572 6520 6973 206e 6f20 4343 4320  There is no CCC 
-0004f580: 6a73 6f6e 2066 696c 652e 2729 0a20 2020  json file.').   
-0004f590: 2020 2020 2065 7863 6570 7420 5479 7065       except Type
-0004f5a0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0004f5b0: 2020 2065 7272 203d 2027 4f70 656e 2043     err = 'Open C
-0004f5c0: 4343 204a 534f 4e20 6572 726f 723a 207b  CC JSON error: {
-0004f5d0: 7d2e 272e 666f 726d 6174 2873 7973 2e65  }.'.format(sys.e
-0004f5e0: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-0004f5f0: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
-0004f600: 742e 6170 7065 6e64 2865 7272 290a 2020  t.append(err).  
-0004f610: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-0004f620: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
-0004f630: 2027 5c6e 2729 0a20 2020 2020 2020 2065   '\n').        e
-0004f640: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0004f650: 2069 6620 6172 6773 2069 7320 6e6f 7420   if args is not 
-0004f660: 4e6f 6e65 2061 6e64 2027 6363 6327 2069  None and 'ccc' i
-0004f670: 6e20 6172 6773 2e6b 6579 7328 293a 0a20  n args.keys():. 
-0004f680: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0004f690: 6f64 656c 7320 3d20 6172 6773 5b27 6363  odels = args['cc
-0004f6a0: 6327 5d0a 2020 2020 2020 2020 2020 2020  c'].            
-0004f6b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0004f6c0: 2020 2020 2020 2020 2020 2020 2064 656c               del
-0004f6d0: 206d 6f64 656c 735b 2765 7272 275d 0a20   models['err']. 
-0004f6e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004f6f0: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-0004f700: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0004f710: 2827 4343 4320 6a73 6f6e 2072 6573 756c  ('CCC json resul
-0004f720: 7420 6973 2063 6f72 7265 6374 2729 0a0a  t is correct')..
-0004f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f740: 7072 696e 7428 2754 6865 7265 2069 732f  print('There is/
-0004f750: 6172 6520 2573 206d 6f64 656c 2873 292e  are %s model(s).
-0004f760: 2720 2520 6c65 6e28 6d6f 6465 6c73 2929  ' % len(models))
-0004f770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f780: 2066 6f72 2028 6b65 792c 2076 616c 7565   for (key, value
-0004f790: 2920 696e 2069 7465 7269 7465 6d73 286d  ) in iteritems(m
-0004f7a0: 6f64 656c 7329 3a0a 2020 2020 2020 2020  odels):.        
-0004f7b0: 2020 2020 2020 2020 2020 2020 2320 666f              # fo
-0004f7c0: 7220 286b 6579 322c 2076 616c 7565 3229  r (key2, value2)
-0004f7d0: 2069 6e20 6974 6572 6974 656d 7328 7661   in iteritems(va
-0004f7e0: 6c75 6529 3a0a 2020 2020 2020 2020 2020  lue):.          
-0004f7f0: 2020 2020 2020 2020 2020 6966 2074 7970            if typ
-0004f800: 6528 7661 6c75 6529 2069 7320 666c 6f61  e(value) is floa
-0004f810: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0004f820: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0004f830: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0004f840: 2020 2020 2020 2020 6b65 796c 6973 7420          keylist 
-0004f850: 3d20 6c69 7374 2876 616c 7565 290a 2020  = list(value).  
-0004f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f870: 2020 666f 7220 6b65 7920 696e 206b 6579    for key in key
-0004f880: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
-0004f890: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004f8a0: 206b 6579 2021 3d20 276e 616d 6527 3a0a   key != 'name':.
-0004f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f8c0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-0004f8d0: 7273 203d 2076 616c 7565 5b6b 6579 5d5b  rs = value[key][
-0004f8e0: 2763 6f6c 6f72 275d 0a20 2020 2020 2020  'color'].       
+0004ed00: 7365 6c66 2e63 635f 7375 7266 6163 6528  self.cc_surface(
+0004ed10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004ed20: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+0004ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ed40: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+0004ed50: 6465 7272 2e77 7269 7465 2827 4343 4320  derr.write('CCC 
+0004ed60: 7375 7266 6163 6520 6572 726f 723a 207b  surface error: {
+0004ed70: 7d2e 5c6e 272e 666f 726d 6174 2873 7973  }.\n'.format(sys
+0004ed80: 2e65 7863 5f69 6e66 6f28 295b 315d 2929  .exc_info()[1]))
+0004ed90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004eda0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0004edb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0004edc0: 2827 4343 4320 7761 7320 6e6f 7420 636f  ('CCC was not co
+0004edd0: 6c6c 6563 7465 642c 2070 6c65 6173 6520  llected, please 
+0004ede0: 6368 6563 6b20 7468 6520 6572 726f 7221  check the error!
+0004edf0: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+0004ee00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0004ee10: 2020 2020 2020 7072 696e 7428 274e 6f20        print('No 
+0004ee20: 6d6f 6465 6c20 6f72 2072 6573 6f6c 7574  model or resolut
+0004ee30: 696f 6e20 6973 206e 6f74 2063 6f76 6572  ion is not cover
+0004ee40: 6564 2069 6e20 7468 6520 6d6f 7469 6620  ed in the motif 
+0004ee50: 6c69 6272 6172 7920 283c 342e 30c3 8529  library (<4.0..)
+0004ee60: 2027 290a 2020 2020 2020 2020 2020 2020   ').            
+0004ee70: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+0004ee80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0004ee90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+0004eea0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0004eeb0: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
+0004eec0: 6363 7363 6f72 6576 6965 7728 7365 6c66  ccscoreview(self
+0004eed0: 2c20 6368 696d 6572 6161 7070 293a 0a20  , chimeraapp):. 
+0004eee0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0004eef0: 2020 2020 2020 2020 582c 2059 2c20 5a20          X, Y, Z 
+0004ef00: 696d 6167 6573 2077 6869 6368 206d 6f64  images which mod
+0004ef10: 656c 2077 6173 2063 6f6c 6f72 6564 2062  el was colored b
+0004ef20: 7920 7265 7369 6475 652d 7769 7365 2043  y residue-wise C
+0004ef30: 4343 0a0a 2020 2020 2020 2020 3a72 6574  CC..        :ret
+0004ef40: 7572 6e3a 0a20 2020 2020 2020 2022 2222  urn:.        """
+0004ef50: 0a0a 2020 2020 2020 2020 2320 7265 6164  ..        # read
+0004ef60: 206a 736f 6e0a 2020 2020 2020 2020 7374   json.        st
+0004ef70: 6172 7420 3d20 7469 6d65 6974 2e64 6566  art = timeit.def
+0004ef80: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
+0004ef90: 2020 2020 2069 6e6a 736f 6e20 3d20 676c       injson = gl
+0004efa0: 6f62 2e67 6c6f 6228 7365 6c66 2e77 6f72  ob.glob(self.wor
+0004efb0: 6b64 6972 202b 2027 2a5f 7265 7363 6363  kdir + '*_resccc
+0004efc0: 2e6a 736f 6e27 290a 2020 2020 2020 2020  .json').        
+0004efd0: 6261 7365 6469 7220 3d20 7365 6c66 2e77  basedir = self.w
+0004efe0: 6f72 6b64 6972 0a20 2020 2020 2020 206d  orkdir.        m
+0004eff0: 6170 6e61 6d65 203d 2073 656c 662e 6d61  apname = self.ma
+0004f000: 706e 616d 650a 2020 2020 2020 2020 6c6f  pname.        lo
+0004f010: 6343 4849 4d45 5241 203d 2063 6869 6d65  cCHIMERA = chime
+0004f020: 7261 6170 700a 2020 2020 2020 2020 6269  raapp.        bi
+0004f030: 6e64 6973 706c 6179 203d 206f 732e 6765  ndisplay = os.ge
+0004f040: 7465 6e76 2827 4449 5350 4c41 5927 290a  tenv('DISPLAY').
+0004f050: 2020 2020 2020 2020 6572 726c 6973 7420          errlist 
+0004f060: 3d20 5b5d 0a0a 2020 2020 2020 2020 6675  = []..        fu
+0004f070: 6c69 6e6a 736f 6e20 3d20 696e 6a73 6f6e  linjson = injson
+0004f080: 5b30 5d20 6966 2069 6e6a 736f 6e20 656c  [0] if injson el
+0004f090: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+0004f0a0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0004f0b0: 2069 6620 6675 6c69 6e6a 736f 6e3a 0a20   if fulinjson:. 
+0004f0c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0004f0d0: 6974 6820 6f70 656e 2866 756c 696e 6a73  ith open(fulinjs
+0004f0e0: 6f6e 2c20 2772 2729 2061 7320 663a 0a20  on, 'r') as f:. 
+0004f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f100: 2020 2061 7267 7320 3d20 6a73 6f6e 2e6c     args = json.l
+0004f110: 6f61 6428 6629 0a20 2020 2020 2020 2020  oad(f).         
+0004f120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004f130: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
+0004f140: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0004f150: 2020 2020 2070 7269 6e74 2827 5468 6572       print('Ther
+0004f160: 6520 6973 206e 6f20 4343 4320 6a73 6f6e  e is no CCC json
+0004f170: 2066 696c 652e 2729 0a20 2020 2020 2020   file.').       
+0004f180: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
+0004f190: 723a 0a20 2020 2020 2020 2020 2020 2065  r:.            e
+0004f1a0: 7272 203d 2027 4f70 656e 2043 4343 204a  rr = 'Open CCC J
+0004f1b0: 534f 4e20 6572 726f 723a 207b 7d2e 272e  SON error: {}.'.
+0004f1c0: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
+0004f1d0: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
+0004f1e0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+0004f1f0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+0004f200: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
+0004f210: 2e77 7269 7465 2865 7272 202b 2027 5c6e  .write(err + '\n
+0004f220: 2729 0a20 2020 2020 2020 2065 6c73 653a  ').        else:
+0004f230: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0004f240: 6172 6773 2069 7320 6e6f 7420 4e6f 6e65  args is not None
+0004f250: 2061 6e64 2027 6363 6327 2069 6e20 6172   and 'ccc' in ar
+0004f260: 6773 2e6b 6579 7328 293a 0a20 2020 2020  gs.keys():.     
+0004f270: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0004f280: 7320 3d20 6172 6773 5b27 6363 6327 5d0a  s = args['ccc'].
+0004f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f2a0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0004f2b0: 2020 2020 2020 2020 2064 656c 206d 6f64           del mod
+0004f2c0: 656c 735b 2765 7272 275d 0a20 2020 2020  els['err'].     
+0004f2d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0004f2e0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0004f2f0: 2020 2020 2020 2070 7269 6e74 2827 4343         print('CC
+0004f300: 4320 6a73 6f6e 2072 6573 756c 7420 6973  C json result is
+0004f310: 2063 6f72 7265 6374 2729 0a0a 2020 2020   correct')..    
+0004f320: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0004f330: 7428 2754 6865 7265 2069 732f 6172 6520  t('There is/are 
+0004f340: 2573 206d 6f64 656c 2873 292e 2720 2520  %s model(s).' % 
+0004f350: 6c65 6e28 6d6f 6465 6c73 2929 0a20 2020  len(models)).   
+0004f360: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004f370: 2028 6b65 792c 2076 616c 7565 2920 696e   (key, value) in
+0004f380: 2069 7465 7269 7465 6d73 286d 6f64 656c   iteritems(model
+0004f390: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0004f3a0: 2020 2020 2020 2020 2320 666f 7220 286b          # for (k
+0004f3b0: 6579 322c 2076 616c 7565 3229 2069 6e20  ey2, value2) in 
+0004f3c0: 6974 6572 6974 656d 7328 7661 6c75 6529  iteritems(value)
+0004f3d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004f3e0: 2020 2020 2020 6966 2074 7970 6528 7661        if type(va
+0004f3f0: 6c75 6529 2069 7320 666c 6f61 743a 0a20  lue) is float:. 
+0004f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f410: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0004f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f430: 2020 2020 6b65 796c 6973 7420 3d20 6c69      keylist = li
+0004f440: 7374 2876 616c 7565 290a 2020 2020 2020  st(value).      
+0004f450: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0004f460: 7220 6b65 7920 696e 206b 6579 6c69 7374  r key in keylist
+0004f470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0004f480: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+0004f490: 2021 3d20 276e 616d 6527 3a0a 2020 2020   != 'name':.    
+0004f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f4b0: 2020 2020 2020 2020 636f 6c6f 7273 203d          colors =
+0004f4c0: 2076 616c 7565 5b6b 6579 5d5b 2763 6f6c   value[key]['col
+0004f4d0: 6f72 275d 0a20 2020 2020 2020 2020 2020  or'].           
+0004f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f4f0: 2072 6573 6964 7565 7320 3d20 7661 6c75   residues = valu
+0004f500: 655b 6b65 795d 5b27 7265 7369 6475 6527  e[key]['residue'
+0004f510: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0004f520: 2020 2020 2020 2020 2020 2020 2020 736d                sm
+0004f530: 6f63 7320 3d20 7661 6c75 655b 6b65 795d  ocs = value[key]
+0004f540: 5b27 6363 7363 6f72 6527 5d0a 2020 2020  ['ccscore'].    
+0004f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f560: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0004f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f580: 2020 2020 2020 6d6f 6465 6c6e 616d 6520        modelname 
+0004f590: 3d20 7661 6c75 655b 6b65 795d 0a20 2020  = value[key].   
+0004f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f5b0: 2020 2020 2020 2020 206d 6f64 656c 203d           model =
+0004f5c0: 2073 656c 662e 776f 726b 6469 7220 2b20   self.workdir + 
+0004f5d0: 6d6f 6465 6c6e 616d 650a 2020 2020 2020  modelname.      
+0004f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f5f0: 2020 2020 2020 6368 696d 6572 6166 6e61        chimerafna
+0004f600: 6d65 203d 2027 7b7d 5f7b 7d5f 6363 635f  me = '{}_{}_ccc_
+0004f610: 6368 696d 6572 612e 6378 6327 2e66 6f72  chimera.cxc'.for
+0004f620: 6d61 7428 6d6f 6465 6c6e 616d 652c 206d  mat(modelname, m
+0004f630: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
+0004f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f650: 2020 2020 7375 7266 6163 6566 6e20 3d20      surfacefn = 
+0004f660: 277b 7d7b 7d5f 7b7d 272e 666f 726d 6174  '{}{}_{}'.format
+0004f670: 2862 6173 6564 6972 2c20 6d6f 6465 6c6e  (basedir, modeln
+0004f680: 616d 652c 206d 6170 6e61 6d65 290a 2020  ame, mapname).  
+0004f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f6a0: 2020 2020 2020 2020 2020 6368 696d 6572            chimer
+0004f6b0: 6163 6d64 203d 2063 6869 6d65 7261 666e  acmd = chimerafn
+0004f6c0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+0004f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f6e0: 2320 7064 626d 6f64 656c 6e61 6d65 203d  # pdbmodelname =
+0004f6f0: 2027 7b7d 7b7d 5f5f 515f 5f7b 7d2e 7064   '{}{}__Q__{}.pd
+0004f700: 6227 2e66 6f72 6d61 7428 6261 7365 6469  b'.format(basedi
+0004f710: 722c 206d 6f64 656c 6e61 6d65 5b3a 2d34  r, modelname[:-4
+0004f720: 5d2c 206d 6170 6e61 6d65 5b3a 2d34 5d29  ], mapname[:-4])
+0004f730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f740: 2020 2020 2020 2020 2020 2020 2070 6462               pdb
+0004f750: 6d6f 6465 6c6e 616d 6520 3d20 277b 7d7b  modelname = '{}{
+0004f760: 7d27 2e66 6f72 6d61 7428 6261 7365 6469  }'.format(basedi
+0004f770: 722c 206d 6f64 656c 6e61 6d65 290a 0a20  r, modelname).. 
+0004f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f790: 2020 2077 6974 6820 6f70 656e 2873 656c     with open(sel
+0004f7a0: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
+0004f7b0: 6572 6163 6d64 2c20 2777 2729 2061 7320  eracmd, 'w') as 
+0004f7c0: 6670 3a0a 2020 2020 2020 2020 2020 2020  fp:.            
+0004f7d0: 2020 2020 2020 2020 2020 2020 6670 2e77              fp.w
+0004f7e0: 7269 7465 2822 6f70 656e 2022 202b 2073  rite("open " + s
+0004f7f0: 7472 2870 6462 6d6f 6465 6c6e 616d 6529  tr(pdbmodelname)
+0004f800: 202b 2022 2066 6f72 6d61 7420 6d6d 6369   + " format mmci
+0004f810: 6622 202b 2027 5c6e 2729 0a20 2020 2020  f" + '\n').     
+0004f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f830: 2020 2023 2066 702e 7772 6974 6528 226f     # fp.write("o
+0004f840: 7065 6e20 2220 2b20 7374 7228 7064 626d  pen " + str(pdbm
+0004f850: 6f64 656c 6e61 6d65 2920 2b20 2220 666f  odelname) + " fo
+0004f860: 726d 6174 2070 6462 2220 2b20 275c 6e27  rmat pdb" + '\n'
+0004f870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0004f880: 2020 2020 2020 2020 2020 6670 2e77 7269            fp.wri
+0004f890: 7465 2827 7368 6f77 2073 656c 4174 6f6d  te('show selAtom
+0004f8a0: 7320 7269 6262 6f6e 7327 202b 2027 5c6e  s ribbons' + '\n
+0004f8b0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0004f8c0: 2020 2020 2020 2020 2020 2066 702e 7772             fp.wr
+0004f8d0: 6974 6528 2768 6964 6520 7365 6c41 746f  ite('hide selAto
+0004f8e0: 6d73 2720 2b20 275c 6e27 290a 0a20 2020  ms' + '\n')..   
 0004f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f900: 2020 2020 2072 6573 6964 7565 7320 3d20       residues = 
-0004f910: 7661 6c75 655b 6b65 795d 5b27 7265 7369  value[key]['resi
-0004f920: 6475 6527 5d0a 2020 2020 2020 2020 2020  due'].          
-0004f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f940: 2020 736d 6f63 7320 3d20 7661 6c75 655b    smocs = value[
-0004f950: 6b65 795d 5b27 6363 7363 6f72 6527 5d0a  key]['ccscore'].
-0004f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f970: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0004f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f990: 2020 2020 2020 2020 2020 6d6f 6465 6c6e            modeln
-0004f9a0: 616d 6520 3d20 7661 6c75 655b 6b65 795d  ame = value[key]
-0004f9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f9c0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0004f9d0: 656c 203d 2073 656c 662e 776f 726b 6469  el = self.workdi
-0004f9e0: 7220 2b20 6d6f 6465 6c6e 616d 650a 2020  r + modelname.  
-0004f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa00: 2020 2020 2020 2020 2020 6368 696d 6572            chimer
-0004fa10: 6166 6e61 6d65 203d 2027 7b7d 5f7b 7d5f  afname = '{}_{}_
-0004fa20: 6363 635f 6368 696d 6572 612e 6378 6327  ccc_chimera.cxc'
-0004fa30: 2e66 6f72 6d61 7428 6d6f 6465 6c6e 616d  .format(modelnam
-0004fa40: 652c 206d 6170 6e61 6d65 290a 2020 2020  e, mapname).    
+0004f900: 2020 2020 2066 6f72 2028 636f 6c6f 722c       for (color,
+0004f910: 2072 6573 6964 7565 2c20 736d 6f63 7363   residue, smocsc
+0004f920: 6f72 6529 2069 6e20 7a69 7028 636f 6c6f  ore) in zip(colo
+0004f930: 7273 2c20 7265 7369 6475 6573 2c20 736d  rs, residues, sm
+0004f940: 6f63 7329 3a0a 2020 2020 2020 2020 2020  ocs):.          
+0004f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f960: 2020 6368 6169 6e2c 2072 6573 746d 7020    chain, restmp 
+0004f970: 3d20 7265 7369 6475 652e 7370 6c69 7428  = residue.split(
+0004f980: 273a 2729 0a20 2020 2020 2020 2020 2020  ':').           
+0004f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f9a0: 2023 204e 6f74 2073 7572 6520 6966 2061   # Not sure if a
+0004f9b0: 6c6c 2074 6865 206c 6574 7465 7273 2073  ll the letters s
+0004f9c0: 686f 756c 6420 6265 2072 6570 6c61 6365  hould be replace
+0004f9d0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0004f9e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004f9f0: 3173 7420 7761 7920 6f66 2067 6574 7469  1st way of getti
+0004fa00: 6e67 2072 6573 5f69 640a 2020 2020 2020  ng res_id.      
+0004fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fa20: 2020 2020 2020 2320 7265 735f 6964 203d        # res_id =
+0004fa30: 2072 652e 7375 6228 225c 4422 2c20 2222   re.sub("\D", ""
+0004fa40: 2c20 7265 7374 6d70 290a 2020 2020 2020  , restmp).      
 0004fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa60: 2020 2020 2020 2020 7375 7266 6163 6566          surfacef
-0004fa70: 6e20 3d20 277b 7d7b 7d5f 7b7d 272e 666f  n = '{}{}_{}'.fo
-0004fa80: 726d 6174 2862 6173 6564 6972 2c20 6d6f  rmat(basedir, mo
-0004fa90: 6465 6c6e 616d 652c 206d 6170 6e61 6d65  delname, mapname
-0004faa0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004fab0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-0004fac0: 696d 6572 6163 6d64 203d 2063 6869 6d65  imeracmd = chime
-0004fad0: 7261 666e 616d 650a 2020 2020 2020 2020  rafname.        
-0004fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004faf0: 2020 2020 2320 7064 626d 6f64 656c 6e61      # pdbmodelna
-0004fb00: 6d65 203d 2027 7b7d 7b7d 5f5f 515f 5f7b  me = '{}{}__Q__{
-0004fb10: 7d2e 7064 6227 2e66 6f72 6d61 7428 6261  }.pdb'.format(ba
-0004fb20: 7365 6469 722c 206d 6f64 656c 6e61 6d65  sedir, modelname
-0004fb30: 5b3a 2d34 5d2c 206d 6170 6e61 6d65 5b3a  [:-4], mapname[:
-0004fb40: 2d34 5d29 0a20 2020 2020 2020 2020 2020  -4]).           
-0004fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fb60: 2070 6462 6d6f 6465 6c6e 616d 6520 3d20   pdbmodelname = 
-0004fb70: 277b 7d7b 7d27 2e66 6f72 6d61 7428 6261  '{}{}'.format(ba
-0004fb80: 7365 6469 722c 206d 6f64 656c 6e61 6d65  sedir, modelname
-0004fb90: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004fba0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0004fbb0: 2873 656c 662e 776f 726b 6469 7220 2b20  (self.workdir + 
-0004fbc0: 6368 696d 6572 6163 6d64 2c20 2777 2729  chimeracmd, 'w')
-0004fbd0: 2061 7320 6670 3a0a 2020 2020 2020 2020   as fp:.        
-0004fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fbf0: 6670 2e77 7269 7465 2822 6f70 656e 2022  fp.write("open "
-0004fc00: 202b 2073 7472 2870 6462 6d6f 6465 6c6e   + str(pdbmodeln
-0004fc10: 616d 6529 202b 2022 2066 6f72 6d61 7420  ame) + " format 
-0004fc20: 6d6d 6369 6622 202b 2027 5c6e 2729 0a20  mmcif" + '\n'). 
-0004fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fc40: 2020 2020 2020 2023 2066 702e 7772 6974         # fp.writ
-0004fc50: 6528 226f 7065 6e20 2220 2b20 7374 7228  e("open " + str(
-0004fc60: 7064 626d 6f64 656c 6e61 6d65 2920 2b20  pdbmodelname) + 
-0004fc70: 2220 666f 726d 6174 2070 6462 2220 2b20  " format pdb" + 
-0004fc80: 275c 6e27 290a 2020 2020 2020 2020 2020  '\n').          
-0004fc90: 2020 2020 2020 2020 2020 2020 2020 6670                fp
-0004fca0: 2e77 7269 7465 2827 7368 6f77 2073 656c  .write('show sel
-0004fcb0: 4174 6f6d 7320 7269 6262 6f6e 7327 202b  Atoms ribbons' +
-0004fcc0: 2027 5c6e 2729 0a20 2020 2020 2020 2020   '\n').         
-0004fcd0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004fce0: 702e 7772 6974 6528 2768 6964 6520 7365  p.write('hide se
-0004fcf0: 6c41 746f 6d73 2720 2b20 275c 6e27 290a  lAtoms' + '\n').
-0004fd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004fd10: 2020 2020 2020 2020 2066 6f72 2028 636f           for (co
-0004fd20: 6c6f 722c 2072 6573 6964 7565 2c20 736d  lor, residue, sm
-0004fd30: 6f63 7363 6f72 6529 2069 6e20 7a69 7028  ocscore) in zip(
-0004fd40: 636f 6c6f 7273 2c20 7265 7369 6475 6573  colors, residues
-0004fd50: 2c20 736d 6f63 7329 3a0a 2020 2020 2020  , smocs):.      
-0004fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd70: 2020 2020 2020 6368 6169 6e2c 2072 6573        chain, res
-0004fd80: 746d 7020 3d20 7265 7369 6475 652e 7370  tmp = residue.sp
-0004fd90: 6c69 7428 273a 2729 0a20 2020 2020 2020  lit(':').       
-0004fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fdb0: 2020 2020 2023 204e 6f74 2073 7572 6520       # Not sure 
-0004fdc0: 6966 2061 6c6c 2074 6865 206c 6574 7465  if all the lette
-0004fdd0: 7273 2073 686f 756c 6420 6265 2072 6570  rs should be rep
-0004fde0: 6c61 6365 640a 2020 2020 2020 2020 2020  laced.          
-0004fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe00: 2020 2320 3173 7420 7761 7920 6f66 2067    # 1st way of g
-0004fe10: 6574 7469 6e67 2072 6573 5f69 640a 2020  etting res_id.  
-0004fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe30: 2020 2020 2020 2020 2020 2320 7265 735f            # res_
-0004fe40: 6964 203d 2072 652e 7375 6228 225c 4422  id = re.sub("\D"
-0004fe50: 2c20 2222 2c20 7265 7374 6d70 290a 2020  , "", restmp).  
+0004fa60: 2020 2020 2020 2320 326e 6420 7761 7920        # 2nd way 
+0004fa70: 6f66 2067 6574 7469 6e67 2072 6573 0a20  of getting res. 
+0004fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fa90: 2020 2020 2020 2020 2020 2072 6573 5f69             res_i
+0004faa0: 6420 3d20 7265 2e66 696e 6461 6c6c 2872  d = re.findall(r
+0004fab0: 272d 3f5c 642b 272c 2072 6573 746d 7029  '-?\d+', restmp)
+0004fac0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0004fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fae0: 6670 2e77 7269 7465 280a 2020 2020 2020  fp.write(.      
+0004faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fb00: 2020 2020 2020 2020 2020 2763 6f6c 6f72            'color
+0004fb10: 202f 2720 2b20 6368 6169 6e20 2b20 273a   /' + chain + ':
+0004fb20: 2720 2b20 7265 735f 6964 202b 2027 2027  ' + res_id + ' '
+0004fb30: 202b 2063 6f6c 6f72 202b 2027 5c6e 270a   + color + '\n'.
+0004fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fb50: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0004fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fb70: 2020 2020 2020 2020 2020 6966 2073 6d6f            if smo
+0004fb80: 6373 636f 7265 203e 2031 2e30 3a0a 2020  cscore > 1.0:.  
+0004fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fba0: 2020 2020 2020 2020 2020 2020 2020 6670                fp
+0004fbb0: 2e77 7269 7465 280a 2020 2020 2020 2020  .write(.        
+0004fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fbd0: 2020 2020 2020 2020 2020 2020 2773 686f              'sho
+0004fbe0: 7720 2f27 202b 2063 6861 696e 202b 2027  w /' + chain + '
+0004fbf0: 3a27 202b 2072 6573 5f69 6420 2b20 2720  :' + res_id + ' 
+0004fc00: 6174 6f6d 7327 202b 2027 5c6e 270a 2020  atoms' + '\n'.  
+0004fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fc30: 2020 2773 7479 6c65 202f 2720 2b20 6368    'style /' + ch
+0004fc40: 6169 6e20 2b20 273a 2720 2b20 7265 735f  ain + ':' + res_
+0004fc50: 6964 202b 2027 2073 7469 636b 2720 2b20  id + ' stick' + 
+0004fc60: 275c 6e27 0a20 2020 2020 2020 2020 2020  '\n'.           
+0004fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fc80: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0004fc90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004fca0: 702e 7772 6974 6528 0a20 2020 2020 2020  p.write(.       
+0004fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fcc0: 2020 2020 2022 7365 7420 6267 436f 6c6f       "set bgColo
+0004fcd0: 7220 7768 6974 6522 202b 2027 5c6e 270a  r white" + '\n'.
+0004fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fcf0: 2020 2020 2020 2020 2020 2020 226c 6967              "lig
+0004fd00: 6874 696e 6720 736f 6674 2220 2b20 275c  hting soft" + '\
+0004fd10: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004fd20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004fd30: 7669 6577 2063 6f66 7220 5472 7565 2220  view cofr True" 
+0004fd40: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
+0004fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fd60: 2020 2022 7361 7665 2022 202b 2073 7472     "save " + str
+0004fd70: 2873 7572 6661 6365 666e 2920 2b20 225f  (surfacefn) + "_
+0004fd80: 7a63 6363 7375 7266 6163 652e 6a70 6567  zcccsurface.jpeg
+0004fd90: 2220 2b20 2220 7375 7065 7273 616d 706c  " + " supersampl
+0004fda0: 6520 3320 7769 6474 6820 3132 3030 2068  e 3 width 1200 h
+0004fdb0: 6569 6768 7420 3132 3030 2220 2b20 275c  eight 1200" + '\
+0004fdc0: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004fdd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004fde0: 7475 726e 2078 202d 3930 2220 2b20 275c  turn x -90" + '\
+0004fdf0: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004fe00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004fe10: 7475 726e 2079 202d 3930 2220 2b20 275c  turn y -90" + '\
+0004fe20: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004fe30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004fe40: 7669 6577 2063 6f66 7220 5472 7565 2220  view cofr True" 
+0004fe50: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
 0004fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe70: 2020 2020 2020 2020 2020 2320 326e 6420            # 2nd 
-0004fe80: 7761 7920 6f66 2067 6574 7469 6e67 2072  way of getting r
-0004fe90: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
-0004fea0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004feb0: 6573 5f69 6420 3d20 7265 2e66 696e 6461  es_id = re.finda
-0004fec0: 6c6c 2872 272d 3f5c 642b 272c 2072 6573  ll(r'-?\d+', res
-0004fed0: 746d 7029 5b30 5d0a 2020 2020 2020 2020  tmp)[0].        
-0004fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fef0: 2020 2020 6670 2e77 7269 7465 280a 2020      fp.write(.  
-0004ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ff10: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0004ff20: 6f6c 6f72 202f 2720 2b20 6368 6169 6e20  olor /' + chain 
-0004ff30: 2b20 273a 2720 2b20 7265 735f 6964 202b  + ':' + res_id +
-0004ff40: 2027 2027 202b 2063 6f6c 6f72 202b 2027   ' ' + color + '
-0004ff50: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-0004ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ff70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0004ff80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004ff90: 2073 6d6f 6373 636f 7265 203e 2031 2e30   smocscore > 1.0
-0004ffa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ffc0: 2020 6670 2e77 7269 7465 280a 2020 2020    fp.write(.    
-0004ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fff0: 2773 686f 7720 2f27 202b 2063 6861 696e  'show /' + chain
-00050000: 202b 2027 3a27 202b 2072 6573 5f69 6420   + ':' + res_id 
-00050010: 2b20 2720 6174 6f6d 7327 202b 2027 5c6e  + ' atoms' + '\n
-00050020: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00050030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050040: 2020 2020 2020 2773 7479 6c65 202f 2720        'style /' 
-00050050: 2b20 6368 6169 6e20 2b20 273a 2720 2b20  + chain + ':' + 
-00050060: 7265 735f 6964 202b 2027 2073 7469 636b  res_id + ' stick
-00050070: 2720 2b20 275c 6e27 0a20 2020 2020 2020  ' + '\n'.       
+0004fe70: 2020 2022 7361 7665 2022 202b 2073 7472     "save " + str
+0004fe80: 2873 7572 6661 6365 666e 2920 2b20 225f  (surfacefn) + "_
+0004fe90: 7863 6363 7375 7266 6163 652e 6a70 6567  xcccsurface.jpeg
+0004fea0: 2220 2b20 2220 7375 7065 7273 616d 706c  " + " supersampl
+0004feb0: 6520 3320 7769 6474 6820 3132 3030 2068  e 3 width 1200 h
+0004fec0: 6569 6768 7420 3132 3030 2220 2b20 275c  eight 1200" + '\
+0004fed0: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004fee0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004fef0: 7669 6577 206f 7269 656e 7422 202b 2027  view orient" + '
+0004ff00: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0004ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ff20: 2274 7572 6e20 7820 3930 2220 2b20 275c  "turn x 90" + '\
+0004ff30: 6e27 0a20 2020 2020 2020 2020 2020 2020  n'.             
+0004ff40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004ff50: 7475 726e 207a 2039 3022 202b 2027 5c6e  turn z 90" + '\n
+0004ff60: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0004ff70: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+0004ff80: 6965 7720 636f 6672 2054 7275 6522 202b  iew cofr True" +
+0004ff90: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
+0004ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ffb0: 2020 2273 6176 6520 2220 2b20 7374 7228    "save " + str(
+0004ffc0: 7375 7266 6163 6566 6e29 202b 2022 5f79  surfacefn) + "_y
+0004ffd0: 6363 6373 7572 6661 6365 2e6a 7065 6722  cccsurface.jpeg"
+0004ffe0: 202b 2022 2073 7570 6572 7361 6d70 6c65   + " supersample
+0004fff0: 2033 2077 6964 7468 2031 3230 3020 6865   3 width 1200 he
+00050000: 6967 6874 2031 3230 3022 202b 2027 5c6e  ight 1200" + '\n
+00050010: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00050020: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+00050030: 6c6f 7365 2061 6c6c 2220 2b20 225c 6e22  lose all" + "\n"
+00050040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050050: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
+00050060: 6974 220a 2020 2020 2020 2020 2020 2020  it".            
+00050070: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
 00050080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050090: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000500a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000500b0: 2020 2066 702e 7772 6974 6528 0a20 2020     fp.write(.   
-000500c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000500d0: 2020 2020 2020 2020 2022 7365 7420 6267           "set bg
-000500e0: 436f 6c6f 7220 7768 6974 6522 202b 2027  Color white" + '
-000500f0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
-00050100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050110: 226c 6967 6874 696e 6720 736f 6674 2220  "lighting soft" 
-00050120: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-00050130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050140: 2020 2022 7669 6577 2063 6f66 7220 5472     "view cofr Tr
-00050150: 7565 2220 2b20 275c 6e27 0a20 2020 2020  ue" + '\n'.     
-00050160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050170: 2020 2020 2020 2022 7361 7665 2022 202b         "save " +
-00050180: 2073 7472 2873 7572 6661 6365 666e 2920   str(surfacefn) 
-00050190: 2b20 225f 7a63 6363 7375 7266 6163 652e  + "_zcccsurface.
-000501a0: 6a70 6567 2220 2b20 2220 7375 7065 7273  jpeg" + " supers
-000501b0: 616d 706c 6520 3320 7769 6474 6820 3132  ample 3 width 12
-000501c0: 3030 2068 6569 6768 7420 3132 3030 2220  00 height 1200" 
-000501d0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-000501e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000501f0: 2020 2022 7475 726e 2078 202d 3930 2220     "turn x -90" 
-00050200: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-00050210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050220: 2020 2022 7475 726e 2079 202d 3930 2220     "turn y -90" 
-00050230: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-00050240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050250: 2020 2022 7669 6577 2063 6f66 7220 5472     "view cofr Tr
-00050260: 7565 2220 2b20 275c 6e27 0a20 2020 2020  ue" + '\n'.     
+00050090: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000500a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000500b0: 6620 6e6f 7420 6269 6e64 6973 706c 6179  f not bindisplay
+000500c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000500d0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+000500e0: 6270 726f 6365 7373 2e63 6865 636b 5f63  bprocess.check_c
+000500f0: 616c 6c28 6c6f 6343 4849 4d45 5241 202b  all(locCHIMERA +
+00050100: 2022 202d 2d6f 6666 7363 7265 656e 202d   " --offscreen -
+00050110: 2d6e 6f67 7569 2022 202b 2073 656c 662e  -nogui " + self.
+00050120: 776f 726b 6469 7220 2b20 6368 696d 6572  workdir + chimer
+00050130: 6163 6d64 2c0a 2020 2020 2020 2020 2020  acmd,.          
+00050140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050160: 2020 2020 2020 2020 6377 643d 7365 6c66          cwd=self
+00050170: 2e77 6f72 6b64 6972 2c20 7368 656c 6c3d  .workdir, shell=
+00050180: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00050190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000501a0: 2020 7072 696e 7428 2743 6f6c 6f72 6564    print('Colored
+000501b0: 206d 6f64 656c 7320 6261 7365 6420 6f6e   models based on
+000501c0: 2043 4343 2077 6572 6520 7072 6f64 7563   CCC were produc
+000501d0: 6564 2e27 290a 2020 2020 2020 2020 2020  ed.').          
+000501e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000501f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00050200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050210: 7375 6270 726f 6365 7373 2e63 6865 636b  subprocess.check
+00050220: 5f63 616c 6c28 6c6f 6343 4849 4d45 5241  _call(locCHIMERA
+00050230: 202b 2022 2022 202b 2073 656c 662e 776f   + " " + self.wo
+00050240: 726b 6469 7220 2b20 6368 696d 6572 6163  rkdir + chimerac
+00050250: 6d64 2c20 6377 643d 7365 6c66 2e77 6f72  md, cwd=self.wor
+00050260: 6b64 6972 2c0a 2020 2020 2020 2020 2020  kdir,.          
 00050270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050280: 2020 2020 2020 2022 7361 7665 2022 202b         "save " +
-00050290: 2073 7472 2873 7572 6661 6365 666e 2920   str(surfacefn) 
-000502a0: 2b20 225f 7863 6363 7375 7266 6163 652e  + "_xcccsurface.
-000502b0: 6a70 6567 2220 2b20 2220 7375 7065 7273  jpeg" + " supers
-000502c0: 616d 706c 6520 3320 7769 6474 6820 3132  ample 3 width 12
-000502d0: 3030 2068 6569 6768 7420 3132 3030 2220  00 height 1200" 
-000502e0: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-000502f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050300: 2020 2022 7669 6577 206f 7269 656e 7422     "view orient"
-00050310: 202b 2027 5c6e 270a 2020 2020 2020 2020   + '\n'.        
-00050320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050330: 2020 2020 2274 7572 6e20 7820 3930 2220      "turn x 90" 
-00050340: 2b20 275c 6e27 0a20 2020 2020 2020 2020  + '\n'.         
-00050350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050360: 2020 2022 7475 726e 207a 2039 3022 202b     "turn z 90" +
-00050370: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-00050380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050390: 2020 2276 6965 7720 636f 6672 2054 7275    "view cofr Tru
-000503a0: 6522 202b 2027 5c6e 270a 2020 2020 2020  e" + '\n'.      
-000503b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000503c0: 2020 2020 2020 2273 6176 6520 2220 2b20        "save " + 
-000503d0: 7374 7228 7375 7266 6163 6566 6e29 202b  str(surfacefn) +
-000503e0: 2022 5f79 6363 6373 7572 6661 6365 2e6a   "_ycccsurface.j
-000503f0: 7065 6722 202b 2022 2073 7570 6572 7361  peg" + " supersa
-00050400: 6d70 6c65 2033 2077 6964 7468 2031 3230  mple 3 width 120
-00050410: 3020 6865 6967 6874 2031 3230 3022 202b  0 height 1200" +
-00050420: 2027 5c6e 270a 2020 2020 2020 2020 2020   '\n'.          
-00050430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050440: 2020 2263 6c6f 7365 2061 6c6c 2220 2b20    "close all" + 
-00050450: 225c 6e22 0a20 2020 2020 2020 2020 2020  "\n".           
+00050280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050290: 2020 2020 2020 2020 7368 656c 6c3d 5472          shell=Tr
+000502a0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000502b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000502c0: 7072 696e 7428 2743 6f6c 6f72 6564 206d  print('Colored m
+000502d0: 6f64 656c 7320 6261 7365 6420 6f6e 2043  odels based on C
+000502e0: 4343 2077 6572 6520 7072 6f64 7563 6564  CC were produced
+000502f0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+00050300: 2020 2020 2020 2020 6578 6365 7074 2073          except s
+00050310: 7562 7072 6f63 6573 732e 4361 6c6c 6564  ubprocess.Called
+00050320: 5072 6f63 6573 7345 7272 6f72 2061 7320  ProcessError as 
+00050330: 7375 6265 7272 3a0a 2020 2020 2020 2020  suberr:.        
+00050340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050350: 6572 7220 3d20 2753 6176 696e 6720 6d6f  err = 'Saving mo
+00050360: 6465 6c20 7b7d 2043 4343 2076 6965 7720  del {} CCC view 
+00050370: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
+00050380: 6174 286d 6f64 656c 6e61 6d65 2c20 7375  at(modelname, su
+00050390: 6265 7272 290a 2020 2020 2020 2020 2020  berr).          
+000503a0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+000503b0: 726c 6973 742e 6170 7065 6e64 2865 7272  rlist.append(err
+000503c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000503d0: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
+000503e0: 6465 7272 2e77 7269 7465 2865 7272 202b  derr.write(err +
+000503f0: 2027 5c6e 2729 0a0a 2020 2020 2020 2020   '\n')..        
+00050400: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00050410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050420: 2020 2020 2020 2020 2073 656c 662e 7363           self.sc
+00050430: 616c 655f 7375 7266 6163 6576 6965 7728  ale_surfaceview(
+00050440: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00050450: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
 00050460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050470: 2022 6578 6974 220a 2020 2020 2020 2020   "exit".        
-00050480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000504a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000504b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000504c0: 2020 2069 6620 6e6f 7420 6269 6e64 6973     if not bindis
-000504d0: 706c 6179 3a0a 2020 2020 2020 2020 2020  play:.          
-000504e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000504f0: 2020 7375 6270 726f 6365 7373 2e63 6865    subprocess.che
-00050500: 636b 5f63 616c 6c28 6c6f 6343 4849 4d45  ck_call(locCHIME
-00050510: 5241 202b 2022 202d 2d6f 6666 7363 7265  RA + " --offscre
-00050520: 656e 202d 2d6e 6f67 7569 2022 202b 2073  en --nogui " + s
-00050530: 656c 662e 776f 726b 6469 7220 2b20 6368  elf.workdir + ch
-00050540: 696d 6572 6163 6d64 2c0a 2020 2020 2020  imeracmd,.      
-00050550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050570: 2020 2020 2020 2020 2020 2020 6377 643d              cwd=
-00050580: 7365 6c66 2e77 6f72 6b64 6972 2c20 7368  self.workdir, sh
-00050590: 656c 6c3d 5472 7565 290a 2020 2020 2020  ell=True).      
-000505a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000505b0: 2020 2020 2020 7072 696e 7428 2743 6f6c        print('Col
-000505c0: 6f72 6564 206d 6f64 656c 7320 6261 7365  ored models base
-000505d0: 6420 6f6e 2043 4343 2077 6572 6520 7072  d on CCC were pr
-000505e0: 6f64 7563 6564 2e27 290a 2020 2020 2020  oduced.').      
-000505f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050600: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00050610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050620: 2020 2020 7375 6270 726f 6365 7373 2e63      subprocess.c
-00050630: 6865 636b 5f63 616c 6c28 6c6f 6343 4849  heck_call(locCHI
-00050640: 4d45 5241 202b 2022 2022 202b 2073 656c  MERA + " " + sel
-00050650: 662e 776f 726b 6469 7220 2b20 6368 696d  f.workdir + chim
-00050660: 6572 6163 6d64 2c20 6377 643d 7365 6c66  eracmd, cwd=self
-00050670: 2e77 6f72 6b64 6972 2c0a 2020 2020 2020  .workdir,.      
-00050680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000506a0: 2020 2020 2020 2020 2020 2020 7368 656c              shel
-000506b0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-000506c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000506d0: 2020 2020 7072 696e 7428 2743 6f6c 6f72      print('Color
-000506e0: 6564 206d 6f64 656c 7320 6261 7365 6420  ed models based 
-000506f0: 6f6e 2043 4343 2077 6572 6520 7072 6f64  on CCC were prod
-00050700: 7563 6564 2e27 290a 2020 2020 2020 2020  uced.').        
-00050710: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00050720: 7074 2073 7562 7072 6f63 6573 732e 4361  pt subprocess.Ca
-00050730: 6c6c 6564 5072 6f63 6573 7345 7272 6f72  lledProcessError
-00050740: 2061 7320 7375 6265 7272 3a0a 2020 2020   as suberr:.    
+00050470: 2020 2020 2020 6572 7220 3d20 2753 6361        err = 'Sca
+00050480: 6c69 6e67 206d 6f64 656c 2043 4343 2076  ling model CCC v
+00050490: 6965 7720 6572 726f 723a 207b 7d2e 272e  iew error: {}.'.
+000504a0: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
+000504b0: 6e66 6f28 295b 315d 290a 2020 2020 2020  nfo()[1]).      
+000504c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000504d0: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
+000504e0: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
+000504f0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00050500: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
+00050510: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
+00050520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050530: 6a70 6567 7320 3d20 676c 6f62 2e67 6c6f  jpegs = glob.glo
+00050540: 6228 7365 6c66 2e77 6f72 6b64 6972 202b  b(self.workdir +
+00050550: 2027 2f2a 6363 6373 7572 6661 6365 2e6a   '/*cccsurface.j
+00050560: 7065 6727 290a 2020 2020 2020 2020 2020  peg').          
+00050570: 2020 2020 2020 2020 2020 6d6f 6465 6c73            models
+00050580: 7572 6620 3d20 6469 6374 2829 0a20 2020  urf = dict().   
+00050590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000505a0: 2066 696e 616c 6d6d 6469 6374 203d 2064   finalmmdict = d
+000505b0: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
+000505c0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000505d0: 662e 6d6f 6465 6c73 3a0a 2020 2020 2020  f.models:.      
+000505e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000505f0: 2020 2320 7072 696e 7420 2273 656c 662e    # print "self.
+00050600: 6d6f 6465 6c73 3a25 7322 2025 2073 656c  models:%s" % sel
+00050610: 662e 6d6f 6465 6c73 0a20 2020 2020 2020  f.models.       
+00050620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050630: 2066 6f72 206d 6f64 656c 2069 6e20 7365   for model in se
+00050640: 6c66 2e6d 6f64 656c 733a 0a20 2020 2020  lf.models:.     
+00050650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050660: 2020 2020 2020 206d 6f64 656c 6e61 6d65         modelname
+00050670: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00050680: 616d 6528 6d6f 6465 6c2e 6669 6c65 6e61  ame(model.filena
+00050690: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+000506a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000506b0: 7375 7266 6163 6566 6e20 3d20 277b 7d5f  surfacefn = '{}_
+000506c0: 7b7d 272e 666f 726d 6174 286d 6f64 656c  {}'.format(model
+000506d0: 6e61 6d65 2c20 7365 6c66 2e6d 6170 6e61  name, self.mapna
+000506e0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+000506f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050700: 6d6f 6465 6c6d 6170 7375 7266 6163 6520  modelmapsurface 
+00050710: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
+00050720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050730: 2020 2020 2066 6f72 206a 7065 6720 696e       for jpeg in
+00050740: 206a 7065 6773 3a0a 2020 2020 2020 2020   jpegs:.        
 00050750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050760: 2020 2020 6572 7220 3d20 2753 6176 696e      err = 'Savin
-00050770: 6720 6d6f 6465 6c20 7b7d 2043 4343 2076  g model {} CCC v
-00050780: 6965 7720 6572 726f 723a 207b 7d2e 272e  iew error: {}.'.
-00050790: 666f 726d 6174 286d 6f64 656c 6e61 6d65  format(modelname
-000507a0: 2c20 7375 6265 7272 290a 2020 2020 2020  , suberr).      
-000507b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000507c0: 2020 6572 726c 6973 742e 6170 7065 6e64    errlist.append
-000507d0: 2865 7272 290a 2020 2020 2020 2020 2020  (err).          
-000507e0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-000507f0: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
-00050800: 7272 202b 2027 5c6e 2729 0a0a 2020 2020  rr + '\n')..    
-00050810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050820: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00050830: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00050840: 662e 7363 616c 655f 7375 7266 6163 6576  f.scale_surfacev
-00050850: 6965 7728 290a 2020 2020 2020 2020 2020  iew().          
-00050860: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00050870: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00050880: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
-00050890: 2753 6361 6c69 6e67 206d 6f64 656c 2043  'Scaling model C
-000508a0: 4343 2076 6965 7720 6572 726f 723a 207b  CC view error: {
-000508b0: 7d2e 272e 666f 726d 6174 2873 7973 2e65  }.'.format(sys.e
-000508c0: 7863 5f69 6e66 6f28 295b 315d 290a 2020  xc_info()[1]).  
-000508d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000508e0: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
-000508f0: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+00050760: 2020 2020 2020 2020 6966 206d 6f64 656c          if model
+00050770: 6e61 6d65 2069 6e20 6a70 6567 2061 6e64  name in jpeg and
+00050780: 2027 7863 6363 2720 696e 206a 7065 673a   'xccc' in jpeg:
+00050790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000507a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000507b0: 2020 2020 206d 6f64 656c 6d61 7073 7572       modelmapsur
+000507c0: 6661 6365 5b27 7827 5d20 3d20 7374 7228  face['x'] = str(
+000507d0: 7375 7266 6163 6566 6e29 202b 2027 5f73  surfacefn) + '_s
+000507e0: 6361 6c65 645f 7863 6363 7375 7266 6163  caled_xcccsurfac
+000507f0: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
+00050800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050810: 2020 2020 2020 2020 6966 206d 6f64 656c          if model
+00050820: 6e61 6d65 2069 6e20 6a70 6567 2061 6e64  name in jpeg and
+00050830: 2027 7963 6363 2720 696e 206a 7065 673a   'yccc' in jpeg:
+00050840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050860: 2020 2020 206d 6f64 656c 6d61 7073 7572       modelmapsur
+00050870: 6661 6365 5b27 7927 5d20 3d20 7374 7228  face['y'] = str(
+00050880: 7375 7266 6163 6566 6e29 202b 2027 5f73  surfacefn) + '_s
+00050890: 6361 6c65 645f 7963 6363 7375 7266 6163  caled_ycccsurfac
+000508a0: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
+000508b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000508c0: 2020 2020 2020 2020 6966 206d 6f64 656c          if model
+000508d0: 6e61 6d65 2069 6e20 6a70 6567 2061 6e64  name in jpeg and
+000508e0: 2027 7a63 6363 2720 696e 206a 7065 673a   'zccc' in jpeg:
+000508f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00050900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050910: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-00050920: 7465 2865 7272 202b 2027 5c6e 2729 0a0a  te(err + '\n')..
-00050930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050940: 2020 2020 6a70 6567 7320 3d20 676c 6f62      jpegs = glob
-00050950: 2e67 6c6f 6228 7365 6c66 2e77 6f72 6b64  .glob(self.workd
-00050960: 6972 202b 2027 2f2a 6363 6373 7572 6661  ir + '/*cccsurfa
-00050970: 6365 2e6a 7065 6727 290a 2020 2020 2020  ce.jpeg').      
-00050980: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00050990: 6465 6c73 7572 6620 3d20 6469 6374 2829  delsurf = dict()
-000509a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000509b0: 2020 2020 2066 696e 616c 6d6d 6469 6374       finalmmdict
-000509c0: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-000509d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000509e0: 2073 656c 662e 6d6f 6465 6c73 3a0a 2020   self.models:.  
-000509f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a00: 2020 2020 2020 2320 7072 696e 7420 2273        # print "s
-00050a10: 656c 662e 6d6f 6465 6c73 3a25 7322 2025  elf.models:%s" %
-00050a20: 2073 656c 662e 6d6f 6465 6c73 0a20 2020   self.models.   
-00050a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a40: 2020 2020 2066 6f72 206d 6f64 656c 2069       for model i
-00050a50: 6e20 7365 6c66 2e6d 6f64 656c 733a 0a20  n self.models:. 
-00050a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a70: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-00050a80: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-00050a90: 6173 656e 616d 6528 6d6f 6465 6c2e 6669  asename(model.fi
-00050aa0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-00050ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ac0: 2020 2020 7375 7266 6163 6566 6e20 3d20      surfacefn = 
-00050ad0: 277b 7d5f 7b7d 272e 666f 726d 6174 286d  '{}_{}'.format(m
-00050ae0: 6f64 656c 6e61 6d65 2c20 7365 6c66 2e6d  odelname, self.m
-00050af0: 6170 6e61 6d65 290a 2020 2020 2020 2020  apname).        
-00050b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050b10: 2020 2020 6d6f 6465 6c6d 6170 7375 7266      modelmapsurf
-00050b20: 6163 6520 3d20 6469 6374 2829 0a20 2020  ace = dict().   
-00050b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050b40: 2020 2020 2020 2020 2066 6f72 206a 7065           for jpe
-00050b50: 6720 696e 206a 7065 6773 3a0a 2020 2020  g in jpegs:.    
-00050b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050b70: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00050b80: 6f64 656c 6e61 6d65 2069 6e20 6a70 6567  odelname in jpeg
-00050b90: 2061 6e64 2027 7863 6363 2720 696e 206a   and 'xccc' in j
-00050ba0: 7065 673a 0a20 2020 2020 2020 2020 2020  peg:.           
+00050910: 2020 2020 206d 6f64 656c 6d61 7073 7572       modelmapsur
+00050920: 6661 6365 5b27 7a27 5d20 3d20 7374 7228  face['z'] = str(
+00050930: 7375 7266 6163 6566 6e29 202b 2027 5f73  surfacefn) + '_s
+00050940: 6361 6c65 645f 7a63 6363 7375 7266 6163  caled_zcccsurfac
+00050950: 652e 6a70 6567 270a 2020 2020 2020 2020  e.jpeg'.        
+00050960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050970: 2020 2020 6966 2065 7272 6c69 7374 3a0a      if errlist:.
+00050980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000509a0: 6d6f 6465 6c6d 6170 7375 7266 6163 655b  modelmapsurface[
+000509b0: 2765 7272 275d 203d 207b 2763 6363 5f65  'err'] = {'ccc_e
+000509c0: 7272 273a 2065 7272 6c69 7374 7d0a 2020  rr': errlist}.  
+000509d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000509e0: 2020 2020 2020 2020 2020 6d6f 6465 6c73            models
+000509f0: 7572 665b 6d6f 6465 6c6e 616d 655d 203d  urf[modelname] =
+00050a00: 206d 6f64 656c 6d61 7073 7572 6661 6365   modelmapsurface
+00050a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050a20: 2020 2020 2020 2020 2066 696e 616c 6d6d           finalmm
+00050a30: 6469 6374 5b27 6363 6373 636f 7265 5f73  dict['cccscore_s
+00050a40: 7572 6661 6365 275d 203d 206d 6f64 656c  urface'] = model
+00050a50: 7375 7266 0a0a 2020 2020 2020 2020 2020  surf..          
+00050a60: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00050a70: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00050a80: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00050a90: 6974 6820 636f 6465 6373 2e6f 7065 6e28  ith codecs.open(
+00050aa0: 7365 6c66 2e77 6f72 6b64 6972 202b 2073  self.workdir + s
+00050ab0: 656c 662e 6d61 706e 616d 6520 2b20 275f  elf.mapname + '_
+00050ac0: 6363 6376 6965 772e 6a73 6f6e 272c 2027  cccview.json', '
+00050ad0: 7727 2c0a 2020 2020 2020 2020 2020 2020  w',.            
+00050ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b00: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
+00050b10: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
+00050b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b30: 2020 2020 2020 2020 206a 736f 6e2e 6475           json.du
+00050b40: 6d70 2866 696e 616c 6d6d 6469 6374 2c20  mp(finalmmdict, 
+00050b50: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
+00050b60: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00050b70: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00050b80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00050b90: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
+00050ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00050bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050bc0: 2020 2020 2020 2020 206d 6f64 656c 6d61           modelma
-00050bd0: 7073 7572 6661 6365 5b27 7827 5d20 3d20  psurface['x'] = 
-00050be0: 7374 7228 7375 7266 6163 6566 6e29 202b  str(surfacefn) +
-00050bf0: 2027 5f73 6361 6c65 645f 7863 6363 7375   '_scaled_xcccsu
-00050c00: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
-00050c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050c20: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00050c30: 6f64 656c 6e61 6d65 2069 6e20 6a70 6567  odelname in jpeg
-00050c40: 2061 6e64 2027 7963 6363 2720 696e 206a   and 'yccc' in j
-00050c50: 7065 673a 0a20 2020 2020 2020 2020 2020  peg:.           
-00050c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050c70: 2020 2020 2020 2020 206d 6f64 656c 6d61           modelma
-00050c80: 7073 7572 6661 6365 5b27 7927 5d20 3d20  psurface['y'] = 
-00050c90: 7374 7228 7375 7266 6163 6566 6e29 202b  str(surfacefn) +
-00050ca0: 2027 5f73 6361 6c65 645f 7963 6363 7375   '_scaled_ycccsu
-00050cb0: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
-00050cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050cd0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00050ce0: 6f64 656c 6e61 6d65 2069 6e20 6a70 6567  odelname in jpeg
-00050cf0: 2061 6e64 2027 7a63 6363 2720 696e 206a   and 'zccc' in j
-00050d00: 7065 673a 0a20 2020 2020 2020 2020 2020  peg:.           
-00050d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050d20: 2020 2020 2020 2020 206d 6f64 656c 6d61           modelma
-00050d30: 7073 7572 6661 6365 5b27 7a27 5d20 3d20  psurface['z'] = 
-00050d40: 7374 7228 7375 7266 6163 6566 6e29 202b  str(surfacefn) +
-00050d50: 2027 5f73 6361 6c65 645f 7a63 6363 7375   '_scaled_zcccsu
-00050d60: 7266 6163 652e 6a70 6567 270a 2020 2020  rface.jpeg'.    
-00050d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050d80: 2020 2020 2020 2020 6966 2065 7272 6c69          if errli
-00050d90: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
-00050da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050db0: 2020 2020 6d6f 6465 6c6d 6170 7375 7266      modelmapsurf
-00050dc0: 6163 655b 2765 7272 275d 203d 207b 2763  ace['err'] = {'c
-00050dd0: 6363 5f65 7272 273a 2065 7272 6c69 7374  cc_err': errlist
-00050de0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00050df0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00050e00: 6465 6c73 7572 665b 6d6f 6465 6c6e 616d  delsurf[modelnam
-00050e10: 655d 203d 206d 6f64 656c 6d61 7073 7572  e] = modelmapsur
-00050e20: 6661 6365 0a20 2020 2020 2020 2020 2020  face.           
-00050e30: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-00050e40: 616c 6d6d 6469 6374 5b27 6363 6373 636f  almmdict['cccsco
-00050e50: 7265 5f73 7572 6661 6365 275d 203d 206d  re_surface'] = m
-00050e60: 6f64 656c 7375 7266 0a0a 2020 2020 2020  odelsurf..      
-00050e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050e80: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00050e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ea0: 2020 2077 6974 6820 636f 6465 6373 2e6f     with codecs.o
-00050eb0: 7065 6e28 7365 6c66 2e77 6f72 6b64 6972  pen(self.workdir
-00050ec0: 202b 2073 656c 662e 6d61 706e 616d 6520   + self.mapname 
-00050ed0: 2b20 275f 6363 6376 6965 772e 6a73 6f6e  + '_cccview.json
-00050ee0: 272c 2027 7727 2c0a 2020 2020 2020 2020  ', 'w',.        
-00050ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050f10: 2020 2020 2065 6e63 6f64 696e 673d 2775       encoding='u
-00050f20: 7466 2d38 2729 2061 7320 663a 0a20 2020  tf-8') as f:.   
-00050f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050f40: 2020 2020 2020 2020 2020 2020 206a 736f               jso
-00050f50: 6e2e 6475 6d70 2866 696e 616c 6d6d 6469  n.dump(finalmmdi
-00050f60: 6374 2c20 6629 0a20 2020 2020 2020 2020  ct, f).         
-00050f70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00050f80: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-00050f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050fa0: 2020 2073 7973 2e73 7464 6572 722e 7772     sys.stderr.wr
-00050fb0: 6974 6528 0a20 2020 2020 2020 2020 2020  ite(.           
-00050fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050fd0: 2020 2020 2027 5361 7669 6e67 2043 4343       'Saving CCC
-00050fe0: 2076 6965 7720 746f 204a 534f 4e20 6572   view to JSON er
-00050ff0: 726f 723a 207b 7d2e 5c6e 272e 666f 726d  ror: {}.\n'.form
-00051000: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-00051010: 295b 315d 2929 0a0a 2020 2020 2020 2020  )[1]))..        
-00051020: 2020 2020 2020 2020 656e 6420 3d20 7469          end = ti
-00051030: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-00051040: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-00051050: 2020 2020 2070 7269 6e74 2827 4343 4320       print('CCC 
-00051060: 7375 7266 6163 6520 7469 6d65 3a20 2573  surface time: %s
-00051070: 2720 2520 2865 6e64 202d 2073 7461 7274  ' % (end - start
+00050bc0: 2027 5361 7669 6e67 2043 4343 2076 6965   'Saving CCC vie
+00050bd0: 7720 746f 204a 534f 4e20 6572 726f 723a  w to JSON error:
+00050be0: 207b 7d2e 5c6e 272e 666f 726d 6174 2873   {}.\n'.format(s
+00050bf0: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+00050c00: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00050c10: 2020 2020 656e 6420 3d20 7469 6d65 6974      end = timeit
+00050c20: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
+00050c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050c40: 2070 7269 6e74 2827 4343 4320 7375 7266   print('CCC surf
+00050c50: 6163 6520 7469 6d65 3a20 2573 2720 2520  ace time: %s' % 
+00050c60: 2865 6e64 202d 2073 7461 7274 2929 0a20  (end - start)). 
+00050c70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00050c80: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
+00050c90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00050ca0: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020  ----------')..  
+00050cb0: 2020 6465 6620 6363 5f73 7572 6661 6365    def cc_surface
+00050cc0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00050cd0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00050ce0: 2076 746b 7061 636b 2c20 6368 696d 6572   vtkpack, chimer
+00050cf0: 6161 7070 203d 2073 656c 662e 7375 7266  aapp = self.surf
+00050d00: 6163 655f 656e 7663 6865 636b 2829 0a20  ace_envcheck(). 
+00050d10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00050d20: 6363 7363 6f72 6576 6965 7728 6368 696d  ccscoreview(chim
+00050d30: 6572 6161 7070 290a 2020 2020 2020 2020  eraapp).        
+00050d40: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00050d50: 2020 2020 6572 7220 3d20 2743 4343 2073      err = 'CCC s
+00050d60: 7572 6661 6365 2076 6965 7720 6661 696c  urface view fail
+00050d70: 6564 3a20 7b7d 272e 666f 726d 6174 2873  ed: {}'.format(s
+00050d80: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+00050d90: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00050da0: 696e 7428 7472 6163 6562 6163 6b2e 666f  int(traceback.fo
+00050db0: 726d 6174 5f65 7863 2829 290a 2020 2020  rmat_exc()).    
+00050dc0: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+00050dd0: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
+00050de0: 5c6e 2729 0a0a 2020 2020 6465 6620 7068  \n')..    def ph
+00050df0: 656e 6978 5f6d 6d66 7363 2873 656c 6629  enix_mmfsc(self)
+00050e00: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00050e10: 2020 2020 2020 2020 2020 5275 6e20 5068            Run Ph
+00050e20: 656e 6978 206d 6170 2d6d 6f64 656c 2046  enix map-model F
+00050e30: 5343 2063 616c 6375 6c61 7469 6f6e 0a20  SC calculation. 
+00050e40: 2020 2020 2020 203a 7265 7475 726e 3a0a         :return:.
+00050e50: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00050e60: 2020 2020 2069 6620 7365 6c66 2e70 6c61       if self.pla
+00050e70: 7466 6f72 6d20 3d3d 2027 656d 6462 2720  tform == 'emdb' 
+00050e80: 616e 6420 7365 6c66 2e6d 6574 2021 3d20  and self.met != 
+00050e90: 2774 6f6d 6f27 2061 6e64 2073 656c 662e  'tomo' and self.
+00050ea0: 6d65 7420 213d 2027 6372 7973 2720 3a0a  met != 'crys' :.
+00050eb0: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00050ec0: 7420 3d20 7469 6d65 6974 2e64 6566 6175  t = timeit.defau
+00050ed0: 6c74 5f74 696d 6572 2829 0a20 2020 2020  lt_timer().     
+00050ee0: 2020 2020 2020 2065 7272 6c69 7374 203d         errlist =
+00050ef0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00050f00: 7265 7375 6c74 5f64 6963 7420 3d20 7b7d  result_dict = {}
+00050f10: 0a20 2020 2020 2020 2020 2020 2072 6177  .            raw
+00050f20: 5f72 6573 756c 745f 6469 6374 203d 207b  _result_dict = {
+00050f30: 7d0a 2020 2020 2020 2020 2020 2020 2320  }.            # 
+00050f40: 6966 2073 7472 7564 656c 6170 7020 616e  if strudelapp an
+00050f50: 6420 7365 6c66 2e6d 6f64 656c 733a 0a20  d self.models:. 
+00050f60: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00050f70: 6c66 2e6d 6f64 656c 733a 0a20 2020 2020  lf.models:.     
+00050f80: 2020 2020 2020 2020 2020 206e 756d 6d6f             nummo
+00050f90: 6465 6c73 203d 2030 0a20 2020 2020 2020  dels = 0.       
+00050fa0: 2020 2020 2020 2020 2061 6c6c 7265 7375           allresu
+00050fb0: 6c74 7320 3d20 7b7d 0a20 2020 2020 2020  lts = {}.       
+00050fc0: 2020 2020 2020 2020 2072 6177 5f61 6c6c           raw_all
+00050fd0: 7265 7375 6c74 7320 3d20 7b7d 0a20 2020  results = {}.   
+00050fe0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00050ff0: 206d 6f64 656c 2069 6e20 7365 6c66 2e6d   model in self.m
+00051000: 6f64 656c 733a 0a20 2020 2020 2020 2020  odels:.         
+00051010: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00051020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051030: 2020 2020 2020 2020 6675 6c6c 5f6d 6f64          full_mod
+00051040: 656c 203d 2027 7b7d 7b7d 272e 666f 726d  el = '{}{}'.form
+00051050: 6174 2873 656c 662e 776f 726b 6469 722c  at(self.workdir,
+00051060: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+00051070: 6528 6d6f 6465 6c2e 6669 6c65 6e61 6d65  e(model.filename
 00051080: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00051090: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
-000510a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000510b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-000510c0: 0a0a 2020 2020 6465 6620 6363 5f73 7572  ..    def cc_sur
-000510d0: 6661 6365 2873 656c 6629 3a0a 2020 2020  face(self):.    
-000510e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000510f0: 2020 2020 2076 746b 7061 636b 2c20 6368       vtkpack, ch
-00051100: 696d 6572 6161 7070 203d 2073 656c 662e  imeraapp = self.
-00051110: 7375 7266 6163 655f 656e 7663 6865 636b  surface_envcheck
-00051120: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00051130: 656c 662e 6363 7363 6f72 6576 6965 7728  elf.ccscoreview(
-00051140: 6368 696d 6572 6161 7070 290a 2020 2020  chimeraapp).    
-00051150: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00051160: 2020 2020 2020 2020 6572 7220 3d20 2743          err = 'C
-00051170: 4343 2073 7572 6661 6365 2076 6965 7720  CC surface view 
-00051180: 6661 696c 6564 3a20 7b7d 272e 666f 726d  failed: {}'.form
-00051190: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-000511a0: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-000511b0: 2020 7072 696e 7428 7472 6163 6562 6163    print(tracebac
-000511c0: 6b2e 666f 726d 6174 5f65 7863 2829 290a  k.format_exc()).
-000511d0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-000511e0: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
-000511f0: 202b 2027 5c6e 2729 0a0a 2020 2020 6465   + '\n')..    de
-00051200: 6620 7068 656e 6978 5f6d 6d66 7363 2873  f phenix_mmfsc(s
-00051210: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00051220: 220a 2020 2020 2020 2020 2020 2020 5275  ".            Ru
-00051230: 6e20 5068 656e 6978 206d 6170 2d6d 6f64  n Phenix map-mod
-00051240: 656c 2046 5343 2063 616c 6375 6c61 7469  el FSC calculati
-00051250: 6f6e 0a20 2020 2020 2020 203a 7265 7475  on.        :retu
-00051260: 726e 3a0a 2020 2020 2020 2020 2222 220a  rn:.        """.
-00051270: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00051280: 2e70 6c61 7466 6f72 6d20 3d3d 2027 656d  .platform == 'em
-00051290: 6462 2720 616e 6420 7365 6c66 2e6d 6574  db' and self.met
-000512a0: 2021 3d20 2774 6f6d 6f27 2061 6e64 2073   != 'tomo' and s
-000512b0: 656c 662e 6d65 7420 213d 2027 6372 7973  elf.met != 'crys
-000512c0: 2720 3a0a 2020 2020 2020 2020 2020 2020  ' :.            
-000512d0: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
-000512e0: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
-000512f0: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
-00051300: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00051310: 2020 2020 7265 7375 6c74 5f64 6963 7420      result_dict 
-00051320: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-00051330: 2072 6177 5f72 6573 756c 745f 6469 6374   raw_result_dict
-00051340: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-00051350: 2020 2320 6966 2073 7472 7564 656c 6170    # if strudelap
-00051360: 7020 616e 6420 7365 6c66 2e6d 6f64 656c  p and self.model
-00051370: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00051380: 6620 7365 6c66 2e6d 6f64 656c 733a 0a20  f self.models:. 
-00051390: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000513a0: 756d 6d6f 6465 6c73 203d 2030 0a20 2020  ummodels = 0.   
-000513b0: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
-000513c0: 7265 7375 6c74 7320 3d20 7b7d 0a20 2020  results = {}.   
-000513d0: 2020 2020 2020 2020 2020 2020 2072 6177               raw
-000513e0: 5f61 6c6c 7265 7375 6c74 7320 3d20 7b7d  _allresults = {}
-000513f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051400: 2066 6f72 206d 6f64 656c 2069 6e20 7365   for model in se
-00051410: 6c66 2e6d 6f64 656c 733a 0a20 2020 2020  lf.models:.     
-00051420: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00051430: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00051440: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
-00051450: 5f6d 6f64 656c 203d 2027 7b7d 7b7d 272e  _model = '{}{}'.
-00051460: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
-00051470: 6469 722c 206f 732e 7061 7468 2e62 6173  dir, os.path.bas
-00051480: 656e 616d 6528 6d6f 6465 6c2e 6669 6c65  ename(model.file
-00051490: 6e61 6d65 2929 0a20 2020 2020 2020 2020  name)).         
-000514a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000514b0: 756c 6c5f 6d61 7020 3d20 277b 7d7b 7d27  ull_map = '{}{}'
-000514c0: 2e66 6f72 6d61 7428 7365 6c66 2e77 6f72  .format(self.wor
-000514d0: 6b64 6972 2c20 7365 6c66 2e6d 6170 6e61  kdir, self.mapna
-000514e0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-000514f0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-00051500: 7061 7468 203d 2027 7b7d 5f70 6865 6e69  path = '{}_pheni
-00051510: 7827 2e66 6f72 6d61 7428 6675 6c6c 5f6d  x'.format(full_m
-00051520: 6f64 656c 290a 2020 2020 2020 2020 2020  odel).          
-00051530: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00051540: 7272 203d 2072 756e 5f70 6865 6e69 786d  rr = run_phenixm
-00051550: 6d66 7363 2866 756c 6c5f 6d6f 6465 6c2c  mfsc(full_model,
-00051560: 2066 756c 6c5f 6d61 702c 206f 7574 5f70   full_map, out_p
-00051570: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-00051580: 2020 2020 2020 2020 2020 2020 2074 6d6d               tmm
-00051590: 6673 636c 6f67 203d 2027 7b7d 2f66 7363  fsclog = '{}/fsc
-000515a0: 5f6d 6f64 656c 2e75 6e6d 6173 6b65 642e  _model.unmasked.
-000515b0: 6d74 7269 6167 652e 6c6f 6727 2e66 6f72  mtriage.log'.for
-000515c0: 6d61 7428 6f75 745f 7061 7468 290a 2020  mat(out_path).  
-000515d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000515e0: 2020 2020 2020 6d6d 6673 636c 6f67 203d        mmfsclog =
-000515f0: 2027 7b7d 2f66 7363 5f6d 6f64 656c 2e75   '{}/fsc_model.u
-00051600: 6e6d 6173 6b65 642e 6d74 7269 6167 655f  nmasked.mtriage_
-00051610: 7b7d 2e6c 6f67 272e 666f 726d 6174 286f  {}.log'.format(o
-00051620: 7574 5f70 6174 682c 2073 656c 662e 6d61  ut_path, self.ma
-00051630: 706e 616d 6529 0a20 2020 2020 2020 2020  pname).         
-00051640: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00051650: 6861 6e67 655f 6669 6c65 6e61 6d65 2874  hange_filename(t
-00051660: 6d6d 6673 636c 6f67 2c20 6d6d 6673 636c  mmfsclog, mmfscl
-00051670: 6f67 290a 2020 2020 2020 2020 2020 2020  og).            
-00051680: 2020 2020 2020 2020 2020 2020 7261 775f              raw_
-00051690: 6d6d 6673 636c 6f67 203d 204e 6f6e 650a  mmfsclog = None.
-000516a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000516b0: 2020 2020 2020 2020 7261 775f 7265 7272          raw_rerr
-000516c0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-000516d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000516e0: 6966 2073 656c 662e 686d 6f64 6420 616e  if self.hmodd an
-000516f0: 6420 7365 6c66 2e68 6d65 7665 6e3a 0a20  d self.hmeven:. 
+00051090: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+000510a0: 6d61 7020 3d20 277b 7d7b 7d27 2e66 6f72  map = '{}{}'.for
+000510b0: 6d61 7428 7365 6c66 2e77 6f72 6b64 6972  mat(self.workdir
+000510c0: 2c20 7365 6c66 2e6d 6170 6e61 6d65 290a  , self.mapname).
+000510d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000510e0: 2020 2020 2020 2020 6f75 745f 7061 7468          out_path
+000510f0: 203d 2027 7b7d 5f70 6865 6e69 7827 2e66   = '{}_phenix'.f
+00051100: 6f72 6d61 7428 6675 6c6c 5f6d 6f64 656c  ormat(full_model
+00051110: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00051120: 2020 2020 2020 2020 2020 7265 7272 203d            rerr =
+00051130: 2072 756e 5f70 6865 6e69 786d 6d66 7363   run_phenixmmfsc
+00051140: 2866 756c 6c5f 6d6f 6465 6c2c 2066 756c  (full_model, ful
+00051150: 6c5f 6d61 702c 206f 7574 5f70 6174 6829  l_map, out_path)
+00051160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051170: 2020 2020 2020 2020 2074 6d6d 6673 636c           tmmfscl
+00051180: 6f67 203d 2027 7b7d 2f66 7363 5f6d 6f64  og = '{}/fsc_mod
+00051190: 656c 2e75 6e6d 6173 6b65 642e 6d74 7269  el.unmasked.mtri
+000511a0: 6167 652e 6c6f 6727 2e66 6f72 6d61 7428  age.log'.format(
+000511b0: 6f75 745f 7061 7468 290a 2020 2020 2020  out_path).      
+000511c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000511d0: 2020 6d6d 6673 636c 6f67 203d 2027 7b7d    mmfsclog = '{}
+000511e0: 2f66 7363 5f6d 6f64 656c 2e75 6e6d 6173  /fsc_model.unmas
+000511f0: 6b65 642e 6d74 7269 6167 655f 7b7d 2e6c  ked.mtriage_{}.l
+00051200: 6f67 272e 666f 726d 6174 286f 7574 5f70  og'.format(out_p
+00051210: 6174 682c 2073 656c 662e 6d61 706e 616d  ath, self.mapnam
+00051220: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00051230: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
+00051240: 655f 6669 6c65 6e61 6d65 2874 6d6d 6673  e_filename(tmmfs
+00051250: 636c 6f67 2c20 6d6d 6673 636c 6f67 290a  clog, mmfsclog).
+00051260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051270: 2020 2020 2020 2020 7261 775f 6d6d 6673          raw_mmfs
+00051280: 636c 6f67 203d 204e 6f6e 650a 2020 2020  clog = None.    
+00051290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000512a0: 2020 2020 7261 775f 7265 7272 203d 204e      raw_rerr = N
+000512b0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+000512c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000512d0: 656c 662e 686d 6f64 6420 616e 6420 7365  elf.hmodd and se
+000512e0: 6c66 2e68 6d65 7665 6e3a 0a20 2020 2020  lf.hmeven:.     
+000512f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051300: 2020 2020 2020 2072 6177 5f66 756c 6c5f         raw_full_
+00051310: 6d61 7020 3d20 7365 6c66 2e72 6177 6d61  map = self.rawma
+00051320: 702e 6675 6c6c 6e61 6d65 0a20 2020 2020  p.fullname.     
+00051330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051340: 2020 2020 2020 2072 6177 5f6d 6170 6e61         raw_mapna
+00051350: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
+00051360: 656e 616d 6528 7261 775f 6675 6c6c 5f6d  ename(raw_full_m
+00051370: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
+00051380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051390: 7261 775f 7265 7272 203d 2072 756e 5f70  raw_rerr = run_p
+000513a0: 6865 6e69 786d 6d66 7363 2866 756c 6c5f  henixmmfsc(full_
+000513b0: 6d6f 6465 6c2c 2072 6177 5f66 756c 6c5f  model, raw_full_
+000513c0: 6d61 702c 206f 7574 5f70 6174 6829 0a20  map, out_path). 
+000513d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000513e0: 2020 2020 2020 2020 2020 2072 6177 5f6d             raw_m
+000513f0: 6d66 7363 6c6f 6720 3d20 277b 7d2f 6673  mfsclog = '{}/fs
+00051400: 635f 6d6f 6465 6c2e 756e 6d61 736b 6564  c_model.unmasked
+00051410: 2e6d 7472 6961 6765 5f7b 7d2e 6c6f 6727  .mtriage_{}.log'
+00051420: 2e66 6f72 6d61 7428 6f75 745f 7061 7468  .format(out_path
+00051430: 2c20 7261 775f 6d61 706e 616d 6529 0a20  , raw_mapname). 
+00051440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051450: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
+00051460: 655f 6669 6c65 6e61 6d65 2874 6d6d 6673  e_filename(tmmfs
+00051470: 636c 6f67 2c20 7261 775f 6d6d 6673 636c  clog, raw_mmfscl
+00051480: 6f67 290a 2020 2020 2020 2020 2020 2020  og).            
+00051490: 2020 2020 2020 2020 2020 2020 656e 6420              end 
+000514a0: 3d20 7469 6d65 6974 2e64 6566 6175 6c74  = timeit.default
+000514b0: 5f74 696d 6572 2829 0a20 2020 2020 2020  _timer().       
+000514c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000514d0: 2070 7269 6e74 2827 5068 656e 6978 206d   print('Phenix m
+000514e0: 6d46 5343 2074 696d 653a 2025 7327 2025  mFSC time: %s' %
+000514f0: 2028 656e 6420 2d20 7374 6172 7429 290a   (end - start)).
+00051500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051510: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+00051520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00051530: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00051540: 2d2d 2d27 290a 2020 2020 2020 2020 2020  ---').          
+00051550: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00051560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00051570: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
+00051580: 2750 6865 6e69 7820 6d6d 4653 4320 6361  'Phenix mmFSC ca
+00051590: 6c63 756c 6174 696f 6e20 6572 726f 723a  lculation error:
+000515a0: 207b 7d2e 272e 666f 726d 6174 2873 7973   {}.'.format(sys
+000515b0: 2e65 7863 5f69 6e66 6f28 295b 315d 290a  .exc_info()[1]).
+000515c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000515d0: 2020 2020 2020 2020 6572 726c 6973 742e          errlist.
+000515e0: 6170 7065 6e64 2865 7272 290a 2020 2020  append(err).    
+000515f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051600: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
+00051610: 7269 7465 2865 7272 202b 2027 5c6e 2729  rite(err + '\n')
+00051620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051630: 2020 2020 206e 7971 7569 7374 203d 2031       nyquist = 1
+00051640: 202f 2028 3220 2a20 7365 6c66 2e6d 6170   / (2 * self.map
+00051650: 2e76 6f78 656c 5f73 697a 652e 746f 6c69  .voxel_size.toli
+00051660: 7374 2829 5b30 5d29 0a20 2020 2020 2020  st()[0]).       
+00051670: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00051680: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00051690: 2020 2020 2020 2020 2020 6466 203d 2072            df = r
+000516a0: 6561 645f 6d6d 6673 6328 6d6d 6673 636c  ead_mmfsc(mmfscl
+000516b0: 6f67 2c20 7265 7272 290a 2020 2020 2020  og, rerr).      
+000516c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000516d0: 2020 6d6d 6673 6364 6963 7420 3d20 6d6d    mmfscdict = mm
+000516e0: 6673 6364 665f 746f 6469 6374 2864 662c  fscdf_todict(df,
+000516f0: 206e 7971 7569 7374 290a 0a20 2020 2020   nyquist)..     
 00051700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051710: 2020 2020 2020 2020 2020 2072 6177 5f66             raw_f
-00051720: 756c 6c5f 6d61 7020 3d20 7365 6c66 2e72  ull_map = self.r
-00051730: 6177 6d61 702e 6675 6c6c 6e61 6d65 0a20  awmap.fullname. 
-00051740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051750: 2020 2020 2020 2020 2020 2072 6177 5f6d             raw_m
-00051760: 6170 6e61 6d65 203d 206f 732e 7061 7468  apname = os.path
-00051770: 2e62 6173 656e 616d 6528 7261 775f 6675  .basename(raw_fu
-00051780: 6c6c 5f6d 6170 290a 2020 2020 2020 2020  ll_map).        
-00051790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000517a0: 2020 2020 7261 775f 7265 7272 203d 2072      raw_rerr = r
-000517b0: 756e 5f70 6865 6e69 786d 6d66 7363 2866  un_phenixmmfsc(f
-000517c0: 756c 6c5f 6d6f 6465 6c2c 2072 6177 5f66  ull_model, raw_f
-000517d0: 756c 6c5f 6d61 702c 206f 7574 5f70 6174  ull_map, out_pat
-000517e0: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-000517f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00051800: 6177 5f6d 6d66 7363 6c6f 6720 3d20 277b  aw_mmfsclog = '{
-00051810: 7d2f 6673 635f 6d6f 6465 6c2e 756e 6d61  }/fsc_model.unma
-00051820: 736b 6564 2e6d 7472 6961 6765 5f7b 7d2e  sked.mtriage_{}.
-00051830: 6c6f 6727 2e66 6f72 6d61 7428 6f75 745f  log'.format(out_
-00051840: 7061 7468 2c20 7261 775f 6d61 706e 616d  path, raw_mapnam
-00051850: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00051860: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00051870: 6861 6e67 655f 6669 6c65 6e61 6d65 2874  hange_filename(t
-00051880: 6d6d 6673 636c 6f67 2c20 7261 775f 6d6d  mmfsclog, raw_mm
-00051890: 6673 636c 6f67 290a 2020 2020 2020 2020  fsclog).        
-000518a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518b0: 656e 6420 3d20 7469 6d65 6974 2e64 6566  end = timeit.def
-000518c0: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
-000518d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518e0: 2020 2020 2070 7269 6e74 2827 5068 656e       print('Phen
-000518f0: 6978 206d 6d46 5343 2074 696d 653a 2025  ix mmFSC time: %
-00051900: 7327 2025 2028 656e 6420 2d20 7374 6172  s' % (end - star
-00051910: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-00051920: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00051930: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
-00051940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00051950: 2d2d 2d2d 2d2d 2d27 290a 2020 2020 2020  -------').      
-00051960: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00051970: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00051980: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00051990: 7220 3d20 2750 6865 6e69 7820 6d6d 4653  r = 'Phenix mmFS
-000519a0: 4320 6361 6c63 756c 6174 696f 6e20 6572  C calculation er
-000519b0: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
-000519c0: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-000519d0: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
-000519e0: 2020 2020 2020 2020 2020 2020 6572 726c              errl
-000519f0: 6973 742e 6170 7065 6e64 2865 7272 290a  ist.append(err).
-00051a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051a10: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
-00051a20: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
-00051a30: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
-00051a40: 2020 2020 2020 2020 206e 7971 7569 7374           nyquist
-00051a50: 203d 2031 202f 2028 3220 2a20 7365 6c66   = 1 / (2 * self
-00051a60: 2e6d 6170 2e76 6f78 656c 5f73 697a 652e  .map.voxel_size.
-00051a70: 746f 6c69 7374 2829 5b30 5d29 0a20 2020  tolist()[0]).   
-00051a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051a90: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00051aa0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00051ab0: 203d 2072 6561 645f 6d6d 6673 6328 6d6d   = read_mmfsc(mm
-00051ac0: 6673 636c 6f67 2c20 7265 7272 290a 2020  fsclog, rerr).  
-00051ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051ae0: 2020 2020 2020 6d6d 6673 6364 6963 7420        mmfscdict 
-00051af0: 3d20 6d6d 6673 6364 665f 746f 6469 6374  = mmfscdf_todict
-00051b00: 2864 662c 206e 7971 7569 7374 290a 0a20  (df, nyquist).. 
-00051b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051b20: 2020 2020 2020 2061 6c6c 7265 7375 6c74         allresult
-00051b30: 735b 7374 7228 6e75 6d6d 6f64 656c 7329  s[str(nummodels)
-00051b40: 5d20 3d20 7b27 6e61 6d65 273a 206f 732e  ] = {'name': os.
-00051b50: 7061 7468 2e62 6173 656e 616d 6528 6d6f  path.basename(mo
-00051b60: 6465 6c2e 6669 6c65 6e61 6d65 292c 0a20  del.filename),. 
-00051b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051ba0: 2020 2020 2027 6461 7461 273a 206d 6d66       'data': mmf
-00051bb0: 7363 6469 6374 7d0a 0a20 2020 2020 2020  scdict}..       
-00051bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051bd0: 2069 6620 7365 6c66 2e68 6d6f 6464 2061   if self.hmodd a
-00051be0: 6e64 2073 656c 662e 686d 6576 656e 3a0a  nd self.hmeven:.
+00051710: 2020 2061 6c6c 7265 7375 6c74 735b 7374     allresults[st
+00051720: 7228 6e75 6d6d 6f64 656c 7329 5d20 3d20  r(nummodels)] = 
+00051730: 7b27 6e61 6d65 273a 206f 732e 7061 7468  {'name': os.path
+00051740: 2e62 6173 656e 616d 6528 6d6f 6465 6c2e  .basename(model.
+00051750: 6669 6c65 6e61 6d65 292c 0a20 2020 2020  filename),.     
+00051760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051790: 2027 6461 7461 273a 206d 6d66 7363 6469   'data': mmfscdi
+000517a0: 6374 7d0a 0a20 2020 2020 2020 2020 2020  ct}..           
+000517b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000517c0: 7365 6c66 2e68 6d6f 6464 2061 6e64 2073  self.hmodd and s
+000517d0: 656c 662e 686d 6576 656e 3a0a 2020 2020  elf.hmeven:.    
+000517e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000517f0: 2020 2020 2020 2020 7261 775f 6466 203d          raw_df =
+00051800: 2072 6561 645f 6d6d 6673 6328 7261 775f   read_mmfsc(raw_
+00051810: 6d6d 6673 636c 6f67 2c20 7261 775f 7265  mmfsclog, raw_re
+00051820: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
+00051830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051840: 7261 775f 6d6d 6673 6364 6963 7420 3d20  raw_mmfscdict = 
+00051850: 6d6d 6673 6364 665f 746f 6469 6374 2872  mmfscdf_todict(r
+00051860: 6177 5f64 662c 206e 7971 7569 7374 290a  aw_df, nyquist).
+00051870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051880: 2020 2020 2020 2020 2020 2020 2072 6177               raw
+00051890: 5f61 6c6c 7265 7375 6c74 735b 7374 7228  _allresults[str(
+000518a0: 6e75 6d6d 6f64 656c 7329 5d20 3d20 7b27  nummodels)] = {'
+000518b0: 6e61 6d65 273a 206f 732e 7061 7468 2e62  name': os.path.b
+000518c0: 6173 656e 616d 6528 6d6f 6465 6c2e 6669  asename(model.fi
+000518d0: 6c65 6e61 6d65 292c 0a20 2020 2020 2020  lename),.       
+000518e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000518f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051910: 2020 2020 2020 2027 6461 7461 273a 2072         'data': r
+00051920: 6177 5f6d 6d66 7363 6469 6374 7d0a 0a20  aw_mmfscdict}.. 
+00051930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051940: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+00051950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051960: 2020 2065 7272 203d 2027 5361 7665 2050     err = 'Save P
+00051970: 6865 6e69 7820 6d6d 4653 4320 6461 7461  henix mmFSC data
+00051980: 2065 7272 6f72 3a20 7b7d 2e27 2e66 6f72   error: {}.'.for
+00051990: 6d61 7428 7379 732e 6578 635f 696e 666f  mat(sys.exc_info
+000519a0: 2829 5b31 5d29 0a20 2020 2020 2020 2020  ()[1]).         
+000519b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000519c0: 7272 6c69 7374 2e61 7070 656e 6428 6572  rrlist.append(er
+000519d0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+000519e0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+000519f0: 7464 6572 722e 7772 6974 6528 6572 7220  tderr.write(err 
+00051a00: 2b20 275c 6e27 290a 2020 2020 2020 2020  + '\n').        
+00051a10: 2020 2020 2020 2020 2020 2020 6e75 6d6d              numm
+00051a20: 6f64 656c 7320 2b3d 2031 0a0a 2020 2020  odels += 1..    
+00051a30: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00051a40: 6c6c 7265 7375 6c74 733a 0a20 2020 2020  llresults:.     
+00051a50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00051a60: 6573 756c 745f 6469 6374 5b27 6d6d 6673  esult_dict['mmfs
+00051a70: 6327 5d20 3d20 616c 6c72 6573 756c 7473  c'] = allresults
+00051a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051a90: 2069 6620 7261 775f 616c 6c72 6573 756c   if raw_allresul
+00051aa0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00051ab0: 2020 2020 2020 2020 7261 775f 7265 7375          raw_resu
+00051ac0: 6c74 5f64 6963 745b 2772 6177 5f6d 6d66  lt_dict['raw_mmf
+00051ad0: 7363 275d 203d 2072 6177 5f61 6c6c 7265  sc'] = raw_allre
+00051ae0: 7375 6c74 730a 0a20 2020 2020 2020 2020  sults..         
+00051af0: 2020 2020 2020 2069 6620 6572 726c 6973         if errlis
+00051b00: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00051b10: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
+00051b20: 6374 5b27 6572 7227 5d20 3d20 6572 726c  ct['err'] = errl
+00051b30: 6973 740a 0a20 2020 2020 2020 2020 2020  ist..           
+00051b40: 2020 2020 2069 6620 6c65 6e28 7265 7375       if len(resu
+00051b50: 6c74 5f64 6963 7429 203d 3d20 3120 616e  lt_dict) == 1 an
+00051b60: 6420 276d 6d66 7363 2720 696e 2072 6573  d 'mmfsc' in res
+00051b70: 756c 745f 6469 6374 3a0a 2020 2020 2020  ult_dict:.      
+00051b80: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00051b90: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00051ba0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00051bb0: 636f 6465 6373 2e6f 7065 6e28 7365 6c66  codecs.open(self
+00051bc0: 2e77 6f72 6b64 6972 202b 2073 656c 662e  .workdir + self.
+00051bd0: 6d61 706e 616d 6520 2b20 275f 6d6d 6673  mapname + '_mmfs
+00051be0: 632e 6a73 6f6e 272c 2027 7727 2c0a 2020  c.json', 'w',.  
 00051bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051c00: 2020 2020 2020 2020 2020 2020 7261 775f              raw_
-00051c10: 6466 203d 2072 6561 645f 6d6d 6673 6328  df = read_mmfsc(
-00051c20: 7261 775f 6d6d 6673 636c 6f67 2c20 7261  raw_mmfsclog, ra
-00051c30: 775f 7265 7272 290a 2020 2020 2020 2020  w_rerr).        
-00051c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051c50: 2020 2020 7261 775f 6d6d 6673 6364 6963      raw_mmfscdic
-00051c60: 7420 3d20 6d6d 6673 6364 665f 746f 6469  t = mmfscdf_todi
-00051c70: 6374 2872 6177 5f64 662c 206e 7971 7569  ct(raw_df, nyqui
-00051c80: 7374 290a 0a20 2020 2020 2020 2020 2020  st)..           
-00051c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051ca0: 2072 6177 5f61 6c6c 7265 7375 6c74 735b   raw_allresults[
-00051cb0: 7374 7228 6e75 6d6d 6f64 656c 7329 5d20  str(nummodels)] 
-00051cc0: 3d20 7b27 6e61 6d65 273a 206f 732e 7061  = {'name': os.pa
-00051cd0: 7468 2e62 6173 656e 616d 6528 6d6f 6465  th.basename(mode
-00051ce0: 6c2e 6669 6c65 6e61 6d65 292c 0a20 2020  l.filename),.   
-00051cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c10: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+00051c20: 2775 7466 2d38 2729 2061 7320 663a 0a20  'utf-8') as f:. 
+00051c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051c40: 2020 2020 2020 2020 2020 206a 736f 6e2e             json.
+00051c50: 6475 6d70 2872 6573 756c 745f 6469 6374  dump(result_dict
+00051c60: 2c20 6629 0a20 2020 2020 2020 2020 2020  , f).           
+00051c70: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+00051c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051c90: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+00051ca0: 6572 722e 7772 6974 6528 2753 6176 696e  err.write('Savin
+00051cb0: 6720 746f 206d 6d46 5343 206a 736f 6e20  g to mmFSC json 
+00051cc0: 6572 726f 723a 207b 7d2e 5c6e 272e 666f  error: {}.\n'.fo
+00051cd0: 726d 6174 2873 7973 2e65 7863 5f69 6e66  rmat(sys.exc_inf
+00051ce0: 6f28 295b 315d 2929 0a0a 2020 2020 2020  o()[1]))..      
+00051cf0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 00051d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051d20: 2020 2020 2020 2020 2020 2027 6461 7461             'data
-00051d30: 273a 2072 6177 5f6d 6d66 7363 6469 6374  ': raw_mmfscdict
-00051d40: 7d0a 0a20 2020 2020 2020 2020 2020 2020  }..             
-00051d50: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-00051d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051d70: 2020 2020 2020 2065 7272 203d 2027 5361         err = 'Sa
-00051d80: 7665 2050 6865 6e69 7820 6d6d 4653 4320  ve Phenix mmFSC 
-00051d90: 6461 7461 2065 7272 6f72 3a20 7b7d 2e27  data error: {}.'
-00051da0: 2e66 6f72 6d61 7428 7379 732e 6578 635f  .format(sys.exc_
-00051db0: 696e 666f 2829 5b31 5d29 0a20 2020 2020  info()[1]).     
+00051d10: 2020 2020 7072 696e 7428 276d 6d46 5343      print('mmFSC
+00051d20: 2077 6173 206e 6f74 2063 6f6c 6c65 6374   was not collect
+00051d30: 6564 2c20 706c 6561 7365 2063 6865 636b  ed, please check
+00051d40: 2074 6865 2065 7272 6f72 2127 290a 0a20   the error!').. 
+00051d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00051d60: 6620 6c65 6e28 7261 775f 7265 7375 6c74  f len(raw_result
+00051d70: 5f64 6963 7429 203d 3d20 3120 616e 6420  _dict) == 1 and 
+00051d80: 2772 6177 5f6d 6d66 7363 2720 696e 2072  'raw_mmfsc' in r
+00051d90: 6177 5f72 6573 756c 745f 6469 6374 3a0a  aw_result_dict:.
+00051da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051db0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
 00051dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051dd0: 2020 2065 7272 6c69 7374 2e61 7070 656e     errlist.appen
-00051de0: 6428 6572 7229 0a20 2020 2020 2020 2020  d(err).         
-00051df0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00051e00: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00051e10: 6572 7220 2b20 275c 6e27 290a 2020 2020  err + '\n').    
+00051dd0: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
+00051de0: 6e28 7365 6c66 2e77 6f72 6b64 6972 202b  n(self.workdir +
+00051df0: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
+00051e00: 275f 7261 775f 6d6d 6673 632e 6a73 6f6e  '_raw_mmfsc.json
+00051e10: 272c 2027 7727 2c0a 2020 2020 2020 2020  ', 'w',.        
 00051e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051e30: 6e75 6d6d 6f64 656c 7320 2b3d 2031 0a0a  nummodels += 1..
-00051e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051e50: 6966 2061 6c6c 7265 7375 6c74 733a 0a20  if allresults:. 
+00051e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051e40: 2065 6e63 6f64 696e 673d 2775 7466 2d38   encoding='utf-8
+00051e50: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
 00051e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051e70: 2020 2072 6573 756c 745f 6469 6374 5b27     result_dict['
-00051e80: 6d6d 6673 6327 5d20 3d20 616c 6c72 6573  mmfsc'] = allres
-00051e90: 756c 7473 0a20 2020 2020 2020 2020 2020  ults.           
-00051ea0: 2020 2020 2069 6620 7261 775f 616c 6c72       if raw_allr
-00051eb0: 6573 756c 7473 3a0a 2020 2020 2020 2020  esults:.        
-00051ec0: 2020 2020 2020 2020 2020 2020 7261 775f              raw_
-00051ed0: 7265 7375 6c74 5f64 6963 745b 2772 6177  result_dict['raw
-00051ee0: 5f6d 6d66 7363 275d 203d 2072 6177 5f61  _mmfsc'] = raw_a
-00051ef0: 6c6c 7265 7375 6c74 730a 0a20 2020 2020  llresults..     
-00051f00: 2020 2020 2020 2020 2020 2069 6620 6572             if er
-00051f10: 726c 6973 743a 0a20 2020 2020 2020 2020  rlist:.         
-00051f20: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00051f30: 745f 6469 6374 5b27 6572 7227 5d20 3d20  t_dict['err'] = 
-00051f40: 6572 726c 6973 740a 0a20 2020 2020 2020  errlist..       
-00051f50: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00051f60: 7265 7375 6c74 5f64 6963 7429 203d 3d20  result_dict) == 
-00051f70: 3120 616e 6420 276d 6d66 7363 2720 696e  1 and 'mmfsc' in
-00051f80: 2072 6573 756c 745f 6469 6374 3a0a 2020   result_dict:.  
-00051f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051fa0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00051fb0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00051fc0: 6974 6820 636f 6465 6373 2e6f 7065 6e28  ith codecs.open(
-00051fd0: 7365 6c66 2e77 6f72 6b64 6972 202b 2073  self.workdir + s
-00051fe0: 656c 662e 6d61 706e 616d 6520 2b20 275f  elf.mapname + '_
-00051ff0: 6d6d 6673 632e 6a73 6f6e 272c 2027 7727  mmfsc.json', 'w'
-00052000: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00052010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052020: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-00052030: 696e 673d 2775 7466 2d38 2729 2061 7320  ing='utf-8') as 
-00052040: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-00052050: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-00052060: 736f 6e2e 6475 6d70 2872 6573 756c 745f  son.dump(result_
-00052070: 6469 6374 2c20 6629 0a20 2020 2020 2020  dict, f).       
-00052080: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00052090: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-000520a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-000520b0: 2e73 7464 6572 722e 7772 6974 6528 2753  .stderr.write('S
-000520c0: 6176 696e 6720 746f 206d 6d46 5343 206a  aving to mmFSC j
-000520d0: 736f 6e20 6572 726f 723a 207b 7d2e 5c6e  son error: {}.\n
-000520e0: 272e 666f 726d 6174 2873 7973 2e65 7863  '.format(sys.exc
-000520f0: 5f69 6e66 6f28 295b 315d 2929 0a0a 2020  _info()[1]))..  
-00052100: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00052110: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00052120: 2020 2020 2020 2020 7072 696e 7428 276d          print('m
-00052130: 6d46 5343 2077 6173 206e 6f74 2063 6f6c  mFSC was not col
-00052140: 6c65 6374 6564 2c20 706c 6561 7365 2063  lected, please c
-00052150: 6865 636b 2074 6865 2065 7272 6f72 2127  heck the error!'
-00052160: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00052170: 2020 2069 6620 6c65 6e28 7261 775f 7265     if len(raw_re
-00052180: 7375 6c74 5f64 6963 7429 203d 3d20 3120  sult_dict) == 1 
-00052190: 616e 6420 2772 6177 5f6d 6d66 7363 2720  and 'raw_mmfsc' 
-000521a0: 696e 2072 6177 5f72 6573 756c 745f 6469  in raw_result_di
-000521b0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
-000521c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000521d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000521e0: 2020 2020 2077 6974 6820 636f 6465 6373       with codecs
-000521f0: 2e6f 7065 6e28 7365 6c66 2e77 6f72 6b64  .open(self.workd
-00052200: 6972 202b 2073 656c 662e 6d61 706e 616d  ir + self.mapnam
-00052210: 6520 2b20 275f 7261 775f 6d6d 6673 632e  e + '_raw_mmfsc.
-00052220: 6a73 6f6e 272c 2027 7727 2c0a 2020 2020  json', 'w',.    
-00052230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052250: 2020 2020 2065 6e63 6f64 696e 673d 2775       encoding='u
-00052260: 7466 2d38 2729 2061 7320 663a 0a20 2020  tf-8') as f:.   
-00052270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052280: 2020 2020 2020 2020 206a 736f 6e2e 6475           json.du
-00052290: 6d70 2872 6177 5f72 6573 756c 745f 6469  mp(raw_result_di
-000522a0: 6374 2c20 6629 0a20 2020 2020 2020 2020  ct, f).         
-000522b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000522c0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000522d0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
-000522e0: 7464 6572 722e 7772 6974 6528 2753 6176  tderr.write('Sav
-000522f0: 696e 6720 746f 2072 6177 206d 6d46 5343  ing to raw mmFSC
-00052300: 206a 736f 6e20 6572 726f 723a 207b 7d2e   json error: {}.
-00052310: 5c6e 272e 666f 726d 6174 2873 7973 2e65  \n'.format(sys.e
-00052320: 7863 5f69 6e66 6f28 295b 315d 2929 0a0a  xc_info()[1]))..
-00052330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052340: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00052350: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00052360: 2752 6177 206d 6170 206d 6d46 5343 2077  'Raw map mmFSC w
-00052370: 6173 206e 6f74 2063 6f6c 6c65 6374 6564  as not collected
-00052380: 2c20 706c 6561 7365 2063 6865 636b 2074  , please check t
-00052390: 6865 2065 7272 6f72 2127 290a 0a20 2020  he error!')..   
-000523a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000523b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000523c0: 7269 6e74 2827 4e6f 206d 6f64 656c 2121  rint('No model!!
-000523d0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000523e0: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
-000523f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00052400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-00052410: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00052420: 204e 6f6e 650a 0a20 2020 2064 6566 206c   None..    def l
-00052430: 6f63 7265 735f 7265 736d 6170 2873 656c  ocres_resmap(sel
-00052440: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-00052450: 2020 2020 2020 2020 2020 2020 4361 6c63              Calc
-00052460: 756c 6174 6520 6c6f 6361 6c20 7265 736f  ulate local reso
-00052470: 6c75 7469 6f6e 2062 7920 7573 696e 6720  lution by using 
-00052480: 5265 736d 6170 0a20 2020 2020 2020 203a  Resmap.        :
-00052490: 7265 7475 726e 3a0a 2020 2020 2020 2020  return:.        
-000524a0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-000524b0: 656c 662e 706c 6174 666f 726d 203d 3d20  elf.platform == 
-000524c0: 2765 6d64 6227 2061 6e64 2073 656c 662e  'emdb' and self.
-000524d0: 6d65 7420 213d 2027 746f 6d6f 273a 0a20  met != 'tomo':. 
-000524e0: 2020 2020 2020 2020 2020 2073 7461 7274             start
-000524f0: 203d 2074 696d 6569 742e 6465 6661 756c   = timeit.defaul
-00052500: 745f 7469 6d65 7228 290a 2020 2020 2020  t_timer().      
-00052510: 2020 2020 2020 6572 726c 6973 7420 3d20        errlist = 
-00052520: 5b5d 0a20 2020 2020 2020 2020 2020 2072  [].            r
-00052530: 6573 756c 745f 6469 6374 203d 207b 7d0a  esult_dict = {}.
-00052540: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00052550: 2073 7472 7564 656c 6170 7020 616e 6420   strudelapp and 
-00052560: 7365 6c66 2e6d 6f64 656c 733a 0a20 2020  self.models:.   
-00052570: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00052580: 2e68 6d65 7665 6e20 616e 6420 7365 6c66  .hmeven and self
-00052590: 2e68 6d6f 6464 3a0a 2020 2020 2020 2020  .hmodd:.        
-000525a0: 2020 2020 2020 2020 6576 656e 203d 2073          even = s
-000525b0: 656c 662e 686d 6576 656e 2e66 756c 6c6e  elf.hmeven.fulln
-000525c0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-000525d0: 2020 2020 6f64 6420 3d20 7365 6c66 2e68      odd = self.h
-000525e0: 6d6f 6464 2e66 756c 6c6e 616d 650a 2020  modd.fullname.  
-000525f0: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-00052600: 6c6c 5f6d 6170 203d 2027 7b7d 7b7d 272e  ll_map = '{}{}'.
-00052610: 666f 726d 6174 2873 656c 662e 776f 726b  format(self.work
-00052620: 6469 722c 2073 656c 662e 6d61 706e 616d  dir, self.mapnam
-00052630: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00052640: 2020 206f 7574 5f70 6174 6820 3d20 277b     out_path = '{
-00052650: 7d5f 7265 6c69 6f6e 272e 666f 726d 6174  }_relion'.format
-00052660: 2866 756c 6c5f 6d61 7029 0a20 2020 2020  (full_map).     
-00052670: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00052680: 286f 7574 5f70 6174 6829 0a20 2020 2020  (out_path).     
-00052690: 2020 2020 2020 2020 2020 2061 6c6c 7265             allre
-000526a0: 7375 6c74 7320 3d20 7b7d 0a20 2020 2020  sults = {}.     
-000526b0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000526c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000526d0: 2020 2020 2023 2072 6572 7220 3d20 7275       # rerr = ru
-000526e0: 6e5f 7265 736d 6170 286f 6464 2c20 6576  n_resmap(odd, ev
-000526f0: 656e 2c20 6f75 745f 7061 7468 2c20 5245  en, out_path, RE
-00052700: 534d 4150 290a 2020 2020 2020 2020 2020  SMAP).          
-00052710: 2020 2020 2020 2020 2020 7265 7272 203d            rerr =
-00052720: 2072 756e 5f6c 6f63 7265 7328 6f64 642c   run_locres(odd,
-00052730: 2065 7665 6e2c 206f 7574 5f70 6174 682c   even, out_path,
-00052740: 2052 4553 4d41 5029 0a20 2020 2020 2020   RESMAP).       
-00052750: 2020 2020 2020 2020 2020 2020 2065 6e64               end
-00052760: 203d 2074 696d 6569 742e 6465 6661 756c   = timeit.defaul
-00052770: 745f 7469 6d65 7228 290a 2020 2020 2020  t_timer().      
-00052780: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00052790: 696e 7428 274c 6f63 616c 2072 6573 6f6c  int('Local resol
-000527a0: 7574 696f 6e20 5265 734d 6170 2074 696d  ution ResMap tim
-000527b0: 653a 2025 7327 2025 2028 656e 6420 2d20  e: %s' % (end - 
-000527c0: 7374 6172 7429 290a 2020 2020 2020 2020  start)).        
-000527d0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000527e0: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
-000527f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00052800: 2d2d 2d2d 2d2d 2d27 290a 2020 2020 2020  -------').      
-00052810: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00052820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00052830: 2020 2020 2020 6572 7220 3d20 2752 6573        err = 'Res
-00052840: 4d61 7020 6361 6c63 756c 6174 696f 6e20  Map calculation 
-00052850: 6572 726f 723a 207b 7d2e 272e 666f 726d  error: {}.'.form
-00052860: 6174 2873 7973 2e65 7863 5f69 6e66 6f28  at(sys.exc_info(
-00052870: 295b 315d 290a 2020 2020 2020 2020 2020  )[1]).          
-00052880: 2020 2020 2020 2020 2020 6572 726c 6973            errlis
-00052890: 742e 6170 7065 6e64 2865 7272 290a 2020  t.append(err).  
-000528a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000528b0: 2020 7379 732e 7374 6465 7272 2e77 7269    sys.stderr.wri
-000528c0: 7465 2865 7272 202b 2027 5c6e 2729 0a20  te(err + '\n'). 
-000528d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000528e0: 2063 6865 636b 203d 2072 6573 6d61 705f   check = resmap_
-000528f0: 6669 6c65 6368 6563 6b28 6f64 642c 2073  filecheck(odd, s
-00052900: 656c 662e 776f 726b 6469 7229 0a20 2020  elf.workdir).   
-00052910: 2020 2020 2020 2020 2020 2020 2063 6865               che
-00052920: 636b 203d 206c 6f63 7265 735f 6669 6c65  ck = locres_file
-00052930: 6368 6563 6b28 6f64 642c 2065 7665 6e2c  check(odd, even,
-00052940: 206f 7574 5f70 6174 6829 0a20 2020 2020   out_path).     
-00052950: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
-00052960: 6563 6b3a 0a20 2020 2020 2020 2020 2020  eck:.           
-00052970: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00051e70: 2020 2020 206a 736f 6e2e 6475 6d70 2872       json.dump(r
+00051e80: 6177 5f72 6573 756c 745f 6469 6374 2c20  aw_result_dict, 
+00051e90: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
+00051ea0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
+00051eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051ec0: 2020 2020 2020 2073 7973 2e73 7464 6572         sys.stder
+00051ed0: 722e 7772 6974 6528 2753 6176 696e 6720  r.write('Saving 
+00051ee0: 746f 2072 6177 206d 6d46 5343 206a 736f  to raw mmFSC jso
+00051ef0: 6e20 6572 726f 723a 207b 7d2e 5c6e 272e  n error: {}.\n'.
+00051f00: 666f 726d 6174 2873 7973 2e65 7863 5f69  format(sys.exc_i
+00051f10: 6e66 6f28 295b 315d 2929 0a0a 2020 2020  nfo()[1]))..    
+00051f20: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00051f30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00051f40: 2020 2020 2020 7072 696e 7428 2752 6177        print('Raw
+00051f50: 206d 6170 206d 6d46 5343 2077 6173 206e   map mmFSC was n
+00051f60: 6f74 2063 6f6c 6c65 6374 6564 2c20 706c  ot collected, pl
+00051f70: 6561 7365 2063 6865 636b 2074 6865 2065  ease check the e
+00051f80: 7272 6f72 2127 290a 0a20 2020 2020 2020  rror!')..       
+00051f90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00051fa0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00051fb0: 2827 4e6f 206d 6f64 656c 2121 2729 0a20  ('No model!!'). 
+00051fc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00051fd0: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
+00051fe0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00051ff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020  ----------')..  
+00052000: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00052010: 650a 0a20 2020 2064 6566 206c 6f63 7265  e..    def locre
+00052020: 735f 7265 736d 6170 2873 656c 6629 3a0a  s_resmap(self):.
+00052030: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00052040: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
+00052050: 6520 6c6f 6361 6c20 7265 736f 6c75 7469  e local resoluti
+00052060: 6f6e 2062 7920 7573 696e 6720 5265 736d  on by using Resm
+00052070: 6170 0a20 2020 2020 2020 203a 7265 7475  ap.        :retu
+00052080: 726e 3a0a 2020 2020 2020 2020 2222 220a  rn:.        """.
+00052090: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000520a0: 706c 6174 666f 726d 203d 3d20 2765 6d64  platform == 'emd
+000520b0: 6227 2061 6e64 2073 656c 662e 6d65 7420  b' and self.met 
+000520c0: 213d 2027 746f 6d6f 273a 0a20 2020 2020  != 'tomo':.     
+000520d0: 2020 2020 2020 2073 7461 7274 203d 2074         start = t
+000520e0: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
+000520f0: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
+00052100: 2020 6572 726c 6973 7420 3d20 5b5d 0a20    errlist = []. 
+00052110: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00052120: 745f 6469 6374 203d 207b 7d0a 2020 2020  t_dict = {}.    
+00052130: 2020 2020 2020 2020 2320 6966 2073 7472          # if str
+00052140: 7564 656c 6170 7020 616e 6420 7365 6c66  udelapp and self
+00052150: 2e6d 6f64 656c 733a 0a20 2020 2020 2020  .models:.       
+00052160: 2020 2020 2069 6620 7365 6c66 2e68 6d65       if self.hme
+00052170: 7665 6e20 616e 6420 7365 6c66 2e68 6d6f  ven and self.hmo
+00052180: 6464 3a0a 2020 2020 2020 2020 2020 2020  dd:.            
+00052190: 2020 2020 6576 656e 203d 2073 656c 662e      even = self.
+000521a0: 686d 6576 656e 2e66 756c 6c6e 616d 650a  hmeven.fullname.
+000521b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000521c0: 6f64 6420 3d20 7365 6c66 2e68 6d6f 6464  odd = self.hmodd
+000521d0: 2e66 756c 6c6e 616d 650a 2020 2020 2020  .fullname.      
+000521e0: 2020 2020 2020 2020 2020 6675 6c6c 5f6d            full_m
+000521f0: 6170 203d 2027 7b7d 7b7d 272e 666f 726d  ap = '{}{}'.form
+00052200: 6174 2873 656c 662e 776f 726b 6469 722c  at(self.workdir,
+00052210: 2073 656c 662e 6d61 706e 616d 6529 0a20   self.mapname). 
+00052220: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00052230: 7574 5f70 6174 6820 3d20 277b 7d5f 7265  ut_path = '{}_re
+00052240: 6c69 6f6e 272e 666f 726d 6174 2866 756c  lion'.format(ful
+00052250: 6c5f 6d61 7029 0a20 2020 2020 2020 2020  l_map).         
+00052260: 2020 2020 2020 2070 7269 6e74 286f 7574         print(out
+00052270: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
+00052280: 2020 2020 2020 2061 6c6c 7265 7375 6c74         allresult
+00052290: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
+000522a0: 2020 2020 2020 2074 7279 3a0a 0a20 2020         try:..   
+000522b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000522c0: 2023 2072 6572 7220 3d20 7275 6e5f 7265   # rerr = run_re
+000522d0: 736d 6170 286f 6464 2c20 6576 656e 2c20  smap(odd, even, 
+000522e0: 6f75 745f 7061 7468 2c20 5245 534d 4150  out_path, RESMAP
+000522f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00052300: 2020 2020 2020 7265 7272 203d 2072 756e        rerr = run
+00052310: 5f6c 6f63 7265 7328 6f64 642c 2065 7665  _locres(odd, eve
+00052320: 6e2c 206f 7574 5f70 6174 682c 2052 4553  n, out_path, RES
+00052330: 4d41 5029 0a20 2020 2020 2020 2020 2020  MAP).           
+00052340: 2020 2020 2020 2020 2065 6e64 203d 2074           end = t
+00052350: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
+00052360: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
+00052370: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00052380: 274c 6f63 616c 2072 6573 6f6c 7574 696f  'Local resolutio
+00052390: 6e20 5265 734d 6170 2074 696d 653a 2025  n ResMap time: %
+000523a0: 7327 2025 2028 656e 6420 2d20 7374 6172  s' % (end - star
+000523b0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
+000523c0: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
+000523d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000523e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000523f0: 2d2d 2d27 290a 2020 2020 2020 2020 2020  ---').          
+00052400: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
+00052410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052420: 2020 6572 7220 3d20 2752 6573 4d61 7020    err = 'ResMap 
+00052430: 6361 6c63 756c 6174 696f 6e20 6572 726f  calculation erro
+00052440: 723a 207b 7d2e 272e 666f 726d 6174 2873  r: {}.'.format(s
+00052450: 7973 2e65 7863 5f69 6e66 6f28 295b 315d  ys.exc_info()[1]
+00052460: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00052470: 2020 2020 2020 6572 726c 6973 742e 6170        errlist.ap
+00052480: 7065 6e64 2865 7272 290a 2020 2020 2020  pend(err).      
+00052490: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+000524a0: 732e 7374 6465 7272 2e77 7269 7465 2865  s.stderr.write(e
+000524b0: 7272 202b 2027 5c6e 2729 0a20 2020 2020  rr + '\n').     
+000524c0: 2020 2020 2020 2020 2020 2023 2063 6865             # che
+000524d0: 636b 203d 2072 6573 6d61 705f 6669 6c65  ck = resmap_file
+000524e0: 6368 6563 6b28 6f64 642c 2073 656c 662e  check(odd, self.
+000524f0: 776f 726b 6469 7229 0a20 2020 2020 2020  workdir).       
+00052500: 2020 2020 2020 2020 2063 6865 636b 203d           check =
+00052510: 206c 6f63 7265 735f 6669 6c65 6368 6563   locres_filechec
+00052520: 6b28 6f64 642c 2065 7665 6e2c 206f 7574  k(odd, even, out
+00052530: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
+00052540: 2020 2020 2020 2069 6620 6368 6563 6b3a         if check:
+00052550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052560: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00052570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052580: 2020 7265 736d 6170 5f63 6869 6d65 7261    resmap_chimera
+00052590: 785f 6669 6c65 203d 2072 6573 6d61 705f  x_file = resmap_
+000525a0: 6368 696d 6572 6178 286f 6464 2c20 7365  chimerax(odd, se
+000525b0: 6c66 2e77 6f72 6b64 6972 290a 2020 2020  lf.workdir).    
+000525c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000525d0: 2020 2020 6966 206f 732e 7061 7468 2e69      if os.path.i
+000525e0: 7366 696c 6528 7265 736d 6170 5f63 6869  sfile(resmap_chi
+000525f0: 6d65 7261 785f 6669 6c65 293a 0a20 2020  merax_file):.   
+00052600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052610: 2020 2020 2020 2020 2076 746b 7061 636b           vtkpack
+00052620: 2c20 6368 696d 6572 6161 7070 203d 2073  , chimeraapp = s
+00052630: 656c 662e 7375 7266 6163 655f 656e 7663  elf.surface_envc
+00052640: 6865 636b 2829 0a20 2020 2020 2020 2020  heck().         
+00052650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052660: 2020 2062 696e 6469 7370 6c61 7920 3d20     bindisplay = 
+00052670: 6f73 2e67 6574 656e 7628 2744 4953 504c  os.getenv('DISPL
+00052680: 4159 2729 0a20 2020 2020 2020 2020 2020  AY').           
+00052690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000526a0: 2072 756e 5f72 6573 6d61 705f 6368 696d   run_resmap_chim
+000526b0: 6572 6178 2862 696e 6469 7370 6c61 792c  erax(bindisplay,
+000526c0: 2063 6869 6d65 7261 6170 702c 2072 6573   chimeraapp, res
+000526d0: 6d61 705f 6368 696d 6572 6178 5f66 696c  map_chimerax_fil
+000526e0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000526f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00052700: 2072 6573 6d61 7020 3d20 277b 7d5f 6f72   resmap = '{}_or
+00052710: 695f 7265 736d 6170 2e6d 6170 272e 666f  i_resmap.map'.fo
+00052720: 726d 6174 286f 6464 5b3a 2d34 5d29 0a20  rmat(odd[:-4]). 
+00052730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052740: 2020 2020 2020 2020 2020 2023 206f 7574             # out
+00052750: 7075 745f 6a73 6f6e 203d 2027 7b7d 7b7d  put_json = '{}{}
+00052760: 5f72 6573 6d61 702e 6a73 6f6e 272e 666f  _resmap.json'.fo
+00052770: 726d 6174 2873 656c 662e 776f 726b 6469  rmat(self.workdi
+00052780: 722c 2073 656c 662e 6d61 706e 616d 6529  r, self.mapname)
+00052790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000527a0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+000527b0: 6176 655f 696d 6167 6573 746f 6a73 6f6e  ave_imagestojson
+000527c0: 2872 6573 6d61 702c 206f 7574 7075 745f  (resmap, output_
+000527d0: 6a73 6f6e 290a 2020 2020 2020 2020 2020  json).          
+000527e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000527f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00052800: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
+00052810: 2752 6573 4d61 7020 7669 6577 7320 6572  'ResMap views er
+00052820: 726f 723a 207b 7d2e 272e 666f 726d 6174  ror: {}.'.format
+00052830: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
+00052840: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+00052850: 2020 2020 2020 2020 2020 2020 6572 726c              errl
+00052860: 6973 742e 6170 7065 6e64 2865 7272 290a  ist.append(err).
+00052870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052880: 2020 2020 2020 2020 7379 732e 7374 6465          sys.stde
+00052890: 7272 2e77 7269 7465 2865 7272 202b 2027  rr.write(err + '
+000528a0: 5c6e 2729 0a20 2020 2020 2020 2020 2020  \n').           
+000528b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000528c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000528d0: 7269 6e74 2827 4368 696d 6572 6178 2066  rint('Chimerax f
+000528e0: 696c 6520 646f 6573 206e 6f74 2065 7869  ile does not exi
+000528f0: 7374 2e20 4368 6563 6b21 2127 290a 0a20  st. Check!!').. 
+00052900: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00052910: 6620 6572 726c 6973 743a 0a20 2020 2020  f errlist:.     
+00052920: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00052930: 6573 756c 745f 6469 6374 5b27 6572 7227  esult_dict['err'
+00052940: 5d20 3d20 6572 726c 6973 740a 2020 2020  ] = errlist.    
+00052950: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00052960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00052970: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
 00052980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052990: 2020 2020 2020 7265 736d 6170 5f63 6869        resmap_chi
-000529a0: 6d65 7261 785f 6669 6c65 203d 2072 6573  merax_file = res
-000529b0: 6d61 705f 6368 696d 6572 6178 286f 6464  map_chimerax(odd
-000529c0: 2c20 7365 6c66 2e77 6f72 6b64 6972 290a  , self.workdir).
-000529d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000529e0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-000529f0: 7468 2e69 7366 696c 6528 7265 736d 6170  th.isfile(resmap
-00052a00: 5f63 6869 6d65 7261 785f 6669 6c65 293a  _chimerax_file):
-00052a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052a20: 2020 2020 2020 2020 2020 2020 2076 746b               vtk
-00052a30: 7061 636b 2c20 6368 696d 6572 6161 7070  pack, chimeraapp
-00052a40: 203d 2073 656c 662e 7375 7266 6163 655f   = self.surface_
-00052a50: 656e 7663 6865 636b 2829 0a20 2020 2020  envcheck().     
+00052990: 2020 2072 6573 6d61 7020 3d20 277b 7d5f     resmap = '{}_
+000529a0: 6f72 695f 7265 736d 6170 2e6d 6170 272e  ori_resmap.map'.
+000529b0: 666f 726d 6174 286f 6464 5b3a 2d34 5d29  format(odd[:-4])
+000529c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000529d0: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+000529e0: 6a73 6f6e 203d 2027 7b7d 7b7d 5f72 6573  json = '{}{}_res
+000529f0: 6d61 702e 6a73 6f6e 272e 666f 726d 6174  map.json'.format
+00052a00: 2873 656c 662e 776f 726b 6469 722c 2073  (self.workdir, s
+00052a10: 656c 662e 6d61 706e 616d 6529 0a20 2020  elf.mapname).   
+00052a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052a30: 2020 2020 2073 6176 655f 696d 6167 6573       save_images
+00052a40: 746f 6a73 6f6e 2872 6573 6d61 702c 206f  tojson(resmap, o
+00052a50: 7574 7075 745f 6a73 6f6e 290a 2020 2020  utput_json).    
 00052a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052a70: 2020 2020 2020 2062 696e 6469 7370 6c61         bindispla
-00052a80: 7920 3d20 6f73 2e67 6574 656e 7628 2744  y = os.getenv('D
-00052a90: 4953 504c 4159 2729 0a20 2020 2020 2020  ISPLAY').       
-00052aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ab0: 2020 2020 2072 756e 5f72 6573 6d61 705f       run_resmap_
-00052ac0: 6368 696d 6572 6178 2862 696e 6469 7370  chimerax(bindisp
-00052ad0: 6c61 792c 2063 6869 6d65 7261 6170 702c  lay, chimeraapp,
-00052ae0: 2072 6573 6d61 705f 6368 696d 6572 6178   resmap_chimerax
-00052af0: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
-00052b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052b10: 2020 2023 2072 6573 6d61 7020 3d20 277b     # resmap = '{
-00052b20: 7d5f 6f72 695f 7265 736d 6170 2e6d 6170  }_ori_resmap.map
-00052b30: 272e 666f 726d 6174 286f 6464 5b3a 2d34  '.format(odd[:-4
-00052b40: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00052b50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00052b60: 206f 7574 7075 745f 6a73 6f6e 203d 2027   output_json = '
-00052b70: 7b7d 7b7d 5f72 6573 6d61 702e 6a73 6f6e  {}{}_resmap.json
-00052b80: 272e 666f 726d 6174 2873 656c 662e 776f  '.format(self.wo
-00052b90: 726b 6469 722c 2073 656c 662e 6d61 706e  rkdir, self.mapn
-00052ba0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00052bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052bc0: 2023 2073 6176 655f 696d 6167 6573 746f   # save_imagesto
-00052bd0: 6a73 6f6e 2872 6573 6d61 702c 206f 7574  json(resmap, out
-00052be0: 7075 745f 6a73 6f6e 290a 2020 2020 2020  put_json).      
-00052bf0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00052c00: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00052c10: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00052c20: 7220 3d20 2752 6573 4d61 7020 7669 6577  r = 'ResMap view
-00052c30: 7320 6572 726f 723a 207b 7d2e 272e 666f  s error: {}.'.fo
-00052c40: 726d 6174 2873 7973 2e65 7863 5f69 6e66  rmat(sys.exc_inf
-00052c50: 6f28 295b 315d 290a 2020 2020 2020 2020  o()[1]).        
-00052c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c70: 6572 726c 6973 742e 6170 7065 6e64 2865  errlist.append(e
-00052c80: 7272 290a 2020 2020 2020 2020 2020 2020  rr).            
-00052c90: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00052ca0: 7374 6465 7272 2e77 7269 7465 2865 7272  stderr.write(err
-00052cb0: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
-00052cc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00052cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ce0: 2020 2070 7269 6e74 2827 4368 696d 6572     print('Chimer
-00052cf0: 6178 2066 696c 6520 646f 6573 206e 6f74  ax file does not
-00052d00: 2065 7869 7374 2e20 4368 6563 6b21 2127   exist. Check!!'
-00052d10: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00052d20: 2020 2069 6620 6572 726c 6973 743a 0a20     if errlist:. 
-00052d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052d40: 2020 2072 6573 756c 745f 6469 6374 5b27     result_dict['
-00052d50: 6572 7227 5d20 3d20 6572 726c 6973 740a  err'] = errlist.
-00052d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052d70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00052d80: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00052d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052da0: 2020 2020 2020 2072 6573 6d61 7020 3d20         resmap = 
-00052db0: 277b 7d5f 6f72 695f 7265 736d 6170 2e6d  '{}_ori_resmap.m
-00052dc0: 6170 272e 666f 726d 6174 286f 6464 5b3a  ap'.format(odd[:
-00052dd0: 2d34 5d29 0a20 2020 2020 2020 2020 2020  -4]).           
-00052de0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00052df0: 7075 745f 6a73 6f6e 203d 2027 7b7d 7b7d  put_json = '{}{}
-00052e00: 5f72 6573 6d61 702e 6a73 6f6e 272e 666f  _resmap.json'.fo
-00052e10: 726d 6174 2873 656c 662e 776f 726b 6469  rmat(self.workdi
-00052e20: 722c 2073 656c 662e 6d61 706e 616d 6529  r, self.mapname)
-00052e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052e40: 2020 2020 2020 2020 2073 6176 655f 696d           save_im
-00052e50: 6167 6573 746f 6a73 6f6e 2872 6573 6d61  agestojson(resma
-00052e60: 702c 206f 7574 7075 745f 6a73 6f6e 290a  p, output_json).
-00052e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e80: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-00052e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ea0: 2020 2020 7379 732e 7374 6465 7272 2e77      sys.stderr.w
-00052eb0: 7269 7465 2827 5361 7669 6e67 2074 6f20  rite('Saving to 
-00052ec0: 7265 736d 6170 206a 736f 6e20 6572 726f  resmap json erro
-00052ed0: 723a 207b 7d2e 5c6e 272e 666f 726d 6174  r: {}.\n'.format
-00052ee0: 2873 7973 2e65 7863 5f69 6e66 6f28 295b  (sys.exc_info()[
-00052ef0: 315d 2929 0a20 2020 2020 2020 2020 2020  1])).           
-00052f00: 2020 2020 2065 6e64 203d 2074 696d 6569       end = timei
-00052f10: 742e 6465 6661 756c 745f 7469 6d65 7228  t.default_timer(
-00052f20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00052f30: 2020 7072 696e 7428 2757 686f 6c65 2052    print('Whole R
-00052f40: 6573 4d61 7020 6c6f 6361 6c20 7265 736f  esMap local reso
-00052f50: 6c75 7469 6f6e 2074 696d 653a 2025 7327  lution time: %s'
-00052f60: 2025 2028 656e 6420 2d20 7374 6172 7429   % (end - start)
-00052f70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00052f80: 2020 7072 696e 7428 272d 2d2d 2d2d 2d2d    print('-------
-00052f90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00052fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a  -------------').
-00052fb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00052fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00052fd0: 2020 7072 696e 7428 274e 6f20 6861 6c66    print('No half
-00052fe0: 206d 6170 7320 5265 734d 6170 206c 6f63   maps ResMap loc
-00052ff0: 616c 2072 6573 6f6c 7574 696f 6e20 7769  al resolution wi
-00053000: 6c6c 206e 6f74 2062 6520 6361 6c63 756c  ll not be calcul
-00053010: 6174 6564 2e20 2729 0a20 2020 2020 2020  ated. ').       
-00053020: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00053030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053050: 2d2d 2d2d 2729 0a0a 2020 2020 2020 2020  ----')..        
-00053060: 7265 7475 726e 204e 6f6e 650a 0a0a 2020  return None...  
-00053070: 2020 6465 6620 6c6f 6372 6573 5f68 6973    def locres_his
-00053080: 746f 2873 656c 6629 3a0a 2020 2020 2020  to(self):.      
-00053090: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
-000530a0: 2020 5072 6f64 7563 6520 6c6f 6361 6c20    Produce local 
-000530b0: 7265 736f 6c75 7469 6f6e 2068 6973 746f  resolution histo
-000530c0: 6772 616d 2069 6e66 6f72 6d61 7469 6f6e  gram information
-000530d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-000530e0: 2020 2020 2020 7265 7375 6c74 5f64 6963        result_dic
-000530f0: 7420 3d20 7b7d 0a20 2020 2020 2020 2065  t = {}.        e
-00053100: 7272 6c69 7374 203d 205b 5d0a 2020 2020  rrlist = [].    
-00053110: 2020 2020 7374 6172 7420 3d20 7469 6d65      start = time
-00053120: 6974 2e64 6566 6175 6c74 5f74 696d 6572  it.default_timer
-00053130: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
-00053140: 6c66 2e70 6c61 7466 6f72 6d20 3d3d 2027  lf.platform == '
-00053150: 656d 6462 2720 616e 6420 7365 6c66 2e6d  emdb' and self.m
-00053160: 6574 2021 3d20 2774 6f6d 6f27 2061 6e64  et != 'tomo' and
-00053170: 2073 656c 662e 686d 6f64 6420 616e 6420   self.hmodd and 
-00053180: 7365 6c66 2e68 6d65 7665 6e3a 0a20 2020  self.hmeven:.   
-00053190: 2020 2020 2020 2020 206c 6f63 616c 5f72           local_r
-000531a0: 6573 203d 206c 6f63 616c 7265 735f 6869  es = localres_hi
-000531b0: 7374 6f67 7261 6d28 7365 6c66 2e68 6d6f  stogram(self.hmo
-000531c0: 6464 2e66 756c 6c6e 616d 652c 2073 656c  dd.fullname, sel
-000531d0: 662e 6d61 706e 616d 652c 2066 6c6f 6174  f.mapname, float
-000531e0: 2873 656c 662e 7265 736f 6c75 7469 6f6e  (self.resolution
-000531f0: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00053200: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-00053210: 616c 5f72 6573 203d 204e 6f6e 650a 0a20  al_res = None.. 
-00053220: 2020 2020 2020 2069 6620 6c6f 6361 6c5f         if local_
-00053230: 7265 733a 0a20 2020 2020 2020 2020 2020  res:.           
-00053240: 2072 6573 756c 745f 6469 6374 5b27 6c6f   result_dict['lo
-00053250: 6361 6c5f 7265 735f 6869 7374 6f67 7261  cal_res_histogra
-00053260: 6d27 5d20 3d20 6c6f 6361 6c5f 7265 730a  m'] = local_res.
-00053270: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00053280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053290: 2077 6974 6820 636f 6465 6373 2e6f 7065   with codecs.ope
-000532a0: 6e28 7365 6c66 2e77 6f72 6b64 6972 202b  n(self.workdir +
-000532b0: 2073 656c 662e 6d61 706e 616d 6520 2b20   self.mapname + 
-000532c0: 275f 6c6f 6361 6c72 6573 5f68 6973 746f  '_localres_histo
-000532d0: 2e6a 736f 6e27 2c20 2777 272c 0a20 2020  .json', 'w',.   
-000532e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000532f0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00053300: 636f 6469 6e67 3d27 7574 662d 3827 2920  coding='utf-8') 
-00053310: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-00053320: 2020 2020 2020 2020 2020 6a73 6f6e 2e64            json.d
-00053330: 756d 7028 7265 7375 6c74 5f64 6963 742c  ump(result_dict,
-00053340: 2066 290a 2020 2020 2020 2020 2020 2020   f).            
-00053350: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00053360: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00053370: 2020 2020 2020 206a 736f 6e65 7272 203d         jsonerr =
-00053380: 2027 5361 7669 6e67 206c 6f63 616c 2072   'Saving local r
-00053390: 6573 6f6c 7574 696f 6e20 6869 7374 6f67  esolution histog
-000533a0: 7261 6d20 746f 206a 736f 6e20 6572 726f  ram to json erro
-000533b0: 723a 207b 7d27 2e66 6f72 6d61 7428 6529  r: {}'.format(e)
-000533c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000533d0: 2065 7272 6c69 7374 2e61 7070 656e 6428   errlist.append(
-000533e0: 6a73 6f6e 6572 7229 0a20 2020 2020 2020  jsonerr).       
-000533f0: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
-00053400: 6572 722e 7772 6974 6528 6a73 6f6e 6572  err.write(jsoner
-00053410: 7220 2b20 275c 6e27 290a 2020 2020 2020  r + '\n').      
-00053420: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00053430: 2020 2020 7072 696e 7428 274e 6f20 6c6f      print('No lo
-00053440: 6361 6c20 7265 736f 6c75 7469 6f6e 2068  cal resolution h
-00053450: 6973 746f 6772 616d 2066 6f72 2074 6869  istogram for thi
-00053460: 7320 656e 7472 792c 2063 6865 636b 2068  s entry, check h
-00053470: 616c 6620 6d61 7073 2e27 290a 2020 2020  alf maps.').    
-00053480: 2020 2020 656e 6420 3d20 7469 6d65 6974      end = timeit
-00053490: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
-000534a0: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
-000534b0: 274c 6f63 616c 2072 6573 6f6c 7574 696f  'Local resolutio
-000534c0: 6e20 7469 6d65 3a20 7b65 6e64 202d 2073  n time: {end - s
-000534d0: 7461 7274 7d27 290a 2020 2020 2020 2020  tart}').        
-000534e0: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
-000534f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053500: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a 0a20  -----------').. 
-00053510: 2020 2023 2050 6861 7365 2072 616e 6469     # Phase randi
-00053520: 6d69 7a61 7469 6f6e 0a20 2020 2064 6566  mization.    def
-00053530: 2070 6872 616e 6428 7365 6c66 293a 0a0a   phrand(self):..
-00053540: 2020 2020 2020 2020 7068 6173 6572 616e          phaseran
-00053550: 646f 6d69 7a61 7469 6f6e 2873 656c 662e  domization(self.
-00053560: 6d61 706e 616d 652c 2073 656c 662e 686d  mapname, self.hm
-00053570: 6f64 642e 6675 6c6c 6e61 6d65 2c20 7365  odd.fullname, se
-00053580: 6c66 2e68 6d65 7665 6e2e 6675 6c6c 6e61  lf.hmeven.fullna
-00053590: 6d65 2c20 7365 6c66 2e77 6f72 6b64 6972  me, self.workdir
-000535a0: 290a 0a0a 0a20 2020 2064 6566 2065 6d72  )....    def emr
-000535b0: 696e 6765 7228 7365 6c66 293a 0a20 2020  inger(self):.   
-000535c0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000535d0: 2020 2020 2020 456d 7269 6e67 6572 2073        Emringer s
-000535e0: 636f 7265 0a0a 2020 2020 2020 2020 3a72  core..        :r
-000535f0: 6574 7572 6e3a 0a20 2020 2020 2020 2022  eturn:.        "
-00053600: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
-00053610: 656c 662e 706c 6174 666f 726d 203d 3d20  elf.platform == 
-00053620: 2765 6d64 6227 2061 6e64 2073 656c 662e  'emdb' and self.
-00053630: 6d65 7420 213d 2027 746f 6d6f 273a 0a20  met != 'tomo':. 
-00053640: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00053650: 203d 2074 696d 6569 742e 6465 6661 756c   = timeit.defaul
-00053660: 745f 7469 6d65 7228 290a 2020 2020 2020  t_timer().      
-00053670: 2020 2020 2020 6572 726c 6973 7420 3d20        errlist = 
-00053680: 5b5d 0a20 2020 2020 2020 2020 2020 2023  [].            #
-00053690: 2069 6620 7374 7275 6465 6c61 7070 2061   if strudelapp a
-000536a0: 6e64 2073 656c 662e 6d6f 6465 6c73 3a0a  nd self.models:.
-000536b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000536c0: 656c 662e 6d6f 6465 6c73 3a0a 2020 2020  elf.models:.    
-000536d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000536e0: 6d6f 6465 6c20 696e 2073 656c 662e 6d6f  model in self.mo
-000536f0: 6465 6c73 3a0a 2020 2020 2020 2020 2020  dels:.          
-00053700: 2020 2020 2020 2020 2020 6675 6c6c 5f6d            full_m
-00053710: 6f64 656c 203d 2027 7b7d 7b7d 272e 666f  odel = '{}{}'.fo
-00053720: 726d 6174 2873 656c 662e 776f 726b 6469  rmat(self.workdi
-00053730: 722c 206f 732e 7061 7468 2e62 6173 656e  r, os.path.basen
-00053740: 616d 6528 6d6f 6465 6c2e 6669 6c65 6e61  ame(model.filena
-00053750: 6d65 2929 0a20 2020 2020 2020 2020 2020  me)).           
-00053760: 2020 2020 2020 2020 2066 756c 6c5f 6d61           full_ma
-00053770: 7020 3d20 277b 7d7b 7d27 2e66 6f72 6d61  p = '{}{}'.forma
-00053780: 7428 7365 6c66 2e77 6f72 6b64 6972 2c20  t(self.workdir, 
-00053790: 7365 6c66 2e6d 6170 6e61 6d65 290a 2020  self.mapname).  
-000537a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000537b0: 2020 6f75 745f 7061 7468 203d 2027 7b7d    out_path = '{}
-000537c0: 5f65 6d72 696e 6765 7227 2e66 6f72 6d61  _emringer'.forma
-000537d0: 7428 6675 6c6c 5f6d 6f64 656c 290a 0a20  t(full_model).. 
-000537e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000537f0: 2020 2072 6572 7220 3d20 7275 6e5f 656d     rerr = run_em
-00053800: 7269 6e67 6572 2866 756c 6c5f 6d6f 6465  ringer(full_mode
-00053810: 6c2c 2066 756c 6c5f 6d61 702c 206f 7574  l, full_map, out
-00053820: 5f70 6174 6829 0a20 2020 2020 2020 2020  _path).         
-00053830: 2020 2020 2020 2020 2020 2065 6e64 203d             end =
-00053840: 2074 696d 6569 742e 6465 6661 756c 745f   timeit.default_
-00053850: 7469 6d65 7228 290a 2020 2020 2020 2020  timer().        
-00053860: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00053870: 7428 2745 4d52 696e 6765 7220 7469 6d65  t('EMRinger time
-00053880: 3a20 2573 2720 2520 2865 6e64 202d 2073  : %s' % (end - s
-00053890: 7461 7274 2929 0a20 2020 2020 2020 2020  tart)).         
-000538a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000538b0: 2827 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ('--------------
-000538c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000538d0: 2d2d 2d2d 2d2d 2729 0a20 2020 2020 2020  ------').       
-000538e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000538f0: 7265 7272 3a0a 2020 2020 2020 2020 2020  rerr:.          
-00053900: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00053910: 7220 3d20 2753 7472 7564 656c 2063 616c  r = 'Strudel cal
-00053920: 6375 6c61 7469 6f6e 2065 7272 6f72 3a20  culation error: 
-00053930: 7b7d 272e 666f 726d 6174 2872 6572 7229  {}'.format(rerr)
-00053940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053950: 2020 2020 2020 2020 2065 7272 6c69 7374           errlist
-00053960: 2e61 7070 656e 6428 6572 7229 0a20 2020  .append(err).   
-00053970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053980: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
-00053990: 7772 6974 6528 6572 7220 2b20 275c 6e27  write(err + '\n'
-000539a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000539b0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000539c0: 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  '---------------
-000539d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000539e0: 2d2d 2d2d 2d27 290a 0a20 2020 2020 2020  -----')..       
-000539f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00053a00: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00053a10: 2827 4e6f 206d 6f64 656c 206f 7220 7265  ('No model or re
-00053a20: 736f 6c75 7469 6f6e 2069 7320 6e6f 7420  solution is not 
-00053a30: 636f 7665 7265 6420 696e 2074 6865 206d  covered in the m
-00053a40: 6f74 6966 206c 6962 7261 7279 2028 3c34  otif library (<4
-00053a50: 2e30 c385 2920 2729 0a20 2020 2020 2020  .0..) ').       
-00053a60: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00053a70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053a80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053a90: 2d2d 2d2d 2729 0a0a 2020 2020 2020 2020  ----')..        
-00053aa0: 7265 7475 726e 204e 6f6e 650a 0a0a 2020  return None...  
-00053ab0: 2020 6465 6620 7468 7265 6564 6673 6328    def threedfsc(
-00053ac0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00053ad0: 2222 0a0a 2020 2020 2020 2020 2020 2020  ""..            
-00053ae0: 456d 7269 6e67 6572 2073 636f 7265 0a0a  Emringer score..
-00053af0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00053b00: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00053b10: 2020 2020 2020 6966 2073 656c 662e 706c        if self.pl
-00053b20: 6174 666f 726d 203d 3d20 2765 6d64 6227  atform == 'emdb'
-00053b30: 2061 6e64 2073 656c 662e 6d65 7420 213d   and self.met !=
-00053b40: 2027 746f 6d6f 273a 0a20 2020 2020 2020   'tomo':.       
-00053b50: 2020 2020 2069 6620 7365 6c66 2e74 6872       if self.thr
-00053b60: 6565 6466 7363 6469 7220 6973 206e 6f74  eedfscdir is not
-00053b70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00053b80: 2020 2020 2020 2073 7461 7274 203d 2074         start = t
-00053b90: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
-00053ba0: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
-00053bb0: 2020 2020 2020 6572 726c 6973 7420 3d20        errlist = 
-00053bc0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-00053bd0: 2020 2069 6620 7365 6c66 2e68 6d6f 6464     if self.hmodd
-00053be0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00053bf0: 2073 656c 662e 686d 6576 656e 2069 7320   self.hmeven is 
-00053c00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00053c10: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00053c20: 745f 7061 7468 203d 2027 7b7d 5f33 6466  t_path = '{}_3df
-00053c30: 7363 272e 666f 726d 6174 2873 656c 662e  sc'.format(self.
-00053c40: 6d61 702e 6675 6c6c 6e61 6d65 290a 2020  map.fullname).  
-00053c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053c60: 2020 7678 7369 7a65 7320 3d20 7365 6c66    vxsizes = self
-00053c70: 2e6d 6170 2e76 6f78 656c 5f73 697a 650a  .map.voxel_size.
-00053c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053c90: 2020 2020 6966 2076 7873 697a 6573 2e78      if vxsizes.x
-00053ca0: 203d 3d20 7678 7369 7a65 732e 7920 3d3d   == vxsizes.y ==
-00053cb0: 2076 7873 697a 6573 2e7a 2061 6e64 2073   vxsizes.z and s
-00053cc0: 656c 662e 686d 6f64 642e 766f 7865 6c5f  elf.hmodd.voxel_
-00053cd0: 7369 7a65 203d 3d20 7365 6c66 2e68 6d65  size == self.hme
-00053ce0: 7665 6e2e 766f 7865 6c5f 7369 7a65 3a0a  ven.voxel_size:.
-00053cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d00: 2020 2020 2020 2020 7265 7272 203d 2072          rerr = r
-00053d10: 756e 5f74 6872 6565 6466 7363 2873 656c  un_threedfsc(sel
-00053d20: 662e 686d 6f64 642e 6675 6c6c 6e61 6d65  f.hmodd.fullname
-00053d30: 2c20 7365 6c66 2e68 6d65 7665 6e2e 6675  , self.hmeven.fu
-00053d40: 6c6c 6e61 6d65 2c20 7365 6c66 2e6d 6170  llname, self.map
-00053d50: 2e66 756c 6c6e 616d 652c 0a20 2020 2020  .fullname,.     
-00053d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d80: 2020 2020 2020 2020 7678 7369 7a65 732e          vxsizes.
-00053d90: 782c 206f 7574 5f70 6174 682c 2073 656c  x, out_path, sel
-00053da0: 662e 7468 7265 6564 6673 6364 6972 290a  f.threedfscdir).
-00053db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053dc0: 2020 2020 2020 2020 656e 6420 3d20 7469          end = ti
-00053dd0: 6d65 6974 2e64 6566 6175 6c74 5f74 696d  meit.default_tim
-00053de0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
-00053df0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00053e00: 6e74 2827 3344 4653 4320 7469 6d65 3a20  nt('3DFSC time: 
-00053e10: 2573 2720 2520 2865 6e64 202d 2073 7461  %s' % (end - sta
-00053e20: 7274 2929 0a20 2020 2020 2020 2020 2020  rt)).           
-00053e30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00053e40: 7265 7272 3a0a 2020 2020 2020 2020 2020  rerr:.          
-00053e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053e60: 2020 6572 7220 3d20 2733 4446 5343 2063    err = '3DFSC c
-00053e70: 616c 6375 6c61 7469 6f6e 2065 7272 6f72  alculation error
-00053e80: 3a20 7b7d 272e 666f 726d 6174 2872 6572  : {}'.format(rer
-00053e90: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00053ea0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00053eb0: 7272 6c69 7374 2e61 7070 656e 6428 6572  rrlist.append(er
-00053ec0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00053ed0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00053ee0: 7973 2e73 7464 6572 722e 7772 6974 6528  ys.stderr.write(
-00053ef0: 6572 7220 2b20 275c 6e27 290a 2020 2020  err + '\n').    
-00053f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053f10: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
-00053f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053f30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053f40: 2d2d 2d27 290a 2020 2020 2020 2020 2020  ---').          
-00053f50: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00053f60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00053f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053f80: 7072 696e 7428 272d 2d2d 2d2d 2d2d 2d2d  print('---------
-00053f90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00053fa0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d27 290a 0a20  -----------').. 
-00053fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053fc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00053fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053fe0: 2070 7269 6e74 2827 3344 4653 4320 696e   print('3DFSC in
-00053ff0: 7075 7420 6d61 7020 6e65 6564 2074 6f20  put map need to 
-00054000: 6265 2063 7562 6963 2061 6e64 2074 776f  be cubic and two
-00054010: 2068 616c 6620 6d61 7073 206e 6565 6420   half maps need 
-00054020: 746f 2068 6176 6520 7361 6d65 2076 6f78  to have same vox
-00054030: 656c 2073 697a 652e 2729 0a20 2020 2020  el size.').     
-00054040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054050: 2020 2070 7269 6e74 2827 2d2d 2d2d 2d2d     print('------
-00054060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2729  --------------')
-00054080: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00054090: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000540a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000540b0: 7428 274e 6f20 6861 6c66 206d 6170 2069  t('No half map i
-000540c0: 6e66 6f72 6d61 7469 6f6e 2066 6f72 2033  nformation for 3
-000540d0: 4446 5343 2063 616c 6375 6c61 7469 6f6e  DFSC calculation
-000540e0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-000540f0: 2020 2020 2020 2020 7072 696e 7428 272d          print('-
-00054100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054110: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00054120: 2d2d 2d27 290a 2020 2020 2020 2020 2020  ---').          
-00054130: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00054140: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
-00054150: 6f20 7468 7265 6564 6673 6320 696e 666f  o threedfsc info
-00054160: 726d 6174 696f 6e20 7072 6f76 6964 6564  rmation provided
-00054170: 2c20 7573 6520 2d2d 7468 7265 6564 6469  , use --threeddi
-00054180: 722f 2d74 6872 6565 6464 203c 6675 6c6c  r/-threedd <full
-00054190: 2066 696c 6520 7061 7468 3e2e 2729 0a0a   file path>.')..
-000541a0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000541b0: 6f6e 650a                                one.
+00052a70: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00052a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052a90: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00052aa0: 2827 5361 7669 6e67 2074 6f20 7265 736d  ('Saving to resm
+00052ab0: 6170 206a 736f 6e20 6572 726f 723a 207b  ap json error: {
+00052ac0: 7d2e 5c6e 272e 666f 726d 6174 2873 7973  }.\n'.format(sys
+00052ad0: 2e65 7863 5f69 6e66 6f28 295b 315d 2929  .exc_info()[1]))
+00052ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052af0: 2065 6e64 203d 2074 696d 6569 742e 6465   end = timeit.de
+00052b00: 6661 756c 745f 7469 6d65 7228 290a 2020  fault_timer().  
+00052b10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00052b20: 696e 7428 2757 686f 6c65 2052 6573 4d61  int('Whole ResMa
+00052b30: 7020 6c6f 6361 6c20 7265 736f 6c75 7469  p local resoluti
+00052b40: 6f6e 2074 696d 653a 2025 7327 2025 2028  on time: %s' % (
+00052b50: 656e 6420 2d20 7374 6172 7429 290a 2020  end - start)).  
+00052b60: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00052b70: 696e 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d  int('-----------
+00052b80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00052b90: 2d2d 2d2d 2d2d 2d2d 2d27 290a 2020 2020  ---------').    
+00052ba0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00052bb0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00052bc0: 696e 7428 274e 6f20 6861 6c66 206d 6170  int('No half map
+00052bd0: 7320 5265 734d 6170 206c 6f63 616c 2072  s ResMap local r
+00052be0: 6573 6f6c 7574 696f 6e20 7769 6c6c 206e  esolution will n
+00052bf0: 6f74 2062 6520 6361 6c63 756c 6174 6564  ot be calculated
+00052c00: 2e20 2729 0a20 2020 2020 2020 2020 2020  . ').           
+00052c10: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+00052c20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00052c30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00052c40: 2729 0a0a 2020 2020 2020 2020 7265 7475  ')..        retu
+00052c50: 726e 204e 6f6e 650a 0a0a 2020 2020 6465  rn None...    de
+00052c60: 6620 6c6f 6372 6573 5f68 6973 746f 2873  f locres_histo(s
+00052c70: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00052c80: 220a 2020 2020 2020 2020 2020 2020 5072  ".            Pr
+00052c90: 6f64 7563 6520 6c6f 6361 6c20 7265 736f  oduce local reso
+00052ca0: 6c75 7469 6f6e 2068 6973 746f 6772 616d  lution histogram
+00052cb0: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
+00052cc0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00052cd0: 2020 7265 7375 6c74 5f64 6963 7420 3d20    result_dict = 
+00052ce0: 7b7d 0a20 2020 2020 2020 2065 7272 6c69  {}.        errli
+00052cf0: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+00052d00: 7374 6172 7420 3d20 7469 6d65 6974 2e64  start = timeit.d
+00052d10: 6566 6175 6c74 5f74 696d 6572 2829 0a20  efault_timer(). 
+00052d20: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
+00052d30: 6c61 7466 6f72 6d20 3d3d 2027 656d 6462  latform == 'emdb
+00052d40: 2720 616e 6420 7365 6c66 2e6d 6574 2021  ' and self.met !
+00052d50: 3d20 2774 6f6d 6f27 2061 6e64 2073 656c  = 'tomo' and sel
+00052d60: 662e 686d 6f64 6420 616e 6420 7365 6c66  f.hmodd and self
+00052d70: 2e68 6d65 7665 6e3a 0a20 2020 2020 2020  .hmeven:.       
+00052d80: 2020 2020 206c 6f63 616c 5f72 6573 203d       local_res =
+00052d90: 206c 6f63 616c 7265 735f 6869 7374 6f67   localres_histog
+00052da0: 7261 6d28 7365 6c66 2e68 6d6f 6464 2e66  ram(self.hmodd.f
+00052db0: 756c 6c6e 616d 652c 2073 656c 662e 6d61  ullname, self.ma
+00052dc0: 706e 616d 652c 2066 6c6f 6174 2873 656c  pname, float(sel
+00052dd0: 662e 7265 736f 6c75 7469 6f6e 2929 0a20  f.resolution)). 
+00052de0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00052df0: 2020 2020 2020 2020 206c 6f63 616c 5f72           local_r
+00052e00: 6573 203d 204e 6f6e 650a 0a20 2020 2020  es = None..     
+00052e10: 2020 2069 6620 6c6f 6361 6c5f 7265 733a     if local_res:
+00052e20: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00052e30: 756c 745f 6469 6374 5b27 6c6f 6361 6c5f  ult_dict['local_
+00052e40: 7265 735f 6869 7374 6f67 7261 6d27 5d20  res_histogram'] 
+00052e50: 3d20 6c6f 6361 6c5f 7265 730a 2020 2020  = local_res.    
+00052e60: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00052e70: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+00052e80: 6820 636f 6465 6373 2e6f 7065 6e28 7365  h codecs.open(se
+00052e90: 6c66 2e77 6f72 6b64 6972 202b 2073 656c  lf.workdir + sel
+00052ea0: 662e 6d61 706e 616d 6520 2b20 275f 6c6f  f.mapname + '_lo
+00052eb0: 6361 6c72 6573 5f68 6973 746f 2e6a 736f  calres_histo.jso
+00052ec0: 6e27 2c20 2777 272c 0a20 2020 2020 2020  n', 'w',.       
+00052ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052ee0: 2020 2020 2020 2020 2020 656e 636f 6469            encodi
+00052ef0: 6e67 3d27 7574 662d 3827 2920 6173 2066  ng='utf-8') as f
+00052f00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00052f10: 2020 2020 2020 6a73 6f6e 2e64 756d 7028        json.dump(
+00052f20: 7265 7375 6c74 5f64 6963 742c 2066 290a  result_dict, f).
+00052f30: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00052f40: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00052f50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00052f60: 2020 206a 736f 6e65 7272 203d 2027 5361     jsonerr = 'Sa
+00052f70: 7669 6e67 206c 6f63 616c 2072 6573 6f6c  ving local resol
+00052f80: 7574 696f 6e20 6869 7374 6f67 7261 6d20  ution histogram 
+00052f90: 746f 206a 736f 6e20 6572 726f 723a 207b  to json error: {
+00052fa0: 7d27 2e66 6f72 6d61 7428 6529 0a20 2020  }'.format(e).   
+00052fb0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00052fc0: 6c69 7374 2e61 7070 656e 6428 6a73 6f6e  list.append(json
+00052fd0: 6572 7229 0a20 2020 2020 2020 2020 2020  err).           
+00052fe0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+00052ff0: 7772 6974 6528 6a73 6f6e 6572 7220 2b20  write(jsonerr + 
+00053000: 275c 6e27 290a 2020 2020 2020 2020 656c  '\n').        el
+00053010: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00053020: 7072 696e 7428 274e 6f20 6c6f 6361 6c20  print('No local 
+00053030: 7265 736f 6c75 7469 6f6e 2068 6973 746f  resolution histo
+00053040: 6772 616d 2066 6f72 2074 6869 7320 656e  gram for this en
+00053050: 7472 792c 2063 6865 636b 2068 616c 6620  try, check half 
+00053060: 6d61 7073 2e27 290a 2020 2020 2020 2020  maps.').        
+00053070: 656e 6420 3d20 7469 6d65 6974 2e64 6566  end = timeit.def
+00053080: 6175 6c74 5f74 696d 6572 2829 0a20 2020  ault_timer().   
+00053090: 2020 2020 2070 7269 6e74 2866 274c 6f63       print(f'Loc
+000530a0: 616c 2072 6573 6f6c 7574 696f 6e20 7469  al resolution ti
+000530b0: 6d65 3a20 7b65 6e64 202d 2073 7461 7274  me: {end - start
+000530c0: 7d27 290a 2020 2020 2020 2020 7072 696e  }').        prin
+000530d0: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
+000530e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000530f0: 2d2d 2d2d 2d2d 2d27 290a 0a20 2020 2023  -------')..    #
+00053100: 2050 6861 7365 2072 616e 6469 6d69 7a61   Phase randimiza
+00053110: 7469 6f6e 0a20 2020 2064 6566 2070 6872  tion.    def phr
+00053120: 616e 6428 7365 6c66 293a 0a0a 2020 2020  and(self):..    
+00053130: 2020 2020 7068 6173 6572 616e 646f 6d69      phaserandomi
+00053140: 7a61 7469 6f6e 2873 656c 662e 6d61 706e  zation(self.mapn
+00053150: 616d 652c 2073 656c 662e 686d 6f64 642e  ame, self.hmodd.
+00053160: 6675 6c6c 6e61 6d65 2c20 7365 6c66 2e68  fullname, self.h
+00053170: 6d65 7665 6e2e 6675 6c6c 6e61 6d65 2c20  meven.fullname, 
+00053180: 7365 6c66 2e77 6f72 6b64 6972 290a 0a0a  self.workdir)...
+00053190: 0a20 2020 2064 6566 2065 6d72 696e 6765  .    def emringe
+000531a0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+000531b0: 2022 2222 0a0a 2020 2020 2020 2020 2020   """..          
+000531c0: 2020 456d 7269 6e67 6572 2073 636f 7265    Emringer score
+000531d0: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+000531e0: 6e3a 0a20 2020 2020 2020 2022 2222 0a0a  n:.        """..
+000531f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00053200: 706c 6174 666f 726d 203d 3d20 2765 6d64  platform == 'emd
+00053210: 6227 2061 6e64 2073 656c 662e 6d65 7420  b' and self.met 
+00053220: 213d 2027 746f 6d6f 273a 0a20 2020 2020  != 'tomo':.     
+00053230: 2020 2020 2020 2073 7461 7274 203d 2074         start = t
+00053240: 696d 6569 742e 6465 6661 756c 745f 7469  imeit.default_ti
+00053250: 6d65 7228 290a 2020 2020 2020 2020 2020  mer().          
+00053260: 2020 6572 726c 6973 7420 3d20 5b5d 0a20    errlist = []. 
+00053270: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00053280: 7374 7275 6465 6c61 7070 2061 6e64 2073  strudelapp and s
+00053290: 656c 662e 6d6f 6465 6c73 3a0a 2020 2020  elf.models:.    
+000532a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000532b0: 6d6f 6465 6c73 3a0a 2020 2020 2020 2020  models:.        
+000532c0: 2020 2020 2020 2020 666f 7220 6d6f 6465          for mode
+000532d0: 6c20 696e 2073 656c 662e 6d6f 6465 6c73  l in self.models
+000532e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000532f0: 2020 2020 2020 6675 6c6c 5f6d 6f64 656c        full_model
+00053300: 203d 2027 7b7d 7b7d 272e 666f 726d 6174   = '{}{}'.format
+00053310: 2873 656c 662e 776f 726b 6469 722c 206f  (self.workdir, o
+00053320: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00053330: 6d6f 6465 6c2e 6669 6c65 6e61 6d65 2929  model.filename))
+00053340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053350: 2020 2020 2066 756c 6c5f 6d61 7020 3d20       full_map = 
+00053360: 277b 7d7b 7d27 2e66 6f72 6d61 7428 7365  '{}{}'.format(se
+00053370: 6c66 2e77 6f72 6b64 6972 2c20 7365 6c66  lf.workdir, self
+00053380: 2e6d 6170 6e61 6d65 290a 2020 2020 2020  .mapname).      
+00053390: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+000533a0: 745f 7061 7468 203d 2027 7b7d 5f65 6d72  t_path = '{}_emr
+000533b0: 696e 6765 7227 2e66 6f72 6d61 7428 6675  inger'.format(fu
+000533c0: 6c6c 5f6d 6f64 656c 290a 0a20 2020 2020  ll_model)..     
+000533d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000533e0: 6572 7220 3d20 7275 6e5f 656d 7269 6e67  err = run_emring
+000533f0: 6572 2866 756c 6c5f 6d6f 6465 6c2c 2066  er(full_model, f
+00053400: 756c 6c5f 6d61 702c 206f 7574 5f70 6174  ull_map, out_pat
+00053410: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+00053420: 2020 2020 2020 2065 6e64 203d 2074 696d         end = tim
+00053430: 6569 742e 6465 6661 756c 745f 7469 6d65  eit.default_time
+00053440: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
+00053450: 2020 2020 2020 2020 7072 696e 7428 2745          print('E
+00053460: 4d52 696e 6765 7220 7469 6d65 3a20 2573  MRinger time: %s
+00053470: 2720 2520 2865 6e64 202d 2073 7461 7274  ' % (end - start
+00053480: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00053490: 2020 2020 2020 2070 7269 6e74 2827 2d2d         print('--
+000534a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000534b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000534c0: 2d2d 2729 0a20 2020 2020 2020 2020 2020  --').           
+000534d0: 2020 2020 2020 2020 2069 6620 7265 7272           if rerr
+000534e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000534f0: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
+00053500: 2753 7472 7564 656c 2063 616c 6375 6c61  'Strudel calcula
+00053510: 7469 6f6e 2065 7272 6f72 3a20 7b7d 272e  tion error: {}'.
+00053520: 666f 726d 6174 2872 6572 7229 0a20 2020  format(rerr).   
+00053530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053540: 2020 2020 2065 7272 6c69 7374 2e61 7070       errlist.app
+00053550: 656e 6428 6572 7229 0a20 2020 2020 2020  end(err).       
+00053560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053570: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
+00053580: 6528 6572 7220 2b20 275c 6e27 290a 2020  e(err + '\n').  
+00053590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000535a0: 2020 2020 2020 7072 696e 7428 272d 2d2d        print('---
+000535b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000535c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000535d0: 2d27 290a 0a20 2020 2020 2020 2020 2020  -')..           
+000535e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000535f0: 2020 2020 2020 2070 7269 6e74 2827 4e6f         print('No
+00053600: 206d 6f64 656c 206f 7220 7265 736f 6c75   model or resolu
+00053610: 7469 6f6e 2069 7320 6e6f 7420 636f 7665  tion is not cove
+00053620: 7265 6420 696e 2074 6865 206d 6f74 6966  red in the motif
+00053630: 206c 6962 7261 7279 2028 3c34 2e30 c385   library (<4.0..
+00053640: 2920 2729 0a20 2020 2020 2020 2020 2020  ) ').           
+00053650: 2020 2020 2070 7269 6e74 2827 2d2d 2d2d       print('----
+00053660: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00053670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00053680: 2729 0a0a 2020 2020 2020 2020 7265 7475  ')..        retu
+00053690: 726e 204e 6f6e 650a 0a0a 2020 2020 6465  rn None...    de
+000536a0: 6620 7468 7265 6564 6673 6328 7365 6c66  f threedfsc(self
+000536b0: 293a 0a20 2020 2020 2020 2022 2222 0a0a  ):.        """..
+000536c0: 2020 2020 2020 2020 2020 2020 456d 7269              Emri
+000536d0: 6e67 6572 2073 636f 7265 0a0a 2020 2020  nger score..    
+000536e0: 2020 2020 3a72 6574 7572 6e3a 0a20 2020      :return:.   
+000536f0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00053700: 2020 6966 2073 656c 662e 706c 6174 666f    if self.platfo
+00053710: 726d 203d 3d20 2765 6d64 6227 2061 6e64  rm == 'emdb' and
+00053720: 2073 656c 662e 6d65 7420 213d 2027 746f   self.met != 'to
+00053730: 6d6f 273a 0a20 2020 2020 2020 2020 2020  mo':.           
+00053740: 2069 6620 7365 6c66 2e74 6872 6565 6466   if self.threedf
+00053750: 7363 6469 7220 6973 206e 6f74 204e 6f6e  scdir is not Non
+00053760: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00053770: 2020 2073 7461 7274 203d 2074 696d 6569     start = timei
+00053780: 742e 6465 6661 756c 745f 7469 6d65 7228  t.default_timer(
+00053790: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000537a0: 2020 6572 726c 6973 7420 3d20 5b5d 0a20    errlist = []. 
+000537b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000537c0: 6620 7365 6c66 2e68 6d6f 6464 2069 7320  f self.hmodd is 
+000537d0: 6e6f 7420 4e6f 6e65 2061 6e64 2073 656c  not None and sel
+000537e0: 662e 686d 6576 656e 2069 7320 6e6f 7420  f.hmeven is not 
+000537f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00053800: 2020 2020 2020 2020 2020 6f75 745f 7061            out_pa
+00053810: 7468 203d 2027 7b7d 5f33 6466 7363 272e  th = '{}_3dfsc'.
+00053820: 666f 726d 6174 2873 656c 662e 6d61 702e  format(self.map.
+00053830: 6675 6c6c 6e61 6d65 290a 2020 2020 2020  fullname).      
+00053840: 2020 2020 2020 2020 2020 2020 2020 7678                vx
+00053850: 7369 7a65 7320 3d20 7365 6c66 2e6d 6170  sizes = self.map
+00053860: 2e76 6f78 656c 5f73 697a 650a 2020 2020  .voxel_size.    
+00053870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053880: 6966 2076 7873 697a 6573 2e78 203d 3d20  if vxsizes.x == 
+00053890: 7678 7369 7a65 732e 7920 3d3d 2076 7873  vxsizes.y == vxs
+000538a0: 697a 6573 2e7a 2061 6e64 2073 656c 662e  izes.z and self.
+000538b0: 686d 6f64 642e 766f 7865 6c5f 7369 7a65  hmodd.voxel_size
+000538c0: 203d 3d20 7365 6c66 2e68 6d65 7665 6e2e   == self.hmeven.
+000538d0: 766f 7865 6c5f 7369 7a65 3a0a 2020 2020  voxel_size:.    
+000538e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000538f0: 2020 2020 7265 7272 203d 2072 756e 5f74      rerr = run_t
+00053900: 6872 6565 6466 7363 2873 656c 662e 686d  hreedfsc(self.hm
+00053910: 6f64 642e 6675 6c6c 6e61 6d65 2c20 7365  odd.fullname, se
+00053920: 6c66 2e68 6d65 7665 6e2e 6675 6c6c 6e61  lf.hmeven.fullna
+00053930: 6d65 2c20 7365 6c66 2e6d 6170 2e66 756c  me, self.map.ful
+00053940: 6c6e 616d 652c 0a20 2020 2020 2020 2020  lname,.         
+00053950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053970: 2020 2020 7678 7369 7a65 732e 782c 206f      vxsizes.x, o
+00053980: 7574 5f70 6174 682c 2073 656c 662e 7468  ut_path, self.th
+00053990: 7265 6564 6673 6364 6972 290a 2020 2020  reedfscdir).    
+000539a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000539b0: 2020 2020 656e 6420 3d20 7469 6d65 6974      end = timeit
+000539c0: 2e64 6566 6175 6c74 5f74 696d 6572 2829  .default_timer()
+000539d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000539e0: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+000539f0: 3344 4653 4320 7469 6d65 3a20 2573 2720  3DFSC time: %s' 
+00053a00: 2520 2865 6e64 202d 2073 7461 7274 2929  % (end - start))
+00053a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053a20: 2020 2020 2020 2020 2069 6620 7265 7272           if rerr
+00053a30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00053a40: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00053a50: 7220 3d20 2733 4446 5343 2063 616c 6375  r = '3DFSC calcu
+00053a60: 6c61 7469 6f6e 2065 7272 6f72 3a20 7b7d  lation error: {}
+00053a70: 272e 666f 726d 6174 2872 6572 7229 0a20  '.format(rerr). 
+00053a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053a90: 2020 2020 2020 2020 2020 2065 7272 6c69             errli
+00053aa0: 7374 2e61 7070 656e 6428 6572 7229 0a20  st.append(err). 
+00053ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ac0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+00053ad0: 7464 6572 722e 7772 6974 6528 6572 7220  tderr.write(err 
+00053ae0: 2b20 275c 6e27 290a 2020 2020 2020 2020  + '\n').        
+00053af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b00: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+00053b10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00053b20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+00053b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00053b40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00053b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b60: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00053b70: 7428 272d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  t('-------------
+00053b80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00053b90: 2d2d 2d2d 2d2d 2d27 290a 0a20 2020 2020  -------')..     
+00053ba0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00053bb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00053bc0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00053bd0: 6e74 2827 3344 4653 4320 696e 7075 7420  nt('3DFSC input 
+00053be0: 6d61 7020 6e65 6564 2074 6f20 6265 2063  map need to be c
+00053bf0: 7562 6963 2061 6e64 2074 776f 2068 616c  ubic and two hal
+00053c00: 6620 6d61 7073 206e 6565 6420 746f 2068  f maps need to h
+00053c10: 6176 6520 7361 6d65 2076 6f78 656c 2073  ave same voxel s
+00053c20: 697a 652e 2729 0a20 2020 2020 2020 2020  ize.').         
+00053c30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00053c40: 7269 6e74 2827 2d2d 2d2d 2d2d 2d2d 2d2d  rint('----------
+00053c50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00053c60: 2d2d 2d2d 2d2d 2d2d 2d2d 2729 0a0a 2020  ----------')..  
+00053c70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00053c80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00053c90: 2020 2020 2020 2020 7072 696e 7428 274e          print('N
+00053ca0: 6f20 6861 6c66 206d 6170 2069 6e66 6f72  o half map infor
+00053cb0: 6d61 7469 6f6e 2066 6f72 2033 4446 5343  mation for 3DFSC
+00053cc0: 2063 616c 6375 6c61 7469 6f6e 2e27 290a   calculation.').
+00053cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ce0: 2020 2020 7072 696e 7428 272d 2d2d 2d2d      print('-----
+00053cf0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00053d00: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d27  ---------------'
+00053d10: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00053d20: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00053d30: 2020 2020 7072 696e 7428 274e 6f20 7468      print('No th
+00053d40: 7265 6564 6673 6320 696e 666f 726d 6174  reedfsc informat
+00053d50: 696f 6e20 7072 6f76 6964 6564 2c20 7573  ion provided, us
+00053d60: 6520 2d2d 7468 7265 6564 6469 722f 2d74  e --threeddir/-t
+00053d70: 6872 6565 6464 203c 6675 6c6c 2066 696c  hreedd <full fil
+00053d80: 6520 7061 7468 3e2e 2729 0a0a 2020 2020  e path>.')..    
+00053d90: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
```

### Comparing `va-0.0.1.dev98/va/version.py` & `va-0.0.1.dev99/va/version.py`

 * *Files 1% similar despite different names*

```diff
@@ -24,8 +24,8 @@
 an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied. See the License for the
 specific language governing permissions and limitations
 under the License.
 
 """
 
-__version__ = '0.0.1.dev98'
+__version__ = '0.0.1.dev99'
```

### Comparing `va-0.0.1.dev98/va.egg-info/PKG-INFO` & `va-0.0.1.dev99/va.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: va
-Version: 0.0.1.dev98
+Version: 0.0.1.dev99
 Summary: CryoEM validation toolkit
 Home-page: https://test.pypi.org/project/va/
 Author: Zhe Wang
 Author-email: zhe@ebi.ac.uk
 License: Apache License
 Keywords: EMDB,Cryoem,Validation
 Classifier: Development Status :: 2 - Pre-Alpha
```

### Comparing `va-0.0.1.dev98/va.egg-info/SOURCES.txt` & `va-0.0.1.dev99/va.egg-info/SOURCES.txt`

 * *Files identical despite different names*

